function getBrowser(){if(navigator.userAgent.indexOf("MSIE")>0)return"MSIE";if(isFirefox=navigator.userAgent.indexOf("Firefox")>0)return"Firefox";if(isSafari=navigator.userAgent.indexOf("Safari")>0)return"Safari";if(isCamino=navigator.userAgent.indexOf("Camino")>0)return"Camino";if(isMozilla=navigator.userAgent.indexOf("Gecko/")>0)return"Gecko"}function parse(e){var t="";return e!=null&&(t=e),t}function convertToDate(e){return new Date(parseInt(e.substring(6)))}function convertToDisplayExtensionType(e){switch(e){case sldEntity.ExtensionType.Addon:return localizedString("EXTENSION_TYPE_ADDON");case sldEntity.ExtensionType.Lightweight:return localizedString("EXTENSION_TYPE_LIGHTWEIGHT");case sldEntity.ExtensionType.LightweightMV:return localizedString("EXTENSION_TYPE_LIGHTWEIGHT");case sldEntity.ExtensionType.B1script:return localizedString("EXTENSION_TYPE_SBOSCRIPT");case sldEntity.ExtensionType.XApp:return localizedString("EXTENSION_TYPE_XAPP");case sldEntity.ExtensionType.LightweightXApp:return localizedString("EXTENSION_TYPE_LIGHTWEIGHT");default:return null}}function isTraditionalAddOn(e){return e==sldEntity.ExtensionType.Addon}function convertToDisplayStatus(e){switch(e){case"ToInstall":return localizedString("ExtensionStatus_ToInstall");case"ToUninstall":return localizedString("ExtensionStatus_ToUninstall");case"ToUpgrade":return localizedString("ExtensionStatus_ToUpgrade");case"Uninstalling":return localizedString("ExtensionStatus_Uninstalling");case"Uninstalled":return localizedString("ExtensionStatus_Uninstalled");case"Upgrading":return localizedString("ExtensionStatus_Upgrading");case"Failed":return localizedString("ExtensionStatus_Failed");case"Installing":return localizedString("ExtensionStatus_Installing");case"Installed":return localizedString("ExtensionStatus_Installed");case"InstallationFailed":return localizedString("ExtensionStatus_InstallationFailed");case"UpgradeFailed":return localizedString("ExtensionStatus_UpgradeFailed");case"UninstallationFailed":return localizedString("ExtensionStatus_UninstallationFailed");case"":return localizedString("ExtensionStatus_ToInstall");case undefined:return localizedString("ExtensionStatus_ToInstall");default:return localizedString("ExtensionStatus_Unknown")}}function convertToFamatDateTime(e){var t=new Date(parseInt(e.substring(6))),n=t.getFullYear(),r=t.getMonth()+1,i=t.getDate(),s=t.getHours(),o=t.getMinutes(),u=t.getSeconds(),a=s>=12?" PM":" AM";return s=s>=12?s-12:s,r+"/"+i+"/"+n+" "+s+":"+o.padLeft(2)+":"+u.padLeft(2)+""+a}function formatMillisecondsAsDuration(e){function t(e){return(e<10?"0":"")+e}var n=e%1e3,r=(e-n)/1e3,i=r%60;r=(r-i)/60;var s=r%60;r=(r-s)/60;var o=r%24,u=(r-o)/24;return u>0?u+" day(s)":t(o)+":"+t(s)+":"+t(i)}function importLicenseFile(e,t){if(e.files&&e.files.length&&e.files[0].size>0){var n=e.files[0];if(window.FileReader){var r=new FileReader;r.onloadend=function(e){e.target.readyState==FileReader.DONE&&c3.service.importLicenseFile("LicenseFileContent='"+escape(e.target.result.split(",")[1])+"'",t)},r.readAsDataURL(n)}}else c3.service.importLicenseFileUpload(e,t)}function getLicenseFileContent(e,t){if(e.files&&e.files.length>0&&e.files[0].size>0){var n=e.files[0];if(window.FileReader){var r=new FileReader;r.onloadend=function(e){e.target.readyState==FileReader.DONE&&t("LicenseFileContent='"+escape(e.target.result.split(",")[1])+"'")},r.readAsDataURL(n)}}else t()}function readDKeyFileContent(e,t){if(e.files&&e.files.length>0&&e.files[0].size>0){var n=e.files[0];if(window.FileReader){var r=new FileReader;r.onloadend=function(e){e.target.readyState==FileReader.DONE&&t("'"+escape(e.target.result.split(",")[1])+"'")},r.readAsDataURL(n)}}else t()}function readPfxFileContent(e,t){if(e.files&&e.files.length>0&&e.files[0].size>0){var n=e.files[0];if(window.FileReader){var r=new FileReader;r.onloadend=function(e){e.target.readyState==FileReader.DONE&&t(escape(e.target.result.split(",")[1]))},r.readAsDataURL(n)}}else t()}function localizedString(e){var t=e;return!$.browser.msie&&localization!==undefined&&localization[e]&&(t=localization[e]),t}function retriveErrorMessage(e){var t="";try{var n=$.parseJSON(e),r=n.error.message.value;t=r}catch(i){}return t}function retriveErrorCode(e){var t=0;try{var n=$.parseJSON(e),r=n.error.code;t=r}catch(i){}return t}function translateEnum2L10NStr(e,t){for(var n in t)if(n==e)return localizedString(t[n])}function base64Encode(e){var t=[],n=e.length,r=k=0;for(var i=0;i<n/3;i++)t[r++]=base64Chars[e.charCodeAt(k)>>2&63],t[r++]=base64Chars[(e.charCodeAt(k)<<4&63)+(e.charCodeAt(k+1)>>4&15)],t[r++]=base64Chars[(e.charCodeAt(k+1)<<2&63)+(e.charCodeAt(k+2)>>6&3)],t[r++]=base64Chars[e.charCodeAt(k+2)&63],k+=3;n%3==1&&(t[r-1]="=",t[r-2]="="),n%3==2&&(t[r-1]="=");var s=t.join("");return s}function base64Decode(e){var t="",n,r,i="",s,o,u,a="",f=0,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=/[^A-Za-z0-9\+\/\=]/g;c.exec(e)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do s=l.indexOf(e.charAt(f++)),o=l.indexOf(e.charAt(f++)),u=l.indexOf(e.charAt(f++)),a=l.indexOf(e.charAt(f++)),n=s<<2|o>>4,r=(o&15)<<4|u>>2,i=(u&3)<<6|a,t+=String.fromCharCode(n),u!=64&&(t+=String.fromCharCode(r)),a!=64&&(t+=String.fromCharCode(i)),n=r=i="",s=o=u=a="";while(f<e.length);return unescape(t)}function utf8Encode(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t}function utf8Decode(e){var t="",n=0,r=co1=co2=0;while(n<e.length)r=e.charCodeAt(n),r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(co2=e.charCodeAt(n+1),t+=String.fromCharCode((r&31)<<6|co2&63),n+=2):(co2=e.charCodeAt(n+1),co3=e.charCodeAt(n+2),t+=String.fromCharCode((r&15)<<12|(co2&63)<<6|co3&63),n+=3);return t}function setCookie(e,t){var n=864e5,r=new Date;r.setTime(r.getTime()+n),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()+";path=/;"}function getCookie(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return t!=null?unescape(t[2]):null}function delCookie(e){var t=new Date;t.setTime(t.getTime()-1);var n=getCookie(e);n!=null&&(document.cookie=e+"="+n+";expires="+t.toGMTString()+";path=/;")}function privilegedOperation(e){c3.service.getCurrentPrivilegeHandler(function(t){if(t.d&&t.d.IsPrivilegeCredentialRemembered==1)e();else{var n=new c3enterDomainAdminCredentials(e);n.show()}})}function isHANA(e){return e&&e.substring(0,6)==ServerType.HANA_SERVER?!0:!1}function isMSSQL(e){return e&&e.substring(0,5)==ServerType.MSSQL_SERVER?!0:!1}function notSAML(){var e=window.SAML.names,t=window.SAML.values;if(t[0]===undefined&&t[2]===undefined)return!0;for(var n=0;n<e.length;n++)if(e[n]==="SAMLRedirect"&&typeof t[n]=="string"&&t[n].length>0)return t[n][0]==='"'&&(t[n]=t[n].substr(1,t[n].length-2)),location.href=t[n],!1;var r=document.createElement("form");r.setAttribute("method","post");var i=location.href.match(/locale=([^&]*)/);i!=null&&i.length>1?r.setAttribute("action","/sld/saml2/idp/sso?"+i[0]):r.setAttribute("action","/sld/saml2/idp/sso"),document.body.appendChild(r),r.style.display="none";for(var n=0;n<e.length;n++){var s=document.createElement("input");s.setAttribute("name",e[n]),s.setAttribute("value",t[n]),r.appendChild(s)}return r.submit(),!1}function gchartbase(e,t,n,r){function s(e,t,n){var r=e.params||{},i=this.getScaleGutter(r,this.getLabelAxis()=="x"),s=Array.prototype.concat.apply([],t),l=Array.prototype.concat.apply([],n),c=this.raphael.g.snapEnds(Math.min.apply(Math,s),Math.max.apply(Math,s),t[0].length-1),h=r.axismin&&r.axismin.x!=undefined?r.axismin.x:c.from,p=r.axismax&&r.axismax.x!=undefined?r.axismax.x:c.to,d=r.axisxstep?r.axisxstep:Math.floor((r.width-i[1]-i[3])/20),v=this.raphael.g.snapEnds(Math.min.apply(Math,s),Math.max.apply(Math,l),n[0].length-1),m=r.axismin&&r.axismin.y!=undefined?r.axismin.y:v.from,g=r.axismax&&r.axismax.y!=undefined?r.axismax.y:v.to,y=r.axisystep?r.axisystep:Math.floor((r.height-i[0]-i[2])/20);s_width=e.width-i[1]-i[3],s_height=e.height-i[0]-i[2],s_left=e.x+i[3],s_top=e.y+i[0],s_bottom=s_top+s_height,s_right=s_left+s_width,axis=this.raphael.set();if(r.axis){var b=r.axis;+b[0]?axis.push(this.raphael.g.axis(s_left,s_top,s_width,h,p,d,2,1)):axis.push(this.raphael.path()),+b[1]?axis.push(this.raphael.g.axis(s_right,s_top,s_height,m,g,y,3)):axis.push(this.raphael.path());if(b[2]){new_axis=this.raphael.g.axis(s_left,s_bottom,s_width,h,p,d,0),new_axis.attr(r.axisattr?r.axisattr:{}),r.aideLine==2&&f.call(this,new_axis,s_top,s_height,r.axisattr),this.getLabelAxis()=="x"?u.call(this,new_axis,r.labels,r.labelalign,"x"):o(new_axis.text);if(this.axisXTitle){var w=this.axisXTitle.css("font-family"),E=this.axisXTitle.css("font-size"),S=this.axisXTitle.css("font-style"),x=this.raphael.text(s_right,s_bottom,this.axisXTitle.text()).attr($.fn.gchart.defaults.txtattr).attr({"text-anchor":"start","font-family":w,"font-size":E,"font-style":S}),T=x.getBBox(),N=new_axis.text[new_axis.text.length-1],C=N.getBBox(),k=s_right-T.width,L=s_bottom+C.height+.8*T.height,A=-30;this.getLabelAxis()=="x"&&(A=0),x.attr({x:k,y:L}).rotate(A,k+T.width,L),this.axisXTitle.hide()}axis.push(new_axis)}else axis.push(this.raphael.path());if(b[3]){new_axis=this.raphael.g.axis(s_left,s_bottom,s_height,m,g,y,1,null," "),new_axis.attr(r.axisattr?r.axisattr:{}),this.getLabelAxis()!="x"&&u.call(this,new_axis,r.labels,r.labelalign,"y"),r.aideLine==3&&a.call(this,new_axis,s_left,s_width,r.axisattr);if(this.axisYTitle){var O=this.axisYTitle.height(),w=this.axisYTitle.css("font-family"),E=this.axisYTitle.css("font-size"),S=this.axisYTitle.css("font-style"),x=this.raphael.text(s_left,s_top,this.axisYTitle.text()).attr($.fn.gchart.defaults.txtattr).attr({"text-anchor":"start","font-family":w,"font-size":E,"font-style":S}),T=x.getBBox();x.attr({y:s_top-T.height*.5}),this.axisYTitle.hide()}axis.push(new_axis)}else axis.push(this.raphael.path())}e.x=s_left,e.y=s_top,e.width=s_width,e.height=s_height}function o(e){for(var t=0;e[t];t++){var n=e[t],r=n.getBBox();n.attr({x:r.x-.5*r.width,"text-anchor":"start",rotation:[-30,r.x+r.width*.5,r.y]})}}function u(e,t,n,r){var i=0,t=t||[];for(var s=0;e.text[s]&&t[s]!=undefined;s++)e.text[s].attr({text:t[s]}),s?n&&n=="center"&&(new_attr=(i+e.text[s].attr(r))*.5,i=e.text[s].attr(r),e.text[s].attr(r,new_attr)):i=e.text[s].attr(r)}function a(e,t,n,r){for(var i=0;e.text[i];i++)y=e.text[i].attr("y"),this.raphael.path(["M",t,y,"l",n,0]).attr(r||{stroke:"#000","stroke-width":1}).toBack()}function f(e,t,n,r){for(var i=0;e.text[i];i++)x=Math.ceil(e.text[i].attr("x")),this.raphael.path(["M",x,t,"l",0,n]).attr(r||{stroke:"#000","stroke-width":1}).toBack()}this.container=e,this.ds=t,this.opts=n,this.ready=!1,r!=undefined&&r.push(this),this.getParts=function(){var e=this.divchart||this.container.find(".chart"),t=this.container.find(".table");e.length||(e=$("<div>").addClass("chart"),this.container.append(e),this.divchart=e),n.bg&&e.css("backgroundColor",n.bg);if(this.opts.parts=="None")return;return this.ready=e[0].clientWidth>0?!0:!1,this.ready&&(this.raphael=new Raphael(e[0]),this.raphael.g.txtattr=$.fn.gchart.defaults.txtattr),this.ready};var i=function(){return $.fn.gchart.defaults.colors};this.colors=i(),this.drawLegend=function(){if(this.opts.legend!=undefined&&this.opts.legend=="None")return;var e=this.opts.legend?this.opts.legend.toLowerCase():"";if(!this.divchart.find(".legend").length){var t=!0,n=this.ds.getRows(),r=$("<ul>").addClass("legend").addClass(e);for(var i=0;n[i];i++){var s=$("<li>"),o=i%this.colors.length,u=$("<span>").css("backgroundColor",this.colors[o]).css("border-color",UIKit.getDarkerColor(this.colors[o]));s.append(u),s.append($("<label>").append(n[i].value)),r.append(s)}this.divchart.prepend(r),this.legend=r}},this.drawTitle=function(){if(!this.opts.title&&!this.opts.subtitle)return;if(!this.divchart.find(".title").length){var e=this.opts.title||"",t=this.opts.subtitle||"";if(e!=""||t!=""){var n=$("<h3>").addClass("title");this.opts.title_eval?n.append(this.opts.title_eval.call(this)):n.append(e),t.length>0&&n.append($("<span>").html(t)),this.divchart.prepend(n),this.title=n}}},this.drawAxisTitle=function(){if(this.opts.axisTitle==undefined)return;var e=this.title?this.title.outerHeight(!0):0,t=this.legend?this.legend.outerHeight(!0):0,n=this.opts.axisTitle;if(n[0]){var r=$("<label>").append(n[0]);r.css("bottom",t+5+"px").css("right","15px").addClass("axisTip"),this.divchart.append(r),this.axisXTitle=r}if(n[1]&&n[1].length){var i=$("<label>").append(n[1]);i.css("top",e+5+"px").css("left","15px").addClass("axisTip"),this.divchart.append(i),this.axisYTitle=i}},this.getBoxModel=function(){var e=this.divchart,t=parseInt(e.css("paddingLeft")),n=parseInt(e.css("paddingRight")),r=parseInt(e.css("paddingTop")),i=parseInt(e.css("paddingBottom")),s=(this.raphael?this.raphael.canvas.clientWidth||this.raphael.width:e.innerWidth())-(t+n),o=(this.raphael?this.raphael.canvas.clientHeight||this.raphael.height:e.innerHeight())-(r+i),u=15,a=15;return this.title&&(o-=this.title.outerHeight(!0)),this.legend&&(this.legend.hasClass("left")||this.legend.hasClass("right")?(this.legend.hasClass("left")&&(u+=this.legend.outerWidth(!0)),s-=this.legend.outerWidth(!0),this.legend.css("top",(this.container.innerHeight()-this.legend.innerHeight())/2)):o-=this.legend.outerHeight(!0)),{padding:{top:r,right:n,bottom:i,left:t},center:{x:s/2+t,y:o/2+r},x:u,y:a,width:s-30,height:o-25}},this.getScaleGutter=function(e,t){var n=e.axismax?e.axismax.x?e.axismax.x:0:0,r=e.axismin?e.axismin.x?e.axismin.x:0:0,i=e.axismax?e.axismax.y?e.axismax.y:0:0,s=e.axismin?e.axismin.y?e.axismin.y:0:0,o=e.txtattr||$.fn.gchart.defaults.txtattr,u=0,a=0,f=[];if(e.labels)for(var l=0;e.labels[l]!=undefined;l++)label=this.raphael.text(-1e3,-1e3,e.labels[l]).attr(o),box=label.getBBox(),box.width>u&&(u=box.width),box.height>a&&(a=box.height),label.remove();for(var c=0;e.axis&&e.axis[c]!=undefined;c++)e.axis[c]?c==1||c==3?t?(label=this.raphael.text(-1e3,-1e3,i+"").attr(o),f.push(label.getBBox().width+5),label.remove()):f.push(u+5):t?f.push(a+5+(this.axisXTitle?this.axisXTitle.innerHeight():5)):(label=this.raphael.text(-1e3,-1e3,n+"").attr(o),bound=label.getBBox(),f.push(bound.width*.5+bound.height+(this.axisXTitle?this.axisXTitle.innerHeight():5)),label.remove()):c==0&&t?(label=this.raphael.text(-1e3,-1e3,"test").attr(o),f.push(.5*label.getBBox().height),label.remove()):c==1&&t?f.push(.5*u):f.push(0);return f},this.isEmpty=function(){return this.ds.isEmpty()},this.draw=function(){},this.drawAxis=s,this.getLabelAxis=function(){return"x"},this.redraw=function(){this.chart=0,this.divchart.empty(),this.getParts()&&(this.drawLegend(),this.drawTitle(),this.drawAxisTitle(),this.boxModel=this.getBoxModel()),this.clearEvents(),this.onDraw(),this.registerEvents()},this.onDraw=function(){this.ready?this.draw():window.setTimeout(function(e){return function(){e.redraw()}}(this),1e3)},this.registerEvents=function(){if(this.opts.onselect)for(var e=0,t=this.opts.onselect.length;e<t;e++)this.ds.onselect.push(this.opts.onselect[e]);this.ds.onchange.push(function(e){return function(){e.redraw()}}(this));if(this.chart&&this.chart.onselect)this.chart.onselect.push(this.ds.selectedChange);else if(this.chart&&this.chart.length)for(var e=0;e<this.chart.length;e++){var n=this.chart[e];n.onselect&&n.onselect.push(this.ds.selectedChange)}},this.clearEvents=function(){this.ds.onchange.length=0},this.getParts()&&(this.drawLegend(),this.drawTitle(),this.drawAxisTitle(),this.boxModel=this.getBoxModel())}function garea(e,t,n,r){this.base=gchartbase,this.base(e,t,n,r),this.draw=function(){var e=this.ds.getRowdata(),t=this.ds.getColname(0,1),n=UIKit.getAxisScale(e),r=this.boxModel,i=this.ds.getColdata2(),s=$.fn.gchart.sort.call(i),o={x:r.x,y:r.y,width:r.width,height:r.height,params:{labels:t,axismin:{y:n.bottom},axismax:{x:s.pop(),y:n.top},axisystep:n.step,axisxstep:t.length-1,axisattr:$.fn.gchart.defaults.axisattr}},u=$.extend(!0,{},$.fn.garea.defaults,o,this.opts);this.drawAxis(u,i,e),this.raphael.g.colors=$.fn.gchart.getColors(this.ds),this.chart=new areachart(this.raphael,u.x,u.y,u.width,u.height,i,e,u.params)},this.isEmpty=function(){return this.ds.isEmpty(2)}}function gbar(e,t,n,r){this.base=gchartbase,this.base(e,t,n,r),this.draw=function(){var e=this.ds.getRowdataAt(0),t=this.ds.getRowname(),n=UIKit.getAxisScale(e),r=this.boxModel,i={x:r.x,y:r.y,width:r.width,height:r.height,params:{labels:[""].concat(t.reverse()),axismin:{x:n.bottom,y:0},axismax:{x:n.top,y:e.length},axisxstep:n.step,axisystep:e.length,axisattr:$.fn.gchart.defaults.axisattr}},s=$.extend(!0,{},$.fn.gbar.defaults,i,this.opts);this.drawAxis(s,[e],[[0,e.length]]),this.raphael.g.colors=$.fn.gchart.getColors(this.ds),this.chart=new barchart(this.raphael,s.x,s.y,s.width,s.height,e,s.params,s.events)},this.getLabelAxis=function(){return"y"}}function gcolumn(e,t,n,r){this.base=gchartbase,this.base(e,t,n,r),this.draw=function(){var e=this.ds.getRowdata(),t=this.ds.getColname(),n=this.ds.getColdata(),r=UIKit.getAxisScale(e),i=this.boxModel,s={x:i.x,y:i.y,width:i.width,height:i.height,params:{labels:t,axismin:{y:r.bottom},axismax:{y:r.top},to:r.top,axisystep:r.step,axisxstep:t.length-1==0?1:t.length-1,axisattr:$.fn.gchart.defaults.axisattr}},o=$.extend(!0,$.fn.gcolumn.defaults,s,this.opts);this.drawAxis(o,n,e),this.raphael.g.colors=$.fn.gchart.getColors(this.ds);try{this.chart=new columnchart(this.raphael,o.x,o.y,o.width,o.height,n,e,o.params)}catch(u){console.log(u)}}}function ghcolumn(e,t,n,r){this.base=gchartbase,this.base(e,t,n,r),this.draw=function(){var e=this.ds.getRowdata(),t=this.ds.getColname(0,1),n=UIKit.getAxisScale(e),r=this.boxModel,i={x:r.x,y:r.y,width:r.width,height:r.height,params:{labels:[""].concat(t.reverse()),axismin:{x:n.bottom},axismax:{x:n.top,y:t.length},axisxstep:n.step,axisystep:t.length,axisattr:$.fn.gchart.defaults.axisattr}},s=$.extend(!0,{},$.fn.ghcolumn.defaults,i,this.opts);this.drawAxis(s,e,[[0,e.length]]),this.raphael.g.colors=$.fn.gchart.getColors(this.ds);try{this.chart=new barchart(this.raphael,s.x,s.y,s.width,s.height,e,s.params,s.events)}catch(o){console.log(o)}},this.getLabelAxis=function(){return"y"}}function ghstackcolumn(e,t,n,r){this.base=gchartbase,this.base(e,t,n,r),this.draw=function(){var e=this.ds.getRowdata(),t=this.ds.getColname(0,1),n=UIKit.getAxisScale(e,1),r=this.boxModel,i={x:r.x,y:r.y,width:r.width,height:r.height,params:{labels:[""].concat(t.reverse()),axismin:{x:n.bottom},axismax:{x:n.top,y:t.length},axisxstep:n.step,axisystep:t.length,axisattr:$.fn.gchart.defaults.axisattr}},s=$.extend(!0,{},$.fn.ghstackcolumn.defaults,i,this.opts);this.drawAxis(s,e,[[0,e.length]]),this.raphael.g.colors=$.fn.gchart.getColors(this.ds),this.chart=new barchart(this.raphael,s.x,s.y,s.width,s.height,e,s.params,s.events)},this.getLabelAxis=function(){return"y"}}function gline(e,t,n,r){this.base=gchartbase,this.base(e,t,n,r),this.draw=function(){var e=this.ds.getRowdata(),t=this.ds.getColname(),n=UIKit.getAxisScale(e),r=this.boxModel,i=this.ds.getColdata(),s=$.fn.gchart.sort.call(i),o={x:r.x,y:r.y,width:r.width,height:r.height,params:{labels:t,axismin:{y:n.bottom},axismax:{x:s.pop()+1,y:n.top},axisystep:n.step,axisxstep:t.length-1==0?1:t.length-1,axisattr:$.fn.gchart.defaults.axisattr}},u=$.extend(!0,{},$.fn.gline.defaults,o,this.opts);this.drawAxis(u,i,e),this.raphael.g.colors=$.fn.gchart.getColors(this.ds),this.chart=new linechart(this.raphael,u.x,u.y,u.width,u.height,i,e,u.params)},this.isEmpty=function(){return this.ds.isEmpty(2)}}function glinecolumn(e,t,n,r){this.base=gchartbase,this.base(e,t,n,r),this.draw=function(){var e=this.ds.getRowdata(),t=this.ds.getColname(),n=this.boxModel,r=this.ds.getColdata(),i=$.fn.gchart.sort.call(r),s=UIKit.getAxisScale(e),o={x:n.x,y:n.y,width:n.width,height:n.height,params:{labels:t,axismin:{y:s.bottom},axismax:{x:i.pop()+1,y:s.top},axisystep:s.step,axisxstep:t.length-1,axisattr:$.fn.gchart.defaults.axisattr}},u=$.extend(!0,{},$.fn.glinecolumn.defaults,o,this.opts),a=$.fn.gchart.spliceData(this.ds,u.secondary,e);this.drawAxis(u,r,e),this.raphael.g.colors=$.fn.gchart.getColors(this.ds),this.chart=[],u.params.colors=a.pc;try{this.chart.push(new columnchart(this.raphael,u.x,u.y,u.width,u.height,r,a.pv,u.params))}catch(f){console.log(f)}u.params.colors=a.sc,a.sv.length&&this.chart.push(new linechart(this.raphael,u.x,u.y,u.width,u.height,r,a.sv,u.params))}}function gpie(e,t,n,r){this.base=gchartbase,this.base(e,t,n,r),this.draw=function(){var e=this.ds.getRowdataAt(0),t=this.boxModel,n=t.center.x,r=t.center.y,i=Math.floor(Math.min(t.width,t.height)/2),s={x:n,y:r,r:i},o=$.extend(!0,$.fn.gpie.defaults,s,this.opts);this.raphael.g.colors=$.fn.gchart.getColors(this.ds),this.chart=new piechart(this.raphael,o.x,o.y,o.r,e,o.params,o.events)}}function gstackarea(e,t,n,r){this.base=gchartbase,this.base(e,t,n,r),this.draw=function(){var e=this.ds.getRowdata(),t=this.ds.getColname(0,1),n=this.ds.getColdata2(),r=$.fn.gchart.sort.call(n),i=UIKit.getAxisScale(e,1),s=this.boxModel,o={x:s.x,y:s.y,width:s.width,height:s.height,params:{labels:t,axismin:{y:i.bottom},axismax:{x:r.pop(),y:i.top},axisystep:i.step,axisxstep:t.length-1,axisattr:$.fn.gchart.defaults.axisattr}},u=$.extend(!0,$.fn.gstackarea.defaults,o,this.opts);this.drawAxis(u,n,e),this.raphael.g.colors=$.fn.gchart.getColors(this.ds),this.chart=new stackareachart(this.raphael,u.x,u.y,u.width,u.height,n,e,u.params)}}function gstackcolumn(e,t,n,r){this.base=gchartbase,this.base(e,t,n,r),this.draw=function(){var e=this.ds.getRowdata(),t=this.ds.getColname(!1,!1),n=UIKit.getAxisScale(e,1),r=this.boxModel,i=this.ds.getColdata(),s={x:r.x,y:r.y,width:r.width,height:r.height,params:{labels:t,axismin:{y:n.bottom},axismax:{y:n.top},to:n.top,axisystep:n.step,axisxstep:t.length-1==0?1:t.length-1,axisattr:$.fn.gchart.defaults.axisattr}},o=$.extend(!0,$.fn.gstackcolumn.defaults,s,this.opts);this.drawAxis(o,i,e),this.raphael.g.colors=$.fn.gchart.getColors(this.ds),this.chart=new stackcolumnchart(this.raphael,o.x,o.y,o.width,o.height,i,e,o.params)}}function exportCSV(){function p(e,t){h.click(function(){if($(this).attr("checked")==1)s.chosenItems.push(e.name);else{s.ckAll.attr("checked",!1);for(var t=0;t<s.chosenItems.length;t++)if(s.chosenItems[t]==e.name){s.chosenItems.remove(t);break}}s.chosenItems.length==0?s.btnExport.attr("disabled",!0):s.btnExport.removeAttr("disabled"),s.chosenItems.length==n.length&&s.ckAll.attr("checked",!0)})}var e=arguments[0],t=arguments[1]||{},n=t.colList,r=t.data,i=380,s=this;s.chosenItems=[];var o=$("<section>").attr("class","gridPopup").css("width","250px"),u=$("<ul>").attr({"class":"dlist",multiple:!0}).css({margin:"0 0 0 8px"});if(n!=null&&n.length>0){var a=$("<input>").val("all").attr("type","checkbox"),f=$("<li>").addClass("dataList_spet_option").append(a).append(localizedString("ALL"));a.click(function(){s.chosenItems=[];var e=$(u).find('input[type="checkbox"]');if(e.size()>0)for(var t=0;t<e.length;t++){var n=e[t];$(n).val()=="inverse"?$(n).attr("checked",!1):$(n).val()!="all"&&($(this).attr("checked")?(s.chosenItems.push($(n).val()),$(n).attr("checked",!0)):$(n).attr("checked",!1))}s.chosenItems.length==0?s.btnExport.attr("disabled",!0):s.btnExport.removeAttr("disabled")}),u.append(f),s.ckAll=a;for(var l=0;l<n.length;l++){var c=$("<li>").addClass("dataList_option"),h=$("<input>").val(n[l].name).attr("type","checkbox");p(n[l],h),c.append(h).append(n[l].description),u.append(c)}}var d=$("<div>").attr("class","msgBar").html("&nbsp;"),v=$("<div>").css({"float":"right",margin:"10px 4px 0px 0px"}),m=$("<input>").attr({value:localizedString("EXPORT"),type:"button",id:"btnExport",disabled:!0}).click(function(){$(d).text("").attr("title","");if(s.chosenItems.length==0)return;if(!r||r==null||r.length==0)return;var e="";for(var t=0;t<s.chosenItems.length;t++){var i=(s.chosenItems[t]==null?"":s.chosenItems[t])+"";for(var o=0;o<n.length;o++)if(i==n[o].name){i=n[o].description,i=i.replace(/"/g,'""'),i="	"+i;break}if(!(t<s.chosenItems.length-1)){e+='"'+i+'"\\r\\n';break}e+='"'+i+'",'}for(var t=0;t<r.length;t++){var u=r[t];for(var a=0;a<s.chosenItems.length;a++){var i=(u[s.chosenItems[a]]==null?"":u[s.chosenItems[a]])+"";i=i.replace(/"/g,'""'),i="	"+i;if(!(a<s.chosenItems.length-1)){e+='"'+i+'"\\r\\n';break}e+='"'+i+'",'}}c3.service.exportCSV(e)});(!r||r==null||r.length==0)&&m.attr("disabled",!0),v.append(m),s.btnExport=m,o.append($("<div>").append(u)).append(v),n.length>0&&(i=34*(n.length+1),$(u).css("height",i+"px"));var g=$(e).popupManager(250,i+80,!0,localizedString("EXPORT_TLT"));return g.show(),g.append(o),o}function isJSON(e){var t=!1;try{var n=$.parseJSON(e);t=n!=null&&typeof n=="object"}catch(r){}return t}function requestError(e,t){e.status!="401"&&console.log(e.responseText)}function popupManager(e,t,n,r,i,s){var o=parseInt(document.documentElement.scrollWidth),u=parseInt(document.documentElement.scrollHeight),a=parseInt(document.body.clientHeight+document.body.clientTop),f=$("<section>").addClass("popup-window").attr({tabindex:0}),l=$("<section>").addClass("popup-window-arrow"),c=$("<hgroup>"),h=e.offset().left+e.width(),p=e.offset().top+e.height(),d=h+t-o>0?h-t:h,v=p+n-a>0?a-n-40:p,m=!0,g=this;e.attr("id")&&f.attr({id:e.attr("id")+"_popup"});if(i){c.append($("<h1>").append(i));if(r){var y=$("<a>").attr({href:"#"}).addClass("close").bind("click",function(){g.close()});c.append(y),f.bind("keyup",function(e){e.keyCode==27&&g.close()})}}f.append(c),s&&l.show(),f.show(),f.css({width:t+"px",height:n+"px",left:d+"px",top:v+"px"}),l.css({left:d+10+"px",top:v-5+"px"});var b=$("<div>").css({height:$(window).height(),width:$(window).width(),position:"absolute",left:0,top:0,background:"rgba(0,0,0,0)"}).attr({id:"mask"});$("body").css("overflow","hidden"),$("body").append(b),s&&$("body").append(l),$("body").append(f),$(window).resize(function(r){o=parseInt(document.documentElement.scrollWidth),u=parseInt(document.documentElement.scrollHeight);var i=parseInt(document.body.clientHeight+document.body.clientTop);h=e.offset().left+e.width(),p=e.offset().top+e.height(),d=h+t-o>0?h-t:h,v=p+n-i>0?i-n-40:p,f.css({width:t+"px",height:n+"px",left:d+"px",top:v+"px"}),l.css({left:d+10+"px",top:v-5+"px"})}),f.mousedown(function(e){e.stopPropagation()}),$(window).mousedown(function(e){g.close()}),this.close=function(){f.css("display","none"),b.css("display","none"),l.css("display","none"),m=!1},this.show=function(){f.css("display","block"),b.css("display","block"),l.css("display","block"),m=!0},this.moveLeft=function(e){f.css("left",d+e+"px")},this.getVisible=function(){return m},this.append=function(e){f.append(e)},this.remove=function(e){f.find(e).remove()}}function c3popwin(e,t,n,r,i,s){function C(e,t){t=Math.min(Math.max(t,0),$(window).height()-l.height()),e=Math.min(Math.max(e,0),$(window).width()-f.width()),f.css({left:e+"px",top:t+"px"})}var o=i||{},u=o.trans||0,a=o.close===undefined?!0:o.close,f=$("<section>").addClass("pop-win").attr({tabindex:0}),l=$("<hgroup>").append($("<h1>").append(r)),c=($(window).width()-t)/2,h=($(window).height()-n)/2,p=this,d=!1,v={left:0,top:0},m={left:0,top:0},g=o.offsetByExist==undefined||o.offsetByExist?$(".pop-win").length:0,y={width:0,height:0};e.attr("id")&&f.attr({id:e.attr("id")+"_pop"});if(r){f.append(l);if(a){var b=$("<a>").attr({href:"#"}).addClass("close").bind("click",function(){p.close(),s&&s()});l.append(b),f.bind("keyup",function(e){e.keyCode==27&&(s&&s(),p.close())})}}f.append($(e)),f.show(),f.css({width:t+"px",height:n+"px",left:c+g*15+"px",top:h+g*25+"px"});var w=0,E=0,S=0,x=0,T=$(".translog");o.maskRegion?(w=o.maskRegion.height(),E=o.maskRegion.width(),S=o.maskRegion.offset().top,x=o.maskRegion.offset().left):(w=$(window).height(),E=$(window).width());var N=$("<div>").css({height:w,width:E,position:"absolute",left:x,top:S,background:"rgba(0,0,0,0)"}).attr({id:"mask"});o.maskRegion?$(window).resize(function(){$("#subMask").css({height:o.maskRegion.height(),width:o.maskRegion.width(),top:o.maskRegion.offset().top,left:o.maskRegion.offset().left})}):$(window).resize(function(){$("#mask").css({height:$(window).height(),width:$(window).width()})}),l.mousedown(function(e){1==e.which&&(d=!0,m.left=e.pageX,m.top=e.pageY,v=f.position())}),l.mouseup(function(e){1==e.which&&(d=!1)}),$(window).mousemove(function(e){d&&C(v.left+(e.pageX-m.left),v.top+(e.pageY-m.top))}),l.mouseenter(function(){l.css("cursor","move")}),$("body").css("overflow","hidden"),$("body").append(N),$("body").append(f);var k=f.find("select,input,textarea").filter(function(){return!$(this).attr("disabled")})[0];k?k.focus():f.focus(),u&&f.addClass("pop-animation"),this.close=function(){N.remove();var e="translateY("+($(window).height()-h)+"px)";f.css({"-moz-transform":e,"-webkit-transform":e,transform:e}),window.setTimeout(function(){f.remove()},u?1100:10)},this.append=function(e){f.append(e)}}function setSelectState(e){var t=document.getElementsByTagName("select");for(var n=0;n<t.length;n++)t[n].style.visibility=e}function mousePosition(e){return e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:{x:e.clientX+document.body.scrollLeft-document.body.clientLeft,y:e.clientY+document.body.scrollTop-document.body.clientTop}}function showMessageBox(e,t,n,r,i,s,o){closeWindow(),isIe&&setSelectState("hidden");var u=parseInt(document.documentElement.scrollWidth),a=parseInt(document.documentElement.scrollHeight),f=parseInt(document.body.clientHeight+document.body.clientTop),l=$("<div>").attr({id:"mesWindow"}).addClass("mesWindow").css({left:""+(i.x-s>0?i.x-s:i.x)+"px",top:""+(i.y+o-f>0?f-o:i.y)+"px",position:"absolute",width:""+s+"px"}),c=$("<div>").addClass("mesWindowTop"),h=$("<div>").css({"float":"right",cursor:"pointer"}).addClass("close").bind("click",function(){closeWindow()}),p=$("<div>").addClass("popup_icon"),d=$("<div>").attr({id:"mesWindowContent"}).addClass("mesWindowContent"),v=$("<div>").addClass("mesWindowStatusContainer"),m=$("<div>").addClass("mesWindowBtnContainer"),g=$("<div>").addClass("mesWindowBottom");p.append(e),d.append(t),v.append(n),m.append(r),c.append(h),l.append(c).append(p).append(d).append(v).append(m).append(g),$("body").append(l)}function closeWindow(){document.getElementById("mesWindow")!=null&&document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow")),isIe&&setSelectState("")}function MessageBox_SWRepository(e){var t=localizedString("STATUS_EXIST"),n=localizedString("STATUS_NOTEXIST"),r=0,i=0;c3.service.getSWRepositories().count().query(function(t){var n=t.data,r=mousePosition(e),i=localizedString("SOFTWAREREPO"),s=localizedString("SOFTWAREREPO_INTRODUCE"),o=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+i+" "+s+"</div>",messIcon="<div><div class='icon_SWRepository'></div><div class='icon_title'>"+i+"</div></div>",status="<div><label class='ShowIcon Online' title='Available'>"+n+"</label></div>",register="<input type='button' value="+o+" onclick='createSWRepository(self)'>",showMessageBox(messIcon,messContent,status,register,r,360,250)})}function createSWRepository(){var e=new c3newSWRepository;e.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function MessageBox_DBInstance(e){var t=localizedString("STATUS_ONLINE"),n=localizedString("STATUS_OFFLINE"),r=localizedString("STATUS_MAINTENANCE"),i=0,s=0,o=0;c3.service.getDBServerInstances().filter("Status eq 'Online'").count().query(function(r){var i=r.data;c3.service.getDBServerInstances().filter("Status eq 'Offline'").count().query(function(r){var s=r.data,o=mousePosition(e),u=localizedString("RES_MS_SQL"),a=localizedString("DBINSTANCE_INTRODUCE"),f=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+u+" "+a+"</div>",messIcon="<div><div class='icon_DBInstance'></div><div class='icon_title'>"+u+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+i+"</label><label class='ShowIcon Offline' title='"+n+"'>"+s+"</label></div>",register="<input type='button' value="+f+" onclick='createMSSqlInstance(self)'>",showMessageBox(messIcon,messContent,status,register,o,360,250)})})}function createMSSqlInstance(){var e=new c3registerMSSql;e.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function MessageBox_SBOCOMMON(e){var t=localizedString("STATUS_ONLINE"),n=localizedString("STATUS_OFFLINE"),r=localizedString("STATUS_MAINTENANCE"),i=0,s=0,o=0;c3.service.getCommonDBs().filter("Status eq 'Online'").count().query(function(r){var i=r.data;c3.service.getCommonDBs().filter("Status eq 'Offline'").count().query(function(r){var s=r.data,o=mousePosition(e),u=localizedString("RES_SBO_COMMON"),a=localizedString("SBO_COMMON_INTRODUCE"),f=localizedString("MISC_REGISTER");createTxt=localizedString("MISC_CREATE"),messContent="<div class='mesContent'>"+u+" "+a+"</div>",messIcon="<div><div class='icon_SBOCOMMON'></div><div class='icon_title'>"+u+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+i+"</label><label class='ShowIcon Offline' title='"+n+"'>"+s+"</label></div>",register="<div><input type='button' value="+f+" onclick='registerCommonDB(self);'><input type='button' style='float:right' value="+createTxt+" onclick='createCommonDB(self);'></div>",showMessageBox(messIcon,messContent,status,register,o,360,250)})})}function createCommonDB(){var e=new c3newSBOCommon;e.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function registerCommonDB(e){var t=new c3registerSBOCommon;t.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function MessageBox_LicenseServer(e){var t=localizedString("STATUS_ONLINE"),n=localizedString("STATUS_OFFLINE"),r=localizedString("STATUS_MAINTENANCE"),i=0,s=0,o=0;c3.service.getLicenseServers().filter("Status eq 'Online'").count().query(function(r){var i=r.data;c3.service.getLicenseServers().filter("Status eq 'Offline'").count().query(function(r){var s=r.data,o=mousePosition(e),u=localizedString("RES_LIC_SERVER"),a=localizedString("LIC_SERVER_INTRODUCE"),f=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+u+" "+a+"</div>",messIcon="<div><div class='icon_LicenseServer'></div><div class='icon_title'>"+u+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+i+"</label><label class='ShowIcon Offline' title='"+n+"'>"+s+"</label></div>",register="<input type='button' value="+f+" onclick='createLicenseServer(self)'>",showMessageBox(messIcon,messContent,status,register,o,360,250)})})}function createLicenseServer(){var e=new c3registerLicenseServer;e.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function MessageBox_PresentationServer(e){var t=localizedString("STATUS_ONLINE"),n=localizedString("STATUS_OFFLINE"),r=localizedString("STATUS_MAINTENANCE"),i=0,s=0,o=0;c3.service.getPresentationServers().filter("Status eq 'Online'").count().query(function(r){var i=r.data;c3.service.getPresentationServers().filter("Status eq 'Offline'").count().query(function(r){var s=r.data,o=mousePosition(e),u=localizedString("RES_PRESENTATION_SERVER"),a=localizedString("PRESENTATION_SERVER_INTRODUCE"),f=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+u+" "+a+"</div>",messIcon="<div><div class='icon_PresentationServer'></div><div class='icon_title'>"+u+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+i+"</label><label class='ShowIcon Offline' title='"+n+"'>"+s+"</label></div>",register="<input type='button' value="+f+" onclick='createPresentationServer(self)'>",showMessageBox(messIcon,messContent,status,register,o,360,250)})})}function createPresentationServer(){var e={};e.reload=function(){};var t=new c3registerPresServer(e);t.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function MessageBox_B1i(e){var t=localizedString("STATUS_ONLINE"),n=localizedString("STATUS_OFFLINE"),r=localizedString("STATUS_MAINTENANCE"),i=0,s=0,o=0;c3.service.getB1iServers().filter("Status eq 'Online'").count().query(function(r){var i=r.data;c3.service.getB1iServers().filter("Status eq 'Offline'").count().query(function(r){var s=r.data,o=mousePosition(e),u=localizedString("RES_B1I_SERVER"),a=localizedString("B1I_SERVER_INTRODUCE"),f=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+u+" "+a+"</div>",messIcon="<div><div class='icon_B1i'></div><div class='icon_title'>"+u+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+i+"</label><label class='ShowIcon Offline' title='"+n+"'>"+s+"</label></div>",register="<input type='button' value="+f+" onclick='createB1iServer()'>",showMessageBox(messIcon,messContent,status,register,o,360,250)})})}function MessageBox_B1a(e){var t=localizedString("STATUS_ONLINE"),n=localizedString("STATUS_OFFLINE"),r=localizedString("STATUS_MAINTENANCE"),i=0,s=0,o=0;c3.service.getB1aServers().filter("Status eq 'Online'").count().query(function(r){var i=r.data;c3.service.getB1aServers().filter("Status eq 'Offline'").count().query(function(r){var s=r.data,o=mousePosition(e),u=localizedString("RES_B1AH_SERVER"),a=localizedString("B1I_SERVER_INTRODUCE"),f=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+u+" "+a+"</div>",messIcon="<div><div class='icon_ANALITICS'></div><div class='icon_title'>"+u+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+i+"</label><label class='ShowIcon Offline' title='"+n+"'>"+s+"</label></div>",register="<input type='button' value="+f+" onclick='createB1aServer()'>",showMessageBox(messIcon,messContent,status,register,o,360,250)})})}function createB1aServer(){var e=new c3B1AHRegister(parent);e.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function createB1iServer(){var e=new c3registerB1i;e.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function MessageBox_SharedFolder(e){var t=localizedString("STATUS_AVAILABLE"),n=0,r=this;parent=r.parent,c3.service.getSharedFolders().count().query(function(n){var r=n.data,i=mousePosition(e),s=localizedString("RES_SH_FOLDER"),o=localizedString("RES_FOLDER_INTRODUCE"),u=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+s+" "+o+"</div>",messIcon="<div><div class='icon_SharedFolder'></div><div class='icon_title'>"+s+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+r+"</label></div>",register="<input type='button' value="+u+" onclick='createSharedFolder()'>",showMessageBox(messIcon,messContent,status,register,i,360,250)})}function createSharedFolder(){var e=new c3registerB1Share("SharedFolder");e.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function MessageBox_TenantsStorage(e){var t=localizedString("STATUS_AVAILABLE"),n=0,r=this;parent=r.parent,c3.service.getTenantsStorages().count().query(function(n){var r=n.data,i=mousePosition(e),s=localizedString("RES_TENANTS_STORAGE"),o=localizedString("RES_TENANTS_STORAGE_INTRODUCE"),u=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+s+" "+o+"</div>",messIcon="<div><div class='icon_SharedFolder'></div><div class='icon_title'>"+s+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+r+"</label></div>",register="<input type='button' value="+u+" onclick='createTenantsStorage()'>",showMessageBox(messIcon,messContent,status,register,i,360,250)})}function createTenantsStorage(){var e=new c3registerB1Share("TenantsStorage");e.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function createMailerService(){var e=new c3registerMailer;e.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function MessageBox_SharedFolderB1(e){var t=localizedString("STATUS_EXIST"),n=localizedString("STATUS_NOTEXIST"),r=0,i=0;c3.service.getB1SharedFolders().filter("Status eq 'Available'").count().query(function(n){var r=n.data,i=mousePosition(e),s=localizedString("RES_B1_FOLDER"),o=localizedString("RES_B1_FOLDER_INTRODUCE"),u=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+s+" "+o+"</div>",messIcon="<div><div class='icon_SharedFolder'></div><div class='icon_title'>"+s+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+r+"</label></div>",register="<input type='button' value="+u+" onclick='createB1SharedFolder(self)'>",showMessageBox(messIcon,messContent,status,register,i,360,250)})}function MessageBox_SharedFolderBackup(e){var t=localizedString("STATUS_EXIST"),n=localizedString("STATUS_NOTEXIST"),r=0,i=0;c3.service.getBackupRepositories().filter("Status eq 'Available'").count().query(function(n){var r=n.data,i=n.data,s=mousePosition(e),o=localizedString("RES_SHARED_TYPE_DBBACK"),u=localizedString("RES_SHARED_TYPE_DBBACK_INTRODUCE"),a=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+o+" "+u+"</div>",messIcon="<div><div class='icon_SharedFolder'></div><div class='icon_title'>"+o+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+r+"</label></div>",register="<input type='button' value="+a+" onclick='createSharedFolderDBBackup(self)'>",showMessageBox(messIcon,messContent,status,register,s,360,250)})}function MessageBox_ImplRepository(e){var t=localizedString("STATUS_ONLINE"),n=localizedString("STATUS_OFFLINE"),r=localizedString("STATUS_MAINTENANCE"),i=0,s=0,o=0,u=this;parent=u.parent,c3.service.getImplementationRepositories().filter("Status eq 'Available'").count().query(function(n){var r=n.data,i=n.data,s=mousePosition(e),o=localizedString("RES_IMPL_RSTY"),u=localizedString("RES_IMPL_REPOSITORY"),a=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+o+" "+u+"</div>",messIcon="<div><div class='icon_SharedFolder'></div><div class='icon_title'>"+o+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+r+"</label></div>",register="<input type='button' value="+a+" onclick='createImplRepository()'>",showMessageBox(messIcon,messContent,status,register,s,360,250)})}function MessageBox_CompanyTemplateRepository(e){var t=localizedString("STATUS_ONLINE"),n=localizedString("STATUS_OFFLINE"),r=localizedString("STATUS_MAINTENANCE"),i=0,s=0,o=0,u=this;parent=u.parent,c3.service.getCompanyTemplateRepositories().filter("Status eq 'Available'").count().query(function(n){var r=n.data,i=n.data,s=mousePosition(e),o=localizedString("RES_CPY_TEMP_RSTY"),u=localizedString("RES_CPY_TEMP_REPOSITORY"),a=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+o+" "+u+"</div>",messIcon="<div><div class='icon_SharedFolder'></div><div class='icon_title'>"+o+"</div></div>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+r+"</label></div>",register="<input type='button' value="+a+" onclick='createCompanyTemplateRepository()'>",showMessageBox(messIcon,messContent,status,register,s,360,250)})}function createImplRepository(e){var t="ImplementationRepository",n=new c3registerB1Share(t,e);n.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function createCompanyTemplateRepository(e){var t="CompanyTemplateRepository",n=new c3registerB1Share(t,e);n.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function createB1SharedFolder(){var e="SBOSharedFolder",t=new c3registerB1Share(e);t.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function createSharedFolderDBBackup(){var e="BackupRepository",t=new c3registerB1Share(e);t.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function MessageBox_HU(e){var t=localizedString("STATUS_ONLINE"),n=localizedString("STATUS_OFFLINE"),r=localizedString("STATUS_MAINTENANCE"),i=0,s=0,o=0;c3.service.getHostingUnits().filter("Status eq 'Online'").count().query(function(r){var i=r.data;c3.service.getHostingUnits().filter("Status eq 'Offline'").count().query(function(r){var s=r.data,o=mousePosition(e),u=localizedString("HOSTUNIT"),a=localizedString("HOSTUNIT_INTRODUCE"),f=localizedString("MISC_REGISTER");messContent="<div class='mesContent'>"+u+" "+a+"</div>",messIcon="<div><div class='icon_HU'></div><div class='icon_title'>"+u+"</div></div>",register="<input type='button' value="+f+" onclick='createHU(self)'>",status="<div><label class='ShowIcon Online' title='"+t+"'>"+i+"</label><label class='ShowIcon Offline' title='"+n+"'>"+s+"</label></div>",showMessageBox(messIcon,messContent,status,register,o,360,250)})})}function createHU(e){e.reload=function(){};var t=new c3huwizard(e);t.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function MessageBox_Tenant(e){function s(e){i.empty(),i.append(e.data)}var t=localizedString("STATUS_ONLINE"),n=localizedString("STATUS_OFFLINE"),r=localizedString("STATUS_MAINTENANCE"),i=$("<label>");c3.service.getTenants().count().query(s);var o=mousePosition(e),u=localizedString("TENANT"),a=localizedString("TENANT_INTRODUCE"),f="<div class='mesContent'>"+u+" "+a+"</div>";regTxt=localizedString("MISC_REGISTER"),messIcon="<div><div class='icon_Tenant'></div><div class='icon_title'>"+u+"</div></div>",register="<div><label class='ShowIcon Online' title='"+t+"'>"+i+"</label><label class='ShowIcon Offline' title='"+n+"'></label></div>",showMessageBox(messIcon,f,register,o,360,250)}function createTenant(e){var t=new c3newTenant(e);t.show(),document.getElementById("back").parentNode.removeChild(document.getElementById("back")),document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}function c3tab(e,t,n){function h(){a=s<o?-1:1,f=$(r[s]),l=$(r[o]),u==1?d():u==2?p():u==3&&v()}function p(){transform="translateX("+ -1*a*$(window).width()+"px)",l.css({"-moz-transform":transform,"-webkit-transform":transform}),l.addClass("tabNextAnim"),f.hide(),l.show(),window.setTimeout(function(){var e="translateX(0)";l.css({"-moz-transform":e,"-webkit-transform":e})},10),window.setTimeout(function(){l.removeClass("tabNextAnim")},1e3)}function d(){transform="translateY("+ -1*$(window).height()+"px)",l.css({"-moz-transform":transform,"-webkit-transform":transform}),l.addClass("tabNextAnim"),f.hide(),l.show(),window.setTimeout(function(){var e="translateY(0)";l.css({"-moz-transform":e,"-webkit-transform":e})},10),window.setTimeout(function(){l.removeClass("tabNextAnim")},1e3)}function v(){var e="scaleY(0.1) translateY(-80px)";l.css({"-moz-transform":e,"-webkit-transform":e,"-moz-transform-origin":"center 20%","-webkit-transform-origin":"center 20%"}),l.addClass("tabNextAnim"),f.hide(),l.show(),window.setTimeout(function(){var e="scaleY(1) translateY(0)";l.css({"-moz-transform":e,"-webkit-transform":e})},10),window.setTimeout(function(){l.removeClass("tabNextAnim")},1e3)}function m(){var e=$(r[o]);if(!(u>0)){e.show();return}e.addClass("tabNextAnim");var t=null;u==1?t="translateY("+ -1*$(window).height()+"px)":u==2&&(t="translateX("+ -1*a*$(window).width()+"px)"),e.css({"-moz-transform":t,"-webkit-transform":t}),e.addClass("tabNextAnim"),window.setTimeout(function(){e.show();var t=u==1?"translateY(0)":"translateX(0)";e.css({"-moz-transform":t,"-webkit-transform":t})},10),window.setTimeout(function(){e.removeClass("tabNextAnim")},1e3),$(r[o]).show()}var r=$(t),n=n||{},i=[],s=-1,o=-1,u=n.trans||0,a=-1,f=null,l=null;r.hide();for(var c=0;c<e.length;c++)$(e[c]).click(function(){o=$.inArray(this,e);if(s!=o){e.removeClass("selected"),$(this).addClass("selected"),u==0?($(r[s]).hide(),$(r[o]).show()):h();for(var t=0;t<i.length;t++)i[t](o,s);s=o}});n.dfltIdx!=undefined&&$(e[n.dfltIdx]).click(),this.onSelectEvent=i,this.select=function(t){t<e.length&&$(e[t]).click()},this.getCurrentTabIndex=function(){return o},this.getTabsCount=function(){return e.length},this.setTransitionType=function(e){}}function searchbox(e){var t=e||{},n=t.inputCallback||{},r=t.type||"text",i=$("<input>").attr({type:r}).addClass("search"),s=t.maxlength;return s&&i.attr("maxlength",s),i.bind("input",function(){n&&n(this.value)}),this.attr=function(e){return i.attr(e)},this.removeAttr=function(e){i.removeAttr(e)},this.val=function(){if(!(arguments.length>0))return i.val();i.val(arguments[0])},this.css=function(e){i.css(e)},this.addClass=function(e){i.addClass(e)},this.removeClass=function(e){i.removeClass(e)},this.bind=function(e,t){return i.bind(e,t)},i}function textbox(e){function h(e){$(e).append(n)}function p(){var e=!1;return i[0].validity&&(!o||$.trim(i.val())!="")?(e=i[0].validity.valid,i[0].validity.valueMissing?d(textbox.validityMessages.valueMissing):i[0].validity.patternMismatch&&d(textbox.validityMessages.patternMismatch)):o&&$.trim(i.val())==""?d(textbox.validityMessages.valueMissing):f&&!(new RegExp(f)).test(i.val())&&d(textbox.validityMessages.patternMismatch),e&&n.removeClass("invalid"),e}function d(e){n.addClass("invalid"),s.html(e),s.css({left:i.offset().left,top:i.offset().top+20}),$("body").append(s),window.setTimeout(function(){$(window).bind("mousedown keydown",v)},500)}function v(){$(window).unbind("mousedown keydown",v),s.remove()}var t=e||{},n=$("<div>").addClass("txt_box_wrap"),r=t.type||"text",i=$("<input>").attr({type:r}),s=$("<div>").addClass("error_bubble"),o=t.isRequired||!1,u=t.isReadonly||!1,a=t.isDisabled||!1,f=t.pattern,l=t.maxlength,c=localizedString("MISC_REQUIRED");n.append(i),o&&(i.attr("required",!0),i.attr("placeholder",c)),u&&i.attr({readonly:"readonly"}),a&&i.attr({disabled:"disabled"}),f&&i.attr("pattern",f),l&&i.attr("maxlength",l),i.bind("focus",function(){n.removeClass("invalid")}),this.placeAt=h,this.attr=function(e){return i.attr(e)},this.removeAttr=function(e){i.removeAttr(e)},this.val=function(){if(!(arguments.length>0))return i.val().trim();i.val(arguments[0])},this.change=function(e){i.change(e)},this.blur=function(e){i.blur(e)},this.css=function(e){i.css(e)},this.addClass=function(e){i.addClass(e)},this.removeClass=function(e){i.removeClass(e)},this.bind=function(e,t){return i.bind(e,t)},this.checkValidity=p,this.getValidity=function(){return i[0].validity},this.setCustomValidity=function(e){i[0].setCustomValidity(e)},this.showErrorMessage=d,this.searchHelper=function(e,t){var r=i.searchHelper(e,t);return r.selection=function(e){n.removeClass("invalid")},r},this.datepicker=function(e){return i.datepicker(e)}}function dropdownlist(e){function u(e){$(e).append(t)}function a(){var e=!1;return s&&!n.val()?f(textbox.validityMessages.valueMissing):e=!0,e&&t.removeClass("invalid"),e}function f(e){t.addClass("invalid"),r.html(e),r.css({left:n.offset().left,top:n.offset().top+20}),$("body").append(r),window.setTimeout(function(){$(window).bind("mousedown keydown",l)},500)}function l(){$(window).unbind("mousedown keydown",l),r.remove()}var t=$("<div>").addClass("dropdown_list_wrap"),n=$("<select>"),r=$("<div>").addClass("error_bubble"),i=e||{},s=i.isRequired||!1;t.append(n);var o=i.newHandler;n.bind("focus",function(){t.removeClass("invalid")}),this.placeAt=u,this.attr=function(e){n.attr(e)},this.val=function(){if(!(arguments.length>0))return n.val();n.val(arguments[0])},this.txt=function(){return n.find("option:selected").text()},this.css=function(e){n.css(e)},this.addClass=function(e){n.addClass(e)},this.removeClass=function(e){n.removeClass(e)},this.find=function(e){return n.find(e)},this.append=function(e){return n.append(e)},this.bind=function(e,t){return n.bind(e,t)},n.change(function(){o&&$(this).val()=="new"&&o()}),this.checkValidity=a,this.showErrorMessage=f}function dataform(){function p(){var e=v();if(n.getAllowEdit){var t=n.getAllowEdit();t||e.css({display:"none"})}s.append(e),a=g(),s.append(a)}function d(){a.empty(),a=g(),s.append(a)}function v(){var e=$("<div>").addClass("tools"),r=[];n.getToolbarItems&&(r=n.getToolbarItems());var s={id:"edit",text:localizedString("DATAFORM_EDIT"),type:"button"};r.unshift(s);var u=[{id:"save",text:localizedString("DATAFORM_SAVE"),type:"button"},{id:"cancel",text:localizedString("DATAFORM_CANCEL"),type:"button"}];r=r.concat(u);for(var a=0;a<r.length;a++){var f=r[a],l=null;f.render?l=f.render():(l=$("<input>").attr({id:f.id,value:f.text,type:f.type}),i[f.id]=l),o[f.id]=l,e.append(l);switch(f.id){case"edit":l.attr({disabled:1}),l.click(function(){b()});break;case"save":l.css({display:"none"}),l.click(function(){w()});break;case"cancel":l.css({display:"none"}),l.click(function(){E()});break;default:l.click(f.handler)}}return t.hideToolbar!==undefined&&t.hideToolbar==1?null:e}function m(e){var t={data:f,colName:e.binding},r=null;return n.getViewContent&&(r=n.getViewContent.call(t),r!=null&&r.attr({id:e.id})),r}function g(){var e=$("<section>").addClass("content");if(n.getColumns){var t=n.getColumns();for(var i=0;i<t.length;i++){var s=t[i],o=$("<div>").addClass("group");for(var u=0;u<s.length;u++){var a=s[u],f=$("<div>").addClass(a["class"]),l=null,c=m(a);switch(a.type){case"select":var h=$("<label>").attr({title:a.text}).append(a.text+": ");f.append(h),l=$("<select>").attr({id:a.id,"class":a.controlClass}),a.readonly&&l.attr({readonly:1}),a.rows!==undefined&&l.attr({rows:a.rows}),f.append(l);break;case"textarea":var h=$("<label>").attr({title:a.text}).append(a.text+": ");f.append(h),l=$("<textarea>").attr({id:a.id,"class":a.controlClass}),$(l).bind("change",function(e){return function(){r[e]=$(this).val().trim()}}(a.binding)),a.readonly&&l.attr({readonly:1}),a.rows!==undefined&&l.attr({rows:a.rows}),f.append(l);break;case"text":case"password":var h=$("<label>").attr({title:a.text}).append(a.text+": ");f.append(h),l=$("<input>").attr({id:a.id,type:a.type}),a.type=="password"&&l.attr({placeholder:"********"}),$(l).bind("change",function(e){return function(){r[e]=$(this).val().trim()}}(a.binding)),a.readonly&&l.attr({readonly:1}),a.rows!==undefined&&l.attr({rows:a.rows}),f.append(l);break;case"label":var h=$("<label>").attr({title:a.text}).append(a.text+": ");f.append(h),l=$("<label>").attr({id:a.id}),$(l).bind("change",function(e){return function(){r[e]=$(this).val().trim()}}(a.binding)),a.readonly&&l.attr({readonly:1}),a.rows!==undefined&&l.attr({rows:a.rows}),c==null?f.append(l):f.append(c);break;case"button":var h=$("<label>");f.append(h),l=$("<input>").attr({id:a.id,type:"button",value:a.text}),l.click(a.handler),a.readonly&&l.attr({disabled:1}),a.rows!==undefined&&l.attr({rows:a.rows}),f.append(l);break;case"radio":case"checkbox":var h=$("<label>");f.append(h),l=$("<input>").attr({id:a.id,type:a.type}),$(l).bind("change",function(e){return function(){r[e]=$(this).val()}}(a.binding)),a.readonly&&l.attr({disabled:1}),a.rows!==undefined&&l.attr({rows:a.rows}),f.append(l),f.append(a.text)}a.divcss!==undefined&&f.css(a.divcss),o.append(f)}e.append(o)}}return e}function y(){if(n.getColumns){var e=n.getColumns();$.each(e,function(e,t){$.each(t,function(e,t){var n="";f!==undefined&&(n=parse(f[t.binding]));switch(t.type){case"button":break;case"label":a.find("#"+t.id).text(n).attr({title:n});break;case"radio":case"checkbox":a.find("#"+t.id).attr({checked:n});break;case"select":var r=a.find("#"+t.id);r.find("option").remove();if(n.length>0)for(var i=0;i<n.length;i++)r.append($("<option>").attr({id:i}).append(n[i]));break;default:a.find("#"+t.id).attr({value:n})}var s=m(t);s!=null&&a.find("#"+t.id).replaceWith(s)})})}$.isEmptyObject(f)?i.getToolbarItem("edit").attr({disabled:1}):i.getToolbarItem("edit").attr({disabled:0})}function b(){for(var e=0;e<l.length;e++)l[e](f);r={},r.ID=f.ID,i.changeMode(1);if(n.getColumns){var t=n.getColumns();$.each(t,function(e,t){$.each(t,function(e,t){if(t.editable&&t.editSetting!==undefined&&t.editSetting!==null){var n=null;switch(t.editSetting.controlType){case"select":n=$("<select>").bind("change",function(){r[t.binding]=$(this).val()});for(var i=0;i<t.editSetting.data.length;i++){var s=$("<option>").attr({value:t.editSetting.data[i].value}).append(t.editSetting.data[i].text);f[t.bindingValue]&&f[t.bindingValue]==t.editSetting.data[i].value?s.attr({selected:!0}):f[t.binding]==t.editSetting.data[i].value&&s.attr({selected:!0}),n.append(s)}}a.find("#"+t.id).replaceWith(n.attr({id:t.id}))}})})}for(var e=0;e<c.length;e++)c[e](f)}function w(){i.submit(r,function(e){e&&(i.changeMode(0),S())})}function E(){i.changeMode(0),y();for(var e=0;e<h.length;e++)h[e](f)}function S(){if(n.getColumns){var e=n.getColumns();$.each(e,function(e,t){$.each(t,function(e,t){if(t.editSetting!==undefined&&t.editSetting!==null){var n=null;switch(t.type){case"text":n=$("<input>").attr({type:"text",readOnly:t.readonly,value:f[t.binding]});break;case"label":n=$("<label>").attr({readOnly:t.readonly}).append(f[t.binding])}var r=m(t);r!=null?a.find("#"+t.id).replaceWith(r):n!=null&&a.find("#"+t.id).replaceWith(n.attr({id:t.id}))}})})}}function x(e){if(n.getColumns){var t=n.getColumns();$.each(t,function(t,n){$.each(n,function(t,n){if(n.editable)switch(n.type){case"text":case"textarea":case"password":a.find("#"+n.id).attr({readonly:e});break;case"checkbox":e?a.find("#"+n.id).attr({disabled:1}):a.find("#"+n.id).removeAttr("disabled")}})})}}var e=arguments[0],t=arguments[1]||{},n=t.delegate,r={},i=this,s=$("<section>").addClass("dataform"),o={},u={},a=null,f={},l=[],c=[],h=[];i.mode=0,i.changeMode=function(e){if(i.mode!=e){i.mode=e;switch(e){case 0:for(var t in o)t=="save"||t=="cancel"?o[t].css({display:"none"}):o[t].css({display:"inline"});S();break;case 1:for(var t in o)t=="save"||t=="cancel"?o[t].css({display:""}):o[t].css({display:"none"})}x(!e)}},i.getToolbarItem=function(e){return o[e]},i.getToolbar=function(){return o},i.submit=function(e){},i.setDataSource=function(e){f=e},i.disableEdit=function(){i.edit&&$(i.edit).attr("disabled",1)},i.enableEdit=function(){i.edit&&$(i.edit).removeAttr("disabled")},i.beforeEdit=l,i.afterEdit=c,i.afterCancel=h,i.getControl=function(e){return a.find("#"+e)},i.dataBind=y,i.show=p,i.getDataSource=function(){return f},i.getForm=function(){return s},e&&(p(),$(e).append(s))}function c3progress(e,t,n){function T(){C()&&g.setValue(t())}function N(){C()&&t.call(g)}function C(){var e=!0;return!d&&a>=o?(c&&clearInterval(c),e=!1):d&&a<=0&&(c&&clearInterval(c),e=!1),e}function k(){var e="";for(var t=1;t<=32;t++){var n=Math.floor(Math.random()*16).toString(16);e+=n;if(t==8||t==12||t==16||t==20)e+="-"}return e}function L(){S.text(""),m?f==2?r.addClass("done"):f==3?r.addClass("failed"):f==4&&r.addClass("warning"):r.addClass("no_status_icon"),v&&w.css({visibility:"hidden"});var e={value:a,status:f};for(var t=0,n=b.length;t<n;t++)b[t](e)}var r=$("<span>").addClass("progress_wrap"),n=n||{},i=n.width||166,s=n.height||15,o=n.max||100,u=n.visibility==undefined?"visible":n.visibility,a=n.value||0,f=0,l=n.dur?n.dur*1e3:5e3,c=null,h=n.label||"",p=n.async||!1,d=n.back||!1,v=n.hwf||!1,m=n.swf==undefined?!0:n.swf,g=this,y=n.showError||!1,b=[],w=$("<progress>").attr({max:o}).css({width:i+"px",height:s+"px",padding:"1px",visibility:"hidden"}),E=$("<span>").addClass("progress").css({height:s+"px",width:0}),S=$("<span>").css({"font-size":"11px"}).append(h),x=$("<span>").attr("id","errorLabel");w.append($("<span>").addClass("progress_container").css({width:i+"px",height:s+"px"}).append(E)),this.setValue=function(e){var n=w.attr("id"),r=document.getElementById(n);if(null==r){e>=o&&(f=2,L());return}d&&e>a?a=0:e>=0&&e<o?a=e:e>=o?a=o:a=0,a&&(w.attr("value",a),E.css("width",a/o*i+"px")),a!=o&&t?window.setTimeout(p?N:T,l):a>=o&&(f=2,L())},this.setFailed=function(){f=3,y==1&&arguments[0]&&(arguments[0].length<=15?x.text(arguments[0]):x.text(arguments[0].substr(0,15)+"...").attr("title",arguments[0])),arguments[0]&&r.attr("title",arguments[0]),L()},this.setWarning=function(){f=4,arguments[0]&&r.attr("title",arguments[0]),L()},this.start=function(){f=1;var e=k();w.attr("id",e),w.css({visibility:u}),r.attr("title",""),w.removeAttr("value"),a=0,E.css({width:0}),t&&(p?N():T())},this.finishEvent=b,r.append(S),r.append(w),$(e).append(r),$(e).append(x)}function c3progressWithStatus(e,t,n,r){var i=n.width||166,s=n.height||15,o=$("<div>").css({height:s+"px",width:i+100+"px","margin-top":"-5px"}),u=$("<span>").html("");o.append(u);var a=o.c3progress(t,n);this.setValue=function(e,t){t&&t.length>0&&u.html(t+"&nbsp;&nbsp;"),a.setValue(e)},this.finishEvent=a.finishEvent,this.setFailed=function(e){u.html(localizedString("TRIAL_SELECT_FAILED")+"&nbsp;&nbsp;"),a.setFailed(e)},this.setWarning=function(e){u.html(localizedString("TRIAL_SELECT_FAILED")+"&nbsp;&nbsp;"),a.setFailed(e)},this.start=function(){a.start()},this.getProgress=function(){return a},e.append(o)}function multiTaskProcess(e){function h(e){r&&i.html(e.getName()),e.execute&&e.execute()}function p(e){a.setValue(f+e)}function d(){f+=t.getTask(o).getWeight(),a.setValue(f),o<s-1?(o++,h(tasks[o])):g()}function v(){var e=retriveErrorMessage(arguments[0].responseText);r&&i.html(e),a.setFailed(e),y()}function m(){var e=t.getTask(o);if(e.getStatus()==-1){var n=e.getResultDesc();r&&i.html(n),a.setFailed(n),y()}else if(e.getStatus()==2)d();else{var s=e.getCompletePercent()/100,u=parseInt(s*e.getWeight());p(u)}}function g(){n.addClass("success"),r&&i.html(t.successMessage||localizedString("MISC_DONE"));if(t.successEvent)for(var e=0,s=t.successEvent.length;e<s;e++)t.successEvent[e]();b()}function y(){n.addClass("failed");if(t.failedEvent)for(var e=0,r=t.failedEvent.length;e<r;e++)t.failedEvent[e](o-1);b()}function b(){if(t.finishEvent)for(var e=0,n=t.finishEvent.length;e<n;e++)t.finishEvent[e]()}var t=e||{},n=$("<div>").addClass("multi_process"),r=t.ShowStatusTxt===undefined?!0:t.ShowStatusTxt,i=$("<div>").addClass("multi_process_status"),s=0,o=0,u=0,a=null,f=0;s=t.taskCount,tasks=[];if(s)for(var l=0;l<s;l++){var c=t.getTask(l);u+=c.getWeight(),c.doneEvent&&c.doneEvent.push(d),c.errorEvent&&c.errorEvent.push(v),c.updateEvent&&c.updateEvent.push(m),tasks.push(c)}this.placeAt=function(e,t,s){$(e).append(n),t==undefined||s==undefined?a=n.c3progress(null,{width:n.width(),height:24,max:u,swf:!1,hwf:!0}):a=n.c3progress(null,{width:t,height:s,max:u,swf:!1,hwf:!0}),r&&n.append(i)},this.start=function(){a.start(),f=0,o=0,n.removeClass("success failed"),s&&h(tasks[0])},this.updateProcess=p}function loadingWindow(e){this.status="close",this.show=function(){this.status=="close"&&(this.popWindow=this.container.c3popwin(235,50,null,{offsetByExist:!1}),this.status="show")},this.close=function(){this.popWindow&&this.status=="show"&&(this.popWindow.close(),this.status="close")};var t=function(){var t=$("<span>").addClass("tip").append(e||localizedString("MISC_DATA_PROCESSING")),n=$("<div>").addClass("loading").append(t);return n};this.container=t()}function searchHelper(e,t,n){function m(t){self.selection&&self.selection(t),e.attr({value:t})}var r=n||{},i=n.container,s=$("<section>").addClass("searchHelper").addClass("dropdownlist"),o=$("<div>").addClass("searchHelper").addClass("waiting"),u=$("<img>").addClass("searchHelper").addClass("icon"),a=!1;self=this,i=e.parent();var f=e.position(),l=f.top+$(e).height(),c=f.left,h=t,p=$(e).outerWidth(),d=f.right;s.css({width:p+"px",height:h+"px",left:c+"px",top:l+4+"px"}),o.css({width:p+"px",height:h+"px",left:c+"px",top:l+"px"}),u.css({width:"17px",height:"18px",left:c+$(e).width()-13+"px",top:l-$(e).height()+"px"}),u.click(function(e){var t=s.css("display");t=="block"?(s.css({display:"none"}),y()):(s.css({display:"block"}),b()),e.stopPropagation()});var v=$("<select>").attr({size:2});v.css({width:p+"px",height:h+"px"}),e.bind("click",function(e){e.stopPropagation()}),e.bind("keydown",function(e){if(e.keyCode==40)v.focus();else if(e.keyCode==27){var t=s.css("display");t=="block"?(s.css({display:"none"}),y()):(s.css({display:"block"}),b())}else if(e.keyCode==9)s.css({display:"none"});else{var t=s.css("display");t!=="block"&&(s.css({display:"block"}),b())}}),v.bind("blur",function(){s.css({display:"none"}),y()}),v.bind("dblclick",function(){m($(this).val()),s.css({display:"none"}),y()}),v.bind("click",function(t){m($(this).val()),self.callback&&self.callback.call($(this),e)}),v.bind("keydown",function(e){e.keyCode==13&&(m($(this).val()),s.css({display:"none"}),y())}),s.append(v),i.append(s),i.append(o),i.append(u),$("body").bind("click",function(){s.css({display:"none"}),y()}),this.bindData=function(e){v.find("option").remove();for(var t=0;t<e.length;t++)v.append($("<option>").attr({value:e[t].value}).append(e[t].name))};var g=function(){o.css({display:"block"})},y=function(){o.css({display:"none"})};this.onSelect=function(e){self.callback=e},this.show=function(){b(),s.css({display:"block"}),u.css({display:"block"})},this.setDataReady=function(e){a=e,b()};var b=function(){a?y():g()};this.close=function(){s.css({display:"none"}),y()},s.css({display:"none"}),o.css({display:"none"})}function statusControl(e){var t=$("<div>").addClass("statusControl"),n=[];return e instanceof Array?n=e:n.push(e),$.each(n,function(e,n){var r=$("<label>").addClass("ShowIcon");n.className&&r.addClass(n.className),n.text&&(n.className||r.addClass(n.text),n.tip===undefined?r.attr({title:n.text}):r.attr({title:n.tip})),n.showText&&r.append(n.text),n.textalign&&t.css({"text-align":n.textalign}),t.append(r)}),t}function confirmWin(e,t,n,r){function f(){if(r&&r.msgBox){var e=r.msgBox[0].validity.valid;if(!e){r.msgBox.css({border:"1px solid red"});return}}s.result=!0;for(var t=0;t<s.okEvent.length;t++)s.okEvent[t](s.result);s.close()}function l(){var e=$("<div>").addClass("tools");return i.btnCancel=$("<input>").attr({id:i.getId()+"_btnCancel",type:"button",value:i.getCancelText()}),i.btnFinish=$("<input>").attr({id:i.getId()+"_btnFinish",type:"button",value:i.getOKText()}),i.btnCancel.bind("click",function(){s.cancel()}),i.btnFinish.bind("click",f),r?(!r.hideFinish||r.hideFinish==0)&&e.append(i.btnFinish):e.append(i.btnFinish),r?(!r.hideNo||r.hideNo==0)&&e.append(i.btnCancel):e.append(i.btnCancel),e}var i=$("<div>").addClass("confirm"),s=i;s.result=!1,i.getId=function(){return"confirmWin"},i.getTitle=function(){return r&&r.title?r.title:localizedString("MISC_CONFIRM")},i.getWidth=function(){return t==undefined?320:t},i.getHeight=function(){return n==undefined?130:n},i.getOKText=function(){return r&&r.oktext?r.oktext:localizedString("MISC_YES")},i.getCancelText=function(){return r&&r.canceltext?r.canceltext:localizedString("MISC_NO")},i.cancelEvent=[],i.closeEvent=[],i.okEvent=[];var o=i.getHeight()-70,u=$("<div>").css({height:o+"px"}),a=$("<div>").append(e);u.append(a),r&&r.msgBox&&(r.msgBox.click(function(){r.msgBox.css({border:"1px"})}),a.append(r.msgBox)),i.append(u),i.append(l()),i.cancel=function(){for(var e=0;e<i.cancelEvent.length;e++)i.cancelEvent[e]();s.close()},i.close=function(){i.pop.close()};var c=function(){for(var e=0;e<i.closeEvent.length;e++)i.closeEvent[e]()};i.pop=i.c3popwin(i.getWidth(),i.getHeight(),i.getTitle(),{},c),i.btnFinish.focus();var h=(o-$(a).height())/2;return a.css({"margin-top":h,"margin-bottom":h,"margin-left":"10px","margin-right":"10px"}),i}function msgBox(e){function r(){var n=$("<div>").css({height:"auto","padding-top":"10px","padding-left":"10px"}),r=$("<div>").append(e.msg);switch(e.icon){case MessageBoxIcon.ERROR:r.addClass("icon_error");break;case MessageBoxIcon.INFORMATION:r.addClass("icon_info");break;case MessageBoxIcon.QUESTION:r.addClass("icon_question");break;case MessageBoxIcon.WARNING:r.addClass("icon_warning");break;case MessageBoxIcon.CONFIRM:r.addClass("icon_confirm");break;default:}var i=null;return t.isPrompt&&null!=e.multiline&&(e.multiline?i=$("<textarea>").attr({required:e.required}).css({width:"95%"}):i=$("<input>").attr({type:"text",required:e.required}).css({width:"95%"})),n.append(r),i&&(n.append($("<div>").css({width:"100%"}).append(i)),t.inputControl=i),n}function i(){var n=$("<div>").addClass("tools");return e.buttons==MessageBoxButton.YESNO&&(t.btnYes=$("<input>").attr({id:t.getId()+"_btnYes",type:"button",value:"Yes"}),t.btnYes.click(function(){t.yes()}),t.btnNo=$("<input>").attr({id:t.getId()+"_btnNo",type:"button",value:"No"}),t.btnNo.click(function(){t.no()}),n.append(t.btnYes).append(t.btnNo)),e.buttons==MessageBoxButton.OK&&(t.btnOk=$("<input>").attr({id:t.getId()+"_btnOk",type:"button",value:"OK"}),t.btnOk.click(function(){t.ok()}),n.append(t.btnOk)),e.buttons==MessageBoxButton.OKCANCEL&&(t.btnOk=$("<input>").attr({id:t.getId()+"_btnOk",type:"button",value:"OK"}),t.btnOk.click(function(){t.ok()}),t.btnCancel=$("<input>").attr({id:t.getId()+"_btnCancel",type:"button",value:"Cancel"}),t.btnCancel.click(function(){t.cancel()}),n.append(t.btnOk).append(t.btnCancel)),e.buttons==MessageBoxButton.CLOSE&&(t.btnClose=$("<input>").attr({id:t.getId()+"_btnClose",type:"button",value:"Close"}),t.btnClose.click(function(){t.close()}),n.append(t.btnClose)),n}var t=$("<div>").addClass("messageBox"),n=t;return t.isPrompt=arguments[1]==null?!1:arguments[1],t.getId=function(){return"msgBox"},t.getTitle=function(){switch(e.icon){case MessageBoxIcon.ERROR:return localizedString("MSGBOX_ERROR");case MessageBoxIcon.INFORMATION:return localizedString("MSGBOX_INFORMATION");case MessageBoxIcon.QUESTION:return localizedString("MSGBOX_QUESTION");case MessageBoxIcon.WARNING:return localizedString("MSGBOX_WARNING");case MessageBoxIcon.CONFIRM:return localizedString("MSGBOX_CONFIRMATION");default:return e.title}},t.getWidth=function(){return e.width==undefined?320:e.width},t.getHeight=function(){return e.height==undefined?150:e.height},t.okEvent=[],t.cancelEvent=[],t.closeEvent=[],t.yesEvent=[],t.noEvent=[],t.append(r()),t.append(i()),t.ok=function(){if(t.checkValidity!=null&&typeof t.checkValidity=="function"&&t.checkValidity()==0)return;for(var r=0;r<n.okEvent.length;r++)n.okEvent[r]();n.inputControl?n.inputControl[0].validity.valid?n.close():n.inputControl.css({border:"1px solid red"}):n.close()},t.cancel=function(){for(var t=0;t<n.cancelEvent.length;t++)n.cancelEvent[t]();n.close()},t.yes=function(){if(t.checkValidity!=null&&typeof t.checkValidity=="function"&&t.checkValidity()==0)return;for(var r=0;r<n.yesEvent.length;r++)n.yesEvent[r]();n.inputControl?n.inputControl[0].validity.valid?n.close():n.inputControl.css({border:"1px solid red"}):n.close()},t.no=function(){for(var t=0;t<n.noEvent.length;t++)n.noEvent[t]();n.close()},t.close=function(){for(var r=0;r<n.closeEvent.length;r++)n.closeEvent[r]();t.pop.close()},t.pop=t.c3popwin(t.getWidth(),t.getHeight(),t.getTitle()),t}function c3tenantPreUpgrade(){var e=arguments[1];this.base=c3.wizard;var t=function(){e&&e.reload()};this.base(t);var n=localizedString("PRE_UPGTESTING_WEL_TITLE"),r=localizedString("PRE_UPGTESTING_WELCOME_TITLE"),i=localizedString("PRE_UPGTESTING_DESC"),s=[localizedString("PRE_UPGTESTING_CSTENANTS_TLT"),localizedString("PRE_UPGTESTING_TGVERSION_TLT"),localizedString("PRE_UPGTESTING_TESTING_TLT")],o=[localizedString("PRE_UPGTESTING_CSTENANTS_DESC"),localizedString("PRE_UPGTESTING_TGVERSION_DESC"),localizedString("PRE_UPGTESTING_TESTING_DESC")];pStepSubTitles=[localizedString("PRE_UPGTESTING_CSTENANTS_DTL"),localizedString("PRE_UPGTESTING_TGVERSION_DTL"),""];var u=this,a=arguments[0]||{},f=arguments[2]||null;this.TargetVersionIPR=-1,this.onInit=function(){this.steps=[new c3tenantPreUpgrade.step1(this,a,f),new c3tenantPreUpgrade.step2(this,a),new c3tenantPreUpgrade.step3(this,a)]},this.getId=function(){return"tenantPreUpgrade"},this.getTitle=function(){return n},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(r,i)},this.getStepCount=function(){return s.length},this.getStepTitle=function(e){return o[e]},this.getStepSubtitle=function(e){return pStepSubTitles[e]},this.getStepName=function(e){return s[e]},this.getStep=function(e){return this.steps[e]},this.finish=function(){e&&e.reload()}}function c3tenantUpgrade(){var e=arguments[1];this.base=c3.wizard;var t=function(){e&&e.reload()};this.base(t);var n=localizedString("PRE_UPGRADE_TITLE"),r=localizedString("PRE_UPGRADE_WELCOME_TITLE"),i=localizedString("PRE_UPGRADE_DESC");strGuideTitle=localizedString("TNT_UPGRADE_GUIDE_TLT"),GuideMain=$("<div>").addClass("guide_main");var s="rbUpgradeTypeName_"+parseInt(Math.random()*100),o=function(e){m.UpgradeType=this.value},u=$("<ul>").attr({id:"ulUpgradeType"}),a=$("<li>"),f=$("<li>"),l=$("<input>").attr({name:s,type:"radio",id:"rbStandard",value:c3UpgradeType.Standard,checked:"checked","class":"upgradeType"}).click(o),c=$("<label>").attr({"for":"rbStandard"}).text(localizedString("TNT_UPGRADE_STANDARD")),h=$("<input>").attr({name:s,type:"radio",id:"rbSimulation",value:c3UpgradeType.Simulation,"class":"upgradeType"}).click(o),p=$("<label>").attr({"for":"rbSimulation"}).text(localizedString("TNT_UPGRADE_SIMULATION"));u.append(a.append(l,c)),u.append(f.append(h,p)),GuideMain.append(u);var d=[localizedString("PRE_UPGRADE_CSTENANTS_TLT"),localizedString("PRE_UPGRADE_TGSU_TLT"),localizedString("PRE_UPGRADE_PRETESTING_TLT"),localizedString("PRE_UPGRADE_STGSU_TLT"),localizedString("PRE_UPGRADE_FINISH_TLT")],v=[localizedString("PRE_UPGRADE_CSTENANTS_DESC"),localizedString("PRE_UPGRADE_TGSU_DESC"),localizedString("PRE_UPGRADE_PRETESTING_DESC"),localizedString("PRE_UPGRADE_STGSU_DESC"),localizedString("PRE_UPGRADE_FINISH_DESC")];pStepSubTitles=[localizedString("TNT_UPGRADE_STEP1_DESC"),localizedString("TNT_UPGRADE_STEP2_DESC"),"",localizedString("TNT_UPGRADE_STAGINGSU_DESC"),""];var m=this,g=arguments[0]||{},y=arguments[2]||null;this.TargetVersionIPR=-1,m.UpgradeType=c3UpgradeType.Standard,this.onInit=function(){m.steps=[new c3tenantUpgrade.chooseTenants(this,g,y),new c3tenantUpgrade.targetSU(this,g),new c3tenantUpgrade.preUpgradeTesting(this,g),new c3tenantUpgrade.stagingSU(this,g),new c3tenantUpgrade.processingUpgrade(this,g)],this.stepsIdx={CHOOSE_TENANTS:0,CHOOSE_TARGET_SU:1,PRE_UPGRADE_TESTING:2,CHOOSE_STAGING_SU:3,PROCESSING_UPGRADE:4}},this.getId=function(){return"tenantUpgrade"},this.getTitle=function(){return n},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(r,i,strGuideTitle," ",GuideMain)},this.getStepCount=function(){return d.length},this.getStepTitle=function(e){return v[e]},this.getStepSubtitle=function(e){return pStepSubTitles[e]},this.getStepName=function(e){return d[e]},this.getStep=function(e){return this.steps[e]},this.finish=function(){e&&e.reload()}}function c3startTesting(){var e=arguments[1];this.base=c3.wizard;var t=function(){e&&e.reload()};this.base(t);var n=localizedString("PRE_UPGTESTING_WEL_TITLE"),r=localizedString("PRE_UPGTESTING_WELCOME_TITLE"),i=localizedString("PRE_UPGTESTING_DESC"),s=[localizedString("PRE_UPGRADE_CSTENANTS_TLT"),localizedString("PRE_UPGRADE_PRETESTING_TLT")],o=[localizedString("PRE_UPGRADE_CSTENANTS_DESC"),localizedString("PRE_UPGRADE_PRETESTING_DESC")];pStepSubTitles=["",""];var u=this,a=arguments[0]||{},f=arguments[2]||null;this.onInit=function(){this.steps=[new c3startTesting.step1(this,a,f),new c3startTesting.step2(this,a,f)]},this.getId=function(){return"start_preupgrade_testing"},this.getTitle=function(){return n},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(r,i)},this.getStepCount=function(){return s.length},this.getStepTitle=function(e){return o[e]},this.getStepSubtitle=function(e){return pStepSubTitles[e]},this.getStepName=function(e){return s[e]},this.getStep=function(e){return this.steps[e]},this.finish=function(){e&&e.reload()}}function c3newCustomer(){function d(){var e=$("<div>"),t=$("<section>").addClass("icon_LicenseFile"),n=$("<section>").append(localizedString("RES_VIEWLIC_LICFILE")).addClass("icon_title");return e.append($("<div>").append(t).append($("<div>").css({"float":"none"}).append(n))),e}var e=arguments[0]||undefined;this.base=c3.wizard;var t=function(){e&&c3ModuleManager.notifyMessage(new c3Message("ListenForRefreshCustomer")),c.CancelApproveCallback&&c.CancelApproveCallback()};this.base(t);var n=localizedString("WIZARD_CUSTOMER_TITLE"),r=localizedString("WIZARD_CUSTOMER_WELCOME_TITLE"),i=localizedString("WIZARD_CUSTOMER_WELCOME_SUBTITLE"),s=localizedString("WIZARD_CUSTOMER_GUIDE_TITLE"),o=localizedString("WIZARD_CUSTOMER_GUIDE_DESCRIPTION"),u=$("<div>").addClass("guide_main"),a=[localizedString("CUSTOMER_PROFILE_TITLE"),localizedString("CUSTOMER_LICENSE_IMPORT_TITLE"),localizedString("CUSTOMER_CREATION_ADDSYSTEMUSER_NAME"),localizedString("CUSTOMER_CREATION_ADDTENANTS_NAME"),localizedString("MISC_PROGRESS&FINISH")],f=[localizedString("CUSTOMER_PROFILE_TITLE"),localizedString("CUSTOMER_LICENSE_IMPORT_TITLE"),localizedString("CUSTOMER_CREATION_ADDSYSTEMUSER_TLT"),localizedString("CUSTOMER_CREATION_ADDTENANTS_TLT"),localizedString("MISC_PROGRESS&FINISH")],l=[localizedString("CUSTOMER_PROFILE_SUBTITLE"),localizedString("CUSTOMER_LICENSE_IMPORT_SUBTITLE"),localizedString("CUSTOMER_CREATION_ADDSYSTEMUSER_DESC"),localizedString("CUSTOMER_CREATION_ADDTENANTS_DESC"),localizedString("CUSTOMER_CREATION_CREATING_DESC")],c=this;this.CustomerEntity={},this.TrialRequest=arguments[1]||undefined,this.CancelApproveCallback=arguments[2]||undefined,this.CancelApproveCallback&&this.cancelEvent.push(this.CancelApproveCallback);var h=$("<div>").addClass("element_group"),p=$("<div>").addClass("element_box");u.append(h),h.append(p),p.append(d()),this.beforePrepareSteps.push(function(){c.TrialRequest?(c.CustomerEntity.Type="TrialCustomer",c.CustomerEntity.InstallationNumber="-1",a=[localizedString("CUSTOMER_PROFILE_TITLE"),localizedString("CUSTOMER_CREATION_ADDSYSTEMUSER_NAME"),localizedString("CUSTOMER_CREATION_ADDTENANTS_NAME"),localizedString("CUST_CREATION_REVIEWSTEP_TLT"),localizedString("MISC_PROGRESS&FINISH")],f=[localizedString("CUSTOMER_PROFILE_TITLE"),localizedString("CUSTOMER_CREATION_ADDSYSTEMUSER_TLT"),localizedString("CUSTOMER_CREATION_ADDTENANTS_TLT"),localizedString("CUST_CREATION_REVIEWSTEP_SUBTLT"),localizedString("MISC_PROGRESS&FINISH")],l=[localizedString("CUSTOMER_PROFILE_SUBTITLE"),localizedString("CUSTOMER_CREATION_ADDSYSTEMUSER_DESC"),localizedString("CUSTOMER_CREATION_ADDTENANTS_DESC"),localizedString("CUST_CREATION_REVIEWSTEP_DESC"),localizedString("CUSTOMER_CREATION_CREATING_DESC")],c.steps=[new c3newCustomer.customerProfile(c),new c3newCustomer.addSystemUser(c),new c3newCustomer.addTenant(c),new c3newCustomer.review(c),new c3newCustomer.process(c)]):(a=[localizedString("CUSTOMER_PROFILE_TITLE"),localizedString("CUSTOMER_LICENSE_IMPORT_TITLE"),localizedString("CUSTOMER_CREATION_ADDSYSTEMUSER_NAME"),localizedString("CUSTOMER_CREATION_ADDTENANTS_NAME"),localizedString("CUST_CREATION_REVIEWSTEP_TLT"),localizedString("MISC_PROGRESS&FINISH")],f=[localizedString("CUSTOMER_PROFILE_TITLE"),localizedString("CUSTOMER_LICENSE_IMPORT_TITLE"),localizedString("CUSTOMER_CREATION_ADDSYSTEMUSER_TLT"),localizedString("CUSTOMER_CREATION_ADDTENANTS_TLT"),localizedString("CUST_CREATION_REVIEWSTEP_SUBTLT"),localizedString("MISC_PROGRESS&FINISH")],l=[localizedString("CUSTOMER_PROFILE_SUBTITLE"),localizedString("CUSTOMER_LICENSE_IMPORT_SUBTITLE"),localizedString("CUSTOMER_CREATION_ADDSYSTEMUSER_DESC"),localizedString("CUSTOMER_CREATION_ADDTENANTS_DESC"),localizedString("CUST_CREATION_REVIEWSTEP_DESC"),localizedString("CUSTOMER_CREATION_CREATING_DESC")],c.steps=[new c3newCustomer.customerProfile(c),new c3newCustomer.importLicenseFile(c),new c3newCustomer.addSystemUser(c),new c3newCustomer.addTenant(c),new c3newCustomer.review(c),new c3newCustomer.process(c)])}),this.onInit=function(){},this.getId=function(){return"newCustomer"},this.getTitle=function(){return n},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(r,i)},this.getStepCount=function(){return c.steps.length},this.getStepTitle=function(e){return f[e]},this.getStepSubtitle=function(e){return l[e]},this.getStepName=function(e){return a[e]},this.getStep=function(e){return this.steps[e]},this.finish=function(t){e&&e.reload()}}function c3newTenant(){var e=arguments[0]||undefined;this.base=c3.wizard;var t=function(){e&&e.reload()};this.base(t);var n,r,i,s;n=localizedString("WIZARD_TENANT_TITLE"),strWelcomeTitle=localizedString("WIZARD_TENANT_WELCOME_TITLE"),strWelcomeContent=localizedString("WIZARD_TENANT_WELCOME_SUBTITLE"),strGuideTitle=localizedString("TNT_CREATION_GUIDE_TLT"),strGuideDescription=localizedString("TNT_CREATION_GUIDE_DEC"),GuideMain=$("<div>").addClass("guide_main");var o=this,u=arguments[1]||!1;this.TenantEntity={},this.TenantEntity.Customer=arguments[2]||null;var a=arguments[3]||!1;this.ExistsTenants=arguments[4]||[],this.TrialRequest=arguments[5]||null;var f="rbCreationStrategyName_"+parseInt(Math.random()*100),l=function(e){o.DBCreationStrategy=this.value},c=$("<ul>").attr({id:"ulCreationStrategy"}),h=$("<li>"),p=$("<li>"),d=$("<li>"),v=$("<input>").attr({name:f,type:"radio",id:"rbNew",value:c3CompanyDBCreationStrategy.New,checked:"checked"}).click(l),m=$("<label>").attr({"for":"rbNew"}).text(localizedString("MISC_NEW")),g=$("<p class='creationHint'>").text(localizedString("TNT_CREATION_NEWTNT")),y=$("<input>").attr({name:f,type:"radio",id:"rbFromPkg",value:c3CompanyDBCreationStrategy.FromPkg}).click(l),b=$("<label>").attr({"for":"rbFromPkg"}).text(localizedString("TNTCREATION_LABEL_FRMPKG")),w=$("<p class='creationHint'>").text(localizedString("TNT_CREATION_VIAPKG")),E=$("<input>").attr({name:f,type:"radio",id:"rbFromBackup",value:c3CompanyDBCreationStrategy.FromBackup}).click(l);lbFromBackup=$("<label>").attr({"for":"rbFromBackup"}).text(localizedString("TNTCREATION_LABEL_FRMBAK")),hintFromBackup=$("<p class='creationHint'>").text(localizedString("TNT_CREATION_VIABACKUP")),c.append(h.append(v,m)).append(g),c.append(p.append(y,b)).append(w),c.append(d.append(E,lbFromBackup)).append(hintFromBackup),GuideMain.append(c),this.onInit=function(){},this.getId=function(){return"newCompanyDB"},this.getTitle=function(){return n},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(strWelcomeTitle,strWelcomeContent,strGuideTitle,strGuideDescription,GuideMain)},this.getStepCount=function(){return o.steps.length},this.getStepTitle=function(e){return i[e]},this.getStepSubtitle=function(e){return s[e]},this.getStepName=function(e){return r[e]},this.getStep=function(e){return this.steps[e]},this.onFinish=function(){this.finish&&!u&&this.finish(this.TenantEntity),e&&e.reload&&e.reload(),this.close()},this.showEvent.push(this.readyForNext),o.DBCreationStrategy=c3CompanyDBCreationStrategy.New,this.beforePrepareSteps.push(function(){switch(o.DBCreationStrategy){case"New":r=[localizedString("TENANT_CHOOSE_HU_TITLE"),localizedString("TNT_CREATION_STEP_TNTINFO_TLT"),localizedString("WIZARD_CPYDB_POSTINGPERIOD"),localizedString("TENANT_LICENSE_ASSIGN_STEP")],i=[localizedString("TENANT_CHOOSE_HU_TITLE"),localizedString("TNT_CREATION_STEP_TNTINFO_TLT"),localizedString("WIZARD_CPYDB_POSTINGPERIOD"),localizedString("TENANT_LICENSE_ASSIGN_STEP")],s=[localizedString("TENANT_CHOOSE_HU_SUBTITLE"),localizedString("TNT_CREATION_STEP_TNTINFO_DESC"),localizedString("WIZARD_CPYDB_POSTINGSUBTITLE"),localizedString("TENANT_LICENSE_ASSIGN_SUBTITLE")],o.steps=[new c3newTenant.step_Common_SelectServiceUnit(o),new c3newTenant.step_Common_TenantInformation(o),new c3newTenant.step_Common_PostingPeriods(o),new c3newTenant.step_Common_AddUsers(o)],u&&(r.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_TLT")),i.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_TLT")),s.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_DESC")),o.steps.unshift(new c3newTenant.step_Common_SelectCustomer(o))),a&&(r.push(localizedString("TNT_CREATION_REVIEWSTEP_TLT")),i.push(localizedString("TNT_CREATION_REVIEWSTEP_SUBTLT")),s.push(localizedString("TNT_CREATION_REVIEWSTEP_DESC")),o.steps.push(new c3newTenant.step_Review(o)),r.push(localizedString("MISC_PROGRESS&FINISH")),i.push(localizedString("MISC_PROGRESS&FINISH")),s.push(""),o.steps.push(new c3newTenant.step_Common_Finish(o)));break;case"FromPkg":r=[localizedString("TENANT_CHOOSE_HU_TITLE"),localizedString("TNT_CREATION_STEP_SECTPKG_NAME"),localizedString("TNT_CREATION_STEP_PKGINFO_NAME"),localizedString("TNT_CREATION_STEP_TNTINFO_NAME"),localizedString("TNT_CREATION_STEP_CTCOUNT_NAME"),localizedString("WIZARD_CPYDB_POSTINGPERIOD"),localizedString("TENANT_LICENSE_ASSIGN_STEP")],i=[localizedString("TENANT_CHOOSE_HU_TITLE"),localizedString("TNT_CREATION_STEP_SECTPKG_TLT"),localizedString("TNT_CREATION_STEP_PKGINFO_TLT"),localizedString("TNT_CREATION_STEP_TNTINFO_TLT"),localizedString("TNT_CREATION_STEP_CTCOUNT_TLT"),localizedString("WIZARD_CPYDB_POSTINGPERIOD"),localizedString("TENANT_LICENSE_ASSIGN_STEP")],s=[localizedString("TENANT_CHOOSE_HU_SUBTITLE"),localizedString("WIZARD_CPYDB_PACKAGESUBTITLE"),localizedString("TNT_CREATION_STEP_PKGINFO_DESC"),localizedString("TNT_CREATION_STEP_TNTINFO_DESC"),localizedString("TNT_CREATION_STEP_CTCOUNT_DESC"),localizedString("WIZARD_CPYDB_POSTINGSUBTITLE"),localizedString("TENANT_LICENSE_ASSIGN_SUBTITLE")],o.steps=[new c3newTenant.step_Common_SelectServiceUnit(o),new c3newTenant.step_FromPackage_SelectPackage(o),new c3newTenant.step_FromPackage_VerifyPackageInfo(o),new c3newTenant.step_Common_TenantInformation(o),new c3newTenant.step_FromPackage_SelectCOA(o),new c3newTenant.step_Common_PostingPeriods(o),new c3newTenant.step_Common_AddUsers(o)],u&&(r.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_NAME")),i.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_TLT")),s.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_DESC")),o.steps.unshift(new c3newTenant.step_Common_SelectCustomer(o))),a&&(r.push(localizedString("TNT_CREATION_REVIEWSTEP_TLT")),i.push(localizedString("TNT_CREATION_REVIEWSTEP_SUBTLT")),s.push(localizedString("TNT_CREATION_REVIEWSTEP_DESC")),o.steps.push(new c3newTenant.step_Review(o)),r.push(localizedString("MISC_PROGRESS&FINISH")),i.push(localizedString("MISC_PROGRESS&FINISH")),s.push(""),o.steps.push(new c3newTenant.step_Common_Finish(o)));break;case"FromBackup":r=[localizedString("TENANT_CHOOSE_HU_TITLE"),localizedString("TNT_CREATION_STEP_SECTBKUP_NAME"),localizedString("TNT_CREATION_STEP_TNTINFO_NAME"),localizedString("TENANT_LICENSE_ASSIGN_STEP")],i=[localizedString("TENANT_CHOOSE_HU_TITLE"),localizedString("TNT_CREATION_STEP_SECTBKUP_TLT"),localizedString("TNT_CREATION_STEP_TNTINFO_TLT"),localizedString("TENANT_LICENSE_ASSIGN_STEP")],s=[localizedString("TENANT_CHOOSE_HU_SUBTITLE")+("<p>"+localizedString("TNT_HANA_HU_BAK_DISABLED")+"</p>"),localizedString("TNT_CREATION_STEP_SECTBKUP_DESC"),localizedString("TNT_CREATION_STEP_TNTINFO_DESC"),localizedString("TENANT_LICENSE_ASSIGN_SUBTITLE")],o.steps=[new c3newTenant.step_Common_SelectServiceUnit(o),new c3newTenant.step_FromBackup_SelectBackupFile(o),new c3newTenant.step_Common_TenantInformation(o),new c3newTenant.step_Common_AddUsers(o)],u&&(r.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_NAME")),i.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_TLT")),s.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_DESC")),o.steps.unshift(new c3newTenant.step_Common_SelectCustomer(o))),a&&(r.push(localizedString("TNT_CREATION_REVIEWSTEP_TLT")),i.push(localizedString("TNT_CREATION_REVIEWSTEP_SUBTLT")),s.push(localizedString("TNT_CREATION_REVIEWSTEP_DESC")),o.steps.push(new c3newTenant.step_Review(o)),r.push(localizedString("MISC_PROGRESS&FINISH")),i.push(localizedString("MISC_PROGRESS&FINISH")),s.push(""),o.steps.push(new c3newTenant.step_Common_Finish(o)))}})}function c3registerTenant(){var e=arguments[0]||undefined;this.base=c3.wizard;var t=function(){e&&e.reload()};this.base(t);var n,r,i,s;n=localizedString("WIZARD_REGISTER_TENANT_TITLE"),strWelcomeTitle=localizedString("WIZARD_REGISTER_TENANT_WELCOME_TITLE"),strWelcomeContent=localizedString("WIZARD_REGISTER_TENANT_WELCOME_SUBTITLE");var o=this;this.TenantEntity={},this.onInit=function(){},this.getId=function(){return"registerCompanyDB"},this.getTitle=function(){return n},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(strWelcomeTitle,strWelcomeContent,null,null,null)},this.getStepCount=function(){return o.steps.length},this.getStepTitle=function(e){return i[e]},this.getStepSubtitle=function(e){return s[e]},this.getStepName=function(e){return r[e]},this.getStep=function(e){return this.steps[e]},this.onFinish=function(){e&&e.reload&&e.reload(),this.close()},this.showEvent.push(this.readyForNext),o.DBCreationStrategy="New",this.beforePrepareSteps.push(function(){switch(o.DBCreationStrategy){case"New":r=[localizedString("TENANT_CHOOSE_HU_TITLE"),localizedString("TNT_CREATION_STEP_TNTINFO_TLT"),localizedString("TENANT_LICENSE_ASSIGN_STEP")],i=[localizedString("TENANT_CHOOSE_HU_TITLE"),localizedString("TNT_CREATION_STEP_TNTINFO_TLT"),localizedString("TENANT_LICENSE_ASSIGN_STEP")],s=[localizedString("TENANT_CHOOSE_HU_SUBTITLE"),localizedString("TNT_CREATION_STEP_TNTINFO_DESC"),localizedString("TENANT_LICENSE_ASSIGN_SUBTITLE")],o.steps=[new c3registerTenant.step_Common_SelectServiceUnit(o),new c3registerTenant.step_Common_TenantInformation(o),new c3registerTenant.step_Common_AddUsers(o)],r.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_TLT")),i.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_TLT")),s.unshift(localizedString("TNT_CREATION_STEP_SECTUSER_DESC")),o.steps.unshift(new c3registerTenant.step_Common_SelectCustomer(o)),r.push(localizedString("TNT_CREATION_REVIEWSTEP_TLT")),i.push(localizedString("TNT_CREATION_REVIEWSTEP_SUBTLT")),s.push(localizedString("TNT_CREATION_REVIEWSTEP_DESC")),o.steps.push(new c3registerTenant.step_Review(o)),r.push(localizedString("MISC_PROGRESS&FINISH")),i.push(localizedString("MISC_PROGRESS&FINISH")),s.push(""),o.steps.push(new c3registerTenant.step_Common_Finish(o))}})}function c3newReseller(){var e=arguments[0]||undefined;this.base=c3.wizard,this.base(),this.ResellerEntity={},this.ServiceUnitList=[],this.UserList=[];var t=this,n=localizedString("WIZARD_RESELLER_TITLE"),r=localizedString("WIZARD_RESELLER_WELCOME_TITLE"),i=localizedString("WIZARD_RESELLER_WELCOME_SUBTITLE"),s=localizedString("WIZARD_RESELLER_GUIDE_TITLE"),o=localizedString("WIZARD_RESELLER_GUIDE_DESCRIPTION"),u=[localizedString("RESELLER_PROFILE_TITLE"),localizedString("TENANT_CHOOSE_HU_TITLE"),localizedString("RESELLER_CREATION_STEP3_NAME"),localizedString("RESELLER_NEW_USER_TITLE")],a=[localizedString("RESELLER_PROFILE_TITLE"),localizedString("TENANT_CHOOSE_HU_TITLE"),localizedString("RESELLER_CREATION_STEP3_TITLE"),localizedString("RESELLER_NEW_USER_TITLE")],f=[localizedString("RESELLER_PROFILE_SUBTITLE"),localizedString("RESELLER_SU_SUBTITLE"),localizedString("RESELLER_CREATION_STEP3_SUBTITLE"),localizedString("RESELLER_NEW_USER_SUBTITLE")];this.onInit=function(){},this.getId=function(){return"newReseller"},this.getTitle=function(){return n},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(r,i)},this.getStepCount=function(){return t.steps.length},this.getStepTitle=function(e){return a[e]},this.getStepSubtitle=function(e){return f[e]},this.getStepName=function(e){return u[e]},this.getStep=function(e){return this.steps[e]},this.finish=function(n){this.ServiceUnitList&&this.ServiceUnitList.length>0&&(this.ResellerEntity.ServiceUnits=this.ServiceUnitList),this.UserList&&this.UserList.length>0&&(this.ResellerEntity.Users=this.UserList);if(t.Authorizations!=null&&t.Authorizations.length>0){this.ResellerEntity.TaskAuthorizations=[];for(var r=0;r<t.Authorizations.length;r++)this.ResellerEntity.TaskAuthorizations.push({TaskTypeID:t.Authorizations[r].ID,PermissionType:"Authorized"})}var i={success:function(t){e&&e.reload()},error:function(e){}};c3.service.createReseller(this.ResellerEntity,i||{})};var l=function(){function r(){var e=$("<div>");for(var t in n){var r=Utility.CreateRow(n[t].Name,n[t].Value);e.append(r)}return e}function i(){n.Name.Value.val()&&n.Name.Value.val().length>0&&(e.ResellerEntity.Name=n.Name.Value.val()),n.ContactPerson.Value.val()&&n.ContactPerson.Value.val().length>0&&(e.ResellerEntity.ContactPerson=n.ContactPerson.Value.val()),n.Country.Value.val()&&n.Country.Value.val().length>0&&(e.ResellerEntity.Country=n.Country.Value.val()),n.EmployeeCount.Value.val()&&n.EmployeeCount.Value.val().length>0&&(e.ResellerEntity.EmployeeCount=n.EmployeeCount.Value.val()),n.Phone.Value.val()&&n.Phone.Value.val().length>0&&(e.ResellerEntity.Phone=n.Phone.Value.val()),n.Email.Value.val()&&n.Email.Value.val().length>0&&(e.ResellerEntity.Email=n.Email.Value.val()),n.Location.Value.val()&&n.Location.Value.val().length>0&&(e.ResellerEntity.Location=n.Location.Value.val()),n.Description.Value.val()&&n.Description.Value.val().length>0&&(e.ResellerEntity.Description=n.Description.Value.val()),n.ImplRepository.Value.val()&&n.ImplRepository.Value.val().length>0&&(e.ResellerEntity.ImplementationRepository={ID:n.ImplRepository.Value.val()}),n.CompanyTemplateRepository.Value.val()&&n.CompanyTemplateRepository.Value.val().length>0&&(e.ResellerEntity.CompanyTemplateRepository={ID:n.CompanyTemplateRepository.Value.val()})}function s(){o(),u()}function o(){c3.service.getImplementationRepositories().filter("Status eq 'Available' and Reseller eq null").query(function(t){c3.service.getHostingUnits().filter("ImplementationRepository/ID ne null").expand("ImplementationRepository").query(function(r){n.ImplRepository.Value.find("option").remove(),n.ImplRepository.Value.append($("<option>"));var i=null;for(var s=0;s<t.data.length;s++)if(r.data==null||r.data.length==0)i=$("<option>").text(t.data[s].URI).attr({value:t.data[s].ID}),e.ResellerEntity&&e.ResellerEntity.ImplementationRepository&&e.ResellerEntity.ImplementationRepository.ID==t.data[s].ID&&i.attr({selected:"selected"}),n.ImplRepository.Value.append(i);else{var o=!1;for(var u=0;u<r.data.length;u++)if(r.data[u].ImplementationRepository.ID>0&&t.data[s].ID==r.data[u].ImplementationRepository.ID){o=!0;break}o||(i=$("<option>").text(t.data[s].URI).attr({value:t.data[s].ID}),e.ResellerEntity&&e.ResellerEntity.ImplementationRepository&&e.ResellerEntity.ImplementationRepository.ID==t.data[s].ID&&i.attr({selected:"selected"}),n.ImplRepository.Value.append(i))}})})}function u(){c3.service.getCompanyTemplateRepositories().filter("Status eq 'Available' and Reseller eq null").query(function(t){c3.service.getHostingUnits().filter("CompanyTemplateRepository/ID ne null").expand("CompanyTemplateRepository").query(function(r){n.CompanyTemplateRepository.Value.find("option").remove(),n.CompanyTemplateRepository.Value.append($("<option>"));var i=null;for(var s=0;s<t.data.length;s++)if(r.data==null||r.data.length==0)i=$("<option>").text(t.data[s].URI).attr({value:t.data[s].ID}),e.ResellerEntity&&e.ResellerEntity.CompanyTemplateRepository&&e.ResellerEntity.CompanyTemplateRepository.ID==t.data[s].ID&&i.attr({selected:"selected"}),n.CompanyTemplateRepository.Value.append(i);else{var o=!1;for(var u=0;u<r.data.length;u++)if(r.data[u].CompanyTemplateRepository.ID>0&&t.data[s].ID==r.data[u].CompanyTemplateRepository.ID){o=!0;break}o||(i=$("<option>").text(t.data[s].URI).attr({value:t.data[s].ID}),e.ResellerEntity&&e.ResellerEntity.CompanyTemplateRepository&&e.ResellerEntity.CompanyTemplateRepository.ID==t.data[s].ID&&i.attr({selected:"selected"}),n.CompanyTemplateRepository.Value.append(i))}})})}this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=this,n={Name:{Name:localizedString("MISC_RESELLER_NAME"),Value:new textbox({isRequired:!0})},ContactPerson:{Name:localizedString("COLUMN_CONTACTPERSON"),Value:new textbox({isRequired:!1})},Phone:{Name:localizedString("CUSTOMER_COLUMN_PHONE"),Value:new textbox({isRequired:!1})},Email:{Name:localizedString("CUSTOMER_COLUMN_EMAIL"),Value:new textbox({isRequired:!1})},EmployeeCount:{Name:localizedString("CUSTOMERCREATION_LABEL_EMPLOYEECOUNT"),Value:new textbox({isRequired:!1,pattern:"[0-9]*"})},Country:{Name:localizedString("CUSTOMER_COLUMN_COUNTRY"),Value:new textbox({isRequired:!1})},Location:{Name:localizedString("CUSTOMER_COLUMN_LOCATION"),Value:new textbox({isRequired:!1})},ImplRepository:{Name:localizedString("RES_SHARED_IMPL_REPOSITORY"),Value:new dropdownlist({isRequired:!1})},CompanyTemplateRepository:{Name:localizedString("RES_COMPANY_TEMPLATE_REPOSITORY"),Value:new dropdownlist({isRequired:!1})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}};this.onInit=function(){this._container.append(r())},this.onViewAppear=function(){s()},this.validator=new function(){var e=[],t=function(){function l(e){e.data&&e.data.length>0?n.Name.Value.showErrorMessage(textbox.validityMessages.duplicated):h()}function c(){h()}function h(){i(),e.length>0&&e[0]()}var t=!0;if(n.EmployeeCount.Value.val()&&n["EmployeeCount"].Value.val()!=""){t=n.EmployeeCount.Value.checkValidity();if(t){var r=parseInt(n.EmployeeCount.Value.val());r>2147483647&&(t=t&&!1,n.EmployeeCount.Value.showErrorMessage(localizedString("CUSTOMER_CRATION_EMPLOYEECOUNT_MAX")))}}var s=!0;if(n.Email.Value.val()&&n["Email"].Value.val()!=""){var o=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;s=o.test(n.Email.Value.val()),s||n.Email.Value.showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH"))}var u=!0;if(n.Phone.Value.val()&&n["Phone"].Value.val()!=""){var a=/^(\+\d{2,3} )*[\d]+(-[\d]+)*$/;u=a.test(n.Phone.Value.val()),u||n.Phone.Value.showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH"))}var f=n.Name.Value.checkValidity()&&s&&u&&t;f&&c3.service.getResellers().filter(String.format("Name eq '{0}'",encodeURI(n.Name.Value.val()))).query({success:l,error:c})};this.validEvent=e,this.checkValidity=t}},c=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=localizedString("WIZARD_TENANT_HULIST"),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"20%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"20%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"20%"},{name:"TenantNum",description:localizedString("COLUMN_CUSTNUM"),type:"text",width:"30%"}],r=this,i=null,s=[],o={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 347},getTip:function(){return Utility.CreateTipBoard(localizedString("HOSTUNIT"),!1,null)},getCell:function(){var e=null;if(this.colName=="LicenseServer"){var t={};t.text=this.data[this.colName].Status,e=new statusControl(t)}if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}};this.onInit=function(){var t=$("<div>");i=t.gridview({delegate:o,checkType:1}),i.rowCheckEvent.push(function(){var t=this.index;if(this.isChecked){var n=!1;for(var r=0;r<e.ServiceUnitList.length;r++)e.ServiceUnitList[r].ID==s[t].ID&&(n=!0);if(!n){var i={ID:s[t].ID};e.ServiceUnitList.push(i)}}else{var n=!1,o=-1;for(var r=0;r<e.ServiceUnitList.length;r++)e.ServiceUnitList[r].ID==s[t].ID&&(n=!0,o=r);n&&o>=0&&e.ServiceUnitList.remove(o)}}),this._container.append(t),i.show();var n=new loadingWindow;r.loadingWin=n,a()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){r.reload()})},this.onViewAppear=function(){u()};var u=function(){return!0};this.reload=function(){a()};var a=function(){s=[];var e="";r.loadingWin.show(),c3.service.getHostingUnits().filter("Purpose ne 'Staging' and LicenseServer/Status eq 'Online' and Status eq 'Online'"+e).expand("Tenants,Tenants/CompanyDatabase,LicenseServer,LicenseServer/LicenseFiles, CommonDatabase, CommonDatabase/DatabaseInstance,CompanyTemplateRepository,SoftwareRepository,ImplementationRepository").query(function(e){r.loadingWin.close();if(e.data&&e.data.length>0)for(var t=0;t<e.data.length;t++)s.push(e.data[t]),e.data[t].Tenants?s[t].TenantNum=e.data[t].Tenants.results.length:s[t].TenantNum=0;i.reload()})}},h=function(){function a(){c3.service.getTaskTypes().query({success:function(e){e.data!=null&&e.data.length>0&&(s=e.data,i.reload())},error:function(e){}})}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=$("<div>"),r=[{name:"OperationType",description:localizedString("RESELLER_CREATION_STEP3_COLUMN_OPT"),type:"text",width:"40%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"60%"}],i=null,s=[],o=-1,u={needExport:function(){return!1},getHeaderSpec:function(){return r},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 320},getDefaultSelectedIndex:function(){return o},getCell:function(){return this.colName=="OperationType"?$("<span>").html(localizedString(this.data.TaskType.toUpperCase())):null}};this.onInit=function(){var e=$("<div>").addClass("tblUp");i=e.gridview({delegate:u,checkType:1}),i.rowCheckEvent.push(function(){var e=this.index,n=s[e];if(this.isChecked)if(t.Authorizations!=null&&t.Authorizations.length>0){var r=!1;for(var i=0;i<t.Authorizations.length;i++)if(t.Authorizations[i].ID==n.ID){r=!0;break}r||t.Authorizations.push(n)}else t.Authorizations=[],t.Authorizations.push(n);else if(t.Authorizations!=null&&t.Authorizations.length>0){var o=-1;for(var i=0;i<t.Authorizations.length;i++)if(t.Authorizations[i].ID==n.ID){o=i;break}o!=-1&&t.Authorizations.remove(o)}}),this._container.append(e),i.show(),a()},this.onViewAppear=function(){t&&t.readyForNext&&t.readyForNext()}},p=function(){function l(e){o=e,nextBtnCheck()}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=$("<div>"),r=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"90%"}],i=null,s=[],o=-1,u={needExport:function(){return!1},getHeaderSpec:function(){return r},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 320},getDefaultSelectedIndex:function(){return o},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}},a=$("<input>").attr({type:"button",value:localizedString("MISC_ADD")}),f=$("<input>").attr({type:"button",value:localizedString("MISC_REMOVE")});a.click(function(){var t=new c3addSystemUser(e,0,null,!1,"reseller");t.finishEvent.push(function(){h(t.User)}),t.show()}),f.click(function(){s.remove(o),o=-1,i.reload(),nextBtnCheck()}),this.onInit=function(){var e=$("<div>").append(a).append(f).addClass("tools toolsbar"),t=$("<div>").addClass("tblUp");i=t.gridview({delegate:u}),i.rowSelectedEvent.push(function(){o!=this.index&&l(this.index)}),this._container.append(e),this._container.append(t),i.show()},validator=new function(){var e=[],n=function(){function a(){c(s),e.length>0&&e[0]()}var n=!1;for(var r=0;r<s.length;r++)for(var i=0;i<s.length;i++)r!==i&&s[r].Name==s[i].Name&&(n=!0);n&&t.showError(localizedString("CUSTOMER_CREATION_SYSTEMUSER_REAPEATED"));var o={};o.success=function(e){var n=e.d.results;if(n){var r=0;for(var i=0;i<s.length;i++){var o=!1;for(var u=0;u<n.length;u++)if(s[i].Name==n[u].SystemUsername){o=!0;break}o||r++}r>2?t.showError(localizedString("CUSTOMER_CREATION_TWOUSERS_LIMIT")):a()}else a()},o.error=function(e){a()};var u={};c3.service.getOperators(u,o)};this.validEvent=e,this.checkValidity=n},this.validator=validator,this.onViewAppear=function(){t&&t.readyForNext&&t.readyForNext(),s||(s=[]),i.reload()};var c=function(e){t.ResellerEntity.Users=[];for(var n=0;n<e.length;n++){var r={SystemUsername:e[n].Name,Status:e[n].Status,Domain:e[n].Domain};t.UserList.push(r)}},h=function(e){for(var t=0;t<s.length;t++)if(s[t].Name==e.Name)return;s.push(e),i.reload()}};this.beforePrepareSteps.push(function(){t.steps=[new l(t),new c(t),new h(t),new p(t)]})}function c3newSBOCommon(){var e=!1,t={},n=new c3newSBOCommon.step1(this),r={getActionButtonText:function(){return localizedString("MISC_CREATE")},validator:n.validator};this.base=c3.dialog,this.base(r),this.SBOCommonEntity=t,this.view=n;var i=this,s=arguments[0]||undefined;this.onInit=function(){this.view.onInit(),this.view.onInitNotification(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"newSBOCommon"},this.getTitle=function(){return localizedString("WIZARD_SBO_CRT")},this.finish=function(){i.disableFinish(),this._container.find(".progressRow").size()>0&&this._container.find(".progressRow").remove();var e=-1;c3.service.createCommonDB(i.SBOCommonEntity,function(t,n){c3ModuleManager.notifyMessage(new c3Message("New-SBOCommon")),"success"==n&&(e=t.d.CreateCommonDatabaseAsync),"error"==n&&(e=-2),i.view.reset(),i.readyForFinish()});var t={};this._container.find(".progress_wrap").size()>0&&$(this._container.find(".progress_wrap").parent().parent().parent()).remove(),this._container.append(Utility.CreateProcessRow(function(){var n=this;-1!=e?-2==e?t.progressBar.setFailed():(i.progressBarHandle=t,c3.service.getTaskProgress(e).query(function(n){var r=n.data.GetTaskProperties.split(",");"Failed"==r[0]?c3.service.getTasks(e).expand("TaskParameters").query(function(e){t.progressBar.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)}):"Successful"==r[0]?(t.progressBar.setValue(100,localizedString("MISC_DONE")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview")),c3ModuleManager.notifyMessage(new c3Message("Referesh_Extension"))):(r[0]!="Pending"&&r[0]!="Done"?r[0]=localizedString("MISC_TASK_PROCESSING"):r[0]=="Pending"&&(r[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),t.progressBar.setValue(parseInt(r[1]),r[0]))})):t.progressBar.setValue(0,localizedString("SBOCOMMON_PROGRESS_WAIRING"))},t)),t.progressBar.start()}}function c3editCompanyDB(){this.base=c3.wizard,this.base();var e=localizedString("EDITCPYDB_WELCOME_TLT1"),t=localizedString("EDITCPYDB_WELCOME_TLT2"),n=localizedString("EDITCPYDB_WELCOME_CNT"),r=[localizedString("EDITCPYDB_LABEL_TLT")];pStepTitles=[localizedString("EDITCPYDB_LABEL_TLT")],pStepSubTitles=[""];var i=this,s=arguments[0];this.companyEntity=arguments[1],this.onInit=function(){this.steps=[new c3editCompanyDB.step1(this)]},this.getId=function(){return"editCompanyDB"},this.getTitle=function(){return e},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(t,n)},this.getStepCount=function(){return r.length},this.getStepTitle=function(e){return pStepTitles[e]},this.getStepSubtitle=function(e){return pStepSubTitles[e]},this.getStepName=function(e){return r[e]},this.getStep=function(e){return this.steps[e]},this.onFinish=function(){var e={};e.Id=this.companyEntity.Id,e.Description=this.companyEntity.Description,e.Purpose=this.companyEntity.Purpose,e.Status=this.companyEntity.Status,c3.service.updateCompanyDB(e,function(){}),s&&s.reloadCompanyDB(),this.close()}}function c3editCompanyDBTest(){var e=new c3editCompanyDBTest.step1(this),t=localizedString("EDITCPYDB_LABEL_TLT"),n={getActionButtonText:function(){return localizedString("DATAFORM_SAVE")},validator:e.validator};this.base=c3.dialog,this.base(n),this.view=e;var r=this,i=arguments[0]||undefined;this.companyEntity=arguments[1],this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return t},this.onClose.push(function(){i&&i.reloadCompanyDB()}),this.finish=function(){var e={};e.Id=this.companyEntity.Id,e.Description=this.companyEntity.Description,e.Purpose=this.companyEntity.Purpose,e.Status=this.companyEntity.Status,c3.service.updateCompanyDB(e,function(e){i&&i.reloadCompanyDB(),r.close()})}}function c3registerMSSql(){this.base=c3.dialog,this.view=new c3registerMSSql.step1(this);var e=this,t=!1,n={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:this.view.validator},r={testConnect:function(e){var t=e,n=this;this.base=c3.task,this.base(localizedString("MISC_TEST_CONNECTION"),70),this.execute=function(){c3.service.testConnectDBServer(t.Name,t.ServerType,t.IsTrustedConnection,t.Username,t.Password,this.ajaxCallBackConfig)}},register:function(t){var n=t,r=this;this.base=c3.task,this.base(localizedString("WIZARD_DBINST_REG"),30),this.execute=function(){var t=e.view._container;if($(t).find(".rowValue").size()==3){var i=$(t).find(".rowValue")[1];$(i).find("img").size()>0&&$($(i).find("img")[0]).css("display","none")}c3.service.createDBServerInstance(n,this.ajaxCallBackConfig),r.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("New-MSSQL")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))})}}};this.base(n),this.MSSQLEntity={};var i=localizedString("WIZARD_DBINST_TITLE"),s=this,o=arguments[0]||undefined,u=new r.testConnect(this.MSSQLEntity),a=new r.register(this.MSSQLEntity),f={taskCount:2,getTask:function(e){return e==0?u:a},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){t=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},l=new multiTaskProcess(f);this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),l.placeAt(this.view.getContainer())},this.getId=function(){return"registerMSSql"},this.getTitle=function(){return i},this.onClose.push(function(){o&&t&&o.reload()}),this.finish=function(){s.disableFinish(),l.start()}}function c3registerLicenseServer(){var e=!1,t={},n=new c3registerLicenseServer.step1(this),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i={testConnectTask:function(e){var t=e,n=this;this.base=c3.task,this.base(localizedString("MISC_TEST_CONNECTION"),50),this.execute=function(){c3.service.testConnectLicenseServerByServerName(t.Machine.Hostname+":"+t.Port,this.ajaxCallBackConfig)}},registerTask:function(e){var t=e,n=this;this.base=c3.task,this.base(localizedString("WIZARD_LICSVR_CREATE"),50),this.execute=function(){c3.service.createLicenseServer(t,this.ajaxCallBackConfig),n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("New-LicenseServer")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))})}}};this.base=c3.dialog,this.base(r),this.LicenseServerEntity=t,this.view=n;var s=this,o=arguments[0]||undefined,u=new i.testConnectTask(t),a=new i.registerTask(t),f={taskCount:2,getTask:function(e){return e==0?u:a},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset(),s.readyForFinish()}],successMessage:localizedString("MISC_DONE")},l=new multiTaskProcess(f);this.onInit=function(){this.dom.addClass("respoolWizard"),this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),l.placeAt(this.view.getContainer())},this.getId=function(){return"registerMSSql"},this.getTitle=function(){return localizedString("WIZARD_LICSVR_REG")},this.finish=function(){s.disableFinish(),l.start()},this.onClose.push(function(){o&&e&&o.reload()})}function c3registerPresServer(){var e=!1,t={},n=new c3registerPresServer.step1(this),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i={register:function(e){var t=e.PresServerEntity,n=this;this.base=c3.task,this.base(localizedString("REGISTSF_TLT_PSR"),100),this.execute=function(){var r=this;n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("New-PresentationServer")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))}),o.host&&(t.HostingUnit={},t.HostingUnit.Id=o.host.Id),e.setLink?c3.service.getPresentationServers().expand("HostingUnit").filter(String.format("Name eq '{0}'",t.Name)).query(function(e){if(e.data.length==1){if(e.data[0].HostingUnit==null){var n={};n.Id=e.data[0].Id,n.HostingUnit={},n.HostingUnit.__metadata={},n.HostingUnit.__metadata.uri=o.host.__metadata.uri,n.Description=t.Description,c3.service.updatePresentationServer(n,r.ajaxCallBackConfig)}}else c3.service.createPresentationServer(t,r.ajaxCallBackConfig)}):c3.service.createPresentationServer(t,r.ajaxCallBackConfig)}}};this.base=c3.dialog,this.base(r),this.PresServerEntity=t,this.view=n;var s=this,o=arguments[0]||undefined;s.setLink=arguments[1]||undefined;var u=new i.register(s),a={taskCount:1,getTask:function(e){if(e==0)return u},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},f=new multiTaskProcess(a);this.onInit=function(){this.dom.addClass("respoolWizard"),this.view.onInit(),this.content=this.view.getContainer();var e=new loadingWindow;s.loadingWin=e},this.onViewAppear=function(){this.view.onViewAppear(),f.placeAt(this.view.getContainer())},this.getId=function(){return"registerPresentationServer"},this.getTitle=function(){return localizedString("WIZARD_PRESVR_REG")},this.finish=function(){s.loadingWin.show(),c3.service.testPresentationServerConnection(s.PresServerEntity.Machine.Hostname,s.PresServerEntity.ServerType,function(e){s.loadingWin.close();if(e.d.TestPresentationServerConnection)s.disableFinish(),f.start();else{var t=MessageBox.confirm({msg:localizedString("PRESENTATION_WARNING_CONFIRM")});t.yesEvent.push(function(){s.disableFinish(),f.start()})}})},this.onClose.push(function(){o&&e&&o.reload()})}function c3registerB1i(){var e=!1,t={},n=new c3registerB1i.step1(this),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i={register:function(e){var t=e,n=this;this.base=c3.task,this.base(localizedString("REGISTSF_TLT_B1I"),100),this.execute=function(){n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("New-B1i")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))}),c3.service.createB1iServer(t,this.ajaxCallBackConfig)}}};this.base=c3.dialog,this.base(r),this.B1iEntity=t,this.view=n;var s=this,o=arguments[0]||undefined,u=new i.register(t),a={taskCount:1,getTask:function(e){if(e==0)return u},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},f=new multiTaskProcess(a);this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),f.placeAt(this.view.getContainer())},this.getId=function(){return"registerB1i"},this.getTitle=function(){return localizedString("WIZARD_B1I_REG")},this.finish=function(){s.disableFinish(),f.start()},this.onClose.push(function(){o&&e&&o.reload()})}function c3registerBAServer(){var e=!1,t=!1,n={},r=new c3registerBAServer.step1(this),i={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:r.validator},s={register:function(e){function i(t,n){e.setLink?c3.service.getBrowserAccessServers().expand("HostingUnit").filter(String.format("Name eq '{0}'",t.Name)).query(function(e){if(e.data.length==1){if(e.data[0].HostingUnit==null){var r={};r.Id=e.data[0].Id,r.HostingUnit={},r.HostingUnit.__metadata={},r.HostingUnit.__metadata.uri=u.host.__metadata.uri,r.Description=t.Description,r.CertFile=t.CertFile,r.CertPass=t.CertPass,c3.service.updateBrowserAccessServer(r,n.ajaxCallBackConfig)}}else c3.service.createBrowserAccessServer(t,n.ajaxCallBackConfig)}):c3.service.createBrowserAccessServer(t,n.ajaxCallBackConfig)}function s(){var e=r,s={MachineName:n.Machine.Hostname};$.c3BaseClient.callNormalService("POST","CheckBaServerIsAgent",JSON.stringify(s),{success:function(r){t==0?(n.CertFile="",n.CertPass="",i(n,e)):c3.service.checkCertificateFileCredentials(n.CertFile,n.CertPass,{success:function(t){i(n,e)},error:function(t){e.error(t)}})},error:function(t){e.error(t)}})}function o(e){if(!e){r.iptStatus.attr("src",c3Icon.Failed).css("display","inline"),alert(localizedString("IMPORTCERTFILE_IMPORTERROR_INVALIDCERTFILE"));return}n.CertFile=e,t=!0,s()}var n=e.BAServerEntity,r=this;this.base=c3.task,this.base(localizedString("REGISTSF_TLT_BAS"),100),this.execute=function(){r.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("New-BrowserAccessServer")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))}),u.host&&(n.HostingUnit={},n.HostingUnit.Id=u.host.Id),n.CertFile&&n.CertFile.files&&n.CertFile.files.length>0?readPfxFileContent(n.CertFile,o):s()}}};this.base=c3.dialog,this.base(i),this.BAServerEntity=n,this.view=r;var o=this,u=arguments[0]||undefined;o.setLink=arguments[1]||undefined;var a=new s.register(o),f={taskCount:1,getTask:function(e){if(e==0)return a},finishEvent:[function(){o.readyForFinish()}],successEvent:[function(){e=!0,o.view.reset()}],successMessage:localizedString("MISC_DONE")},l=new multiTaskProcess(f);this.onInit=function(){this.dom.addClass("respoolWizard"),this.view.onInit(),this.content=this.view.getContainer();var e=new loadingWindow;o.loadingWin=e},this.onViewAppear=function(){this.view.onViewAppear(),l.placeAt(this.view.getContainer())},this.getId=function(){return"registerBAServer"},this.getTitle=function(){return localizedString("WIZARD_BASVR_REG")},this.finish=function(){o.disableFinish(),l.start()},this.onClose.push(function(){u&&e&&u.reload()})}function c3B1AHRegister(){var e=!1,t={},n=new c3B1AHRegister.step1(this),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i={register:function(e){var t=e,n=this;this.base=c3.task,this.base(localizedString("REGISTSF_TLT_B1A"),100),this.execute=function(){n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("B1AH")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))}),c3.service.createB1aServer(t,this.ajaxCallBackConfig)}}};this.base=c3.dialog,this.base(r),this.B1aEntity=t,this.view=n;var s=this,o=arguments[0]||undefined,u=new i.register(t),a={taskCount:1,getTask:function(e){if(e==0)return u},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},f=new multiTaskProcess(a);this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),f.placeAt(this.view.getContainer())},this.getId=function(){return"registerB1a"},this.getTitle=function(){return localizedString("WIZARD_B1A_REG")},this.finish=function(){s.disableFinish(),f.start()},this.onClose.push(function(){o&&e&&o.reload()})}function c3XAppRegister(){var e=!1,t={},n=new c3XAppRegister.step1(this),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i={register:function(e){var t=e,n=this;this.base=c3.task,this.base(localizedString("REGISTSF_TLT_XAPP"),100),this.execute=function(){n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("XAPP")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))}),c3.service.createXAppService(t,this.ajaxCallBackConfig)}}};this.base=c3.dialog,this.base(r),this.XAppEntity=t,this.view=n;var s=this,o=arguments[0]||undefined,u=new i.register(t),a={taskCount:1,getTask:function(e){if(e==0)return u},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},f=new multiTaskProcess(a);this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),f.placeAt(this.view.getContainer())},this.getId=function(){return"registerXApp"},this.getTitle=function(){return localizedString("WIZARD_XAPP_REG")},this.finish=function(){s.disableFinish(),f.start()},this.onClose.push(function(){o&&e&&o.reload()})}function c3registerB1Share(){var e=!1,t={},n=new c3registerB1Share.step1(this,arguments[0]),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i=arguments[0]||{},s={register:function(e){var t=e,n=this;this.base=c3.task,this.base(localizedString("REGISTSF_TLT_RSF"),100),this.execute=function(){var e=this.ajaxCallBackConfig;n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("RefreshStorageGrid")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))});switch(i){case"SharedFolder":c3.service.createSharedFolder(t,e);break;case"TenantsStorage":c3.service.createTenantsStorage(t,e);break;case"BackupRepository":c3.service.createBackupRepository(t,e);break;case"ImplementationRepository":c3.service.createImplementationRepository(t,e);break;case"CompanyTemplateRepository":c3.service.createCompanyTemplateRepository(t,e)}}}};this.base=c3.dialog,this.base(r),this.B1ShareEntity=t,this.view=n;var o=this,u=arguments[1]||undefined,a=new s.register(t),f={taskCount:1,getTask:function(e){if(e==0)return a},finishEvent:[function(){o.readyForFinish()}],successEvent:[function(){e=!0,o.view.reset()}],successMessage:localizedString("MISC_DONE")},l=new multiTaskProcess(f);this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),l.placeAt(this.view.getContainer())},this.getId=function(){return"registerB1Share"},this.getTitle=function(){var e=localizedString("WIZARD_SHRFOLDER_REG");switch(i){case"SharedFolder":e=localizedString("RES_SH_FOLDER_REG");break;case"TenantsStorage":e=localizedString("RES_TENANTS_STORAGE_REG");break;case"BackupRepository":e=localizedString("RES_DB_FOLDER_REG");break;case"ImplementationRepository":e=localizedString("REGISTSF_TLT_IRR");break;case"CompanyTemplateRepository":e=localizedString("REGISTSF_TLT_CTRR")}return e},this.finish=function(){o.disableFinish(),l.start()},this.onClose.push(function(){u&&e&&u.reload()})}function c3registerMailer(){var e=!1,t={},n=new c3registerMailer.step1(this),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i={register:function(e){var t=e,n=this;this.base=c3.task,this.base("Registering Mailer",100),this.execute=function(){c3.service.createMailerService(t,this.ajaxCallBackConfig),c3ModuleManager.notifyMessage(new c3Message("New-Mailer"))}}};this.base=c3.dialog,this.base(r),this.MailerEntity=t,this.view=n;var s=this,o=arguments[0]||undefined,u=new i.register(t),a={taskCount:1,getTask:function(e){if(e==0)return u},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},f=new multiTaskProcess(a);this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),f.placeAt(this.view.getContainer())},this.getId=function(){return"registerMailer"},this.getTitle=function(){return localizedString("WIZARD_MAILER_REG")},this.finish=function(){s.disableFinish(),f.start()},this.onClose.push(function(){o&&e&&o.reload()})}function c3registerMailServer(){this.base=c3.wizard,this.base(),this.parent=arguments[0]||undefined,this.MailServer={};var e=this,t=localizedString("MAIL_SERVER_REG_TITLE"),n=[localizedString("MAIL_SERVER_REG_STEP_SMTP"),localizedString("MAIL_SERVER_REG_STEP_OTHER"),localizedString("MISC_PROGRESS&FINISH")],r=[localizedString("MAIL_SERVER_REG_STEP_SMTP_TITLE"),localizedString("MAIL_SERVER_REG_STEP_OTHER_TITLE"),localizedString("MISC_FINISH")],i=[localizedString("MAIL_SERVER_REG_STEP_SMTP_SUBTITLE"),localizedString("MAIL_SERVER_REG_STEP_OTHER_SUBTITLE"),localizedString("MISC_FINISH")];this.onInit=function(){this.steps=[new c3registerMailServer.stepSmtpSettings(this),new c3registerMailServer.stepOtherSettings(this)]},this.getId=function(){return"MailServerRegistrationWizard"},this.getTitle=function(){return t},this.getWelcomeScreen=function(){return undefined},this.getStepCount=function(){return e.steps.length},this.getStepTitle=function(e){return r[e]},this.getStepSubtitle=function(e){return i[e]},this.getStepName=function(e){return n[e]},this.getStep=function(e){return this.steps[e]},this.onFinish=function(){var t={};t.success=function(t){c3ModuleManager.notifyMessage(new c3Message("New-MailServer")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),e.close()},t.error=function(e){},c3.service.createMailServer(e.MailServer,t)},this.clearTask=function(){},this.portValidator=function(e){var t=e.val();if(t&&t!=""){var n=/^\d+$/,r=n.test(t);if(!r||r&&(t<1||t>65535))return e.showErrorMessage(localizedString("VALIDITY_INVALID_PORT")),!1}return!0},this.checkValidity=function(e){var t=!0;for(var n in e)if(e.hasOwnProperty(n)){if(n=="SmtpPort"||n=="SmtpSslPort")if(!this.portValidator(e[n].Value)){t=!1;break}if(!e[n].Value.checkValidity()){t=!1;break}}return t&&this.fetchUIValues(e),t},this.fetchUIValues=function(t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n].Value.val();n=="SmtpHost"&&r!=""?(e.MailServer[n]={},e.MailServer[n].Hostname=r):(r==""&&(r=null),e.MailServer[n]=r)}},this.initializeUI=function(e){var t=$("<div>");for(var n in e)e.hasOwnProperty(n)&&t.append(Utility.CreateRow(e[n].Name,e[n].Value));return t},e.securityValidValues=[];var s=function(t){t.find("option").remove();for(var n=0;n<e.securityValidValues.length;n++){var r=$("<option>").attr({value:e.securityValidValues[n].value}).append(e.securityValidValues[n].text);t.append(r)}};this.initializeUiSecurityValidValues=function(t){if(!t)return;e.securityValidValues.length==0?c3.service.getMailServerSecurityValidValues(function(n){e.securityValidValues.clear();for(var r=0;r<n.data.length;r++)e.securityValidValues.push({text:n.data[r],value:n.data[r]});s(t)}):s(t)}}function c3assignServiceUnits(e){var t=!1,n=[],r=new c3assignServiceUnits.step1(this),i={getActionButtonText:function(){return"Assign"},validator:r.validator};this.controller=e,this.base=c3.dialog,this.base(i),this.suIds=n,this.view=r;var s=this,o=arguments[0]||undefined;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"assignServiceUnits"},this.getTitle=function(){return"Assign Service Units to Reseller"},this.finish=function(){if(this.suIds.length>0){var e={success:function(e,t){o.refreshSU()},error:function(e,t){alert("failed")}};c3.service.assignResources(o.selectedDataItem.ID,"ServiceUnit",this.suIds,null,e||{}),s.close()}},this.onClose.push(function(){o&&t&&o.reload()})}function c3assignCustomer(e){var t=!1,n=[],r=new c3assignCustomer.step1(this),i={getActionButtonText:function(){return"Assign"},validator:r.validator};this.controller=e,this.base=c3.dialog,this.base(i),this.suIds=n,this.view=r,this.Customer_Lic_Mapping=[];var s=this,o=arguments[0]||undefined;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"assignServiceUnits"},this.getTitle=function(){return"Assign Customers to Reseller"},this.finish=function(){if(this.suIds.length>0){var e={success:function(e,t){o.refreshCustomer()},error:function(e,t){var n={error:{message:{value:"failed"}}};Utility.logError(JSON.stringify(n))}},t=[];if(s.Customer_Lic_Mapping&&s.Customer_Lic_Mapping.length>0)for(var n=0;n<s.Customer_Lic_Mapping.length;n++){var r=!1;if(s.suIds&&s.suIds.length>0)for(var i=0;i<s.suIds.length;i++)if(s.Customer_Lic_Mapping[n].CustomerID==s.suIds[i]){r=!0;break}r&&t.push({ResourceID:s.Customer_Lic_Mapping[n].CustomerID,AdditionData:s.Customer_Lic_Mapping[n].InstallationNumber})}c3.service.assignResources(o.selectedDataItem.ID,"Customer",this.suIds,t,e||{}),s.close()}},this.onClose.push(function(){o&&t&&o.reload()})}function c3addSystemUser(){this.base=c3.dialog;var e={getActionButtonText:function(){return localizedString("MISC_ADD")},validator:this.validator};this.base(e);var t="",n=this;n.content=$("<div>");var r=arguments[0]||{};n.mode=arguments[1]||0,n.data=arguments[2],n.isOperator=arguments[3],n.parentModule=arguments[4]||null,n.User=n.mode==0?{}:r.getSelectedItem(),n.User.Role=n.User.Role||{},n.User.Role.__metadata=n.User.Role.__metadata||{};var i=[localizedString("WIZARD_USER_ENTERUSERNAME")+":",localizedString("WIZARD_USER_ALREADYEXISTS")+":","Status:"],s=[new textbox({isRequired:!0,pattern:"^(?:(?:(?:[a-z][-a-z0-9._]+\\)?[a-z][-a-z0-9]+))$"}),new textbox({isRequired:!1}),$("<select>")];n.mode==1&&n.isOperator?(t=localizedString("OPERATOR_EDIT"),e.getActionButtonText=undefined):n.isOperator?t=localizedString("OPERATOR_ADD"):t=localizedString("USER_ADD"),this.getId=function(){return"addUser"},this.getTitle=function(){return t},this.onInit=function(){n.content.append($("<div>").append(i[0])),s[0].css({width:"95%"});var e=$("<div>");s[0].placeAt(e),n.content.append(e);var t=$("<input>").attr({type:"button",value:localizedString("ADDSBOUSER_POPWIN_BTN_CHECKNAME")}).addClass("btnCheck");n.mode==1&&t.attr({disabled:1}),t.click(function(){s[0].checkValidity()&&(n.loadingWin.show(),c3.service.CheckSystemUserExists(s[0].val()).query(function(e){n.loadingWin.close();if(e&&e.data&&e.data.CheckSystemUserExists)o();else{var t=new addDomainUser(s[0].val(),o);t.show()}}))}),n.content.append($("<div>").append(t)),n.content.append($("<div>").append(i[1])),s[1].css({width:"95%"}),s[1].attr({textReadonly:""}),s[1].bind("keydown",function(e){e.preventDefault()}),n.chkArea=s[1];var r=$("<div>").css({"border-bottom":"1px solid #CCCCCC","padding-bottom":"20px","margin-bottom":"0"});s[1].placeAt(r),n.content.append(r),n.content.append(Utility.CreateRow(i[2],s[2])),n.mode==1&&(s[0].attr({readonly:1}),s[0].attr({value:n.data.domainUserName}),o()),a();var u=new loadingWindow;n.loadingWin=u},this.clearControls=function(){s[0]&&s[0].val(""),s[1]&&s[1].val(""),s[2]&&s[2].val("Active"),n.readyForFinish(),n.User={},n.User.Role={},n.User.Role.__metadata={},this.onViewAppear()};var o=function(){var e,t,r;r=s[0].val().split("\\"),r.length>1?(e=r[0],t=r[1],n.chkArea.attr({value:e+"\\"+t}),n.User.OSUserBinding=t,n.User.Domain=e):c3.service.getDomainName().query(function(e){t=r[0],null!=t&&t!==""&&(n.chkArea.attr({value:e.data.GetDomainName+"\\"+t}),n.User.OSUserBinding=t,n.User.Domain=e.data.GetDomainName,c3.service.getOSUserBindings().expand("User").filter(String.format("SystemUser eq '{0}' and User/Deleted eq {1}",t,!1)).query(function(e){if(e.data.length>0){var t=e.data[0].User.ID,r={};r.ID=t,c3.service.getRolesByUser(r,function(e){e.data=e.d.results,e.data.length>0&&(e.data[0].ID==1?n.User.ID=t:n.User.ID=t)})}}))})};validator={validEvent:[],checkValidity:function(){n.disableFinish();var e=!1;return n.mode==0?(e=s[0].checkValidity(),e?(n.loadingWin.show(),c3.service.CheckSystemUserExists($.trim(s[0].val())).query(function(e){n.loadingWin.close();if(e&&e.data&&e.data.CheckSystemUserExists)o(),u();else{var t=new addDomainUser(s[0].val(),o);t.show(),n.readyForFinish()}})):n.readyForFinish()):(e=!0,n.finish()),e}},e.validator=validator;var u=function(){n.isOperator?c3.service.getOSUserBindings(undefined).filter("SystemUser eq '"+n.User.Name.toLowerCase()+"' and User/Deleted eq false").query(function(e){e&&e.data&&0<e.data.length?(s[0].showErrorMessage(localizedString("OPERATOR_EXISTED")),n.readyForFinish()):n.finish()}):c3.service.findCustomerByUser(n.User.Name,function(e){null!=e.d&&0<e.d.results.length?(s[0].showErrorMessage(localizedString("USED_BY_OTHER_CUSTOMER")),n.readyForFinish()):operatorManager.getOperators(function(e){if(e&&e.length>0){var t=!1;for(var r=0;r<e.length;r++)if(e[r].domainUserName.toLowerCase()==$.trim(s[0].val()).toLowerCase()){n.parentModule&&n.parentModule=="customer"?c3.hasPermission([permissionItems.operator])?s[0].showErrorMessage(localizedString("ADDSYSUSER_WIN_CANNOTADDOPT")):s[0].showErrorMessage(localizedString("ADDSYSUSER_WIN_CANNOTADDRSLOPT")):n.parentModule&&n.parentModule=="reseller"&&s[0].showErrorMessage(localizedString("ADDSYSUSER_WIN_CANNOTADDOPT_RESELLER")),t=!0,n.readyForFinish();break}t||n.finish()}else n.finish()})})},a=function(){s[0].bind("change",function(){var e=s[0].val().split("\\");n.User.Name=e[e.length==1?0:1],s[1].attr({value:""})}),s[2].bind("change",function(){n.User.Status=s[2].val()})};this.onViewAppear=function(){c3.service.getUserStatus(function(e){var t=s[2];t.find("option").remove();var r=null;for(var i=0;i<e.data.length;i++)r=$("<option>").attr({value:e.data[i]}).append(e.data[i]),n.User&&n.User.Status==e.data[i]&&r.attr({selected:"selected"}),t.append(r);n.mode==1&&s[2].val(n.data.status),n.User.Status=s[2].val()})},this.finish=function(){this.disableFinish(),n.mode==0&&(n.User.Deleted=!1);var e={};e.success=function(e,t){r&&r.reload(),n.close()},e.error=function(e,t){n.readyForFinish()};if(n.finishEvent.length>0){for(var t=0;t<n.finishEvent.length;t++)n.finishEvent[t]();n.close()}else if(n.mode==0){var i={},s=[],o=!1,u={};i.success=function(t){s=t.d.results;for(var r=0;r<s.length;r++)if(s[r].SystemUsername==n.User.Name){o=!0,u.RoleId=s[r].Roles.results[0].ID,u.Id=s[r].ID;break}if(o&&u.RoleId==1){var i={};i.ID=u.Id,i.Status=n.User.Status,c3.service.updateUser(i,e)}else{var a={systemUsername:n.User.Name,domain:n.User.Domain,status:n.User.Status,isDomainAdministrator:n.User.IsDomainAdministrator,roles:[{id:1}]};c3.service.createOperator(a,e)}},i.error=function(e){};var a={};c3.service.getAllUserDetails(a,i)}else{var f={};f.ID=n.User.id,f.Status=n.User.Status,c3.service.updateUser(f,e)}}}function addDomainUser(){function u(){var e=n[0].value.val(),r=n[1].value.val(),s={success:function(n){n.d&&n.d.AddDomainUser==1&&t&&t(e),i.close()},error:function(e){i.close()}};c3.service.addDomainUser(e,r,s)}var e=arguments[0],t=arguments[1],n=[{name:localizedString("ADDSYSUSER_LABEL_USERNAME"),value:new textbox({isRequired:!0})},{name:localizedString("LOGIN_LABEL_PASSWORD"),value:new textbox({isRequired:!0,type:"password"})},{name:localizedString("ADDSYSUSER_LABEL_CFPSW"),value:new textbox({isRequired:!0,type:"password"})}],r={getActionButtonText:function(){return"Yes"},getCloseButtonText:function(){return"No"}};this.base=c3.dialog,this.base(r),this.getId=function(){return"addDomainUser"},this.getTitle=function(){return localizedString("MISC_CONFIRM")},this.getWidth=function(){return 380},this.getHeight=function(){return 230};var i=this,s=null;i.content=$("<div>"),i.selectedSW="",this.onInit=function(){i.content.append($("<div>").append(localizedString("ADDSYSTEMUSER_POPWIN_USERNOTEXISTED")+"<br/>"));for(var e=0;e<n.length;e++){var t=Utility.CreateRow(n[e].name,n[e].value.attr({width:"90px"}));i.content.append(t)}},this.onViewAppear=function(){n[0].value.val(e)};var o={checkValidity:function(){if(n[0].value.val()!=""&&n[1].value.val()!=""&&n[2].value.val()!=""){if(n[1].value.val().length<8)return n[1].value.showErrorMessage(localizedString("ADDSYSTEMUSER_POPWIN_PASSWORD_STRATEGY")),!1;if(n[1].value.val()!=n[2].value.val())return n[2].value.showErrorMessage(localizedString("ADDSYSTEMUSER_POPWIN_PASSWORD_NOTMATCH")),!1}return n[0].value.checkValidity()&&n[1].value.checkValidity()&&n[2].value.checkValidity()}};r.validator=o,this.finish=function(){u()}}function c3enterDomainAdminCredentials(){var e={getActionButtonText:function(){return localizedString("MISC_ADD")}};this.base=c3.dialog,this.base(e);var t=arguments[0],n=[{name:localizedString("ADDSYSTEMUSER_POPWIN_COLUMN_ACCOUNT"),value:new textbox({isRequired:!0})},{name:localizedString("ADDSYSTEMUSER_POPWIN_COLUMN_ACCOUNTPSW"),value:new textbox({isRequired:!0,type:"password"})}];this.getId=function(){return"enterAdminUser"},this.getTitle=function(){return localizedString("ADDSYSTEMUSER_POPWIN_CDTIALINFO")},this.getWidth=function(){return 380},this.getHeight=function(){return 180};var r=this,i=null;r.content=$("<div>"),r.selectedSW="",this.onInit=function(){for(var e=0;e<n.length;e++){var t=Utility.CreateRow(n[e].name,n[e].value.attr({width:"80px"}));r.content.append(t)}var i=$("<input>").attr({type:"checkbox"});r.CkbRemember=i,r.content.append($("<div>").append(i).append(localizedString("ADDSYSTEMUSER_POPWIN_RMBCDTIAL")).css({"padding-left":"37%","padding-top":"5px"}))},this.onViewAppear=function(){};var s={checkValidity:function(){return n[0].value.checkValidity()&&n[1].value.checkValidity()}};e.validator=s,this.finish=function(){var e=n[0].value.val(),i=n[1].value.val(),s=r.CkbRemember[0].checked,o=function(e){e.d&&e.d.SetPrivilegeCredential==1&&(t&&t(),r.close())};c3.service.setPrivilegeHandler(e,i,s,o)}}function c3addCustomerUsers(){function o(e,n,i){if(!r.InstallationNumber||r.InstallationNumber=="-1"||r.InstallationNumber==""){t.flag++;if(t.flag==t.selectedItems.length){t.finish();return}}r.InstallationNumber&&r.InstallationNumber!="-1"&&r.InstallationNumber!=""&&c3.service.checkSBOUser(e,n,r.InstallationNumber,r.CustomerID===undefined?null:r.CustomerID).query(function(n){var s=n.data.CheckSBOUser;if(!s)return u(i,e),$(t.view.errorPanel).text(String.format(localizedString("ADDCUSTOMERUSER_POPWIN_USEDBYANOTHERCTM"),e,r.InstallationNumber)),!1;t.flag++;if(t.flag==t.selectedItems.length){t.finish();return}})}function u(e,t){if(e.size()>0)for(var n=0;n<e.length;n++)if($(e[n]).val()==t){$(e[n]).select();break}}this.base=c3.dialog;var e={getActionButtonText:function(){return localizedString("MISC_SAVE")},validator:this.validator};this.base(e);var t=this,n=arguments[0]||undefined,r=arguments[1]||undefined,i=arguments[2]||!1,s=new c3addCustomerUsers.step1(this,r,i);this.view=s,t.flag=0,this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return localizedString("ADDCUSTOMERUSER_POPWIN_TLT")},this.getWidth=function(){return 650},this.getHeight=function(){return 620},this.finish=function(){if(t.finishEvent&&t.finishEvent.length>0)for(var e=0;e<t.finishEvent.length;e++)t.finishEvent[e]();t.close()},validator={validEvent:[],checkValidity:function(){t.view.errorPanel&&$(t.view.errorPanel).text("");if(t.selectedItems.length==0)return t.finish(),!0;var e=t.view.body.find("table"),n=null;e.size()>0&&(n=$(e).find('input[type="text"]'));for(var r=0;r<t.selectedItems.length;r++){if(t.selectedItems[r].B1Username==null||t.selectedItems[r].B1Username.length==0)return u(n,t.selectedItems[r].B1Username),$(t.view.errorPanel).text(localizedString("ADDCUSTOMERUSER_POPWIN_NOUSERCODE")),!1;var i=/^([0-9a-zA-Z-_.]){0,}$/;if(!i.test(t.selectedItems[r].B1Username))return u(n,t.selectedItems[r].B1Username),$(t.view.errorPanel).text("* "+localizedString("VALIDITY_PATTERNMISMATCH")),!1}for(var s=0;s<t.selectedItems.length;s++)for(var a=0;a<t.selectedItems.length;a++)if(s!=a&&t.selectedItems[s].B1Username.toUpperCase()==t.selectedItems[a].B1Username.toUpperCase())return t.view.errorPanel&&$(t.view.errorPanel).text(String.format(localizedString("ADDCUSTOMERUSER_POPWIN_REPEATED"),t.selectedItems[s].B1Username)),u(n,t.selectedItems[a].B1Username),!1;t.flag=0;for(var s=0;s<t.selectedItems.length;s++)o(t.selectedItems[s].B1Username,t.selectedItems[s].SystemUsername,n);return!0}},e.validator=validator}function c3loadTenantUsers(){function s(e,n,i){c3.service.checkSBOUser(e,n,r.InstallationNumber,r.CustomerID===undefined?null:r.CustomerID).query(function(n){var s=n.data.CheckSBOUser;if(!s){t.view.errorPanel&&$(t.view.errorPanel).text(String.format(localizedString("ADDCUSTOMERUSER_POPWIN_USEDBYANOTHERCTM"),e,r.InstallationNumber));var o=[i];return t.view.gridView.getDelegate().getDefaultSelectedIndex=function(){return o.length>0?o:-1},t.view.gridView.reload(),!1}t.flag++;if(t.flag==t.selectedItems.length){t.finish();return}})}this.base=c3.dialog;var e={getActionButtonText:function(){return localizedString("MISC_SAVE")},validator:this.validator};this.base(e);var t=this,n=arguments[0]||undefined,r=arguments[1]||undefined,i=new c3loadTenantUsers.step1(this,r);this.view=i,t.flag=0,this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return localizedString("LOADTENANTUSER_POPWIN_TLT")},this.getWidth=function(){return 750},this.getHeight=function(){return 600},this.finish=function(){if(t.finishEvent&&t.finishEvent.length>0)for(var e=0;e<t.finishEvent.length;e++)t.finishEvent[e]();t.close()},validator={validEvent:[],checkValidity:function(){t.view.errorPanel&&$(t.view.errorPanel).text(""),t.selectedItems=[];for(var e=0;e<t.view.TenantUsers.length;e++)if(t.view.TenantUsers[e].SystemUsername!=""&&t.view.TenantUsers[e].Action<t.view.Actions.stExists){for(var n=0;n<t.view.TenantUsers.length;n++)if(e!=n&&t.view.TenantUsers[e].SystemUsername.toUpperCase()==t.view.TenantUsers[n].SystemUsername.toUpperCase()){t.view.errorPanel&&$(t.view.errorPanel).text(String.format(localizedString("LOADTENANTUSER_POPWIN_REPEATED"),t.view.TenantUsers[e].SystemUsername));var i=[e,n];return t.view.gridView.getDelegate().getDefaultSelectedIndex=function(){return i.length>0?i:-1},t.view.gridView.setDoNotSortFlag(!0),t.view.gridView.reload(),!1}t.view.TenantUsers[e].RowIndex=e,t.selectedItems.push(t.view.TenantUsers[e])}if(t.selectedItems.length<=0)return t.finish(),!0;if(r.InstallationNumber&&r.InstallationNumber!="-1"&&r.InstallationNumber!=""){t.flag=0;for(var e=0;e<t.selectedItems.length;e++)s(t.selectedItems[e].B1Username,t.selectedItems[e].SystemUsername,t.selectedItems[e].RowIndex)}return!0}},e.validator=validator}function c3assignLicense(){this.base=c3.dialog,this.base(),this._container=$("<div>");var e=localizedString("TNT_BTN_ASSIGNLIC"),t=this;t.content=$("<div>");var n=arguments[0]||{},r=arguments[1]||0;t.TenantEntity={},t.TenantEntity.Id=n.getTenant().ID,t.TenantEntity.__metadata={},t.TenantEntity.__metadata.uri=n.getTenant().__metadata.uri;var i=localizedString("ASSIGNLIC_LABEL_USERSDEFINING"),s=localizedString("ASSIGNLIC_LABEL_USERDETAIL"),o=localizedString("ASSIGNLIC_LABEL_CPYDB"),u=$("<div>"),a=$("<div>"),f=[{name:"Status",description:localizedString("COLUMN_STATUS"),type:"text",width:"15%"},{name:"B1UserName",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"25%"},{name:"Name",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"20%"},{name:"IsSuperUser",description:localizedString("COLUMN_ISSUPERUSER"),type:"text",width:"20%"},{name:"IsPowerUser",description:localizedString("B1_POWERUSER"),type:"text",width:"20%"}],l=[{name:"Description",description:localizedString("COLUMN_B1USERTYPELIC"),type:"text",width:"36%"},{name:"Used",description:localizedString("COLUMN_USED"),type:"text",width:"12%"},{name:"Available",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"21%"},{name:"TotalQuota",description:localizedString("COLUMN_QUOTA"),type:"text",width:"30%"}],c=null,h=[];t.gridDatau=h;var p={getHeaderSpec:function(){return f},getRowCount:function(){return h.length},getRow:function(e){return h[e]},getGridHeight:function(){return 200},getDefaultSelectedIndex:function(){return r}};t.checkBoxDoms=[];var d=null,v=[],m={getHeaderSpec:function(){return l},getRowCount:function(){return v.length},getRow:function(e){return v[e]},getGridHeight:function(){return 185}},g=$("<select>").css({height:"20px",border:"1px solid #CCCCCC"}).append($("<option>").append("Company 1")),y=$("<input>").attr({type:"button",value:localizedString("MISC_REMOVE")});y.click(function(){h.remove(r),c.reload()}),this.getId=function(){return"addUser"},this.getTitle=function(){return e},this.onInit=function(){var e=$("<div>").addClass("tblUp");c=e.gridview({delegate:p}),c.rowSelectedEvent.push(function(){r=this.index,d.UpSelectedRowData=this.data;if(d.onRefresh)for(var e=0;e<d.onRefresh.length;e++)d.onRefresh[e]()});var n=$("<div>").addClass("tblDown");d=n.gridview({delegate:m}),t.content.append(e),t.content.append(n);var i=new loadingWindow;t.processingWin=i;var s=new loadingWindow;t.loadingLicModule=s};var b=function(){if(!n.tenant.LicenseFile_ID){t.loadingLicModule.close(),log.warning(0,localizedString("TENANT_LICENSEFILE_UNAVAILABLE"),null);return}c3.service.getLicenseModulesPerCustomer(n.tenant.LicenseFile_ID,n.tenant.Customer_ID).query(function(e){t.loadingLicModule.close(),v=e.data;for(var n=0;n<e.data.length;n++)e.data[n].TotalQuota==null&&(e.data[n].TotalQuota=localizedString("UNLIMTIED"));m.getCell=function(){if(1==this.col){var e=$("<input>").attr({type:"checkbox",disabled:"disabled"}),t=$("<label>").text(parseInt(this.data.Available));this.data.CountLabel=t,this.data.CheckBox=e;var n=this;return d.onRefresh.push(function(){if(0<d.UpSelectedRowData.LicenseModules.length)for(var t=0;t<d.UpSelectedRowData.LicenseModules.length;t++){if(d.UpSelectedRowData.LicenseModules[t]==n.data.Type){e.attr("checked")||e.attr({checked:!0});break}e.attr("checked")&&e.attr({checked:!1})}else e.attr("checked")&&e.attr({checked:!1})}),e.bind("click",{gridData:this.data},function(t){var n={},r="";n=$(t.data.gridData.CountLabel).text().split("/"),n.length==2?r="/"+parseInt(n[1]):r="";var i=parseInt($(t.data.gridData.CountLabel).text());if(0>=i&&$(this).attr("checked"))$(this).attr({checked:!1});else if(0==i&&!$(this).attr("checked")){$(t.data.gridData.CountLabel).text(++i+r),++t.data.gridData.Available;for(var s=0;s<d.UpSelectedRowData.LicenseModules.length;s++)if(t.data.gridData.Type==d.UpSelectedRowData.LicenseModules[s]){d.UpSelectedRowData.LicenseModules.remove(s);if(d.UpSelectedRowData.ToDo==undefined||d.UpSelectedRowData.ToDo=="Modify")d.UpSelectedRowData.ToDo="AssignLicense";break}}else{if(d.UpSelectedRowData.ToDo==undefined||d.UpSelectedRowData.ToDo=="Modify")d.UpSelectedRowData.ToDo="AssignLicense";if(e.attr("checked"))$(t.data.gridData.CountLabel).text(--i+r),--t.data.gridData.Available,d.UpSelectedRowData.LicenseModules.push(t.data.gridData.Type);else{$(t.data.gridData.CountLabel).text(++i+r),++t.data.gridData.Available;for(var s=0;s<d.UpSelectedRowData.LicenseModules.length;s++)if(t.data.gridData.Type==d.UpSelectedRowData.LicenseModules[s]){d.UpSelectedRowData.LicenseModules.remove(s);break}}}}),e}if(2==this.col)return this.data.CountLabel?(this.data.CountLabel.text(this.data.CountLabel.text()+"/"+this.data.Total),this.data.CountLabel):0},d.onRefresh=[],d.reload();if(h.length>0){d.UpSelectedRowData=h[r];if(d.onRefresh)for(var n=0;n<d.onRefresh.length;n++)d.onRefresh[n]();E()}})},w=function(){var e=n.getUsers(),t=[];for(var r=0;r<e.length;r++)$.extend(!0,t,e);h.clear();for(var r=0;r<t.length;r++)h.push(t[r]);c.reload()};this.onViewAppear=function(){t.loadingLicModule.show(),c.show(),d.show(),w(),b(),c3.service.getUserStatus(function(e){t.UserStatusData=e.data,p.getCell=function(){if(this.colName=="Status"){var e=null,n={};return n.text=this.data[this.colName],n.textalign="center",e=new statusControl(n),e}if(this.colName=="IsSuperUser"){var r=this.data,i=this.row,s=$("<input>").attr({type:"checkbox",disabled:1});s.attr({checked:this.data[this.colName]==1?1:0}),this.data.RoleId==1?s.attr({disabled:0}):s.attr({disabled:1});var o=!1;for(var u=0;u<t.checkBoxDoms.length;u++)if(t.checkBoxDoms[u].index==this.row){o=!0,t.checkBoxDoms[u].SuperUser==null&&(t.checkBoxDoms[u].SuperUser=s);break}return o||t.checkBoxDoms.push({index:this.row,SuperUser:s}),s.bind("click",function(){r.IsSuperUser=$(this).attr("checked"),r.ToDo==undefined&&(r.ToDo="Modify");for(var e=0;e<t.checkBoxDoms.length;e++)i==t.checkBoxDoms[e].index&&t.checkBoxDoms[e].PowerUser!=null&&(r.IsSuperUser==1?t.checkBoxDoms[e].PowerUser.attr({disabled:!0,checked:!0}):t.checkBoxDoms[e].PowerUser.removeAttr("disabled"))}),s}if(this.colName=="IsPowerUser"){var r=this.data,s=$("<input>").attr({type:"checkbox"});s.attr({checked:this.data[this.colName]==1?1:0}),this.data["IsSuperUser"]==1&&s.attr("disabled",!0);var o=!1;for(var u=0;u<t.checkBoxDoms.length;u++)if(t.checkBoxDoms[u].index==this.row){o=!0,t.checkBoxDoms[u].PowerUser==null&&(t.checkBoxDoms[u].PowerUser=s);break}return o||t.checkBoxDoms.push({index:this.row,PowerUser:s}),s.bind("click",function(){r.IsPowerUser=$(this).attr("checked"),r.ToDo==undefined&&(r.ToDo="Modify")}),s}},c.reload()}),t.readyForFinish()};var E=function(){for(var e=0;e<v.length;e++)v[e].CheckBox!=undefined&&v[e].CheckBox.attr({disabled:!1})},S=function(){for(var e=0;e<v.length;e++)v[e].CheckBox!=undefined&&v[e].CheckBox.attr({disabled:!0})},x=function(e){t.TenantEntity.Users=[];var n=null;for(var r=0;r<e.length;r++){n={Id:e[r].Id,Tenant:{Id:t.TenantEntity.Id},Name:e[r].Name,B1UserName:e[r].B1UserName,IsSuperUser:e[r].IsSuperUser,IsPowerUser:e[r].IsPowerUser,Role:{Id:e[r].RoleId},Status:e[r].Status,LicenseModules:[]};for(var i=0;i<e[r].LicenseModules.length;i++)n.LicenseModules.push({Type:e[r].LicenseModules[i]});n.ToDo=e[r].ToDo,t.TenantEntity.Users.push(n)}},T=function(){x(t.gridDatau);var e=[];for(var r=0;r<t.TenantEntity.Users.length;r++){var i=t.TenantEntity.Users[r],s=null;if(i.ToDo=="AssignLicense"||i.ToDo=="Modify"){var o=N(i);s={Id:i.Id,LicenseModules:o,Status:i.Status,B1UserName:i.B1UserName,IsSuperUser:i.IsSuperUser,IsPowerUser:i.IsPowerUser},e.push({ToDo:i.ToDo,Data:s})}}if(e.length>0){t.processingWin.show();var u=e.length,a={success:function(e,t){f()},error:function(e,t){f()}},f=function(){t.processingWin.close(),n.reloadUser(),t.close()},l=[];for(var r=0;r<u;r++)if(e[r].ToDo=="AssignLicense"||e[r].ToDo=="Modify"){var c={};c.id=e[r].Data.Id,c.systemUsername=e[r].Data.Name,c.sboUsername=e[r].Data.B1UserName,c.isSuperSBOUser=e[r].Data.IsSuperUser!=null?e[r].Data.IsSuperUser:!1,c.isPowerSBOUser=e[r].Data.IsSuperUser!=null&&e[r].Data.IsPowerUser==1?!0:!1,c.status=e[r].Data.Status!=null?e[r].Data.Status:"Active";if(e[r].ToDo=="AssignLicense"){var h=[];if(e[r].Data.LicenseModules!=null){var p=e[r].Data.LicenseModules,d=p.split(",");for(var v=0;v<d.length;v++)d[v].length>0&&h.push({type:d[v]})}c.licenseModules=h}l.push(c)}l&&l.length>0?c3.service.updateTenantUser(n.tenant.ID,l,a):t.close()}else t.close()},N=function(e){var t="";for(var n=0;n<e.LicenseModules.length;n++)n==e.LicenseModules.length-1?t+=e.LicenseModules[n].Type:t+=String.format("{0},",e.LicenseModules[n].Type);return t};this.onFinish=function(){T()}}function c3assignLicFileToReseller(e){var t=!1,n=[],r=new c3assignLicFileToReseller.step1(this),i={getActionButtonText:function(){return"Assign"},validator:r.validator};this.controller=e,this.base=c3.dialog,this.base(i),this.licenseFiles=n,this.view=r;var s=this,o=arguments[0]||undefined;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"assignServiceUnits"},this.getTitle=function(){return"Assign License File to Reseller"},this.finish=function(){if(this.licenseFiles.length>0){var e={success:function(e,t){o.refreshLicFile()},error:function(e,t){alert("failed")}},t=this,n=t.controller.selectedDataItem.Group.ID,r=function(e){var t=[];for(var n=0;n<e.length;n++)t.indexOf(e[n].LicenseServer.ID)<0&&t.push(e[n].LicenseServer.ID);return t.sort()},i=function(e){var t=[];for(var n=0;n<e.length;n++)t.indexOf(e[n].ID)<0&&t.push(e[n].ID);return t.sort()},u=function(e,t,n){var r=e.length,i=!1,s=[],o=[],u={success:function(e){if(e.d.results!==undefined&&e.d.results.length>0)for(var u=0;u<e.d.results.length;u++)e.d.results[u].ID!=t&&(i=!0,s.toLocaleString().indexOf(e.d.results[u].ID,0)<0&&(s.push(e.d.results[u].ID),o.push(e.d.results[u].Name)));r--,r==0&&n(i,s,o)},error:function(e){r--,r==0&&n(i,s,o)}};for(var a=0;a<e.length;a++){var f=e[a];c3.service.getAssigningResellers("License",f,u)}};u(i(t.licenseFiles),o.selectedDataItem.ID,function(n,r,s){if(n){var u=MessageBox.confirm({msg:localizedString("WIZARD_RESELLER_DUPLICATE_LICENSE"),height:"190"});u.yesEvent.push(function(){c3.service.assignResources(o.selectedDataItem.ID,"License",i(t.licenseFiles),null,e||{})})}else c3.service.assignResources(o.selectedDataItem.ID,"License",i(t.licenseFiles),null,e||{})}),s.close()}},this.onClose.push(function(){o&&t&&o.reload()})}function c3newSWRepository(){var e=!1,t={},n=new c3newSWRepository.step1(this),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i={register:function(e){var t=e,n=this;this.base=c3.task,this.base("Registering",100),this.execute=function(){c3.service.createSWRepository({RootURI:$.trim(t.RootURI),Description:$.trim(t.Description)},this.ajaxCallBackConfig)},this.doneEvent.push(function(e){var t=e.data.Version,n=e.data.UpgradeWizardURI;c3ModuleManager.notifyMessage(new c3Message("New-SWRepository")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))})}};this.base=c3.dialog,this.base(r),this.SWRepositoryEntity=t,this.view=n;var s=this,o=arguments[0]||undefined;registerTask=new i.register(t),taskDelegate={taskCount:1,getTask:function(e){if(e==0)return registerTask},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},taskMgr=new multiTaskProcess(taskDelegate),this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),taskMgr.placeAt(this.view.getContainer())},this.getId=function(){return"newSWRepository"},this.getTitle=function(){return localizedString("WIZARD_SWREPO_REG")},this.finish=function(){s.disableFinish(),taskMgr.start()},this.onClose.push(function(){o&&e&&o.reload()})}function c3importLicenseFile(){var e=this;e.parent=arguments[0]||{},e.licenseServer=arguments[1]||{},e.licenseFiles=arguments[2]||{};var t=new c3importLicenseFile.step1(e,e.licenseServer,e.licenseFiles,e.parent),n=localizedString("IMPORTLIC_POPWIN_TLT"),r={getActionButtonText:function(){return localizedString("MISC_CLOSE")},hideCloseButton:!0};this.base=c3.dialog,this.base(r),this.view=t;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return n},this.finish=function(){e.close()}}function c3importLicenseFileConfimation(){var e=this;e.parent=arguments[0]||{};var t=arguments[1]||{},n=arguments[2]||{},r=arguments[3]||{},i=new c3importLicenseFileConfimation.step1(e,t,n),s=localizedString("IMPORTLIC_POPWIN_CONFIRM_TLT"),o={getActionButtonText:function(){return localizedString("BTN_OVERWRITE")}};this.base=c3.dialog,this.base(o),this.view=i;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return s},this.getHeight=function(){return 630},this.finish=function(){var t=new loadingWindow;t.show(),c3.service.importLicenseFile(r,function(n){console.log(n),e.close(),t.close(),e.parent!=null&&e.parent.close!=null&&e.parent.close()})}}function c3importAddOn(){this.base=c3.wizard,this.base();var e=localizedString("WIZARD_SWREPO_EXTENSION_TITLE"),t=localizedString("WIZARD_SWREPO_EXTENSION_WEL_TITLE"),n=localizedString("WIZARD_SWREPO_EXTENSION_WEL_CONTENT"),r=[localizedString("WIZARD_SWREPO_EXTENSION_UPLOAD_CONFIG"),localizedString("WIZARD_SWREPO_EXTENSION_IMPORT_FINISH")],i=[localizedString("WIZARD_SWREPO_EXTENSION_UPLOAD_CONFIG"),localizedString("WIZARD_SWREPO_EXTENSION_UPLOAD_STATUS")],s=[localizedString("WIZARD_SWREPO_EXTENSION_UPLOAD_CONFIGFILE"),""],o=this,u=arguments[0]||undefined;this.UploadQueue={},this.UploadNumber=0,this.onInit=function(){this.steps=[new c3importAddOn.step1(this),new c3importAddOn.step2(this)]},this.getId=function(){return"importAddOnWizard"},this.getTitle=function(){return e},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(t,n)},this.getStepCount=function(){return r.length},this.getStepTitle=function(e){return i[e]},this.getStepSubtitle=function(e){return s[e]},this.getStepName=function(e){return r[e]},this.getStep=function(e){return this.steps[e]},this.finish=function(e){u.reload()}}function c3importDynamicKey(){var e=this;e.parent=arguments[1]||{};var t=new c3importDynamicKey.step1(e,e.parent),n=localizedString("ImportDKeyTitle"),r={getActionButtonText:function(){return localizedString("DATAFORM_IMPORT")},hideCloseButton:!1,validator:t.validator};e.winDelegate=r,this.base=c3.dialog,this.base(r),this.view=t,this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return n},this.finish=function(){e.disableFinish(),this.view.importDkey()},this.getWidth=function(){return 600},this.getHeight=function(){return 340}}function c3exportDynamicKey(){var e=this;e.parent=arguments[1]||{};var t=new c3exportDynamicKey.step1(e,e.parent),n=localizedString("ExportDKeyTitle"),r={getActionButtonText:function(){return localizedString("DATAFORM_EXPORT")},hideCloseButton:!1,validator:t.validator};e.winDelegate=r,this.base=c3.dialog,this.base(r),this.view=t,this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return n},this.finish=function(){this.view.exportDkey()},this.getWidth=function(){return 450},this.getHeight=function(){return 255}}function c3registerImplRepository(){var e=!1,t={},n=new c3registerImplRepository.step1(this),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i={register:function(e){var t=e,n=this;this.base=c3.task,this.base(localizedString("REGISTSF_TLT_IRR"),100),this.execute=function(){c3.service.createImplementationRepository(t,this.ajaxCallBackConfig),n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("New-PackageRepository")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))})}}};this.base=c3.dialog,this.base(r),this.PackageRepositoryEntity=t,this.view=n;var s=this,o=arguments[0]||undefined,u=new i.register(t),a={taskCount:1,getTask:function(e){if(e==0)return u},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},f=new multiTaskProcess(a);this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),f.placeAt(this.view.getContainer())},this.getId=function(){return"registerPackageRepository"},this.getTitle=function(){return localizedString("REGISTSF_TLT_PRR")},this.finish=function(){s.disableFinish(),f.start()},this.onClose.push(function(){o&&e&&o.reload()})}function c3registerCompanyTemplateRepository(){var e=!1,t={},n=new c3registerCompanyTemplateRepository.step1(this),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i={register:function(e){var t=e,n=this;this.base=c3.task,this.base(localizedString("REGISTSF_TLT_CTRR"),100),this.execute=function(){c3.service.createCompanyTemplateRepository(t,this.ajaxCallBackConfig),n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("RefreshStorageGrid")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))})}}};this.base=c3.dialog,this.base(r),this.CompanyTemplateRepositoryEntity=t,this.view=n;var s=this,o=arguments[0]||undefined,u=new i.register(t),a={taskCount:1,getTask:function(e){if(e==0)return u},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},f=new multiTaskProcess(a);this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),f.placeAt(this.view.getContainer())},this.getId=function(){return"registerCompanyTemplateRepository"},this.getTitle=function(){return localizedString("REGISTSF_TLT_CTRR")},this.finish=function(){s.disableFinish(),f.start()},this.onClose.push(function(){o&&e&&o.reload()})}function c3tenantPreUpgrade_errorMessage(){this.base=c3.dialog;var e=null,t=arguments[3]||null;t==1?e={getActionButtonText:function(){return localizedString("PREUPGERROR_BTN_CONFIRM")}}:e={getActionButtonText:function(){return localizedString("MISC_DONE")},hideCloseButton:!0},this.base(e);var n=this,r=arguments[0]||undefined,i=arguments[1]||undefined,s=arguments[2]||undefined,o=arguments[4]||[],u=new c3tenantPreUpgrade_errorMessage.step1(this,i,s,t,o);this.view=u,this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return localizedString("PREUPGERROR_POPWIN_TLT")},this.finish=function(){if(n.finishEvent&&n.finishEvent.length>0)for(var e=0;e<n.finishEvent.length;e++)n.finishEvent[e]();this.close()},validator={validEvent:[],checkValidity:function(){var e=null;for(var t=0;t<o.length;t++)if(o[t].TenantID==s){e=o[t];break}var r=0;for(var t=0;t<i.length;t++)i[t].Type=="Warning"&&r++;if(e&&e.ConfirmItems.length!=r)return alert(localizedString("TNT_UPGRADE_CONFIRMCKITEM_ERROR")),!1;e&&(e.AllConfirmed=!0),n.finish()}},e.validator=validator}function c3activeConnections(){this.base=c3.dialog;var e={getActionButtonText:function(){return localizedString("MISC_DONE")},hideCloseButton:!0};this.base(e);var t=this,n=arguments[0]||undefined,r=arguments[1]||undefined,i=new c3activeConnections.step1(this,r);this.view=i,this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return localizedString("ATVCONCTION_POPWIN_TLT")}}function c3activeCompanyDBConnections(){this.base=c3.dialog;var e={getActionButtonText:function(){return localizedString("MISC_OK")},getCloseButtonText:function(){return localizedString("MISC_CANCEL")}};this.base(e);var t=this,n=arguments[0]||undefined,r=arguments[1]||undefined,i=new c3activeCompanyDBConnections.step1(this,r);this.view=i,this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return localizedString("ATVCONCTION_POPWIN_TLT")},this.finish=function(){this.close()}}function c3extensionInstall(){this.parent=arguments[0]||undefined,this.config=arguments[1]||undefined,this.base=c3.wizard;var e=function(){s.parent&&s.parent.reload()};this.base(e),this.AddonEntity={};var t=localizedString("EXTENSION_TITLE"),n=[localizedString("EXTENSION_STEP_NAME_FIRST"),localizedString("MISC_PROGRESS&FINISH")],r=[localizedString("EXTENSION_STEP_NAME_FIRST"),localizedString("MISC_FINISH")],i=[localizedString("EXTENSION_STEP_TITLE_FIRST"),localizedString("EXTENSION_STEP_SUBTITLE_SECOND")];this.AddonEntity.CommonDatabase=this.parent.host.CommonDatabase.ID,this.AddonEntity.SuID=this.parent.host.ID,this.AddonEntity.SuVersion=this.parent.host.Version;var s=this;this.onInit=function(){this.steps=[new c3extensionInstall.step1(this),new c3extensionInstall.step2(this)]},this.getId=function(){return"ExtensionInstallWizard"},this.getTitle=function(){return t},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(localizedString("EXTENSION_STEP_WELCOME_FIRST"),localizedString("EXTENSION_STEP_WELCOME_SECOND"))},this.getStepCount=function(){return s.steps.length},this.getStepTitle=function(e){return r[e]},this.getStepSubtitle=function(e){return i[e]},this.getStepName=function(e){return n[e]},this.getStep=function(e){return this.steps[e]},this.finish=function(){this.parent&&this.parent.reload()}}function c3enableAddOn(){var e=arguments[0]||undefined;this.par=e.tenant,this.parent=e,this.config=arguments[1]||undefined;var t=!1,n={},r=new c3enableAddOn.step1(this),i={getActionButtonText:function(){return localizedString("MISC_SAVE")},validator:r.validator};this.base=c3.dialog,this.base(i),this.view=r;var s=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"enableAddOn"},this.getTitle=function(){return localizedString("WIZARD_ENABLE_ADDON_TITLE")},this.finish=function(){this.view.enableAddon(),this.close()},this.onClose.push(function(){this.parent&&t&&this.parent.reload()})}function c3userPreference(){var e=arguments[0]||{};this.delegate=e,this.config=arguments[1]||{};var t=new c3userPreference.step1(this),n=localizedString("USER_PREFERENCE_TITLE"),r={getActionButton:function(){return null}};this.base=c3.dialog,this.base(r),this.view=t;var i=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return n},this.getId=function(){return"userPreference"},this.finish=function(){this.view.onFinish(),e&&e.reloadUser(),i.close()}}function c3setExtensionPath(e,t,n){var r=$("<input>").attr({type:"button",id:"btnSet",value:"Set"}).css({"margin-top":"10"}),i=!1,s={},o={};view=new c3setExtensionPath.step1(this),winDelegate={getActionButtonText:function(){return localizedString("WIZARD_ADDON_SET_PATH")},validator:view.validator},s.URI=t==undefined?"":t,this.prePath=t,this.base=c3.dialog,this.base(winDelegate),this.ExtensionPathEntity=s,this.view=view,this.btnSet=r;var u=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"setExtensionPath"},this.getTitle=function(){return localizedString("WIZARD_ADDON_SET_REPO_PATH")},this.finish=function(){u.view.Success.css({display:"none"}),u.view.Failed.css({display:"none"}),$(".multi_process_status").css({display:"none"});var n={};n.EnableSchedule=this.ExtensionPathEntity.schedualChecked,n.StartTime="'"+this.ExtensionPathEntity.StartTime+"'",n.Interval=this.ExtensionPathEntity.IntervalTime,n.EnableCompatibilityCheck=this.ExtensionPathEntity.compatibilityCheck;var r={success:function(){if(u.ExtensionPathEntity.URI==t||!u.view.modifyPath)u.view.Success.css({display:"block"}),u.view.Failed.css({display:"none"})},error:function(e){if(u.ExtensionPathEntity.URI==t||!u.view.modifyPath){var n=retriveErrorMessage(e.response);u.view.failedMessage.empty(),u.view.failedMessage.append(n),u.view.Failed.css({display:"block"}),u.view.Success.css({display:"none"}),$(".multi_process_status").css({display:"none"})}}};c3.service.updateExtensionSyncSchedual(n,r);if(u.view.modifyPath){$(".progress").css({display:"none"}),this._container.find(".progressRow").size()>0&&this._container.find(".progressRow").remove();var o=-1,a=s,f=null;c3.service.updateExtensionRepository(a,function(e,t){"success"==t&&(o=e.d.UpdateExtensionRepository),"error"==t&&(o=-2,f=retriveErrorMessage(e.response),$(".progress").css({display:"none"}),u.view.Success.css({display:"none"}),u.view.failedMessage.empty(),u.view.failedMessage.append("&nbsp;&nbsp;"+f),u.view.Failed.css({display:"block"}))});var l={};o!=-2&&(this._container.append(Utility.CreatePathProcessRow("",function(){var n=this;-1!=o?-2==o?n.setFailed():(u.progressBarHandle=l,c3.service.getTasks(o).query(function(r){var s=r.data.Status;"Failed"==s?(c3.service.getTasks(o).expand("TaskParameters").query(function(e){n.setFailed(e.data.ResultDescription),t=u.prePath,$(".progress").css({display:"none"}),u.view.Failed.css({display:"block"}),u.view.Failed.attr({title:e.data.ResultDescription}),u.view.failedMessage.empty(),u.view.failedMessage.append("&nbsp;&nbsp;"+e.data.ResultDescription),Utility.logTaskError(e.data)}),e.reload(),u.progressBarHandle&&u.progressBarHandle.title&&u.progressBarHandle.title.text("")):"Successful"==s?(i=!0,n.setValue(100),$(".progress").css({display:"none"}),u.view.Success.css({display:"block"}),u.view.labelCurrentPath.attr({value:u.ExtensionPathEntity.URI}),u.view.txtPath.attr({value:u.ExtensionPathEntity.URI}),t=u.ExtensionPathEntity.URI,u.prePath=t,u.view.divTxtCon.removeClass("divTxtCon"),u.view.editCancel.hide(),u.view.editEnable.show(),u.view.labelCurrentPath.show(),e.reload(),u.progressBarHandle&&u.progressBarHandle.title&&u.progressBarHandle.title.text("")):n.setValue(parseInt(s[1]))})):n.setValue(0)},l)),l.progressBar.start())}},this.onClose.push(function(){e&&i&&e.reload();if(n&&i){var t=new c3extensionSyncReportList(e);t.show()}})}function c3assignExtension(){this.base=c3.wizard;var e=function(){n.parent&&n.parent.reloadExtensions()};this.base(e);var t=arguments[0]||undefined;this.par=t.tenant,this.parent=t,this.config=arguments[1]||undefined,this.ExtensionAssignment={};var n=this,r=localizedString("WIZARD_EXTENSION_ASSIGNMENT_TITLE"),i=[localizedString("WIZARD_EXTENSION_ASSIGNMENT_STEP_NAME_FIRST"),localizedString("MISC_PROGRESS&FINISH")],s=[localizedString("WIZARD_EXTENSION_ASSIGNMENT_STEP_NAME_FIRST"),localizedString("MISC_FINISH")],o=[localizedString("WIZARD_EXTENSION_ASSIGNMENT_STEP_SUBTITLE_FIRST"),localizedString("WIZARD_EXTENSION_ASSIGNMENT_STEP_TITLE_SECOND")];this.onInit=function(){this.steps=[new c3assignExtension.step1(this),new c3assignExtension.step2(this)]},this.getId=function(){return"ExtensionAssignmentWizard"},this.getTitle=function(){return r},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(localizedString("WIZARD_EXTENSION_ASSIGNMENT_STEP_WELCOME_FIRST"),localizedString("WIZARD_EXTENSION_ASSIGNMENT_STEP_WELCOME_SECOND"))},this.getStepCount=function(){return n.steps.length},this.getStepTitle=function(e){return s[e]},this.getStepSubtitle=function(e){return o[e]},this.getStepName=function(e){return i[e]},this.getStep=function(e){return this.steps[e]},this.finish=function(){this.parent&&this.parent.reloadExtensions()}}function c3extensionSyncReportHistory(){var e=arguments[0]||{};this.delegate=e,this.config=arguments[1]||{};var t=new c3extensionSyncReportHistory.step1(this),n=localizedString("EXTENSION_SYNC_HISTORY"),r={getActionButton:function(){return null}};this.base=c3.dialog,this.base(r),this.view=t;var i=this;this.onInit=function(){t.onInit,this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return n},this.getId=function(){return"extensionSyncHistoryReport"},this.finish=function(){this.view.onFinish(),e,i.close()}}function c3extensionSyncReportList(){var e=arguments[0]||{};this.taskID=e.taskID,this.logID=arguments[1],this.extensionSyncReportEntity={},this.isHistoryView=this.logID?!0:!1;var t=new c3extensionSyncReportList.step1(this),n={getActionButton:function(){return null}};this.base=c3.dialog,this.base(n),this.view=t;var r=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return localizedString("EXTENSION_REPORT")},this.getId=function(){return"extensionSyncReportList"}}function c3registerAppToken(){var e=!1,t={},n=new c3registerAppToken.step1(this),r={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:n.validator},i={register:function(e){var t=e,n=this;this.base=c3.task,this.base("Registering AppToken",100),this.execute=function(){n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("New-AppToken"))}),c3.service.createApplicationIdentifier(t,this.ajaxCallBackConfig)}}};this.base=c3.dialog,this.base(r),this.AppTokenEntity=t,this.view=n;var s=this,o=arguments[0]||undefined,u=new i.register(t),a={taskCount:1,getTask:function(e){if(e==0)return u},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},f=new multiTaskProcess(a);this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),f.placeAt(this.view.getContainer())},this.getId=function(){return"registerAppToken"},this.getTitle=function(){return localizedString("REGISTSLDCLIENT_LABEL_TLT")},this.finish=function(){s.disableFinish(),f.start()},this.onClose.push(function(){o&&e&&o.reload()})}function c3changeDBName(){function s(e,n){c3.service.CheckDatabaseExist(e,n,function(e){if(e.d&&e.d.CheckDatabaseExist==1)return t.view.errorDiv.text("* "+String.format(localizedString("TNTUPGRADE_CKDBNAME_DBNAMEEXIST"),n)),!1;t.flag++,t.flag==r.length&&t.finish()})}this.base=c3.dialog;var e={getActionButtonText:function(){return localizedString("TNTUPGRADE_BTN_CONTINUE")},hideCloseButton:!0};this.base(e);var t=this,n=arguments[0]||undefined,r=arguments[1]||undefined;t.flag=0;var i=new c3changeDBName.step1(n,r);this.view=i,this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return localizedString("TNTUPGRADE_CKDBNAME_TLT")},this.finish=function(){if(t.finishEvent&&t.finishEvent.length>0)for(var e=0;e<t.finishEvent.length;e++)t.finishEvent[e]();this.close()},validator={validEvent:[],checkValidity:function(){t.flag=0,t.view.errorDiv&&t.view.errorDiv.text("");if(r&&r.length>0)for(var e=0;e<r.length;e++){if(r[e].NewDBName==null||r[e].NewDBName.length==0)return t.view.errorDiv.text("* "+localizedString("TNTUPGRADE_CKDBNAME_NULLINPUT")),!1;var n=/^[0-9a-zA-Z_]*$/;if(!n.test(r[e].NewDBName))return t.view.errorDiv.text("* "+localizedString("VALIDITY_PATTERNMISMATCH")),!1;s(r[e].DBInstID,r[e].NewDBName)}}},e.validator=validator}function c3changeLicenseFile(){var e=this;e.parent=arguments[0]||{},e.customer=arguments[1]||{};var t=arguments[2]||{};this.trigger=arguments[3];var n=new c3changeLicenseFile.step1(e,e.customer),r=localizedString("CGLIC_BTN_CG"),i={getActionButtonText:function(){if(e.trigger==0)return localizedString("MISC_SAVE");if(e.trigger==1)return localizedString("RESELLER_ASSIGN")}};this.base=c3.dialog,this.base(i),this.view=n;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){if(e.trigger==0)return r;if(e.trigger==1)return localizedString("ASSIGN_LIC_FORCUSTOMER_TITLE")},this.finish=function(){if(!e.selectedLicenseFile){alert(localizedString("CGLIC_NOSELECTEDITEM_MSG"));return}var n=e.selectedLicenseFile.InstallationNumber;if(e.trigger==0){var r=$("<div>");r.html(localizedString("CGLIC_CONFIRM_MSG")+"<br/>");var i=MessageBox.show({msg:r,width:400,height:180,icon:MessageBoxIcon.WARNING,buttons:MessageBoxButton.YESNO});i.yesEvent.push(function(){e.loadWin=new loadingWindow,e.loadWin.show();var r={success:function(n){t!=null&&t.reload(),e.loadWin.close(),e.close()},error:function(){e.loadWin.close(),e.close()}};c3.service.changeInstallationNumber(e.customer.ID,n,r)})}else if(e.trigger==1){if(e.parent.parent.Customer_Lic_Mapping){for(var s=0;s<e.parent.parent.Customer_Lic_Mapping.length;s++)if(e.customer.ID==e.parent.parent.Customer_Lic_Mapping[s].CustomerID){e.parent.parent.Customer_Lic_Mapping.remove(s);break}e.parent.parent.Customer_Lic_Mapping.push({CustomerID:e.customer.ID,InstallationNumber:n})}e.customer.InstallationNumber=n,null!=e.parent&&null!=e.parent.gridView&&e.parent.gridView.reload(),e.close()}}}function c3editExtensionDeployment(){this.delegate=arguments[0]||undefined,this.config=arguments[1]||undefined;var e=!1,t={},n=new c3editExtensionDeployment.step1(this),r={getActionButton:function(){return null},getCloseButtonText:function(){return localizedString("MISC_OK")}};this.base=c3.dialog,this.base(r),this.view=n;var i=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"DeploymentProperty"},this.getTitle=function(){return localizedString("HUEXTENSION_EXTENSIONDEPLOYEMT_PROPERTYVIEW_TITLE")},this.finish=function(){},this.onClose.push(function(){this.delegate&&e})}function c3editExtensionAssignment(){this.delegate=arguments[0]||undefined,this.config=arguments[1]||undefined;var e=!1,t={},n=new c3editExtensionAssignment.step1(this),r={getActionButton:function(){return null},getCloseButtonText:function(){return localizedString("MISC_OK")}};this.base=c3.dialog,this.base(r),this.view=n;var i=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"AssignmentProperty"},this.getTitle=function(){return localizedString("TENANT_EXTENSIONASSIGNMENT_PROPERTY_TITLE")},this.finish=function(){},this.onClose.push(function(){this.delegate&&e&&this.delegate.reload()})}function c3editextensionDepProperty(){this.delegate=arguments[0]||undefined,this.config=arguments[1]||undefined;var e=!1,t={},n=new c3editextensionDepProperty.step1(this),r={getActionButton:function(){return null},getCloseButtonText:function(){return localizedString("MISC_OK")}};this.base=c3.dialog,this.base(r),this.view=n;var i=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"DeploymentProperty"},this.getTitle=function(){return localizedString("HUEXTENSION_EXTENSIONDEPLOYEMT_PROPERTYVIEW_TITLE")},this.finish=function(){},this.onClose.push(function(){this.delegate&&e&&this.delegate.reload()})}function c3editExtensionAssProperty(){this.delegate=arguments[0]||undefined,this.config=arguments[1]||undefined,this.isAssignWizard=arguments[1]=="Assign";var e=!1,t={},n=new c3editExtensionAssProperty.step1(this),r={getActionButton:function(){return null},getCloseButtonText:function(){return localizedString("MISC_CLOSE")}};this.base=c3.dialog,this.base(r),this.view=n;var i=this;i.originalProps=[],this.onInit=function(){var e=c3.service.getExtensionProperties().filter("Extension/ID eq "+i.delegate.ExtensionID+" and Layer eq 'Assignment'").query(function(e){e.data.length>0&&(i.originalProps=e.data,n.update())});this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"AssignmentProperty"},this.getTitle=function(){return localizedString("TENANT_EXTENSIONASSIGNMENT_PROPERTY_TITLE")},this.finish=function(){},this.onClose.push(function(){this.delegate&&e&&this.delegate.reload()})}function c3retrieveSBOClientSession(){function l(t){c3.service.RegisterPresentationServerAsync(e.psID,r,!0,function(e){c3ModuleManager.notifyMessage(new c3Message("New-PresentationServer"));var t=-1;e.d&&e.d.RegisterPresentationServerAsync>0?t=e.d.RegisterPresentationServerAsync:t=-2,c(t,e)},s,o)}function c(t,n){var r={};e._container.find(".progress_wrap").size()>0&&$(e._container.find(".progress_wrap").parent()).remove(),e._container.append(Utility.CreateProcessRow(function(){var n=this;-1!=t?-2==t?(e.readyForFinish(),r.progressBar.setFailed()):(e.progressBarHandle=r,c3.service.getTaskProgress(t).query(function(e){var n=e.data.GetTaskProperties.split(",");"Failed"==n[0]?c3.service.getTasks(t).expand("TaskParameters").query(function(e){r.progressBar.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)}):"Successful"==n[0]?r.progressBar.setValue(100,localizedString("MISC_DONE")):(n[0]!="Pending"&&n[0]!="Done"?n[0]=localizedString("MISC_TASK_PROCESSING"):n[0]=="Pending"&&(n[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),r.progressBar.setValue(parseInt(n[1]),n[0]))})):r.progressBar.setValue(0,localizedString("SBOCOMMON_PROGRESS_WAIRING"))},r)),r.progressBar.start()}var e=this;e.parent=arguments[0]||{},e.sboClientID=arguments[1]||null,e.psID=arguments[2]||null;var t=arguments[3]||null,n=arguments[4]||null,r=arguments[5]||null,i=arguments[6],s,o;i&&(s=i.userName,o=i.password);var u=new c3retrieveSBOClientSession.step1(e,e.sboClientID),a=localizedString("RTVSBOSESSION_POPWIN_TLT"),f={getActionButtonText:function(){return localizedString("MISC_DEPLOY")}};this.base=c3.dialog,this.base(f),this.view=u;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return a},this.getHeight=function(){return 520},this.finish=function(){e.disableFinish(),l(!0)},validator={validEvent:[],checkValidity:function(){e.finish()}},f.validator=validator}function c3retrieveAllSBOClientSessions(){var e=this;e.parent=arguments[0]||{},e.PSList=arguments[1]||[];var t=new c3retrieveAllSBOClientSessions.step1(e,e.PSList),n=localizedString("RTVSBOSESSION_POPWIN_TLT"),r={getActionButtonText:function(){return localizedString("TNTUPGRADE_BTN_CONTINUE")}};this.base=c3.dialog,this.base(r),this.view=t;var e=this;e.count=0,this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return n},this.getHeight=function(){return 520},this.finish=function(){e.close(),e.parent.Next()}}function c3duplicateTenant(){var e=arguments[0]||undefined;this.base=c3.wizard;var t=function(){e&&e.reload&&e.reload()};this.base(t);var n=arguments[1]||null;this.resellerGrpId=undefined;var r=localizedString("WIZARD_DUPLICATE_TITLE"),i=localizedString("WIZARD_DUPLICATE_WELCOME_TITLE"),s=localizedString("WIZARD_DUPLICATE_WELCOME_SUBTITLE"),o=localizedString("WIZARD_CUSTOMER_GUIDE_TITLE"),u=localizedString("WIZARD_CUSTOMER_GUIDE_DESCRIPTION"),a=$("<div>").addClass("guide_main"),f=[localizedString("DUPTNT_WIZARD_STEP1_NAME"),localizedString("DUPTNT_WIZARD_STEP2_NAME"),localizedString("DUPTNT_WIZARD_STEP3_NAME"),localizedString("DUPTNT_WIZARD_ADDON_NAME"),localizedString("TNT_DUP_REVIEWSTEP_TLT"),localizedString("DUPTNT_WIZARD_STEP4_NAME")],l=[localizedString("DUPTNT_WIZARD_STEP1_TLT"),localizedString("DUPTNT_WIZARD_STEP2_TLT"),localizedString("DUPTNT_WIZARD_STEP3_TLT"),localizedString("DUPTNT_WIZARD_ADDON_TLT"),localizedString("TNT_DUP_REVIEWSTEP_SUBTLT"),localizedString("DUPTNT_WIZARD_STEP4_TLT")],c=[localizedString("DUPTNT_WIZARD_STEP1_DESC"),localizedString("DUPTNT_WIZARD_STEP2_DESC"),localizedString("DUPTNT_WIZARD_STEP3_DESC"),localizedString("DUPTNT_WIZARD_ADDON_DESC"),localizedString("TNT_DUP_REVIEWSTEP_DESC"),localizedString("DUPTNT_WIZARD_STEP4_DESC")],h=this;this.onInit=function(){h.steps=[new c3duplicateTenant.targetSU(h,n),new c3duplicateTenant.tenantInfo(h,n),new c3duplicateTenant.tenantUsers(h,n),new c3duplicateTenant.extension(h,n),new c3duplicateTenant.review(h,n),new c3duplicateTenant.processDuplicate(h,n)],n!=undefined&&c3.service.getTenants(n.ID).expand("Customer/Reseller/Group").query(function(e){e.data&&e.data.Customer&&e.data.Customer.Reseller&&(this.resellerGrpId=e.data.Customer.Reseller.Group.ID)})},this.getId=function(){return"duplicateTenant"},this.getTitle=function(){return r},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(i,s)},this.getStepCount=function(){return h.steps.length},this.getStepTitle=function(e){return l[e]},this.getStepSubtitle=function(e){return c[e]},this.getStepName=function(e){return f[e]},this.getStep=function(e){return this.steps[e]},this.finish=function(t){e&&e.reload&&e.reload(),this.close()}}function c3selectStagingSU4Duplicate(){var e=this,t=arguments[0]||{},n=arguments[1]||{},r=new c3selectStagingSU4Duplicate.step1(e,n),i=localizedString("SLTSTAGINGSU_WIN_TLT"),s={getActionButtonText:function(){return localizedString("MISC_OK")}};this.base=c3.dialog,this.base(s),this.view=r;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return i},this.getHeight=function(){return 520},this.getWidth=function(){return 550},this.finish=function(){e.close(),n.next()},validator={validEvent:[],checkValidity:function(){if(r.useStagingSURadio.attr("checked")!=1&&r.useTargetSURadio.attr("checked")!=1)return!1;if(r.useStagingSURadio&&r.useStagingSURadio.attr("checked")==1&&!n.StagingServiceUnit)return r.msgPanel.text(localizedString("SLTSTAGINGSU_WIN_NOSTAGINGSU")),!1;e.finish()}},s.validator=validator}function c3syncException(){var e=this;e.parent=arguments[0]||{};var t=arguments[1]||null,n=new c3syncException.step1(e,t),r=localizedString("RTVSBOSESSION_POPWIN_TLT"),i={getActionButtonText:function(){return localizedString("MISC_CLOSE")},hideCloseButton:!0};this.base=c3.dialog,this.base(i),this.view=n;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return r},this.getHeight=function(){return 480},this.finish=function(){e.close()}}function c3unregisterPSWarning(){var e=this;e.parent=arguments[0]||{},e.data=arguments[1]||[],e.unregMethod=arguments[2]||(e.parent?e.parent.unRegPresentation:{}),e.ForBAS=arguments[3];var t=new c3unregisterPSWarning.step1(e,e.data),n=localizedString("RTVSBOSESSION_POPWIN_TLT"),r={getActionButtonText:function(){return localizedString("TNTUPGRADE_BTN_CONTINUE")},getCloseButtonText:function(){return localizedString("MISC_CANCEL")}};this.base=c3.dialog,this.base(r),this.view=t;var e=this;this.onInit=function(){this.view.onInit(e.ForBAS),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return n},this.getHeight=function(){return 520},this.finish=function(){e.close(),e.unregMethod&&e.unregMethod()}}function c3extensionNotSupportWarning(){var e=this,t=arguments[0]||{},n=arguments[1]||[],r=arguments[2]||null,i=arguments[3]||null,s=arguments[4]||null,o=new c3extensionNotSupportWarning.step1(e,n),u=localizedString("MISC_WARNING"),a={getActionButtonText:function(){return localizedString("TNTUPGRADE_BTN_CONTINUE")},getCloseButtonText:function(){return localizedString("MISC_CANCEL")}};this.base=c3.dialog,this.base(a),this.view=o;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return u},this.getHeight=function(){return 420},this.finish=function(){e.close()},this.onCancel.push(function(){r&&$(r).attr({checked:!1})}),this.finishEvent.push(function(){r&&$(r).attr({checked:!0}),i.push(s)})}function c3changeSystemUser(){var e=this;e.parent=arguments[0]||{};var t=arguments[1]||[],n=arguments[2]||{},r=arguments[3]||{},i=arguments[4]||[],s=arguments[5]||null,o=new c3changeSystemUser.step1(e,t,n),u=localizedString("CGSYSUSER_WIN_TLT"),a={getActionButtonText:function(){return localizedString("CGSYSUSER_WIN_ACTION_TBN")},getCloseButtonText:function(){return localizedString("MISC_CANCEL")}};this.base=c3.dialog,this.base(a),this.view=o;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return u},this.getHeight=function(){return 250},this.getWidth=function(){return 450},this.finish=function(){o.errorMsg.html("");var u=o.select.find("option:selected").text(),a=o.select.val(),f=$(o.isPowerUser).attr("checked"),l=$(o.isSuperUser).attr("checked");for(var c=0;c<i.length;c++)if(i[c].Name==u&&i[c].B1UserName!=n.B1UserName){o.errorMsg.html("* "+localizedString("DUPTNT_WIZARD_CHANGESYSUSER_REPEATED_WANRING"));return}if(s!=null){var h=[{id:a,sboUsername:n.B1UserName,isSuperSBOUser:l,isPowerSBOUser:f,status:n.Status}],p={success:function(t,n){s(),e.close()},error:function(t,n){s(),e.close()}};c3.service.updateTenantUser(t.ID,h,p)}else n.Name=u,n.IsPowerUser=f,n.IsSuperUser=l,r.reload(),e.close()}}function c3extensionWarning4HighVersion(){var e=this;e.parent=arguments[0]||{},e.data=arguments[1]||[];var t=arguments[2]||[],n=arguments[3]||[],r=arguments[4]||[],i=arguments[5]||{},s=new c3extensionWarning4HighVersion.step1(e,e.data),o=localizedString("MISC_WARNING"),u={getActionButtonText:function(){return localizedString("TNTUPGRADE_BTN_CONTINUE")},getCloseButtonText:function(){return localizedString("MISC_CANCEL")}};this.base=c3.dialog,this.base(u),this.view=s;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return o},this.getHeight=function(){return 470},this.finish=function(){e.close(),t.push({ID:r[i.index].ID,Index:i.index}),n.push({ID:r[i.index].ID,SBOClientID:r[i.index].SBOClientID,MachineID:r[i.index].MachineID,Name:r[i.index].name,Status:r[i.index].Status}),r[i.index].Selected=!0},this.onCancel.push(function(){r[i.index].Selected=!1;for(var e=0;e<t.length;e++)if(r[i.index].ID==t[e].ID){t.remove(e),n.remove(e);break}i.target&&$(i.target).attr({checked:!1})})}function c3registerStorage4Reseller(){var e=this,t=arguments[0]||{},n=arguments[1]||{},r=arguments[2]||{},i=new c3registerStorage4Reseller.step1(e,n),s=localizedString("REGSTORAGE_RESELLER_TITLE"),o={getActionButtonText:function(){return localizedString("MISC_REGISTER")},getActionCloseText:function(){return localizedString("MISC_CANCEL")}};this.base=c3.dialog,this.base(o),this.view=i;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return s},this.getHeight=function(){return 180},this.getWidth=function(){return 450},this.finish=function(){e.close()},validator={validEvent:[],checkValidity:function(){i.msgPanel.text("");if(i.implRadio.attr("checked")!=1&&i.companyRadio.attr("checked")!=1)return!1;var s=null,o=null;if(i.implRadio.attr("checked")==1){s=i.implSelect.val(),o="ImplementationRepository";if(i.implSelect.val()==""||i.implSelect.val()==n.ID&&n.Type==localizedString("RES_SHARED_IMPL_REPOSITORY_LF"))return i.msgPanel.html(String.format(localizedString("REGSTORAGE_RESELLER_NOTCHANGED"),"an",localizedString("RES_SHARED_IMPL_REPOSITORY_LF"))),!1}else if(i.companyRadio.attr("checked")==1){s=i.companySelect.val(),o="CompanyTemplateRepository";if(i.companySelect.val()==""||i.companySelect.val()==n.ID&&n.Type==localizedString("RES_COMPANY_TEMPLATE_REPOSITORY"))return i.msgPanel.html(String.format(localizedString("REGSTORAGE_RESELLER_NOTCHANGED"),"a",localizedString("RES_COMPANY_TEMPLATE_REPOSITORY"))),!1}var u={success:function(){t.refreshStorage(),e.finish()},error:function(){e.finish()}};c3.service.assignResources(r.ID,o,[s],[],u)}},o.validator=validator}function c3assignTaskAuthorization(){var e=this,t=arguments[0]||{},n=arguments[1]||{},r=new c3assignTaskAuthorization.step1(e,n),i=localizedString("TASKAUTH_ASSIGN_WIN_TLT"),s={getActionButtonText:function(){return localizedString("MISC_SAVE")}};this.base=c3.dialog,this.base(s),this.view=r;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return i},this.getHeight=function(){return 385},this.getWidth=function(){return 550},this.finish=function(){e.close();var r=e.TaskAuths.length;for(var i=0;i<e.TaskAuths.length;i++){var s={};s.TaskType={__metadata:{uri:"TaskType("+e.TaskAuths[i].ID+")"}},s.Group={__metadata:{uri:"Group("+n.Group.ID+")"}},s.PermissionType="Authorized",c3.service.assignTaskAuthorization(s,{success:function(e){r--,r==0&&t.refreshTaskAuthorization()},error:function(e){r--,r==0&&t.refreshTaskAuthorization()}})}},validator={validEvent:[],checkValidity:function(){if(e.TaskAuths==null||e.TaskAuths.length==0)return!1;e.finish()}},s.validator=validator}function c3taskReview(){var e=this,t=arguments[0]||{},n=arguments[1]||null,r=arguments[2]||null,i=arguments[3]||null,s=new c3taskReview.step1(e,n,r,i),o=localizedString("TASKREVIEW_WIN_TLT"),u=i.Task_Status=="WaitingForApproval"&&c3.hasPermission([permissionItems.operator])?{getActionButtonText:function(){return localizedString("TRIAL_BTN_APPROVE")},getCloseButtonText:function(){return localizedString("TRIAL_BTN_REJECT")}}:{getActionButtonText:function(){return localizedString("MISC_CLOSE")},hideCloseButton:!0};this.base=c3.dialog,this.base(u),this.view=s;var e=this;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return o},this.getHeight=function(){return 530},this.getWidth=function(){return 750},this.finish=function(){e.disableFinish(),e.disableClose();if(i.Task_Status=="WaitingForApproval"&&c3.hasPermission([permissionItems.operator])){var n=MessageBox.prompt({msg:localizedString("TRIAL_CONFIRMWIN_TLT"),multiline:!0,required:!0,title:localizedString("TRIAL_BTN_APPROVE")});n.okEvent.push(function(){if(n.inputControl.val()==null||n.inputControl.val().length==0)return;var r={TaskOperationRequests:[{ID:i.ID,Comments:n.inputControl.val()}]};c3.service.approveTaskOperationRequests(r,{success:function(n){e.close(),t.reload()},error:function(n){e.close(),t.reload()}})}),n.cancelEvent.push(function(){e.readyForFinish(),e.readyForClose()})}else e.close()},this.onCancel.push(function(){e.disableFinish(),e.disableClose();if(i.Task_Status=="WaitingForApproval"&&c3.hasPermission([permissionItems.operator])){var n=MessageBox.prompt({msg:localizedString("TRIAL_CONFIRMWIN_TLT"),multiline:!0,required:!0,title:localizedString("TRIAL_BTN_REJECT")});n.okEvent.push(function(){if(n.inputControl.val()==null||n.inputControl.val().length==0)return;var e={TaskOperationRequests:[{ID:i.ID,Comments:n.inputControl.val()}]};c3.service.rejectTaskOperationRequests(e,{success:function(e){t.reload()},error:function(e){t.reload()}})})}}),validator={validEvent:[],checkValidity:function(){e.finish()}},u.validator=validator}function c3assignEmailTemplate(){this.base=c3.dialog,this.base();var e="",t=this;t.parent=arguments[0]||{},t.assignedTemplates=arguments[1]||{},t.templatesToAssign=[],t.view=new c3assignEmailTemplate.step1(t),this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return"Assign E-Mail Template"},this.finish=function(){this.close()}}function c3addMailAddress(){var e=!1,t={},n=new c3addMailAddress.step1(this),r={getActionButtonText:function(){return"Add"},validator:n.validator},i={add:function(e){var t=e,n=this;this.base=c3.task,this.base(),this.execute=function(){n.doneEvent.push(function(){}),t.EventId=o.selectedEvent.ID,c3.service.addMailAddress(t,this.ajaxCallBackConfig)}}};this.base=c3.dialog,this.base(r),this.MailAddressEntity=t,this.view=n;var s=this,o=arguments[0]||undefined,u=new i.add(t),a={taskCount:1,getTask:function(e){if(e==0)return u},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){e=!0,s.view.reset()}],successMessage:localizedString("MISC_DONE")},f=new multiTaskProcess(a);this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),f.placeAt(this.view.getContainer())},this.getId=function(){return"addMialAddress"},this.getTitle=function(){return"Mail Address Creation"},this.getWidth=function(){return 450},this.getHeight=function(){return 200},this.finish=function(){s.disableFinish(),f.start()},this.onClose.push(function(){o&&e&&o.reloadMailAddresses(o.selectedEvent.ID)})}function c3exportAgentLogs(){function u(){var e=$("#start").val(),t=$("#end").val(),n=e+"-"+t,r=JSON.stringify(n),s=i.data.ID;$.c3BaseClient.exportAgentLog("MachineLogs","GetAgentDataFile",s,r)}function a(){var e=$("#end").val(),t=e,n=i.data.ID;$.c3BaseClient.exportAgentLog("MachineLogs","ArchiveAgentDataFile",n,t)}var e=[],t=!1,n={},r=new c3exportAgentLogs.step1(this,arguments[1]),i=this,s=arguments[0]||undefined;i.mode=arguments[1]||0,i.data=arguments[2],winDelegate={getActionButtonText:function(){return i.mode==1?localizedString("MISC_ARCHIVE"):localizedString("MISC_EXPORT")},validator:r.validator},this.base=c3.dialog,this.base(winDelegate),this.AgentLogEntity=n,this.view=r;var o="";i.mode==1?o=localizedString("WIZARD_ARCHIVE_LOG_TITLE"):o=localizedString("WIZARD_EXPORT_LOG_TITLE"),this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"exportMonitoringLog"},this.getTitle=function(){return o},this.getWidth=function(){return 450},this.getHeight=function(){return 200},this.finish=function(){i.mode==1?a():u()}}function c3overview(){this.base=c3.module,this.base();var e="overview",t=localizedString("OVERVIEW"),n=$("<section>").attr({id:e}),r=800,i=600,s=[];this._title=t,this._container=n,this.onInit=function(){var e=n.parent(),t=Math.max(e.width()-40,r),o=Math.max(e.height(),i),u=t/1.5*.96,a=o/2*.5;s.push(new c3overview.welcome("100%",a)),s.push(new c3overview.serviceUnit_ovr("auto","auto")),s.push(new c3overview.tenant_ovr("auto","auto")),s.push(new c3overview.customer_ovr("auto","auto")),c3.hasPermission([permissionItems.operator])&&s.push(new c3overview.trialRequest_ovr("auto","auto"));var f=new c3overview.SLDStatus(u,"auto"),l=$("<div>").css({"float":"none",height:a+"px"}),c=$("<div>").css({"float":"none",height:a+"px"});n.append(l),n.append(c);var h=s[0],p=s[1],d=s[2];module3=s[3],l.append(h.getContainer()),c.append(p.getContainer()),c.append(d.getContainer()),c.append(module3.getContainer());if(c3.hasPermission([permissionItems.operator])){var v=s[4];c.append(v.getContainer()),v.onViewWillAppear()}c.append(f.getContainer()),h.onViewWillAppear(),p.onViewWillAppear(),d.onViewWillAppear(),module3.onViewWillAppear(),f.onViewWillAppear()}}function c3appmgroverview(){this.base=c3.module,this.base();var e="appmgroverview",t=localizedString("APPMGR_OVERVIEW"),n=$("<section>").attr({id:e}),r=800,i=600,s=[];this._title=t,this._container=n,this.onInit=function(){var e=n.parent();n.css({width:"100%-2pxpx","overflow-y":"hidden","overview-x":"hidden"}),s.push(new c3appmgroverview.welcome("100%","auto")),s.push(new c3appmgroverview.topology("100%","auto"));for(var t=0;t<s.length;t++){var r=s[t];n.append(r.getContainer()),r.onViewWillAppear()}}}function c3about(){this.base=c3.module,this.base();var e="about",t=localizedString("ABOUT"),n=$("<section>").attr({id:e}),r=800,i=600,s=[];this._title=t,this._container=n,this.onInit=function(){var e=n.parent();n.css({width:"100%-2pxpx","overflow-y":"hidden","overview-x":"hidden"}),s.push(new c3about.welcome("100%","auto")),s.push(new c3about.topology("100%","auto"));for(var t=0;t<s.length;t++){var r=s[t];n.append(r.getContainer()),r.onViewWillAppear()}}}function c3infmgroverview(){this.base=c3.module,this.base();var e="infmgroverview",t=localizedString("INFMGR_ABOUT"),n=$("<section>").attr({id:e}),r=800,i=600,s=[];this._title=t,this._container=n,this.onInit=function(){n.css({width:0/0}),s.push(new c3infmgroverview.welcome("100%","auto")),s.push(new c3infmgroverview.SW("96%","auto")),s.push(new c3infmgroverview.b1central("96%","auto"));for(var e=0;e<s.length;e++){var t=s[e];n.append(t.getContainer()),t.onViewWillAppear()}}}function applicationManagement(){function i(){body=$("<section>").attr({id:e+"_tab_body"}).addClass("tab_body");for(var t=0;t<window.appmgr.length;t++)body.append(window.appmgr[t].getContainer());return body}this.base=c3.module,this.base();var e="appmgr",t=$("<section>").attr({id:e}),n=localizedString("APPMGR"),r=this;this._container=t,this._title=n,this.onInit=function(){c3.hasPermission([permissionItems.operator])?window.appmgr=[new c3customer,new c3tenant,new c3trialrequest,new c3.LicFileManager,new c3varRequest]:window.appmgr=[new c3customer,new c3tenant,new c3.LicFileManager],t.append(i())}}function licenseModules(){function a(){var t=$("<section>").attr({id:"license_module"}).addClass("wizard"),r="Close",i=$("<div>").addClass("lincense_module_main"),o=$("<div>").css({display:"block"}),u=$("<hgroup>");u.append($("<h1>").html(n)),o.append(u),i.append(o);var a=$("<section>"),l=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"18%"},{name:"Description",description:localizedString("RESPOOL_LICSERVER_COLUMN_LICTYPE"),type:"text",width:"25%"},{name:"StartDate",description:localizedString("COLUMN_CREATE_DATE"),type:"text",width:"20%"},{name:"ExpirationDate",description:localizedString("RESPOOL_LICSERVER_COLUMN_EXPIREDDATE"),type:"text",width:"20%"},{name:"Available",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"22%"}];e.data=[];var c={getHeaderSpec:function(){return l},getRowCount:function(){return e.data.length},getRow:function(t){return e.data[t]},getGridHeight:function(){return 165},getDefaultSelectedIndex:function(){return s},getCell:function(){if(this.colName=="StartDate"||this.colName=="ExpirationDate"){var e=this.data[this.colName];return convertToDate(e).dateString()}if(this.colName=="Status"){var e=this.data[this.colName];this.data[this.colName].IsExpired?this.data[this.colName].Status=localizedString("STATUS_EXPIRED"):this.data[this.colName].Status=localizedString("STATUS_AVAILABLE")}else this.colName.trim()=="Available".trim()&&(this.data[this.colName]=this.data[this.colName]+"/"+this.data.Total);return null}},h=$(a).gridview({delegate:c,undraggable:!0});h.show(),h.rowSelectedEvent.push(function(){s!=this.index&&(s=this.index,f(s))}),e.dataGrid=h;var p=$("<div>").css({display:"block"}),v=$("<hgroup>");v.append($("<h1>").html(localizedString("RESPOOL_LICSERVER_TYPE_DESC"))),p.append(v);var m=$("<section>"),g=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"B1UserName",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"15%"},{name:"Name",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"30%"},{name:"IsSuperUser",description:localizedString("COLUMN_USERTYPE"),type:"text",width:"25%"},{name:"Tenants",description:localizedString("TENANTS"),type:"text",width:"20%"}];e.userData=[];var y={getHeaderSpec:function(){return g},getRowCount:function(){return e.userData.length},getRow:function(t){return e.userData[t]},getGridHeight:function(){return 160},getCell:function(){var e=null;if(this.colName=="Status"&&this.data){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e},getTip:function(){return Utility.CreateTipBoard(localizedString("RESPOOL_LICSERVER_USERMGT_EMPTY_TIPMSG"),null,!0)}},b=$(m).gridview({delegate:y,undraggable:!0});b.show(),b.rowSelectedEvent.push(function(){}),e.userDataGrid=b,i.append(a),i.append($("<br>")),i.append(p),i.append(m);var w=$("<div>");return w.css({"text-align":"right"}),e.btnCancel=$("<input>").attr({id:"login_btnCancel",type:"button",value:r}),w.append(e.btnCancel),w.css({"padding-top":"10px","border-top":"solid 1px #c0c8d5"}),i.append(w),e.btnCancel.click(d),t.append(i),t}function f(t){e.loadingWin.show();var n=e.data[t],s=[],o=[];e.flag=0,l(r.ID,o,function(){if(o&&o.length>0)for(var t=0;t<o.length;t++)if(o[t].LicenseModules&&o[t].LicenseModules.results&&o[t].LicenseModules.results.length>0)for(var r=0;r<o[t].LicenseModules.results.length;r++)if(o[t].LicenseModules.results[r].Type==n.Type){var u=localizedString("B1_NORMALUSER");o[t].IsPowerSBOUser==1&&(u=localizedString("B1_POWERUSER")),o[t].IsSuperSBOUser==1&&(u=localizedString("B1_SUPERUSER"));var a=!1;for(var f=0;f<s.length;f++)if(s[f].B1UserName==o[t].SBOUsername){s[f].Name!=o[t].SystemUsername&&(s[f].Name+=","+o[t].SystemUsername),s[f].Tenants+="; "+o[t].Tenants,a=!0;break}a||s.push({Status:o[t].Status,B1UserName:o[t].SBOUsername,Name:o[t].SystemUsername,IsSuperUser:u,Tenants:o[t].Tenants});break}if(i&&i.length>0)for(var t=0;t<i.length;t++){var l=!1;for(var r=0;r<s.length;r++)if(i[t].SBOUsername==s[r].B1UserName){l=!0;break}!l&&i[t].ModuleType==n.Type&&s.push({B1UserName:i[t].SBOUsername})}e.userData=s,e.userDataGrid.reload(),e.loadingWin.close()})}function l(e,t,n){c3.service.getTenants().expand("CompanyDatabase").filter("LicenseFile/ID eq "+e).query(function(e){if(e.data&&e.data.length>0)for(var r=0;r<e.data.length;r++)c(e.data,e.data[r].ID,t,e.data[r].CompanyDatabase.CompanyName,n);else n()})}function c(t,n,r,i,s){c3.service.getTenantUsers(n).query(function(n){var o=n.data;if(o&&o.length>0)for(var u=0;u<o.length;u++)o[u].Tenants=i,r.push(o[u]);e.flag++,e.flag==t.length&&s()})}function h(t){c3.service.getLicenseAssignmentsByLicenseFile(r.ID).query(function(n){i=n.data;var r=t.data;for(var o=0;o<r.length;o++)r[o].IsExpired?r[o].Status=localizedString("STATUS_EXPIRED"):r[o].Status=localizedString("STATUS_AVAILABLE");e.data=r,e.dataGrid.reload(),e.loadingWin.close(),f(s)})}function p(t){e.loadingWin.show(),c3.service.getLicenseModulesByLicenseFileId(t.ID).query(h)}function d(){e.popWindow.close();for(var t=0;t<e.onCancel.length;t++)e.onCancel[t]()}function v(){e.popWindow.close()}var e=this,t=localizedString("RES_VIEWLIC_LICFILE"),n=localizedString("RES_VIEWLIC_SUBTITLE"),r=arguments[0]||{},i=[],s=0;e.popWindow=null;var o=arguments[1]||null,u=new loadingWindow;e.loadingWin=u,this.show=function(){e.popWindow=this.container.c3popwin(650,505,localizedString("RES_VIEWLIC_LICFILE"))},e.onCancel=[],this.bindData=p,this.container=a()}function c3respool(){function i(){body=$("<section>").attr({id:e+"_tab_body"}).addClass("tab_body");for(var t=0;t<window.inframgr.length;t++)body.append(window.inframgr[t].getContainer());return body}this.base=c3.module,this.base();var e="respool",t=$("<section>").attr({id:e}),n=localizedString("RESOURCEPOOL"),r=this;c3.hasPermission([permissionItems.operator])?window.inframgr=[new c3host,new respool.licenseServers,new respool.mssqls,new respool.commonDBs,new respool.sharedFolders,new respool.presentationServers,new respool.b1iServers,new respool.mailServer,new respool.mailerServices,new respool.extension,new c3sldagent,new respool.b1AH,new respool.xappservice,new c3logicalmachines,new respool.browserAccessServers]:window.inframgr=[new c3host],this._container=t,this._title=n,this.onInit=function(){t.append(i())}}function c3host(){function addProcessingRecord(e){c3.service.getTasks().filter("TaskType eq 'CreateServiceUnit' and (Status eq 'Processing' or Status eq 'Pending') and ParentTask eq null").expand("TaskParameters").query(function(t){if(t.data&&t.data.length>0)for(var n=0;n<t.data.length;n++){var r=t.data[n].TaskParameters.results;if(r&&r.length>0){var i={TaskID:t.data[n].ID,ErrorCode:t.data[n].ErrorCode};for(var s=0;s<r.length;s++){i[r[s].Name]=r[s].Value;var o=null;if(r[s].Name=="Name"){o=r[s].Value;if(o!=null&&o.length>0)for(var u=0;u<e.data.length;u++)if(e.data[u].Name==o){e.data.remove(u);break}}}i.MonitorStatus=localizedString("MONITOR_STATUS_UNKNOWN"),i.monitorStatusCode=5;var a=[];a.push({statusClass:"Moni_unknown",message:localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE")}),i.cachedMessageList=a,e.data.push(i)}}bindTable(e)})}function retrieveCachedMonitorStatus(e){c3.service.getCachedMonitorStatusBySuID(null,{success:function(t){if(t.d.results)for(var n=0;n<t.d.results.length;n++){self.monitorInfo.push(t.d.results[n]);for(var r=0;r<e.data.length;r++)if(t.d.results[n].ID==e.data[r].ID){e.data[r].MonitorStatus=t.d.results[n].Status,e.data[r].monitorStatusCode=t.d.results[n].StatusCode,e.data[r].cachedMessageList=monitorUtil.buildMessageList(t.d.results[n].Messages.results);break}}for(var i=0;i<e.data.length;i++)if(e.data[i].monitorStatusCode===undefined){e.data[i].MonitorStatus=localizedString("MONITOR_STATUS_UNKNOWN"),e.data[i].monitorStatusCode=5;var s=[];s.push({statusClass:"Moni_unknown",message:localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE")}),e.data[i].cachedMessageList=s}addProcessingRecord(e)},error:function(t){addProcessingRecord(e)}})}function createToolbar(){var e=$("<section>").addClass("tools"),t=(new Button({value:newTxt,permissions:[permissionItems.operator]})).dom,n=(new Split({permissions:[permissionItems.operator]})).dom,r=$("<input>").attr({value:preUpgradeTestingTxt,type:"button"}),i=$("<input>").attr({value:upgradeTxt,type:"button"}),s=(new Button({value:delTxt,permissions:[permissionItems.operator]})).dom,o=$("<a>").attr({href:"#",id:"btnRefresh_"+id,title:localizedString("MISC_REFRESH")}).addClass("refresh");t.click(function(){createHU(self)});var u=(new Button({value:localizedString("SUCREATION_REF_BTN_TEXT"),permissions:[permissionItems.operator]})).dom;u.click(function(){if(selectedItem){var e=new c3newSUViaRef(self,selectedItem);e.show()}}),self.btnRef=u;var a=localizedString("APPMGR_HOSTING_UNIT");self.btnPreupgradeTesting=r,self.btnUpgrade=i,self.btnDelete=s,self.btnNew=t,disableControl(),s.click(function(){if(selectedItem!=null)if(self.selectPvn&&self.selectPvn.val()=="failed"){var e=selectedItem.TaskID;c3.service.getTasks(e).expand("TaskParameters").query(function(t){var n=$("<div>");n.html(localizedString("POP_MSG_WARNING")+"<br/>");var r=MessageBox.confirm({msg:n,width:350,height:150});r.yesEvent.push(function(){var t={ID:e,Archived:!0};c3.service.archiveTask(t,function(){onSelectPvn()})})})}else{var t=MessageBox.confirm(String.format(localizedString("RES_MISC_DELETE_CONFIRM"),a));t.yesEvent.push(function(){var e={};e.success=function(e){nestedUnits[0].unbindSoftwareTbl(),nestedUnits[0].unbindStorageTbl(),nestedUnits[0].unbindExtension(),cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),self.reload())},c3.service.deleteHostingUnit(selectedItem.ID,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),a))}),o.click(function(){onSelectPvn()}),e.append(t),e.append(n),e.append(u),e.append(s);var f=$("<div>").attr({id:"div_selectPvn"}).css({"float":"right"}),l=$("<select>").attr({id:"selectPvn"}),c=$("<option>").attr({title:localizedString("SU_SELECT_ALL")}).val("all").append(localizedString("SU_SELECT_ALL"));l.append(c),c=$("<option>").attr({title:localizedString("SU_SELECT_FAILEDPVNING")}).val("failed").append(localizedString("SU_SELECT_FAILEDPVNING")),l.append(c),l.bind("change",onSelectPvn),self.selectPvn=l;var h=new searchbox({inputCallback:function(e){return self.dataGrid.searchText(e)}}),p=(new Split({permissions:[permissionItems.operator]})).dom,d=$("<label>").html(localizedString("CUSTOMER_SELECT_LABEL")+":&nbsp;").css({"float":"left","padding-top":"3px"});return f.append(d).append(l.css({"float":"left"})).append(p.css({"float":"left"})).append(h.css({"float":"left"})).append(o.css({"float":"left"})),e.append(f),e}function onSelectPvn(){self.loadingWin||(self.loadingWin=new loadingWindow),self.loadingWin.show();var e=self.selectPvn.val();if(e=="failed"){var t={data:[]};c3.service.getTasks().filter("TaskType eq 'CreateServiceUnit' and Status eq 'Failed' and Archived eq false ").expand("TaskParameters").query(function(e){if(e.data&&e.data.length>0)for(var n=0;n<e.data.length;n++){var r=e.data[n].TaskParameters.results;if(r&&r.length>0){var i={TaskID:e.data[n].ID,ErrorCode:e.data[n].ErrorCode};for(var s=0;s<r.length;s++)i[r[s].Name]=r[s].Value;i.Status="Offline",t.data.push(i)}}bindTable(t)})}else c3.service.getHostingUnits().expand("Group,Tenants,Tenants/Customer,Tenants/CompanyDatabase,CommonDatabase/DatabaseInstance,LicenseServer,PresentationServers/Machine,PresentationServers/SBOClient,B1WebServers").orderby("ID desc").top(self.pageSize).skip(page*self.pageSize).query(retrieveCachedMonitorStatus)}function createHU(e){var t=new c3huwizard(e);t.show()}function createTable(){var e=$("<section>"),t=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"15%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"10%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"14%"},{name:"DBType",description:localizedString("MISC_DBTYPE"),type:"text",width:"7%"},{name:"TenantCount",description:localizedString("HU_GD_TENANTCOUNT"),type:"text",width:"15%",dataType:"number"},{name:"Description",description:localizedString("MISC_DESCRIPTION"),type:"text",width:"21%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"10%"}];self.colList=t,self.data=[];var n={pagingMode:!0,pageSize:self.pageSize,autoResize:function(){return 540},getHeaderSpec:function(){return t},getRowCount:function(){return self.data.length},getRow:function(e){return self.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return selectedIndex},getCell:function(){var e=null;if(this.colName=="Status"||this.colName=="Mode"){var t={};t.text=this.data[this.colName],this.colName=="Mode"?t.showText=!0:t.textalign="center",e=new statusControl(t)}else{if(this.colName=="Result"){var n=this.data,r=$("<div>"),i=this;if(n.TaskID&&n.TaskID>0){if(self.selectPvn&&self.selectPvn.val()=="failed"){var s=$("<a>").attr({href:"#"}).text(localizedString("LINK_DETAILS"));return s.click(function(){c3.service.getTasks(n.TaskID).expand("TaskParameters").query(function(e){var t=$("<fieldset>");t.append($("<legend>").css({"padding-left":"10px","line-height":"25px"}).append("<strong>"+localizedString("RESPOOL_CMDB_POPWIN_TLT")+":</strong>&nbsp;&nbsp;&nbsp;&nbsp;").append(e.data.ErrorCode)),t.append($("<span>").css({"padding-left":"10px","line-height":"25px"}).append('<span title="'+e.data.ResultDescription+'">'+e.data.ResultDescription+"</span>"));var n=0,r=200;e.data.ResultDescription.length&&(n=e.data.ResultDescription.length,r=(n/40+1)*30+110);var i=MessageBox.prompt({msg:t,width:350,height:r,title:localizedString("AVAILABLE_STATUS_WARNING")})})}),s}var o=[];o.push(function(e){var t=e.c3progressWithStatus(function(e){return function(){return getProgress(t,e,i)}}(n.TaskID),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0});return t}(r));for(var u=0,a=o.length;u<a;u++)0==u&&o[u].start(),u<a-1&&o[u].finishEvent.push(function(e){return function(t){e.start()}}(o[u+1]))}return r}if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var f=$("<label>"),l=this.data;monitorUtil.statusPreparation(t,l.MonitorStatus,l),f=new statusControl(t),l.ID!==undefined&&retrieveSUMonitorStatus(f,l),f.c3tip({messageList:l.cachedMessageList});var c={};return c.id=l.ID,c.cell=f,self.moniCell.push(c),f}if(this.colName=="DBType"){var f=$("<label>");if(this.data.SoftwareRepository)return this.data.SoftwareRepository.SQLenabled===!0?f.append(localizedString("MSSQL")):this.data.SoftwareRepository.HANAenabled===!0&&f.append(localizedString("HANA")),f}}return e},getTotalCount:function(){return self.totalCount},loadPage:function(e,t){c3.service.getHostingUnits().expand("Group, Tenants,Tenants/Customer,Tenants/CompanyDatabase,CommonDatabase/DatabaseInstance,LicenseServer,PresentationServers/Machine,PresentationServers/SBOClient,B1WebServers").orderby("ID desc").skip(e).top(t).query({success:function(e){self.data.clear();for(var t=0;t<e.data.length;t++)self.data.push(e.data[t]);onRowSelected(selectedIndex),self.dataGrid.refreshContent()},error:function(e){self.loadingWindow.close()}})}};self.gridDelegate=n;var r=$(e).gridview({delegate:n});return r.rowSelectedEvent.push(function(){selectedIndex!=this.index&&onRowSelected(this.index),(self.data[this.index].TaskID===undefined||self.data[this.index].TaskID<=0)&&enableControl(),self.data[this.index].TaskID>0?nestedUnits[0].dataform.disableEdit():nestedUnits[0].dataform.enableEdit()}),self.dataGrid=r,self.moniCell=[],e}function retrieveSUMonitorStatus(e,t){c3.service.getMonitorStatusBySuID(t.ID,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o});for(var a=0;a<self.monitorInfo.length;a++)if(t.ID==self.monitorInfo[a].ID){self.monitorInfo.splice(a,1);break}self.monitorInfo.push(s),selectedItem!==null&&selectedItem.ID!==undefined&&selectedItem.ID===t.ID&&nestedUnits[0].refreshMonitorStatus(s)}},error:function(e){monitorUtil.handleCommunicationError(t)}})}function bindTable(e){for(var t=0;t<e.data.length;t++)e.data[t].Tenants?e.data[t].TenantCount=e.data[t].Tenants.results.length:e.data[t].TenantCount=0;self.data=e.data,self.moniCell=[];if(self.data.length==0){var n=c3.hasPermission([permissionItems.operator]);self.gridDelegate.getTip=function(){return self.selectPvn&&self.selectPvn.val()=="failed"?Utility.CreateTipBoard(localizedString("SU_FAILEDPVN_EMPTY_TIPMSG"),null,!0):n?Utility.CreateTipBoard(localizedString("HOSTUNIT"),function(){createHU(self)}):Utility.CreateTipBoard(localizedString("HOSTUNIT"),null,!0)},disableControl()}else selectedIndex==-1?disableControl():enableControl();self.loadingWin&&self.loadingWin.close(),self.dataGrid.reload(),self.data.length>0&&selectedIndex!=-1?onRowSelected(selectedIndex):(nestedUnits[0].bindData({}),nestedUnits[0].unbindExtension(),selectedItem=null,selectedIndex=-1),self.loadingWin.close()}function enableControl(){self.btnDelete.attr({disabled:0}).val(localizedString("BUTTON_HU_DELETE")),self.btnRef.attr({disabled:0}),self.btnNew.attr({disabled:0}),selectedItem&&selectedItem.Purpose!="Productive"&&self.btnRef.attr({disabled:1})}function disableControl(){self.btnDelete.attr({disabled:1}),self.btnRef.attr({disabled:1}),self.selectPvn&&self.selectPvn.val()=="failed"?self.btnNew.attr({disabled:1}):self.btnNew.attr({disabled:0})}function onRowSelected(e){selectedIndex=e,selectedItem=self.data[e],nestedUnits[0].unbindSoftwareTbl(),nestedUnits[0].unbindStorageTbl(),nestedUnits[0].unbindExtension();if(self.data[e].TaskID&&self.data[e].TaskID>0)nestedUnits[0].onViewWillAppear(),nestedUnits[0].bindData({}),disableControl(),self.selectPvn&&self.selectPvn.val()=="failed"?(self.btnDelete.attr({disabled:0}),self.btnNew.attr({disabled:1})):(self.btnNew.attr({disabled:0}),self.btnDelete.val("Delete"));else{var t;for(var n=0;n<self.monitorInfo.length;n++)if(self.monitorInfo[n].ID==self.data[e].ID){t=self.monitorInfo[n];break}nestedUnits[0].bindData(self.data[e],t),enableControl()}selectedItem&&nestedUnits[0].refreshTitle(selectedItem.Name);for(var r=0;r<self.moniCell.length;r++)if(self.moniCell[r].id==selectedItem.ID)var i=self.moniCell[r].cell;selectedItem.ID!==undefined&&retrieveSUMonitorStatus(i,selectedItem)}this.base=c3.module,this.base();var id="hu_unit",container=$("<section>").attr({id:id}),title=localizedString("HOSTUNITS"),newTxt=localizedString("BUTTON_HU_NEW"),upgradeTxt=localizedString("BUTTON_HU_UPGRADE"),preUpgradeTestingTxt=localizedString("BUTTON_HU_PREUPGRADE"),delTxt=localizedString("BUTTON_HU_DELETE"),page=0,pageSize=5,self=this,selectedItem=null,selectedIndex=0,nestedUnits=[new c3host.detail(this)];self.monitorInfo=[],self.moniCell=[],self.pageSize=10,self.totalCount=0,self.refreshPaging=!1,this._container=container,this._title=title,this.getSelectedItem=function(){return selectedItem},self.countHandler={success:function(e){self.totalCount=parseInt(e.data,10)},error:function(e){}},this.reload=function(){self.refreshPaging=!0,self.loadingWin.show(),self.moniCell=[];var e=c3.service.getHostingUnits().expand("Group,Tenants,Tenants/Customer,Tenants/CompanyDatabase,CommonDatabase/DatabaseInstance,LicenseServer,PresentationServers/Machine,PresentationServers/SBOClient,SoftwareRepository, B1WebServers");e.count().query(self.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(self.pageSize).skip(page*self.pageSize));var t={success:retrieveCachedMonitorStatus,error:function(){self.loadingWin.close()}};e.query(t)},this.onInit=function(){container.append($("<div>").attr("class","title_panel").append(title)),container.append(createToolbar()),container.append(createTable()),self.dataGrid&&self.dataGrid.show();for(var e=0;e<nestedUnits.length;e++)container.append(nestedUnits[e].getContainer());nestedUnits[0].onViewWillAppear();var t=new loadingWindow;self.loadingWin=t,this.reload()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){self.reload();break}}else self.reload()})};var getProgress=function(progressBar,tid,rowContainer){c3.service.getTaskProgress(tid).query(function(result){var status=result.data.GetTaskProperties.split(",");"FAILED"==status[0].toUpperCase().toUpperCase()||"CANCELLED"==status[0].toUpperCase()||"ROLLBACK"==status[0].toUpperCase()?c3.service.getTaskResult(tid).query(function(e){e!=null&&e.data!=null&&e.data.GetResult==""?c3.service.getTasks(tid).expand("TaskParameters").query(function(e){progressBar.setFailed(e.data.ResultDescription)}):e.data.GetResult.length>0&&c3.service.getTasks(tid).query(function(e){progressBar.setWarning(e.data.ResultDescription)})}):"SUCCESSFUL"==status[0].toUpperCase()?(onSelectPvn(),c3.service.getTaskResult(tid).query(function(result1){if(result1!=null&&result1.data!=null&&result1.data.GetResult!=null){var errorArray=eval(result1.data.GetResult),msg="";if(errorArray&&errorArray.length>0)for(var k=0;k<errorArray.length;k++)errorArray[k].Type=="Warning"&&(msg+=errorArray[k].Description+"\r\n");msg!=""&&msg.length>0?progressBar.setWarning(msg):progressBar.setValue(100,localizedString("MISC_DONE"))}}),rowContainer.data.errorLabel!=null&&rowContainer.data.errorLabel.text(0)):(status[0]!="Pending"&&status[0]!="Done"?status[0]=localizedString("MISC_TASK_PROCESSING"):status[0]=="Pending"&&(status[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),progressBar.setValue(parseInt(status[1]),status[0]))})}}function registerSWComponent(){function s(){var t=null,n=!0;switch(r.selectedSW){case"RES_PRESENTATION_SERVER":t=new c3registerPresServer(e,n),t.show();break;case"RES_B1I_SERVER":t=new c3registerB1i(e,n),t.show();break;case"RES_MAILER_SERVICE":t=new c3registerMailer(e,n),t.show();break;case"RES_BROWSERACCESS_SERVER":t=new c3registerBAServer(e,n),t.show()}}function o(t,n,i,s){if(i.SBOClient&&i.SBOClient.ID>0){var o=null;e.host.SoftwareRepository!=null&&e.host.SoftwareRepository.HANAenabled==null?o=ServerType.MSSQL_SERVER:e.host.SoftwareRepository!=null&&e.host.SoftwareRepository.SQLenabled==null&&(o=ServerType.HANA_SERVER);if(e.host.Version==i.SBOClient.Version&&o==i.SBOClient.ServerType){r.loadingWin0.close(),t.ID=r.selectedItem,t.ServiceUnit={},t.ServiceUnit.__metadata={},t.ServiceUnit.__metadata.uri=e.host.__metadata.uri,c3.service.updatePresentationServer(t,function(e){s&&s(),n(e)});return}t.ID=r.selectedItem,t.ServiceUnit={},t.ServiceUnit.__metadata={},t.ServiceUnit.__metadata.uri=e.host.__metadata.uri,c3.service.retrieveSBOClientSessions(i.SBOClient.ID,function(n){if(n.d&&n.d.results&&n.d.results.length>0){var o=new c3retrieveSBOClientSession(r,i.SBOClient.ID,i.ID,i.SBOClient.Version,e.host.Version,e.host.ID,t);o.finishEvent.push(function(){setTimeout(function(){e.reloadComponent()},2e3)}),o.show(),r.loadingWin0.close(),r.close()}else c3.service.RegisterPresentationServerAsync(i.ID,e.host.ID,!1,function(t){t.d&&t.d.RegisterPresentationServerAsync>0&&r.listenTask(t.d.RegisterPresentationServerAsync,4),r.loadingWin0.close(),setTimeout(function(){e.reloadComponent()},2e3);if(!t.status||!(t.status<200||t.status>=300))s&&s(),r.close()},t.userName,t.password)})}else c3.service.RegisterPresentationServerAsync(i.ID,e.host.ID,!1,function(t){t.d&&t.d.RegisterPresentationServerAsync>0&&r.listenTask(t.d.RegisterPresentationServerAsync,4),r.loadingWin0.close(),console.log(r),setTimeout(function(){e.reloadComponent()},2e3);if(!t.status||!(t.status<200||t.status>=300))s&&s(),r.close()},t.userName,t.password)}function u(e,t,n){}function a(t,n,i,s){c3.service.RegisterBrowserAccessServerAsync(i.ID,e.host.ID,!0,function(e){e.d&&e.d.RegisterBrowserAccessServerAsync>0&&r.listenTask(e.d.RegisterBrowserAccessServerAsync,4),r.loadingWin0.close(),console.log(r),setTimeout(function(){r.reloadSWComp(5)},2e3);if(!e.status||!(e.status<200||e.status>=300))s&&s(),r.close()},t.userName,t.password)}function f(){var t={},n=function(t){e.reload(),r.close()};switch(r.selectedSW){case"RES_PRESENTATION_SERVER":c3.service.getPresentationServers(r.selectedItem).expand("Machine,SBOClient").query(function(i){var s=null;e.host.SoftwareRepository!=null&&e.host.SoftwareRepository.HANAenabled==null?s=ServerType.MSSQL_SERVER:e.host.SoftwareRepository!=null&&e.host.SoftwareRepository.SQLenabled==null&&(s=ServerType.HANA_SERVER);if(i.data.SBOClient&&i.data.SBOClient.ID>0&&e.host.Version==i.data.SBOClient.Version&&s==i.data.SBOClient.ServerType)r.loadingWin0=new loadingWindow,r.loadingWin0.show(),o(t,n,i.data);else if(e&&e.host&&e.host.Version>="882.075.11"){var u=function(e){var t=[{name:"User Name",value:new textbox({isRequired:!0,pattern:"([0-9a-zA-Z-_.]){1,}"})},{name:"Password",value:new textbox({isRequired:!0,type:"password"})}],n={getActionButtonText:function(){return localizedString("MISC_OK")}};this.base=c3.dialog,this.base(n),this.getId=function(){return"operatorBox"},this.getTitle=function(){return localizedString("MISC_CONFIGURATION")},this.getWidth=function(){return 420},this.getHeight=function(){return 295};var r=this;r.content=$("<div>"),r.selectedSW="",this.onInit=function(){var e=$("<div>");e.css({margin:"0 0 15px 0"}),e.append($("<p>").append(localizedString("REGPS_CONFIRM_MSG")).css({margin:"0 0 10px 0"})),e.append($("<p>").append(localizedString("REGPS_CONFIRM_MSG_SERVICEACCOUNT")).css({margin:"10px 0 0 0"})),r.content.append(e);for(var n=0;n<t.length;n++){var i=Utility.CreateRow(t[n].name,t[n].value.attr({width:"80px"}));r.content.append(i)}r.content.append($("<div>").css({"padding-left":"37%","padding-top":"5px"}))};var i={checkValidity:function(){return t[0].value.checkValidity()&&t[1].value.checkValidity()}};n.validator=i,this.finish=function(){var n=t[0].value.val(),i=t[1].value.val(),s={success:function(){r&&r.close(),e({username:n,password:i},function(){r&&r.close()})}};suManager.validateClientAgentServiceAccount({userName:n,password:i},s)}},a=function(e,s){t.userName=e.username,t.password=e.password,r.loadingWin0=new loadingWindow,r.loadingWin0.show(),o(t,n,i.data,s)},f=new u(a);f.show()}else{var l=$("<div>");l.append($("<p>").append(localizedString("REGPS_CONFIRM_MSG")).css({margin:"0 0 10px 0"})),l.append($("<p>").append(localizedString("REGPS_CONFIRM_MSG_CONTINUE")).css({margin:"10px 0 0 0"}));var c=MessageBox.confirm({msg:l,width:400,height:210});c.yesEvent.push(function(){r.loadingWin0=new loadingWindow,r.loadingWin0.show(),o(t,n,i.data)})}});break;case"RES_B1I_SERVER":t.ID=e.host.ID,t.IntegrationComponent={},t.IntegrationComponent.__metadata={},t.IntegrationComponent.__metadata.uri=r.selectedItem,c3.service.updateHostingUnit(t,n);break;case"RES_B1AH_SERVER":t.ID=e.host.ID,t.AnalyticsService={},t.AnalyticsService.__metadata={},t.AnalyticsService.__metadata.uri=r.selectedItem,c3.service.updateHostingUnit(t,n);break;case"RES_XAPP_SERVICE":t.ID=e.host.ID,t.XAppService={},t.XAppService.__metadata={},t.XAppService.__metadata.uri=r.selectedItem,c3.service.updateHostingUnit(t,n);break;case"RES_MAILER_SERVICE":t.ID=e.host.ID,t.Mailer={},t.Mailer.__metadata={},t.Mailer.__metadata.uri=r.selectedItem,c3.service.updateHostingUnit(t,n);break;case"RES_BROWSERACCESS_SERVER":c3.service.getBrowserAccessServers(r.selectedItem).expand("Machine,SBOClient").query(function(i){if(e&&e.host&&e.host.Version>="882.075.11"){var s=function(e){var t=[{name:"User Name",value:new textbox({isRequired:!0,pattern:"([0-9a-zA-Z-_.]){1,}"})},{name:"Password",value:new textbox({isRequired:!0,type:"password"})}],n={getActionButtonText:function(){return localizedString("MISC_OK")}};this.base=c3.dialog,this.base(n),this.getId=function(){return"operatorBox"},this.getTitle=function(){return localizedString("MISC_CONFIGURATION")},this.getWidth=function(){return 420},this.getHeight=function(){return 295};var r=this;r.content=$("<div>"),r.selectedSW="",this.onInit=function(){var e=$("<div>");e.css({margin:"0 0 15px 0"}),e.append($("<p>").append(localizedString("REGPS_CONFIRM_MSG")).css({margin:"0 0 10px 0"})),e.append($("<p>").append(localizedString("REGPS_CONFIRM_MSG_SERVICEACCOUNT")).css({margin:"10px 0 0 0"})),r.content.append(e);for(var n=0;n<t.length;n++){var i=Utility.CreateRow(t[n].name,t[n].value.attr({width:"80px"}));r.content.append(i)}r.content.append($("<div>").css({"padding-left":"37%","padding-top":"5px"}))};var i={checkValidity:function(){return t[0].value.checkValidity()&&t[1].value.checkValidity()}};n.validator=i,this.finish=function(){var n=t[0].value.val(),i=t[1].value.val(),s={success:function(){r&&r.close(),e({username:n,password:i},function(){r&&r.close()})}};suManager.validateClientAgentServiceAccount({userName:n,password:i},s)}},o=function(e,s){t.userName=e.username,t.password=e.password,r.loadingWin0=new loadingWindow,r.loadingWin0.show(),a(t,n,i.data,s)},u=new s(o);u.show()}else{var f=$("<div>");f.append($("<p>").append(localizedString("REGPS_CONFIRM_MSG")).css({margin:"0 0 10px 0"})),f.append($("<p>").append(localizedString("REGPS_CONFIRM_MSG_CONTINUE")).css({margin:"10px 0 0 0"}));var l=MessageBox.confirm({msg:f,width:400,height:210});l.yesEvent.push(function(){r.loadingWin0=new loadingWindow,r.loadingWin0.show(),a(t,n,i.data)})}})}}function l(t,n){t.append($("<option>"));switch(n){case"RES_PRESENTATION_SERVER":r.lw0=new loadingWindow,r.lw0.show(),c3.service.getPresentationServers().expand("Machine,SBOClient").filter("ServiceUnit eq null and Status eq 'Online'").query(function(n){var i=[];c3.service.getBrowserAccessServers().expand("Machine,SBOClient, ServiceUnit").filter("ServiceUnit ne null").query(function(s){if(s.data&&s.data.length>0)for(var o=0;o<s.data.length;o++)i.push({Name:s.data[o].Name,ID:s.data[o].ID,MachineName:s.data[o].Machine.Hostname,SUID:s.data[o].ServiceUnit.ID});if(n.data&&n.data.length>0){var u=[];for(var o=0;o<n.data.length;o++){var a=!1;for(var f=0;f<i.length;f++)if(i[f].MachineName==n.data[o].Machine.Hostname&&e&&e.host&&e.host.ID!=i[f].SUID){a=!0;break}a==0&&u.push({Name:n.data[o].Name,ID:n.data[o].ID,MachineName:n.data[o].Machine.Hostname})}c3.service.retrieveWorkstations().query(function(e){if(e.data&&e.data.length>0)for(var n=0;n<u.length;n++)for(var i=0;i<e.data.length>0;i++)if(e.data[i].Hostname==u[n].MachineName&&e.data[i].Status=="Available"){var s=$("<option>").attr({value:u[n].ID});s.text(u[n].Name),t.append(s);break}r.lw0&&r.lw0.close()})}else r.lw0&&r.lw0.close()})});break;case"RES_B1I_SERVER":c3.service.getB1iServers().query(function(e){var n=e;c3.service.getHostingUnits().expand("IntegrationComponent").query(function(e){for(var r=0;r<n.data.length;r++)if(e!=null&&e.data!=null&&e.data.length>0){var i=!1;for(var s=0;s<e.data.length;s++)if(e.data[s].IntegrationComponent!=null&&n.data[r].ID==e.data[s].IntegrationComponent.ID){i=!0;break}if(!i){var o=$("<option>").attr({value:n.data[r].__metadata.uri});o.text(n.data[r].Name),t.append(o)}}else{var o=$("<option>").attr({value:n.data[r].__metadata.uri});o.text(n.data[r].Name),t.append(o)}})});break;case"RES_B1AH_SERVER":c3.service.getB1aServers().query(function(e){var n=e;c3.service.getHostingUnits().expand("AnalyticsService").query(function(e){for(var r=0;r<n.data.length;r++)if(e!=null&&e.data!=null&&e.data.length>0){var i=!1;for(var s=0;s<e.data.length;s++)if(e.data[s].AnalyticsService!=null&&n.data[r].ID==e.data[s].AnalyticsService.ID){i=!0;break}if(!i){var o=$("<option>").attr({value:n.data[r].__metadata.uri});o.text(n.data[r].Name),t.append(o)}}else{var o=$("<option>").attr({value:n.data[r].__metadata.uri});o.text(n.data[r].Name),t.append(o)}})});break;case"RES_XAPP_SERVICE":c3.service.getXAppServices().query(function(e){var n=e;c3.service.getHostingUnits().expand("XAppService").query(function(e){for(var r=0;r<n.data.length;r++)if(e!=null&&e.data!=null&&e.data.length>0){var i=!1;for(var s=0;s<e.data.length;s++)if(e.data[s].XAppService!=null&&n.data[r].ID==e.data[s].XAppService.ID){i=!0;break}if(!i){var o=$("<option>").attr({value:n.data[r].__metadata.uri});o.text(n.data[r].Name),t.append(o)}}else{var o=$("<option>").attr({value:n.data[r].__metadata.uri});o.text(n.data[r].Name),t.append(o)}})});break;case"RES_MAILER_SERVICE":c3.service.getMailerServices().query(function(e){var n=e;c3.service.getHostingUnits().expand("Mailer").query(function(e){for(var r=0;r<n.data.length;r++)if(e!=null&&e.data!=null&&e.data.length>0){var i=!1;for(var s=0;s<e.data.length;s++)if(e.data[s].Mailer!=null&&n.data[r].ID==e.data[s].Mailer.ID){i=!0;break}if(!i){var o=$("<option>").attr({value:n.data[r].__metadata.uri});o.text(n.data[r].Name),t.append(o)}}else{var o=$("<option>").attr({value:n.data[r].__metadata.uri});o.text(n.data[r].Name),t.append(o)}})});break;case"RES_BROWSERACCESS_SERVER":c3.service.getBrowserAccessServers().expand("Machine,SBOClient").filter("ServiceUnit eq null and Status eq 'Online'").query(function(n){var i=[];c3.service.getPresentationServers().expand("Machine,SBOClient,ServiceUnit").filter("ServiceUnit ne null").query(function(s){if(s.data&&s.data.length>0)for(var o=0;o<s.data.length;o++)i.push({Name:s.data[o].Name,ID:s.data[o].ID,MachineName:s.data[o].Machine.Hostname,SUID:s.data[o].ServiceUnit.ID});if(n.data&&n.data.length>0){var u=[];for(var o=0;o<n.data.length;o++)if(e&&e.host&&e.host.Version.localeCompare("910.140.08")>=0){var a=!1;for(var f=0;f<i.length;f++)if(i[f].MachineName==n.data[o].Machine.Hostname&&e.host.ID!=i[f].SUID){a=!0;break}a==0&&u.push({Name:n.data[o].Name,ID:n.data[o].ID,MachineName:n.data[o].Machine.Hostname})}for(var f=0;f<u.length;f++){var l=$("<option>").attr({value:u[f].ID});l.text(u[f].Name),t.append(l)}}else r.lw0&&r.lw0.close()})})}}var e=arguments[0],t=[{name:localizedString("RES_PRESENTATION_SERVER"),value:"RES_PRESENTATION_SERVER"},{name:localizedString("RES_B1I_SERVER"),value:"RES_B1I_SERVER"},{name:localizedString("RES_MAILER_SERVICE"),value:"RES_MAILER_SERVICE"},{name:localizedString("RES_B1AH_SERVER"),value:"RES_B1AH_SERVER"},{name:localizedString("RES_XAPP_SERVICE"),value:"RES_XAPP_SERVICE"},{name:localizedString("RES_BROWSERACCESS_SERVER"),value:"RES_BROWSERACCESS_SERVER"}],n={getActionButtonText:function(){return localizedString("MISC_REGISTER")}};this.base=c3.dialog,this.base(n),this.getId=function(){return"selectSWComponent"},this.getTitle=function(){return localizedString("SU_SW_TLT")},this.getWidth=function(){return 480},this.getHeight=function(){return 265};var r=this,i=null;r.content=$("<div>"),r.selectedSW="",this.onInit=function(){for(var e=0;e<t.length;e++){var n=$("<input>").attr({id:"sw"+e,type:"radio",name:"selectSWComponent",value:t[e].value});e==0&&(n.attr({checked:!0}),r.selectedSW=t[e].value);var i=$("<div>").addClass("row");i.append(n),i.append($("<label>").attr({"for":"sw"+e}).append(t[e].name).css({display:"inline-block",width:"180px"}));var o=$("<select>").css({width:"200px"}).attr({Id:t[e].value});t[e].radio=n,t[e].selectCtrl=o,e==0?o.attr({disabled:0}):o.attr({disabled:1}),i.append(o);var u=$("<input>").attr({type:"button",value:localizedString("MISC_REGISTER")}),a=$("<input>").attr({type:"button",value:localizedString("MISC_NEW")+"..."});a.click(function(){s()}),i.append("</br>"),r.content.append(i)}},this.onViewAppear=function(){var n=!1,i=!1,s=!1,o=!1;for(var u=0;u<e.swData.length;u++)e.swData[u].Type==localizedString("RES_B1I_SERVER")&&(n=!0),e.swData[u].Type==localizedString("RES_MAILER_SERVICE")&&(s=!0),e.swData[u].Type=="AnalyticsService"&&(i=!0),e.swData[u].Type=="XAppService"&&(o=!0);$.each(t,function(e,u){u.radio.click(function(){r.selectedSW=$(this).val(),r.selectedItem=$(u.selectCtrl).val();for(var n=0;n<t.length;n++)n==e?t[n].selectCtrl.attr({disabled:0}):t[n].selectCtrl.attr({disabled:1})}),u.selectCtrl.change(function(){r.selectedItem=$(this).val()}),l(u.selectCtrl,u.value),s&&u.value=="RES_MAILER_SERVICE"&&u.radio.attr({disabled:1}),i&&u.value=="RES_B1AH_SERVER"&&u.radio.attr({disabled:1}),o&&u.value=="RES_XAPP_SERVICE"&&u.radio.attr({disabled:1}),n&&u.value=="RES_B1I_SERVER"&&u.radio.attr({disabled:1})})},this.finish=function(){r.selectedItem!=null&&r.selectedItem!=""&&f()},r.reloadSWComp=function(t){function n(){if(isNaN(parseInt(t)))return;if(t<=0)return;e.reloadComponent(),t--,setTimeout(n,2e3)}n()},r.listenTask=function(e,t){function n(){if(isNaN(parseInt(t)))return;if(t<=0)return;c3.service.getTaskProgress(e).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase().toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(e).expand("TaskParameters").query(function(e){Utility.logTaskError(e.data)}):(t--,setTimeout(n,5e3))})}n()}}function registerStorage(){function s(){var t=null,n=!0;switch(r.selectedStorage){case"RES_IMPL_RSTY":t=new c3registerImplRepository(e,n),t.show();break;case"RES_COMP_TEMP_RSTY":t=new c3registerCompanyTemplateRepository(e,n),t.show()}}function o(){var t={},n=function(t){e.reload(),r.close()};switch(r.selectedStorage){case"RES_IMPL_RSTY":t.ID=e.host.ID,t.ImplementationRepository={},t.ImplementationRepository.__metadata={},t.ImplementationRepository.__metadata.uri=r.selectedItem,c3.service.updateHostingUnit(t,n);break;case"RES_COMP_TEMP_RSTY":t.ID=e.host.ID,t.CompanyTemplateRepository={},t.CompanyTemplateRepository.__metadata={},t.CompanyTemplateRepository.__metadata.uri=r.selectedItem,c3.service.updateHostingUnit(t,n);break;case"RES_SH_FOLDER":t.ID=e.host.ID,t.SharedFolder={},t.SharedFolder.__metadata={},t.SharedFolder.__metadata.uri=r.selectedItem,c3.service.updateHostingUnit(t,n);break;case"RES_TENANTS_STORAGE":t.ID=e.host.ID,t.TenantsStorage={},t.TenantsStorage.__metadata={},t.TenantsStorage.__metadata.uri=r.selectedItem,c3.service.updateHostingUnit(t,n)}}function u(e,t){e.append($("<option>"));switch(t){case"RES_IMPL_RSTY":c3.service.getImplementationRepositories().filter("Status eq 'Available' and Reseller eq null").query(function(t){for(var n=0;n<t.data.length;n++){var r=$("<option>").attr({value:t.data[n].__metadata.uri});r.text(t.data[n].URI),e.append(r)}});break;case"RES_COMP_TEMP_RSTY":c3.service.getCompanyTemplateRepositories().filter("Status eq 'Available' and Reseller eq null").query(function(t){for(var n=0;n<t.data.length;n++){var r=$("<option>").attr({value:t.data[n].__metadata.uri});r.text(t.data[n].URI),e.append(r)}});break;case"RES_SH_FOLDER":c3.service.getSharedFolders().query(function(t){for(var n=0;n<t.data.length;n++){var r=$("<option>").attr({value:t.data[n].__metadata.uri});r.text(t.data[n].URI),e.append(r)}});break;case"RES_TENANTS_STORAGE":c3.service.getTenantsStorages().query(function(t){for(var n=0;n<t.data.length;n++){var r=$("<option>").attr({value:t.data[n].__metadata.uri});r.append(t.data[n].URI),e.append(r)}})}}var e=arguments[0],t=[{name:localizedString("RES_SH_FOLDER"),value:"RES_SH_FOLDER"},{name:localizedString("RES_TENANTS_STORAGE"),value:"RES_TENANTS_STORAGE"},{name:localizedString("RES_IMPL_RSTY"),value:"RES_IMPL_RSTY"},{name:localizedString("RES_COMP_TEMP_RSTY"),value:"RES_COMP_TEMP_RSTY"}],n={getActionButtonText:function(){return localizedString("MISC_REGISTER")}};this.base=c3.dialog,this.base(n),this.getId=function(){return"registerStorage"},this.getTitle=function(){return localizedString("SU_STORAGE_TLT")},this.getWidth=function(){return 480},this.getHeight=function(){return 210};var r=this,i=null;r.content=$("<div>"),r.selectedStorage="",this.onInit=function(){for(var e=0;e<t.length;e++){var n=$("<input>").attr({type:"radio",name:"selectSWComponent",value:t[e].value}),i=$("<div>").addClass("row");i.append(n),i.append($("<label>").append(t[e].name).css({display:"inline-block",width:"180px"}));var o=$("<select>").css({width:"200px"}).attr({Id:t[e].value});t[e].radio=n,t[e].selectCtrl=o,o.attr({disabled:1}),i.append(o);var u=$("<input>").attr({type:"button",value:localizedString("MISC_REGISTER")}),a=$("<input>").attr({type:"button",value:localizedString("MISC_NEW")+"..."});a.click(function(){s()}),i.append("</br>"),r.content.append(i)}},this.onViewAppear=function(){var n=!1,i=!1,s=!1,o=!1;for(var a=0;a<e.storageData.length;a++)localizedString("RES_IMPL_RSTY")==e.storageData[a].Type&&(n=!0),localizedString("RES_COMP_TEMP_RSTY")==e.storageData[a].Type&&(i=!0),localizedString("RES_SH_FOLDER")==e.storageData[a].Type&&(s=!0),localizedString("RES_TENANTS_STORAGE")==e.storageData[a].Type&&(o=!0);$.each(t,function(e,a){a.radio.click(function(){r.selectedStorage=$(this).val(),r.selectedItem=$(a.selectCtrl).val();for(var n=0;n<t.length;n++)n==e?t[n].selectCtrl.attr({disabled:0}):t[n].selectCtrl.attr({disabled:1})}),a.selectCtrl.change(function(){r.selectedItem=$(this).val()}),u(a.selectCtrl,a.value),n&&a.value=="RES_IMPL_RSTY"&&a.radio.attr({disabled:1}),i&&a.value=="RES_COMP_TEMP_RSTY"&&a.radio.attr({disabled:1}),s&&a.value=="RES_SH_FOLDER"&&a.radio.attr({disabled:1}),o&&a.value=="RES_TENANTS_STORAGE"&&a.radio.attr({disabled:1})})},this.finish=function(){r.selectedItem!=null&&r.selectedItem!=""&&o()}}function c3tenant(){function addProcessingRecord(e){c3.service.getTasks().expand("TaskParameters").filter("((TaskType eq 'CreateTenant' or TaskType eq 'DuplicateTenant') and (Status eq 'Processing' or Status eq 'Pending' or Status eq 'WaitingForApproval')) or (TaskType eq 'TenantUpgrade' and Status eq 'WaitingForApproval')").query(function(t){if(t.data&&t.data.length>0){var n=$.trim(self.selectHU.find("option:selected").text());for(var r=0;r<t.data.length;r++){var i=t.data[r].TaskParameters.results;if(i&&i.length>0){var s=null;t.data[r].Status!="WaitingForApproval"?s={TaskID:t.data[r].ID,ErrorCode:t.data[r].ErrorCode,TaskType:t.data[r].TaskType}:s={ErrorCode:t.data[r].ErrorCode,TaskStatus:"WaitingForApproval",TaskType:t.data[r].TaskType};var o=0;for(var u=0;u<i.length;u++)i[u].Name=="ID"&&(o=parseInt(i[u].Value)),s[i[u].Name]=i[u].Value;for(var a=e.data.length-1;a>=0;a--)if(e.data[a].ID.toString()==s.ID){e.data.remove(a);break}if(s.TaskType!="TenantUpgrade")self.selectHU.val()!="All"&&self.selectHU.val()!="failed"?s.ServiceUnit_Name==n&&e.data.push(s):e.data.push(s);else{var f=t.data[r].ResourceID;for(var l=0;l<e.data.length;l++)f==e.data[l].ID&&(e.data[l].TaskType="TenantUpgrade",e.data[l].TaskStatus="WaitingForApproval")}}}}else self.gridDelegate.totalCount=0;bindTable(e)})}function createToolbar(){var e=id+"_toolbar",t=$("<section>").attr({id:e}).addClass("tools"),n=$("<input>").attr({value:localizedString("MISC_NEW"),type:"button",id:id+"btnNew"}),r=$("<input>").attr({value:localizedString("MISC_REGISTER"),type:"button",id:id+"btnRegister"}),s=(new Button({value:localizedString("BUTTON_HU_PREUPGRADE1"),permissions:[permissionItems.operator]})).dom,o=(new Button({value:upgradeTxt})).dom,u=(new Button({value:localizedString("BTN_TNTCREATION_DUPLICATE")})).dom,a=$("<input>").attr({value:delTxt,type:"button"}),f=$("<select>").addClass("pagingComboBox");for(i=0;i<self.pagingOptions.length;i++){var l=getCookie(id+"_PageSize")!=null?getCookie(id+"_PageSize"):"500";f.append(new Option(self.pagingOptions[i],self.pagingOptions[i],!0,getCookie(id+"_SplitPage")=="false"?self.pagingOptions[i]==self.pagingOptions[self.pagingOptions.length-1]?!0:!1:self.pagingOptions[i]==l?!0:!1))}var c=$("<label>").append(String.format(localizedString("PAGING_LABEL"))).addClass("pagingLabel").append($("<span>").addClass("split").css({"float":"left"})),h=$("<a>").attr({href:"#",id:"dkeyManagement",title:localizedString("DKEYMANAGEMENT")}).addClass("dkeymanagement").css("float","left"),p=$("<a>").attr({href:"#",id:"btnRefresh_"+id,title:localizedString("MISC_REFRESH")}).addClass("refresh");self.btnNew=n,self.btnRegister=r,self.btnPreupgradeTesting=s,self.btnUpgrade=o,self.btnDuplicate=u,self.btnDelete=a,self.btnDkeyManagement=h,self.cmbboxPaging=f,self.cmbboxPagingLabel=c,n.click(function(){createTenant(self)}),r.click(function(){registerTenant(self)}),s.click(function(){var e={HostingUnitId:selectedItem.ServiceUnit_ID,Version:selectedItem.ServiceUnit_Version},t=new c3tenantPreUpgrade(e,self,selectedItem);t.show()}),o.click(function(){var e={HostingUnitId:selectedItem.ServiceUnit_ID,Version:selectedItem.ServiceUnit_Version},t=new c3tenantUpgrade(e,self,selectedItem);t.show()}),u.click(function(){if(selectedItem!=null){var e=new c3duplicateTenant(self,selectedItem);e.show()}}),a.click(function(){if(selectedItem!=null)if(self.selectHU&&self.selectHU.val()=="failed"){var e=selectedItem.TaskID;c3.service.getTasks(e).expand("TaskParameters").query(function(t){var n=$("<div>");n.html(localizedString("POP_MSG_WARNING")+"<br/>");var r=MessageBox.confirm({msg:n});r.yesEvent.push(function(){var t={ID:e,Archived:!0};c3.service.archiveTask(t,function(){onSelectHUChanged(self.selectHU.val())})})})}else{var t=$("<div>").append(String.format(localizedString("RES_MISC_DELETE_CONFIRM"),d)),n=$("<input>").attr({type:"checkbox"}),r=$("<span>").append(localizedString("RESPOOL_CMDB_DLT_RELATEDDB"));r.bind("click",function(){n.attr("checked")==1?n.attr({checked:!1}):n.attr({checked:!0}),bindDeleteDBConfirmation(n)}),n.click(function(){bindDeleteDBConfirmation(this)}),t.append($("<br>")).append($("<br>")).append(n).append(r);var i=MessageBox.confirm({msg:t});i.yesEvent.push(function(){var e={};e.success=function(e){self.loadingWin!=null&&self.loadingWin.close(),cometdManager.getConnectedStatus()||console.warn("Notification connection failed!")},e.error=function(e){self.loadingWin!=null&&self.loadingWin.close()};var t=n.attr("checked"),r={DeleteDB:t};e.params=r,c3.service.deleteTenant(selectedItem.ID,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),d))}),h.click(function(){var e=(new Button({value:localizedString("ImportConfigFile")})).dom;e.click(function(){var e=new c3importDynamicKey(self,self.parent);e.show()});var t=(new Button({value:localizedString("ExportConfigFile")})).dom;t.click(function(){var e=new c3exportDynamicKey(self,self.parent);e.show()});var n=$("<div>").append(localizedString("ImportDesc")).append("<br></br>").append(e).append("<br></br>").append(localizedString("ExportDesc")).append("<br></br>").append(t).css({height:"50px"}),r=MessageBox.show({msg:n,title:localizedString("DKEYMANAGEMENT"),width:500,height:300,buttons:MessageBoxButton.CLOSE})}),p.click(function(){onSelectHUChanged(self.selectHU.val())}),f.change(function(){self.cmbboxPaging.val()==localizedString("PAGING_VALUE_ALL")?self.splitPage=!1:self.splitPage=!0,self.pageSize=self.cmbboxPaging.val(),setCookie(id+"_SplitPage",self.splitPage),setCookie(id+"_PageSize",self.pageSize),self.gridDelegate!=undefined&&(self.gridDelegate.splitPage=self.splitPage,self.gridDelegate.setPageSize(self.pageSize)),onSelectHUChanged(self.selectHU.val())});var d=localizedString("TENANT");disableControl(),t.append(n),t.append(r),t.append($("<span>").addClass("split")),t.append(s),t.append(o),t.append(u),t.append(a);var v=new searchbox({inputCallback:function(e){return self.dataGrid.searchText(e)}}),m=(new Split({permissions:[permissionItems.operator]})).dom;return t.append($("<div>").css({"float":"right"}).append(m.css({"float":"left"})).append(v.css({"float":"left"})).append($("<span>").addClass("split")).append(p.css({"float":"right"}))),self.toolbar=t,t}function bindDeleteDBConfirmation(e){if($(e).attr("checked")==1){var t=$("<div>");t.html(localizedString("TNT_DELETE_DELETEDB_CONFIRM")+"<br/>");var n=MessageBox.confirm({msg:t});n.noEvent.push(function(){$(e).attr("checked",!1)})}}function createTenant(e){var t=new c3newTenant(e,!0,null,!0);t.show()}function registerTenant(e){var t=new c3registerTenant(e);t.show()}function bindViewHU(e){var t=id+"_toolbar";self.toolbar.find("#"+t+"_div_selectHU").remove();var n=$("<div>").attr({id:t+"_div_selectHU"}),r=$("<label>").append(localizedString("CUSTOMER_SELECT_LABEL")+": "),i=$("<select>").attr({id:t+"_selectHU"}),s=$("<option>").attr({id:t+"_optSelectHU_All",value:"All",title:localizedString("TNT_SELECT_ALL")}).append(localizedString("TNT_SELECT_ALL"));i.append(s);for(var o=0;o<e.data.length;o++){var u=e.data[o].Name;u!=null&&u.length>50&&(u=u.substring(0,50)+"..."),s=$("<option>").attr({id:t+"_optSelectHU_"+e.data[o].ID,value:e.data[o].ID,title:e.data[o].Name}).append(u),i.append(s)}var a=$("<optgroup>").attr({label:" ==================== "});i.append(a),f=$("<option>").attr({title:localizedString("TNT_SELECT_TRIALTNTS")}).val("trial").append(localizedString("TNT_SELECT_TRIALTNTS")),i.append(f),a=$("<optgroup>").attr({label:" ==================== "}),i.append(a);var f=$("<option>").attr({title:localizedString("TNT_SELECT_FAILEDPVNING")}).val("failed").append(localizedString("TNT_SELECT_FAILEDPVNING"));i.append(f),self.selectHU=i,i.bind("change",function(){if($(this).val()=="")return;onSelectHUChanged($(this).val())}),n.append($("<span>").addClass("split")),n.append(r),n.append(i),n.css({"float":"right"}),self.toolbar.append(n),c3.hasPermission([permissionItems.operator])&&(self.toolbar.find("#spanId")&&self.toolbar.find("#spanId").remove(),self.toolbar.append($("<div>").css({"float":"right"}).append(self.btnDkeyManagement).append(self.cmbboxPagingLabel).append(self.cmbboxPaging)))}function onSelectHUChanged(e){self.loadingWin==null&&(self.loadingWin=new loadingWindow),self.loadingWin.show();if(e=="All"){var t=c3.service.getTenants().expand("Group,ServiceUnit,SBOSharedFolder,LicenseFile/LicenseServer, ServiceUnit/LicenseServer,ServiceUnit/CommonDatabase,ServiceUnit/CommonDatabase/DatabaseInstance, Group/Users,Customer,Customer/Group,CompanyDatabase");t.count().query(self.countHandler),self.splitPage?t=t.orderby("ID desc").top(self.pageSize).skip(page*self.pageSize):t=t.orderby("ID desc"),t.query(addProcessingRecord)}else if(e=="failed"){var n={data:[]};c3.service.getTasks().filter("TaskType eq 'CreateTenant' and Status eq 'Failed' and Archived eq false ").expand("TaskParameters").query(function(e){if(e.data&&e.data.length>0)for(var t=0;t<e.data.length;t++){var r=e.data[t].TaskParameters.results;if(r&&r.length>0){var i={TaskID:e.data[t].ID,ErrorCode:e.data[t].ErrorCode};for(var s=0;s<r.length;s++)i[r[s].Name]=r[s].Value;i.Status="Offline",n.data.push(i)}}bindTable(n)})}else if(e=="trial"){var t=c3.service.getTenants().filter("Purpose eq 'Trial'").expand("Group,ServiceUnit,SBOSharedFolder,LicenseFile/LicenseServer, ServiceUnit/LicenseServer,ServiceUnit/CommonDatabase,ServiceUnit/CommonDatabase/DatabaseInstance,Group/Users,Customer,Customer/Group,CompanyDatabase");t.count().query(self.countHandler),self.splitPage?t=t.orderby("ID desc").top(self.pageSize).skip(page*self.pageSize):t=t.orderby("ID desc"),t.query(addProcessingRecord)}else{var t=c3.service.getTenants().filter("ServiceUnit/ID eq "+e).expand("Group,ServiceUnit,SBOSharedFolder,LicenseFile/LicenseServer, ServiceUnit/LicenseServer,ServiceUnit/CommonDatabase,ServiceUnit/CommonDatabase/DatabaseInstance,Group/Users,Customer,Customer/Group,CompanyDatabase");t.count().query(self.countHandler),self.splitPage?t=t.orderby("ID desc").top(self.pageSize).skip(page*self.pageSize):t=t.orderby("ID desc"),t.query(addProcessingRecord)}}function createTable(){var e=$("<section>"),t=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"CompanyDatabase_CompanyName",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"6%"},{name:"Customer_Name",description:localizedString("CUSTOMER"),type:"text",width:"12%"},{name:"ServiceUnit_Name",description:localizedString("HOSTUNIT"),type:"text",width:"10%"},{name:"ServiceUnit_Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"9%"},{name:"DBType",description:localizedString("MISC_DBTYPE"),type:"text",width:"7%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"11%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"14%"},{name:"RemainingDays",description:localizedString("TNT_LABEL_REMAININGDAYS"),type:"text",width:"11%",dataType:"number"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"10%"},{name:"Phone",description:localizedString("CUSTOMER_COLUMN_PHONE"),type:"text",width:"10%"}];self.data=[],self.colList=t;var n={pagingMode:!0,pageSize:self.pageSize,splitPage:!0,printRecordsCount:!0,databaseInstancesErrorStatus:[],setPageSize:function(e){pageSize=e},getPageSize:function(){return self.pageSize},getSplitPage:function(){return self.splitPage},getPrintRecordsCountOption:function(){return this.printRecordsCount},getDetailsID:function(){return $("#"+id+"_detail_tab_body")},autoResize:function(){return 620},getHeaderSpec:function(){return t},getRowCount:function(){return self.data.length},getRow:function(e){return self.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return selectedIndex},getCell:getCell,getTotalCount:function(){return self.totalCount},loadPage:function(e,t){c3.service.getTenants().expand("ServiceUnit,SBOSharedFolder,LicenseFile,LicenseFile/LicenseServer,ServiceUnit/LicenseServer,ServiceUnit/CommonDatabase,ServiceUnit/CommonDatabase/DatabaseInstance, Customer,Customer/Group,CompanyDatabase").orderby("ID desc").skip(e).top(t).query({success:function(t){self.data.clear(),databaseInstances=[];for(var n=0;n<t.data.length;n++)self.data.push(t.data[n]),self.data[n].ServiceUnit&&self.data[n].ServiceUnit.CommonDatabase&&self.data[n].ServiceUnit.CommonDatabase.DatabaseInstance&&databaseInstances.push(self.data[n].ServiceUnit.CommonDatabase.DatabaseInstance.Name);checkDatabaseInstancesStatus(databaseInstances),self.data=c3.service.convertData(self.data),self.dataGrid.printElementCount(self.data.length,self.totalCount),onRowSelected(selectedIndex),self.dataGrid.refreshContent(),e==0&&self.reload()},error:function(e){self.loadingWindow.close()}})},isDbInstanceError:function(e){return this.databaseInstancesErrorStatus.indexOf(e)>=0},setDbInstanceError:function(e){if(this.isDbInstanceError(e))return;this.databaseInstancesErrorStatus.push(e),self.dataGrid.refreshContent()},cleanDbInstanceErrors:function(){this.databaseInstancesErrorStatus=[]}};self.gridDelegate=n;var r=$(e).gridview({delegate:n});return r.rowSelectedEvent.push(function(){selectedIndex!=this.index&&onRowSelected(this.index),(self.data[this.index].TaskID===undefined||self.data[this.index].TaskID<=0)&&enableControl()}),self.dataGrid=r,self.tableContianer=e,e}function getCell(){var resVal=null;if(this.colName=="Result"){var rowData=this.data,tenantId=rowData.ID,cellContent=$("<div>"),container=this;if(self.gridDelegate&&rowData.ServiceUnit_CommonDatabase_DatabaseInstance&&self.gridDelegate.isDbInstanceError(rowData.ServiceUnit_CommonDatabase_DatabaseInstance.Name)==1)return cellContent.append(String.format(localizedString("TNT_ERR_STATUS"),localizedString("RES_MS_SQL"))),this.parentRow[0].style.color="grey",cellContent;if(rowData.TaskStatus=="WaitingForApproval")return cellContent.append(localizedString(rowData.TaskStatus.toUpperCase())).attr("title",localizedString(rowData.TaskType.toUpperCase())+" - "+localizedString(rowData.TaskStatus.toUpperCase())),cellContent;if(rowData.TaskID&&rowData.TaskID>0){if(self.selectHU&&self.selectHU.val()=="failed"){var link=$("<a>").attr({href:"#"}).text(localizedString("LINK_DETAILS"));return link.click(function(){c3.service.getTasks(rowData.TaskID).expand("TaskParameters").query(function(e){var t=$("<fieldset>");t.append($("<legend>").css({"padding-left":"10px","line-height":"25px"}).append("<strong>"+localizedString("RESPOOL_CMDB_POPWIN_TLT")+":</strong>&nbsp;&nbsp;&nbsp;&nbsp;").append(e.data.ErrorCode)),t.append($("<span>").css({"padding-left":"10px","line-height":"25px"}).append('<span title="'+e.data.ResultDescription+'">'+e.data.ResultDescription+"</span>"));var n=0,r=200;e.data.ResultDescription.length&&(n=e.data.ResultDescription.length,r=(n/40+1)*30+110);var i=MessageBox.prompt({msg:t,width:350,height:r,title:localizedString("AVAILABLE_STATUS_WARNING")})})}),link}var dupLable=null;rowData.TaskType=="DuplicateTenant"?dupLable="Duplicating":dupLable="Provisioning";var tenatHandlers=[];tenatHandlers.push(function(e){var t=e.c3progress(function(e){return function(){return getProgress(t,e,container)}}(rowData.TaskID),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0,label:dupLable});return t}(cellContent));for(var i=0,ii=tenatHandlers.length;i<ii;i++)0==i&&tenatHandlers[i].start(),i<ii-1&&tenatHandlers[i].finishEvent.push(function(e){return function(t){e.start()}}(tenatHandlers[i+1]))}else{var taskQuery=c3.service.getTasks().filter("ResourceType eq 'Tenant' and ResourceID eq "+tenantId+" and (TaskType eq 'PreUpgradeTenant' or TaskType eq 'TenantUpgrade') and Status eq 'Processing'");taskQuery.query(function(result){if(result!=null&&result.data!=null&&result.data.length>0){var taskid=result.data[0].ID,taskType=result.data[0].TaskType;rowData.UPTaskID=taskid,self.getSelectedItem().ID==rowData.ID&&nestedUnits[0].dataform.disableEdit();var label="";taskType=="PreUpgradeTenant"?label=localizedString("BUTTON_HU_PREUPGRADE")+"  ":label=localizedString("TNT_PROGRESS_LABEL_TNTUPGRADING")+"  ";if(taskType=="PreUpgradeTenant")c3.service.getSubTask(taskid).query(function(result1){if(result1!=null&&result1.data!=null&&result1.data.length>0){var subtaskid=result1.data[1].ID,TenantProgressHandles=[];TenantProgressHandles.push(function(e){return e.c3progress(function(e){return function(){return getProgress(this,e,container)}}(subtaskid),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0,label:label})}(cellContent));for(var i=0,ii=TenantProgressHandles.length;i<ii;i++)0==i&&TenantProgressHandles[i].start(),i<ii-1?TenantProgressHandles[i].finishEvent.push(function(e){return function(t){e.start()}}(TenantProgressHandles[i+1])):TenantProgressHandles[i].finishEvent.push(function(handler){return function(e){c3.service.getTaskResult(subtaskid).query(function(result){if(result!=null&&result.data!=null&&result.data.GetResult!=null){var errorArray=eval(result.data.GetResult);if(errorArray!=null&&errorArray.length>0){var text=localizedString("MISC_SUCCESS");for(var index=0;index<errorArray.length;index++){if(errorArray[index].Type=="Error"){text=localizedString("MISC_ERROR");break}errorArray[index].Type=="Warning"&&(text=localizedString("MISC_WARNING"))}var span=$("<a>").attr({href:"#"}).text(text);span.click(function(){var e=new c3tenantPreUpgrade_errorMessage(this,errorArray,tenantId);e.show()}),$(cellContent).find("#errorLabel").remove(),$(cellContent).append(span)}}})}}(TenantProgressHandles[i]))}});else{var TenantUpgProgressHandles=[];TenantUpgProgressHandles.push(function(e){return e.c3progress(function(e){return function(){return getProvisioningProgress(this,e,container)}}(taskid),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0,label:label})}(cellContent));for(var i=0,ii=TenantUpgProgressHandles.length;i<ii;i++)0==i&&TenantUpgProgressHandles[i].start(),i<ii-1?TenantUpgProgressHandles[i].finishEvent.push(function(e){return function(t){e.start()}}(TenantUpgProgressHandles[i+1])):TenantUpgProgressHandles[i].finishEvent.push(function(e){return function(e){onSelectHUChanged(self.selectHU.val())}}(TenantUpgProgressHandles[i]))}}})}return cellContent}if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var options={};options.text=this.data[this.colName],this.colName=="LifeCycleStatus"?options.showText=!0:options.textalign="center",resVal=new statusControl(options)}else{if(this.colName=="RemainingDays"){if(this.data["RemainingDays"]!=null){var span=$("<span>").append(this.data.RemainingDays);return this.data["RemainingDays"].toString()=="-1"&&span.html(localizedString("MONITOR_STATUS_UNKNOWN")),span}return null}if(this.colName=="DBType"){var cell=$("<label>");if(this.data.ServiceUnit_CommonDatabase_DatabaseInstance&&this.data.ServiceUnit_CommonDatabase_DatabaseInstance.ServerType)return isHANA(this.data.ServiceUnit_CommonDatabase_DatabaseInstance.ServerType)===!1?cell.append(localizedString("MSSQL")):cell.append(localizedString("SAP HANA")),cell}}return resVal}function bindTable(e,t){c3.service.getTasks().expand("ParentTask").filter("ResourceType eq 'Tenant' and Status eq 'Processing'").query(function(e){self.taskResult=e,self.gridDelegate.getCell=getCell,self.dataGrid.reload()});var n=c3.service.convertData(e.data);self.data=n,databaseInstances=[];for(var r=0;r<e.data.length;r++)e.data[r].ServiceUnit&&e.data[r].ServiceUnit.CommonDatabase&&e.data[r].ServiceUnit.CommonDatabase.DatabaseInstance&&databaseInstances.push(e.data[r].ServiceUnit.CommonDatabase.DatabaseInstance.Name),n[r].CompanyDatabase_IsTrustedConnection==null||n[r].CompanyDatabase_IsTrustedConnection==1?n[r].Authentication_Type=localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN"):n[r].Authentication_Type=localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN");checkDatabaseInstancesStatus(databaseInstances),self.data.length==0?(self.gridDelegate&&(self.gridDelegate.getTip=function(){return self.selectHU&&self.selectHU.val()=="failed"?Utility.CreateTipBoard(localizedString("TNT_FAILEDPVN_EMPTY_TIP_PART"),null,!0):Utility.CreateTipBoard(localizedString("TENANT"),function(){createTenant(self)})}),disableControl()):selectedIndex==-1?disableControl():enableControl(),self.dataGrid.reload(),self.data.length>0&&selectedIndex!=-1?(onRowSelected(selectedIndex),!selectedItem||!selectedItem.ServiceUnit_Status||selectedItem.ServiceUnit_Status!="Online"?nestedUnits[0].dataform.disableEdit():nestedUnits[0].dataform.enableEdit()):(selectedItem=null,selectedIndex=-1,nestedUnits[0].bindData({})),self.loadingWin!=null&&self.loadingWin.close()}function checkDatabaseInstancesStatus(e){self.gridDelegate.cleanDbInstanceErrors(),e=$.unique(e);for(var t=0;t<e.length;t++)self.retrieveMonitorStatus(e[t])}function enableControl(){self.btnDelete.attr({disabled:0}).val(localizedString("BUTTON_HU_DELETE")),self.btnUpgrade.attr({disabled:0}),self.btnPreupgradeTesting.attr({disabled:0}),self.btnNew.attr({disabled:0}),self.btnDuplicate.attr({disabled:0}),selectedItem&&selectedItem.Status!="Online"&&(self.btnUpgrade.attr({disabled:1}),self.btnPreupgradeTesting.attr({disabled:1}),self.btnDuplicate.attr({disabled:1}),self.btnDelete.attr({disabled:1})),selectedItem&&selectedItem.Purpose=="Trial"&&self.btnDuplicate.attr({disabled:1}),selectedItem&&selectedItem.TaskStatus=="WaitingForApproval"&&(self.btnDuplicate.attr({disabled:1}),self.btnDelete.attr({disabled:1}))}function disableControl(){self.btnDelete.attr({disabled:1}),self.btnUpgrade.attr({disabled:1}),self.btnPreupgradeTesting.attr({disabled:1}),self.btnDuplicate.attr({disabled:1}),self.selectHU&&self.selectHU.val()=="failed"?self.btnNew.attr({disabled:1}):self.btnNew.attr({disabled:0})}function onRowSelected(e){var t=nestedUnits[0].navTab.getCurrentTabIndex();nestedUnits[0].navTab.select(0),nestedUnits[0].navTab.select(t),nestedUnits[0].unbindUserData(),selectedIndex=e,selectedItem=self.data[e],selectedItem&&selectedItem.TaskID&&selectedItem.TaskID>0?(nestedUnits[0].onViewWillAppear(),nestedUnits[0].bindData(null),disableControl(),self.selectHU&&self.selectHU.val()=="failed"?(self.btnDelete.attr({disabled:0}),self.btnNew.attr({disabled:1})):(self.btnNew.attr({disabled:0}),self.btnDelete.val("Delete"))):(nestedUnits[0].onViewWillAppear(),nestedUnits[0].bindData(self.data[e]),selectedItem&&nestedUnits[0].refreshTitle(selectedItem.Name),enableControl())}this.base=c3.module,this.base();var id="tenant",container=$("<section>").attr({id:id}),title=localizedString("TENANTS"),delTxt=localizedString("BUTTON_HU_DELETE"),upgradeTxt=localizedString("BUTTON_HU_UPGRADE"),page=0,pageSize=10,self=this,selectedItem=null,selectedIndex=0,nestedUnits=[new c3tenant.detail(this)];self.pageSize=10,self.splitPage=!0,self.totalCount=0,self.refreshPaging=!1,self.pagingOptions=["10","30","100","300","1000",localizedString("PAGING_VALUE_ALL")],this._container=container,this._title=title,this.getSelectedItem=function(){return selectedItem},self.countHandler={success:function(e){self.totalCount=parseInt(e.data,10)},error:function(e){}},this.reload=function(){self.loadingWin==null&&(self.loadingWin=new loadingWindow),self.refreshPaging=!0,self.loadingWin.show();var e=c3.service.getTenants().expand("Group,ServiceUnit,SBOSharedFolder,LicenseFile,LicenseFile/LicenseServer,ServiceUnit/LicenseServer,ServiceUnit/CommonDatabase,ServiceUnit/CommonDatabase/DatabaseInstance, Customer,Customer/Group,CompanyDatabase");e.count().query(self.countHandler),self.splitPage&&(e=e.orderby("ID desc").top(self.pageSize).skip(page*self.pageSize));var t={success:addProcessingRecord,error:function(){self.loadingWin!=null&&self.loadingWin.close()}};e.query(t),self.reloadServiceUnit()},this.onInit=function(){container.append($("<div>").attr("class","title_panel").append(title)),container.append(createToolbar()),self.cmbboxPaging!=undefined&&(self.pageSize=self.cmbboxPaging.val()),getCookie(id+"_SplitPage")!=undefined&&(self.splitPage=getCookie(id+"_SplitPage")=="true"),container.append(createTable()),self.dataGrid&&self.dataGrid.show();for(var e=0;e<nestedUnits.length;e++)container.append(nestedUnits[e].getContainer());nestedUnits[0].onViewWillAppear(),self.reload(),c3ModuleManager.Listeners.push(new c3Listener("ListenTenantDeleting",this.reload))},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Tenants,function(e){self.reload()}),cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){self.reloadServiceUnit()})},this.reloadServiceUnit=function(){c3.service.getHostingUnits().query(bindViewHU)},this.retrieveMonitorStatus=function(e){c3.service.getDBInstanceMonitorStatus(e,{success:function(t){if(t.d.results)for(var n=0;n<t.d.results.length;n++){var r=t.d.results[n];r.StatusCode!=0&&parent.gridDelegate&&parent.gridDelegate.setDbInstanceError(e)}},error:function(e){parent.gridDelegate.cleanDbInstanceErrors()}})};var getProgress=function(progressBar,tid,rowContainer){c3.service.getTaskProgress(tid).query(function(result){var status=result.data.GetTaskProperties.split(",");"FAILED"==status[0].toUpperCase().toUpperCase()||"CANCELLED"==status[0].toUpperCase()||"ROLLBACK"==status[0].toUpperCase()?c3.service.getTasks(tid).expand("TaskParameters").query(function(e){progressBar.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)}):"SUCCESSFUL"==status[0].toUpperCase()?(c3.service.getTaskResult(tid).query(function(result1){if(result1!=null&&result1.data!=null&&result1.data.GetResult!=null){var errorArray=eval(result1.data.GetResult),msg="";if(errorArray&&errorArray.length>0)for(var k=0;k<errorArray.length;k++)errorArray[k].Type=="Warning"&&(msg+=errorArray[k].Description+"\r\n");msg!=""&&msg.length>0?progressBar.setWarning(msg):progressBar.setValue(100)}}),rowContainer.data.errorLabel!=null&&rowContainer.data.errorLabel.text(0)):progressBar.setValue(parseInt(status[1]))})},getProvisioningProgress=function(progressBar,tid,rowContainer){c3.service.getTaskProgress(tid).query(function(result){var status=result.data.GetTaskProperties.split(",");"FAILED"==status[0].toUpperCase().toUpperCase()||"CANCELLED"==status[0].toUpperCase()||"ROLLBACK"==status[0].toUpperCase()?c3.service.getTasks(tid).expand("TaskParameters").query(function(e){progressBar.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)}):"SUCCESSFUL"==status[0].toUpperCase()?(c3.service.getTaskResult(tid).query(function(result1){if(result1!=null&&result1.data!=null&&result1.data.GetResult!=null){var errorArray=eval(result1.data.GetResult),msg="";if(errorArray&&errorArray.length>0)for(var k=0;k<errorArray.length;k++)errorArray[k].Type=="Warning"&&(msg+=errorArray[k].Description+"\r\n");msg!=""&&msg.length>0?progressBar.setWarning(msg):progressBar.setValue(100)}}),rowContainer.data.errorLabel!=null&&rowContainer.data.errorLabel.text(0)):progressBar.setValue(parseInt(status[1]))})}}function c3customer(){function reload(){self.loadingWin.show(),self.refreshPaging=!0;var e=c3.service.getCustomers().expand("Group,Reseller");e.count().query(self.countHandler),self.splitPage&&(e=e.orderby("ID desc").top(self.pageSize).skip(page*self.pageSize));var t={success:addProcessingRecord,error:function(){self.loadingWin.close()}};e.query(t)}function addProcessingRecord(e){c3.service.getTasks().filter("TaskType eq 'CreateCustomer' and (Status eq 'Processing' or Status eq 'Pending' or Status eq 'WaitingForApproval')").expand("TaskParameters").query(function(t){if(t.data&&t.data.length>0)for(var n=0;n<t.data.length;n++){var r=t.data[n].TaskParameters.results;if(r&&r.length>0){var i=null;t.data[n].Status!="WaitingForApproval"?i={TaskID:t.data[n].ID,ErrorCode:t.data[n].ErrorCode,TaskType:t.data[n].TaskType}:i={ErrorCode:t.data[n].ErrorCode,TaskStatus:"WaitingForApproval",TaskType:t.data[n].TaskType};for(var s=0;s<r.length;s++)i[r[s].Name]=r[s].Value;e.data.push(i)}}else self.gridDelegate.totalCount=0;bindTable(e)})}function createToolbar(){var e=id+"_toolbar",t=$("<section>").attr({id:e}).addClass("tools"),n=$("<input>").attr({value:newTxt,type:"button",id:id+"btnNewCustomer"}),r=$("<input>").attr({value:delTxt,type:"button"}),s=$("<a>").attr({href:"#",id:"btnRefresh_"+id,title:"Refresh"}).addClass("refresh"),o=$("<select>").addClass("pagingComboBox");for(i=0;i<self.pagingOptions.length;i++){var u=getCookie(id+"_PageSize")!="null"?getCookie(id+"_PageSize"):10;o.append(new Option(self.pagingOptions[i],self.pagingOptions[i],!0,getCookie(id+"SplitPage")=="false"?self.pagingOptions[i]==self.pagingOptions[self.pagingOptions.length-1]?!0:!1:self.pagingOptions[i]==u?!0:!1))}var a=$("<label>").append(String.format(localizedString("PAGING_LABEL"))).addClass("pagingLabel");n.click(function(){createCustomer(self)});var f=localizedString("CUSTOMER");self.btnDelete=r,self.btnNew=n,self.cmbboxPaging=o,self.cmbboxPagingLabel=a,disableControl(),r.click(function(){if(selectedItem!=null)if(self.selectPvn&&self.selectPvn.val()=="failed"){var e=selectedItem.TaskID;c3.service.getTasks(e).expand("TaskParameters").query(function(t){var n=$("<div>");n.html(localizedString("POP_MSG_WARNING")+"<br/>");var r=MessageBox.confirm({msg:n,width:350,height:150});r.yesEvent.push(function(){var t={ID:e,Archived:!0};c3.service.archiveTask(t,function(){onSelectPvn()})})})}else{var t=MessageBox.confirm(String.format(localizedString("RES_MISC_DELETE_CONFIRM"),f));t.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),self.reload())},e.error=function(e){},c3.service.deleteCustomer(selectedItem,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),f))}),s.click(function(){onSelectPvn()}),o.change(function(){self.cmbboxPaging.val()==localizedString("PAGING_VALUE_ALL")?self.splitPage=!1:self.splitPage=!0,self.pageSize=self.cmbboxPaging.val(),setCookie(id+"_SplitPage",self.splitPage),setCookie(id+"_PageSize",self.pageSize),self.gridDelegate!=undefined&&(self.gridDelegate.splitPage=self.splitPage,self.gridDelegate.setPageSize(self.pageSize)),onSelectPvn()}),t.append(n),t.append($("<span>").addClass("split")),t.append(r),t.append(a),t.append(o);var l=$("<div>").attr({id:"div_selectPvn"}).css({"float":"right"}),c=$("<select>").attr({id:"selectPvn"}),h=$("<option>").attr({title:localizedString("CUSTOMER_SELECT_ALL")}).val("all").append(localizedString("CUSTOMER_SELECT_ALL"));c.append(h),h=$("<option>").attr({title:localizedString("CUSTOMER_SELECT_FAILED")}).val("failed").append(localizedString("CUSTOMER_SELECT_FAILED")),c.append(h),c.bind("change",onSelectPvn),self.selectPvn=c;var p=$("<label>").html(localizedString("CUSTOMER_SELECT_LABEL")+":&nbsp;").css({"float":"left","padding-top":"3px"}),d=new searchbox({inputCallback:function(e){return self.dataGrid.searchText(e)}}),v=(new Split({permissions:[permissionItems.operator]})).dom;return l.append($("<div>").css({"float":"left"}).append(self.cmbboxPagingLabel.append(self.cmbboxPaging).append($("<span>").addClass("split")))).append(p).append(c.css({"float":"left"})).append(v.css({"float":"left"})).append(d.css({"float":"left"})).append($("<span>").addClass("split")).append(s.css({"float":"right"})),t.append(l),self.toolbar=t,t}function onSelectPvn(){self.loadingWin||(self.loadingWin=new loadingWindow),self.loadingWin.show();var e=self.selectPvn.val();if(e=="failed"){var t={data:[]};c3.service.getTasks().filter("TaskType eq 'CreateCustomer' and Status eq 'Failed' and Archived eq false ").expand("TaskParameters").query(function(e){if(e.data&&e.data.length>0)for(var n=0;n<e.data.length;n++){var r=e.data[n].TaskParameters.results;if(r&&r.length>0){var i={TaskID:e.data[n].ID,ErrorCode:e.data[n].ErrorCode};for(var s=0;s<r.length;s++)i[r[s].Name]=r[s].Value;i.Status="Offline",t.data.push(i)}}bindTable(t)})}else{var n=c3.service.getCustomers();n.count().query(self.countHandler),self.splitPage?n=n.orderby("ID desc").top(self.pageSize).skip(page*self.pageSize).expand("Group,Reseller"):n=n.orderby("ID desc").expand("Group,Reseller"),n.query(addProcessingRecord)}}function createCustomer(e){var t=new c3newCustomer(e);t.show()}function createTable(){var e=$("<section>"),t=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"8%"},{name:"Country",description:localizedString("CUSTOMER_COLUMN_COUNTRY"),type:"text",width:"10%"},{name:"Location",description:localizedString("CUSTOMER_COLUMN_LOCATION"),type:"text",width:"10%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"10%"},{name:"InstallationNumber",description:localizedString("RES_LIC_INSTALLATION_NUM"),type:"text",width:"12%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"13%"},{name:"Reseller_Name",description:localizedString("RESPOOL_RESELLER_TLT"),type:"text",width:"10%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"13%"}];self.data=[],self.colList=t;var n={pagingMode:!0,pageSize:self.pageSize,splitPage:!0,printRecordsCount:!0,setPageSize:function(e){pageSize=e},getPageSize:function(){return self.pageSize},getSplitPage:function(){return self.splitPage},getPrintRecordsCountOption:function(){return this.printRecordsCount},getDetailsID:function(){return $("#"+id+"_detail_tab_body")},autoResize:function(){return 570},getHeaderSpec:function(){return t},getRowCount:function(){return self.data.length},getRow:function(e){return self.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return selectedIndex},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}else if(this.colName=="InstallationNumber")this.data[this.colName]==="-1"&&(e=localizedString("CUSTOMER_CELL_TRIALVERSION"));else if(this.colName=="Type")this.data[this.colName]==="TrialCustomer"&&(e=localizedString("CUSTOMER_CELL_TRIALCUSTOMER"));else if(this.colName=="Result"){var n=this.data,r=n.ID,i=$("<div>"),s=this;if(n.TaskStatus=="WaitingForApproval")return i.append(localizedString(n.TaskStatus.toUpperCase())).attr("title",localizedString(n.TaskType.toUpperCase())+" - "+localizedString(n.TaskStatus.toUpperCase())),i;if(n.TaskID&&n.TaskID>0){if(self.selectPvn&&self.selectPvn.val()=="failed"){var o=$("<a>").attr({href:"#"}).text("Details");return o.click(function(){c3.service.getTasks(n.TaskID).expand("TaskParameters").query(function(e){var t=$("<fieldset>");t.append($("<legend>").css({"padding-left":"10px","line-height":"25px"}).append("<strong>"+localizedString("RESPOOL_CMDB_POPWIN_TLT")+":</strong>&nbsp;&nbsp;&nbsp;&nbsp;").append(e.data.ErrorCode)),t.append($("<span>").css({"padding-left":"10px","line-height":"25px"}).append('<span title="'+e.data.ResultDescription+'">'+e.data.ResultDescription+"</span>"));var n=0,r=200;e.data.ResultDescription.length&&(n=e.data.ResultDescription.length,r=(n/40+1)*30+110);var i=MessageBox.prompt({msg:t,width:350,height:r,title:localizedString("AVAILABLE_STATUS_WARNING")})})}),o}var u=[];u.push(function(e){var t=e.c3progressWithStatus(function(e){return function(){return getProgress(t,e,s)}}(n.TaskID),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0});return t}(i));for(var a=0,f=u.length;a<f;a++)0==a&&u[a].start(),a<f-1&&u[a].finishEvent.push(function(e){return function(t){e.start()}}(u[a+1]))}return i}return e},getTotalCount:function(){return self.totalCount},loadPage:function(e,t){c3.service.getCustomers().expand("Group,Reseller").orderby("ID desc").skip(e).top(t).query({success:function(e){self.data.clear();for(var t=0;t<e.data.length;t++)self.data.push(e.data[t]);self.data=c3.service.convertData(self.data),onRowSelected(selectedIndex),self.dataGrid.refreshContent()},error:function(e){self.loadingWindow.close()}})}};self.gridDelegate=n;var r=$(e).gridview({delegate:n});return r.rowSelectedEvent.push(function(){selectedIndex!=this.index&&onRowSelected(this.index),(self.data[this.index].TaskID===undefined||self.data[this.index].TaskID<=0)&&enableControl()}),self.dataGrid=r,e}function bindTable(e){var t=c3.service.convertData(e.data);self.data=t;for(var n=0,r=t.length;n<r;n++)t.Reseller&&(t[n].Reseller_Name=t.Reseller.Name);self.data.length==0?(self.gridDelegate.getTip=function(){return self.selectPvn&&self.selectPvn.val()=="failed"?Utility.CreateTipBoard(localizedString("CUSTOMER_FAILEDPVN_PART"),null,!0):Utility.CreateTipBoard(localizedString("CUSTOMER"),function(){createCustomer(self)})},disableControl()):selectedIndex==-1?disableControl():enableControl(),self.loadingWin&&self.loadingWin.close(),self.dataGrid.reload(),self.data.length>0&&selectedIndex!=-1?onRowSelected(selectedIndex):(nestedUnits[0].bindData(null),selectedItem=null,selectedIndex=-1),self.loadingWin.close()}function enableControl(){self.btnDelete.attr({disabled:0}).val(localizedString("BUTTON_HU_DELETE")),self.btnNew.attr({disabled:0}),selectedItem&&selectedItem.TaskStatus=="WaitingForApproval"&&self.btnDelete.attr({disabled:1})}function disableControl(){self.btnDelete.attr({disabled:1}),self.selectPvn&&self.selectPvn.val()=="failed"?self.btnNew.attr({disabled:1}):self.btnNew.attr({disabled:0})}function onRowSelected(e){selectedIndex=e,selectedItem=self.data[e];var t=nestedUnits[0].navTab.getCurrentTabIndex();nestedUnits[0].navTab.select(0),nestedUnits[0].navTab.select(t),self.data[e].TaskID&&self.data[e].TaskID>0?(nestedUnits[0].onViewWillAppear(),nestedUnits[0].bindData(null),disableControl(),self.selectPvn&&self.selectPvn.val()=="failed"?(self.btnDelete.attr({disabled:0}),self.btnNew.attr({disabled:1})):(self.btnNew.attr({disabled:0}),self.btnDelete.val("Delete"))):(nestedUnits[0].bindData(self.data[e]),nestedUnits[0].reinitializeUserGrid(),enableControl()),selectedItem&&nestedUnits[0].refreshTitle(selectedItem.Name)}this.base=c3.module,this.base();var id="customer",container=$("<section>").attr({id:id}),title=localizedString("CUSTOMERS"),newTxt=localizedString("MISC_NEW"),delTxt=localizedString("BUTTON_HU_DELETE"),page=0,pageSize=5,self=this,selectedItem=null,selectedIndex=0,nestedUnits=[new c3customer.detail(this)];self.pageSize=10,self.splitPage=!0,self.totalCount=0,self.refreshPaging=!1,self.pagingOptions=["10","30","100","300","1000",localizedString("PAGING_VALUE_ALL")],this._container=container,this._title=title;var getSelectedItem=function(){return selectedItem};this.getSelectedItem=getSelectedItem,this.onInit=function(){container.append($("<div>").attr("class","title_panel").append(title)),container.append(createToolbar()),self.cmbboxPaging!=undefined&&(self.pageSize=self.cmbboxPaging.val()),getCookie(id+"_SplitPage")!=undefined&&(self.splitPage=getCookie(id+"_SplitPage")=="true"),container.append(createTable()),self.dataGrid&&self.dataGrid.show();for(var e=0;e<nestedUnits.length;e++)container.append(nestedUnits[e].getContainer());nestedUnits[0].onViewWillAppear();var t=new loadingWindow;self.loadingWin=t,reload(),c3ModuleManager.Listeners.push(new c3Listener("ListenForRefreshCustomer",reload))},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Customers,function(e){self.reload()})},this.reload=reload,self.countHandler={success:function(e){self.totalCount=parseInt(e.data,10)},error:function(e){}};var getProgress=function(progressBar,tid,rowContainer){c3.service.getTaskProgress(tid).query(function(result){var status=result.data.GetTaskProperties.split(",");"FAILED"==status[0].toUpperCase().toUpperCase()||"CANCELLED"==status[0].toUpperCase()||"ROLLBACK"==status[0].toUpperCase()?c3.service.getTaskResult(tid).query(function(e){e!=null&&e.data!=null&&e.data.GetResult==""?c3.service.getTasks(tid).expand("TaskParameters").query(function(e){progressBar.setFailed(e.data.ResultDescription)}):e.data.GetResult.length>0&&c3.service.getTasks(tid).query(function(e){progressBar.setWarning(e.data.ResultDescription)})}):"SUCCESSFUL"==status[0].toUpperCase()?(onSelectPvn(),c3.service.getTaskResult(tid).query(function(result1){if(result1!=null&&result1.data!=null&&result1.data.GetResult!=null){var errorArray=eval(result1.data.GetResult),msg="";if(errorArray&&errorArray.length>0)for(var k=0;k<errorArray.length;k++)errorArray[k].Type=="Warning"&&(msg+=errorArray[k].Description+"\r\n");msg!=""&&msg.length>0?progressBar.setWarning(msg):progressBar.setValue(100,localizedString("MISC_DONE"))}}),rowContainer.data.errorLabel!=null&&rowContainer.data.errorLabel.text(0)):(status[0]!="Pending"&&status[0]!="Done"?status[0]=localizedString("MISC_TASK_PROCESSING"):status[0]=="Pending"&&(status[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),progressBar.setValue(parseInt(status[1]),status[0]))})}}function c3trialrequest(){function d(){f.loadingWin.show(),f.refreshPaging=!0;var e=c3.service.getTrialRequests().filter("RequestStatus eq 'New' or RequestStatus eq 'Ready' or RequestStatus eq 'Failed' or RequestStatus eq 'InProcess'").expand("Processor");e.count().query(f.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(f.pageSize).skip(u*f.pageSize));var t={success:w,error:function(){f.loadingWin.close()}};e.query(t),c3.service.getTrialRequestStatus(v)}function v(e){var t="trialrequest_filter";f.toolbar.find("#"+t+"_div_selectStatus").remove();var n=$("<div>").attr({id:t+"_div_selectStatus"}),r=$("<label>").append("View: "),i=$("<select>").attr({id:t+"_selectStatus"}),s=$("<option>").attr({id:t+"_optSelectStatus_All",value:"All",title:localizedString("TRIAL_SELECT_ALL")}).append(localizedString("TRIAL_SELECT_ALL"));i.append(s),s=$("<option>").attr({id:t+"_optSelectStatus_New",value:"New",title:localizedString("MISC_NEW")}).append(localizedString("MISC_NEW")),i.append(s),s=$("<option>").attr({id:t+"_optSelectStatus_InProcess",value:"InProcess",title:localizedString("TRIAL_SELECT_INPROCESS")}).append(localizedString("TRIAL_SELECT_INPROCESS")),i.append(s),s=$("<option>").attr({id:t+"_optSelectStatus_TrialReady",value:"Ready",title:localizedString("TRIAL_SELECT_TRIALREADY")}).append(localizedString("TRIAL_SELECT_TRIALREADY")),i.append(s),s=$("<option>").attr({id:t+"_optSelectStatus_Failed",value:"Failed",title:localizedString("TRIAL_SELECT_FAILED")}).append(localizedString("TRIAL_SELECT_FAILED")),i.append(s),s=$("<optgroup>").attr({label:" ==================="}),i.append(s),s=$("<option>").attr({id:t+"_optSelectStatus_ReleaseForCustomer",value:"Released",title:localizedString("TRIAL_SELECT_RESTOCUSTOMER")}).append(localizedString("TRIAL_SELECT_RESTOCUSTOMER")),i.append(s),s=$("<option>").attr({id:t+"_optSelectStatus_Rejected",value:"Rejected",title:localizedString("TRIAL_SELECT_REJECTED")}).append(localizedString("TRIAL_SELECT_REJECTED")),i.append(s),f.selectStatus=i,i.bind("change",function(){m($(this).val())}),n.append(r),n.append(i),n.css({"float":"right"}),f.toolbar.append(n)}function m(e){f.loadingWin.show(),e=="All"?c3.service.getTrialRequests().filter("RequestStatus eq 'New' or RequestStatus eq 'Ready' or RequestStatus eq 'Failed' or RequestStatus eq 'InProcess'").expand("Processor").orderby("ID desc").top(f.pageSize).skip(u*f.pageSize).query(w):c3.service.getTrialRequests().expand("Processor").filter("RequestStatus eq '"+e+"'").orderby("ID desc").top(f.pageSize).skip(u*f.pageSize).query(w)}function g(){var t=e+"_toolbar",n=$("<section>").attr({id:t}).addClass("tools"),s=$("<input>").attr({value:r,type:"button",id:e+"btnApprove"}),o=$("<input>").attr({value:i,type:"button",id:e+"btnReject"}),u=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh");s.click(function(){if(l)if(s.val()==="Abort"){var e={success:function(e){if(e.data&&e.data.RequestStatus!=="InProcess"){var t=MessageBox.confirm(localizedString("REQUEST_REFRESH_TIP"));t.yesEvent.push(function(){m(f.selectStatus.val())})}else{var t=MessageBox.confirm(localizedString("REQUEST_ABORT_CONFIRM"));t.yesEvent.push(function(){c3.service.abortInProcessTrialRequest(l.ID,function(){m(f.selectStatus.val())})})}},error:function(e){}};c3.service.getTrialRequests(l.ID).query(e)}else{var e={success:function(e){if(e.data&&e.data.RequestStatus!=="New"&&e.data.RequestStatus!=="Failed"){var t=MessageBox.confirm(localizedString("REQUEST_REFRESH_TIP"));t.yesEvent.push(function(){m(f.selectStatus.val())})}else{var n=function(){c3.service.getTasks().filter("TaskType eq 'CreateCustomer' and (Status eq 'Processing' or Status eq 'Pending')").expand("TaskParameters").query(function(e){if(e.data&&e.data.length>0){var t=!1;for(var n=0;n<e.data.length;n++){var r=e.data[n].TaskParameters.results;if(r&&r.length>0)for(var i=0;i<r.length;i++)if(r[i].Name==="TrialRequest_ID"&&r[i].Value===l.ID.toString()){t=!0;break}if(t)break}if(!t){var o="New";s.val()==="Retry"&&(o="Failed");var u={ID:l.ID,RequestStatus:o};c3.service.updateTrialRequest(u,function(){m(f.selectStatus.val())})}else m(f.selectStatus.val())}else{var o="New";s.val()==="Retry"&&(o="Failed");var u={ID:l.ID,RequestStatus:o};c3.service.updateTrialRequest(u,function(){m(f.selectStatus.val())})}})},r={ID:l.ID,RequestStatus:"InProcess"};c3.service.updateTrialRequest(r,function(){var e=new c3newCustomer(f,l,n);e.show()})}},error:function(e){}};c3.service.getTrialRequests(l.ID).query(e)}}),o.click(function(){if(l){var e={success:function(e){if(e.data&&e.data.RequestStatus==="Rejected"||e.data.RequestStatus==="Released"){var t=MessageBox.confirm(localizedString("REQUEST_REFRESH_TIP"));t.yesEvent.push(function(){m(f.selectStatus.val())})}else{var n=MessageBox.prompt({msg:localizedString("TRIAL_CONFIRMWIN_TLT"),multiline:!0,required:!0});n.okEvent.push(function(){var e=n.inputControl.val();if(e&&e!=""){var t={ID:l.ID,RequestStatus:"Rejected",Comments:e};c3.service.updateTrialRequest(t,function(){m(f.selectStatus.val())})}})}},error:function(e){}};c3.service.getTrialRequests(l.ID).query(e)}});var a=localizedString("CUSTOMER");f.btnReject=o,f.btnApprove=s,S(),o.click(function(){}),u.click(function(){m(f.selectStatus.val())}),n.append(s),n.append(o);var c=new searchbox({inputCallback:function(e){return f.dataGrid.searchText(e)}}),h=(new Split({permissions:[permissionItems.operator]})).dom;return n.append($("<div>").css({"float":"right"}).append(h.css({"float":"left"})).append(c.css({"float":"left"})).append(u)),f.toolbar=n,n}function y(){var e=$("<section>"),t=[{name:"RequestStatus",description:localizedString("MISC_STATUS"),type:"text",width:"6%"},{name:"RequestDate",description:localizedString("TRIAL_COLUMN_REQUESTDATE"),type:"text",width:"10%"},{name:"Name",description:localizedString("CUSTOMER"),type:"text",width:"8%"},{name:"Country",description:localizedString("CUSTOMER_COLUMN_COUNTRY"),type:"text",width:"8%"},{name:"State",description:localizedString("TRIAL_COLUMN_STATE"),type:"text",width:"8%"},{name:"Location",description:localizedString("TRIAL_COLUMN_LOCATION"),type:"text",width:"8%"},{name:"PostalCode",description:localizedString("TRIAL_COLUMN_POSTALCODE"),type:"text",width:"8%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"10%"},{name:"Industry",description:localizedString("TRIAL_COLUMN_INDUSTRY"),type:"text",width:"8%"},{name:"Reason",description:localizedString("TRIAL_COLUMN_REASON"),type:"text",width:"13%"},{name:"Comments",description:localizedString("TRIAL_COLUMN_COMMENTS"),type:"text",width:"13%"}];f.data=[],f.colList=t;var n={pagingMode:!0,pageSize:f.pageSize,autoResize:function(){return 580},getHeaderSpec:function(){return t},getRowCount:function(){return f.data.length},getRow:function(e){return f.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return c},getCell:function(){var e=null;if(this.colName=="RequestDate")return convertToDate(this.data[this.colName]).dateString();if(this.colName=="RequestStatus"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e},getTip:function(){return Utility.CreateTipBoard(localizedString("TRIAL_EMPTY_TIP"),null,!0)},getTotalCount:function(){return f.totalCount},loadPage:function(e,t){c3.service.getTrialRequests().filter("RequestStatus eq 'New' or RequestStatus eq 'Ready' or RequestStatus eq 'Failed' or RequestStatus eq 'InProcess'").expand("Processor").orderby("ID desc").skip(e).top(t).query({success:function(e){f.data.clear();for(var t=0;t<e.data.length;t++)f.data.push(e.data[t]);f.data=c3.service.convertData(f.data),x(c),f.dataGrid.refreshContent()},error:function(e){f.loadingWindow.close()}})}};f.gridDelegate=n;var r=$(e).gridview({delegate:n});return r.rowSelectedEvent.push(function(){c!=this.index&&x(this.index),E()}),f.dataGrid=r,e}function b(e){var t=new c3newCustomer(selfHandle,l);t.show()}function w(e){var t=c3.service.convertData(e.data);f.data=t,f.data.length==0?S():c==-1?S():E(),f.data.length>0?(c<0?c=0:c>=f.data.length&&(c=0),x(c)):(l=null,c=-1,h[0].bindData({})),f.dataGrid.reload(),f.loadingWin.close()}function E(){var e=f.getSelectedItem();e&&(e.RequestStatus==="New"?(f.btnApprove.attr({value:localizedString("TRIAL_BTN_APPROVE"),disabled:!1}),f.btnReject.attr({disabled:!1})):e.RequestStatus==="Failed"?(f.btnReject.attr({disabled:!1}),f.btnApprove.attr({value:localizedString("TRIAL_BTN_RETRY"),disabled:!1})):e.RequestStatus==="Ready"?(f.btnReject.attr({disabled:!1}),f.btnApprove.attr({value:localizedString("TRIAL_BTN_APPROVE"),disabled:!0})):e.RequestStatus==="Rejected"?(f.btnReject.attr({disabled:!0}),f.btnApprove.attr({value:localizedString("TRIAL_BTN_APPROVE"),disabled:!0})):e.RequestStatus==="Released"?(f.btnReject.attr({disabled:!0}),f.btnApprove.attr({value:localizedString("TRIAL_BTN_APPROVE"),disabled:!0})):e.RequestStatus==="InProcess"&&(f.btnReject.attr({disabled:!0}),f.btnApprove.attr({value:localizedString("TRIAL_BTN_ABORT"),disabled:!1})))}function S(){f.btnApprove.attr({disabled:!0}),f.btnReject.attr({disabled:!0})}function x(e){c=e,l=f.data[e],E(),h[0].onViewWillAppear(),h[0].bindData(f.data[e]),l&&h[0].refreshTitle(l.Name)}this.base=c3.module,this.base();var e="trialrequest",t=$("<section>").attr({id:e}),n=localizedString("TRIALREQUESTS"),r=localizedString("TRIAL_BTN_APPROVE"),i=localizedString("TRIAL_BTN_REJECT"),s=localizedString("TRIAL_BTN_RESUME"),o=localizedString("TRIAL_BTN_RELEASE"),u=0,a=5,f=this,l=null,c=0,h=[new c3trialrequest.detail(this)];f.pageSize=10,f.totalCount=0,f.refreshPaging=!1,this._container=t,this._title=n;var p=function(){return l};this.getSelectedItem=p,this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(n)),t.append(g()),t.append(y()),f.dataGrid&&f.dataGrid.show();for(var e=0;e<h.length;e++)t.append(h[e].getContainer());h[0].onViewWillAppear();var r=new loadingWindow;f.loadingWin=r,d()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.TrialRequests,function(e){f.reload()})},f.countHandler={success:function(e){f.totalCount=parseInt(e.data,10)},error:function(e){}},this.reload=d,this.onSelectStatusChanged=m}function AccessManager(){function s(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("tab_header");for(var n=0;n<i.length;n++){var r=$("<a>").attr({href:"#"}).append(i[n].getTitle());t.append($("<li>").attr({id:e+n.toString()}).append(r))}return t}function o(){body=$("<section>").attr({id:e+"_tab_body"}).addClass("tab_body");for(var t=0;t<i.length;t++)body.append(i[t].getContainer());return body}function u(e,t){t>=0&&i[t].onViewWillDisappear(),i[e].onViewWillAppear()}this.base=c3.module,this.base();var e="accessManager",t=$("<section>").attr({id:e}),n="Access Management",r=this,i=[new c3auditLog];this._container=t,this._title=n,this.onInit=function(){t.append(s()).css({"margin-top":"20px"}),t.append(o());var n=$("#"+e+">.tab_header a").c3tab("#"+e+">.tab_body>section",{});n.onSelectEvent.push(u),n.select(0),n.setTransitionType(1)}}function c3auditLog(){"use strict";function s(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");return t.append(p()),t}function o(){function t(e){var t=m.getUTCFullYear(),n=m.getUTCMonth()+1;n<10&&(n="0"+n);var r=m.getUTCDate();r<10&&(r="0"+r);var i=m.getUTCHours();i<10&&(i="0"+i);var s=m.getUTCMinutes();s<10&&(s="0"+s);var o=m.getUTCSeconds();return o<10&&(o="0"+o),t+"-"+n+"-"+r+"T"+i+":"+s+":"+o+"Z"}var n="",r=$("#start").val(),i=$("#start_hour").val(),s=$("#start_minute").val(),o=$("#start_second").val(),u=$("#end_hour").val(),a=$("#end_minute").val(),f=$("#end_second").val(),l=$("#end").val(),c=$("#"+e+"resource").val(),h=$("#resourceID").val(),p=$("#username").val(),d=$("#request").val();if(r!==undefined&&r.length>0){var v;i.length!=0?v=i:v="00",s.length!=0?v=v+":"+s:v=v+":"+"00",o.length!=0?v=v+":"+o:v=v+":"+"00";var m=new Date(r+" "+v);n.length>0?n=n+" and (TimeStamp ge '"+t(m)+"')":n="TimeStamp ge '"+t(m)+"'"}if(l!==undefined&&l.length>0){var v;u.length!=0?v=u:v="00",a.length!=0?v=v+":"+a:v=v+":"+"00",f.length!=0?v=v+":"+f:v=v+":"+"00";var m=new Date(l+" "+v);n.length>0?n=n+" and (TimeStamp le '"+t(m)+"')":n="TimeStamp le '"+t(m)+"'"}return c!==undefined&&c!==null&&c.length>0&&(n.length>0?n=n+" and (ResourceType eq '"+c+"')":n="ResourceType eq '"+c+"'"),h!==undefined&&h.length>0&&(n.length>0?n=n+" and (ResourceID eq '"+h+"')":n="ResourceID eq '"+h+"'"),p!==undefined&&p.length>0&&(n.length>0?n=n+" and (Username eq '"+p+"')":n="Username eq '"+p+"'"),d!==undefined&&d.length>0&&(n.length>0?n=n+" and (ServiceRequest eq '"+d+"')":n="ServiceRequest eq '"+d+"'"),n}function u(){var t=e+"_region",n=$("<section>").attr({id:t}).addClass("dataform"),r=$("<section>").addClass("region");n.append(r);var i=$("<div>").addClass("group").css("min-width","1113px");r.append(i);var s=c();i.append(s);var o=l("request","Request");i.append(o);var u=h("start",localization.AUDIT_LOG_CONDITION_START);i.append(u);var f=l("username",localization.AUDIT_LOG_CONDITION_USERNAME);i.append(f);var p=h("end",localization.AUDIT_LOG_CONDITION_END);i.append(p);var v=$("<section>").attr({id:"region_toolbar"}).addClass("region_tools"),m=$("<input>").attr({value:localization.AUDIT_LOG_CONDITION_BUTTON_SEARCH,type:"button",id:"btnSearch"}).css({"margin-left":"40px"});return m.click(a),v.append(m),r.append(v),n.append(d()),n}function a(){i.refreshPaging=!0;if(!i.validate())return;i.condition=o();var e=c3.service.getAuditLog();i.condition!==undefined&&i.condition.length>0?(e.filter(i.condition).count().query(i.countHandler),e.filter(i.condition).orderby("TimeStamp desc").top(i.pageSize).query(i.responseHandler),i.loadingWindow.show()):(e.count().query(i.countHandler),e.orderby("TimeStamp desc").top(i.pageSize).query(i.responseHandler),i.loadingWindow.show())}function f(e){for(var t=0;t<i.IDMap.length;t++){var n=i.IDMap[t];if(n.requestID==e)return n.number}return i.IDMap.push({number:i.IDMap.length+1+"",requestID:e}),i.IDMap[i.IDMap.length-1].number.length<2&&(i.IDMap[i.IDMap.length-1].number=" "+i.IDMap[i.IDMap.length-1].number),i.IDMap[i.IDMap.length-1].number}function l(e,t){var n=$("<div>").addClass("chrome2"),i=$("<label>").attr({title:t}).append(t+": ");n.append(i);var s=$("<input>").attr({id:e}).width(r);return n.append(s),n}function c(){var t=$("<div>").addClass("chrome2"),n=$("<label>").attr({title:"Resource"}).append(localization.AUDIT_LOG_CONDITION_RESOURCE+": ");t.append(n),i.resourceControl=new dropdownlist,i.resourceControl.attr({id:e+"resource"}),i.resourceControl.css({width:r+10,"float":"left",padding:"1px"}),i.resourceControl.placeAt(t),i.idBox=new textbox,i.idBox.css({width:85,"margin-left":10}),i.resourceControl.bind("change",function(){var e=$(this).val();e!==undefined&&e.length>0?i.idBox.attr({disabled:!1}):(i.idBox.val(""),i.idBox.attr({disabled:!0}))}),i.idBox.attr({id:"resourceID",placeholder:localization.AUDIT_LOG_PLACEHOLDER_RESOURCE_ID,disabled:!0}),i.idBox.placeAt(t);var s=c3.service.getResourceName();return s.filter("Type eq 'Entity'").query({success:function(e){if(e.data!==undefined){e.data.sort(function(e,t){return e.Name>t.Name?1:e.Name==t.Name?0:-1}),i.resourceControl.append($("<option>").attr({value:""}).text(""));for(var t=0;t<e.data.length;t++)i.resourceControl.append($("<option>").attr({value:e.data[t].Name}).text(e.data[t].Name))}},error:function(e){}}),t}function h(e,t){var n=$("<div>").addClass("chrome2"),s=$("<label>").attr({title:t}).append(t+": ");n.append(s);var o=new textbox;return o.css({width:r}),o.attr({id:e,placeholder:localization.AUDIT_LOG_PLACEHOLDER}),o.placeAt(n),e=="start"?i.startBox=o:i.endBox=o,i.dateBox[e]=new c3auditLog.timeBox(n,e),o.bind("blur",function(t){$(this).val()===""&&i.dateBox[e].disable()}),o.datepicker({aotuSize:!0,showTime:!0,stepMinutes:1,stepHours:1,onSelect:function(t){e=="start"?$("#end").datepicker("option","minDate",t):e=="end"&&$("#start").datepicker("option","maxDate",t),i.dateBox[e].enable()}}),n}function p(){var t=e+"_condition",n=$("<section>").attr({id:t}),r=u();return n.append(r),n}function d(){var e=$("<section>"),t=[{name:"RequestID",description:localization.AUDIT_LOG_GRID_COLUMN_SEQUENCE,type:"text",width:"15%"},{name:"Request",description:localization.AUDIT_LOG_GRID_COLUMN_REQUEST,type:"text",width:"35%"},{name:"Instance",description:localization.AUDIT_LOG_GRID_COLUMN_RESOURCE,type:"text",width:"30%"},{name:"Username",description:localization.AUDIT_LOG_GRID_COLUMN_USERNAME,type:"text",width:"15%"},{name:"TimeStamp",description:localization.AUDIT_LOG_GRID_COLUMN_TIME,type:"text",width:"15%"}];i.data=[],i.colList=t;var n={pagingMode:!0,alterColor:"RequestID",pageSize:i.pageSize,getHeaderSpec:function(){return t},getRowCount:function(){return i.data.length},getRow:function(e){return i.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.5},getTotalCount:function(){return i.totalCount},loadPage:function(e,t){i.condition!==undefined&&i.condition.length>0?c3.service.getAuditLog().filter(i.condition).orderby("TimeStamp desc").skip(e).top(t).query(i.responseHandler):c3.service.getAuditLog().orderby("TimeStamp desc").skip(e).top(t).query(i.responseHandler)}};i.gridDelegate=n;var r=$(e).gridview({delegate:n});return r.rowSelectedEvent.push(function(){var e=i.data[this.index],t=c3.service.getAuditLog();t.filter("ID eq "+e.ID).expand("ChangeLogDetails").query({success:function(e){i.details.data.clear();if(e&&e.data&&e.data[0]&&e.data[0].ChangeLogDetails){var t=e.data[0].ChangeLogDetails.results;for(var n=0;n<t.length;n++)i.details.data.push({Property:t[n].PropertyName,OldValue:t[n].PropertyOldValue,NewValue:t[n].PropertyNewValue});i.details.data.sort(function(e,t){return e.Property>t.Property?1:e.Property==t.Property?0:-1})}i.details.dataGrid.reload()},error:function(){}})}),i.dataGrid=r,e}this.base=c3.module,this.base();var e="auditlog",t=$("<section>").attr({id:e}),n=localizedString("AUDIT_LOGS"),r=240,i=this;i._container=t,i._title=n,i.loadingWindow=new loadingWindow,i.totalCount=0,i.refreshPaging=!1,i.pageSize=50,i.IDMap=[],i.dateBox=[],this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(n)),t.append(s()),i.dataGrid&&i.dataGrid.show(),i.details=new c3auditLog.details(this),t.append(i.details.getContainer()),i.details.onViewWillAppear(),a()},i.countHandler={success:function(e){i.totalCount=parseInt(e.data,10)},error:function(e){}},i.responseHandler={success:function(e){function n(e){if(e!==undefined&&e!==null&&e.search("Resource$")>-1)return e.substr(0,e.length-8)}i.data.clear(),i.IDMap.clear();var t=i.details.data.length;i.details.data.clear();if(e.data!==undefined){for(var r=0;r<e.data.length;r++){var s=e.data[r],o=n(s.ServiceRequestType);i.data.push({ID:s.ID,TimeStamp:s.TimeStamp==null?"":convertToDate(s.TimeStamp).timeString(),Username:s.Username,Operation:s.Operation,Instance:s.ResourceType+"("+s.ResourceID+")"+"/<"+n(s.Operation)+">",Request:o!==undefined?s.ServiceRequest+"/<"+o+">":s.ServiceRequest,RequestID:f(s.ServiceRequestID)})}i.refreshPaging?(i.dataGrid.reload(),i.refreshPaging=!1):i.dataGrid.refreshContent(),t>0&&i.details.dataGrid.reload(),i.loadingWindow.close()}},error:function(e){i.loadingWindow.close()}},i.validate=function(){var e=!0,t=$("#resourceID").val();if(t&&t.length>0){var n=new RegExp("^[1-9]\\d*$");n.test(t)||(e=!1,i.idBox.showErrorMessage(localization.AUDIT_LOG_ERROR_RESOURCE_ID))}var r=$("#start").val();if(r!==undefined&&r.length>0){var s=new RegExp("^\\d{1,2}/\\d{1,2}/\\d{4}$");s.test(r)||(e=!1,i.startBox.showErrorMessage(localization.AUDIT_LOG_ERROR_DATE_FORMAT))}var o=$("#end").val();if(o!==undefined&&o.length>0){var s=new RegExp("^\\d{1,2}/\\d{1,2}/\\d{4}$");s.test(o)||(e=!1,i.endBox.showErrorMessage(localization.AUDIT_LOG_ERROR_DATE_FORMAT))}return e}}function c3usrmgr(){function c(){operatorManager.getOperators(a.countHandler)}function h(e){a.data=e,a.data.length==0&&(a.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("USER"),function(){p(a)})}),a.dataGrid.reload()}function p(e,t,n){var r=new c3addSystemUser(e,t,n,!0,null);r.show()}function d(){var t=e+"_toolbar",n=$("<section>").attr({id:t}).addClass("tools"),o=$("<input>").attr({value:r,type:"button",id:e+"btnNew"}),u=$("<input>").attr({value:i,type:"button",id:e+"btnEdit"}),f=$("<input>").attr({value:s,type:"button",id:e+"btnDelete"}),c=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),h=$("<a>").attr({href:"#",id:"btnConfig_clientSession_timeout",title:localizedString("CONFIG_CLIENTSESSION_TIMEOUT")}).addClass("path").css("float","left");h.click(function(){c3.service.getSystemInformations().filter("Name eq 'ClientSession_Timeout'").query(function(e){var t="";e.data&&e.data.length>0&&(t=e.data[0].Value);var n=$("<span>").text(localizedString("CONFIG_CLIENTSESSION_TIMEOUT_LABEL")).css({padding:"3px 15px 3px 0"}),r=(new textbox({pattern:"\\d*",isRequired:!0})).attr({maxlength:4}).css({width:"40px"}).val(t),i=$("<span>").text(localizedString("MIN")).css("padding-left","5px"),s=$("<div>").append(n).append(r).append(i).css({height:"50px"}),o=MessageBox.show({msg:s,title:localizedString("CONFIG_CLIENTSESSION_TIMEOUT"),width:350,height:130});o.checkValidity=function(){return r[0].checkValidity()},o.yesEvent.push(function(){var t={ID:e.data[0].ID,Value:r.val()};c3.service.updateSystemInformation(t,{success:function(e){alert(localizedString("CG_SESSIONTIMEOUT_SUCCMSG"))},error:function(e){alert(localizedString("CG_SESSIONTIMEOUT_FAILEDMSG"))}})})})});var d=localizedString("USER");o.click(function(){p(a,0)}),u.click(function(){l!=null?p(a,1,l):alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),d))}),a.btnEdit=u,a.btnDelete=f,y(),f.click(function(){if(l!=null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_DELETE_CONFIRM"),d));e.yesEvent.push(function(){a.loadingWin.show();var e={};e.success=function(e){a.reload(),a.loadingWin.close()},e.error=function(e){a.loadingWin.close()};var t={ID:l.id};c3.service.deleteUser(t,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),d))}),c.click(function(){a.reload()}),n.append(o),n.append($("<span>").addClass("split")),n.append(u),n.append(f);var v=new searchbox({inputCallback:function(e){return a.dataGrid.searchText(e)}}),m=(new Split({permissions:[permissionItems.operator]})).dom;return n.append($("<div>").css({"float":"right"}).append(v.css({"float":"left"})).append(c)),n.append($("<div>").css({"float":"right"}).append(h).append(m.css({"float":"left"}))),a.toolbar=n,n}function v(){var t=$("<section>").attr({id:e+"_userTable"}),n=[{name:"status",description:localizedString("MISC_STATUS"),type:"text",width:"5%"},{name:"id",description:localizedString("SU_EXT_COLUMN_ID"),type:"text",width:"10%"},{name:"domainUserName",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"40%"},{name:"roleName",description:localizedString("COLUMN_USERTYPE"),type:"text",width:"45%"}];a.data=[];var r={pagingMode:!0,pageSize:a.pageSize,getHeaderSpec:function(){return n},getRowCount:function(){return a.data.length},getRow:function(e){return a.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getCell:function(){var e=null;if(this.colName=="status"){var t={};t.text=this.data[this.colName],this.colName=="LifeCycleStatus"?t.showText=!0:t.textalign="center",e=new statusControl(t)}return e},getTotalCount:function(){return a.totalCount},loadPage:function(e,t){a.data.clear();for(var n=e;n<e+a.pageSize;n++)a.result[n]!==undefined&&a.result[n]!==null&&a.data.push(a.result[n]);a.refreshPaging=!1,a.data&&(a.refreshPaging?(a.dataGrid.reload(),a.refreshPaging=!1):a.dataGrid.refreshContent())}};a.gridDelegate=r;var i=$(t).gridview({delegate:r});return i.show(),i.rowSelectedEvent.push(function(){m(this.index)}),a.dataGrid=i,t}function m(e){f=e,l=a.data[e],g()}function g(){a.btnDelete.attr({disabled:0}),a.btnEdit.attr({disabled:0})}function y(){a.btnDelete.attr({disabled:1}),a.btnEdit.attr({disabled:1})}this.base=c3.module,this.base();var e="usrMgr",t=$("<section>").attr({id:e}),n=localizedString("RESPOOL_TAB_LABEL_OPERATORS"),r=localizedString("MISC_NEW"),i=localizedString("MISC_EDIT"),s=localizedString("BUTTON_HU_DELETE"),o=0,u=5,a=this,f=0,l=null;a.pageSize=10,a.totalCount=0,a.refreshPaging=!1,this._container=t,this._title=n,this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(n)),t.append(d()),t.append(v());var e={},r=new loadingWindow;a.loadingWin=r,c()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Users,function(e){a.reload()})},this.reload=c,this.getSelectedItem=function(){return l},a.countHandler=function(e){a.refreshPaging=!0,a.totalCount=parseInt(e.length,10),a.refreshPaging?(a.dataGrid.reload(),a.refreshPaging=!1):a.dataGrid.refreshContent(),a.result=e;var t=[];for(var n=0;n<a.pageSize;n++)e[n]!==null&&e[n]!==undefined&&t.push(a.result[n]);h(t)}}function c3rsp(){this.base=c3.module,this.base();var e="rsp",t="RSP",n=$("<section>").attr({id:e});this._container=n,this._title=t}function supportabilitymgr(){function i(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("tab_body");for(var n=0;n<window.supportability.length;n++)t.append(window.supportability[n].getContainer());return t}this.base=c3.module,this.base();var e="supportability",t=$("<section>").attr({id:e}),n=localizedString("SUPPORTABILITY"),r=new c3apptoken;window.supportability=[new dbuploadframe],this._container=t,this._title=n,this.onInit=function(){t.append(i())}}function c3page(){function v(){b(function(){var e=new c3overview,n=new applicationManagement;e.onViewWillAppear(),n.onViewWillAppear(),i.push(e),i.push(n);var r=new c3respool;r.onViewWillAppear(),i.push(r);var s=new accessmgr;s.onViewWillAppear(),i.push(s);var o=new supportabilitymgr;o.onViewWillAppear(),i.push(o);var u=new c3about;u.onViewWillAppear(),i.push(u),t.append(w()),t.append(x()),t.append(S()),$("body").html(""),$("body").append(t),C(),$(window).resize(C),h&&h.click&&h.click()})}function m(e,t){window.appmgr&&window.appmgr.length>0&&(t>=0&&window.appmgr[t].onViewWillDisappear(),window.appmgr[e].onViewWillAppear())}function g(){}function y(){}function b(e){c3.service.getCurrentOperator().query(function(t){t.data[0]&&c3.service.getOSUserBindings(undefined).filter("User/ID eq "+t.data[0].ID).query(function(n){n.data[0].SystemUser?o.append(localizedString("WELCOME")+" "+n.data[0].SystemUser.toUpperCase()):o.append("error!");var r={success:function(t){if(t.data!==undefined){var n=t.data.filter(function(e){return e.ID===1||e.ID===5});n.length>0&&(c3.userRole.roleId=t.data[0].ID,c3.userRole.roleName=t.data[0].Name,e.apply(this,null))}},error:function(e){}};c3.userRole={roleId:0,roleName:""},c3.service.getCurrentOperatorRole(t.data[0].ID).query(r)})})}function w(){var t=$("<hgroup>");s.version=$("<span>").attr("id","version_system");var n=$("<h1>").append(e).append(s.version),r=$("<div>").addClass("hTools"),i=$("<a id='logout' href='#'>").addClass("logout_btn").attr({title:localizedString("LOGOUT")});c3.service.getSystemInformations().filter("Name eq 'Version'").query(function(e){e.data&&e.data.length>0&&s.version.text("Version: "+e.data[0].Value)}),i.click(function(){window.location.href="/sld/saml2/idp/slo"}),n.append(o),n.append(i),t.append(n);var u=$("<header>").append(t);return u}function E(){var e=$("<aside>");return e.append($("<input>").attr({id:"head_aside_txt_search"})),e.append($("<input>").attr({id:"head_aside_btn_search",type:"button"})),e}function S(){var e=$("<footer>");return ui.log&&ui.log.setContainer&&ui.log.setContainer(e),e}function x(){function t(){d?(d=!1,u.hide(400),setTimeout(function(){leftPanelTrigger.css({left:"3px"})},400)):(d=!0,u.show(400),setTimeout(function(){leftPanelTrigger.css({left:"3px"})},400))}function m(){var e=o.attr("Expand");if(e=="true"){o.attr("Expand","false"),o.removeClass("shrink_icon"),o.addClass("expand_icon");for(var t=0;t<a.length;t++)a[t].hide(200)}else{o.attr("Expand","true"),o.removeClass("expand_icon"),o.addClass("shrink_icon");for(var t=0;t<a.length;t++)a[t].show(200)}}r=$("<section>").attr({id:"bd"});var e=$("<section>").attr({id:"main"});u=$("<section>").attr({id:"left","class":"leftPanel"}),leftPanelTrigger=$("<div>").attr({id:"leftPanelTrigger","class":"leftPanelTrigger"}).bind("click",function(){t()}),r.append(u).append(e).append(leftPanelTrigger);var n=$("<ul>").attr({id:"overview_ul"});h=$("<li>").append($("<a>").attr({href:"#"}).css("font-weight","bold").append(localizedString("OVERVIEW"))),n.append(h),u.append(n);var s=$("<ul>").attr({id:"appmgr_tab_header"}),o=$("<div>").addClass("shrink_icon").attr({Expand:"true"}),v=$("<li>").css({"padding-left":"5px"}).bind("click",function(){m()}).append(o).append($("<a>").attr({href:"#"}).css("font-weight","bold").append(localizedString("APPMGR")));s.append(v);if(window.appmgr&&window.appmgr.length>0){for(var g=0;g<window.appmgr.length;g++){var y=$("<div>");switch(g){case 0:y.addClass("customer_icon");break;case 1:y.addClass("tenant_icon");break;case 2:c3.hasPermission([permissionItems.operator])?y.addClass("request_icon"):y.addClass("license_icon");break;case 3:y.addClass("license_icon");break;case 4:y.addClass("varrequest_icon");break;default:y.removeClass()}var b=$("<a>").attr({href:"#"}).append(window.appmgr[g].getTitle()),w=$("<li>").attr({id:"appmgr"+g}).css({"padding-left":"20px",display:"none"}).append(y).append(b);w.click(function(){var e=$(this).attr("id"),t=e.substring(0,e.length-1),n=e.substring(e.length-1,e.length);N(t,n),T(),$(this).css({"background-color":"#aaa","border-color":"white"}).children().css({color:"White"})}),s.append(w),a.push(w)}for(var g=0;g<a.length;g++)a[g].show()}u.append(s);if(window.inframgr&&window.inframgr.length>0){var E=$("<ul>").attr({id:"respool_tab_header"}),S=$("<div>").addClass("shrink_icon").attr({Expand:"true"}),x=$("<li>").css({"padding-left":"5px"}).bind("click",function(){C()}).append(S).append($("<a>").attr({href:"#"}).css("font-weight","bold").append(localizedString("RESOURCEPOOL")));E.append(x);function C(){var e=S.attr("Expand");if(e=="true"){S.attr("Expand","false"),S.removeClass("shrink_icon"),S.addClass("expand_icon");for(var t=0;t<f.length;t++)f[t].hide(200)}else{S.attr("Expand","true"),S.removeClass("expand_icon"),S.addClass("shrink_icon");for(var t=0;t<f.length;t++)f[t].show(200)}}for(var g=0;g<window.inframgr.length;g++){var y=$("<div>");switch(g){case 0:y.addClass("SU_icon");break;case 1:y.addClass("licenseServer_icon");break;case 2:y.addClass("DBInstance_icon");break;case 3:y.addClass("commonDB_icon");break;case 4:y.addClass("storage_icon");break;case 5:y.addClass("presentationServer_icon");break;case 6:y.addClass("b1i_icon");break;case 7:y.addClass("mailer_icon");break;case 8:y.addClass("mailingService_icon");break;case 9:y.addClass("extension_icon");break;case 10:y.addClass("SLDAgent_icon");break;case 11:y.addClass("B1AH_icon");break;case 12:y.addClass("B1AH_icon");break;case 13:y.addClass("B1AH_icon");break;case 14:y.addClass("B1AH_icon");break;default:y.removeClass()}var k="respool",b=$("<a>").attr({href:"#"}).append(window.inframgr[g].getTitle()),w=$("<li>").attr({id:k+g}).css({"padding-left":"20px",display:"none"}).append(y).append(b);w.click(function(){var e=$(this).attr("id"),t=e.substring(0,k.length),n=e.substring(k.length,e.length);N(t,n),T(),$(this).css({"background-color":"#aaa","border-color":"white"}).children().css({color:"White"})}),E.append(w),f.push(w)}for(var g=0;g<f.length;g++)f[g].show();u.append(E)}if(window.accmgr&&window.accmgr.length>0){var L=$("<ul>").attr({id:"accessmgr_tab_header"}),A=$("<div>").addClass("shrink_icon").attr({Expand:"true"}),O=$("<li>").css({"padding-left":"5px"}).bind("click",function(){M()}).append(A).append($("<a>").attr({href:"#"}).css("font-weight","bold").append(localizedString("ACCEESS_MGR_TITLE")));L.append(O);function M(){var e=A.attr("Expand");if(e=="true"){A.attr("Expand","false"),A.removeClass("shrink_icon"),A.addClass("expand_icon");for(var t=0;t<l.length;t++)l[t].hide(200)}else{A.attr("Expand","true"),A.removeClass("expand_icon"),A.addClass("shrink_icon");for(var t=0;t<l.length;t++)l[t].show(200)}}for(var g=0;g<window.accmgr.length;g++){var y=$("<div>");if(c3.hasPermission([permissionItems.operator]))switch(g){case 0:y.addClass("globalsettings_icon");break;case 1:y.addClass("mailTemp_icon");break;case 2:y.addClass("operator_icon");break;case 3:y.addClass("reseller_icon");break;case 4:y.addClass("SLDClient_icon");break;case 5:y.addClass("log_icon");break;case 6:y.addClass("externalAddressMapping_icon");break;default:y.removeClass()}else switch(g){case 0:y.addClass("reseller_icon");break;case 1:y.addClass("varrequest_icon");break;default:y.removeClass()}var b=$("<a>").attr({href:"#"}).append(window.accmgr[g].getTitle()),w=$("<li>").attr({id:"accessmgr"+g}).css({"padding-left":"20px",display:"none"}).append(y).append(b);w.click(function(){var e=$(this).attr("id"),t=e.substring(0,e.length-1),n=e.substring(e.length-1,e.length);N(t,n),T(),$(this).css({"background-color":"#aaa","border-color":"white"}).children().css({color:"White"})}),L.append(w),l.push(w)}for(var g=0;g<l.length;g++)l[g].show();u.append(L)}if(window.supportability&&window.supportability.length>0){var _=$("<ul>").attr({id:"support_tab_header"}),D=$("<div>").addClass("shrink_icon").attr({Expand:"true"}),P=$("<li>").css({"padding-left":"5px"}).bind("click",function(){H()}).append(D).append($("<a>").attr({href:"#"}).css("font-weight","bold").append(localizedString("SUPPORTABILITY")));_.append(P);function H(){var e=D.attr("Expand");if(e=="true"){D.attr("Expand","false"),D.removeClass("shrink_icon"),D.addClass("expand_icon");for(var t=0;t<c.length;t++)c[t].hide(200)}else{D.attr("Expand","true"),D.removeClass("expand_icon"),D.addClass("shrink_icon");for(var t=0;t<c.length;t++)c[t].show(200)}}for(var g=0;g<window.supportability.length;g++){var y=$("<div>");switch(g){case 0:y.addClass("contentUpload_icon");break;default:y.removeClass()}var b=$("<a>").attr({href:"#"}).append(window.supportability[g].getTitle()),w=$("<li>").attr({id:"supportability"+g}).css({"padding-left":"20px",display:"none"}).append(y).append(b);w.click(function(){var e=$(this).attr("id"),t=e.substring(0,e.length-1),n=e.substring(e.length-1,e.length);N(t,n),T(),$(this).css({"background-color":"#aaa","border-color":"white"}).children().css({color:"White"})}),_.append(w),c.push(w)}for(var g=0;g<window.supportability.length;g++)c[g].show();u.append(_)}var B=$("<ul>").attr({id:"about_ul"});p=$("<li>").attr({id:"about_li"}).append($("<a>").attr({href:"#"}).css("font-weight","bold").append(localizedString("OVERVIEW_INFOPANEL"))),B.append(p),u.append(B),h.click(function(){N("overview",0),T(),$(this).css({"background-color":"#aaa","border-color":"white"}).children().css({color:"White"})}),p.click(function(){N("about",4),T(),$(this).css({"background-color":"#aaa","border-color":"white"}).children().css({color:"White"})});for(var g=0;g<i.length;g++)e.append(i[g].getContainer());return r}function T(){for(var e=0;e<a.length;e++)$(a[e]).css({"background-color":"","border-color":""}),$(a[e]).children().css({color:""});for(var e=0;e<f.length;e++)$(f[e]).css({"background-color":"","border-color":""}),$(f[e]).children().css({color:""});for(var e=0;e<l.length;e++)$(l[e]).css({"background-color":"","border-color":""}),$(l[e]).children().css({color:""});for(var e=0;e<c.length;e++)$(c[e]).css({"background-color":"","border-color":""}),$(c[e]).children().css({color:""});$(h).css({"background-color":"","border-color":""}),$(h).children().css({color:""}),$(p).css({"background-color":"","border-color":""}),$(p).children().css({color:""})}function N(e,t){switch(e){case"overview":$("#overview").show(),$("#appmgr").hide(),$("#respool").hide(),$("#accessmgr").hide(),$("#about").hide(),$("#supportability").hide();break;case"appmgr":window.appmgr&&window.appmgr.length>0&&(s.currentModule!=null&&s.currentModule.onViewWillDisappear!=null&&s.currentModule.onViewWillDisappear(),s.currentModule=window.appmgr[t],window.appmgr[t].onViewWillAppear()),$("#overview").hide(),$("#appmgr").show(),$("#respool").hide(),$("#accessmgr").hide(),$("#about").hide(),$("#supportability").hide();break;case"respool":window.inframgr&&window.inframgr.length>0&&(s.currentModule!=null&&s.currentModule.onViewWillDisappear!=null&&s.currentModule.onViewWillDisappear(),s.currentModule=window.inframgr[t],window.inframgr[t].onViewWillAppear()),$("#overview").hide(),$("#appmgr").hide(),$("#respool").show(),$("#accessmgr").hide(),$("#about").hide(),$("#supportability").hide();break;case"accessmgr":window.accmgr&&window.accmgr.length>0&&(s.currentModule!=null&&s.currentModule.onViewWillDisappear!=null&&s.currentModule.onViewWillDisappear(),s.currentModule=window.accmgr[t],window.accmgr[t].onViewWillAppear()),$("#overview").hide(),$("#appmgr").hide(),$("#respool").hide(),$("#accessmgr").show(),$("#about").hide(),$("#supportability").hide();break;case"about":$("#overview").hide(),$("#appmgr").hide(),$("#respool").hide(),$("#accessmgr").hide(),$("#about").show(),$("#supportability").hide();break;case"supportability":window.supportability&&window.supportability.length>0&&(s.currentModule!=null&&s.currentModule.onViewWillDisappear!=null&&s.currentModule.onViewWillDisappear(),s.currentModule=window.supportability[t],window.supportability[t].onViewWillAppear()),$("#overview").hide(),$("#appmgr").hide(),$("#respool").hide(),$("#accessmgr").hide(),$("#about").hide(),$("#supportability").show();break;default:$("#overview").show(),$("#appmgr").hide(),$("#respool").hide(),$("#accessmgr").hide(),$("#about").hide(),$("#supportability").hide()}$("#"+e+"_tab_body>section").each(function(e,n){e!=t?$(n).hide():$(n).show()})}function C(){var e=$(window).height()-$("body").outerHeight(!0)+r.height();r.css("height",e+"px"),r.find(".module").css("height",e+"px");for(var t=0;t<i.length;t++)i[t].onResize()}function k(e,t){t>=0&&i[t].onViewWillDisappear(),sessionStorage&&(sessionStorage.selectedIndex=e),i[e].onViewWillAppear()}var e=localizedString("CLOUDCONTROLCENTER"),t=$("<section>").attr({id:"wrapper"}),n=null,r=null,i=[],s=this,o=$("<label>").addClass("user"),u=null,a=[],f=[],l=[],c=[],h=null,p=null;s.currentModule=null;var d=!0;v(),this._container=t}function c3Message(e,t){this.Key=e,this.Data=t}function c3Listener(e,t){this.Key=e,this.Handler=t}function c3emailTemplates(){function s(){var e=$("<ul>").addClass("detail_tab_header");for(var t=0;t<n.length;t++){var r=$("<a>").attr({href:"#"}).append(n[t]);e.append($("<li>").append(r))}return e}function o(){var e=$("<section>").addClass("tab_body");i.title=$("<h3>"),i.subTitle=$("<h3>");var t=$("<hgroup>").append(i.title).append(i.subTitle);return i.hgroup=t,e.append(u()),e.append(l()),e}function u(){var t=e+"_templates",n=t+"_toolbar",r=$("<section>").attr({id:t}),s=$("<div>").addClass("tools").attr({id:n}),o=$("<input>").attr({value:"Sync Templates",type:"button",id:n+"_btnSyncTemplate",disabled:0}),u=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:localizedString("MISC_REFRESH")}).addClass("refresh"),l=new searchbox({inputCallback:function(e){return i.gridTemplates.searchText(e)}}),c=[{name:"Name",description:"Template Name",type:"text",width:"30%"},{name:"Folder",description:"Path",type:"text",width:"70%"}],h={getHeaderSpec:function(){return c},getRowCount:function(){return i.gridDataTemplates.length},getRow:function(e){return i.gridDataTemplates[e]},getGridHeight:function(){return 620},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e},getDefaultSelectedIndex:function(){return 0}},p=$("<section>").attr({id:t+"_grid"}),d=p.gridview({delegate:h});return d.rowSelectedEvent.push(function(){i.selectedTemplate=i.gridDataTemplates[this.index]}),o.click(a),u.click(f),s.append(o),s.append($("<div>").css({"float":"right"}).append(l.css({"float":"left"})).append(u)),r.append(s),r.append(p),i.btnSync=o,i.gridTemplates=d,i.selectedTemplate=null,i.gridDataTemplates=[],i.colList=c,f(),d.show(),r}function a(){var e={success:function(){f()},error:function(){}};c3.service.syncMailTemplates(e)}function f(){var e=new loadingWindow;e.show();var t=c3.service.getMailTemplates();t.query(function(t){i.gridDataTemplates=t.data,i.gridTemplates.reload(),e.close()})}function l(){var t=e+"_events",n=t+"_toolbar",r=$("<section>").attr({id:t}),s=$("<div>").addClass("tools").attr({id:n}),o=[{name:"Name",description:"Event Name",type:"text",width:"30%"},{name:"Description",description:"Description",type:"text",width:"70%"}],u={autoResize:function(){return 620},getHeaderSpec:function(){return o},getRowCount:function(){return i.gridDataEvents.length},getRow:function(e){return i.gridDataEvents[e]},getGridHeight:function(){return Utility.MasterTableHeight},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e},getDefaultSelectedIndex:function(){return 0}},a=$("<section>").attr({id:t+"_grid"}),f=a.gridview({delegate:u});return f.rowSelectedEvent.push(function(){p(this.data.Name),v(this.data.ID),i.selectedEvent=i.gridDataEvents[this.index]}),r.append(s),r.append(a),r.append(h()),i.selectedEvent=null,i.gridDataEvents=[],i.colListEvents=o,i.gridEvents=f,c(),f.show(),r}function c(){var e=new loadingWindow;e.show();var t=c3.service.getMailEvents();t.query(function(t){t.data.length>0&&(i.selectedEvent=t.data[0],p(t.data[0].Name),v(t.data[0].ID)),e.close(),i.gridDataEvents=t.data,i.gridEvents.reload()})}function h(){var t=e+"_emailSetting",n=$("<section>").attr({id:t}).addClass("tab"),r=$("<h1>"),s=$("<section>").attr({id:t+"eventDetailPanel"}),o=$("<section>").attr({id:t+"eventMailAddress"});r.html("Email setting"),n.append(r);var u=["Assigned E-Mail Templates","E-Mail Addresses"],a=$("<ul>").attr({id:t+"_tab_header"}).addClass("detail_tab_header");for(var f=0;f<u.length;f++){var l=$("<a>").attr({href:"#"}).addClass("selected").append(u[f]);a.append($("<li>").attr({id:e+f.toString()}).append(l))}n.append(a);var c=t+"_toolbar",h=$("<div>").addClass("tools").attr({subId:c}),m=$("<input>").attr({value:"Assign",type:"button",id:c+"_btnAssign",disabled:0}),g=$("<input>").attr({value:"Remove",type:"button",id:c+"_btnRemove",disabled:1}),y=$("<a>").attr({href:"#",id:c+"_btnRefresh",title:localizedString("MISC_REFRESH")}).addClass("refresh"),b=new searchbox({inputCallback:function(e){return i.gridAssignedTemplates.searchText(e)}}),w=[{name:"MailTemplate_Name",description:"Template Name",type:"text",width:"30%"},{name:"MailTemplate_Folder",description:"Path",type:"text",width:"70%"}],E={getHeaderSpec:function(){return i.colListAssignedTemplates},getRowCount:function(){return i.gridDataAssignedTemplates.length},getRow:function(e){return i.gridDataAssignedTemplates[e]},getGridHeight:function(){return Utility.MasterTableHeight},getCell:function(){}},S=$("<section>").attr({id:t+"_grid"}),x=$(S).gridview({delegate:E});x.rowSelectedEvent.push(function(){i.btnRemove.removeAttr("disabled"),i.selectedAssignedTemplate=i.gridDataAssignedTemplates[this.index]}),m.click(function(){var e=new c3assignEmailTemplate(i,i.gridDataAssignedTemplates);e.finishEvent.push(function(){var t={success:function(){p(i.selectedEvent.Name)}},n={MailEventName:i.selectedEvent.Name,MailTemplates:[]};for(var r=0;r<e.templatesToAssign.length;r++)n.MailTemplates.push(e.templatesToAssign[r]);c3.service.createMailTemplateAssignment(n,t)}),e.show()}),g.click(function(){if(i.selectedAssignedTemplate!==null){var e={success:function(){p(i.selectedEvent.Name)}};c3.service.removeMailTemplateAssignment(i.selectedAssignedTemplate,e)}}),i.btnAssign=m,i.btnRemove=g,h.append(m),h.append(g),h.append($("<div>").css({"float":"right"}).append(b.css({"float":"left"})).append(y)),s.append(h),i.selectedAssignedTemplate=null,i.gridDataAssignedTemplates=[],i.colListAssignedTemplates=w,y.click(function(){p()}),x.show(),i.gridAssignedTemplates=x;var T=t+"_toolbar_address",N=$("<div>").addClass("tools").attr({subId:T}),C=$("<input>").attr({value:"Add",type:"button",id:T+"_btnAdd",disabled:0}),k=$("<input>").attr({value:"Remove",type:"button",id:T+"_btnRemove",disabled:1}),L=$("<a>").attr({href:"#",id:T+"_btnRefresh",title:localizedString("MISC_REFRESH")}).addClass("refresh"),A=new searchbox({inputCallback:function(e){return i.grid_address.searchText(e)}}),O=[{name:"Address",description:"Address",type:"text",width:"100%"}];L.click(function(){d()});var M={getHeaderSpec:function(){return i.colListMailAddresses},getRowCount:function(){return i.gridDataMailAddresses.length},getRow:function(e){return i.gridDataMailAddresses[e]},getGridHeight:function(){return Utility.MasterTableHeight},getCell:function(){}},_=$("<section>").attr({id:t+"_addressGrid"}),D=$(_).gridview({delegate:M});return D.rowSelectedEvent.push(function(){i.btnRemove_address.removeAttr("disabled"),i.selectedMailAddresses=i.gridDataMailAddresses[this.index]}),C.click(function(){i.reloadMailAddresses=v;var e=new c3addMailAddress(i);e.show()}),k.click(function(){if(i.selectedMailAddresses!==null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_DELETE_CONFIRM"),"E-Mail address"));e.yesEvent.push(function(){var e={success:function(){v(i.selectedEvent.ID)}};c3.service.removeMailAddress(i.selectedMailAddresses,e)})}}),i.btnAdd_address=C,i.btnRemove_address=k,N.append(C),N.append(k),N.append($("<div>").css({"float":"right"}).append(A.css({"float":"left"})).append(L)),o.append(N),i.selectedMailAddresses=null,i.gridDataMailAddresses=[],i.colListMailAddresses=O,D.show(),i.grid_address=D,s.append(S),o.append(_),n.append(s),n.append(o),n}function p(e){var t=c3.service.getMailTemplateAssignments();t.expand("MailTemplate").filter("MailEventName eq '"+e+"'").query(function(e){e.data.length==0&&i.btnRemove.attr({disabled:1}),i.gridDataAssignedTemplates=c3.service.convertData(e.data),i.gridAssignedTemplates.reload()})}function d(){var e=c3.service.getMailAddresses();e.query(function(e){e.data.length==0&&i.btnRemove.attr({disabled:1}),i.gridDataMailAddresses=c3.service.convertData(e.data),i.grid_address.reload()})}function v(e){var t=c3.service.getMailAddresses();t.filter("EventId eq '"+e+"'").query(function(e){e.data.length==0&&i.btnRemove.attr({disabled:1}),i.gridDataMailAddresses=c3.service.convertData(e.data),i.grid_address.reload()})}this.base=c3.module,this.base();var e="emailTemplates",t="E-Mail Templates",n=["Templates","Events"],r=$("<section>").attr({id:e}),i=this;this._container=r,this._title=t,this.onInit=function(){r.append(s()),r.append(o());var t=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.tab_body>section",{});t.onSelectEvent.push(function(e,t){}),t.select(0);var n=e+"_emailSetting",i=$("#"+n+">.detail_tab_header a").c3tab("#"+n+">.detail_tab_body>section",{});i.onSelectEvent.push(function(e,t){var r=$("#"+n+"eventDetailPanel"),i=$("#"+n+"eventMailAddress");e==0?(r.show(),i.hide()):e==1&&(r.hide(),i.show())}),i.select(0)},this.getMenuIcon=function(){return"mailtemplates_icon"}}function c3reseller4var(){function u(){var e=$("<div>").addClass("storage_items_panel");r.itemPanel=e;var t=$("<ul>").attr({id:"reseller_items_list"}).addClass("detail_tab_header");r.ul=t,e.append(t);for(var n=0;n<o.length;n++){var i=$("<li>").attr({id:"reseller_items_list"+n}),u=$("<a>").text(o[n]).attr("title",o[n]);i.append(u),n==0&&$(u).addClass("selected");var f=s[n];u.click(function(){r.ul.find("a").each(function(e,t){$(this).removeClass("selected")}),$(this).addClass("selected");var e=$(this).text();for(var t=0;t<o.length;t++)if(o[t]==e){a(s[t]);break}}),t.append(i)}return e}function a(e){r.CurrentItem=e,$(r.mainContainer).html(p(e)),f(e)}function f(e){switch(e){case"BasicInfo":l();break;case"Storage":if(i==null)l();else{var t=[];c3.service.getCompanyTemplateRepositories().filter("Reseller/ID eq "+i.ID).query(function(e){if(e.data!=null&&e.data.length>0)for(var n=0;n<e.data.length;n++)t.push({ID:e.data[n].ID,Status:e.data[n].Status,Path:e.data[n].URI,Type:localizedString("RES_COMPANY_TEMPLATE_REPOSITORY")});c3.service.getImplementationRepositories().filter("Reseller/ID eq "+i.ID).query(function(e){if(e.data!=null&&e.data.length>0)for(var n=0;n<e.data.length;n++)t.push({ID:e.data[n].ID,Status:e.data[n].Status,Path:e.data[n].URI,Type:localizedString("RES_SHARED_IMPL_REPOSITORY_LF")});c({data:t})})})}break;case"Authorization":i==null?l():c3.service.getTaskTypes().query(function(e){c3.service.getTaskAuthorizations().filter("Group/ID eq "+i.Group.ID).expand("TaskType").query({success:function(t){var n=[];for(var r=0;r<e.data.length;r++)n.push({ID:e.data[r].ID,Description:e.data[r].Description,OperationType:"Unauthorized",TaskType:e.data[r].TaskType});if(t.data!=null&&t.data.length>0)for(var i=0;i<n.length;i++)for(var r=0;r<t.data.length;r++)if(n[i].ID==t.data[r].TaskType.ID){n[i].TaskAuthID=t.data[r].ID,n[i].OperationType=t.data[r].PermissionType;break}c({data:n})},error:function(){}})});break;default:l()}}function l(){c3.service.getResellers().expand("Group").query(function(e){e.data!=null&&e.data.length>0&&(i=e.data[0]),r.gridData=e.data,r.gridView.reload()})}function c(e){r.gridData=e.data,e.data==null&&(r.gridData=e.d.results),r.gridView.reload()}function h(){var e=null;if(r.select!=null&&r.select.val()!=null&&r.select.val()!="All"){var t="Task/Status eq '"+r.select.val()+"'";e=c3.service.getVARRequests().filter(t)}else e=c3.service.getVARRequests();e.expand("Applicant, Processor/SBOUserBindings, Task/TaskParameters, ApplicantGroup").query(function(e){e.data==null||e.data.length==0?(r.gridData=e.data,r.gridView.reload()):c3.service.getResellers().expand("Group").query(function(t){var n=c3.service.convertData(e.data);if(t.data==null||t.data.length==0)c({data:n});else{for(var r=0;r<n.length;r++)for(var i=0;i<t.data.length;i++)if(n[r].ApplicantGroup_ID==t.data[i].Group.ID){n[r].VARName=t.data[i].Name;break}c({data:n})}})})}function p(e){r.gridView=null,r.gridData=[],r.gridDelegate=null;var t=$("<div>");r.gridDelegate={getRowCount:function(){return r.gridData.length},getRow:function(e){return r.gridData[e]},getGridHeight:function(){return 400}};switch(e){case"BasicInfo":r.gridDelegate.getHeaderSpec=function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"Country",description:localizedString("CUSTOMER_COLUMN_COUNTRY"),type:"text",width:"10%"},{name:"Location",description:localizedString("CUSTOMER_COLUMN_LOCATION"),type:"text",width:"10%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"10%"},{name:"Phone",description:localizedString("CUSTOMER_COLUMN_PHONE"),type:"text",width:"10%"},{name:"EmployeeCount",description:localizedString("CUSTOMERCREATION_LABEL_EMPLOYEECOUNT"),type:"text",width:"10%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"36%"}]},r.gridDelegate.getCell=function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e},r.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RESPOOL_RESELLER_TLT"),!1,null)};break;case"Storage":r.gridDelegate.getHeaderSpec=function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"5%"},{name:"Path",description:localizedString("COLUMN_STORAGE_PATH"),type:"text",width:"60%"},{name:"Type",description:localizedString("COLUMN_STORAGE_TYPE"),type:"text",width:"35%"}]},r.gridDelegate.getCell=function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e},r.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RES_STORAGES"),!1,null)};break;case"Authorization":r.gridDelegate.getHeaderSpec=function(){return[{name:"TaskType",description:localizedString("RESELLER_CREATION_STEP3_COLUMN_OPT"),type:"text",width:"40%"},{name:"OperationType",description:localizedString("RESELLER_AUTH_COLUMN_STATUS"),type:"text",width:"20%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"40%"}]},r.gridDelegate.getCell=function(){var e=null;return this.colName=="TaskType"?e=$("<span>").html(localizedString(this.data.TaskType.toUpperCase())):this.colName=="OperationType"&&(e=$("<input>").attr({type:"checkbox",disabled:1}),this.data.OperationType=="Authorized"?e.attr("checked",!0):e.attr("checked",!1)),e},r.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RESELLER_4VAR_GRID_TASKAUTH_EPT"),!1,null)};break;default:r.gridDelegate.getHeaderSpec=function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"Country",description:localizedString("CUSTOMER_COLUMN_COUNTRY"),type:"text",width:"10%"},{name:"Location",description:localizedString("CUSTOMER_COLUMN_LOCATION"),type:"text",width:"10%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"10%"},{name:"Phone",description:localizedString("CUSTOMER_COLUMN_PHONE"),type:"text",width:"10%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"46%"}]},r.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RESPOOL_RESELLER_TLT"),!1,null)}}return r.gridView=t.gridview({delegate:r.gridDelegate}),r.gridView.rowSelectedEvent.push(function(){}),r.gridView.show(),t}function d(){a("BasicInfo")}function v(e){}this.base=c3.module,this.base();var e="reseller4var",t=$("<section>").attr({id:e}),n=localizedString("LINK_RESELLERSELF"),r=this,i=null;r.gridView=null,r.gridData=[],r.gridDelegate=null,r.CurrentItem=null;var s=["BasicInfo","Storage","Authorization"],o=[localizedString("RESELLER_4VAR_TLT_BASIC"),localizedString("RES_SHARED_FOLDER"),localizedString("RESELLER_CREATION_STEP3_NAME")];this._container=t,this._title=n,this.onInit=function(){this._container.append(u());var e=$("<div>").addClass("storage_content_panel");r.mainContainer=e,this._container.append(e),a("BasicInfo")},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.TaskOperationRequests,function(e){r.CurrentItem=="VARRequest"&&h()}),cometdManager.subscribe(sldEntitySet.Resellers,function(e){r.reload()})},this.reload=d,this.getSelectedItem=function(){return i}}function dbuploadframe(){this.base=c3.module,this.base(),this.fmloaded=!1;var e="supportability",t=$("<section>").attr({id:e}),n=localizedString("DBUPLOAD_TITLE");this._container=t,this.getTitle=function(){return n},this.onInit=function(){},this.initFM=function(){var e=this,t=function(t){function s(e){console.info(e),e.data.messageType==="queryToken"?i():e.data.messageType==="queryOperator"?queryCurrentOperator():e.data.messageType==="windowResize"}var n=$("<iframe>"),r=t+"#"+window.location.href,i=function(){var e=c3.service.getToken();e.query(function(e){var t=e.data,i=undefined;t&&t.GetSessionToken&&(i=t.GetSessionToken),n[0].contentWindow.postMessage({messageType:"c3token",data:i},r)})};n.attr("src",r),n.css("border",0).attr("width","100%").attr("height",$("#main").height()-10),e._container.append(n),$(window).resize(function(){n.attr("height",$("#main").height()-10)}),window.addEventListener("message",s,!1),n.load(function(){i(),e.fmloaded=!0})},n=c3.service.getRSPService();n.query({success:function(e){e.data.length>0?t(e.data[0].RSPAccessURL):alert(localizedString("RSPACCESSURL_ERR"))}})},this.onViewWillAppear=function(){this.fmloaded===!1&&this.initFM()}}function c3myrequests(){function o(){var e=null;if(r.select!=null&&r.select.val()!=null&&r.select.val()!="All"){var t="Task/Status eq '"+r.select.val()+"'";e=c3.service.getVARRequests().filter(t)}else e=c3.service.getVARRequests();e.expand("Applicant, Processor/SBOUserBindings, Task/TaskParameters, ApplicantGroup").query(function(e){e.data==null||e.data.length==0?(r.gridData=e.data,r.gridView.reload()):c3.service.getResellers().expand("Group").query(function(t){var n=c3.service.convertData(e.data);if(t.data==null||t.data.length==0)u({data:n});else{for(var r=0;r<n.length;r++)for(var i=0;i<t.data.length;i++)if(n[r].ApplicantGroup_ID==t.data[i].Group.ID){n[r].VARName=t.data[i].Name;break}u({data:n})}})})}function u(e){r.gridData=e.data,e.data==null&&(r.gridData=e.d.results),r.gridView.reload()}function a(){r.gridView=null,r.gridData=[],r.gridDelegate=null;var t=$("<div>");r.gridDelegate={getRowCount:function(){return r.gridData.length},getRow:function(e){return r.gridData[e]},getGridHeight:function(){return 400},getCell:function(){var e=null,t=this.data;if(this.colName=="Task_TaskType")e=$("<span>").html(localizedString(this.data.Task_TaskType.toUpperCase()));else if(this.colName=="Task_Status")e=$("<span>").html(localizedString(this.data.Task_Status.toUpperCase()));else{if(this.colName=="Review"){var n=$("<a>").attr({href:"#"}).text(localizedString("RES_DETAILS"));return n.click(function(){return function(e){if(e!=null&&e.Task_TaskParameters!=null&&e.Task_TaskParameters.length>0){var t=null;for(var n=0;n<e.Task_TaskParameters.length;n++)if(e.Task_TaskParameters[n].Name=="ExtraData"){t=e.Task_TaskParameters[n].Value;break}if(t!=null&&t.length>0){var i=utf8Decode(t),s=JSON.parse(i);if(e!=null){var o=new c3taskReview(r,s,e.Task_TaskType,e);o.show()}}}}(t)}),n}if(this.colName=="CreateDate")this.data["CreatedDate"]!=null&&this.data.CreatedDate.length>0&&(e=$("<span>").html(convertToFamatDateTime(this.data.CreatedDate)));else if(this.colName=="Processor"){var i=$("<div>");return this.data["Processor_ID"]!=null&&this.data.Processor_ID>0&&c3.service.getOSUserBindings().filter("User/ID eq "+this.data.Processor_ID).query(function(e){e.data!=null&&e.data.length>0&&i.append(e.data[0].SystemUser)}),i}}return e},getHeaderSpec:function(){return[{name:"Task_Status",description:localizedString("MISC_STATUS"),type:"text",width:"14%"},{name:"VARName",description:localizedString("VARREQUESTS_COLUMN_VAR"),type:"text",width:"16%"},{name:"Task_TaskType",description:localizedString("VARREQUESTS_COLUMN_OPTTYPE"),type:"text",width:"17%"},{name:"Comments",description:localizedString("VARREQUESTS_COLUMN_COM"),type:"text",width:"20%"},{name:"CreateDate",description:localizedString("VARREQUESTS_COLUMN_DATE"),type:"text",width:"18%"},{name:"Review",description:localizedString("RES_DETAILS"),type:"text",width:"15%"}]}};var n=$("<div>"),u=$("<section>").attr({id:"varRequest_toolbar"}).addClass("tools"),a=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh").css({"float":"right"});a.click(function(){o()});var l=$("<input>").attr({value:localizedString("MISC_CANCEL"),type:"button",id:"myRequest_btnCancel",disabled:1}).css({"float":"left"});l.click(function(){var e=MessageBox.confirm(localizedString("REQUEST_CANCEL_CONFIRM"));e.yesEvent.push(function(){var e={TaskOperationRequests:[{ID:i.ID}]};c3.service.cancelTaskOperationRequests(e,{success:function(e){r.reload()},error:function(e){r.reload()}})})}),u.append(l),r.btnCancel=l;var c=$("<select>").attr({id:"filterRequests"}).css({"float":"right"}).change(function(){o()});r.select=c,f(),u.append(a).append(c),r.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RESELLER_4VAR_GRID_VARREQUEST_EPT"),!1,null)},r.gridView=t.gridview({delegate:r.gridDelegate}),r.gridView.rowSelectedEvent.push(function(){s=this.index,i=r.gridData[this.index],i!=null&&i.Task_Status!="WaitingForApproval"?r.btnCancel.attr("disabled",1):r.btnCancel.removeAttr("disabled")}),r.gridView.show(),n.append(u).append(t),r._container.append(n)}function f(){var e=$("<option>").attr({title:localizedString("ALL"),selected:!0}).append(localizedString("ALL")).val("All"),t=$("<option>").attr({title:localizedString("WAITINGFORAPPROVAL"),selected:!0}).append(localizedString("WAITINGFORAPPROVAL")).val("WaitingForApproval"),n=$("<option>").attr("title",localizedString("SUCCESSFUL")).append(localizedString("SUCCESSFUL")).val("Successful"),i=$("<optgroup>").attr({label:" ==================="}),s=$("<option>").attr("title",localizedString("CANCELLED")).append(localizedString("CANCELLED")).val("Cancelled"),o=$("<option>").attr("title",localizedString("REJECTED")).append(localizedString("REJECTED")).val("Rejected"),u=$("<option>").attr("title",localizedString("FAILED")).append(localizedString("FAILED")).val("Failed");r.select.append(e).append(t).append(n).append(i).append(s).append(o).append(u)}function l(){o()}this.base=c3.module,this.base();var e="reseller4var",t=$("<section>").attr({id:e}),n=localizedString("LINK_REQUEST4VAR"),r=this;r.gridView=null,r.gridData=[],r.gridDelegate=null;var i=null,s=null;this._container=t,this._title=n,this.onInit=function(){var e=$("<div>").addClass("storage_content_panel");r.mainContainer=e,this._container.append(e),a(),o()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.TaskOperationRequests,function(e){r.CurrentItem=="VARRequest"&&o()})},this.reload=l}function c3globalSettings(){function f(e){return String(e).search(a)!=-1}function c(){var n=t+"_Grid",r=$("<section>").attr({id:n}),i=$("<section>").attr({id:n+"_grid"}),s=[{name:"DisplayedName",description:"Name",type:"text",width:"35%"},{name:"Type",description:"Type",type:"text",width:"10%"},{name:"Value",description:"Value",type:"text",width:"50%"}];e.globalSettingsData=[];var o={getHeaderSpec:function(){return s},getRowCount:function(){return e.globalSettingsData.length},getRow:function(t){return e.globalSettingsData[t]},getGridHeight:function(){return 620},getCell:function(){if(this.colName=="DisplayedName"){var t=this.data,n=$("<div>").addClass("td_editproperty").css("max-width","800px").text(t.DisplayedName).attr({title:t.Description});return n}if(this.colName=="Value"){var r=this,i={},t=r.data;retVal=$("<div>").addClass("parameter_value");var s,o="";String(t.Value)=="true"&&(o="checked");var u={};if(t.Type=="integer"||t.Type=="string"||t.Type=="enum")s=$("<div>").addClass("td_editproperty").css("max-width","800px").text(t.Value);else if(t.Type=="boolean")s=$("<div>").addClass("td_editproperty").append($("<input>").attr("type","checkbox").attr("disabled","disabled").attr("checked",o));else if(t.Type=="password"){u.type="password";var a=t.Value.length,l="";for(var c=0;c<a;c++)l+="*";s=$("<div>").addClass("td_editproperty").css("max-width","800px").text(l)}var h=new textbox(u);h.addClass("globalSetting");var p=$("<input>").attr("type","checkbox").attr("checked",o);e.checkBox=p;var d=$("<select>");e.comboBox=d;var v;if(t.Type=="boolean")v=$("<div>").addClass("td_editproperty").append(p);else if(t.Type=="enum"){v=$("<div>").addClass("td_editproperty").append(d);var m=t.ValidValues.split("|");for(c=0;c<m.length;c++)v.find("select").append(new Option(m[c],m[c],m[c]==t.Value?!0:!1,!1));v.find("select").val(t.Value)}else v=h.attr({value:t.Value}),valSelector=$("<select>").bind("change",function(e){});var g={};g.success=function(e){},g.error=function(){e.loadingWin.close()};var y=$("<label>").attr({title:localizedString("MISC_SAVE")}).addClass("ShowIcon Save").click(function(){if(!c3.hasPermission([permissionItems.operator])){h.showErrorMessage(localizedString("Error: empty string"));return}switch(t.Type){case"boolean":var n="";i.Value=p.attr("checked"),String(i.Value)=="true"&&(n="checked");break;case"integer":var r={GlobalSettingDomainGroupsManagement:"Global.DomainGroups.Management",GlobalSettingBasicTrialDuration:"GlobalSettingMaxBasicTrialDuration",GlobalSettingExtendedTrialDuration:"GlobalSettingExtendedTrialDuration",GlobalSettingMaxUsersPerTrialCustomer:"GlobalSettingMaxUsersPerTrialCustomer"};if(f(h.val().trim())!=1){h.showErrorMessage("Value is not valid");return}if(t.Name==r.GlobalSettingBasicTrialDuration&&h.val().trim()>r.GlobalSettingMaxBasicTrialDuration){h.showErrorMessage("Value is not valid");return}if(t.Name==r.GlobalSettingExtendedTrialDuration&&h.val().trim()>r.GlobalSettingMaxExtendedTrialDuration){h.showErrorMessage("Value is not valid");return}if(t.Name==r.GlobalSettingMaxUsersPerTrialCustomer&&h.val().trim()>r.GlobalSettingMaxUsersPerTrialCustomerLimit){h.showErrorMessage("Value is not valid");return}if(t.Name=="Global.Machines.StatusQuery"&&h.val().trim()<1){h.showErrorMessage("Value is not valid");return}i.Value=h.val().trim();break;case"password":var o=h.val().trim().length,u="";for(var a=0;a<o;a++)u+="*";i.Value=u;break;case"enum":i.Value=v.find("select").val();break;case"string":i.Value=h.val().trim()}e.loadingWin.show();var l={Parameters:[]};l.Parameters.push({Id:t.ID,Name:t.Name,DisplayedName:t.DisplayedName,Value:i.Value,Type:t.Type,Description:t.Description,ValidValues:t.ValidValues,DefaultValue:t.DefaultValue});var c={};c3.service.setGlobalSettings(l,c),c.success=function(n){t.Value=i.Value,S.hide();switch(t.Type){case"boolean":s[0].childNodes[0].checked=i.Value;break;case"integer":case"password":case"enum":case"string":s[0].innerHTML=i.Value}if(t.Name=="Global.Machines.StatusQuery"){var r={};r.success=function(e){},r.error=function(){e.loadingWin.close()},c3.service.UpdateMachineStatusQueryInterval(r)}E.show()},c.error=function(e){h.showErrorMessage("SetGlobalSettings failed")},e.loadingWin.close()}),b=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel").click(function(){t.Type=="boolean"&&(p=o),S.hide(),E.show()}),w=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){h.attr({value:t.Value}),S.show(),E.hide(),v.focus()}),E=$("<div>").append(s).append(w),S;return t.Type=="boolean"?S=$("<div>"):S=$("<div>").css({"float":"left"}).attr({title:t.Value}).attr({width:"500px"}),S.append(v),S.append(y).append(b),S.hide(),retVal.append(E).append(S),retVal}return null}},u=$(i).gridview({delegate:o});return u.show(),e.globalSettingsGrid=u,r.append(i),r}function h(){var n=t+"_toolbar",r=$("<section>").attr({id:n}).addClass("tools"),i=$("<label>").html(localizedString("CUSTOMER_SELECT_LABEL")+":&nbsp;").css({"float":"left","padding-top":"3px"}),s=$("<div>").attr({id:"div_selectSettingsGroup"}).css({"float":"left","margin-right":"20px"}),o=$("<select>").attr({id:"selectSettingsGroup"}),u=$("<option>").attr({title:localizedString("GLOBAL_SETTINGS_SELECT_ALL")}).val("Global.").append(localizedString("GLOBAL_SETTINGS_ALL"));o.append(u),o.bind("change",d),e.selectSettingsGroup=o;var a=$("<a>").attr({href:"#",id:"btnRefresh_"+t,title:"Refresh"}).addClass("refresh");this.btnRefresh=a,a.click(function(){p(e.selectedGroup)});var f=new searchbox({inputCallback:function(t){return e.globalSettingsGrid.searchText(t)}});return r.append($("<div>").css({"float":"right"}).append(s.append(o)).append(f.css({"float":"left"})).append(a)),r}function p(t){e.loadingWin&&(e.loadingWin=new loadingWindow),e.loadingWin.show();var n={};n.success=function(t){for(var n=0;n<t.data.length;n++){var r=t.data[n].Name.split(".");if($.inArray(r[1],e.groups)==-1){e.groups.push(r[1]);var i=$("<option>").attr({title:r[1]}).val(r[1]).append(r[1]);e.selectSettingsGroup.append(i)}}e.globalSettingsData=t.data,e.globalSettingsGrid.reload(),e.loadingWin.close()},n.error=function(t){console.debug("error"),e.loadingWin.close()},c3.service.getGlobalSettings(t).query(n)}function d(){var t=e.selectSettingsGroup.val();if(t=="Global.")p("Global."),e.selectedGroup="Global.";else for(var n=0;n<e.groups.length;n++)if(t==e.groups[n]){p("Global."+t),e.selectedGroup="Global."+t;break}}this.base=c3.module,this.base();var e=this,t="globalSettings",n=$("<section>").attr({id:t});e.container=n;var r=localizedString("GLOBAL_SETTINGS");e.title=r;var i=[];e.groups=i;var s="Global.";e.selectedGroup=s;var o=[{id:"userInvMailExp",text:localizedString("GLOBAL_SETTINGS_INV_MAIL_EXP_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_INV_MAIL_EXP_PARAM"),group:localizedString("GLOBAL_SETTINGS_GENERAL_GROUP")},{id:"userDisabledAfter",text:localizedString("GLOBAL_SETTINGS_USER_DISABLED_AFTER_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_USER_DISABLED_AFTER_PARAM"),group:localizedString("GLOBAL_SETTINGS_GENERAL_GROUP")},{id:"userManualTrialRequestApp",text:localizedString("GLOBAL_SETTINGS_TRIAL_REQUEST_APP_LABEL"),type:"checkbox",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_TRIAL_REQUEST_APP_PARAM"),group:localizedString("GLOBAL_SETTINGS_GENERAL_GROUP")},{id:"solPortalUrl",text:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_URL_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_URL_PARAM"),group:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_GROUP")},{id:"solPortalUiUrl",text:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_UI_URL_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_UI_URL_PARAM"),group:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_GROUP")},{id:"solPortalResetPasswordUrl",text:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_RESET_PASSWD_URL_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_RESET_PASSWD_URL_PARAM"),group:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_GROUP")},{id:"solPortalResetEmailUrl",text:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_RESET_EMAIL_URL_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_RESET_EMAIL_URL_PARAM"),group:localizedString("GLOBAL_SETTINGS_SOLUTION_PORTAL_GROUP")},{id:"newPassExp",text:localizedString("GLOBAL_SETTINGS_NEW_PASSWORD_EXP_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_NEW_PASSWORD_EXP_PARAM"),group:localizedString("GLOBAL_SETTINGS_PASSWORD_POLICY_GROUP")},{id:"passwordResetExpiration",text:localizedString("GLOBAL_SETTINGS_PASSWORD_RESET_EXPIRATION_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_PASSWORD_RESET_EXPIRATION_PARAM"),group:localizedString("GLOBAL_SETTINGS_PASSWORD_POLICY_GROUP")},{id:"emailResetExpiration",text:localizedString("GLOBAL_SETTINGS_EMAIL_RESET_EXPIRATION_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_EMAIL_RESET_EXPIRATION_PARAM"),group:localizedString("GLOBAL_SETTINGS_PASSWORD_POLICY_GROUP")},{id:"mailServer",text:localizedString("GLOBAL_SETTINGS_MAIL_SERVER_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_MAIL_SERVER_PARAM")},{id:"mailServerPort",text:localizedString("GLOBAL_SETTINGS_MAIL_SERVER_PORT_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_MAIL_SERVER_PORT_PARAM")},{id:"mailServerLogin",text:localizedString("GLOBAL_SETTINGS_MAIL_SERVER_LOGIN_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_MAIL_SERVER_LOGIN_PARAM")},{id:"mailServerPassword",text:localizedString("GLOBAL_SETTINGS_MAIL_SERVER_PASSWORD_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_MAIL_SERVER_PASSWORD_PARAM")},{id:"mailFrom",text:localizedString("GLOBAL_SETTINGS_MAIL_FROM_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_MAIL_FROM_PARAM")},{id:"emailTemplateLocation",text:localizedString("GLOBAL_SETTINGS_EMAIL_TEMPLATE_LOCATION_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_EMAIL_TEMPLATE_LOCATION_PARAM")},{id:"emailImagesLocation",text:localizedString("GLOBAL_SETTINGS_EMAIL_IMAGES_LOCATION_LABEL"),type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0,param:localizedString("GLOBAL_SETTINGS_EMAIL_IMAGES_LOCATION_PARAM")}];e.group=o;var u=new loadingWindow;e.loadingWin=u,e.getselectedTab=function(){return selectedTab},e.getTitle=function(){return localizedString("GLOBAL_SETTINGS_TITLE")};var a=/^\s*(\+|-)?\d+\s*$/,l=$("<section>").attr({id:t});e._container=l,e.mainPanel=l,e.onInit=function(){l.append($("<div>").attr("class","title_panel").append(this.getTitle())),l.append(h()),l.append(c()),p("Global.")},this.getMenuIcon=function(){return"globalsettings_icon"}}function accessmgr(){function i(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("tab_header");for(var n=0;n<tabHeadTxt.length;n++){var r=$("<a>").attr({href:"#"}).append(tabHeadTxt[n]);t.append($("<li>").attr({id:e+n.toString()}).append(r))}return t}function s(){body=$("<section>").attr({id:e+"_tab_body"}).addClass("tab_body");for(var t=0;t<window.accmgr.length;t++)body.append(window.accmgr[t].getContainer());return body}function o(e,t){t>=0&&window.accmgr[t].onViewWillDisappear(),window.accmgr[e].onViewWillAppear()}this.base=c3.module,this.base();var e="accessmgr",t=$("<section>").attr({id:e}),n=localizedString("ACCEESS_MGR_TITLE"),r=new c3apptoken;tabHeadTxt=[localizedString("RESPOOL_TAB_LABEL_OPERATOR"),localizedString("RESPOOL_RESELLER_TLT"),r.getTitle(),localizedString("AUDIT_LOG_TITLE")],self=this,c3.hasPermission([permissionItems.operator])?window.accmgr=[new c3globalSettings,new c3emailTemplates,new c3usrmgr,new respool.c3reseller,r,new c3auditLog,new c3hostMappings]:window.accmgr=[new c3reseller4var,new c3myrequests],this._container=t,this._title=n,this.onInit=function(){t.append(s())}}function c3hostMappings(){function s(e){return i[e]}function o(){return $("<div>").attr("class","title_panel").append(t)}function u(){var e=$("<section>");r.title=$("<h3>"),r.subTitle=$("<h3>");var t=$("<hgroup>").append(r.title).append(r.subTitle);return r.hgroup=t,e.append(a()),e}function a(){var n=e+"_hostMappings",o=n+"_toolbar",u=$("<section>").attr({id:n}),a=$("<div>").addClass("tools").attr({id:o}),f=$("<input>").attr({value:localizedString("MISC_REGISTER"),type:"button",id:o+"_btnRegister",disabled:0}),c=$("<input>").attr({value:localizedString("MISC_EDIT"),type:"button",id:o+"_btnEdit",disabled:1}),h=$("<input>").attr({value:localizedString("MISC_UNREGISTER"),type:"button",id:o+"_btnUnregister",disabled:1}),p=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:localizedString("MISC_REFRESH")}).addClass("refresh"),d=new searchbox({inputCallback:function(e){return r.gridHostMappings.searchText(e)}}),v=[{name:"ComponentType",description:localizedString("HOST_MAPPING_COMPONENT_TYPE"),type:"text",width:"20%"},{name:"ComponentInternalURL",description:localizedString("HOST_MAPPING_INTERNAL_URL"),type:"text",width:"30%",disabled:1},{name:"ExternalURLs",description:localizedString("HOST_MAPPING_EXTERNAL_URLS"),type:"text",width:"50%"}],m={getHeaderSpec:function(){return v},getRowCount:function(){return r.gridDataHostMappings.length},getRow:function(e){return r.gridDataHostMappings[e]},getGridHeight:function(){return Utility.MasterTableHeight*3},getCell:function(){var e=null;return e},getDefaultSelectedIndex:function(){return-1}},g=$("<section>").attr({id:n+"_grid"}),y=g.gridview({delegate:m});return y.rowSelectedEvent.push(function(){r.btnEdit.removeAttr("disabled"),r.btnUnreg.removeAttr("disabled"),r.selectedHostMapping=r.gridDataHostMappings[this.index]}),f.click(function(){var e=new c3addHostMapping(r);e.show()}),c.click(function(){if(r.selectedHostMapping!=null){var e=new c3addHostMapping(r,r.selectedHostMapping);e.show()}}),h.click(function(){if(r.selectedHostMapping!=null){var e=MessageBox.confirm(String.format(localizedString("HOST_MAPPING_REMOVE_CONFIRMATION"),t)),n=r.selectedHostMapping.SpType;e.yesEvent.push(function(){var e={};e.success=function(e){r.reload()},c3.service.removeHostMappings(s(n),r.selectedHostMapping,e)})}}),p.click(l),a.append(f),a.append(c),a.append(h),a.append($("<div>").css({"float":"right"}).append(d.css({"float":"left"})).append(p)),u.append(a),u.append(g),r.btnRegister=f,r.btnEdit=c,r.btnUnreg=h,r.gridHostMappings=y,r.selectedHostMapping=null,r.gridDataHostMappings=[],r.colList=v,r.spServiceTypeMap=i,l(),y.show(),u}function f(e,t){r.sldGridRow!==undefined&&(e!==undefined&&(r.gridDataHostMappings[t].ComponentInternalURL=e.AccessURL),r.gridDataHostMappings[t].ComponentID=e.ID,r.gridHostMappings.reload())}function l(){var e=new loadingWindow;e.show();var t=c3.service.getHostMappings();t.query(function(t){r.sldGridRow=undefined,r.gridDataHostMappings=t.data;for(var n=0;n<r.gridDataHostMappings.length;n++){var i="",s,o;i=r.gridDataHostMappings[n].SpType,o=r.gridDataHostMappings[n].ExternalUrls,s=r.gridDataHostMappings[n].ID,r.sldGridRow=n;var u="";switch(i){case"SLD":r.gridDataHostMappings[n].ComponentInternalURL=window.localStorage.getItem("SLDFullyAddress");break;case"B1WebServer":u="B1WebServerDetails("+s+")/SpInfo";break;case"B1ahServer":u="B1ahServerDetails("+s+")/SpInfo";break;default:u=""}u!==""&&c3.service.getSpInfo(u,f,n),r.gridDataHostMappings[n].ComponentType=i,r.gridDataHostMappings[n].ExternalURLs=o}r.gridHostMappings.reload(),e.close(),r.btnEdit.attr("disabled",1),r.btnUnreg.attr("disabled",1)})}this.base=c3.module,this.base();var e="hostMappings",t=localizedString("HOST_MAPPING"),n=$("<section>").attr({id:e}),r=this;this._container=n,this._title=t,this.onInit=function(){n.append(o()),n.append(u())};var i={SLD:"SldDetails",B1WebServer:"B1WebServerDetails",B1ahServer:"B1ahServerDetails"};this.reload=function(){l()}}function c3addHostMapping(){var e=!1,t=arguments[1]||{},n=new c3addHostMapping.step1(this),r={getActionButtonText:function(){return t.ID&&t.ID>0?localizedString("MISC_SAVE"):localizedString("MISC_REGISTER")},validator:n.validator},i={register:function(e){var t=this,n=e.HostMappingEntity;this.base=c3.task,n.ID&&n.ID>0?this.base(localizedString("HOST_MAPPING_MODIFY"),100):this.base(localizedString("HOST_MAPPING_CREATE"),100),this.execute=function(){var e={ExternalUrls:n.ExternalURLs},r=s[n.ServiceType].Name,i=s[n.ServiceType].spName;i===s.B1ahServer.spName?log.warning("APPLICATION",localizedString("HOSTMAPPING_WARNING_EDIT_B1AH"),null):log.warning("APPLICATION",localizedString("BROWSERACCESS_WARNING_EDIT"),null);if(n.ID&&n.ID>0)r=r,e.ID=n.ID,c3.service.updateHostMappings(r,e,this.ajaxCallBackConfig);else{if(i&&i!==""){var o=odataclient.getServiceUrl(c3config.SLDPath)+"/"+i+"("+n.spID+")",u={__metadata:{uri:o}};e.SpInfo=u}c3.service.createHostMappings(r,e,this.ajaxCallBackConfig),t.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("New-HostMapping"))})}}}},s={SLD:{Name:"SldDetails",spName:""},B1WebServer:{Name:"B1WebServerDetails",spName:"B1WebServers"},B1ahServer:{Name:"B1ahServerDetails",spName:"AnalyticsServices"}};this.base=c3.dialog,this.base(r),this.HostMappingEntity=t,this.view=n;var o=this,u=arguments[0]||undefined,a=new i.register(this),f={taskCount:1,getTask:function(e){if(e==0)return a},finishEvent:[function(){o.readyForFinish()}],successEvent:[function(){e=!0,o.view.reset()}],successMessage:localizedString("MISC_DONE")},l=new multiTaskProcess(f);o.spServiceTypeMap=s,this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),l.placeAt(this.view.getContainer())},this.getId=function(){return"createHostMapping"},this.getTitle=function(){return o.HostMappingEntity.ID&&o.HostMappingEntity.ID>0?localizedString("HOST_MAPPING_MODIFY"):localizedString("HOST_MAPPING_CREATE")},this.finish=function(){o.disableFinish(),l.start()},this.reloadParent=function(){u&&e&&u.reload&&u.reload()},this.onClose.push(function(){o.reloadParent()})}var c3Identifier={AppKey:"SBO-SLD-APP-ID",AppIdentifier:"5645523035534C4443333A2D31383838383430363731383230363134634D4C775CF82A7DEEF4E3F9DF8486CB511761"},c3Icon={OK:"css/icons/ok.png",Success:"css/icons/success.png",Notification:"css/icons/notification.png",Warning:"css/icons/warning.png",Error:"css/icons/error.png",Failed:"css/icons/failed.png",Running:"css/icons/running.png",DowntimeForPatching:"css/icons/repairing.png",DowntimeForUpgrade:"css/icons/upgrading.png",DowntimeForMigration:"css/icons/migration.png",Available:"css/icons/available.png",Warning:"css/icons/warning.png",OutOfService:"css/icons/OutOfService.png",Repairing:"css/icons/repairing.png",Shutdown:"css/icons/shutdown.png",Upgrading:"css/icons/upgrading.png",Exist:"css/icons/exist.png",NotExist:"css/icons/notexist.png",Active:"css/icons/active.png",Inactive:"css/icons/inactive.png",Loading:"css/icons/loading_icon.gif",Log:"css/icons/log.png",Logout:"css/icons/logout.png",Online:"css/icons/online.png",Offline:"css/icons/offline.png",Maintenance:"css/icons/maintenance.png",first_active:"css/icons/first_active.png",first_inactive:"css/icons/first_inactive.png",pre_active:"css/icons/pre_active.png",pre_inactive:"css/icons/pre_inactive.png",next_active:"css/icons/next_active.png",next_inactive:"css/icons/next_inactive.png",last_active:"css/icons/last_active.png",last_inactive:"css/icons/last_inactive.png",trialRequest_approved:"css/icons/approved.png",trialRequest_failed:"css/icons/failed_trialRequest.png",trialRequest_inprogress:"css/icons/inProgress.png",trialRequest_new:"css/icons/new.png",trialRequest_rejected:"css/icons/rejected.png",trialRequest_released:"css/icons/released.png"};Array.prototype.remove=function(e,t){var n=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,n)},Array.prototype.clear=function(){return this.remove(0,this.length-1)},String.prototype.format=function(){var e=this;for(var t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[t])}return e},String.format=function(e){if(arguments.length<=1)return e;var t=arguments.length-2;for(var n=0;n<=t;n++)e=e.replace(new RegExp("\\{"+n+"\\}","gi"),arguments[n+1]);return e},String.prototype.startsWith=function(e){return this.indexOf(e)===0},String.prototype.endsWith=function(e){return this.match(e+"$")==e},String.compare=function(e,t,n){return n?e.toLowerCase()==t.toLowerCase():e==t},Date.prototype.formatString=function(){var e=String.format("{0}/{1}/{2} {3}:{4}:{5}",this.getMonth()+1,this.getDate(),this.getFullYear(),this.getHours()>=10?this.getHours():"0"+this.getHours(),this.getMinutes()>=10?this.getMinutes():"0"+this.getMinutes(),this.getSeconds()>=10?this.getSeconds():"0"+this.getSeconds());return e},Date.prototype.dateString=function(){var e=String.format("{0}/{1}/{2}",this.getMonth()+1<10?"0"+(this.getMonth()+1):this.getMonth()+1,this.getDate()<10?"0"+this.getDate():this.getDate(),this.getFullYear());return e},Date.prototype.timeString=function(){var e=String.format("{0}/{1}/{2} {3}:{4}:{5}",this.getMonth()+1<10?"0"+(this.getMonth()+1):this.getMonth()+1,this.getDate()<10?"0"+this.getDate():this.getDate(),this.getFullYear(),this.getHours()>=10?this.getHours():"0"+this.getHours(),this.getMinutes()>=10?this.getMinutes():"0"+this.getMinutes(),this.getSeconds()>=10?this.getSeconds():"0"+this.getSeconds());return e},$.browser.msie||(File.prototype.getExtName=function(){return this.name.substring(this.name.lastIndexOf(".")+1).toLowerCase()}),Number.prototype.padLeft=function(e,t){return Array(e-String(this).length+1).join(t||"0")+this},Number.prototype.padRight=function(e,t){return this+Array(e-String(this).length+1).join(t||"0")},jQuery.expr[":"].containsNotCaseSensitive=function(e,t,n){return jQuery(e).text().toUpperCase().indexOf(n[3].toUpperCase())>=0},jQuery.expr[":"].notContainsNotCaseSensitive=function(e,t,n){return jQuery(e).text().toUpperCase().indexOf(n[3].toUpperCase())<0};var log={error:function(e,t,n){var r=new ui.logLine(e,t,{settings:{data:n}},new Date,logType.Error);ui.log.addLog(r)},warning:function(e,t,n){var r=new ui.logLine(e,t,{settings:{data:n}},new Date,logType.Warning);ui.log.addLog(r)},info:function(e,t,n){var r=new ui.logLine(e,t,{settings:{data:n}},new Date,logType.Info);ui.log.addLog(r)}},logType={Error:"Error",Warning:"Warning",Info:"Info"},sldEntitySet={Tenants:"Tenants",TenantsStorages:"TenantsStorages",SoftwareRepositories:"SoftwareRepositories",SBOClients:"SBOClients",SBOSharedFolders:"SBOSharedFolders",CompanyTemplateRepositories:"CompanyTemplateRepositories",ServiceUnits:"ServiceUnits",PresentationServers:"PresentationServers",Customers:"Customers",Resellers:"Resellers",TrialRequests:"TrialRequests",ImplementationRepositories:"ImplementationRepositories",ExtensionSynchronizationLogs:"ExtensionSynchronizationLogs",ExtensionSynchronizationLogDetails:"ExtensionSynchronizationLogDetails",ExtensionInstallations:"ExtensionInstallations",Users:"Users",Tasks:"Tasks",TaskParameters:"TaskParameters",Permissions:"Permissions",Roles:"Roles",SBOUserBindings:"SBOUserBindings",Machines:"Machines",IntegrationComponents:"IntegrationComponents",CommonDatabases:"CommonDatabases",DatabaseInstances:"DatabaseInstances",CompanyDatabases:"CompanyDatabases",LicenseServers:"LicenseServers",RSPServices:"RSPServices",Mailers:"Mailers",LicenseFiles:"LicenseFiles",LicenseModules:"LicenseModules",LicenseAssignments:"LicenseAssignments",SystemInformation:"SystemInformation",Groups:"Groups",SystemUserBindings:"SystemUserBindings",PermissionGroups:"PermissionGroups",ChangeLogs:"ChangeLogs",ChangeLogDetails:"ChangeLogDetails",Executors:"Executors",GroupRelationships:"GroupRelationships",Resources:"Resources",Events:"Events",EventDetails:"EventDetails",Extensions:"Extensions",ExtensionDeployments:"ExtensionDeployments",ExtensionInstallations:"ExtensionInstallations",ExtensionAssignments:"ExtensionAssignments",ExtensionValidities:"ExtensionValidities",ExtensionProperties:"ExtensionProperties",ExtensionRepositories:"ExtensionRepositories",DeploymentProperties:"DeploymentProperties",AssignmentProperties:"AssignmentProperties",ExtensionSynchronizationLogs:"ExtensionSynchronizationLogs",ExtensionSynchronizationLogDetails:"ExtensionSynchronizationLogDetails",ExtensionUserPreferences:"ExtensionUserPreferences",ApplicationIdentifiers:"ApplicationIdentifiers",DynamicKeys:"DynamicKeys",SharedFolders:"SharedFolders",UsersStorages:"UsersStorages",TaskAuthorizations:"TaskAuthorizations",TaskTypes:"TaskTypes",VARRequests:"TaskOperationRequests",TaskOperationRequests:"TaskOperationRequests",LicenseQuotas:"LicenseQuotas",AnalyticService:"AnalyticsServices",XAppService:"XAppServices",HostMappings:"ComponentDetails",MailServers:"MailServers",MailTemplates:"MailTemplates",MailEvents:"MailEvents",MailTemplateAssignments:"MailTemplateAssignments",MailAddresses:"MailAddresses",B1WebServers:"B1WebServers"},sldEntityType={AnalyticService:"AnalyticsService",XAppService:"XAppService",Tenant:"Tenant",TenantsStorage:"TenantsStorage",SoftwareRepository:"SoftwareRepository",SBOSharedFolder:"SBOSharedFolder",BOClient:"BOClient",CompanyTemplateRepository:"CompanyTemplateRepository",ServiceUnit:"ServiceUnit",PresentationServer:"PresentationServer",B1WebServer:"B1WebServer",Customer:"Customer",TrialRequest:"TrialRequest",ImplementationRepository:"ImplementationRepository",User:"User",Task:"Task",TaskParameter:"TaskParameter",Role:"Role",SBOUserBinding:"SBOUserBinding",Machine:"Machine",IntegrationComponent:"IntegrationComponent",CommonDatabase:"CommonDatabase",DatabaseInstance:"DatabaseInstance",CompanyDatabase:"CompanyDatabase",LicenseServer:"LicenseServer",RSPService:"RSPService",Mailer:"Mailer",LicenseFile:"LicenseFile",LicenseModule:"LicenseModule",LicenseAssignment:"LicenseAssignment",SystemInformation:"SystemInformation",Group:"Group",SystemUserBinding:"SystemUserBinding",ApplicationIdentifier:"ApplicationIdentifier",SharedFolder:"SharedFolder",UsersStorage:"UsersStorage",LicenseQuota:"LicenseQuota",MailServer:"MailServer"},sldEntity={};sldEntity.AnalyticService={ID:"ID",LifeCycleStatus:"LifeCycleStatus",Status:"Status",Description:"Description",Name:"Name",URL:"URL",Version:"Version",Machine:"Machine"},sldEntity.XAppService={ID:"ID",LifeCycleStatus:"LifeCycleStatus",Status:"Status",Description:"Description",Name:"Name",Port:"Port",Link:"Link",Machine:"Machine"},sldEntity.Tenant={ID:"ID",Phone:"Phone",LifeCycleStatus:"LifeCycleStatus",Status:"Status",Purpose:"Purpose",CreationDate:"CreationDate",ContactPerson:"ContactPerson",Email:"Email",RemainingDays:"RemainingDays",Description:"Description",ServiceUnit:"ServiceUnit",CompanyDatabase:"CompanyDatabase",Customer:"Customer",Group:"Group",SBOSharedFolder:"SBOSharedFolder",LicenseFile:"LicenseFile"},sldEntity.ServiceUnit={ID:"ID",Status:"Status",Purpose:"Purpose",CreationDate:"CreationDate",Mode:"Mode",Version:"Version",Description:"Description",Name:"Name",CommonDatabase:"CommonDatabase",LicenseServer:"LicenseServer",ImplementationRepository:"ImplementationRepository",IntegrationComponent:"IntegrationComponent",SharedFolder:"SharedFolder",Mailer:"Mailer",SoftwareRepository:"SoftwareRepository",Group:"Group",TenantsStorage:"TenantsStorage",RSPService:"RSPService",CompanyTemplateRepository:"CompanyTemplateRepository",Tenants:"Tenants",PresentationServers:"PresentationServers"},sldEntity.Customer={ID:"ID",Phone:"Phone",Status:"Status",Location:"Location",Type:"Type",CreationDate:"CreationDate",EmployeeCount:"EmployeeCount",Country:"Country",InstallationNumber:"InstallationNumber",ContactPerson:"ContactPerson",Email:"Email",Description:"Description",Name:"Name",Industry:"Industry",Group:"Group",LicenseQuotas:"LicenseQuotas"},sldEntity.TrialRequest={ID:"ID",PostalCode:"PostalCode",Phone:"Phone",Reason:"Reason",State:"State",LastModifiedDate:"LastModifiedDate",RequestDate:"RequestDate",Industry:"Industry",RequestStatus:"RequestStatus",CompanyName:"CompanyName",EmployeeCount:"EmployeeCount",Country:"Country",ContactPerson:"ContactPerson",Address:"Address",Email:"Email",Comments:"Comments",Customer:"Customer",Processor:"Processor"},sldEntity.ApplicationIdentifier={ID:"ID",Identifier:"Identifier",Status:"Status",Description:"Description",Name:"Name"},sldEntity.LicenseServer={ID:"ID",Port:"Port",LifeCycleStatus:"LifeCycleStatus",HardwareKey:"HardwareKey",SiteUsername:"SiteUsername",Status:"Status",Description:"Description",Name:"Name",SiteUserPassword:"SiteUserPassword",Version:"Version",Machine:"Machine",LicenseFiles:"LicenseFiles"},sldEntity.DatabaseInstance={ID:"ID",ServerType:"ServerType",LifeCycleStatus:"LifeCycleStatus",IsTrustedConnection:"IsTrustedConnection",Status:"Status",LogFilePath:"LogFilePath",InstallationPath:"InstallationPath",ServerVersion:"ServerVersion",BackupFilePath:"BackupFilePath",Password:"Password",Username:"Username",Description:"Description",ROUsername:"ROUsername",ROPassword:"ROPassword",Name:"Name",Machine:"Machine",CommonDatabases:"CommonDatabases"},sldEntity.CommonDatabase={ID:"ID",LifeCycleStatus:"LifeCycleStatus",Status:"Status",Description:"Description",Name:"Name",CreationDate:"CreationDate",Version:"Version",DatabaseInstance:"DatabaseInstance"},sldEntity.CompanyDatabase={ID:"ID",Localization:"Localization",Name:"Name",CompanyName:"CompanyName",Version:"Version",DatabaseInstance:"DatabaseInstance"},sldEntity.SharedFolder={ID:"ID",Status:"Status",Description:"Description",URI:"URI"},sldEntity.UsersStorage={ID:"ID",Status:"Status",Description:"Description",URI:"URI"},sldEntity.ImplementationRepository={ID:"ID",Status:"Status",Description:"Description",URI:"URI"},sldEntity.CompanyTemplateRepository={ID:"ID",Status:"Status",Description:"Description",URI:"URI"},sldEntity.TenantsStorage={ID:"ID",Status:"Status",Description:"Description",URI:"URI"},sldEntity.SBOSharedFolder={ID:"ID",Status:"Status",Description:"Description",URI:"URI",Tenant:"Tenant"},sldEntity.SoftwareRepository={ID:"ID",Status:"Status",Description:"Description",RootURI:"RootURI",UpgradeWizardURI:"UpgradeWizardURI",Version:"Version"},sldEntity.PresentationServer={ID:"ID",ServerType:"ServerType",LifeCycleStatus:"LifeCycleStatus",Status:"Status",Description:"Description",Name:"Name",ServiceUnit:"ServiceUnit",Machine:"Machine"},sldEntity.Machine={ID:"ID",LifeCycleStatus:"LifeCycleStatus",Status:"Status",Description:"Description",Hostname:"Hostname"},sldEntity.B1WebServer={ID:"ID",LifeCycleStatus:"LifeCycleStatus",Status:"Status",Description:"Description",Name:"Name",ServiceUnit:"ServiceUnit",Machine:"Machine",Version:"Version"},sldEntity.IntegrationComponent={ID:"ID",LifeCycleStatus:"LifeCycleStatus",Status:"Status",Description:"Description",Name:"Name",URL:"URL",Version:"Version",Machine:"Machine"},sldEntity.Mailer={ID:"ID",Port:"Port",LifeCycleStatus:"LifeCycleStatus",Status:"Status",Description:"Description",Name:"Name",Machine:"Machine"},sldEntity.SystemUserBinding={ID:"ID",SystemUser:"SystemUser",User:"User"},sldEntity.Group={ID:"ID",Name:"Name",Users:"Users",Roles:"Roles"},sldEntity.User={ID:"ID",Status:"Status",Deleted:"Deleted",SBOUserBindings:"SBOUserBindings",Groups:"Groups"},sldEntity.Role={ID:"ID",Name:"Name",Permissions:"Permissions"},sldEntity.SBOUserBinding={ID:"ID",Confirmed:"Confirmed",SBOUsername:"SBOUsername",IsSuperuser:"IsSuperuser",IsPoweruser:"IsPoweruser",CompanyDatabase:"CompanyDatabase",User:"User"},sldEntity.LicenseFile={ID:"ID",InstallationNumber:"InstallationNumber",Localization:"Localization",SystemNumber:"SystemNumber",FileName:"FileName",Version:"Version",LicenseServer:"LicenseServer"},sldEntity.LicenseModule={ID:"ID",Total:"Total",InstallationNumber:"InstallationNumber",StartDate:"StartDate",Description:"Description",ExpirationDate:"ExpirationDate",IsExpired:"IsExpired",Available:"Available",Type:"Type",LicenseFile:"LicenseFile"},sldEntity.LicenseAssignment={ID:"ID",ModuleType:"ModuleType",SBOUsername:"SBOUsername",LicenseModule:"LicenseModule"},sldEntity.ExtensionType={Addon:"AddOn",Lightweight:"LightAddOn",LightweightMV:"LightAddOnMV",B1script:"SBOScript",XApp:"XApp",LightweightXApp:"LightAddOnXApp"},sldEntity.ChangeLog={ID:"ID",ResourceID:"ResourceID",Operation:"Operation",User:"User",UserName:"UserName",Timestamp:"Timestamp",ChangeLogDetails:"ChangeLogDetails",ResourceType:"ResourceType"},sldEntity.ChangeLogDetails={ID:"ID",ChangeLog:"ChangeLog",PropertyName:"PropertyName",PropertyOldValue:"PropertyOldValue",PropertyNewValue:"PropertyNewValue"},sldEntity.LicenseQuota={ID:"ID",Customer:"Customer",ModuleName:"ModuleName",QuotaNumber:"QuotaNumber"},sldEntity.HostMapping={ID:"ID",ServiceUnit:"ServiceUnit",SolutionPortal:"SolutionPortal",SldId:"SldId",ExternalHost:"ExternalHost",ExternalPort:"ExternalPort"},sldEntity.MailServer={ID:"ID",SmtpHost:"SmtpHost",SmtpPort:"SmtpPort",SmtpSecurity:"SmtpSecurity",SmtpSslPort:"SmtpSslPort",SmtpUsername:"SmtpUsername",SmtpPassword:"SmtpPassword",ImapHost:"ImapHost",ImapPort:"ImapPort",ImapSecurity:"ImapSecurity",ImapSslPort:"ImapSslPort",ImapUsername:"ImapUsername",ImapPassword:"ImapPassword",ImapUsername2:"ImapUsername2",ImapPassword2:"ImapPassword2",ImapPollInterval:"ImapPollInterval",EmailDelimiter:"EmailDelimiter",DefaultFromEmailAddress:"DefaultFromEmailAddress",DefaultFromEmailName:"DefaultFromEmailName",DefaultCharset:"DefaultCharset",Status:"Status",LifeCycleStatus:"LifeCycleStatus"};var Utility={CreateRow:function(e,t,n){var r=$("<div>").addClass("row");r.append($("<div>").append(e).addClass("rowName"));if(t.placeAt){var i=$("<div>").addClass("rowValue");t.placeAt(i),n&&i.children(".txt_box_wrap").append(n),r.append(i)}else r.append($("<div>").append(t).append(n).addClass("rowValue"));return r},CreateProgressRow:function(e,t,n){var r=$("<div>").addClass("progressRow");r.append($("<div>").append(e).addClass("name"));var i=$("<div>").addClass("progress"),s=i.c3progress(t,{max:100,dur:c3config.Clocker,async:1,hwf:!0});return r.append(i),n?n.progressBar=s:s.start(),r},CreatePathProcessRow:function(e,t,n){var r=$("<div>").addClass("progressRow").css({"padding-top":"65px"}),i=$("<div>").addClass("progress").css({"float":"left","padding-right":"20px","margin-left":"90px"}),s=i.c3progress(t,{max:100,width:420,height:24,swf:!0,async:1,hwf:!0,showError:!0});r.append(i);var o=$("<div>").append(e).addClass("name").css({"padding-left":"20px","padding-top":"10px"});return r.append(o),n&&(n.progressBar=s,n.title=o),s.start(),r},CreateProcessRow:function(e,t){var n=$("<div>").css({"padding-top":"15px"}),r=$("<div>").css({"float":"right","padding-right":"20px"}),i=r.c3progressWithStatus(e,{max:100,width:390,height:24,swf:!0,async:1,hwf:!0});return n.append(r),t&&(t.progressBar=i),i.start(),n},CreateExtProcessRow:function(e,t,n){var r=$("<div>").addClass("progressRow"),i=$("<div>").addClass("progress").css({visibility:"hidden"}),s=i.c3progress(t,{max:100,swf:!0,async:1,hwf:!0,showError:!0,dur:c3config.Clocker-3,visibility:"hidden"});r.append(i);var o=$("<div>").append(e).addClass("name");return r.append(o),n&&(n.progressBar=s,n.title=o),s.start(),r},CreateTipBoard:function(e,t,n,r){var i=$("<span>"),s=$("<a href='#'>").append("Create");r==undefined?i.append("No "+e+"s currently exist. "):i.append(r),s.click(function(){t&&t()});if(t!=null&&typeof t=="function"||n==0)i.append(s),i.append(" a new "+e+".");return i},CreateDate:function(e,t,n,r){var i=$("<div>"),s=new textbox({isRequired:r});return i.append(s.bind("keydown",function(e){e.preventDefault()}).datepicker({onSelect:function(t,n){e[fieldName]=$.datepicker.formatDate("yymmdd",new Date(t))}})),t&&(t.datebox=s),i},CreateDateFromTo:function(e,t){var n=arguments[2],r=arguments[3],i=arguments[4],s=$("<div>");s.append("From");var o=new textbox({isRequired:i==undefined?!0:i,isReadonly:!0});s.append(o.bind("click",function(e){e.preventDefault()}).datepicker({onSelect:function(t,r){n!==undefined?e[n]=$.datepicker.formatDate("yymmdd",new Date(t)):e.PStart=$.datepicker.formatDate("yymmdd",new Date(t))}})),s.append("To");var u=new textbox({isRequired:i==undefined?!0:i,isReadonly:!0});return s.append(u.bind("click",function(e){e.preventDefault()}).datepicker({onSelect:function(t,n){r!==undefined?e[r]=$.datepicker.formatDate("yymmdd",new Date(t)):e.PEnd=$.datepicker.formatDate("yymmdd",new Date(t))}})),t&&(t.frombox=o,t.tobox=u),s},JoinTasks:function(e,t){for(var n=0,r=e.length;n<r;n++)0==n&&e[n].progressBar.start(),n<r-1?e[n].progressBar.finishEvent.push(function(e){return function(t){e.progressBar.start()}}(e[n+1])):e[n].progressBar.finishEvent.push(function(e){return function(e){t&&t()}}(e[n]))},logTaskError:function(e){var t={},n=e.ErrorCode,r=e.ResultDescription;for(var i=0,s=e.TaskParameters.length;i<s;i++){var o=e.TaskParameters[i];t[o.Name]=o.Value}ui.log.addLog(new ui.logLine(n,r,{settings:{data:t}},new Date,logType.Error))},logError:function(e){var t=JSON.parse(e).error;ui.log.addLog(new ui.logLine(t.code,t.message.value,{settings:{data:null}},new Date,logType.Error))},startupModeTextKey:function(e){switch(e){case"Default":return"MISC_DEFAULT";case"Manual":return"MISC_MANUAL";case"Mandatory":return"MISC_MANDATORY";case"Disabled":return"MISC_DISABLED";case"Automatic":return"MISC_AUTOMATIC"}},MasterTableHeight:180,DetailTableHeight:180,SplitPage:!0},base64Chars=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/","="];window.alert=function(e){var t=$("<div>");t.append($("<span>").css({"line-height":"25px"}).append('<span title="'+e+'">'+e+"</span>"));var n=0,r=200;e.length&&(n=e.length,r=(n/40+1)*30+80);var i=MessageBox.show({msg:t,width:350,height:r,icon:MessageBoxIcon.INFORMATION,buttons:MessageBoxButton.OK})},function(e){function t(e){var t=document.cookie.match(e+"=([^;]*)");return t!==null?unescape(t[1]):undefined}function n(e,t,n){var r=new Date;r.setDate(r.getDate()+n);var i=escape(t)+(n==null?"":"; path=/; expires="+r.toUTCString());document.cookie=e+"="+i}var r=["SAMLRequest","RelayState","SAMLRedirect"],i=[];e.SAML={names:r,values:i};for(var s=0;s<r.length;s++)i.push(t(r[s])),n(r[s],"",-1)}(window),MouseButton=Object.freeze({leftMouseBtn:1,middleMouseBtn:2,rightMouseBtn:3}),ServerType=Object.freeze({MSSQL_SERVER:"MSSQL",HANA_SERVER:"HANADB"}),function(){"use strict";window.monitorUtil={available:0,warning:10,serviceError:20,serviceNotReach:30,infraNotReach:40,unknown:5,statusPreparation:function(e,t,n){n.monitorStatusCode===monitorUtil.available?(e.text=localizedString("MONITOR_STATUS_AVAILABLE"),e.className="Moni_avail",n.MonitorStatus=localizedString("MONITOR_STATUS_AVAILABLE"),n.AvailableStatus_result=localizedString("MONITOR_STATUS_AVAILABLE")):n.monitorStatusCode===monitorUtil.warning?(e.text=localizedString("MONITOR_STATUS_WARNING"),e.className="Moni_warning",n.MonitorStatus=localizedString("MONITOR_STATUS_WARNING"),n.AvailableStatus_result=localizedString("MONITOR_STATUS_WARNING")):n.monitorStatusCode===monitorUtil.serviceError?(e.text=localizedString("MONITOR_STATUS_NOT_AVAILABLE"),e.className="Moni_not_avail",n.MonitorStatus=localizedString("MONITOR_STATUS_NOT_AVAILABLE"),n.AvailableStatus_result=localizedString("MONITOR_STATUS_NOT_AVAILABLE")):n.monitorStatusCode===monitorUtil.serviceNotReach?(e.className="Moni_not_reach",e.text=localizedString("MONITOR_STATUS_NOT_REACH"),n.MonitorStatus=localizedString("MONITOR_STATUS_NOT_REACH"),n.AvailableStatus_result=localizedString("MONITOR_STATUS_NOT_REACH")):n.monitorStatusCode===monitorUtil.infraNotReach?(e.className="Moni_inf_not_reach",e.text=localizedString("MONITOR_STATUS_INF_NOT_REACH"),n.MonitorStatus=localizedString("MONITOR_STATUS_INF_NOT_REACH"),n.AvailableStatus_result=localizedString("MONITOR_STATUS_INF_NOT_REACH")):(e.className="Moni_unknown",e.text=localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE"),e.tip=localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE"),n.MonitorStatus=localizedString("MONITOR_STATUS_UNKNOWN"),n.AvailableStatus_result=localizedString("MONITOR_STATUS_UNKNOWN"))},buildMessageList:function(e){var t=[];if(e.length===0){var n=monitorUtil.getStatusClass(monitorUtil.unknown),r=localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE");t.push({statusClass:n,message:r})}else{e.sort(function(e,t){return t.Level-e.Level});for(var i=0;i<e.length;i++){if(e[i].Level!==undefined){var n=monitorUtil.getStatusClass(e[i].Level),r;e[i].Level===monitorUtil.unknown&&e[i].Content===undefined?r=localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE"):r=e[i].Content}else{var n=monitorUtil.getStatusClass(e[i].monitorStatusCode),r;e[i].monitorStatusCode===monitorUtil.unknown&&e[i].Content===undefined?r=localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE"):r=e[i].Content}t.push({statusClass:n,message:r})}}return t},getStatusClass:function(e){return e===monitorUtil.available?"Moni_avail":e===monitorUtil.warning?"Moni_warning":e===monitorUtil.serviceError?"Moni_not_avail":e===monitorUtil.serviceNotReach?"Moni_not_reach":e===monitorUtil.infraNotReach?"Moni_inf_not_reach":"Moni_unknown"},getMonitorIcon:function(e){var t=$("<label>").addClass("ShowIcon"),n=monitorUtil.getStatusClass(e);return t.addClass(n)},replaceStatus:function(e){return e===localizedString("MONITOR_STATUS_AVAILABLE")?localizedString("MONITOR_STATUS_AVAILABLE"):e===localizedString("MONITOR_STATUS_WARNING")?localizedString("MONITOR_STATUS_WARNING"):e===localizedString("MONITOR_STATUS_NOT_AVAILABLE")?localizedString("MONITOR_STATUS_NOT_AVAILABLE"):e===localizedString("MONITOR_STATUS_NOT_REACH")?localizedString("MONITOR_STATUS_NOT_REACH"):e===localizedString("MONITOR_STATUS_INF_NOT_REACH")?localizedString("MONITOR_STATUS_INF_NOT_REACH"):localizedString("MONITOR_STATUS_UNKNOWN")},retrieveLicenseMonitorStatus:function(e,t,n){c3.service.getLicenseServerAvailableStatus(n,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o})}},error:function(e){monitorUtil.handleCommunicationError(t)}})},retrieveDBInstanceStatus:function(e,t,n){c3.service.getDBInstanceMonitorStatus(n,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o})}},error:function(e){monitorUtil.handleCommunicationError(t)}})},retrieveCommonDBMonitorStatus:function(e,t){c3.service.getCommonDBMonitorStatus(t.DatabaseInstance_Name,t.Name,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o})}},error:function(e){monitorUtil.handleCommunicationError(t)}})},retrievePresentationServerMonitorStatus:function(e,t){c3.service.getPresentationServerMonitorStatus(t.Machine_Hostname,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o})}},error:function(e){monitorUtil.handleCommunicationError(t)}})},retrieveBrowserAccessServerMonitorStatus:function(e,t){c3.service.getBrowserAccessServerMonitorStatus(t.Machine_Hostname,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o})}},error:function(e){monitorUtil.handleCommunicationError(t)}})},retrieveSharedFolderMonitorStatus:function(e,t,n){var r;n==="SoftwareRepository"?r=t.RootURI:n==="usersStorage"?r=t.UNC:r=t.URI,c3.service.getSharedFolderMonitorStatus(r,n,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o})}},error:function(e){monitorUtil.handleCommunicationError(t)}})},retrieveB1IMonitorStatus:function(e,t){c3.service.getB1IMonitorStatus(t.ID,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o})}},error:function(e){monitorUtil.handleCommunicationError(t)}})},retrieveXAppMonitorStatus:function(e,t){c3.service.getXAppMonitorStatus(t.ID,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o})}},error:function(e){monitorUtil.handleCommunicationError(t)}})},retrieveB1AMonitorStatus:function(e,t){c3.service.getB1AMonitorStatus(t.ID,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o})}},error:function(e){monitorUtil.handleCommunicationError(t)}})},retrieveSUMonitorStatus:function(e,t){c3.service.getMonitorStatusBySuID(t.ID,{success:function(n){if(n.d.results){var r=$(e),i={},s=n.d.results[0];r.children("label").remove(),r.unbind("mouseover"),r.trigger("mouseout"),i.textalign="center";var o=[];o=monitorUtil.buildMessageList(s.Messages.results),t.monitorStatusCode=s.StatusCode,monitorUtil.statusPreparation(i,s.Status,t);var u=(new statusControl(i)).children("label");r.append(u),r.c3tip({messageList:o})}},error:function(e){monitorUtil.handleCommunicationError(t)}})},handleCommunicationError:function(e){if(e!==undefined)if(e.comstructor===Array)for(var t=0;t<e.length;t++){e[t].MonitorStatus=localizedString("MONITOR_STATUS_UNKNOWN"),e[t].monitorStatusCode=5;var n=[];n.push({statusClass:"Moni_unknown",message:localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE")}),e[t].monitorMessageList=n}else{e.MonitorStatus=localizedString("MONITOR_STATUS_UNKNOWN"),e.monitorStatusCode=5;var n=[];n.push({statusClass:"Moni_unknown",message:localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE")}),e.monitorMessageList=n}},retrieveSLDMonitorStatus:function(e){$.c3BaseClient.callNormalService("GET","SLDStatusCheck","",e)}}}(),Raphael=function(){function e(){if(e.is(arguments[0],k)){var t=arguments[0],r=Bt[l](e,t.splice(0,3+e.is(t[0],N))),i=r.set();for(var s=0,o=t[w];s<o;s++){var u=t[s]||{};n.test(u.type)&&i[D](r[u.type]().attr(u))}return i}return Bt[l](e,arguments)}function Z(e,t,n){function s(){var o=Array[r].slice.call(arguments,0),u=o[b](""),a=s.cache=s.cache||{},f=s.count=s.count||[];return a[i](u)?n?n(a[u]):a[u]:(f[w]>=1e3&&delete a[f.shift()],f[D](u),a[u]=e[l](t,o),n?n(a[u]):a[u])}return s}function en(){return this.x+d+this.y}function hn(t){return function(n,r,i,s){var o={back:t};return e.is(i,"function")?s=i:o.rot=i,n&&n.constructor==At&&(n=n.attrs.path),n&&(o.along=n),this.animate(o,r,s)}}e.version="1.4.4";var t=/[, ]+/,n=/^(circle|rect|path|ellipse|text|image)$/,r="prototype",i="hasOwnProperty",s=document,o=window,u={was:Object[r][i].call(o,"Raphael"),is:o.Raphael},a=function(){},f="appendChild",l="apply",c="concat",h="createTouch"in s,p="",d=" ",v=String,m="split",g="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend orientationchange touchcancel gesturestart gesturechange gestureend"[m](d),y={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},b="join",w="length",E=String[r].toLowerCase,S=Math,x=S.max,T=S.min,N="number",C="string",k="array",L="toString",A="fill",O=Object[r][L],M={},_=S.pow,D="push",P=/^(?=[\da-f]$)/,H=/^url\(['"]?([^\)]+?)['"]?\)$/i,B=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+\s*,\s*[\d\.]+\s*,\s*[\d\.]+(?:\s*,\s*[\d\.]+)?)\s*\)|rgba?\(\s*([\d\.]+%\s*,\s*[\d\.]+%\s*,\s*[\d\.]+%(?:\s*,\s*[\d\.]+%))\s*\)|hs[bl]\(\s*([\d\.]+\s*,\s*[\d\.]+\s*,\s*[\d\.]+)\s*\)|hs[bl]\(\s*([\d\.]+%\s*,\s*[\d\.]+%\s*,\s*[\d\.]+%)\s*\))\s*$/i,j=S.round,F="setAttribute",I=parseFloat,q=parseInt,R=" progid:DXImageTransform.Microsoft",U=String[r].toUpperCase,z={blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},W={along:"along",blur:N,"clip-rect":"csv",cx:N,cy:N,fill:"colour","fill-opacity":N,"font-size":N,height:N,opacity:N,path:"path",r:N,rotation:"csv",rx:N,ry:N,scale:"csv",stroke:"colour","stroke-opacity":N,"stroke-width":N,translation:"csv",width:N,x:N,y:N},X="replace";e.type=o.SVGAngle||s.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if(e.type=="VML"){var V=s.createElement("div");V.innerHTML="<!--[if vml]><br><br><![endif]-->";if(V.childNodes[w]!=2)return e.type=null;V=null}e.svg=!(e.vml=e.type=="VML"),a[r]=e[r],e._id=0,e._oid=0,e.fn={},e.is=function(e,t){return t=E.call(t),t=="object"&&e===Object(e)||t=="undefined"&&typeof e==t||t=="null"&&e==null||E.call(O.call(e).slice(8,-1))==t},e.setWindow=function(e){o=e,s=o.document};var $=function(t){if(e.vml){var n=/^\s+|\s+$/g;$=Z(function(e){var t;e=v(e)[X](n,p);try{var r=new o.ActiveXObject("htmlfile");r.write("<body>"),r.close(),t=r.body}catch(i){t=o.createPopup().document.body}var s=t.createTextRange();try{t.style.color=e;var u=s.queryCommandValue("ForeColor");return u=(u&255)<<16|u&65280|(u&16711680)>>>16,"#"+("000000"+u[L](16)).slice(-6)}catch(i){return"none"}})}else{var r=s.createElement("i");r.title="Raphal Colour Picker",r.style.display="none",s.body[f](r),$=Z(function(e){return r.style.color=e,s.defaultView.getComputedStyle(r,p).getPropertyValue("color")})}return $(t)},J=function(){return"hsb("+[this.h,this.s,this.b]+")"},K=function(){return this.hex};e.hsb2rgb=Z(function(t,n,r){e.is(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(r=t.b,n=t.s,t=t.h);var i,s,o;if(r==0)return{r:0,g:0,b:0,hex:"#000"};if(t>1||n>1||r>1)t/=255,n/=255,r/=255;var u=~~(t*6),a=t*6-u,f=r*(1-n),l=r*(1-n*a),c=r*(1-n*(1-a));i=[r,l,f,f,c,r,r][u],s=[c,r,r,l,f,f,c][u],o=[f,f,c,r,r,l,f][u],i*=255,s*=255,o*=255;var h={r:i,g:s,b:o,toString:K},p=(~~i)[L](16),d=(~~s)[L](16),v=(~~o)[L](16);return p=p[X](P,"0"),d=d[X](P,"0"),v=v[X](P,"0"),h.hex="#"+p+d+v,h},e),e.rgb2hsb=Z(function(t,n,r){e.is(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(r=t.b,n=t.g,t=t.r);if(e.is(t,C)){var i=e.getRGB(t);t=i.r,n=i.g,r=i.b}if(t>1||n>1||r>1)t/=255,n/=255,r/=255;var s=x(t,n,r),o=T(t,n,r),u,a,f=s;if(o==s)return{h:0,s:0,b:s};var l=s-o;return a=l/s,t==s?u=(n-r)/l:n==s?u=2+(r-t)/l:u=4+(t-n)/l,u/=6,u<0&&u++,u>1&&u--,{h:u,s:a,b:f,toString:J}},e);var Q=/,?([achlmqrstvxz]),?/gi,G=/\s*,\s*/,Y={hs:1,rg:1};e._path2string=function(){return this.join(",")[X](Q,"$1")},e.getRGB=Z(function(t){if(!t||!!((t=v(t)).indexOf("-")+1))return{r:-1,g:-1,b:-1,hex:"none",error:1};if(t=="none")return{r:-1,g:-1,b:-1,hex:"none"};!Y[i](t.substring(0,2))&&t.charAt()!="#"&&(t=$(t));var n,r,s,o,u,a,f=t.match(B);if(f){f[2]&&(o=q(f[2].substring(5),16),s=q(f[2].substring(3,5),16),r=q(f[2].substring(1,3),16)),f[3]&&(o=q((a=f[3].charAt(3))+a,16),s=q((a=f[3].charAt(2))+a,16),r=q((a=f[3].charAt(1))+a,16)),f[4]&&(f=f[4][m](G),r=I(f[0]),s=I(f[1]),o=I(f[2]),u=I(f[3])),f[5]&&(f=f[5][m](G),r=I(f[0])*2.55,s=I(f[1])*2.55,o=I(f[2])*2.55,u=I(f[3]));if(f[6])return f=f[6][m](G),r=I(f[0]),s=I(f[1]),o=I(f[2]),e.hsb2rgb(r,s,o);if(f[7])return f=f[7][m](G),r=I(f[0])*2.55,s=I(f[1])*2.55,o=I(f[2])*2.55,e.hsb2rgb(r,s,o);f={r:r,g:s,b:o};var l=(~~r)[L](16),c=(~~s)[L](16),h=(~~o)[L](16);return l=l[X](P,"0"),c=c[X](P,"0"),h=h[X](P,"0"),f.hex="#"+l+c+h,isFinite(I(u))&&(f.o=u),f}return{r:-1,g:-1,b:-1,hex:"none",error:1}},e),e.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},n=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),n.hex},e.getColor.reset=function(){delete this.start};var et=/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/ig,tt=/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/ig;e.parsePathString=Z(function(t){if(!t)return null;var n={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=[];return e.is(t,k)&&e.is(t[0],k)&&(r=rt(t)),r[w]||v(t)[X](et,function(e,t,i){var s=[],o=E.call(t);i[X](tt,function(e,t){t&&s[D](+t)}),o=="m"&&s[w]>2&&(r[D]([t][c](s.splice(0,2))),o="l",t=t=="m"?"l":"L");while(s[w]>=n[o]){r[D]([t][c](s.splice(0,n[o])));if(!n[o])break}}),r[L]=e._path2string,r}),e.findDotsAtSegment=function(e,t,n,r,i,s,o,u,a){var f=1-a,l=_(f,3)*e+_(f,2)*3*a*n+f*3*a*a*i+_(a,3)*o,c=_(f,3)*t+_(f,2)*3*a*r+f*3*a*a*s+_(a,3)*u,h=e+2*a*(n-e)+a*a*(i-2*n+e),p=t+2*a*(r-t)+a*a*(s-2*r+t),d=n+2*a*(i-n)+a*a*(o-2*i+n),v=r+2*a*(s-r)+a*a*(u-2*s+r),m=(1-a)*e+a*n,g=(1-a)*t+a*r,y=(1-a)*i+a*o,b=(1-a)*s+a*u,w=90-S.atan((h-d)/(p-v))*180/S.PI;return(h>d||p<v)&&(w+=180),{x:l,y:c,m:{x:h,y:p},n:{x:d,y:v},start:{x:m,y:g},end:{x:y,y:b},alpha:w}};var nt=Z(function(e){if(!e)return{x:0,y:0,width:0,height:0};e=ct(e);var t=0,n=0,r=[],i=[],s;for(var o=0,u=e[w];o<u;o++){s=e[o];if(s[0]=="M")t=s[1],n=s[2],r[D](t),i[D](n);else{var a=lt(t,n,s[1],s[2],s[3],s[4],s[5],s[6]);r=r[c](a.min.x,a.max.x),i=i[c](a.min.y,a.max.y),t=s[5],n=s[6]}}var f=T[l](0,r),h=T[l](0,i);return{x:f,y:h,width:x[l](0,r)-f,height:x[l](0,i)-h}}),rt=function(t){var n=[];if(!e.is(t,k)||!e.is(t&&t[0],k))t=e.parsePathString(t);for(var r=0,i=t[w];r<i;r++){n[r]=[];for(var s=0,o=t[r][w];s<o;s++)n[r][s]=t[r][s]}return n[L]=e._path2string,n},it=Z(function(t){if(!e.is(t,k)||!e.is(t&&t[0],k))t=e.parsePathString(t);var n=[],r=0,i=0,s=0,o=0,u=0;t[0][0]=="M"&&(r=t[0][1],i=t[0][2],s=r,o=i,u++,n[D](["M",r,i]));for(var a=u,f=t[w];a<f;a++){var l=n[a]=[],c=t[a];if(c[0]!=E.call(c[0])){l[0]=E.call(c[0]);switch(l[0]){case"a":l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=+(c[6]-r).toFixed(3),l[7]=+(c[7]-i).toFixed(3);break;case"v":l[1]=+(c[1]-i).toFixed(3);break;case"m":s=c[1],o=c[2];default:for(var h=1,p=c[w];h<p;h++)l[h]=+(c[h]-(h%2?r:i)).toFixed(3)}}else{l=n[a]=[],c[0]=="m"&&(s=c[1]+r,o=c[2]+i);for(var d=0,v=c[w];d<v;d++)n[a][d]=c[d]}var m=n[a][w];switch(n[a][0]){case"z":r=s,i=o;break;case"h":r+=+n[a][m-1];break;case"v":i+=+n[a][m-1];break;default:r+=+n[a][m-2],i+=+n[a][m-1]}}return n[L]=e._path2string,n},0,rt),st=Z(function(t){if(!e.is(t,k)||!e.is(t&&t[0],k))t=e.parsePathString(t);var n=[],r=0,i=0,s=0,o=0,u=0;t[0][0]=="M"&&(r=+t[0][1],i=+t[0][2],s=r,o=i,u++,n[0]=["M",r,i]);for(var a=u,f=t[w];a<f;a++){var l=n[a]=[],c=t[a];if(c[0]!=U.call(c[0])){l[0]=U.call(c[0]);switch(l[0]){case"A":l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=+(c[6]+r),l[7]=+(c[7]+i);break;case"V":l[1]=+c[1]+i;break;case"H":l[1]=+c[1]+r;break;case"M":s=+c[1]+r,o=+c[2]+i;default:for(var h=1,p=c[w];h<p;h++)l[h]=+c[h]+(h%2?r:i)}}else for(var d=0,v=c[w];d<v;d++)n[a][d]=c[d];switch(l[0]){case"Z":r=s,i=o;break;case"H":r=l[1];break;case"V":i=l[1];break;case"M":s=n[a][n[a][w]-2],o=n[a][n[a][w]-1];default:r=n[a][n[a][w]-2],i=n[a][n[a][w]-1]}}return n[L]=e._path2string,n},null,rt),ot=function(e,t,n,r){return[e,t,n,r,n,r]},ut=function(e,t,n,r,i,s){var o=1/3,u=2/3;return[o*e+u*n,o*t+u*r,o*i+u*n,o*s+u*r,i,s]},at=function(e,t,n,r,i,s,o,u,a,f){var l=S.PI,h=l*120/180,p=l/180*(+i||0),d=[],v,g=Z(function(e,t,n){var r=e*S.cos(n)-t*S.sin(n),i=e*S.sin(n)+t*S.cos(n);return{x:r,y:i}});if(!f){v=g(e,t,-p),e=v.x,t=v.y,v=g(u,a,-p),u=v.x,a=v.y;var y=S.cos(l/180*i),E=S.sin(l/180*i),x=(e-u)/2,T=(t-a)/2,N=x*x/(n*n)+T*T/(r*r);N>1&&(N=S.sqrt(N),n=N*n,r=N*r);var C=n*n,k=r*r,L=(s==o?-1:1)*S.sqrt(S.abs((C*k-C*T*T-k*x*x)/(C*T*T+k*x*x))),A=L*n*T/r+(e+u)/2,O=L*-r*x/n+(t+a)/2,M=S.asin(((t-O)/r).toFixed(7)),_=S.asin(((a-O)/r).toFixed(7));M=e<A?l-M:M,_=u<A?l-_:_,M<0&&(M=l*2+M),_<0&&(_=l*2+_),o&&M>_&&(M-=l*2),!o&&_>M&&(_-=l*2)}else M=f[0],_=f[1],A=f[2],O=f[3];var D=_-M;if(S.abs(D)>h){var P=_,H=u,B=a;_=M+h*(o&&_>M?1:-1),u=A+n*S.cos(_),a=O+r*S.sin(_),d=at(u,a,n,r,i,0,o,H,B,[_,P,A,O])}D=_-M;var j=S.cos(M),F=S.sin(M),I=S.cos(_),q=S.sin(_),R=S.tan(D/4),U=4/3*n*R,z=4/3*r*R,W=[e,t],X=[e+U*F,t-z*j],V=[u+U*q,a-z*I],$=[u,a];X[0]=2*W[0]-X[0],X[1]=2*W[1]-X[1];if(f)return[X,V,$][c](d);d=[X,V,$][c](d)[b]()[m](",");var J=[];for(var K=0,Q=d[w];K<Q;K++)J[K]=K%2?g(d[K-1],d[K],p).y:g(d[K],d[K+1],p).x;return J},ft=function(e,t,n,r,i,s,o,u,a){var f=1-a;return{x:_(f,3)*e+_(f,2)*3*a*n+f*3*a*a*i+_(a,3)*o,y:_(f,3)*t+_(f,2)*3*a*r+f*3*a*a*s+_(a,3)*u}},lt=Z(function(e,t,n,r,i,s,o,u){var a=i-2*n+e-(o-2*i+n),f=2*(n-e)-2*(i-n),c=e-n,h=(-f+S.sqrt(f*f-4*a*c))/2/a,p=(-f-S.sqrt(f*f-4*a*c))/2/a,d=[t,u],v=[e,o],m;return S.abs(h)>1e12&&(h=.5),S.abs(p)>1e12&&(p=.5),h>0&&h<1&&(m=ft(e,t,n,r,i,s,o,u,h),v[D](m.x),d[D](m.y)),p>0&&p<1&&(m=ft(e,t,n,r,i,s,o,u,p),v[D](m.x),d[D](m.y)),a=s-2*r+t-(u-2*s+r),f=2*(r-t)-2*(s-r),c=t-r,h=(-f+S.sqrt(f*f-4*a*c))/2/a,p=(-f-S.sqrt(f*f-4*a*c))/2/a,S.abs(h)>1e12&&(h=.5),S.abs(p)>1e12&&(p=.5),h>0&&h<1&&(m=ft(e,t,n,r,i,s,o,u,h),v[D](m.x),d[D](m.y)),p>0&&p<1&&(m=ft(e,t,n,r,i,s,o,u,p),v[D](m.x),d[D](m.y)),{min:{x:T[l](0,v),y:T[l](0,d)},max:{x:x[l](0,v),y:x[l](0,d)}}}),ct=Z(function(e,t){var n=st(e),r=t&&st(t),i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=function(e,t){var n,r;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null);switch(e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"][c](at[l](0,[t.x,t.y][c](e.slice(1))));break;case"S":n=t.x+(t.x-(t.bx||t.x)),r=t.y+(t.y-(t.by||t.y)),e=["C",n,r][c](e.slice(1));break;case"T":t.qx=t.x+(t.x-(t.qx||t.x)),t.qy=t.y+(t.y-(t.qy||t.y)),e=["C"][c](ut(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"][c](ut(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"][c](ot(t.x,t.y,e[1],e[2]));break;case"H":e=["C"][c](ot(t.x,t.y,e[1],t.y));break;case"V":e=["C"][c](ot(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"][c](ot(t.x,t.y,t.X,t.Y))}return e},u=function(e,t){if(e[t][w]>7){e[t].shift();var i=e[t];while(i[w])e.splice(t++,0,["C"][c](i.splice(0,6)));e.splice(t,1),h=x(n[w],r&&r[w]||0)}},a=function(e,t,i,s,o){e&&t&&e[o][0]=="M"&&t[o][0]!="M"&&(t.splice(o,0,["M",s.x,s.y]),i.bx=0,i.by=0,i.x=e[o][1],i.y=e[o][2],h=x(n[w],r&&r[w]||0))};for(var f=0,h=x(n[w],r&&r[w]||0);f<h;f++){n[f]=o(n[f],i),u(n,f),r&&(r[f]=o(r[f],s)),r&&u(r,f),a(n,r,i,s,f),a(r,n,s,i,f);var p=n[f],d=r&&r[f],v=p[w],m=r&&d[w];i.x=p[v-2],i.y=p[v-1],i.bx=I(p[v-4])||i.x,i.by=I(p[v-3])||i.y,s.bx=r&&(I(d[m-4])||s.x),s.by=r&&(I(d[m-3])||s.y),s.x=r&&d[m-2],s.y=r&&d[m-1]}return r?[n,r]:n},null,rt),ht=Z(function(t){var n=[];for(var r=0,i=t[w];r<i;r++){var s={},o=t[r].match(/^([^:]*):?([\d\.]*)/);s.color=e.getRGB(o[1]);if(s.color.error)return null;s.color=s.color.hex,o[2]&&(s.offset=o[2]+"%"),n[D](s)}for(r=1,i=n[w]-1;r<i;r++)if(!n[r].offset){var u=I(n[r-1].offset||0),a=0;for(var f=r+1;f<i;f++)if(n[f].offset){a=n[f].offset;break}a||(a=100,f=i),a=I(a);var l=(a-u)/(f-r+1);for(;r<f;r++)u+=l,n[r].offset=u+"%"}return n}),pt=function(t,n,r,i){var o;if(!e.is(t,C)&&!e.is(t,"object"))return{container:1,x:t,y:n,width:r,height:i};o=e.is(t,C)?s.getElementById(t):t;if(o.tagName)return n==null?{container:o,width:o.style.pixelWidth||o.offsetWidth,height:o.style.pixelHeight||o.offsetHeight}:{container:o,width:n,height:r}},dt=function(e,t){var n=this;for(var r in t)if(t[i](r)&&!(r in e))switch(typeof t[r]){case"function":(function(t){e[r]=e===n?t:function(){return t[l](n,arguments)}})(t[r]);break;case"object":e[r]=e[r]||{},dt.call(this,e[r],t[r]);break;default:e[r]=t[r]}},vt=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)},mt=function(e,t){if(t.top===e)return;vt(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e},gt=function(e,t){if(t.bottom===e)return;vt(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e},yt=function(e,t,n){vt(e,n),t==n.top&&(n.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},bt=function(e,t,n){vt(e,n),t==n.bottom&&(n.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},wt=function(e){return function(){throw new Error("Raphal: you are calling to method "+e+" of removed object")}},Et=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/;e.pathToRelative=it;if(e.svg){a[r].svgns="http://www.w3.org/2000/svg",a[r].xlink="http://www.w3.org/1999/xlink",j=function(e){return+e+(~~e===e)*.5};var St=function(e,t){if(!t)return e=s.createElementNS(a[r].svgns,e),e.style.webkitTapHighlightColor="rgba(0,0,0,0)",e;for(var n in t)t[i](n)&&e[F](n,v(t[n]))};e[L]=function(){return"Your browser supports SVG.\nYou are running Raphal "+this.version};var xt=function(e,t){var n=St("path");t.canvas&&t.canvas[f](n);var r=new At(n,t);return r.type="path",Ct(r,{fill:"none",stroke:"#000",path:e}),r},Tt=function(t,n,r){var i="linear",o=.5,u=.5,a=t.style;n=v(n)[X](Et,function(e,t,n){i="radial";if(t&&n){o=I(t),u=I(n);var r=(u>.5)*2-1;_(o-.5,2)+_(u-.5,2)>.25&&(u=S.sqrt(.25-_(o-.5,2))*r+.5)&&u!=.5&&(u=u.toFixed(5)-1e-5*r)}return p}),n=n[m](/\s*\-\s*/);if(i=="linear"){var l=n.shift();l=-I(l);if(isNaN(l))return null;var c=[0,0,S.cos(l*S.PI/180),S.sin(l*S.PI/180)],h=1/(x(S.abs(c[2]),S.abs(c[3]))||1);c[2]*=h,c[3]*=h,c[2]<0&&(c[0]=-c[2],c[2]=0),c[3]<0&&(c[1]=-c[3],c[3]=0)}var d=ht(n);if(!d)return null;var g=t.getAttribute(A);g=g.match(/^url\(#(.*)\)$/),g&&r.defs.removeChild(s.getElementById(g[1]));var y=St(i+"Gradient");y.id="r"+(e._id++)[L](36),St(y,i=="radial"?{fx:o,fy:u}:{x1:c[0],y1:c[1],x2:c[2],y2:c[3]}),r.defs[f](y);for(var b=0,E=d[w];b<E;b++){var T=St("stop");St(T,{offset:d[b].offset?d[b].offset:b?"100%":"0%","stop-color":d[b].color||"#fff"}),y[f](T)}return St(t,{fill:"url(#"+y.id+")",opacity:1,"fill-opacity":1}),a.fill=p,a.opacity=1,a.fillOpacity=1,1},Nt=function(t){var n=t.getBBox();St(t.pattern,{patternTransform:e.format("translate({0},{1})",n.x,n.y)})},Ct=function(n,r){var o={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},u=n.node,a=n.attrs,l=n.rotate(),c=function(e,t){t=o[E.call(t)];if(t){var n=e.attrs["stroke-width"]||"1",i={round:n,square:n,butt:0}[e.attrs["stroke-linecap"]||r["stroke-linecap"]]||0,s=[],a=t[w];while(a--)s[a]=t[a]*n+(a%2?1:-1)*i;St(u,{"stroke-dasharray":s[b](",")})}};r[i]("rotation")&&(l=r.rotation);var h=v(l)[m](t);h.length-1?(h[1]=+h[1],h[2]=+h[2]):h=null,I(l)&&n.rotate(0,!0);for(var g in r)if(r[i](g)){if(!z[i](g))continue;var y=r[g];a[g]=y;switch(g){case"blur":n.blur(y);break;case"rotation":n.rotate(y,!0);break;case"href":case"title":case"target":var S=u.parentNode;if(E.call(S.tagName)!="a"){var x=St("a");S.insertBefore(x,u),x[f](u),S=x}S.setAttributeNS(n.paper.xlink,g,y);break;case"cursor":u.style.cursor=y;break;case"clip-rect":var T=v(y)[m](t);if(T[w]==4){n.clip&&n.clip.parentNode.parentNode.removeChild(n.clip.parentNode);var N=St("clipPath"),C=St("rect");N.id="r"+(e._id++)[L](36),St(C,{x:T[0],y:T[1],width:T[2],height:T[3]}),N[f](C),n.paper.defs[f](N),St(u,{"clip-path":"url(#"+N.id+")"}),n.clip=C}if(!y){var k=s.getElementById(u.getAttribute("clip-path")[X](/(^url\(#|\)$)/g,p));k&&k.parentNode.removeChild(k),St(u,{"clip-path":p}),delete n.clip}break;case"path":n.type=="path"&&St(u,{d:y?a.path=st(y):"M0,0"});break;case"width":u[F](g,y);if(!a.fx)break;g="x",y=a.x;case"x":a.fx&&(y=-a.x-(a.width||0));case"rx":if(g=="rx"&&n.type=="rect")break;case"cx":h&&(g=="x"||g=="cx")&&(h[1]+=y-a[g]),u[F](g,j(y)),n.pattern&&Nt(n);break;case"height":u[F](g,y);if(!a.fy)break;g="y",y=a.y;case"y":a.fy&&(y=-a.y-(a.height||0));case"ry":if(g=="ry"&&n.type=="rect")break;case"cy":h&&(g=="y"||g=="cy")&&(h[2]+=y-a[g]),u[F](g,j(y)),n.pattern&&Nt(n);break;case"r":n.type=="rect"?St(u,{rx:y,ry:y}):u[F](g,y);break;case"src":n.type=="image"&&u.setAttributeNS(n.paper.xlink,"href",y);break;case"stroke-width":u.style.strokeWidth=y,u[F](g,y),a["stroke-dasharray"]&&c(n,a["stroke-dasharray"]);break;case"stroke-dasharray":c(n,y);break;case"translation":var O=v(y)[m](t);O[0]=+O[0]||0,O[1]=+O[1]||0,h&&(h[1]+=O[0],h[2]+=O[1]),cn.call(n,O[0],O[1]);break;case"scale":O=v(y)[m](t),n.scale(+O[0]||1,+O[1]||+O[0]||1,isNaN(I(O[2]))?null:+O[2],isNaN(I(O[3]))?null:+O[3]);break;case A:var M=v(y).match(H);if(M){N=St("pattern");var _=St("image");N.id="r"+(e._id++)[L](36),St(N,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),St(_,{x:0,y:0}),_.setAttributeNS(n.paper.xlink,"href",M[1]),N[f](_);var D=s.createElement("img");D.style.cssText="position:absolute;left:-9999em;top-9999em",D.onload=function(){St(N,{width:this.offsetWidth,height:this.offsetHeight}),St(_,{width:this.offsetWidth,height:this.offsetHeight}),s.body.removeChild(this),n.paper.safari()},s.body[f](D),D.src=M[1],n.paper.defs[f](N),u.style.fill="url(#"+N.id+")",St(u,{fill:"url(#"+N.id+")"}),n.pattern=N,n.pattern&&Nt(n);break}var P=e.getRGB(y);if(!P.error)delete r.gradient,delete a.gradient,!e.is(a.opacity,"undefined")&&e.is(r.opacity,"undefined")&&St(u,{opacity:a.opacity}),!e.is(a["fill-opacity"],"undefined")&&e.is(r["fill-opacity"],"undefined")&&St(u,{"fill-opacity":a["fill-opacity"]});else if(({circle:1,ellipse:1}[i](n.type)||v(y).charAt()!="r")&&Tt(u,y,n.paper)){a.gradient=y,a.fill="none";break}P[i]("o")&&St(u,{"fill-opacity":P.o/100});case"stroke":P=e.getRGB(y),u[F](g,P.hex),g=="stroke"&&P[i]("o")&&St(u,{"stroke-opacity":P.o/100});break;case"gradient":((({circle:1,ellipse:1}))[i](n.type)||v(y).charAt()!="r")&&Tt(u,y,n.paper);break;case"opacity":case"fill-opacity":if(a.gradient){var B=s.getElementById(u.getAttribute(A)[X](/^url\(#|\)$/g,p));if(B){var R=B.getElementsByTagName("stop");R[R[w]-1][F]("stop-opacity",y)}break};default:g=="font-size"&&(y=q(y,10)+"px");var W=g[X](/(\-.)/g,function(e){return U.call(e.substring(1))});u.style[W]=y,u[F](g,y)}}Lt(n,r),h?n.rotate(h.join(d)):I(l)&&n.rotate(l,!0)},kt=1.2,Lt=function(e,t){if(e.type!="text"||!(t[i]("text")||t[i]("font")||t[i]("font-size")||t[i]("x")||t[i]("y")))return;var n=e.attrs,r=e.node,o=r.firstChild?q(s.defaultView.getComputedStyle(r.firstChild,p).getPropertyValue("font-size"),10):10;if(t[i]("text")){n.text=t.text;while(r.firstChild)r.removeChild(r.firstChild);var u=v(t.text)[m]("\n");for(var a=0,l=u[w];a<l;a++)if(u[a]){var c=St("tspan");a&&St(c,{dy:o*kt,x:n.x}),c[f](s.createTextNode(u[a])),r[f](c)}}else{u=r.getElementsByTagName("tspan");for(a=0,l=u[w];a<l;a++)a&&St(u[a],{dy:o*kt,x:n.x})}St(r,{y:n.y});var h=e.getBBox(),d=n.y-(h.y+h.height/2);d&&isFinite(d)&&St(r,{y:n.y+d})},At=function(t,n){var r=0,i=0;this[0]=t,this.id=e._oid++,this.node=t,t.raphael=this,this.paper=n,this.attrs=this.attrs||{},this.transformations=[],this._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1},!n.bottom&&(n.bottom=this),this.prev=n.top,n.top&&(n.top.next=this),n.top=this,this.next=null};At[r].rotate=function(n,r,i){if(this.removed)return this;if(n==null)return this._.rt.cx?[this._.rt.deg,this._.rt.cx,this._.rt.cy][b](d):this._.rt.deg;var s=this.getBBox();return n=v(n)[m](t),n[w]-1&&(r=I(n[1]),i=I(n[2])),n=I(n[0]),r!=null?this._.rt.deg=n:this._.rt.deg+=n,i==null&&(r=null),this._.rt.cx=r,this._.rt.cy=i,r=r==null?s.x+s.width/2:r,i=i==null?s.y+s.height/2:i,this._.rt.deg?(this.transformations[0]=e.format("rotate({0} {1} {2})",this._.rt.deg,r,i),this.clip&&St(this.clip,{transform:e.format("rotate({0} {1} {2})",-this._.rt.deg,r,i)})):(this.transformations[0]=p,this.clip&&St(this.clip,{transform:p})),St(this.node,{transform:this.transformations[b](d)}),this},At[r].hide=function(){return!this.removed&&(this.node.style.display="none"),this},At[r].show=function(){return!this.removed&&(this.node.style.display=""),this},At[r].remove=function(){if(this.removed)return;vt(this,this.paper),this.node.parentNode.removeChild(this.node);for(var e in this)delete this[e];this.removed=!0},At[r].getBBox=function(){if(this.removed)return this;if(this.type=="path")return nt(this.attrs.path);if(this.node.style.display=="none"){this.show();var e=!0}var t={};try{t=this.node.getBBox()}catch(n){}finally{t=t||{}}if(this.type=="text"){t={x:t.x,y:Infinity,width:0,height:0};for(var r=0,i=this.node.getNumberOfChars();r<i;r++){var s=this.node.getExtentOfChar(r);s.y<t.y&&(t.y=s.y),s.y+s.height-t.y>t.height&&(t.height=s.y+s.height-t.y),s.x+s.width-t.x>t.width&&(t.width=s.x+s.width-t.x)}}return e&&this.hide(),t},At[r].attr=function(t,n){if(this.removed)return this;if(t==null){var r={};for(var s in this.attrs)this.attrs[i](s)&&(r[s]=this.attrs[s]);return this._.rt.deg&&(r.rotation=this.rotate()),(this._.sx!=1||this._.sy!=1)&&(r.scale=this.scale()),r.gradient&&r.fill=="none"&&(r.fill=r.gradient)&&delete r.gradient,r}if(n==null&&e.is(t,C))return t=="translation"?cn.call(this):t=="rotation"?this.rotate():t=="scale"?this.scale():t==A&&this.attrs.fill=="none"&&this.attrs.gradient?this.attrs.gradient:this.attrs[t];if(n==null&&e.is(t,k)){var o={};for(var u=0,a=t.length;u<a;u++)o[t[u]]=this.attr(t[u]);return o}if(n!=null){var f={};f[t]=n,Ct(this,f)}else t!=null&&e.is(t,"object")&&Ct(this,t);return this},At[r].toFront=function(){if(this.removed)return this;this.node.parentNode[f](this.node);var e=this.paper;return e.top!=this&&mt(this,e),this},At[r].toBack=function(){if(this.removed)return this;if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),gt(this,this.paper);var e=this.paper}return this},At[r].insertAfter=function(e){if(this.removed)return this;var t=e.node;return t.nextSibling?t.parentNode.insertBefore(this.node,t.nextSibling):t.parentNode[f](this.node),yt(this,e,this.paper),this},At[r].insertBefore=function(e){if(this.removed)return this;var t=e.node;return t.parentNode.insertBefore(this.node,t),bt(this,e,this.paper),this},At[r].blur=function(t){var n=this;if(+t!==0){var r=St("filter"),i=St("feGaussianBlur");n.attrs.blur=t,r.id="r"+(e._id++)[L](36),St(i,{stdDeviation:+t||1.5}),r.appendChild(i),n.paper.defs.appendChild(r),n._blur=r,St(n.node,{filter:"url(#"+r.id+")"})}else n._blur&&(n._blur.parentNode.removeChild(n._blur),delete n._blur,delete n.attrs.blur),n.node.removeAttribute("filter")};var Ot=function(e,t,n,r){t=j(t),n=j(n);var i=St("circle");e.canvas&&e.canvas[f](i);var s=new At(i,e);return s.attrs={cx:t,cy:n,r:r,fill:"none",stroke:"#000"},s.type="circle",St(i,s.attrs),s},Mt=function(e,t,n,r,i,s){t=j(t),n=j(n);var o=St("rect");e.canvas&&e.canvas[f](o);var u=new At(o,e);return u.attrs={x:t,y:n,width:r,height:i,r:s||0,rx:s||0,ry:s||0,fill:"none",stroke:"#000"},u.type="rect",St(o,u.attrs),u},_t=function(e,t,n,r,i){t=j(t),n=j(n);var s=St("ellipse");e.canvas&&e.canvas[f](s);var o=new At(s,e);return o.attrs={cx:t,cy:n,rx:r,ry:i,fill:"none",stroke:"#000"},o.type="ellipse",St(s,o.attrs),o},Dt=function(e,t,n,r,i,s){var o=St("image");St(o,{x:n,y:r,width:i,height:s,preserveAspectRatio:"none"}),o.setAttributeNS(e.xlink,"href",t),e.canvas&&e.canvas[f](o);var u=new At(o,e);return u.attrs={x:n,y:r,width:i,height:s,src:t},u.type="image",u},Pt=function(e,t,n,r){var i=St("text");St(i,{x:t,y:n,"text-anchor":"middle"}),e.canvas&&e.canvas[f](i);var s=new At(i,e);return s.attrs={x:t,y:n,"text-anchor":"middle",text:r+"	",font:z.font,stroke:"none",fill:"#000"},s.type="text",Ct(s,s.attrs),s},Ht=function(e,t){return this.width=e||this.width,this.height=t||this.height,this.canvas[F]("width",this.width),this.canvas[F]("height",this.height),this},Bt=function(){var t=pt[l](0,arguments),n=t&&t.container,r=t.x,i=t.y,o=t.width,u=t.height;if(!n)throw new Error("SVG container not found.");var c=St("svg");return r=r||0,i=i||0,o=o||512,u=u||342,St(c,{xmlns:"http://www.w3.org/2000/svg",version:1.1,width:o,height:u}),n==1?(c.style.cssText="position:absolute;left:"+r+"px;top:"+i+"px",s.body[f](c)):n.firstChild?n.insertBefore(c,n.firstChild):n[f](c),n=new a,n.width=o,n.height=u,n.canvas=c,dt.call(n,n,e.fn),n.clear(),n};a[r].clear=function(){var e=this.canvas;while(e.firstChild)e.removeChild(e.firstChild);this.bottom=this.top=null,(this.desc=St("desc"))[f](s.createTextNode("Created with Raphal")),e[f](this.desc),e[f](this.defs=St("defs"))},a[r].remove=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]=wt(e)}}if(e.vml){var jt={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},Ft=/([clmz]),?([^clmz]*)/gi,It=/-?[^,\s-]+/g,qt=1e3+d+1e3,Rt=10,Ut={path:1,rect:1},zt=function(e){var t=/[ahqstv]/ig,n=st;v(e).match(t)&&(n=ct),t=/[clmz]/g;if(n==st&&!v(e).match(t)){var r=v(e)[X](Ft,function(e,t,n){var r=[],i=E.call(t)=="m",s=jt[t];return n[X](It,function(e){i&&r[w]==2&&(s+=r+jt[t=="m"?"l":"L"],r=[]),r[D](j(e*Rt))}),s+r});return r}var i=n(e),s,o;r=[];for(var u=0,a=i[w];u<a;u++){s=i[u],o=E.call(i[u][0]),o=="z"&&(o="x");for(var f=1,l=s[w];f<l;f++)o+=j(s[f]*Rt)+(f!=l-1?",":p);r[D](o)}return r[b](d)};e[L]=function(){return"Your browser doesnt support SVG. Falling down to VML.\nYou are running Raphal "+this.version},xt=function(e,t){var n=Vt("group");n.style.cssText="position:absolute;left:0;top:0;width:"+t.width+"px;height:"+t.height+"px",n.coordsize=t.coordsize,n.coordorigin=t.coordorigin;var r=Vt("shape"),i=r.style;i.width=t.width+"px",i.height=t.height+"px",r.coordsize=qt,r.coordorigin=t.coordorigin,n[f](r);var s=new At(r,n,t),o={fill:"none",stroke:"#000"};return e&&(o.path=e),s.isAbsolute=!0,s.type="path",s.path=[],s.Path=p,Ct(s,o),t.canvas[f](n),s},Ct=function(n,r){n.attrs=n.attrs||{};var o=n.node,u=n.attrs,a=o.style,l,c=(r.x!=u.x||r.y!=u.y||r.width!=u.width||r.height!=u.height||r.r!=u.r)&&n.type=="rect",h=n;for(var d in r)r[i](d)&&(u[d]=r[d]);c&&(u.path=Xt(u.x,u.y,u.width,u.height,u.r),n.X=u.x,n.Y=u.y,n.W=u.width,n.H=u.height),r.href&&(o.href=r.href),r.title&&(o.title=r.title),r.target&&(o.target=r.target),r.cursor&&(a.cursor=r.cursor),"blur"in r&&n.blur(r.blur);if(r.path&&n.type=="path"||c)o.path=zt(u.path);r.rotation!=null&&n.rotate(r.rotation,!0),r.translation&&(l=v(r.translation)[m](t),cn.call(n,l[0],l[1]),n._.rt.cx!=null&&(n._.rt.cx+=+l[0],n._.rt.cy+=+l[1],n.setBox(n.attrs,l[0],l[1]))),r.scale&&(l=v(r.scale)[m](t),n.scale(+l[0]||1,+l[1]||+l[0]||1,+l[2]||null,+l[3]||null));if("clip-rect"in r){var g=v(r["clip-rect"])[m](t);if(g[w]==4){g[2]=+g[2]+ +g[0],g[3]=+g[3]+ +g[1];var y=o.clipRect||s.createElement("div"),b=y.style,E=o.parentNode;b.clip=e.format("rect({1}px {2}px {3}px {0}px)",g),o.clipRect||(b.position="absolute",b.top=0,b.left=0,b.width=n.paper.width+"px",b.height=n.paper.height+"px",E.parentNode.insertBefore(y,E),y[f](E),o.clipRect=y)}r["clip-rect"]||o.clipRect&&(o.clipRect.style.clip=p)}n.type=="image"&&r.src&&(o.src=r.src),n.type=="image"&&r.opacity&&(o.filterOpacity=R+".Alpha(opacity="+r.opacity*100+")",a.filter=(o.filterMatrix||p)+(o.filterOpacity||p)),r.font&&(a.font=r.font),r["font-family"]&&(a.fontFamily='"'+r["font-family"][m](",")[0][X](/^['"]+|['"]+$/g,p)+'"'),r["font-size"]&&(a.fontSize=r["font-size"]),r["font-weight"]&&(a.fontWeight=r["font-weight"]),r["font-style"]&&(a.fontStyle=r["font-style"]);if(r.opacity!=null||r["stroke-width"]!=null||r.fill!=null||r.stroke!=null||r["stroke-width"]!=null||r["stroke-opacity"]!=null||r["fill-opacity"]!=null||r["stroke-dasharray"]!=null||r["stroke-miterlimit"]!=null||r["stroke-linejoin"]!=null||r["stroke-linecap"]!=null){o=n.shape||o;var S=o.getElementsByTagName(A)&&o.getElementsByTagName(A)[0],x=!1;!S&&(x=S=Vt(A));if("fill-opacity"in r||"opacity"in r){var T=((+u["fill-opacity"]+1||2)-1)*((+u.opacity+1||2)-1)*((+e.getRGB(r.fill).o+1||2)-1);T<0&&(T=0),T>1&&(T=1),S.opacity=T}r.fill&&(S.on=!0);if(S.on==null||r.fill=="none")S.on=!1;if(S.on&&r.fill){var N=r.fill.match(H);N?(S.src=N[1],S.type="tile"):(S.color=e.getRGB(r.fill).hex,S.src=p,S.type="solid",e.getRGB(r.fill).error&&(h.type in{circle:1,ellipse:1}||v(r.fill).charAt()!="r")&&Tt(h,r.fill)&&(u.fill="none",u.gradient=r.fill))}x&&o[f](S);var C=o.getElementsByTagName("stroke")&&o.getElementsByTagName("stroke")[0],k=!1;!C&&(k=C=Vt("stroke"));if(r.stroke&&r.stroke!="none"||r["stroke-width"]||r["stroke-opacity"]!=null||r["stroke-dasharray"]||r["stroke-miterlimit"]||r["stroke-linejoin"]||r["stroke-linecap"])C.on=!0;(r.stroke=="none"||C.on==null||r.stroke==0||r["stroke-width"]==0)&&(C.on=!1);var L=e.getRGB(r.stroke);C.on&&r.stroke&&(C.color=L.hex),T=((+u["stroke-opacity"]+1||2)-1)*((+u.opacity+1||2)-1)*((+L.o+1||2)-1);var O=(I(r["stroke-width"])||1)*.75;T<0&&(T=0),T>1&&(T=1),r["stroke-width"]==null&&(O=u["stroke-width"]),r["stroke-width"]&&(C.weight=O),O&&O<1&&(T*=O)&&(C.weight=1),C.opacity=T,r["stroke-linejoin"]&&(C.joinstyle=r["stroke-linejoin"]||"miter"),C.miterlimit=r["stroke-miterlimit"]||8,r["stroke-linecap"]&&(C.endcap=r["stroke-linecap"]=="butt"?"flat":r["stroke-linecap"]=="square"?"square":"round");if(r["stroke-dasharray"]){var M={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};C.dashstyle=M[i](r["stroke-dasharray"])?M[r["stroke-dasharray"]]:p}k&&o[f](C)}if(h.type=="text"){a=h.paper.span.style,u.font&&(a.font=u.font),u["font-family"]&&(a.fontFamily=u["font-family"]),u["font-size"]&&(a.fontSize=u["font-size"]),u["font-weight"]&&(a.fontWeight=u["font-weight"]),u["font-style"]&&(a.fontStyle=u["font-style"]),h.node.string&&(h.paper.span.innerHTML=v(h.node.string)[X](/</g,"&#60;")[X](/&/g,"&#38;")[X](/\n/g,"<br>")),h.W=u.w=h.paper.span.offsetWidth,h.H=u.h=h.paper.span.offsetHeight,h.X=u.x,h.Y=u.y+j(h.H/2);switch(u["text-anchor"]){case"start":h.node.style["v-text-align"]="left",h.bbx=j(h.W/2);break;case"end":h.node.style["v-text-align"]="right",h.bbx=-j(h.W/2);break;default:h.node.style["v-text-align"]="center"}}},Tt=function(e,t){e.attrs=e.attrs||{};var n=e.attrs,r,i="linear",s=".5 .5";e.attrs.gradient=t,t=v(t)[X](Et,function(e,t,n){return i="radial",t&&n&&(t=I(t),n=I(n),_(t-.5,2)+_(n-.5,2)>.25&&(n=S.sqrt(.25-_(t-.5,2))*((n>.5)*2-1)+.5),s=t+d+n),p}),t=t[m](/\s*\-\s*/);if(i=="linear"){var o=t.shift();o=-I(o);if(isNaN(o))return null}var u=ht(t);if(!u)return null;e=e.shape||e.node,r=e.getElementsByTagName(A)[0]||Vt(A),!r.parentNode&&e.appendChild(r);if(u[w]){r.on=!0,r.method="none",r.color=u[0].color,r.color2=u[u[w]-1].color;var a=[];for(var f=0,l=u[w];f<l;f++)u[f].offset&&a[D](u[f].offset+d+u[f].color);r.colors&&(r.colors.value=a[w]?a[b]():"0% "+r.color),i=="radial"?(r.type="gradientradial",r.focus="100%",r.focussize=s,r.focusposition=s):(r.type="gradient",r.angle=(270-o)%360)}return 1},At=function(t,n,r){var i=0,s=0,o=0,u=1;this[0]=t,this.id=e._oid++,this.node=t,t.raphael=this,this.X=0,this.Y=0,this.attrs={},this.Group=n,this.paper=r,this._={tx:0,ty:0,rt:{deg:0},sx:1,sy:1},!r.bottom&&(r.bottom=this),this.prev=r.top,r.top&&(r.top.next=this),r.top=this,this.next=null},At[r].rotate=function(e,n,r){return this.removed?this:e==null?this._.rt.cx?[this._.rt.deg,this._.rt.cx,this._.rt.cy][b](d):this._.rt.deg:(e=v(e)[m](t),e[w]-1&&(n=I(e[1]),r=I(e[2])),e=I(e[0]),n!=null?this._.rt.deg=e:this._.rt.deg+=e,r==null&&(n=null),this._.rt.cx=n,this._.rt.cy=r,this.setBox(this.attrs,n,r),this.Group.style.rotation=this._.rt.deg,this)},At[r].setBox=function(e,t,n){if(this.removed)return this;var r=this.Group.style,s=this.shape&&this.shape.style||this.node.style;e=e||{};for(var o in e)e[i](o)&&(this.attrs[o]=e[o]);t=t||this._.rt.cx,n=n||this._.rt.cy;var u=this.attrs,a,f,l,c;switch(this.type){case"circle":a=u.cx-u.r,f=u.cy-u.r,l=c=u.r*2;break;case"ellipse":a=u.cx-u.rx,f=u.cy-u.ry,l=u.rx*2,c=u.ry*2;break;case"image":a=+u.x,f=+u.y,l=u.width||0,c=u.height||0;break;case"text":this.textpath.v=["m",j(u.x),", ",j(u.y-2),"l",j(u.x)+1,", ",j(u.y-2)][b](p),a=u.x-j(this.W/2),f=u.y-this.H/2,l=this.W,c=this.H;break;case"rect":case"path":if(!this.attrs.path)a=0,f=0,l=this.paper.width,c=this.paper.height;else{var h=nt(this.attrs.path);a=h.x,f=h.y,l=h.width,c=h.height}break;default:a=0,f=0,l=this.paper.width,c=this.paper.height}t=t==null?a+l/2:t,n=n==null?f+c/2:n;var d=t-this.paper.width/2,v=n-this.paper.height/2,m;r.left!=(m=d+"px")&&(r.left=m),r.top!=(m=v+"px")&&(r.top=m),this.X=Ut[i](this.type)?-d:a,this.Y=Ut[i](this.type)?-v:f,this.W=l,this.H=c,Ut[i](this.type)?(s.left!=(m=-d*Rt+"px")&&(s.left=m),s.top!=(m=-v*Rt+"px")&&(s.top=m)):this.type=="text"?(s.left!=(m=-d+"px")&&(s.left=m),s.top!=(m=-v+"px")&&(s.top=m)):(r.width!=(m=this.paper.width+"px")&&(r.width=m),r.height!=(m=this.paper.height+"px")&&(r.height=m),s.left!=(m=a-d+"px")&&(s.left=m),s.top!=(m=f-v+"px")&&(s.top=m),s.width!=(m=l+"px")&&(s.width=m),s.height!=(m=c+"px")&&(s.height=m))},At[r].hide=function(){return!this.removed&&(this.Group.style.display="none"),this},At[r].show=function(){return!this.removed&&(this.Group.style.display="block"),this},At[r].getBBox=function(){return this.removed?this:Ut[i](this.type)?nt(this.attrs.path):{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H}},At[r].remove=function(){if(this.removed)return;vt(this,this.paper),this.node.parentNode.removeChild(this.node),this.Group.parentNode.removeChild(this.Group),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var e in this)delete this[e];this.removed=!0},At[r].attr=function(t,n){if(this.removed)return this;if(t==null){var r={};for(var s in this.attrs)this.attrs[i](s)&&(r[s]=this.attrs[s]);return this._.rt.deg&&(r.rotation=this.rotate()),(this._.sx!=1||this._.sy!=1)&&(r.scale=this.scale()),r.gradient&&r.fill=="none"&&(r.fill=r.gradient)&&delete r.gradient,r}if(n==null&&e.is(t,C))return t=="translation"?cn.call(this):t=="rotation"?this.rotate():t=="scale"?this.scale():t==A&&this.attrs.fill=="none"&&this.attrs.gradient?this.attrs.gradient:this.attrs[t];if(this.attrs&&n==null&&e.is(t,k)){var o,u={};for(s=0,o=t[w];s<o;s++)u[t[s]]=this.attr(t[s]);return u}var a;return n!=null&&(a={},a[t]=n),n==null&&e.is(t,"object")&&(a=t),a&&(a.text&&this.type=="text"&&(this.node.string=a.text),Ct(this,a),a.gradient&&({circle:1,ellipse:1}[i](this.type)||v(a.gradient).charAt()!="r")&&Tt(this,a.gradient),(!Ut[i](this.type)||this._.rt.deg)&&this.setBox(this.attrs)),this},At[r].toFront=function(){return!this.removed&&this.Group.parentNode[f](this.Group),this.paper.top!=this&&mt(this,this.paper),this},At[r].toBack=function(){return this.removed?this:(this.Group.parentNode.firstChild!=this.Group&&(this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild),gt(this,this.paper)),this)},At[r].insertAfter=function(e){return this.removed?this:(e.Group.nextSibling?e.Group.parentNode.insertBefore(this.Group,e.Group.nextSibling):e.Group.parentNode[f](this.Group),yt(this,e,this.paper),this)},At[r].insertBefore=function(e){return this.removed?this:(e.Group.parentNode.insertBefore(this.Group,e.Group),bt(this,e,this.paper),this)};var Wt=/ progid:\S+Blur\([^\)]+\)/g;At[r].blur=function(e){var t=this.node.runtimeStyle,n=t.filter;n=n.replace(Wt,p),+e!==0?(this.attrs.blur=e,t.filter=n+d+R+".Blur(pixelradius="+(+e||1.5)+")",t.margin=Raphael.format("-{0}px 0 0 -{0}px",Math.round(+e||1.5))):(t.filter=n,t.margin=0,delete this.attrs.blur)},Ot=function(e,t,n,r){var i=Vt("group"),s=Vt("oval"),o=s.style;i.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px",i.coordsize=qt,i.coordorigin=e.coordorigin,i[f](s);var u=new At(s,i,e);return u.type="circle",Ct(u,{stroke:"#000",fill:"none"}),u.attrs.cx=t,u.attrs.cy=n,u.attrs.r=r,u.setBox({x:t-r,y:n-r,width:r*2,height:r*2}),e.canvas[f](i),u};function Xt(t,n,r,i,s){return s?e.format("M{0},{1}l{2},0a{3},{3},0,0,1,{3},{3}l0,{5}a{3},{3},0,0,1,{4},{3}l{6},0a{3},{3},0,0,1,{4},{4}l0,{7}a{3},{3},0,0,1,{3},{4}z",t+s,n,r-s*2,s,-s,i-s*2,s*2-r,s*2-i):e.format("M{0},{1}l{2},0,0,{3},{4},0z",t,n,r,i,-r)}Mt=function(e,t,n,r,i,s){var o=Xt(t,n,r,i,s),u=e.path(o),a=u.attrs;return u.X=a.x=t,u.Y=a.y=n,u.W=a.width=r,u.H=a.height=i,a.r=s,a.path=o,u.type="rect",u},_t=function(e,t,n,r,i){var s=Vt("group"),o=Vt("oval"),u=o.style;s.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px",s.coordsize=qt,s.coordorigin=e.coordorigin,s[f](o);var a=new At(o,s,e);return a.type="ellipse",Ct(a,{stroke:"#000"}),a.attrs.cx=t,a.attrs.cy=n,a.attrs.rx=r,a.attrs.ry=i,a.setBox({x:t-r,y:n-i,width:r*2,height:i*2}),e.canvas[f](s),a},Dt=function(e,t,n,r,i,s){var o=Vt("group"),u=Vt("image"),a=u.style;o.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px",o.coordsize=qt,o.coordorigin=e.coordorigin,u.src=t,o[f](u);var l=new At(u,o,e);return l.type="image",l.attrs.src=t,l.attrs.x=n,l.attrs.y=r,l.attrs.w=i,l.attrs.h=s,l.setBox({x:n,y:r,width:i,height:s}),e.canvas[f](o),l},Pt=function(t,n,r,i){var s=Vt("group"),o=Vt("shape"),u=o.style,a=Vt("path"),l=a.style,c=Vt("textpath");s.style.cssText="position:absolute;left:0;top:0;width:"+t.width+"px;height:"+t.height+"px",s.coordsize=qt,s.coordorigin=t.coordorigin,a.v=e.format("m{0},{1}l{2},{1}",j(n*10),j(r*10),j(n*10)+1),a.textpathok=!0,u.width=t.width,u.height=t.height,c.string=v(i),c.on=!0,o[f](c),o[f](a),s[f](o);var h=new At(c,s,t);return h.shape=o,h.textpath=a,h.type="text",h.attrs.text=i,h.attrs.x=n,h.attrs.y=r,h.attrs.w=1,h.attrs.h=1,Ct(h,{font:z.font,stroke:"none",fill:"#000"}),h.setBox(),t.canvas[f](s),h},Ht=function(e,t){var n=this.canvas.style;return e==+e&&(e+="px"),t==+t&&(t+="px"),n.width=e,n.height=t,n.clip="rect(0 "+e+" "+t+" 0)",this};var Vt;s.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!s.namespaces.rvml&&s.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),Vt=function(e){return s.createElement("<rvml:"+e+' class="rvml">')}}catch($t){Vt=function(e){return s.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}Bt=function(){var t=pt[l](0,arguments),n=t.container,r=t.height,i,o=t.width,u=t.x,c=t.y;if(!n)throw new Error("VML container not found.");var h=new a,p=h.canvas=s.createElement("div"),v=p.style;return u=u||0,c=c||0,o=o||512,r=r||342,o==+o&&(o+="px"),r==+r&&(r+="px"),h.width=1e3,h.height=1e3,h.coordsize=Rt*1e3+d+Rt*1e3,h.coordorigin="0 0",h.span=s.createElement("span"),h.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",p[f](h.span),v.cssText=e.format("width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",o,r),n==1?(s.body[f](p),v.left=u+"px",v.top=c+"px",v.position="absolute"):n.firstChild?n.insertBefore(p,n.firstChild):n[f](p),dt.call(h,h,e.fn),h},a[r].clear=function(){this.canvas.innerHTML=p,this.span=s.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas[f](this.span),this.bottom=this.top=null},a[r].remove=function(){this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]=wt(e);return!0}}a[r].safari=function(){var e=this.rect(-99,-99,this.width+99,this.height+99);o.setTimeout(function(){e.remove()})},/^Apple|^Google/.test(o.navigator.vendor)&&(!(o.navigator.userAgent.indexOf("Version/4.0")+1)||o.navigator.platform.slice(0,2)=="iP")?a[r].safari=function(){var e=this.rect(-99,-99,this.width+99,this.height+99);o.setTimeout(function(){e.remove()})}:a[r].safari=function(){};var Jt=function(){this.returnValue=!1},Kt=function(){return this.originalEvent.preventDefault()},Qt=function(){this.cancelBubble=!0},Gt=function(){return this.originalEvent.stopPropagation()},Yt=function(){if(s.addEventListener)return function(e,t,n,r){var s=h&&y[t]?y[t]:t,o=function(s){if(h&&y[i](t))for(var o=0,u=s.targetTouches&&s.targetTouches.length;o<u;o++)if(s.targetTouches[o].target==e){var a=s;s=s.targetTouches[o],s.originalEvent=a,s.preventDefault=Kt,s.stopPropagation=Gt;break}return n.call(r,s)};return e.addEventListener(s,o,!1),function(){return e.removeEventListener(s,o,!1),!0}};if(s.attachEvent)return function(e,t,n,r){var i=function(e){return e=e||o.event,e.preventDefault=e.preventDefault||Jt,e.stopPropagation=e.stopPropagation||Qt,n.call(r,e)};e.attachEvent("on"+t,i);var s=function(){return e.detachEvent("on"+t,i),!0};return s}}();for(var Zt=g[w];Zt--;)(function(t){e[t]=At[r][t]=function(n){return e.is(n,"function")&&(this.events=this.events||[],this.events.push({name:t,f:n,unbind:Yt(this.shape||this.node||s,t,n,this)})),this},e["un"+t]=At[r]["un"+t]=function(e){var n=this.events,r=n[w];while(r--)if(n[r].name==t&&n[r].f==e)return n[r].unbind(),n.splice(r,1),!n.length&&delete this.events,this;return this}})(g[Zt]);At[r].hover=function(e,t){return this.mouseover(e).mouseout(t)},At[r].unhover=function(e,t){return this.unmouseover(e).unmouseout(t)},At[r].drag=function(e,t,n){this._drag={};var r=this.mousedown(function(e){(e.originalEvent?e.originalEvent:e).preventDefault(),this._drag.x=e.clientX,this._drag.y=e.clientY,this._drag.id=e.identifier,t&&t.call(this,e.clientX,e.clientY),Raphael.mousemove(i).mouseup(s)}),i=function(t){var n=t.clientX,i=t.clientY;if(h){var s=t.touches.length,o;while(s--){o=t.touches[s];if(o.identifier==r._drag.id){n=o.clientX,i=o.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}}else t.preventDefault();e&&e.call(r,n-r._drag.x,i-r._drag.y,n,i)},s=function(){r._drag={},Raphael.unmousemove(i).unmouseup(s),n&&n.call(r)};return this},a[r].circle=function(e,t,n){return Ot(this,e||0,t||0,n||0)},a[r].rect=function(e,t,n,r,i){return Mt(this,e||0,t||0,n||0,r||0,i||0)},a[r].ellipse=function(e,t,n,r){return _t(this,e||0,t||0,n||0,r||0)},a[r].path=function(t){return t&&!e.is(t,C)&&!e.is(t[0],k)&&(t+=p),xt(e.format[l](e,arguments),this)},a[r].image=function(e,t,n,r,i){return Dt(this,e||"about:blank",t||0,n||0,r||0,i||0)},a[r].text=function(e,t,n){return Pt(this,e||0,t||0,n==undefined?p:n)},a[r].set=function(e){return arguments[w]>1&&(e=Array[r].splice.call(arguments,0,arguments[w])),new pn(e)},a[r].setSize=Ht,a[r].top=a[r].bottom=null,a[r].raphael=e,At[r].resetScale=function(){if(this.removed)return this;this._.sx=1,this._.sy=1,this.attrs.scale="1 1"},At[r].scale=function(e,t,n,r){if(this.removed)return this;if(e==null&&t==null)return{x:this._.sx,y:this._.sy,toString:en};t=t||e,!+t&&(t=e);var i,s,o,u,a=this.attrs;if(e!=0){var f=this.getBBox(),l=f.x+f.width/2,h=f.y+f.height/2,v=e/this._.sx,m=t/this._.sy;n=+n||n==0?n:l,r=+r||r==0?r:h;var g=~~(e/S.abs(e)),y=~~(t/S.abs(t)),E=this.node.style,x=n+(l-n)*v,N=r+(h-r)*m;switch(this.type){case"rect":case"image":var C=a.width*g*v,k=a.height*y*m;this.attr({height:k,r:a.r*T(g*v,y*m),width:C,x:x-C/2,y:N-k/2});break;case"circle":case"ellipse":this.attr({rx:a.rx*g*v,ry:a.ry*y*m,r:a.r*T(g*v,y*m),cx:x,cy:N});break;case"text":this.attr({x:x,y:N});break;case"path":var L=it(a.path),A=!0;for(var O=0,M=L[w];O<M;O++){var _=L[O],D=U.call(_[0]);if(D=="M"&&A)continue;A=!1;if(D=="A")_[L[O][w]-2]*=v,_[L[O][w]-1]*=m,_[1]*=g*v,_[2]*=y*m,_[5]=+(g+y?!!+_[5]:!+_[5]);else if(D=="H")for(var P=1,H=_[w];P<H;P++)_[P]*=v;else if(D=="V")for(P=1,H=_[w];P<H;P++)_[P]*=m;else for(P=1,H=_[w];P<H;P++)_[P]*=P%2?v:m}var B=nt(L);i=x-B.x-B.width/2,s=N-B.y-B.height/2,L[0][1]+=i,L[0][2]+=s,this.attr({path:L})}this.type in{text:1,image:1}&&(g!=1||y!=1)?this.transformations?(this.transformations[2]="scale("[c](g,",",y,")"),this.node[F]("transform",this.transformations[b](d)),i=g==-1?-a.x-(C||0):a.x,s=y==-1?-a.y-(k||0):a.y,this.attr({x:i,y:s}),a.fx=g-1,a.fy=y-1):(this.node.filterMatrix=R+".Matrix(M11="[c](g,", M12=0, M21=0, M22=",y,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')"),E.filter=(this.node.filterMatrix||p)+(this.node.filterOpacity||p)):this.transformations?(this.transformations[2]=p,this.node[F]("transform",this.transformations[b](d)),a.fx=0,a.fy=0):(this.node.filterMatrix=p,E.filter=(this.node.filterMatrix||p)+(this.node.filterOpacity||p)),a.scale=[e,t,n,r][b](d),this._.sx=e,this._.sy=t}return this},At[r].clone=function(){if(this.removed)return null;var e=this.attr();return delete e.scale,delete e.translation,this.paper[this.type]().attr(e)};var tn=Z(function(t,n,r,i,s,o,u,a,f){var l=0,c;for(var h=0;h<1.001;h+=.001){var p=e.findDotsAtSegment(t,n,r,i,s,o,u,a,h);h&&(l+=_(_(c.x-p.x,2)+_(c.y-p.y,2),.5));if(l>=f)return p;c=p}}),nn=function(t,n){return function(r,i,s){r=ct(r);var o,u,a,f,l="",c={},h,p=0;for(var d=0,v=r.length;d<v;d++){a=r[d];if(a[0]=="M")o=+a[1],u=+a[2];else{f=rn(o,u,a[1],a[2],a[3],a[4],a[5],a[6]);if(p+f>i){if(n&&!c.start){h=tn(o,u,a[1],a[2],a[3],a[4],a[5],a[6],i-p),l+=["C",h.start.x,h.start.y,h.m.x,h.m.y,h.x,h.y];if(s)return l;c.start=l,l=["M",h.x,h.y+"C",h.n.x,h.n.y,h.end.x,h.end.y,a[5],a[6]][b](),p+=f,o=+a[5],u=+a[6];continue}if(!t&&!n)return h=tn(o,u,a[1],a[2],a[3],a[4],a[5],a[6],i-p),{x:h.x,y:h.y,alpha:h.alpha}}p+=f,o=+a[5],u=+a[6]}l+=a}return c.end=l,h=t?p:n?c:e.findDotsAtSegment(o,u,a[1],a[2],a[3],a[4],a[5],a[6],1),h.alpha&&(h={x:h.x,y:h.y,alpha:h.alpha}),h}},rn=Z(function(e,t,n,r,i,s,o,u){var a={x:0,y:0},f=0;for(var l=0;l<1.01;l+=.01){var c=ft(e,t,n,r,i,s,o,u,l);l&&(f+=_(_(a.x-c.x,2)+_(a.y-c.y,2),.5)),a=c}return f}),sn=nn(1),on=nn(),un=nn(0,1);At[r].getTotalLength=function(){if(this.type!="path")return;return this.node.getTotalLength?this.node.getTotalLength():sn(this.attrs.path)},At[r].getPointAtLength=function(e){if(this.type!="path")return;return on(this.attrs.path,e)},At[r].getSubpath=function(e,t){if(this.type!="path")return;if(S.abs(this.getTotalLength()-t)<1e-6)return un(this.attrs.path,e).end;var n=un(this.attrs.path,t,1);return e?un(n,e).end:n},e.easing_formulas={linear:function(e){return e},"<":function(e){return _(e,3)},">":function(e){return _(e-1,3)+1},"<>":function(e){return e*=2,e<1?_(e,3)/2:(e-=2,(_(e,3)+2)/2)},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){e-=1;var t=1.70158;return e*e*((t+1)*e+t)+1},elastic:function(e){if(e==0||e==1)return e;var t=.3,n=t/4;return _(2,-10*e)*S.sin((e-n)*2*S.PI/t)+1},bounce:function(e){var t=7.5625,n=2.75,r;return e<1/n?r=t*e*e:e<2/n?(e-=1.5/n,r=t*e*e+.75):e<2.5/n?(e-=2.25/n,r=t*e*e+.9375):(e-=2.625/n,r=t*e*e+.984375),r}};var an={length:0},fn=function(){var t=+(new Date);for(var n in an)if(n!="length"&&an[i](n)){var r=an[n];if(r.stop||r.el.removed){delete an[n],an[w]--;continue}var s=t-r.start,u=r.ms,a=r.easing,f=r.from,l=r.diff,c=r.to,h=r.t,v=r.prev||0,m=r.el,g=r.callback,y={},E;if(s<u){var S=e.easing_formulas[a]?e.easing_formulas[a](s/u):s/u;for(var x in f)if(f[i](x)){switch(W[x]){case"along":E=S*u*l[x],c.back&&(E=c.len-E);var T=on(c[x],E);m.translate(l.sx-l.x||0,l.sy-l.y||0),l.x=T.x,l.y=T.y,m.translate(T.x-l.sx,T.y-l.sy),c.rot&&m.rotate(l.r+T.alpha,T.x,T.y);break;case N:E=+f[x]+S*u*l[x];break;case"colour":E="rgb("+[ln(j(f[x].r+S*u*l[x].r)),ln(j(f[x].g+S*u*l[x].g)),ln(j(f[x].b+S*u*l[x].b))][b](",")+")";break;case"path":E=[];for(var C=0,k=f[x][w];C<k;C++){E[C]=[f[x][C][0]];for(var L=1,A=f[x][C][w];L<A;L++)E[C][L]=+f[x][C][L]+S*u*l[x][C][L];E[C]=E[C][b](d)}E=E[b](d);break;case"csv":switch(x){case"translation":var O=l[x][0]*(s-v),M=l[x][1]*(s-v);h.x+=O,h.y+=M,E=O+d+M;break;case"rotation":E=+f[x][0]+S*u*l[x][0],f[x][1]&&(E+=","+f[x][1]+","+f[x][2]);break;case"scale":E=[+f[x][0]+S*u*l[x][0],+f[x][1]+S*u*l[x][1],2 in c[x]?c[x][2]:p,3 in c[x]?c[x][3]:p][b](d);break;case"clip-rect":E=[],C=4;while(C--)E[C]=+f[x][C]+S*u*l[x][C]}}y[x]=E}m.attr(y),m._run&&m._run.call(m)}else c.along&&(T=on(c.along,c.len*!c.back),m.translate(l.sx-(l.x||0)+T.x-l.sx,l.sy-(l.y||0)+T.y-l.sy),c.rot&&m.rotate(l.r+T.alpha,T.x,T.y)),(h.x||h.y)&&m.translate(-h.x,-h.y),c.scale&&(c.scale+=p),m.attr(c),delete an[n],an[w]--,m.in_animation=null,e.is(g,"function")&&g.call(m);r.prev=s}e.svg&&m&&m.paper&&m.paper.safari(),an[w]&&o.setTimeout(fn)},ln=function(e){return x(T(e,255),0)},cn=function(e,t){if(e==null)return{x:this._.tx,y:this._.ty,toString:en};this._.tx+=+e,this._.ty+=+t;switch(this.type){case"circle":case"ellipse":this.attr({cx:+e+this.attrs.cx,cy:+t+this.attrs.cy});break;case"rect":case"image":case"text":this.attr({x:+e+this.attrs.x,y:+t+this.attrs.y});break;case"path":var n=it(this.attrs.path);n[0][1]+=+e,n[0][2]+=+t,this.attr({path:n})}return this};At[r].animateWith=function(e,t,n,r,i){return an[e.id]&&(t.start=an[e.id].start),this.animate(t,n,r,i)},At[r].animateAlong=hn(),At[r].animateAlongBack=hn(1),At[r].onAnimation=function(e){return this._run=e||0,this},At[r].animate=function(n,r,s,o){if(e.is(s,"function")||!s)o=s||null;var u={},a={},f={};for(var l in n)if(n[i](l)&&W[i](l)){u[l]=this.attr(l),u[l]==null&&(u[l]=z[l]),a[l]=n[l];switch(W[l]){case"along":var c=sn(n[l]),h=on(n[l],c*!!n.back),p=this.getBBox();f[l]=c/r,f.tx=p.x,f.ty=p.y,f.sx=h.x,f.sy=h.y,a.rot=n.rot,a.back=n.back,a.len=c,n.rot&&(f.r=I(this.rotate())||0);break;case N:f[l]=(a[l]-u[l])/r;break;case"colour":u[l]=e.getRGB(u[l]);var d=e.getRGB(a[l]);f[l]={r:(d.r-u[l].r)/r,g:(d.g-u[l].g)/r,b:(d.b-u[l].b)/r};break;case"path":var g=ct(u[l],a[l]);u[l]=g[0];var y=g[1];f[l]=[];for(var b=0,E=u[l][w];b<E;b++){f[l][b]=[0];for(var S=1,x=u[l][b][w];S<x;S++)f[l][b][S]=(y[b][S]-u[l][b][S])/r}break;case"csv":var T=v(n[l])[m](t),C=v(u[l])[m](t);switch(l){case"translation":u[l]=[0,0],f[l]=[T[0]/r,T[1]/r];break;case"rotation":u[l]=C[1]==T[1]&&C[2]==T[2]?C:[0,T[1],T[2]],f[l]=[(T[0]-u[l][0])/r,0,0];break;case"scale":n[l]=T,u[l]=v(u[l])[m](t),f[l]=[(T[0]-u[l][0])/r,(T[1]-u[l][1])/r,0,0];break;case"clip-rect":u[l]=v(u[l])[m](t),f[l]=[],b=4;while(b--)f[l][b]=(T[b]-u[l][b])/r}a[l]=T}}return this.stop(),this.in_animation=1,an[this.id]={start:n.start||+(new Date),ms:r,easing:s,from:u,diff:f,to:a,el:this,callback:o,t:{x:0,y:0}},++an[w]==1&&fn(),this},At[r].stop=function(){return an[this.id]&&an[w]--,delete an[this.id],this},At[r].translate=function(e,t){return this.attr({translation:e+" "+t})},At[r][L]=function(){return"Raphals object"},e.ae=an;var pn=function(e){this.items=[],this[w]=0,this.type="set";if(e)for(var t=0,n=e[w];t<n;t++)e[t]&&(e[t].constructor==At||e[t].constructor==pn)&&(this[this.items[w]]=this.items[this.items[w]]=e[t],this[w]++)};pn[r][D]=function(){var e,t;for(var n=0,r=arguments[w];n<r;n++)e=arguments[n],e&&(e.constructor==At||e.constructor==pn)&&(t=this.items[w],this[t]=this.items[t]=e,this[w]++);return this},pn[r].pop=function(){return delete this[this[w]--],this.items.pop()};for(var dn in At[r])At[r][i](dn)&&(pn[r][dn]=function(e){return function(){for(var t=0,n=this.items[w];t<n;t++)this.items[t][e][l](this.items[t],arguments);return this}}(dn));pn[r].attr=function(t,n){if(t&&e.is(t,k)&&e.is(t[0],"object"))for(var r=0,i=t[w];r<i;r++)this.items[r].attr(t[r]);else for(var s=0,o=this.items[w];s<o;s++)this.items[s].attr(t,n);return this},pn[r].animate=function(t,n,r,i){(e.is(r,"function")||!r)&&(i=r||null);var s=this.items[w],o=s,u,a=this,f;i&&(f=function(){!--s&&i.call(a)}),r=e.is(r,C)?r:f,u=this.items[--o].animate(t,n,r,f);while(o--)this.items[o].animateWith(u,t,n,r,f);return this},pn[r].insertAfter=function(e){var t=this.items[w];while(t--)this.items[t].insertAfter(e);return this},pn[r].getBBox=function(){var e=[],t=[],n=[],r=[];for(var i=this.items[w];i--;){var s=this.items[i].getBBox();e[D](s.x),t[D](s.y),n[D](s.x+s.width),r[D](s.y+s.height)}return e=T[l](0,e),t=T[l](0,t),{x:e,y:t,width:x[l](0,n)-e,height:x[l](0,r)-t}},pn[r].clone=function(e){e=new pn;for(var t=0,n=this.items[w];t<n;t++)e[D](this.items[t].clone());return e},e.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},n=e.face["font-family"];for(var r in e.face)e.face[i](r)&&(t.face[r]=e.face[r]);this.fonts[n]?this.fonts[n][D](t):this.fonts[n]=[t];if(!e.svg){t.face["units-per-em"]=q(e.face["units-per-em"],10);for(var s in e.glyphs)if(e.glyphs[i](s)){var o=e.glyphs[s];t.glyphs[s]={w:o.w,k:{},d:o.d&&"M"+o.d[X](/[mlcxtrv]/g,function(e){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[e]||"M"})+"z"};if(o.k)for(var u in o.k)o[i](u)&&(t.glyphs[s].k[u]=o.k[u])}}return e},a[r].getFont=function(t,n,r,s){s=s||"normal",r=r||"normal",n=+n||{normal:400,bold:700,lighter:300,bolder:800}[n]||400;if(!e.fonts)return;var o=e.fonts[t];if(!o){var u=new RegExp("(^|\\s)"+t[X](/[^\w\d\s+!~.:_-]/g,p)+"(\\s|$)","i");for(var a in e.fonts)if(e.fonts[i](a)&&u.test(a)){o=e.fonts[a];break}}var f;if(o)for(var l=0,c=o[w];l<c;l++){f=o[l];if(f.face["font-weight"]==n&&(f.face["font-style"]==r||!f.face["font-style"])&&f.face["font-stretch"]==s)break}return f},a[r].print=function(n,r,i,s,o,u){u=u||"middle";var a=this.set(),f=v(i)[m](p),l=0,c=p,h;e.is(s,i)&&(s=this.getFont(s));if(s){h=(o||16)/s.face["units-per-em"];var d=s.face.bbox.split(t),g=+d[0],y=+d[1]+(u=="baseline"?d[3]-d[1]+ +s.face.descent:(d[3]-d[1])/2);for(var b=0,E=f[w];b<E;b++){var S=b&&s.glyphs[f[b-1]]||{},x=s.glyphs[f[b]];l+=b?(S.w||s.w)+(S.k&&S.k[f[b]]||0):0,x&&x.d&&a[D](this.path(x.d).attr({fill:"#000",stroke:"none",translation:[l,0]}))}a.scale(h,h,g,y).translate(n-g,r-y)}return a};var vn=/\{(\d+)\}/g;return e.format=function(t,n){var r=e.is(n,k)?[0][c](n):arguments;return t&&e.is(t,C)&&r[w]-1&&(t=t[X](vn,function(e,t){return r[++t]==null?p:r[t]})),t||p},e.ninja=function(){return u.was?Raphael=u.is:delete Raphael,e},e.el=At[r],e}(),function(){var e=Math.max,t=Math.min;Raphael.fn.g=Raphael.fn.g||{},Raphael.fn.g.markers={disc:"disc",o:"disc",flower:"flower",f:"flower",diamond:"diamond",d:"diamond",square:"square",s:"square",triangle:"triangle",t:"triangle",star:"star","*":"star",cross:"cross",x:"cross",plus:"plus","+":"plus",arrow:"arrow","->":"arrow"},Raphael.fn.g.shim={stroke:"none",fill:"#000","fill-opacity":0},Raphael.fn.g.txtattr={font:"12px Arial, sans-serif"},Raphael.fn.g.colors=[];var n=[.6,.2,.05,.1333,.75,0];for(var i=0;i<10;i++)i<n.length?Raphael.fn.g.colors.push("hsb("+n[i]+", .75, .75)"):Raphael.fn.g.colors.push("hsb("+n[i-n.length]+", 1, .5)");Raphael.fn.g.text=function(e,t,n){return this.text(e,t,n).attr(this.g.txtattr)},Raphael.fn.g.labelise=function(e,t,n){return e?(e+"").replace(/(##+(?:\.#+)?)|(%%+(?:\.%+)?)/g,function(e,r,i){if(r)return(+t).toFixed(r.replace(/^#+\.?/g,"").length);if(i)return(t*100/n).toFixed(i.replace(/^%+\.?/g,"").length)+"%"}):(+t).toFixed(0)},Raphael.fn.g.finger=function(n,r,i,s,o,u,a){if(o&&!s||!o&&!i)return a?"":this.path();u={square:"square",sharp:"sharp",soft:"soft"}[u]||"round";var f;s=Math.round(s),i=Math.round(i),n=Math.round(n),r=Math.round(r);switch(u){case"round":if(!o){var l=~~(s/2);i<l?(l=i,f=["M",n+.5,r+.5-~~(s/2),"l",0,0,"a",l,~~(s/2),0,0,1,0,s,"l",0,0,"z"]):f=["M",n+.5,r+.5-l,"l",i-l,0,"a",l,l,0,1,1,0,s,"l",l-i,0,"z"]}else l=~~(i/2),s<l?(l=s,f=["M",n-~~(i/2),r,"l",0,0,"a",~~(i/2),l,0,0,1,i,0,"l",0,0,"z"]):f=["M",n-l,r,"l",0,l-s,"a",l,l,0,1,1,i,0,"l",0,s-l,"z"];break;case"sharp":if(!o){var c=~~(s/2);f=["M",n,r+c,"l",0,-s,e(i-c,0),0,t(c,i),c,-t(c,i),c+(c*2<s),"z"]}else c=~~(i/2),f=["M",n+c,r,"l",-i,0,0,-e(s-c,0),c,-t(c,s),c,t(c,s),c,"z"];break;case"square":o?f=["M",n+~~(i/2),r,"l",1-i,0,0,-s,i-1,0,"z"]:f=["M",n,r+~~(s/2),"l",0,-s,i,0,0,s,"z"];break;case"soft":o?(l=t(Math.round(i/5),s),f=["M",n-~~(i/2),r,"l",0,l-s,"a",l,l,0,0,1,l,-l,"l",i-2*l,0,"a",l,l,0,0,1,l,l,"l",0,s-l,"z"]):(l=t(i,Math.round(s/5)),f=["M",n+.5,r+.5-~~(s/2),"l",i-l,0,"a",l,l,0,0,1,l,l,"l",0,s-l*2,"a",l,l,0,0,1,-l,l,"l",l-i,0,"z"])}return a?f.join(","):this.path(f)},Raphael.fn.g.disc=function(e,t,n){return this.circle(e,t,n)},Raphael.fn.g.line=function(e,t,n){return this.rect(e-n,t-n/5,2*n,2*n/5)},Raphael.fn.g.square=function(e,t,n){return n*=.7,this.rect(e-n,t-n,2*n,2*n)},Raphael.fn.g.triangle=function(e,t,n){return n*=1.75,this.path("M".concat(e,",",t,"m0-",n*.58,"l",n*.5,",",n*.87,"-",n,",0z"))},Raphael.fn.g.diamond=function(e,t,n){return this.path(["M",e,t-n,"l",n,n,-n,n,-n,-n,n,-n,"z"])},Raphael.fn.g.flower=function(e,t,n,r){n*=1.25;var i=n,s=i*.5;r=+r<3||!r?5:r;var o=["M",e,t+s,"Q"],u;for(var a=1;a<r*2+1;a++)u=a%2?i:s,o=o.concat([+(e+u*Math.sin(a*Math.PI/r)).toFixed(3),+(t+u*Math.cos(a*Math.PI/r)).toFixed(3)]);return o.push("z"),this.path(o.join(","))},Raphael.fn.g.star=function(e,t,n,r,i){r=r||n*.382,i=i||5;var s=["M",e,t+r,"L"],o;for(var u=1;u<i*2;u++)o=u%2?n:r,s=s.concat([e+o*Math.sin(u*Math.PI/i),t+o*Math.cos(u*Math.PI/i)]);return s.push("z"),this.path(s.join(","))},Raphael.fn.g.cross=function(e,t,n){return n/=2.5,this.path("M".concat(e-n,",",t,"l",[-n,-n,n,-n,n,n,n,-n,n,n,-n,n,n,n,-n,n,-n,-n,-n,n,-n,-n,"z"]))},Raphael.fn.g.plus=function(e,t,n){return n/=2,this.path("M".concat(e-n/2,",",t-n/2,"l",[0,-n,n,0,0,n,n,0,0,n,-n,0,0,n,-n,0,0,-n,-n,0,0,-n,"z"]))},Raphael.fn.g.arrow=function(e,t,n){return this.path("M".concat(e-n*.7,",",t-n*.4,"l",[n*.6,0,0,-n*.4,n,n*.8,-n,n*.8,0,-n*.4,-n*.6,0],"z"))},Raphael.fn.g.tag=function(e,t,n,r,i){r=r||0,i=i==null?5:i,n=n==null?"$9.99":n;var s=.5522*i,o=this.set(),u=3;return o.push(this.path().attr({fill:"#000",stroke:"#000"})),o.push(this.text(e,t,n).attr(this.g.txtattr).attr({fill:"#000","font-family":"Helvetica, Arial"})),o.update=function(){this.rotate(0,e,t);var n=this[1].getBBox();if(n.height>=i*2)this[0].attr({path:["M",e,t+i,"a",i,i,0,1,1,0,-i*2,i,i,0,1,1,0,i*2,"m",0,-i*2-u,"a",i+u,i+u,0,1,0,0,(i+u)*2,"L",e+i+u,t+n.height/2+u,"l",n.width+2*u,0,0,-n.height-2*u,-n.width-2*u,0,"L",e,t-i-u].join(",")});else{var o=Math.sqrt(Math.pow(i+u,2)-Math.pow(n.height/2+u,2));this[0].attr({path:["M",e,t+i,"c",-s,0,-i,s-i,-i,-i,0,-s,i-s,-i,i,-i,s,0,i,i-s,i,i,0,s,s-i,i,-i,i,"M",e+o,t-n.height/2-u,"a",i+u,i+u,0,1,0,0,n.height+2*u,"l",i+u-o+n.width+2*u,0,0,-n.height-2*u,"L",e+o,t-n.height/2-u].join(",")})}return this[1].attr({x:e+i+u+n.width/2,y:t}),r=(360-r)%360,this.rotate(r,e,t),r>90&&r<270&&this[1].attr({x:e-i-u-n.width/2,y:t,rotation:[180+r,e,t]}),this},o.update(),o},Raphael.fn.g.popupit=function(t,n,r,i,s){i=i==null?2:i,s=s||5,t=Math.round(t),n=Math.round(n);var o=r.getBBox(),u=Math.round(o.width/2),a=Math.round(o.height/2),f=[0,u+s*2,0,-u-s*2],l=[-a*2-s*3,-a-s,0,-a-s],c=["M",t-f[i],n-l[i],"l",-s,(i==2)*-s,-e(u-s,0),0,"a",s,s,0,0,1,-s,-s,"l",0,-e(a-s,0),(i==3)*-s,-s,(i==3)*s,-s,0,-e(a-s,0),"a",s,s,0,0,1,s,-s,"l",e(u-s,0),0,s,!i*-s,s,!i*s,e(u-s,0),0,"a",s,s,0,0,1,s,s,"l",0,e(a-s,0),(i==1)*s,s,(i==1)*-s,s,0,e(a-s,0),"a",s,s,0,0,1,-s,s,"l",-e(u-s,0),0,"z"].join(","),h=[{x:t,y:n+s*2+a},{x:t-s*2-u,y:n},{x:t,y:n-s*2-a},{x:t+s*2+u,y:n}][i];return r.translate(h.x-u-o.x,h.y-a-o.y),this.path(c).attr({fill:"#000",stroke:"none"}).insertBefore(r.node?r:r[0])},Raphael.fn.g.popup=function(t,n,r,i,s){i=i==null?2:i>3?3:i,s=s||5,r=r||"$9.99";var o=this.set(),u=3;return o.push(this.path().attr({fill:"#000",stroke:"#000"})),o.push(this.text(t,n,r).attr(this.g.txtattr).attr({fill:"#fff","font-family":"Helvetica, Arial"})),o.update=function(r,o,u){r=r||t,o=o||n;var a=this[1].getBBox(),f=a.width/2,l=a.height/2,c=[0,f+s*2,0,-f-s*2],h=[-l*2-s*3,-l-s,0,-l-s],p=["M",r-c[i],o-h[i],"l",-s,(i==2)*-s,-e(f-s,0),0,"a",s,s,0,0,1,-s,-s,"l",0,-e(l-s,0),(i==3)*-s,-s,(i==3)*s,-s,0,-e(l-s,0),"a",s,s,0,0,1,s,-s,"l",e(f-s,0),0,s,!i*-s,s,!i*s,e(f-s,0),0,"a",s,s,0,0,1,s,s,"l",0,e(l-s,0),(i==1)*s,s,(i==1)*-s,s,0,e(l-s,0),"a",s,s,0,0,1,-s,s,"l",-e(f-s,0),0,"z"].join(","),d=[{x:r,y:o+s*2+l},{x:r-s*2-f,y:o},{x:r,y:o-s*2-l},{x:r+s*2+f,y:o}][i];return d.path=p,u?this.animate(d,500,">"):this.attr(d),this},o.update(t,n)},Raphael.fn.g.flag=function(e,t,n,i){i=i||0,n=n||"$9.99";var s=this.set(),o=3;return s.push(this.path().attr({fill:"#000",stroke:"#000"})),s.push(this.text(e,t,n).attr(this.g.txtattr).attr({fill:"#fff","font-family":"Helvetica, Arial"})),s.update=function(e,t){this.rotate(0,e,t);var n=this[1].getBBox(),s=n.height/2;return this[0].attr({path:["M",e,t,"l",s+o,-s-o,n.width+2*o,0,0,n.height+2*o,-n.width-2*o,0,"z"].join(",")}),this[1].attr({x:e+s+o+n.width/2,y:t}),i=360-i,this.rotate(i,e,t),i>90&&i<270&&this[1].attr({x:e-r-o-n.width/2,y:t,rotation:[180+i,e,t]}),this},s.update(e,t)},Raphael.fn.g.label=function(e,n,r){var i=this.set();return i.push(this.rect(e,n,10,10).attr({stroke:"none",fill:"#000"})),i.push(this.text(e,n,r).attr(this.g.txtattr).attr({fill:"#fff"})),i.update=function(){var e=this[1].getBBox(),n=t(e.width+10,e.height+10)/2;this[0].attr({x:e.x-n/2,y:e.y-n/2,width:e.width+n,height:e.height+n,r:n})},i.update(),i},Raphael.fn.g.labelit=function(e){var n=e.getBBox(),r=t(20,n.width+10,n.height+10)/2;return this.rect(n.x-r/2,n.y-r/2,n.width+r,n.height+r,r).attr({stroke:"none",fill:"#000"}).insertBefore(e.node?e:e[0])},Raphael.fn.g.drop=function(e,t,n,r,i){r=r||30,i=i||0;var s=this.set();return s.push(this.path(["M",e,t,"l",r,0,"A",r*.4,r*.4,0,1,0,e+r*.7,t-r*.7,"z"]).attr({fill:"#000",stroke:"none",rotation:[22.5-i,e,t]})),i=(i+90)*Math.PI/180,s.push(this.text(e+r*Math.sin(i),t+r*Math.cos(i),n).attr(this.g.txtattr).attr({"font-size":r*12/30,fill:"#fff"})),s.drop=s[0],s.text=s[1],s},Raphael.fn.g.blob=function(t,n,r,i,s){i=(+i+1?i:45)+90,s=s||12;var o=Math.PI/180,u=s*12/12,a=this.set();return a.push(this.path().attr({fill:"#000",stroke:"none"})),a.push(this.text(t+s*Math.sin(i*o),n+s*Math.cos(i*o)-u/2,r).attr(this.g.txtattr).attr({"font-size":u,fill:"#fff"})),a.update=function(r,a,f){r=r||t,a=a||n;var l=this[1].getBBox(),c=e(l.width+u,s*25/12),h=e(l.height+u,s*25/12),p=r+s*Math.sin((i-22.5)*o),d=a+s*Math.cos((i-22.5)*o),v=r+s*Math.sin((i+22.5)*o),m=a+s*Math.cos((i+22.5)*o),g=(v-p)/2,b=(m-d)/2,w=c/2,E=h/2,S=-Math.sqrt(Math.abs(w*w*E*E-w*w*b*b-E*E*g*g)/(w*w*b*b+E*E*g*g)),T=S*w*b/E+(v+p)/2,N=S*-E*g/w+(m+d)/2;return f?this.animate({x:T,y:N,path:["M",t,n,"L",v,m,"A",w,E,0,1,1,p,d,"z"].join(",")},500,">"):this.attr({x:T,y:N,path:["M",t,n,"L",v,m,"A",w,E,0,1,1,p,d,"z"].join(",")}),this},a.update(t,n),a},Raphael.fn.g.colorValue=function(e,n,r,i){return"hsb("+[t((1-e/n)*.4,1),r||.75,i||.75]+")"},Raphael.fn.g.snapEnds=function(e,t,n){function s(e){return Math.abs(e-.5)<.25?~~e+.5:Math.round(e)}var r=e,i=t;if(isNaN(r)||isNaN(i)||n<=0)return{from:0,to:0,power:0};if(r==i)return{from:r,to:i,power:0};var o=(i-r)/n,u=~~o,a=u,f=0;if(u){while(a)f--,a=~~(o*Math.pow(10,f))/Math.pow(10,f);f++}else{while(!u)f=f||1,u=~~(o*Math.pow(10,f))/Math.pow(10,f),f++;f&&f--}return i=s(t*Math.pow(10,f))/Math.pow(10,f),i<t&&(i=s((t+.5)*Math.pow(10,f))/Math.pow(10,f)),r=s((e-(f>0?0:.5))*Math.pow(10,f))/Math.pow(10,f),{from:r,to:i,power:f}},Raphael.fn.g.axis=function(e,t,n,r,i,s,o,u,a,f){f=f==null?2:f,a=a||"t",s=s||10;var l=a=="|"||a==" "?["M",e+.5,t,"l",0,.001]:o==1||o==3?["M",e+.5,t,"l",0,-n]:["M",e,t+.5,"l",n,0],c=this.g.snapEnds(r,i,s),h=c.from,p=c.to,v=c.power,m=0,g=this.set();d=(p-h)/s;var y=h,b=v>0?v:0;x=n/s;if(+o==1||+o==3){var w=t,E=(o-1?1:-1)*(f+3+!!(o-1));while(w>=t-n)a!="-"&&a!=" "&&(l=l.concat(["M",e-(a=="+"||a=="|"?f:!(o-1)*f*2),w+.5,"l",f*2+1,0])),g.push(this.text(e+E,w,u&&u[m++]||(Math.round(y)==y?y:+y.toFixed(b))).attr(this.g.txtattr).attr({"text-anchor":o-1?"start":"end"})),y+=d,w-=x;Math.round(w+x-(t-n))&&(a!="-"&&a!=" "&&(l=l.concat(["M",e-(a=="+"||a=="|"?f:!(o-1)*f*2),t-n+.5,"l",f*2+1,0])),g.push(this.text(e+E,t-n,u&&u[m]||(Math.round(y)==y?y:+y.toFixed(b))).attr(this.g.txtattr).attr({"text-anchor":o-1?"start":"end"})))}else{y=h,b=(v>0)*v,E=(o?-1:1)*(f+9+!o);var S=e,x=n/s,T=0,N=0;while(S<=e+n){a!="-"&&a!=" "&&(l=l.concat(["M",S+.5,t-(a=="+"?f:!!o*f*2),"l",0,f*2+1])),g.push(T=this.text(S,t+E,u&&u[m++]||(Math.round(y)==y?y:+y.toFixed(b))).attr(this.g.txtattr));var C=T.getBBox();N>=C.x-5||(N=C.x+C.width),y+=d,S+=x}Math.round(S-x-e-n)&&(a!="-"&&a!=" "&&(l=l.concat(["M",e+n+.5,t-(a=="+"?f:!!o*f*2),"l",0,f*2+1])),g.push(this.text(e+n,t+E,u&&u[m]||(Math.round(y)==y?y:+y.toFixed(b))).attr(this.g.txtattr)))}var k=this.path(l);return k.text=g,k.all=this.set([k,g]),k.remove=function(){this.text.remove(),this.constructor.prototype.remove.call(this)},k},Raphael.el.lighter=function(e){e=e||2;var n=[this.attrs.fill,this.attrs.stroke];this.fs=this.fs||[n[0],n[1]],n[0]=Raphael.rgb2hsb(Raphael.getRGB(n[0]).hex),n[1]=Raphael.rgb2hsb(Raphael.getRGB(n[1]).hex),n[0].b=t(n[0].b*e,1),n[0].s=n[0].s/e,n[1].b=t(n[1].b*e,1),n[1].s=n[1].s/e,this.attr({fill:"hsb("+[n[0].h,n[0].s,n[0].b]+")",stroke:"hsb("+[n[1].h,n[1].s,n[1].b]+")"})},Raphael.el.darker=function(e){e=e||2;var n=[this.attrs.fill,this.attrs.stroke];this.fs=this.fs||[n[0],n[1]],n[0]=Raphael.rgb2hsb(Raphael.getRGB(n[0]).hex),n[1]=Raphael.rgb2hsb(Raphael.getRGB(n[1]).hex),n[0].s=t(n[0].s*e,1),n[0].b=n[0].b/e,n[1].s=t(n[1].s*e,1),n[1].b=n[1].b/e,this.attr({fill:"hsb("+[n[0].h,n[0].s,n[0].b]+")",stroke:"hsb("+[n[1].h,n[1].s,n[1].b]+")"})},Raphael.el.original=function(){this.fs&&(this.attr({fill:this.fs[0],stroke:this.fs[1]}),delete this.fs)}}(),Raphael.fn.g.barchart=function(e,t,n,r,i,s){s=s||{};var o={round:"round",sharp:"sharp",soft:"soft"}[s.type]||"square",u=parseFloat(s.gutter||"20%"),a=this.set(),f=this.set(),l=this.set(),c=this.set(),h=Math.max.apply(Math,i),p=[],d=this,v=0,m=s.colors||this.g.colors,g=i.length;if(this.raphael.is(i[0],"array")){h=[],v=g,g=0;for(var y=i.length;y--;)f.push(this.set()),h.push(Math.max.apply(Math,i[y])),g=Math.max(g,i[y].length);if(s.stacked)for(var y=g;y--;){var b=0;for(var w=i.length;w--;)b+=+i[w][y]||0;p.push(b)}for(var y=i.length;y--;)if(i[y].length<g)for(var w=g;w--;)i[y].push(0);h=Math.max.apply(Math,s.stacked?p:h)}h=s.to||h;var E=Math.round(n/(g*(100+u)+u)*100),S=Math.round(n/g-E),x=s.vgutter==null?20:s.vgutter,T=[],N=e+.5*S,C=(r-2*x)/h;s.stretch||(S=Math.round(S),E=Math.floor(E)),!s.stacked&&(E/=v||1);for(var y=0;y<g;y++){T=[];var k=t+r-x;for(var w=0;w<(v||1);w++){var L=Math.round((v?i[w][y]:i[y])*C),A=k-L,O=this.g.finger(Math.round(N+E/2),A+L,E,L,!0,o).attr({stroke:"none",fill:m[v?w:y]});v?(f[w].push(O),s.stacked&&(k-=L)):f.push(O),O.y=k,O.x=Math.round(N+E/2),O.w=E,O.h=L,O.row=w,O.col=y,O.value=v?i[w][y]:i[y],s.stacked?T.push(O):N+=E}if(s.stacked){for(var M=0,_=T.length;M<_;M++){var O=T[M],D;l.push(D=this.rect(O.x-O.w/2,O.y,E,O.value*C).attr(this.g.shim)),D.bar=O,D.value=O.value}N+=E}N+=S}c.toFront(),N=e+.5*S;if(!s.stacked)for(var y=0;y<g;y++){for(var w=0;w<(v||1);w++){var D;l.push(D=this.rect(Math.round(N),t+x,E,r-x).attr(this.g.shim)),D.bar=v?f[w][y]:f[y],D.value=D.bar.value,N+=E}N+=S}return a.label=function(e,n){e=e||[],this.labels=d.set();var o,u=-Infinity;if(s.stacked)for(var a=0;a<g;a++){var c=0;for(var p=0;p<(v||1);p++){c+=v?i[p][a]:i[a];if(p==v-1){var m=d.g.labelise(e[a],c,h);o=d.g.text(f[a*(v||1)+p].x,t+r-x/2,m).insertBefore(l[a*(v||1)+p]);var y=o.getBBox();y.x-7<u?o.remove():(this.labels.push(o),u=y.x+y.width)}}}else for(var a=0;a<g;a++)for(var p=0;p<(v||1);p++){var m=d.g.labelise(v?e[p]&&e[p][a]:e[a],v?i[p][a]:i[a],h);o=d.g.text(f[a*(v||1)+p].x,n?t+r-x/2:f[a*(v||1)+p].y-10,m).insertBefore(l[a*(v||1)+p]);var y=o.getBBox();y.x-7<u?o.remove():(this.labels.push(o),u=y.x+y.width)}return this},a.hover=function(e,t){return c.hide(),l.show(),l.mouseover(e).mouseout(t),this},a.hoverColumn=function(e,t){return l.hide(),c.show(),t=t||function(){},c.mouseover(e).mouseout(t),this},a.click=function(e){return c.hide(),l.show(),l.click(e),this},a.each=function(e){if(!Raphael.is(e,"function"))return this;for(var t=l.length;t--;)e.call(l[t]);return this},a.eachColumn=function(e){if(!Raphael.is(e,"function"))return this;for(var t=c.length;t--;)e.call(c[t]);return this},a.clickColumn=function(e){return l.hide(),c.show(),c.click(e),this},a.push(f,l,c),a.bars=f,a.covers=l,a},Raphael.fn.g.hbarchart=function(e,t,n,r,i,s){s=s||{};var o={round:"round",sharp:"sharp",soft:"soft"}[s.type]||"square",u=parseFloat(s.gutter||"20%"),a=this.set(),f=this.set(),l=this.set(),c=this.set(),h=Math.max.apply(Math,i),p=[],d=this,v=0,m=s.colors||this.g.colors,g=i.length;if(this.raphael.is(i[0],"array")){h=[],v=g,g=0;for(var y=i.length;y--;)f.push(this.set()),h.push(Math.max.apply(Math,i[y])),g=Math.max(g,i[y].length);if(s.stacked)for(var y=g;y--;){var b=0;for(var w=i.length;w--;)b+=+i[w][y]||0;p.push(b)}for(var y=i.length;y--;)if(i[y].length<g)for(var w=g;w--;)i[y].push(0);h=Math.max.apply(Math,s.stacked?p:h)}h=s.to||h;var E=r/(g*(100+u)+u)*100,S=r/g,x=S-E,T=[],N=t+.5*x,C=(n-1)/h;!s.stacked&&(E/=v||1);for(var y=0;y<g;y++){T=[];var k=e;for(var w=0;w<(v||1);w++){var L=v?i[w][y]:i[y],A=this.g.finger(k+1,N+.5*E,Math.round(L*C),E-1,!1,o).attr({stroke:"none",fill:m[v?w:y]});v?(f[w].push(A),s.stacked&&(k+=Math.round(L*C))):f.push(A),A.x=k,A.y=N+.5*E,A.w=Math.round(L*C),A.h=E,A.row=w,A.col=y,A.value=+L,s.stacked?T.push(A):N+=E}if(s.stacked){for(var O=0,M=T.length;O<M;O++){var A=T[O],_;l.push(_=this.rect(A.x-Math.round(A.w),A.y-A.h/2,A.value*C,E).attr(this.g.shim)),_.bar=A,_.value=A.value}N+=S}N=t+(y+1)*S+.5*x}c.toFront(),N=t+x*.5;if(!s.stacked)for(var y=0;y<g;y++){for(var w=0;w<(v||1);w++){var _=this.rect(e,N,n,E).attr(this.g.shim);l.push(_),_.bar=v?f[w][y]:f[y],_.value=_.bar.value,N+=E}N+=x}return a.label=function(t,n){t=t||[],this.labels=d.set();for(var r=0;r<g;r++)for(var s=0;s<v;s++){var o=d.g.labelise(v?t[s]&&t[s][r]:t[r],v?i[s][r]:i[r],h),u=n?f[r*(v||1)+s].x-E/2+3:e+5,a=n?"end":"start",c;this.labels.push(c=d.g.text(u,f[r*(v||1)+s].y,o).attr({"text-anchor":a}).insertBefore(l[0])),c.getBBox().x<e+5?c.attr({x:e+5,"text-anchor":"start"}):f[r*(v||1)+s].label=c}return this},a.hover=function(e,t){return c.hide(),l.show(),t=t||function(){},l.mouseover(e).mouseout(t),this},a.hoverColumn=function(e,t){return l.hide(),c.show(),t=t||function(){},c.mouseover(e).mouseout(t),this},a.each=function(e){if(!Raphael.is(e,"function"))return this;for(var t=l.length;t--;)e.call(l[t]);return this},a.eachColumn=function(e){if(!Raphael.is(e,"function"))return this;for(var t=c.length;t--;)e.call(c[t]);return this},a.click=function(e){return c.hide(),l.show(),l.click(e),this},a.clickColumn=function(e){return l.hide(),c.show(),c.click(e),this},a.push(f,l,c),a.bars=f,a.covers=l,a},Raphael.fn.g.linechart=function(e,t,n,r,i,s,o){function u(e,t){var n=e.length/t,r=0,i=n,s=0,o=[];while(r<e.length)i--,i<0?(s+=e[r]*(1+i),o.push(s/n),s=e[r++]*-i,i+=n):s+=e[r++];return o}function a(e,t,n,r,i,s){var o=(n-e)/2,u=(i-n)/2,a=Math.atan((n-e)/Math.abs(r-t)),f=Math.atan((i-n)/Math.abs(r-s));a=t<r?Math.PI-a:a,f=s<r?Math.PI-f:f;var l=Math.PI/2-(a+f)%(Math.PI*2)/2,c=o*Math.sin(l+a),h=o*Math.cos(l+a),p=u*Math.sin(l+f),d=u*Math.cos(l+f);return{x1:n-c,y1:r+h,x2:n+p,y2:r+d}}function tt(o){var u=[];for(var a=0,f=i.length;a<f;a++)u=u.concat(i[a]);u.sort();var l=[],c=[];for(a=0,f=u.length;a<f;a++)u[a]!=u[a-1]&&l.push(u[a])&&c.push(w+(u[a]-O)*H);u=l,f=u.length;var h=o||p.set();for(a=0;a<f;a++){var v=c[a]-(c[a]-(c[a-1]||e))/2,g=((c[a+1]||e+n)-c[a])/2+(c[a]-(c[a-1]||e))/2,y;o?y={}:h.push(y=p.rect(v-1,t,Math.max(g+1,1),r).attr({stroke:"none",fill:"#000",opacity:0})),y.values=[],y.symbols=p.set(),y.y=[],y.x=c[a],y.axis=u[a];for(var b=0,E=s.length;b<E;b++){l=i[b]||i[0];for(var x=0,T=l.length;x<T;x++)l[x]==u[a]&&(y.values.push(s[b][x]),y.y.push(S-(s[b][x]-D)*B),y.symbols.push(m.symbols[b][x]))}o&&o.call(y)}!o&&(d=h)}o=o||{},this.raphael.is(i[0],"array")||(i=[i]),this.raphael.is(s[0],"array")||(s=[s]);var f=[0,0,0,0],l=Math.max(i[0].length,s[0].length),c=o.symbol||"",h=o.colors||this.g.colors,p=this,d=null,v=null,m=this.set(),g=[],y=n-f[1]-f[3],b=r-f[0]-f[2],w=e+f[3],E=t+f[0],S=E+b,x=w+y;for(var T=0,N=s.length;T<N;T++)l=Math.max(l,s[T].length);var C=this.set();for(T=0,N=s.length;T<N;T++)o.shade&&C.push(this.path().attr({stroke:"none",fill:h[T],opacity:o.nostroke||o.stack?.9:.3})),s[T].length>n&&(s[T]=u(s[T],n)),i[T]&&i[T].length>n&&(i[T]=u(i[T],n));var k=Array.prototype.concat.apply([],i),L=Array.prototype.concat.apply([],s),A=this.g.snapEnds(Math.min.apply(Math,k),Math.max.apply(Math,k),i[0].length-1),O=o.axismin&&o.axismin.x!=undefined?o.axismin.x:A.from,M=o.axismax&&o.axismax.x!=undefined?o.axismax.x:A.to,_=this.g.snapEnds(Math.min.apply(Math,L),Math.max.apply(Math,L),s[0].length-1),D=o.axismin&&o.axismin.y!=undefined?o.axismin.y:_.from,P=o.axismax&&o.axismax.y!=undefined?o.axismax.y:_.to,H=n/(M-O||1),B=r/(P-D||1),j=this.set(),F=this.set(),I;for(T=0,N=s.length;T<N;T++){o.nostroke||j.push(I=this.path().attr({stroke:h[T],"stroke-width":o.width||2,"stroke-linejoin":"round","stroke-linecap":"round","stroke-dasharray":o.dash||""}));var q=this.raphael.is(c,"array")?c[T]:c,R=this.set();g=[];for(var U=0,z=s[T].length;U<z;U++){var W=e+((i[T]||i[0])[U]-O)*H,X=t+r-(s[T][U]-D)*B;if(o.stack){var V=0;for(var $=0,J=T;$<J;$++)V+=s[$][U];X-=V*B}(Raphael.is(q,"array")?q[U]:q)&&R.push(this.g[Raphael.fn.g.markers[this.raphael.is(q,"array")?q[U]:q]](W,X,(o.width||2)*3).attr({fill:h[T],stroke:"none"}));if(o.smooth){if(U&&U!=z-1){var K=w+((i[T]||i[0])[U-1]-O)*H,Q=S-(s[T][U-1]-D)*B,G=w+((i[T]||i[0])[U+1]-O)*H,Y=S-(s[T][U+1]-D)*B,Z=a(K,Q,W,X,G,Y);g=g.concat([Z.x1,Z.y1,W,X,Z.x2,Z.y2])}U||(g=["M",W,X,"C",W,X])}else g=g.concat([U?"L":"M",W,X])}o.smooth&&(g=g.concat([W,X,W,X])),F.push(R);if(o.shade)if(o.stack&&T){var $=F[T-1].length,et=g.concat([]);while(--$>=0){var q=F[T-1][$];et=et.concat(["L",q.attr("cx"),q.attr("cy")])}C[T].attr({path:et.concat(["Z"]).join(",")})}else C[T].attr({path:g.concat(["L",W,t+r,"L",e+((i[T]||i[0])[0]-O)*H,t+r,"z"]).join(",")});!o.nostroke&&I.attr({path:g.join(",")})}return m.createDots=function(n){var o=p.set(),u;for(var a=0,f=s.length;a<f;a++)for(var l=0,c=s[a].length;l<c;l++){var h=e+((i[a]||i[0])[l]-O)*H,d=e+((i[a]||i[0])[l?l-1:1]-O)*H,g=t+r-(s[a][l]-D)*B;n?u={}:o.push(u=p.circle(h,g,Math.abs(d-h)/2).attr({stroke:"none",fill:"#000",opacity:0})),u.x=h,u.y=g,u.i=a,u.j=l,u.value=s[a][l],u.line=m.lines[a],u.shade=m.shades[a],u.symbol=m.symbols[a][l],u.symbols=m.symbols[a],u.nextSymbol=m.symbols[a-1]&&m.symbols[a-1][l],u.axis=(i[a]||i[0])[l],n&&n.call(u)}!n&&(v=o)},m.push(j,C,F,axis,d,v),m.lines=j,m.shades=C,m.symbols=F,m.axis=axis,m.dots=v,m.hoverColumn=function(e,t){return!d&&tt(),d.mouseover(e).mouseout(t),this},m.clickColumn=function(e){return!d&&tt(),d.click(e),this},m.hrefColumn=function(e){var t=p.raphael.is(arguments[0],"array")?arguments[0]:arguments;if(!(arguments.length-1)&&typeof e=="object")for(var n in e)for(var r=0,i=d.length;r<i;r++)d[r].axis==n&&d[r].attr("href",e[n]);!d&&tt();for(r=0,i=t.length;r<i;r++)d[r]&&d[r].attr("href",t[r]);return this},m.hover=function(e,t){return!v&&createDots(),v.mouseover(e).mouseout(t),this},m.click=function(e){return!v&&createDots(),v.click(e),this},m.each=function(e){return createDots(e),this},m.eachColumn=function(e){return tt(e),this},m.showValue=function(e,t){!v&&createDots();for(var n=0;n<v.length;n++)v[n].x-v[n].attrs.r<=t&&v[n].x+v[n].attrs.r>=t&&e(v[n].x,v[n].y,i[0][n],s[0][n]);return this},m},Raphael.fn.g.piechart=function(e,t,n,r,i){i=i||{};var s=this,o=[],u=this.set(),a=this.set(),f=this.set(),l=this.set(),c=[],h=r.length,p=0,d=0,v=0,m=9,g=!0;a.covers=u,i.animationDur=i.animationDur||500;for(var y=0;y<h;y++)d+=r[y],r[y]={value:r[y],order:y,valueOf:function(){return this.value}};r.sort(function(e,t){return t.value-e.value}),d>0&&r[0]==d?h=1:d==0&&(h=0);if(h==1){f.push(this.circle(e,t,n).attr({fill:this.g.colors[r[0].order],stroke:i.stroke||"#fff","stroke-width":i.strokewidth==null?1:i.strokewidth})),u.push(this.circle(e,t,n).attr(this.g.shim)),o.push(f[0]),f[0].middle={x:e,y:t},f[0].mangle=180,f[0].value=r[0];var b=i.percentage?Math.round(r[0].value/d*100)+" %":r[0].value,w=this.g.text(e,t,b).attr(this.g.txtattr).attr({"font-weight":700});f[0].label=w,l.push(w)}else if(h>0){function E(e,t,n,r,i,s){var o=Math.PI/180,u=e+n*Math.cos(-r*o),a=e+n*Math.cos(-i*o),f=e+n/2*Math.cos(-(r+(i-r)/2)*o),l=e+n*2/3*Math.cos(-(r+(i-r)/2)*o),c=t+n*Math.sin(-r*o),h=t+n*Math.sin(-i*o),p=t+n/2*Math.sin(-(r+(i-r)/2)*o),d=t+n*2/3*Math.sin(-(r+(i-r)/2)*o),v=["M",e,t,"L",u,c,"A",n,n,0,+(Math.abs(i-r)>180),1,a,h,"z"];return v.middle={x:f,y:p},v.core={x:l,y:d},v.midAngle=-(r+(i-r)/2),v}for(y=0;y<h;y++)g&&r[y]*360/d<=1.5&&(m=y,g=!1),y>m&&(g=!1,r[m].value+=r[y],r[m].others=!0,v=r[m].value);h=Math.min(m+1,r.length),v&&r.splice(h)&&(r[m].others=!0);for(y=0;y<h;y++){var S=p-360*r[y]/d/2;y||(p=S,S=p-360*r[y]/d/2);if(i.init)var x=E(e,t,1,p,p-360*r[y]/d).join(",");var T=E(e,t,n,p,p-=360*r[y]/d),N=this.path(i.init?x:T).attr({fill:i.colors&&i.colors[r[y].order]||this.g.colors[r[y].order]||"#666",stroke:i.stroke||"#fff","stroke-width":i.strokewidth==null?1:i.strokewidth,"stroke-linejoin":"round"});N.value=r[y],N.middle=T.middle,N.mangle=T.midAngle,N.core=T.core,N.path=T.join(","),o.push(N),f.push(N),i.init&&N.animate({path:N.path},+i.init-1||1e3,"ease",function(){this.label&&this.label.show()})}var C=[];for(y=0;y<h;y++){if(r[y].value<=0)continue;C[y]=Math.round(r[y].value/d*100);var b=i.percentage?Math.round(r[y].value/d*100)+" %":r[y].value,w=this.g.text(f[y].core.x,f[y].core.y,b).attr(this.g.txtattr).attr({"font-weight":700});f[y].label=w,l.push(w),i.init&&w.hide()}var k=0,L=-1,A=0;for(var y=0;y<C.length;y++)C[y]>A&&(A=C[y],L=y),k+=C[y];k!=100&&(A=100-(k-A),f[L].label[0].textContent=A+" %");for(y=0;y<h&&o[y]!=null;y++)N=s.path(o[y].path).attr(this.g.shim),i.href&&i.href[y]&&N.attr({href:i.href[y]}),N.attr=function(){},u.push(N)}a.hover=function(i,s){s=s||function(){};var o=this;for(var a=0;a<h;a++)(function(u,a,f){var l={sector:u,cover:a,cx:e,cy:t,mx:u.middle.x,my:u.middle.y,mangle:u.mangle,r:n,value:r[f],total:d,label:o.labels&&o.labels[f]};a.mouseover(function(){i.call(l)}).mouseout(function(){s.call(l)})})(f[a],u[a],a);return this},a.touch=function(i,s,o){i=i||function(){},s=s||function(){},o=o||function(){};var a=this;for(var l=0;l<h;l++)(function(u,f,l){var c={sector:u,cover:f,cx:e,cy:t,mx:u.middle.x,my:u.middle.y,mangle:u.mangle,r:n,value:r[l],total:d,label:a.labels&&a.labels[l]};f.touchstart(function(){i.call(c)}),f.touchend(function(){s.call(c)}),f.touchmove(function(){o.call(c)})})(f[l],u[l],l);return this},a.each=function(i){var s=this;for(var o=0;o<h;o++)(function(o,u,a){var f={sector:o,cover:u,cx:e,cy:t,x:o.middle.x,y:o.middle.y,mangle:o.mangle,r:n,value:r[a],total:d,label:s.labels&&s.labels[a]};i.call(f)})(f[o],u[o],o);return this},a.click=function(i){var s=this;for(var o=0;o<h;o++)(function(o,u,a){var f={sector:o,cover:u,cx:e,cy:t,mx:o.middle.x,my:o.middle.y,mangle:o.mangle,r:n,value:r[a],total:d,label:s.labels&&s.labels[a]};u.click(function(){i.call(f)})})(f[o],u[o],o);return this},a.mouse=function(i,s,o){i=i||function(){},s=s||function(){},o=o||function(){};var a=this;for(var l=0;l<h;l++)(function(u,f,l){var c={sector:u,cover:f,cx:e,cy:t,mx:u.middle.x,my:u.middle.y,mangle:u.mangle,r:n,value:r[l],total:d,label:a.labels&&a.labels[l]};f.mousedown(function(){i.call(c)}),f.mouseup(function(){s.call(c)}),f.mousemove(function(){o.call(c)})})(f[l],u[l],l);return this},a.inject=function(e){e.insertBefore(u[0])};var O=function(o,l,c,p,v){var m=e+n+n/5,g=t,y=g+10;o=o||[],p=p&&p.toLowerCase()||"east",c=s.g.markers[c&&c.toLowerCase()]||"disc",v=v&&v.toLowerCase||"vertical",a.labels=s.set();for(var b=0;b<h;b++){var w=f[b].attr("fill"),E=r[b].order,S;r[b].others&&(o[E]=l||"Others"),o[E]=s.g.labelise(o[E],r[b],d),a.labels.push(s.set()),a.labels[b].push(s.g[c](m+5,y,5).attr({fill:w,stroke:"none"})),a.labels[b].push(S=s.text(m+20,y,o[E]||r[E]).attr(s.g.txtattr).attr({fill:i.legendcolor||"#000","text-anchor":"start"})),u[b].label=a.labels[b],v=="vertical"?y+=S.getBBox().height*1.2:m+=S.getBBox().width*3}var x=a.labels.getBBox(),T={east:[0,-x.height/2],west:[-x.width-2*n-20,-x.height/2],north:[-n-x.width/2,-n-x.height-10],south:[-n-x.width/2,n+10]}[p];a.labels.translate.apply(a.labels,T),a.push(a.labels)};return a.push(f,u),a.series=f,a.covers=u,a.labels=l,a.opts=i,a.total=d,a},areachart=function(e,t,n,r,i,s,o,u){var u=u||{},a=$(document.body).css("backgroundColor"),f=this,l=e.g.linechart(t,n,r,i,s,o,u),c=e.set(),h=e.canvas,p=$(h).parent();this.parent=p[0],touchStart=function(e){e=DOMKit.getEvent(e),e.preventDefault(),UIKit.Tip(this.value,e)},touchEnd=function(e){this.attr({opacity:0}),e=DOMKit.getEvent(e),UIKit.hideTip()},l.createDots(function(){var t=e.circle(this.symbol.attr("cx"),this.symbol.attr("cy"),u.dotsize||8).attr({stroke:"none",fill:"#000",opacity:0}),n=this.symbol,r=this.line;t.x=this.symbol.attr("cx"),t.y=this.symbol.attr("cy"),t.axis=this.axis,t.value=this.value,t.symbol=n,t.line=r,r.dots||(r.dots=e.set()),r.dots.push(t),r.symbols||(r.symbols=e.set()),r.symbols.push(this.symbol);if(!r.shade){r.shade=this.shade;var i=this.shade.attr("fill");this.shade.attr({fill:[270,i,a].join("-"),"fill-opacity":.3})}DOMKit.supportsTouch?t.touchstart(touchStart):(t.mousemove(touchStart),t.mouseout(touchEnd)),c.push(t)}),l.push(c),this.remove=function(){l.remove(),UIKit.hideTip(),l=null};if(u.init)for(var d=0;d<l.lines.length;d++){var v=l.lines[d];if(v.attr("path").length==0)continue;v.hide(),v.symbols.hide(),v.shade.hide();var m=e.path(),g=n+i,y=[];m.line=v,m.path=v.shade.attr("path");for(var b=0;b<v.symbols.length;b++)y.push(b?"L":"M"),y.push([v.symbols[b].attr("cx"),g-1]);b--;for(;b>=0;b--){if(b>0&&b<v.symbols.length-1)continue;y.push(["L",v.symbols[b].attr("cx"),g])}m.attr({path:y.concat("Z").join(","),fill:v.shade.attr("fill"),opacity:v.shade.attr("opacity"),stroke:v.attr("stroke"),"stroke-opacity":0}),m.animate({path:m.path},u.init-1||1e3,"ease",function(){this.line.show(),this.line.symbols.show(),this.line.shade.show(),this.remove()})}return this.chart=l,this.params=u,this.svg=h,this},barchart=function(e,t,n,r,i,s,o,u){var a=this,o=o||[],u=u||[],f=e.parper,l=e.canvas,c=$(l).parent()[0],h=[],s=s||[];o.axismax&&o["axismax"]["x"]!=undefined&&(o.to=o.axismax.x),touchStart=function(e){e=DOMKit.getEvent(e),e.preventDefault(),UIKit.Tip.call(a,this.value,e),a.hilight!=this.bar&&(UIKit.addGradientFill.call(this.bar,0,"#ffffff","#929292"),a.hilight&&UIKit.removeGradientFill.call(a.hilight),a.hilight=this.bar)},touchEnd=function(e){e=DOMKit.getEvent(e),e.preventDefault(),UIKit.hideTip.call(a)},select=function(e){if(h.length)for(v=0;v<h.length;v++)h[v].call({r:this.bar.row,c:this.bar.col})};var p=e.g.hbarchart(t,n,r,i,s,o),d=e.set();for(var v=0;p.covers[v];v++){var m=p.covers[v],g=m.bar,y=g.attr("fill");g.value&&g.attr("path")&&(g.attr({stroke:UIKit.getDarkerColor(y)}),UIKit.addGradientFill.call(g,o.gradientAngle||90,y),g.shadow=e.path(g.attr("path")).attr({fill:"#aaa",stroke:"#aaa","stroke-width":0,opacity:.7}).translate(3,3).toBack(),d.push(g.shadow)),DOMKit.supportsTouch?(m.touchstart(touchStart),m.touchstart(select)):(m.mousemove(touchStart),m.mouseout(touchEnd),m.click(select));if(g.attr("path")&&g.attr("path").length>0&&o.init){var b=g.getBBox(),w=e.path(),E=["M",b.x,b.y+b.height,"L",b.x,b.y,"L",b.x+1,b.y,"L",b.x+1,b.y+b.height,"Z"];w.attr({path:E,fill:g.attr("fill"),stroke:g.attr("stroke")}),w.bar=g,g.hide(),g.shadow.hide();var S=function(){this.bar.show(),this.bar.shadow&&this.bar.shadow.show(),this.remove()};w.animate({path:g.attr("path")},o.init-1||1e3,"backOut",S)}}this.onselect=h,this.parent=c,this.chart=p,this.axis=axis},columnchart=function(e,t,n,r,i,s,o,u){var a=this,u=u||{},f=e.canvas,l=$(f).parent()[0],c=[];this.parent=l,u.to==undefined&&u.axismax&&u.axismax.y&&(u.to=u.axismax.y),u.gutter=u.gutter?u.gutter:35,u.vgutter=u.vgutter?u.vgutter:0,touchStart=function(e){e=DOMKit.getEvent(e),e.preventDefault(),this.bar.node.style.display!=="none"&&(UIKit.Tip.call(a,this.value,e),a.hilight!=this.bar&&(UIKit.addGradientFill.call(this.bar,0,"#ffffff","#929292"),a.hilight&&UIKit.removeGradientFill.call(a.hilight),a.hilight=this.bar))},touchEnd=function(e){e=DOMKit.getEvent(e),UIKit.hideTip.call(a)},select=function(e){if(c.length)for(v=0,ii=c.length;v<ii;v++)c[v].call({r:this.bar.row,c:this.bar.col})};var h=e.g.barchart(t,n,r,i,o,u),p=e.set(),d=e.set();h.push(p);for(var v=0;v<h.covers.length;v++){DOMKit.supportsTouch?(h.covers[v].touchstart(touchStart),h.covers[v].touchstart(select)):(h.covers[v].mousemove(touchStart),h.covers[v].mouseout(touchEnd),h.covers[v].click(select));var m=h.covers[v].bar,g=m.attr("fill"),y=UIKit.getDarkerColor(g);UIKit.addGradientFill.call(m),m.attr({stroke:y}),m.value&&m.h!=0&&(m.shadow=e.path(m.attr("path")).attr({fill:"#aaa",stroke:"#aaa",opacity:.7}).translate(3,3).toBack(),d.push(m.shadow));if(u.init){var b=e.path().attr({fill:m.attr("fill"),stroke:m.attr("stroke")}),w=m.getBBox(),E=function(){this.bar.show(),this.bar.shadow&&this.bar.shadow.show(),this.remove()},S={scale:[1,w.height,w.x,w.y+w.height]};b.attr("path",["M",w.x,w.y+w.height,"l",w.width,0,"l",0,-1,"l",-w.width,0,"z"]),b.bar=m,m.hide(),m.shadow&&m.shadow.hide(),a.iwith?b.animateWith(a.iwith,S,u.init-1||1e3,"backOut",E):b.animate(S,u.init-1||1e3,"backOut",E),a.iwith=b}}return this.chart=h,this.onselect=c,this},linechart=function(e,t,n,r,i,s,o,u){function d(){var t=e.set();for(var n=0;f.lines[n];n++){var r=f.lines[n];r.shadow=e.path(r.attr("path")).attr({stroke:"#aaa","stroke-width":2,opacity:.7}).translate(0,2).toBack()}}var u=u||{},a=this,f=e.g.linechart(t,n,r,i,s,o,u),l=e.set(),c=e.canvas,h=[],p=$(c).parent();this.parent=p[0],touchStart=function(e){e=DOMKit.getEvent(e),e.preventDefault(),UIKit.Tip.call(a,this.value,e),f.symbols.attr({"fill-opacity":1}),this.symbol.attr({"fill-opacity":.2})},touchEnd=function(e){this.symbol.attr({"fill-opacity":1}),e=DOMKit.getEvent(e),UIKit.hideTip.call(a)},select=function(e){if(h.length)for(var t=0,n=h.length;t<n;t++)h[t].call({r:this.r,c:this.c})},f.createDots(function(){var t=e.circle(this.x,this.y,u.dotsize||16).attr({stroke:"none",fill:"#000",opacity:0}),n=this.line,r=this.symbol;t.x=this.x,t.y=this.y,t.axis=this.axis,t.value=this.value,t.shade=this.shade,t.symbol=r,t.line=n,t.r=this.i,t.c=this.j,r.attr({stroke:r.attr("fill")}),n.dots||(n.dots=e.set()),n.dots.push(t),n.symbols||(n.symbols=e.set()),n.symbols.push(r),DOMKit.supportsTouch?(t.touchstart(touchStart),t.touchstart(select)):(t.mousemove(touchStart),t.mouseout(touchEnd),t.click(select)),l.push(t)}),f.push(l),d();if(u.init)for(var v=0;f.lines[v];v++){var m=f.lines[v];if(m.attr("path").length==0)continue;m.hide(),m.shadow.hide(),m.symbols.hide();var g=0;for(var y=0;m.symbols[y];y++)g+=m.symbols[y].attr("cy");var b=Math.round(g/y*100)/100,w=[];for(y=0;m.symbols[y];y++)w.push(y?"L":"M"),w.push(m.symbols[y].attr("cx")),w.push(b);var E=e.path();E.line=m,E.path=m.attr("path"),E.attr("path",w),E.attr({fill:m.attr("fill"),stroke:m.attr("stroke")}),E.animate({path:E.path},u.init-1||1e3,"ease",function(){this.line.show(),this.line.shadow.show(),this.line.symbols.show(),this.remove()})}this.chart=f,this.onselect=h},piechart=function(e,t,n,r,i,s,o){function T(){var e=this;s_half=this.value.value/this.total*360/2,this.sector.start=this.sector.mangle-s_half,this.sector.end=this.sector.start+2*s_half,UIKit.addGradientFill.call(this.sector),$(this.cover[0]).bind("mouseout",function(e){!f&&UIKit.hideTip()}).bind(f?"touchstart":"click",function(t){m.hilight!=e.sector&&(UIKit.addGradientFill.call(e.sector,0,"#ffffff"),m.hilight&&UIKit.removeGradientFill.call(m.hilight),m.hilight=e.sector),w.call(e,t)})}function N(e){return}function C(e){e=DOMKit.getEvent(e),l=O(e),p=!0}function k(e){e=DOMKit.getEvent(e),e.preventDefault();if(!p)return;g.labels.hide(),UIKit.hideTip.call(m);var r=O(e);r!=l&&(g.rotate(M()+r-l,t,n),l=r),o.onmove&&o.onmove.call(A())}function L(e){var r=DOMKit.getEvent(e);p=!1;var i=A();if(i){c=h-i.sector.mangle;var s=c-i.rotation;c=s<-180?c+360:s>180?c-360:c,g.animate({rotation:[c,t,n]},a,"backOut",function(){g.rotate(c,t,n),_(),p||g.labels.show()})}}function A(){var e=M();for(var t=0;t<g.series.length;t++){var n=g.series[t],r=n.start+e,i=n.end+e;if(r<0||i<0)r+=360,i+=360;else if(r>=360||i>=360)r-=360,i-=360;if(r<=h&&i>=h)return{pie:g,sector:n,start:r,end:i,rotation:e}}}function O(e){var r=e.getEventAbsolutePosition(),i=r.x-v.offsetLeft,s=r.y-v.offsetTop,o=Math.atan2(s-n,i-t)/Math.PI*180;return o<0&&(o+=360),o}function M(e){var t=g.series[0].attr("rotation");return t.length==0?t=0:isNaN(t)&&(t=Number(t.substring(0,t.indexOf(" ")))),e?t:t%360}function _(){for(var e=0;e<g.series.length;e++){if(!g.series[e].label)continue;var i=g.series[e],s=i.mangle+c,o=t+r*2/3*Math.cos(s*Math.PI/180),u=n+r*2/3*Math.sin(s*Math.PI/180);i.label.attr({x:o,y:u})}}var u=s||{},o=o||{},a=u.animationDur||500,f=DOMKit.supportsTouch,l=0,c=0,h=u.needle&&u.needle.angle||90,p=!1,d=s.rollon!=undefined?s.rollon:"click",v=$(e.canvas).parent()[0],m=this,g=e.g.piechart(t,n,r,i,u),y=[],b=g.total!=0&&e.circle(t,n,r).attr({fill:"#aaa",stroke:"#aaa",opacity:0}).translate(3,2).toBack();b&&window.setTimeout(function(){b.attr({opacity:.7})},s.init-1||1e3),this.parent=v,this.tip=UIKit.Tip,this.onselect=y;var w=function(e){if(y.length)for(var t=0,n=y.length;t<n;t++)y[t].call({r:this.value.order,c:0},e)};g.each(T);if(u.needle){var E=e.set(),S=.15*r,x="M"+t+" "+(n+r-S)+"L"+t+" "+(n+r+1/3*S*1.4)+" "+(t-2/3*S*1.2-1)+" "+(n+r+1/3*S*1.4)+"Z";E.push(e.g.triangle(t,n+r,S).attr({fill:"#000",stroke:"#fff"})),E.push(e.path(x).attr({stroke:"#fff","stroke-width":0,"stroke-opacity":0,fill:"90-#000-#aaa"})),this.needle=E}g.series.length>1&&(d=="move"?f?g.touch(C,L,k):g.mouse(C,L,k):f?g.touch(N):g.click(N)),this.rotateTo=function(e,r){if(r&&r==g||e<0||e>=g.series.length)return;var i=g.series[e];c=h-i.mangle,g.rotate(c,t,n),_()},this.hide=function(){g.hide(),g.labels.hide(),this.needle&&this.needle.hide()},this.show=function(){g.show(),g.labels.show(),this.needle&&this.needle.show()},this.chart=g},stackareachart=function(e,t,n,r,i,s,o,u){function b(t){if(t==m)return;var r=c.lines[t],s=c.lines[t-1];if(r.attr("path").length==0)return;var o=e.path(),u=n+i,a=[];o.i=t,o.line=r,o.shade=r.shade,o.path=r.shade.attr("path");for(var f=0;f<r.symbols.length;f++)a.push(f?"L":"M"),a.push([r.symbols[f].attr("cx"),s&&s.symbols[f]?s.symbols[f].attr("cy")-1:u-1]);f--;for(;f>=0;f--){if(t==0&&f>0&&f<r.symbols.length-1)continue;a.push(["L",r.symbols[f].attr("cx"),s&&s.symbols[f]?s.symbols[f].attr("cy"):u])}o.attr("path",a.concat("Z").join(",")),o.attr({fill:r.shade.attr("fill"),opacity:r.shade.attr("opacity"),stroke:r.attr("stroke")}),o.animate({path:o.path},g,t==m-1?"backOut":"ease",y)}var u=u||{},a=$(document.body).css("color"),f=$(document.body).css("backgroundColor"),l=this,c=e.g.linechart(t,n,r,i,s,o,u),h=e.set(),p=e.set(),d=e.canvas,v=$(d).parent()[0];this.parent=v,touchStart=function(e){e=DOMKit.getEvent(e),e.preventDefault(),p.attr("opacity",0),this.vstrick.attr("opacity",.8),UIKit.Tip.call(l,this.value,e)},untip=function(e){this.vstrick.attr("opacity",0),UIKit.hideTip.call(l)},c.createDots(function(){var r=n+i,s=t,o=c.symbols,u=$.inArray(this.symbols,o),a=$.inArray(this.symbol,this.symbols),f=this.symbols[a-1],l=this.symbol,d=this.symbols[a+1],v=o[u-1]&&o[u-1][a-1],m=o[u-1]&&o[u-1][a],g=o[u-1]&&o[u-1][a+1],y=Math.floor(l.attr("cx")*100)/100,b=Math.floor(l.attr("cy")*100)/100,w=Number(f?(f.attr("cx")+y)/2:y-1).toFixed(2),E=Number(d?(d.attr("cx")+y)/2:y+1).toFixed(2),S=Number(f?(f.attr("cy")+b)/2:b-1).toFixed(2),T=Number(v&&m?(m.attr("cy")+v.attr("cy"))/2:m?m.attr("cy"):r).toFixed(2),N=Number(d?(d.attr("cy")+b)/2:b-1).toFixed(2),C=Number(g&&m?(g.attr("cy")+m.attr("cy"))/2:g?g.attr("cy"):r).toFixed(2),k=Number(m?m.attr("cy"):r).toFixed(2),L=["M",y-2,b,"L",y+2,b,"L",y+2,k,"L",y-2,k,"Z"],A=["M",w,S,"L",y,b,"L",E,N,"L",E,C,"L",y,k,"L",w,T,"Z"],O=e.path().attr({path:L.join(","),stroke:0,fill:this.symbol.attr("fill"),opacity:0}),M=e.path().attr({path:A.join(","),stroke:0,fill:this.symbol.attr("fill"),opacity:0});M.x=this.symbol.attr("cx"),M.y=this.symbol.attr("cy"),M.axis=this.axis,M.value=this.value,M.symbol=l,M.line=this.line,M.vstrick=O,p.push(O),l.attr("opacity",0),this.line.dots||(this.line.dots=e.set()),this.line.dots.push(M),this.line.symbols||(this.line.symbols=e.set()),this.line.symbols.push(this.symbol),this.line.shade||(this.line.shade=this.shade),DOMKit.supportsTouch?$(M[0]).bind("touchstart",function(){touchStart.call(M)}):(M.mousemove(touchStart),M.mouseout(untip)),h.push(M)}),c.push(h);if(u.init){var m=c.lines.length,g=(u.init-1||1e3)/m,y=function(){this.line.show(),this.shade.show(),b(this.i+1),this.remove()};m&&(c.shades.hide(),c.lines.hide(),b(0))}this.chart=c,this.params=u,this.svg=d},stackcolumnchart=function(e,t,n,r,i,s,o,u){function m(t){if(t==p){c.show();return}for(var n=0;l.bars[t][n];n++){bar=l.bars[t][n];var r=e.path().attr({fill:bar.attr("fill"),stroke:bar.attr("stroke")}),i=bar.getBBox(),s={scale:[1,i.height,i.x,i.y+i.height]};r.attr("path",["M",i.x,i.y+i.height,"l",i.width,0,"l",0,-1,"l",-i.width,0,"z"]),r.bar=bar,r.i=n,r.idx=t,r.animate(s,d,t<p-1?"<":"backOut",v)}}var u=u||{},a=e.canvas,f=$(a).parent()[0];this.parent=f,that=this,u.gutter=u.gutter?u.gutter:"70%",u.vgutter=u.vgutter?u.vgutter:0;var l=e.g.barchart(t,n,r,i,o,u);touchStart=function(e){e=DOMKit.getEvent(e),e.preventDefault(),this.bar.node.style.display!=="none"&&(UIKit.Tip.call(that,this.value,e),that.hilight!=this.bar&&(UIKit.addGradientFill.call(this.bar,0,"#ffffff"),that.hilight&&UIKit.removeGradientFill.call(that.hilight),that.hilight=this.bar))},touchEnd=function(e){e=DOMKit.getEvent(e),UIKit.hideTip.call(that)};var c=e.set();for(var h=0;l.covers[h];h++)DOMKit.supportsTouch?l.covers[h].touchstart(touchStart):(l.covers[h].mousemove(touchStart),l.covers[h].mouseout(touchEnd)),bar=l.covers[h].bar,bar.value&&(fill=bar.attr("fill"),stroke=UIKit.getDarkerColor(fill),bar.attr({stroke:stroke}),UIKit.addGradientFill.call(bar),bar.shadow=e.path(bar.attr("path")).attr({fill:"#aaa",stroke:"#aaa",opacity:.7}).translate(3,3).toBack(),c.push(bar.shadow));if(u.init){var p=l.bars.length||0,d=(u.init-1||1e3)/p,h=0,v=function(){this.bar.show(),this.i==p-1&&m(this.idx+1),this.remove()};p&&(l.bars.hide(),c.hide(),m(0))}return this.chart=l,this},DOMKit=new function(){function e(){var e=DOMKit.supportsTouch?event.touches[0].pageX:this.clientX,t=DOMKit.supportsTouch?event.touches[0].pageY:this.clientY;return{x:e,y:t}}function t(e){var t=this.getEventAbsolutePosition();return{x:t.x-e.x,y:t-e.y}}this.supportsTouch=document.createTouch,this.getEvent=function(n){return n=n?n:window.event,n.getEventAbsolutePosition=e,n.getEventRelativePosition=t,n.preventDefault=n.preventDefault?n.preventDefault:function(){},n}},gdata=function(e,t){function h(){r.length=0,s.length=0;if(n.rows!=undefined)for(var e=0,i=n.rows.length;e<i;e++){var u=[],a=!0;if(n.rows[e]!=undefined){var f=n.rows[e];if(f.data!=undefined)for(var l=0,c=f.data.length;l<c;l++)u[l]={value:f.data[l],order:l};if(t&&t.row)for(var h in t.row)t.row[h]==e&&(a=!1);r[e]={value:n.rows[e].name,order:e,toString:function(){return this.value},data:u,visible:a}}}o=r[0]&&r[0].data.concat([]);for(e=0,i=n.cols.length;e<i;e++)s[e]={value:n.cols[e],order:e,visible:!0,toString:function(){return this.value}}}function p(){return s}function d(){return o}function v(){return n.title!=undefined?n.title:""}function m(){var e=[],t=n.axis_X_title!=undefined?n.axis_X_title:"",r=n.axis_Y_title!=undefined?n.axis_Y_title:"";return e.push(t),e.push(r),e}function g(e){var t=[];for(var n=0;n<r.length;n++)(e||r[n].visible)&&t.push(r[n]);return t}function y(e){var t=[];for(var n=0;n<r.length;n++)(e||r[n].visible)&&t.push(r[n].toString());return t}function b(e,t){var n=[],r;for(var i=0;i<o.length;i++)r=s[o[i].order],(e||r.visible)&&n.push(r.toString());return t?n:[" "].concat(n)}function w(e){var t=[];for(var n=0;n<r.length;n++){var i=r[n],u=[];if(!e&&!i.visible)continue;for(var a=0;a<o.length;a++){var f=i.data[o[a].order],l=s[o[a].order];f&&(e||l&&l.visible)&&u.push(f.value)}t.push(u)}return t}function E(e){var t=[],e=e||0;for(var n=0;n<r.length;n++){var i=r[n];if(!i.visible)continue;t.push(i.data[e].value)}return t}function S(e){var t=[];for(var n=0;n<r.length;n++){if(!e&&!r[n].visible)continue;var i=[];for(var o=0;o<r[n].data.length;o++)s[o]&&(e||s[o].visible)&&i.push(2*i.length+1);t.push(i)}return t}function x(e){var t=[];for(var n=0;n<r.length;n++){if(!e&&!r[n].visible)continue;var i=[];for(var o=0;o<r[n].data.length;o++)s[o]&&(e||s[o].visible)&&i.push(i.length);t.push(i)}return t}function T(e){if(e==undefined||e<0||e>r.length-1)return;r[e].visible=!r[e].visible,c=1}function N(e){if(e==undefined||e<0||e>r.length-1)return;var t=r[e],i=n.sortedRowIndex,s=i!=undefined&&i==e?!n.sortedRowOrder:1;o=t.data.concat([]),o.sort(function(e,t){return s?e.value-t.value:t.value-e.value}),n.sortedRowIndex=e,n.sortedRowOrder=s,c=1}function C(e){if(e==undefined||e<0||e>s.length-1)return;s[e].visible=!s[e].visible,c=1}function k(){var e=s,t=n.sortedRowIndex,r=t!=undefined&&t==-1?!n.sortedRowOrder:1;o=e.concat([]),o.sort(function(e,t){var n;return r?n=e.value>=t.value?1:-1:n=e.value<=t.value?1:-1,n}),n.sortedRowIndex=-1,n.sortedRowOrder=r,c=1}function L(){if(!c)return;c=0;for(var e=0;e<u.length;e++)u[e]()}function A(e){minimumnCols=e||1;var t=0,n=0,i=0;for(var o=0,u=s.length;o<u&&n<e;o++)s[o]&&s[o].visible&&n++;for(var a=0,f=r.length;a<f&&t<1;a++)r[a].visible&&(t++,i+=r[a].data.length);return i==0||t<1||n<e}function O(e){a=this.r,f=this.c,this.data={rows:r,cols:s};if(l.length)for(i=0;i<l.length;i++)l[i].call(this,e)}function M(e,t){n=0,n=$.extend(!0,{},e),h(),c=1,t&&L()}var n=$.extend(!0,{},e),r=[],s=[],o=null,u=[],a=null,f=null,l=[],c=0;return this.getColumns=p,this.getRowOrder=d,this.getTitle=v,this.getAxisTitle=m,this.getRows=g,this.getRowname=y,this.getColname=b,this.getRowdata=w,this.getRowdataAt=E,this.getColdata=S,this.getColdata2=x,this.filterByRow=T,this.sortByRow=N,this.filterByColumn=C,this.sortByColumn=k,this.isEmpty=A,this.onchange=u,this.eventChange=L,this.selectedChange=O,this.onselect=l,this.reload=M,h(),this},UIKit=new function(){function t(e,t){t=DOMKit.getEvent(t),window.tipUnit==undefined?(window.tipUnit=$("<div>").addClass("gtip"),$("body").append(window.tipUnit)):window.tipUnit.show();var n=t.getEventAbsolutePosition(),r=window.tipUnit;r.html(e),r.css("left",n.x+$(window).scrollLeft()-r.width()/2),r.css("top",n.y+$(window).scrollTop()-r.height()-15)}function i(e,t){if(t){var n=0;for(var r=0;r<e.length;r++)n=Math.max(n,e[r].length);var i=[];for(var r=0;r<n;r++){var o=0,u=0,a=0;for(var f=0;f<e.length;f++)a+=e[f]&&e[f][r]||0,o=Math.min(o,a),u=Math.max(u,a);i.push(o),i.push(u)}return i.sort(function(e,t){return e-t}),s(i[i.length-1],i[0])}return e=Array.prototype.concat.apply([],e),e.sort(function(e,t){return e-t}),s(e[e.length-1],e[0])}function s(e,t){var n=Math.pow,r=function(e){return Math.log(e)/Math.LN10},i=Math.abs,s=Math.max(i(e),i(t)),o=Math.min(i(e),i(t)),u=Math.floor(r(s)),a=n(10,u),f=a,l=0,c=1,h=4;for(;c<6&&f<s;c++)f=c*2*a;var p=c<3||c==6?2:c-1;if(e>0&&t<0){while(h>1){var d=f/h,v=Math.floor(r(d));if(d>o&&d%n(10,u)==0)break;h--}p=h+1,l=-(f/h);if(i(t)>i(e)){var m=f*-1;f=l*-1,l=m}}else e<0&&(l=-f,f=0);return{top:f,bottom:l,step:p}}function o(){var e=$("<div>",{"class":"cmenu"}),t=$("<a>",{href:"javascript:void(0);","class":"gear"}),n=$("<a>",{href:"javascript:void(0);","class":"magnify"});e.append(t).append(n),t.click(function(){var e=$(this).parent().toggleClass("active"),t=e.find("a:eq(1)").toggleClass("active");t.click(),e.hasClass("active")||e.parent().find(".table").removeClass("active")}),n.click(function(){var e=$(this).parent(),t=e.parent(),n=t.find(".table");n.css("height",t.innerHeight()-e.outerHeight()),n.addClass("active")}),$(this).append(e)}var e=this;e.colors=["#4F87BF","#93AE44","#F1C20A","#877BB0","#73918C","#C7AC89","#DC8ABC","#13508E","#5B6F21","#C8A300","#5B5182","#3D524D","#524C45","#7E2659"],e.txtattr={font:"12px Calibri, 'Fontin Sans', Fontin-Sans, sans-serif"},this.getDarkerColor=function(e,t){t=t||15;if(e.indexOf("#")!=-1){e=getrgb(e);var n=Math.round(t/100*255+.5);e.r=e.r-n<0?0:e.r-n,e.g=e.g-n<0?0:e.g-n,e.b=e.b-n<0?0:e.b-n}else e=gethsb(e),e.b-=t/100;return e.toString()},this.getLighterColor=function(e,t){t=t||15;if(e.indexOf("#")!=-1){e=getrgb(e);var n=Math.round(t/100*255+.5);e.r=e.r+n>255?255:e.r+n,e.g=e.g+n>255?255:e.g+n,e.b=e.b+n>255?255:e.b+n}else e=gethsb(e),e.b+=t/100;return e.toString()},this.addGradientFill=function(e,t){if(arguments[2]!=undefined){var n=this.attr("fill"),e=e||180,r=arguments[2];if(n.indexOf("-")>0){var i=n.split("-");n=i[1]}this.baseColor=n;var s=[e,r,UIKit.getLighterColor(r)];this.attr("fill",s.join("-")),this.attr("stroke-opacity",0)}else{var o=this.attr("fill"),u=o.indexOf("-")==-1?o:o.substring(o.indexOf("-")+1,o.length),a=u.lastIndexOf("-")==-1?u:u.substring(u.lastIndexOf("-")+1,o.length),f=t||UIKit.getLighterColor(a),e=e||270,s=[e,u,f];this.attr("fill",s.join("-"))}},this.removeGradientFill=function(){if(this.baseColor!=undefined)this.attr("fill",this.baseColor),this.attr("stroke-opacity",1);else{var e=this.attr("fill"),t=e.lastIndexOf("-")==-1?e:e.substring(0,e.lastIndexOf("-"));this.attr("fill",t)}},this.hex2rgb=function(e,t){var n=e.replace("#","").match(/(.{2})/g),r=3;while(r--)n[r]=parseInt(n[r],16);return typeof t=="undefined"?"rgb("+n.join(", ")+")":"rgba("+n.join(", ")+", "+t+")"},getrgb=function(e){var t=parseInt(e.substring(1,3),16),n=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16);return{r:t,g:n,b:r,toString:rgbToString}},rgbToString=function(){var e=this.r<16?"0"+this.r.toString(16):this.r.toString(16),t=this.g<16?"0"+this.g.toString(16):this.g.toString(16),n=this.b<16?"0"+this.b.toString(16):this.b.toString(16);return"#"+e+t+n},gethsb=function(e){var t=e.substring(e.indexOf("(")+1,e.indexOf(")")),t=t.split(","),n=parseFloat(t[0]),r=parseFloat(t[1]),i=parseFloat(t[2]);return{h:n,s:r,b:i,toString:hsbToString}},hsbToString=function(){return"hsb("+this.h+","+this.s+","+this.b+")"};var n=function(){window.tipUnit!=undefined&&window.tipUnit.hide()},r=function(){window.tipUnit!=undefined&&window.tipUnit.remove()};this.Tip=t,this.hideTip=n,this.removeTip=r,this.getAxisScale=i,this.buildMenu=o},function(e){e.fn.gchart=function(){},e.fn.gchart.defaults={colors:UIKit.colors,axisattr:{"stroke-width":1,stroke:"#bfbfbf"},init:function(){this.txtattr={fill:e("body").css("color"),font:e("body").css("font"),"font-family":"Helvetica"}}},e.fn.gchart.drawRawTable=function(t){t.length||(t=e("<div>").addClass("table"),e(this.container).append(t),this.raw=tablechart(this.data),t.append(this.raw.table),this.raw.addFlexHeader())},e.fn.gchart.sort=function(){var e=this,t=Array.prototype.concat.apply([],e);return t.sort(function(e,t){return e-t}),t},e.fn.gchart.drawMenu=function(){if(!e(this.container).find(".cmenu").length){var t=this.container,n=this;UIKit.buildMenu.call(t),e(t).find(".gear").click(function(){e(t).find(".cmenu").hasClass("active")||n.data.eventChange()})}},e.fn.gchart.getColors=function(t){var n=[],r=e.fn.gchart.defaults.colors,i=t.getRows(!0);for(var s=0,o=i.length;s<o;s++)i[s].visible&&n.push(r[s%r.length]);return n},e.fn.gchart.spliceData=function(t,n,r){var r=[].concat(r),i=e.fn.gchart.defaults.colors,s=t.getRows(!0),o=[],u=[],a=[],f=[],l=n.length;for(var c=s.length;c--;){assigned=!1,color=i[c%i.length];if(s[c].visible){for(j=0;j<l;j++)if(n[j]===c){a.push(r.pop()),f.push(color),assigned=!0;break}assigned||(o.push(r.pop()),u.push(color))}}return{pv:o.reverse(),pc:u.reverse(),sv:a.reverse(),sc:f.reverse()}}}(jQuery),$(function(){$.fn.gchart.defaults.init()}),function(e){e.fn.garea=function(t,n,r){return this.each(function(){var i=new garea(e(this),t,n,r);i.isEmpty()||(i.onDraw(),i.registerEvents())})},e.fn.garea.defaults={table:1,params:{nostroke:0,shade:1,stack:0,axis:[0,0,1,1],symbol:"o","stroke-width":"1",width:1,aideLine:3,axismin:{x:0}}}}(jQuery),function(e){e.fn.gbar=function(t,n,r){return this.each(function(){var i=new gbar(e(this),t,n,r);i.isEmpty()||(i.onDraw(),i.registerEvents())})},e.fn.gbar.defaults={table:1,params:{axis:[0,0,1,1],labelalign:"center",aideLine:2}}}(jQuery),function(e){e.fn.gcolumn=function(t,n,r){return this.each(function(){var i=new gcolumn(e(this),t,n,r);i.isEmpty()||(i.onDraw(),i.registerEvents())})},e.fn.gcolumn.defaults={table:1,params:{axis:[0,0,1,1],"stroke-width":"2",aideLine:3,labelalign:"center"}}}(jQuery),function(e){e.fn.ghcolumn=function(t,n,r){return this.each(function(){var i=new ghcolumn(e(this),t,n,r);i.isEmpty()||(i.onDraw(),i.registerEvents())})},e.fn.ghcolumn.defaults={table:1,params:{axis:[0,0,1,1],aideLine:2,labelalign:"center"}}}(jQuery),function(e){e.fn.ghstackcolumn=function(t,n,r){return this.each(function(){var i=new ghstackcolumn(e(this),t,n,r);i.isEmpty()||(i.onDraw(),i.registerEvents())})},e.fn.ghstackcolumn.defaults={table:1,params:{axis:[0,0,1,1],aideLine:2,stacked:1,labelalign:"center"}}}(jQuery),function(e){e.fn.gline=function(t,n,r){return this.each(function(){var i=new gline(e(this),t,n,r);i.isEmpty()||(i.onDraw(),i.registerEvents())})},e.fn.gline.defaults={table:1,params:{nostroke:0,shade:0,axis:[0,0,1,1],symbol:"o","stroke-width":"2",dotsize:8,width:1.2,labelalign:"center",aideLine:3,axismin:{x:0}}}}(jQuery),function(e){e.fn.glinecolumn=function(t,n,r){return this.each(function(){var i=new glinecolumn(e(this),t,n,r);i.isEmpty()||(i.onDraw(),i.registerEvents())})},e.fn.glinecolumn.defaults={table:0,secondary:[1],params:{nostroke:0,shade:0,symbol:"o","stroke-width":4,dotsize:8,width:1.2,labelalign:"center",aideLine:3,axismin:{x:0},axis:[0,0,1,1]}}}(jQuery),function(e){e.fn.gpie=function(t,n,r){return this.each(function(){var i=new gpie(e(this),t,n,r);i.isEmpty()||(i.onDraw(),i.registerEvents(),i.ds.onselect.push(function(t){var n=e("<div style='text-align:left'>");n.append("<b>"+this.data.rows[this.r].value+"</b>"),n.append("<br/>"),n.append("<b>"+this.data.cols[0].value+":</b> "),n.append(this.data.rows[this.r].data[this.c].value),UIKit.Tip(n,t)}))})},e.fn.gpie.defaults={table:0,params:{needle:0,percentage:1},events:{}}}(jQuery),function(e){e.fn.gstackarea=function(t,n,r){return this.each(function(){var i=new gstackarea(e(this),t,n,r);i.isEmpty()||(i.onDraw(),i.registerEvents())})},e.fn.gstackarea.defaults={table:1,params:{nostroke:0,shade:1,stack:1,axis:[0,0,1,1],symbol:"o","stroke-width":"1",width:1,aideLine:3,axismin:{x:0}}}}(jQuery),function(e){e.fn.gstackcolumn=function(t,n,r){return this.each(function(){var i=new gstackcolumn(e(this),t,n,r);i.isEmpty()||(i.onDraw(),i.registerEvents())})},e.fn.gstackcolumn.defaults={table:1,params:{axis:[0,0,1,1],"stroke-width":"2",aideLine:3,stacked:1,labelalign:"center"}}}(jQuery),function(){"use strict";var e=function(e,t){this.dom=$(undefined),this.oAttrs={},this.aPermission=[],this.domFactory=function(){},arguments.length===1&&(typeof e=="object"?this.oAttrs=e:typeof e=="function"&&(this.domFactory=e)),arguments.length===2&&(this.domFactory=t,this.oAttrs=e),this.oAttrs=this.oAttrs||{},this.oAttrs.hasOwnProperty("permissions")&&(this.aPermission=this.oAttrs.permissions,delete this.oAttrs.permissions),this.hasPermission=function(){return window.c3.hasPermission(this.aPermission)},this.attr=function(e){var t;if(this.dom===undefined||e===undefined||e===null)return;for(t in e)e.hasOwnProperty(t)&&this.dom.attr(t,e[t])},this.hasPermission()&&(this.dom=this.domFactory.apply(this,null),this.attr(this.oAttrs))};window.BaseControl=e}(),function(){"use strict";var e=function(e){var t=function(){return $("<span>").addClass("split")};return new window.BaseControl(e,t)};window.Split=e}(),window.console==undefined&&(window.console={},window.console.log=function(e){});var ui={};ui.logLine=function(e,t,n,r,i){var s=e||0,o=r||new Date,u=t||"",a=n||{},f=i||null,l=$("<div>").addClass("log_line"),c=$("<div>").addClass("log_icon_error"),h=$("<div>").addClass("log_time"),p=$("<div>").addClass("log_code"),d=$("<div>").addClass("log_desc"),v=$("<div>").addClass("log_lnk"),m=this;f&&f!=""&&f==logType.Error?c=$("<div>").addClass("log_icon_error"):f&&f!=""&&f==logType.Warning?c=$("<div>").addClass("log_icon_warning"):f&&f!=""&&f==logType.Info?c=$("<div>").addClass("log_icon_info"):c=$("<div>").addClass("log_icon_error"),l.append(c),l.append(h),l.append(p),l.append(d),l.append(v);var g=$("<a href='#'>").append("Details").bind("click",function(e){m.logDetail&&m.logDetail.pop&&m.logDetail.close(),m.logDetail=new ui.logDetail(m),m.logDetail.show()});v.append(g),this.setTime=function(e){o=e||new Date,h.html(o.formatString())},this.getTime=function(){return o},this.setCode=function(e){s=e||0,p.html(s)},this.getCode=function(){return s},this.setDesc=function(e){u=e||"",d.html(u)},this.getDesc=function(){return u},this.setDetail=function(e){a=e||{}},this.getDetail=function(){return a},this.setType=function(e){f=e||"",c.removeClass(),f==logType.Error?c.addClass("log_icon_error"):f==logType.Warning?c.addClass("log_icon_warning"):f==logType.Info?c.addClass("log_icon_info"):c.addClass("log_icon_error")},this.getType=function(){return f},this.placeAt=function(e){$(e).append(l)},this.prepend=function(e){$(e).prepend(l)},this.refresh=function(e,t,n,r,i){var s="";i&&i!=""&&i==logType.Error?(l.addClass("hl_error"),s="hl_error"):i&&i!=""&&i==logType.Warning?(l.addClass("hl_warning"),s="hl_warning"):i&&i!=""&&i==logType.Info?(l.addClass("hl_info"),s="hl_info"):(l.addClass("hl_error"),s="hl_error"),e!=null&&(t==null||t.length==0)&&(t=" "),t&&this.setDesc(t),e&&this.setCode(e),n&&this.setDetail(n),r&&this.setTime(r),i&&this.setType(i),window.setTimeout(function(){l.removeClass(s)},1e3)},this.setTime(o),this.setCode(s),this.setDesc(u),this.setType(f)},ui.logDetail=function(e){this.base=c3.dialog,this.base();var t=$("<section>").addClass("wizard_lite"),n=e.getCode&&e.getCode()||0,r=e.getDesc&&e.getDesc()||"",i=e.getTime&&e.getTime()||new Date,s=e.getDetail&&e.getDetail()||{};t.append(Utility.CreateRow("Description",r)),t.append(Utility.CreateRow("Code",n)),t.append(Utility.CreateRow("Logged",i.formatString())),s.settings&&s.settings.url&&t.append(Utility.CreateRow("Service",s.settings.url));var o=$("<fieldset>").append($("<legend>").append("Parameters")),u=$("<div>");try{if(s.settings.data){var a=typeof s.settings.data=="string"?$.parseJSON(s.settings.data):s.settings.data;for(var f in a)f.indexOf("_")!=0&&u.append(Utility.CreateRow(f,a[f]))}}catch(l){}o.append(u),t.append(o),this.onInit=function(){this.content=t},this.getTitle=function(){return"Details"},this.onViewAppear=function(){this.btnFinish.hide()}},$(function(){window.ui.log=new function(){function c(t,n,r,i){if(n.readyState!=4||n.status==0)return;var s=e,o=retriveErrorMessage(n.responseText),u=retriveErrorCode(n.responseText);a.refresh(u,o,{response:n.responseText,settings:r},new Date);var c=new ui.logLine(u,o,{response:n.responseText,settings:r},new Date);c.prepend(f),l.push(c),p(c);var h=r;if(n.status=="401"){var d=new c3login;d.onSuccess.push(function(){$.ajax({beforeSend:h.beforeSend,data:h.data,dataType:h.dataType,contentType:h.contentType,password:h.password,username:h.username,timeout:h.timeout,type:h.type,jsonpCallback:h.jsonpCallback,processData:!1,url:h.url.toString(),success:h.success,complete:h.complete,error:h.error})}),d.show()}}function h(){n.empty(),i=$("<a href='#'>").addClass("toggle"),r=0;var e=$("<hgroup>").append($("<h1>").append("Transaction History Log: ").append(i).append(o).append(s));i.bind("click",function(){n.addClass("history"),$(window).resize()}),o.bind("click",function(){n.addClass("history"),$(window).resize();var e=$("#mask");if(e.size()>0){var t=parseInt(e.css("height"));isNaN(t)||e.css("height",t+"px")}}),s.bind("click",function(){n.removeClass("history"),$(window).resize()}),n.append(e),u=$("<section>").addClass("lastRecordPanel"),a=new ui.logLine,a.placeAt(u),f=$("<section>").addClass("historyPanel"),n.append(u),n.append(f),n.hide(),t.append(n)}function p(e){n.show(),$(window).resize(),r++,i.html(r),e.refresh(e.getCode(),e.getDesc(),e.getDetail(),e.getTime(),e.getType())}function d(e){a.refresh(e.getCode(),e.getDesc(),e.getDetail(),e.getTime(),e.getType()),e.prepend(f),l.push(e),p(e)}var e="error",t=null,n=$("<section>").addClass("translog"),r=0,i=null,s=$("<a href='#'>").addClass("minToggle"),o=$("<a href='#'>").addClass("maxToggle"),u=null,a=null,f=null,l=[];this.setContainer=function(e){t=e,$(t).ajaxError(function(e,t,n){if(t.status!==503)c(e,t,n);else if(t.status===503){var r=new c3login;r.show()}}),odataclient.onError(function(e,t,n){var r=retriveErrorMessage(e.responseText),i=retriveErrorCode(e.responseText);a.refresh(i,r,{response:e.responseText},new Date,logType.Error);var s=new ui.logLine(i,r,{response:e.responseText},new Date,logType.Error);s.prepend(f),l.push(s),p(s);if(e.statusCode===401){var o=new c3login;o.onSuccess.push(function(){OData.request(t.request,n)}),o.show()}}),h()},this.show=c,this.addLog=d}});var c3config={SLDPath:"sld/sld.svc",SLDVersion:"0100",Version:"2011-12-15-V2",TestDBConnectionTimeout:5e3,Clocker:10,DefaultSelectedPageIndex:0};(function(e,t){var n=function(e,t,n){n(odataclient.oDataQueryResult(e,t),t)},r=[],i=function(e){return{statusCode:e.statusCode,statusText:e.statusText,responseText:e.body}};window.odataclient={getBaseUrl:function(e){return this.baseUrl||(this.baseUrl=location.protocol+"//"+location.host),this.baseUrl},getServiceUrl:function(e){return e=e.toLowerCase(),e.endsWith("sld.svc")&&(e=e.replace("sld.svc","sld"+c3config.SLDVersion+".svc")),this.getBaseUrl(e)+"/"+e},oDataUrl:function(n){var r,i,s,o,u,a=function(e){return e.replace(/^\/+|\/+$/g,"")},f=function(e){return e.replace(/\/+$/g,"")},l=jQuery.trim;return s={count:!1,resource:null,root:null,value:!1,options:{callback:null,expand:null,filter:null,orderby:null,inlinecount:!1,skip:null,skiptoken:null,params:null,top:null}},n!==t&&(e.isPlainObject(n)?n.segments===t?e.extend(!0,s,n):e.extend(!0,s,n.segments):typeof n=="string"&&e.extend(!0,s,{root:n})),i=null,u=function(e,n){var r,i,s,o,u,a;n=n||this.segments.root,r=odataclient.oDataUrl(),a=e.split("?"),a.length>2,o=a[1],r.segments.root=n,i=a[0].toUpperCase(),n=n.toUpperCase();if(i.indexOf(n)===0)s=a[0].slice(n.length);else if((u=i.indexOf(n))>0)s=a[0].slice(n.length+u);else{u=0;do n=n.slice(1),u+=1;while(n.length>0&&i.indexOf(n)!==0);s=a[0].slice(n.length)}a=s.split("/$value"),r.segments.value=a.length===2,s=a[0],a=s.split("/$count"),r.segments.count=a.length===2,s=a[0],!r.segments.value&&(a=s.split("/$links/")).length===2?r.segments.resource=a[0]:r.segments.resource=s;if(o!==t&&o.length>0){a=o.split("&");for(u=0;u<a.length;u+=1)a[u]=a[u].split("=");while(a.length>0){i=a.pop();switch(i[0]){case"$top":r.segments.options.top=i[1];break;case"$skip":r.segments.options.skip=i[1];break;case"$orderby":r.segments.options.orderby=i[1];break;case"$filter":r.segments.options.filter=i[1];break;case"$expand":r.segments.options.expand=i[1];break;case"$skiptoken":r.segments.options.skiptoken=i[1];break;case"$inlinecount":r.segments.options.inlinecount=i[1]==="allpages";break;case"$format":r.segments.options.format=i[1];break;default:r.segments.options.params===null&&(r.segments.options.params={}),r.segments.options.params[i[0]]=i[1]}}}return r},o=function(e){var n,r,i,s=!1,o,u="";e=e||this,r=e.segments,n=r.options;if(r.root===null)return"";o=r.resource!==null?a(l(r.resource)):"",r.count?o+="/$count":r.value&&(o+="/$value");for(i in n)if(i!==t&&n[i]!==null)switch(i){case"params":for(i in n.params)i!==t&&(s&&(u+="&"),u+=i+"="+n.params[i],s=!0);break;case"inlinecount":if(n.inlinecount){s&&(u+="&"),u+="$inlinecount=allpages",s=!0;break}break;case"format":if(n[i]==="json"&&(r.count||r.value))break;case"callback":case"top":case"skip":case"filter":case"orderby":case"expand":case"skiptoken":s&&(u+="&"),u+="$"+i+"="+n[i],s=!0}return e.url=f(l(r.root)),e.url+=o!==""?"/"+o:"",e.url+=u!==""?"?"+u:"",e.url},r={},r.segments=s,r.parse=u,r.url=i,r.toString=r.toLocaleString=o,r.isLocalService=r.segments.root!==null&&(!/^http:\/\/|https:\/\//i.test(r.segments.root)||r.segments.root.toLowerCase().indexOf(location.protocol+"//"+location.host)===0),r},oData:function(n,r){var i;i={},i.settings=r||{},i.url=odataclient.oDataUrl(n),this.groupids!==t&&(i.actorGroupId=this.groupids);var s=function(e){i.actorGroupId!==t&&(e.headers.actorGroupId=i.actorGroupId)};return i.from=function(t){return odataclient.oDataQuery.apply(e.extend({},this),[t])},i.query=function(t){var n={};e.isFunction(t)&&(t={success:t}),i=e.extend(!0,{},this);var r={requestUri:i.url.toString(),headers:{Accept:"application/json, text/plain","SBO-SLD-APP-ID":c3Identifier.AppIdentifier,securityToken:window.localStorage.getItem("securityToken")},method:"GET"};s(r),odataclient.callService(r,t.success,t.error)},i.create=function(t,n,r){typeof r=="function"&&(r={success:r});var i=e.extend(!0,{},this);i.url.segments.resource=t;var o={requestUri:i.url.toString(),headers:{Accept:"application/json, text/plain","SBO-SLD-APP-ID":c3Identifier.AppIdentifier,securityToken:window.localStorage.getItem("securityToken")},method:"POST",data:n};s(o),odataclient.callService(o,r.success,r.error)},i.update=function(t,n,r){var i,o;e.isFunction(r)&&(r={success:r}),i=e.extend(!0,{},this),i.url.segments.resource=t;var u={requestUri:i.url.toString(),headers:{Accept:"application/json, text/plain","SBO-SLD-APP-ID":c3Identifier.AppIdentifier,securityToken:window.localStorage.getItem("securityToken")},method:"MERGE",data:n};s(u),odataclient.callService(u,r.success,r.error)},i.remove=function(t,n,r){typeof r=="function"&&(r={success:r});var i=e.extend(!0,{},this);i.url.segments.resource=t;var o={requestUri:i.url.toString(),headers:{Accept:"application/json, text/plain","SBO-SLD-APP-ID":c3Identifier.AppIdentifier,securityToken:window.localStorage.getItem("securityToken")},method:"DELETE",data:n};s(o),odataclient.callService(o,r.success,r.error)},i},oDataBatch:function(t,n){var r={};r.options=n||{},r.rootUrl=t;var i={Accept:"application/json, text/plain","Content-Type":"application/atom+xml;type=entry","SBO-SLD-APP-ID":c3Identifier.AppIdentifier,securityToken:window.localStorage.getItem("securityToken")};return setActasGroup(request),r.requests=[],r.createRequest=function(e,t){r.requests.push({headers:i,requestUri:e,method:"POST",data:t})},r.callRequest=function(e,t,n){n||(n="GET"),r.requests.push({headers:i,requestUri:e,method:n,data:t})},r.removeRequest=function(e,t){r.requests.push({headers:i,requestUri:e+"("+t.ID+")",method:"DELETE",data:t})},r.updateRequest=function(e,t){r.requests.push({headers:i,requestUri:e+"("+t.ID+")",method:"MERGE",data:t})},r.readRequest=function(e){typeof e=="object"?r.requests.push({headers:i,requestUri:e.url.toString(),method:"GET"}):r.requests.push({headers:i,requestUri:e,method:"GET"})},r.from=function(t){var n={};return n.url=odataclient.oDataUrl(""),odataclient.oDataQuery.apply(e.extend({},n),[t])},r.execute=function(t){var n,i;e.isFunction(t)?(n=t,i=t):(n=t.success,i=t.error);var s={Accept:"application/atom+xml,application/xml","Accept-Charset":"UTF-8","SBO-SLD-APP-ID":c3Identifier.AppIdentifier,securityToken:window.localStorage.getItem("securityToken")};setActasGroup(request),odataclient.executeBatch(r.rootUrl,s,r.requests,n,i)},r},oDataQuery:function(n){var r=this,i,s,o,u,a,f,l,c,h;return a=function(t){var n;return n=e.extend(!0,{},this),n.url.segments.options.top=t,n},u=function(t){var n;return n=e.extend(!0,{},this),n.url.segments.options.orderby=t,n},f=function(t){var n;return n=e.extend(!0,{},this),n.url.segments.options.skip=t,n},l=function(t){var n;return n=e.extend(!0,{},this),n.url.segments.options.filter=t,n},c=function(t){var n;return n=e.extend(!0,{},this),n.url.segments.options.expand=t,n},h=function(n){var r;return n=n===t?!0:n,r=e.extend(!0,{},this),r.url.segments.options.inlinecount=n,r},o=function(t){var n;return n=e.extend(!0,{},this),n.url.segments.options.params=t,n},s=function(n){var r,i=!0,s=n;typeof n=="boolean"?i=n:e.isFunction(n)?s={success:n}:n===t&&(i=!1),r=e.extend(!0,{},this),r.url.segments.count=!0;if(!i)return r;r.query(s)},i=function(n){var r,i=!0,s=n;typeof n=="boolean"?i=n:e.isFunction(n)?s={success:n}:n===t&&(i=!1),r=e.extend(!0,{},this),r.url.segments.value=!0;if(!i)return r;r.query(s)},r.url.segments.resource=n,r.value=i,r.count=s,r.params=o,r.orderby=u,r.top=a,r.skip=f,r.filter=l,r.expand=c,r.inlinecount=h,r},oDataQueryResult:function(e,n){var r={};return e?e.results===t?r.data=e:r.data=e.results:r.data=[],n!==t?(r.status=n.statusCode,r.statusText=n.statusText):e&&e.response&&(r.status=e.response.statusCode,r.statusText=e.response.statusText,r.responseText=e.response.body),r},executeError:function(t,n){if(e.isFunction(n)){var r={};r.data={},r.data.response=t.response,r.responseText=t.response.body,n(r,t.statusText)}},executeQuery:function(e,r,i){OData.read(e,function(e,t){n(e,t,r)},i===t?t:function(e,t){n(e,t,i)})},getSLDMessage:function(e){var t=odataclient.getServiceUrl(c3config.SLDPath),n="GetMessageList?MessageKey='"+e+"'",r=odataclient.oData(t,{}).from(n);r.query(function(e){if(e&&e.data&&e.data.length>0)for(var t=0;t<e.data.length;t++)e.data[t].severity=="WARN"?log.warning(e.data[t].category,e.data[t].content,{}):e.data[t].severity=="INFO"?log.info(e.data[t].category,e.data[t].content,{}):e.data[t].severity=="ERROR"&&log.error(e.data[t].category,e.data[t].content,{})})},callService:function(e,t,s){var o=function(e,r){if(r.headers["SLD-MESSAGE-KEY"]){var i=r.headers["SLD-MESSAGE-KEY"];i&&i!=""&&odataclient.getSLDMessage(i)}n(e,r,t)},u=[e,o],a;r.length>0?a=function(e){s&&s(i(e.response),e,o);for(var t=0;t<r.length;t++)r[t](i(e.response),e,o)}:a=s,a&&u.push(a),OData.request.apply(OData,u)},executeBatch:function(e,t,n,r,i){var s={headers:t,requestUri:e+"$batch",method:"POST",data:{__batchRequests:[{__changeRequests:n}]}};OData.request(s,r,i,OData.batchHandler)},onError:function(e){r.push(e)}}})(jQuery);var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createHostingUnit:function(e,t){var n={ServiceUnit:e},r=JSON.stringify(n);$.c3BaseClient.callBindingService("POST",sldEntitySet.ServiceUnits,"CreateServiceUnitAsync",r,t)},updateHostingUnit:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.ServiceUnits,e,t)},deleteHostingUnit:function(e,t){$.c3BaseClient.callBindingService("POST",sldEntitySet.ServiceUnits,"DeleteServiceUnit",null,t,e)},getHostingUnits:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.ServiceUnits,e);return t},getHUStatusValues:function(e){return this.getValidValues(sldEntityType.ServiceUnit,sldEntity.ServiceUnit.Status,e)},getHUPurposeValues:function(e){return this.getValidValues(sldEntityType.ServiceUnit,sldEntity.ServiceUnit.Purpose,e)},getHUModes:function(e){return this.getValidValues(sldEntityType.ServiceUnit,sldEntity.ServiceUnit.Mode,e)},getHigherVersionBySUnit:function(e,t){var n={SUnitID:e};$.c3BaseClient.callNormalService("POST","GetHigherIPRList",n,t)},PreUpgradeTesting:function(e,t,n){var r={TargetVersionSoftwareRepositoryID:t};$.c3BaseClient.callBindingService("POST",sldEntitySet.CompanyDatabases,"PreUpgradeTestingAsync",r,n,e)},getExtensionDeployments:function(e){return $.c3BaseClient.getData(this.serviceName,"ExtensionDeployments",e)},deleteExtensionDeployments:function(e,t){$.c3BaseClient.callBindingService("POST","ExtensionDeployments("+e.ID+")","Undeploy",null,t)},createExtensionDeployments:function(e,t){var n="CreateExtensionDeploymentAsync",r={ExtensionDeploymentParameter:{CommonDatabaseID:e.CommonDatabaseID,ExtensionID:e.ExtensionID,Properties:e.DeploymentProperties}};$.c3BaseClient.callNormalService("POST",n,JSON.stringify(r),t)},getMonitorStatusBySuID:function(e,t){var n=1;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckServiceUnitStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckServiceUnitStatusByID",{CacheMode:n},t)},getCachedMonitorStatusBySuID:function(e,t){var n=2;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckServiceUnitStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckServiceUnitStatusByID",{CacheMode:n},t)},getExtesnionInstallations:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.ExtensionInstallations,e)},updateExtensionInstallations:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.ExtensionInstallations,e,t)},RegisterPresentationServerAsync:function(e,t,n,r,i,s){var o={PresentationServerID:e,UserName:"'"+i+"'",Password:"'"+s+"'"};n==1&&(o.KillAllSessions=!0),$.c3BaseClient.callBindingService("POST",sldEntitySet.ServiceUnits,"RegisterPresentationServerAsync",o,r,t)},RegisterBrowserAccessServerAsync:function(e,t,n,r,i,s){var o={BrowserAccessServerID:e,UserName:"'"+i+"'",Password:"'"+s+"'"};n==1&&(o.KillAllSessions=!0),$.c3BaseClient.callBindingService("POST",sldEntitySet.ServiceUnits,"RegisterBrowserAccessServerAsync",o,r,t)},createServiceUnitFromReference:function(e,t){var n={ServiceUnit:e},r=JSON.stringify(n);$.c3BaseClient.callBindingService("POST",sldEntitySet.ServiceUnits,"CreateServiceUnitAsync",r,t)},validateClientAgentServiceAccount:function(e,t){var n={ClientAgentServiceAccount:e},r=JSON.stringify(n);$.c3BaseClient.callNormalService("POST","ValidateClientAgentServiceAccount",r,t)},getLastUpgradeSimulations:function(e,t){return $.c3BaseClient.callBindingService("GET",sldEntitySet.ServiceUnits,"GetLastUpgradeSimulations",{},t,e)},generateDomainGroups:function(e,t){$.c3BaseClient.callBindingService("POST",sldEntitySet.ServiceUnits,"GenerateDomainGroups",null,t,e)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createTenant:function(e,t){var n={Tenant:e},r=JSON.stringify(n);$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,"CreateTenantAsync",r,t)},registerTenant:function(e,t){var n={Tenant:e},r=JSON.stringify(n);$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,"RegisterTenantAsync",r,t)},isEnableRegisterTenant:function(){var e=null,t=sldEntitySet.Tenants+"/IsEnableRegisterTenant";return e=$.c3BaseClient.getData(this.serviceName,t),e},updateTenant:function(e,t){var n={TenantParam:e},r=JSON.stringify(n);$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,"UpdateTenant",r,t,e.ID)},updateTenantField:function(e,t){e.CompanyDatabase=undefined,$.c3BaseClient.updateData(this.serviceName,sldEntitySet.Tenants,e,t)},deleteTenant:function(e,t){$.c3BaseClient.callBindingService("POST","Tenants","DeleteTenant",null,t,e)},getTenants:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.Tenants,e);return t},getTenantStatus:function(e){return this.getValidValues(sldEntityType.Tenant,sldEntity.Tenant.Status,e)},getTenantPurpose:function(e){return this.getValidValues(sldEntityType.Tenant,sldEntity.Tenant.Purpose,e)},preUpgradeCompanyDB:function(e,t){var n="PreUpgradeCompanyDBAsync",r={ID:e.Id,TargetVersionIPR:e.TargetVersionIPR,hostingUnitID:e.HostingUnitId};$.c3BaseClient.callNormalService(this.serviceName,"GET",n,r,t)},upgradeTenant:function(e,t){var n="TenantUpgradeAsync",r={TenantID:e.TenantID,TargetHUID:e.TargetHUID,StagingHUID:e.StagingHUID};$.c3BaseClient.callNormalService(this.serviceName,"GET",n,r,t)},getLastPreUpgradeTestingResult:function(e,t,n,r){var i={FilterFlag:n};t!=null&&(i.TargetVersion="'"+t+"'"),$.c3BaseClient.callBindingService("POST","CompanyDatabases","GetLastPreUpgradeResult",i,r,e)},createCompanyDB:function(e,t){var n="CreateCompanyDatabaseAsync",r={};for(var i in e)typeof e[i]=="string"?r[i]="'"+e[i]+"'":r[i]=e[i];$.c3BaseClient.callNormalService("GET",n,r,t)},updateCompanyDB:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.CompanyDatabases,e,t)},deleteCompanyDB:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.CompanyDatabases,e,t)},getCompanyDBs:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.CompanyDatabases,e);return t},getLocalizationList:function(e){var t=sldEntitySet.CommonDatabases+"("+e+")/GetLocalizationList",n=$.c3BaseClient.getData(this.serviceName,t);return n},getChartOfAccountList:function(e,t){var n=sldEntitySet.CommonDatabases+"("+e+")/GetChartOfAccountList?Localization='"+t+"'",r=$.c3BaseClient.getData(this.serviceName,n);return r},getBaseLanguageList:function(e){var t=sldEntitySet.SoftwareRepositories+"("+e+")/GetLanguageList",n=$.c3BaseClient.getData(this.serviceName,t);return n},fillB1UserBindingsByCompanyDB:function(e){var t=null,n="";return n="?ID="+e,t=$.c3BaseClient.getData(this.serviceName,"FillSBOUserBindingsByCompanyDB"+n),t},createCompanyDBFromPackage:function(e,t){var n="CreateFromSolutionPackageAsync",r={};for(var i in e)typeof e[i]=="string"?r[i]="'"+e[i]+"'":r[i]=e[i];$.c3BaseClient.callNormalService("GET",n,r,t)},getSolutionPackageFiles:function(e){var t=null,n="GetSolutionPackageList?ImplementationRepositoryID="+e;return t=$.c3BaseClient.getData(this.serviceName,n),t},getSolutionPackageContent:function(e,t,n){var r={PackageFilePath:"'"+e+"'",SoftwareRepositoryID:t};return $.c3BaseClient.callNormalService("POST","GetSolutionPackageContentAsync",r,n)},getTrialPeriod:function(e){var t=sldEntitySet.CompanyDatabases+"("+e+")/GetTrialPeriod",n=$.c3BaseClient.getData(this.serviceName,t);return n},getRemainingDays:function(e){var t=sldEntitySet.CompanyDatabases+"("+e+")/GetRemainingDays",n=$.c3BaseClient.getData(this.serviceName,t);return n},setTrialPeriod:function(e,t,n){var r={},i="SetTrialPeriod?ExtendTrialPeriod="+t;$.c3BaseClient.callBindingService("POST",sldEntitySet.CompanyDatabases,i,r,n,e)},checkDatabaseExist:function(e,t){var n=null,r=sldEntitySet.DatabaseInstances+"("+e+")/CheckDatabaseExist?DBName='"+t+"'";return n=$.c3BaseClient.getData(this.serviceName,r),n},getCompanyTemplateRepositoriesByID:function(e){var t=null,n=sldEntitySet.CompanyTemplateRepositories+"("+e+")/GetCompanyTemplates";return t=$.c3BaseClient.getData(this.serviceName,n),t},getDbInstanceCompaniesList:function(e,t,n){var r=null,i=sldEntitySet.DatabaseInstances+"("+e+")/GetCompanyDatabases?Refresh='"+t+"'";return r=$.c3BaseClient.getData(this.serviceName,i),r},getTenantUsers:function(e){var t=sldEntitySet.Tenants+"("+e+")/GetUsers";return $.c3BaseClient.getData(this.serviceName,t)},getExtensionAssignments:function(e){return $.c3BaseClient.getData(this.serviceName,"ExtensionAssignments",e)},getUserPreference:function(e){return $.c3BaseClient.getData(this.serviceName,"ExtensionUserPreferences",e)},updateUserPreference:function(e,t){$.c3BaseClient.updateData(this.serviceName,"ExtensionUserPreferences",e,t)},createExtensionAssignment:function(e,t){var n=JSON.stringify(e);return $.c3BaseClient.callNormalService("POST","CreateExtensionAssignment",n,t)},MoveTenantAsync:function(e,t,n){var r={TargetSUID:t};$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,"MoveTenantAsync",r,n,e)},UpgradeTenantAsync:function(e,t){var n={};$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,"UpgradeTenantAsync",n,t,e)},MoveAndUpgradeTenantAsync:function(e,t,n,r,i,s,o,u){var a=utf8Encode(JSON.stringify(o)),f={TargetServiceUnitID:n,StagingServiceUnitID:t,TenantUpgradeParam:JSON.stringify({ConfirmWarnings:r,NewCompanyDatabaseName:i,ExtraData:a,UpgradeSimulation:u})};$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,"TenantUpgradeAsync",f,s,e)},deleteExtensionAssignments:function(e,t){$.c3BaseClient.deleteData(this.serviceName,"ExtensionAssignments",e,t)},getActiveConnections:function(e,t){$.c3BaseClient.callBindingService("POST",sldEntitySet.CompanyDatabases,"GetActiveConnectionList",{},t,e)},getUndeloyedExtensionsForTenantUpgrade:function(e,t,n){var r={TenantIDList:e,TargetServiceUnitID:t},i=JSON.stringify(r);return $.c3BaseClient.callNormalService("POST","GetUnpreparedExtensionsForTenantUpgrade",i,n)},DuplicateTenantAsync:function(e,t,n,r,i){var s=utf8Encode(JSON.stringify(r));t.ExtraData=s;var o={DuplicateTenantParam:t};n&&n>0&&(o.StagingServiceUnitID=n);var u=JSON.stringify(o);$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,"DuplicateTenantAsync",u,i,e)},GenerateTenantDynamicKey:function(e,t){var n={};$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,"GenerateTenantDynamicKey",n,t,e)},loadTenantUsers:function(e,t){var n=sldEntitySet.Tenants+"("+e+")/LoadTenantUsers";return $.c3BaseClient.getData(this.serviceName,n)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createCustomer:function(e,t){var n={Customer:e};c3.service.getUserStorages().query(function(e){e.data&&e.data.length>0?n.Customer.UsersStorageParam={ID:e.data[0].ID}:n.Customer.UsersStorageParam=null;var r=JSON.stringify(n);$.c3BaseClient.callBindingService("POST",sldEntitySet.Customers,"CreateCustomerAsync",r,t)})},updateCustomer:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.Customers,e,t)},deleteCustomer:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.Customers,e,t)},getCustomers:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.Customers,e);return t},getCustomerStatus:function(e){return this.getValidValues(sldEntityType.Customer,sldEntity.Customer.Status,e)},getCustomerType:function(e){return this.getValidValues(sldEntityType.Customer,sldEntity.Customer.Type,e)},getTrialRequests:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.TrialRequests,e);return t},updateTrialRequest:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.TrialRequests,e,t)},getTrialRequestStatus:function(e){return this.getValidValues(sldEntityType.TrialRequest,sldEntity.TrialRequest.RequestStatus,e)},abortInProcessTrialRequest:function(e,t){var n={};$.c3BaseClient.callBindingService("POST",sldEntitySet.TrialRequests,"AbortInProcessTrialRequest",n,t,e)},retrieveAvailableLicenseFiles:function(e,t){var n={};$.c3BaseClient.callBindingService("POST",sldEntitySet.Customers,"RetrieveAvailableLicenseFiles",n,t,e)},changeInstallationNumber:function(e,t,n){var r={};r[sldEntity.Customer.InstallationNumber]="'"+t+"'",$.c3BaseClient.callBindingService("POST",sldEntitySet.Customers,"ChangeInstallationNumber",r,n,e)},getOperatorDetailsByCustomer:function(e,t){var n={};$.c3BaseClient.callBindingService("GET",sldEntitySet.Customers,"GetOperatorDetailsByCustomer?CustomerID="+e,n,t)},updateQuota:function(e,t,n,r){var i={};i.ModuleName="'"+t+"'",i.QuotaNumber="'"+n+"'",$.c3BaseClient.callBindingService("POST",sldEntitySet.Customers,"UpdateQuota",i,r,e)},ResetQuota:function(e,t,n){var r={};r.ModuleName="'"+t+"'",$.c3BaseClient.callBindingService("POST",sldEntitySet.Customers,"ResetQuota",r,n,e)},getLicenseQuotas:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.LicenseQuotas,e);return t}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{setGlobalSettings:function(e,t){var n=JSON.stringify(e),r="SetGlobalSettings";return $.c3BaseClient.callBindingService("POST",sldEntitySet.GlobalSettings,r,n,t)},getGlobalSettings:function(e){return $.c3BaseClient.getData(this.serviceName,"GetGlobalSettings?Parameter='"+e+"'")},UpdateMachineStatusQueryInterval:function(e){var t={};$.c3BaseClient.callNormalService("POST","UpdateMachineStatusQueryInterval",t,e)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{getAuditLog:function(e,t){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.ChangeLogs)},getResourceName:function(){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.Resources)},getAuditLogDetail:function(){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.ChangeLogDetails)}});var c3=c3||{};c3.oData=c3.oData||{},c3.oData.User={createTenantUser:function(e,t,n){var r={Users:t},i=JSON.stringify(r),s="BindUser";$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,s,i,n,e)},deleteTenantUser:function(e,t){var n=sldEntitySet.Tenants+"("+t+")/UnbindUser?UserID="+e;return $.c3BaseClient.getData(this.serviceName,n)},createCustomerUser:function(e,t,n){var r={User:t},i=JSON.stringify(r),s="AddUser";$.c3BaseClient.callBindingService("POST",sldEntitySet.Customers,s,i,n,e)},deleteCustomerUser:function(e,t){var n=sldEntitySet.Customers+"("+t+")/RemoveUser?UserID="+e;return $.c3BaseClient.getData(this.serviceName,n)},createTenantServiceUser:function(e,t,n,r){var i={Users:t};n!==undefined&&(i.SuppressError=n);var s=JSON.stringify(i),o="BindServiceUser";$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,o,s,r,e)},getAllUserDetails:function(e,t){var n="GetAllUserDetails";$.c3BaseClient.callBindingService("GET",sldEntitySet.Users,n,e,t)},getRolesByUser:function(e,t){var n={};$.c3BaseClient.callBindingService("GET",sldEntitySet.Users,"GetRoles",n,t,e.ID)},getOSUserBindings:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.SystemUserBindings,e)},getSBOUserBindings:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.SBOUserBindings,e)},createUser:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.Users,e,t)},deleteUser:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.Users,e,t)},updateUser:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.Users,e,t)},getUserBindingsByUserId:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.Users,e);return t},updateTenantUser:function(e,t,n){var r={Users:t},i=JSON.stringify(r);$.c3BaseClient.callBindingService("POST",sldEntitySet.Tenants,"UpdateUser",i,n,e)},getUsersByGroup:function(e){var t=null,n=sldEntitySet.Groups+"("+e+")/GetAllUsers";return t=$.c3BaseClient.getData(this.serviceName,n),t},findCustomerByUser:function(e,t){var n={OSUserName:"'"+e+"'"};$.c3BaseClient.callBindingService("Get",sldEntitySet.Users,"FindCustomer",n,t)},getCurrentUser:function(){var e=$.c3BaseClient.getData(this.serviceName,"CurrentUser");return e},getUserStatus:function(e){return this.getValidValues(sldEntityType.User,sldEntity.User.Status,e)},getRoles:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.Roles,e);return t},CheckSystemUserExists:function(e){var t=$.c3BaseClient.getData(this.serviceName,"CheckSystemUserExists?Account='"+encodeURIComponent(e)+"'");return t},checkSBOUser:function(e,t,n,r){var i="CheckSBOUser?SBOUsername='"+e+"'&SystemUsername='"+t+"'&InstallationNumber='"+n+"'&CustomerID="+r;return $.c3BaseClient.getData(this.serviceName,i)},getDomainName:function(){var e=$.c3BaseClient.getData(this.serviceName,"GetDomainName");return e},getCurrentPrivilegeHandler:function(e){var t={};$.c3BaseClient.callNormalService("GET","IsPrivilegeCredentialRemembered",t,e)},setPrivilegeHandler:function(e,t,n,r){var i={Account:"'"+e+"'",Password:"'"+t+"'",RememberCredential:n};$.c3BaseClient.callNormalService("POST","SetPrivilegeCredential",i,r)},addDomainUser:function(e,t,n){var r={NewAccount:"'"+e+"'",NewPassword:"'"+t+"'"};$.c3BaseClient.callNormalService("POST","AddDomainUser",r,n)}},c3.service=c3.service||{},$.extend(c3.service,c3.oData.User);var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createLicenseServer:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.LicenseServers,e,t)},updateLicenseServer:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.LicenseServers,e,t)},deleteLicenseServer:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.LicenseServers,e,t)},getLicenseServers:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.LicenseServers,e);return t},getLicenseFiles:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.LicenseFiles,e);return t},getLicenseModulesByLicenseFileId:function(e){var t=null,n=sldEntitySet.LicenseFiles+"("+e+")/GetLicenseModules";return t=$.c3BaseClient.getData(this.serviceName,n),t},getLicenseModulesBySBOUser:function(e,t){var n=null,r=sldEntitySet.LicenseFiles+"("+e+")/GetLicenseModulesBySBOUser?SBOUserName='"+t+"'";return n=$.c3BaseClient.getData(this.serviceName,r),n},getLicenseModulesPerCustomer:function(e,t){var n=null,r=sldEntitySet.LicenseFiles+"("+e+")/GetLicenseModulesPerCustomer?CustomerID="+t;return n=$.c3BaseClient.getData(this.serviceName,r),n},getLicenseAssignmentsByLicenseFile:function(e){var t=null,n=sldEntitySet.LicenseFiles+"("+e+")/GetLicenseAssignments";return t=$.c3BaseClient.getData(this.serviceName,n),t},getLicenseServerStatus:function(e){return this.getValidValues(sldEntityType.LicenseServer,sldEntity.LicenseServer.Status,e)},getLicenseServerAvailableStatus:function(e,t){var n=1;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckLicenseServerStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckLicenseServerStatusByID",{CacheMode:n},t)},getLicenseServerCachedStatus:function(e,t){var n=2;e!==undefined&&e!==null&&e.length>0?$.c3BaseClient.callNormalService("GET","CheckLicenseServerStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckLicenseServerStatusByID",{CacheMode:n},t)},getLicenseServerLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.LicenseServer,sldEntity.LicenseServer.LifeCycleStatus,e)},importLicenseFile:function(e,t){var n="ImportLicenseFile";$.c3BaseClient.uploadFile(this.serviceName,n,e,t)},parseLicenseFile:function(e,t){var n="ParseLicenseFile",r=sldEntitySet.LicenseFiles;$.c3BaseClient.uploadFile(this.serviceName,n,e,t,r)},syncLicenseFiles:function(e,t){var n={};$.c3BaseClient.callBindingService("POST",sldEntitySet.LicenseServers,"SyncLicenseFiles",n,t,e)},importLicenseFileUpload:function(e,t){var n=this.serviceName,r=$("<iframe>").attr({src:""}),i=!1;return $("body").append(r),r.hide(),r.load(function(){if(!i){var s=$("<form>").attr({method:"post",action:"/"+n+"/ImportLicenseFile",enctype:"multipart/form-data"});actualInput=$(e).clone(),actualInput.insertBefore($(e)),s.append($(e)),r.contents().find("body").append(s),s.submit(),i=!0}else{try{var o=r.contents().find("body").text();json=$.parseJSON(o),json&&json.d&&json.d.ImportLicenseFile&&t.success?t.success.call(window,json):t.error&&t.error.call(window,json)}catch(u){t.error&&t.error.call(window,r.contents())}r.remove()}}),i},testConnectLicenseServerByServerName:function(e,t){var n={ServerName:"'"+e+"'"};$.c3BaseClient.callBindingService("GET",sldEntitySet.LicenseServers,"TestConnectionByServerName",n,t)},testConnectLicenseServerByID:function(e,t){var n={};$.c3BaseClient.callBindingService("GET",sldEntitySet.LicenseServers,"TestConnection",n,t,e)},deployLiscenseServer:function(e,t,n){"use strict";var r={};r.SoftwareRepositoryId=t,$.c3BaseClient.callBindingService("POST",sldEntitySet.LicenseServers,"DeployLicenseServerAsync",r,n,e)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createCommonDB:function(e,t){var n="CreateCommonDatabaseAsync",r={};for(var i in e)typeof e[i]=="string"?r[i]="'"+e[i]+"'":r[i]=e[i];$.c3BaseClient.callBindingService("POST",sldEntitySet.CommonDatabases,n,r,t)},isEditableCommonDatabaseName:function(){var e=null,t=sldEntitySet.CommonDatabases+"/IsEditableCommonDatabaseName";return e=$.c3BaseClient.getData(this.serviceName,t),e},registerCommonDB:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.CommonDatabases,e,t)},updateCommonDB:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.CommonDatabases,e,t)},deleteCommonDB:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.CommonDatabases,e,t)},getCommonDBs:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.CommonDatabases,e);return t},getCommonDBStatus:function(e){return this.getValidValues(sldEntityType.CommonDatabase,sldEntity.CommonDatabase.Status,e)},getCommonDBLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.CommonDatabase,sldEntity.CommonDatabase.LifeCycleStatus,e)},getCachedCommonDBMonitorStatus:function(e,t){var n=2;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckCommonDatabaseStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckCommonDatabaseStatusByID",{CacheMode:n},t)},getCommonDBMonitorStatus:function(e,t,n){t!==undefined&&t!==null&&t.length>0?$.c3BaseClient.callNormalService("GET","CheckCommonDatabaseStatus",{DatabaseInstanceName:"'"+e+"'",CommonDatabaseName:"'"+t+"'"},n):$.c3BaseClient.callNormalService("GET","CheckCommonDatabaseStatus","",n)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createDBServerInstance:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.DatabaseInstances,e,t)},updateDBServerInstance:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.DatabaseInstances,e,t)},deleteDBServerInstance:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.DatabaseInstances,e,t)},getDBServerInstances:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.DatabaseInstances,e);return t},getDBStatus:function(e){return this.getValidValues(sldEntityType.DatabaseInstance,sldEntity.DatabaseInstance.Status,e)},getCachedDBInstanceMonitorStatus:function(e,t){var n=2;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckDatabaseInstanceStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckDatabaseInstanceStatusByID",{CacheMode:n},t)},getDBInstanceMonitorStatus:function(e,t){var n=1;e!==undefined&&e!==null&&e.length>0?$.c3BaseClient.callNormalService("GET","CheckDatabaseInstanceStatus",{DatabaseInstanceName:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckDatabaseInstanceStatus",{CacheMode:n},t)},getDBLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.DatabaseInstance,sldEntity.DatabaseInstance.LifeCycleStatus,e)},getDBTypes:function(e){return this.getValidValues(sldEntityType.DatabaseInstance,sldEntity.DatabaseInstance.ServerType,e)},retrieveSQLInstances:function(e,t){var n=null,r="";e!==undefined&&(r="?HostName='"+e+"'"),n=$.c3BaseClient.getData(this.serviceName,"RetrieveSQLInstances"+r),n.query(t)},testConnectDBServer:function(e,t,n,r,i,s){var o=null,u="";if(n==1||n==undefined){var a={ServerType:"'"+t+"'",ServerName:"'"+e+"'"};$.c3BaseClient.callNormalService("POST","TestDBServerConnection",a,s)}else if(n==0){var a={ServerType:"'"+t+"'",ServerName:"'"+e+"'",IsTrustedConnection:n,Username:"'"+r+"'",Password:"'"+i+"'"};$.c3BaseClient.callNormalService("POST","TestDBServerConnection",a,s)}return o},CheckDatabaseExist:function(e,t,n){var r={DBName:"'"+t+"'"};$.c3BaseClient.callBindingService("POST","DatabaseInstances","CheckDatabaseExist",r,n,e)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createPresentationServer:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.PresentationServers,e,t)},updatePresentationServer:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.PresentationServers,e,t)},deletePresentationServer:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.PresentationServers,e,t)},getPresentationServers:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.PresentationServers,e);return t},getPresentationServerStatus:function(e){return this.getValidValues(sldEntityType.PresentationServer,sldEntity.PresentationServer.Status,e)},getPresentationServerLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.PresentationServer,sldEntity.PresentationServer.LifeCycleStatus,e)},getBrowserAccessServerStatus:function(e){return this.getValidValues(sldEntityType.B1WebServer,sldEntity.B1WebServer.Status,e)},getBrowserAccessServerLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.B1WebServer,sldEntity.B1WebServer.LifeCycleStatus,e)},getPresentationServerType:function(e){return this.getValidValues(sldEntityType.PresentationServer,sldEntity.PresentationServer.ServerType,e)},getPresentationServerConnectionFile:function(e,t){var n=1;e!==undefined&&e!==null&&e.length>0&&$.c3BaseClient.callNormalService("GET","GetPresentationServerConnectionFile",{Hostname:"'"+e+"'",CacheMode:n},t)},getCachedPresentationServerMonitorStatus:function(e,t){var n=2;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckPresentationServerStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckPresentationServerStatusByID",{CacheMode:n},t)},getPresentationServerMonitorStatus:function(e,t){var n=1;e!==undefined&&e!==null&&e.length>0?$.c3BaseClient.callNormalService("GET","CheckPresentationServerStatus",{Hostname:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckPresentationServerStatus",{CacheMode:n},t)},getBrowserAccessServerServerMonitorStatus:function(e,t){var n=1;e!==undefined&&e!==null&&e.length>0?$.c3BaseClient.callNormalService("GET","CheckBrowserAccessServerStatus",{Hostname:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckBrowserAccessServerStatus",{CacheMode:n},t)},testPresentationServerConnection:function(e,t,n){var r={ServerName:"'"+e+"'",ServerType:"'"+t+"'"};$.c3BaseClient.callBindingService("GET",sldEntitySet.PresentationServers,"TestPresentationServerConnection",r,n)},retrieveSBOClientSessions:function(e,t){$.c3BaseClient.callBindingService("POST",sldEntitySet.SBOClients,"RetrieveSBOClientSessions",{},t,e)},killAllSBOClientSessions:function(e,t){$.c3BaseClient.callBindingService("POST",sldEntitySet.SBOClients,"KillAllSBOClientSessions",{},t,e)},refreshSBOClients:function(e){$.c3BaseClient.callBindingService("POST",sldEntitySet.SBOClients,"RefreshSBOClients",null,e)},retrieveSBOClients:function(e,t){var n={MachineID:e};$.c3BaseClient.callBindingService("POST",sldEntitySet.SBOClients,"RetrieveSBOClients",n,t)},deploySBOClientAsync:function(e,t,n){var r={SBOClientDeployParam:{},KillAllSessions:!0};t==1?r.SBOClientDeployParam.ForceUpdate=!0:r.SBOClientDeployParam.ForceUpdate=!1;var i=JSON.stringify(r);$.c3BaseClient.callBindingService("POST",sldEntitySet.PresentationServers,"DeploySBOClientAsync",i,n,e)},getBrowserAccessServers:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.B1WebServers,e);return t},createBrowserAccessServer:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.B1WebServers,e,t)},deleteBrowserAccessServer:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.B1WebServers,e,t)},updateBrowserAccessServer:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.B1WebServers,e,t)},testBAServerConnection:function(e,t,n){var r={ServerName:"'"+e+"'",ServerType:"'"+t+"'"};$.c3BaseClient.callBindingService("GET",sldEntitySet.B1WebServers,"TestBAServerConnection",r,n)},retrieveBAServerSessions:function(e,t){$.c3BaseClient.callBindingService("POST",sldEntitySet.SBOClients,"RetrieveBAServerSessions",{},t,e)},killAllBAServerSessions:function(e,t){$.c3BaseClient.callBindingService("POST",sldEntitySet.SBOClients,"KillAllBAServerSessions",{},t,e)},refreshBAServers:function(e){$.c3BaseClient.callBindingService("POST",sldEntitySet.SBOClients,"RefreshBAServers",null,e)},retrieveBAServers:function(e,t){var n={MachineID:e};$.c3BaseClient.callBindingService("POST",sldEntitySet.SBOClients,"RetrieveBAServers",n,t)},getCachedBrowserAccessServerMonitorStatus:function(e,t){var n=2;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckBrowserAccessServerStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckBrowserAccessServerStatusByID",{CacheMode:n},t)},getBrowserAccessServerMonitorStatus:function(e,t){var n=1;e!==undefined&&e!==null&&e.length>0?$.c3BaseClient.callNormalService("GET","CheckBrowserAccessServerStatus",{Hostname:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckBrowseraccessServerStatus",{CacheMode:n},t)},deployBAServerAsync:function(e,t,n){var r={SBOClientDeployParam:{},KillAllSessions:!0};t==1?r.SBOClientDeployParam.ForceUpdate=!0:r.SBOClientDeployParam.ForceUpdate=!1;var i=JSON.stringify(r);$.c3BaseClient.callBindingService("POST",sldEntitySet.B1WebServers,"DeployBAServerAsync",i,n,e)},checkCertificateFileCredentials:function(e,t,n){var r="CheckGatekeeperCert",i={CertFileContent:"'"+e+"'",CertFilePass:"'"+t+"'"};$.c3BaseClient.uploadFile(this.serviceName,r,i,n)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createB1iServer:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.IntegrationComponents,e,t)},updateB1iServer:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.IntegrationComponents,e,t)},deleteB1iServer:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.IntegrationComponents,e,t)},getB1iServers:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.IntegrationComponents,e);return t},getB1iServerStatus:function(e){return this.getValidValues(sldEntityType.IntegrationComponent,sldEntity.IntegrationComponent.Status,e)},getB1iServerLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.IntegrationComponent,sldEntity.IntegrationComponent.LifeCycleStatus,e)},getCachedB1IMonitorStatus:function(e,t){var n=2;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckIntegrationComponentStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckIntegrationComponentStatusByID",{CacheMode:n},t)},getB1IMonitorStatus:function(e,t){var n=1;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckIntegrationComponentStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckIntegrationComponentStatusByID",{CacheMode:n},t)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createB1aServer:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.AnalyticService,e,t)},updateB1aServer:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.AnalyticService,e,t)},deleteB1aServer:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.AnalyticService,e,t)},getB1aServers:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.AnalyticService,e);return t},getB1aServerStatus:function(e){return this.getValidValues(sldEntityType.AnalyticService,sldEntity.AnalyticService.Status,e)},getB1aServerLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.AnalyticService,sldEntity.AnalyticService.LifeCycleStatus,e)},getCachedB1AMonitorStatus:function(e,t){var n=2;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckAnalyticsServiceStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckAnalyticsServiceStatusByID",{CacheMode:n},t)},getB1AMonitorStatus:function(e,t){var n=1;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckAnalyticsServiceStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckAnalyticsServiceStatusByID",{CacheMode:n},t)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createXAppService:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.XAppService,e,t)},updateXAppService:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.XAppService,e,t)},deleteXAppService:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.XAppService,e,t)},getXAppServices:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.XAppService,e);return t},getXAppServiceStatus:function(e){return this.getValidValues(sldEntityType.XAppService,sldEntity.XAppService.Status,e)},getXAppServiceLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.XAppService,sldEntity.XAppService.LifeCycleStatus,e)},getCachedXAppMonitorStatus:function(e,t){var n=2;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckXAppServiceStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckXAppServiceStatusByID",{CacheMode:n},t)},getXAppMonitorStatus:function(e,t){var n=1;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckXAppServiceStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckXAppServiceStatusByID",{CacheMode:n},t)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createB1SharedFolder:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.SBOSharedFolders,e,t)},updateB1SharedFolder:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.SBOSharedFolders,e,t)},deleteB1SharedFolder:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.SBOSharedFolders,e,t)},getB1SharedFolders:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.SBOSharedFolders,e);return t},getB1SharedFolderStatus:function(e){return this.getValidValues(sldEntityType.SBOSharedFolder,sldEntity.SBOSharedFolder.Status,e)},createSharedFolder:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.SharedFolders,e,t)},updateSharedFolder:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.SharedFolders,e,t)},deleteSharedFolder:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.SharedFolders,e,t)},getSharedFolders:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.SharedFolders,e);return t},getSharedFolderStatus:function(e){return this.getValidValues(sldEntityType.SharedFolder,sldEntity.SharedFolder.Status,e)},createImplementationRepository:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.ImplementationRepositories,e,t)},updateImplementationRepository:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.ImplementationRepositories,e,t)},deleteImplementationRepository:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.ImplementationRepositories,e,t)},getImplementationRepositories:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.ImplementationRepositories,e);return t},getImplementationRepositoryStatus:function(e){return this.getValidValues(sldEntityType.ImplementationRepository,sldEntity.ImplementationRepository.Status,e)},createCompanyTemplateRepository:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.CompanyTemplateRepositories,e,t)},updateCompanyTemplateRepository:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.CompanyTemplateRepositories,e,t)},deleteCompanyTemplateRepository:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.CompanyTemplateRepositories,e,t)},getCompanyTemplateRepositories:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.CompanyTemplateRepositories,e);return t},getCompanyTemplateRepositoryStatus:function(e){return this.getValidValues(sldEntityType.CompanyTemplateRepository,sldEntity.CompanyTemplateRepository.Status,e)},createTenantsStorage:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.TenantsStorages,e,t)},updateTenantsStorage:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.TenantsStorages,e,t)},deleteTenantsStorage:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.TenantsStorages,e,t)},getTenantsStorages:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.TenantsStorages,e);return t},getTenantsStorageStatus:function(e){return this.getValidValues(sldEntityType.TenantsStorage,sldEntity.TenantsStorage.Status,e)},getCachedSharedFolderMonitorStatus:function(e,t,n){var r=2;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckStorageStatusByID",{ID:"'"+e+"'",StorageType:"'"+t+"'",CacheMode:r},n):$.c3BaseClient.callNormalService("GET","CheckStorageStatusByID",{StorageType:"'"+t+"'",CacheMode:r},n)},getSharedFolderMonitorStatus:function(e,t,n){var r=1;$.c3BaseClient.callNormalService("GET","CheckStorageStatus",{StorageType:"'"+t+"'",StoragePath:"'"+e+"'",CacheMode:r},n)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createMailerService:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.Mailers,e,t)},updateMailerService:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.Mailers,e,t)},deleteMailerService:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.Mailers,e,t)},getMailerServices:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.Mailers,e);return t},getMailerServiceStatus:function(e){return this.getValidValues(sldEntityType.Mailer,sldEntity.Mailer.Status,e)},getMailerServiceLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.Mailer,sldEntity.Mailer.LifeCycleStatus,e)},getMailerMonitorStatus:function(e,t){$.c3BaseClient.callNormalService("POST","CheckMailerServiceStatus",{Hostname:"'"+e+"'"},t)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createMailServer:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.MailServers,e,t)},updateMailServer:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.MailServers,e,t)},deleteMailServer:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.MailServers,e,t)},getMailServer:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.MailServers,e);return t},getMailServerStatus:function(e){return this.getValidValues(sldEntityType.MailServer,sldEntity.MailServer.Status,e)},getMailServerLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.MailServer,sldEntity.MailServer.LifeCycleStatus,e)},getMailServerSecurityValidValues:function(e){return this.getValidValues(sldEntityType.MailServer,sldEntity.MailServer.SmtpSecurity,e)},getCachedMailServerMonitorStatus:function(e,t){var n=1;e!==undefined&&e!==null&&(e+"").length>0?$.c3BaseClient.callNormalService("GET","CheckMailServerStatusByID",{ID:"'"+e+"'",CacheMode:n},t):$.c3BaseClient.callNormalService("GET","CheckMailServerStatusByID","",t)},testMailServerConnection:function(e,t,n){var r="ServerName="+JSON.stringify(e)+"&Port="+JSON.stringify(t);$.c3BaseClient.callNormalService("GET","TestMailServerConnection",{ServerName:"'"+e+"'",Port:t},n)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{getMailEvents:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.MailEvents,e)},getMailTemplates:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.MailTemplates,e)},addMailAddress:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.MailAddresses,e,t)},removeMailAddress:function(e,t){return $.c3BaseClient.deleteData(this.serviceName,sldEntitySet.MailAddresses,e,t)},getMailTemplateAssignments:function(){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.MailTemplateAssignments)},getMailAddresses:function(){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.MailAddresses)},syncMailTemplates:function(e){var t="SyncEmailTemplates";$.c3BaseClient.callNormalService("POST",t,"",e)},createMailTemplateAssignment:function(e,t){var n={EventAssignment:e},r=JSON.stringify(n);$.c3BaseClient.callBindingService("POST",sldEntitySet.MailTemplateAssignments,"AddMailTemplateAssignment",r,t)},removeMailTemplateAssignment:function(e,t){return $.c3BaseClient.deleteData(this.serviceName,sldEntitySet.MailTemplateAssignments,e,t)}});var c3=c3||{};c3.oData=c3.oData||{},c3.oData.ResPool=c3.oData.ResPool||{},c3.oData.ResPool.Workstation={createLogicalMachine:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.Machines,e,t)},updateLogicalMachine:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.Machines,e,t)},deleteLogicalMachine:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.Machines,e,t)},getLogicalMachines:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.Machines,e);return t},getLogicalMachineStatus:function(e){return this.getValidValues(sldEntityType.Machine,sldEntity.Machine.Status,e)},getLogicalMachineLifeCycleStatus:function(e){return this.getValidValues(sldEntityType.Machine,sldEntity.Machine.LifeCycleStatus,e)},getSLDAgentMonitorStatus:function(e,t){$.c3BaseClient.callNormalService("GET","CheckSLDAgentStatus",{Hostname:"'"+e+"'"},t)},getSLDAgentMachineStatus:function(e,t){var n={};$.c3BaseClient.callBindingService("POST",sldEntitySet.Machines,"GetSldAgentStatus",n,t,e)},getAllSLDAgentMachineStatus:function(e){var t={};$.c3BaseClient.callNormalService("POST","GetAllSldAgentStatus",t,e)}},c3.service=c3.service||{},$.extend(c3.service,c3.oData.ResPool.Workstation);var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{registerSWRepository:function(e){var t=null,n="";return n="?RootPath='"+e+"'",t=$.c3BaseClient.getData(this.serviceName,"RegisterB1InstallationPackageRepository"+n),t},createSWRepository:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.SoftwareRepositories,e,t)},updateSWRepository:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.SoftwareRepositories,e,t)},deleteSWRepository:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.SoftwareRepositories,e,t)},getSWRepositories:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.SoftwareRepositories,e);return t},getSWRepositoryStatus:function(e){return this.getValidValues(sldEntityType.SoftwareRepository,sldEntity.SoftwareRepository.Status,e)},getExtensions:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.Extensions,e)},getExtensionValidities:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.ExtensionValidities,e)},getExtensionProperties:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.ExtensionProperties,e)},updateExtensionProperties:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.ExtensionProperties,e,t)},updateExtensionAssignments:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.ExtensionAssignments,e,t)},deleteExtension:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.Extensions,e,t)},getExtensionRepositories:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.ExtensionRepositories,e)},createExtensionRepository:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.ExtensionRepositories,e,t)},getExtensionRepository:function(e){var t="ExtensionRepository";$.c3BaseClient.callNormalService("GET",t,null,e)},updateExtensionRepository:function(e,t){var n="UpdateExtensionRepository",r={Path:"'"+e.URI.replace("'","''")+"'"};$.c3BaseClient.callNormalService("POST",n,r,t)},getExtensionDeployments:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.ExtensionDeployments,e)},getExtensionDeploymentProperties:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.DeploymentProperties,e)},updateExtensionDeploymentProperties:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.DeploymentProperties,e,t)},getExtensionAssignments:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.ExtensionAssignments,e)},getExtensionAssignmentProperties:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.AssignmentProperties,e)},updateExtensionAssignmentProperties:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.AssignmentProperties,e,t)},createExtensionAssignmentProperty:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.AssignmentProperties,e,t)},deleteExtensionAssignmentProperty:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.AssignmentProperties,e,t)},getExtensionSyncLogs:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.ExtensionSynchronizationLogs,e)},getExtensionSyncDetails:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.ExtensionSynchronizationLogDetails,e)},getCurrentTaskId:function(e){var t="CurrentExtensionSynchronizationTaskId";return $.c3BaseClient.callNormalService("GET",t,null,e)},synchronizeExtensionRepository:function(e,t){var n="SynchronizeExtensionRepository";$.c3BaseClient.callNormalService("POST",n,e,t)},currentExtensionSynchronizationDetails:function(e,t){var n="CurrentExtensionSynchronizationDetails";$.c3BaseClient.callNormalService("POST",n,e,t)},getExtensionToBeInstalled:function(e){var t=sldEntitySet.ServiceUnits+"("+e+")/GetDeployableExtensions";return $.c3BaseClient.getData(this.serviceName,t)},GetAssignableExtensions:function(e){var t=sldEntitySet.Tenants+"("+e+")/GetAssignableExtensions";return $.c3BaseClient.getData(this.serviceName,t)},getExtensionSyncSchedual:function(e,t){var n="ExtensionSynchronizationSetting";$.c3BaseClient.callNormalService("POST",n,e,t)},getExtensionCompatibilityCheckSwitch:function(e){var t="IsExtensionCompatibilityCheckOn";$.c3BaseClient.callNormalService("GET",t,null,e)},setExtensionCompatibilityCheckSwitch:function(e,t){var n="SetExtensionCompatibilityCheck",r={IsOn:e};$.c3BaseClient.callNormalService("POST",n,JSON.stringify(r),t)},updateExtensionSyncSchedual:function(e,t){var n="UpdateExtensionSynchronizationSetting",r={Setting:{EnableSchedule:e.EnableSchedule,StartTime:e.StartTime,Interval:e.Interval,EnableCompatibilityCheck:e.EnableCompatibilityCheck}};$.c3BaseClient.callNormalService("POST",n,JSON.stringify(r),t)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{createOperator:function(e,t){var n={Operator:e},r=JSON.stringify(n);$.c3BaseClient.callBindingService("POST",sldEntitySet.Users,"CreateOperator",r,t)},getOperators:function(e,t){var n="GetAllOperatorDetails";$.c3BaseClient.callBindingService("GET",sldEntitySet.Users,n,e,t)},getCurrentOperator:function(){var e=$.c3BaseClient.getData(this.serviceName,"CurrentOperator");return e},getCurrentOperatorRole:function(e){var t=$.c3BaseClient.getData(this.serviceName,"Users("+e+")/GetRoles");return t},login:function(e,t,n){t=t.replace(/'/g,"''");var r={Account:"'"+e+"'",Password:"'"+t+"'"};return $.c3BaseClient.callNormalService("POST","LogonBySystemUser",r,n)},logout:function(){window.localStorage.removeItem("securityToken");var e=$.c3BaseClient.getData(this.serviceName,"Logoff");return e},GenerateSecurityToken:function(){var e=$.c3BaseClient.getData(this.serviceName,"GenerateSecurityToken");return e},RetriveSLDFullyDomainName:function(e){var t=$.c3BaseClient.callNormalService("GET","GetFullyDomainName","",e);return t}}),window.c3=window.c3||{},function(){"use strict";var e={createUserStorage:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.UsersStorages,e,t)},updateUserStorage:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.UsersStorages,e,t)},deleteUserStorage:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.UsersStorages,e,t)},getUserStorages:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.UsersStorages,e);return t},getUserStorageStatus:function(e){return this.getValidValues(sldEntityType.UsersStorage,sldEntity.UsersStorages.Status,e)}};c3.service=c3.service||{},$.extend(c3.service,e)}(),function(){"use strict";c3.service=c3.service||{},$.extend(c3.service,{checkResellerStatus:function(e){return $.c3BaseClient.callBindingService("GET",sldEntitySet.Resellers,"CheckResellerStatus",{},e)},getResellers:function(e,t){var n=$.c3BaseClient.getData(this.serviceName,sldEntitySet.Resellers,e,t);return n},updateReseller:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.Resellers,e,t)},assignResources:function(e,t,n,r,i){var s={ResourceType:t,ResourceIDs:n,ResourceAssignmentParams:null==r?[]:r},o=JSON.stringify(s);return $.c3BaseClient.callBindingService("Post",sldEntitySet.Resellers,"AssignResources",o,i,e)},unAssignResources:function(e,t,n,r){var i={ResourceType:t,ResourceIDs:n},s=JSON.stringify(i);return $.c3BaseClient.callBindingService("Post",sldEntitySet.Resellers,"UnassignResources",s,r,e)},getServiceUnitsOfReseller:function(e,t){return $.c3BaseClient.callBindingService("Get",sldEntitySet.Resellers,"GetServiceUnitsOfReseller",{},t,e)},getCustomersOfReseller:function(e,t){return $.c3BaseClient.callBindingService("Get",sldEntitySet.Resellers,"GetCustomersOfReseller",{},t,e)},getLicensesOfReseller:function(e,t){return $.c3BaseClient.callBindingService("Get",sldEntitySet.Resellers,"GetLicensesOfReseller",{},t,e)},getAssigningResellers:function(e,t,n){var r={ResourceType:e,ResourceID:t},i=JSON.stringify(r);return $.c3BaseClient.callBindingService("POST",sldEntitySet.Resellers,"GetAssigningResellers",i,n)},checkLicenseFileIsShared:function(e,t,n){var r={ResourceID:e,ResourceType:t},i=JSON.stringify(r);return $.c3BaseClient.callBindingService("POST",sldEntitySet.Resellers,"CheckLicenseFileIsShared",i,n)},createReseller:function(e,t){var n={Reseller:e},r=JSON.stringify(n);return $.c3BaseClient.callBindingService("POST",sldEntitySet.Resellers,"CreateReseller",r,t)},removeReseller:function(e,t){return $.c3BaseClient.callBindingService("POST",sldEntitySet.Resellers,"RemoveReseller",{},t,e)},addResellerUser:function(e,t,n){var r={User:t},i=JSON.stringify(r);$.c3BaseClient.callBindingService("POST",sldEntitySet.Resellers,"AddUserToReseller",i,n,e)},removeResellerUser:function(e,t,n){var r={User:t},i=JSON.stringify(r);$.c3BaseClient.callBindingService("POST",sldEntitySet.Resellers,"RemoveUserFromReseller",i,n,e)},getToken:function(e){var t=$.c3BaseClient.getData(this.serviceName,"GetSessionToken");return t},getRSPService:function(e){var t=$.c3BaseClient.getData(this.serviceName,"RSPServices",undefined,e);return t},getTaskAuthorizations:function(e,t){var n=$.c3BaseClient.getData(this.serviceName,sldEntitySet.TaskAuthorizations,e,t);return n},getTaskTypes:function(e,t){var n=$.c3BaseClient.getData(this.serviceName,sldEntitySet.TaskTypes,e,t);return n},assignTaskAuthorization:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.TaskAuthorizations,e,t)},unassignTaskAuthorization:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.TaskAuthorizations,e,t)},getVARRequests:function(e,t){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.VARRequests,e,t)},approveTaskOperationRequests:function(e,t){var n=JSON.stringify(e);$.c3BaseClient.callBindingService("POST",sldEntitySet.TaskOperationRequests,"ApproveTaskOperationRequests",n,t)},rejectTaskOperationRequests:function(e,t){var n=JSON.stringify(e);$.c3BaseClient.callBindingService("POST",sldEntitySet.TaskOperationRequests,"RejectTaskOperationRequests",n,t)},cancelTaskOperationRequests:function(e,t){var n=JSON.stringify(e);$.c3BaseClient.callBindingService("POST",sldEntitySet.TaskOperationRequests,"CancelTaskOperationRequests",n,t)},getTaskStatus:function(e){return this.getValidValues(sldEntityType.Tasks,sldEntity.Task.Status,e)}})}();var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{getHostMappings:function(e){return $.c3BaseClient.getData(this.serviceName,sldEntitySet.HostMappings,e)},createHostMappings:function(e,t,n){return $.c3BaseClient.createData(this.serviceName,e,t,n)},updateHostMappings:function(e,t,n){return $.c3BaseClient.updateData(this.serviceName,e,t,n)},removeHostMappings:function(e,t,n){return $.c3BaseClient.deleteData(this.serviceName,e,t,n)},getSpInfo:function(e,t,n){var r={};return $.c3BaseClient.callNormalService("GET",e,r,function(e){t&&t(e.d,n)})},getComponent:function(e,t){return $.c3BaseClient.getData(this.serviceName,e,t)}});var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{ImportDynamicKey:function(e,t,n){var r="ImportDynamicKey",i={DynamicKeyContent:e,Password:"'"+t+"'"};$.c3BaseClient.uploadFile(this.serviceName,r,i,n)},ExportDynamicKey:function(e,t){var n="ExportSecurityConfig",r={},i=odataclient.getServiceUrl(this.serviceName)+"/"+n+"?Password='"+t+"'";window.open(i,"Downloading","width=500px,height=300px")}}),jQuery.c3BaseClient={getData:function(e,t,n,r,i){var s=odataclient.getServiceUrl(e),o={};i===undefined&&(o.error=requestError),o.funName=t,o.callback=r;var u;return n!==undefined?u=odataclient.oData(s,o).from(t+"("+n+")"):u=odataclient.oData(s,o).from(t),u},getDataByUrl:function(e){jQuery.support.cors=!0;var t={};t.error=requestError;var n=odataclient.oData(e,t).from();return n},updateData:function(e,t,n,r){var i=odataclient.getServiceUrl(e),s={};s.funName="update"+t,t=t+"("+n.ID+")",odataclient.oData(i,s).update(t,n,r)},createData:function(e,t,n,r){var i=odataclient.getServiceUrl(e),s={};s.funName="create"+t,s.error=requestError,odataclient.oData(i,s).create(t,n,r)},deleteData:function(e,t,n,r){var i=odataclient.getServiceUrl(e),s={};s.funName="delete"+t,t=t+"("+n.ID+")";if(r.params){t+="?";for(var o in r.params)t+=o+"="+r.params[o]+"&";t=t.substring(0,t.lastIndexOf("&")),delete r.params}odataclient.oData(i,s).remove(t,n,r)},callNormalService:function(e,t,n,r){var i=odataclient.getServiceUrl(c3config.SLDPath)+"/"+t;this.ajax(i,n,e,!0,r)},callBindingService:function(e,t,n,r,i,s){var o=odataclient.getServiceUrl(c3config.SLDPath)+"/";if(i.params){n+="?";for(var u in i.params)n+=u+"="+i.params[u]+"&";n=n.substring(0,n.lastIndexOf("&")),delete i.params}s===undefined?o+=t+"/"+n:o+=t+"("+s+")/"+n,this.ajax(o,r,e,!0,i)},batchRequest:function(e){var t=odataclient.getServiceUrl(c3config.SLDPath)+"/";return odataclient.oDataBatch(t,e)},getNewId:function(e,t,n){var r=odataclient.getServiceUrl(e)+"/CreateID?type='"+t+"'",i=odataclient.oData(r,n);return i},exportCSV:function(e,t){var n=odataclient.getServiceUrl(e)+"/ExportCSV";$("body").find("#form1").size()>0&&$("#form1").remove();var r=$("<input>").attr({name:"data",id:"data",type:"textbox"}).val(t),i=$("<form>").attr({name:"form1",id:"form1",action:n,method:"POST"}).css("display","none").append(r);$("body").append(i),i.submit()},exportAgentLog:function(e,t,n,r){var i=i=odataclient.getServiceUrl(c3config.SLDPath)+"/";n===undefined?i+=e+"/"+t:i+=e+"("+n+")/"+t,$("body").find("#form1").size()>0&&$("#form1").remove();var s=$("<input>").attr({name:"data",id:"data",type:"textbox"}).val(r),o=$("<form>").attr({name:"form1",id:"form1",action:i,method:"POST"}).css("display","none").append(s);$("body").append(o),o.submit()},uploadFile:function(e,t,n,r,i){var s={};s.mimeType="application/x-www-form-urlencoded",s.contentType="application/x-www-form-urlencoded";var o="";i&&i.length>0?o=odataclient.getServiceUrl(e)+"/"+i+"/"+t:o=odataclient.getServiceUrl(e)+"/"+t,this.ajax(o,n,"POST",!0,r,s)},actAsGroups:function(e){var t=this;return{toCall:function(n){odataclient.groupids=e;var r=t.ajax;t.ajax=function(t,n,i,s,o,u){r(t,n,i,s,o,u,e)},n.apply(null,null),t.ajax=r,odataclient.groupids=undefined}}},ajax:function(e,t,n,r,i,s,o){var u={};$.isPlainObject(i)?u=i:(u.success=i,u.error=i);var a=function(e,t){u.funName!==undefined&&$.isPlainObject(e)&&(e.query={},e.query.settings={},e.query.settings.funName=u.funName),t=="success"?u.success(e,t):(u.error&&u.error(e,t),requestError(e,t))};n.toUpperCase()=="POST"?(s=s||{mimeType:"application/json",contentType:"application/json"},isJSON(t)?s={mimeType:"application/json",contentType:"application/json"}:s={mimeType:"application/x-www-form-urlencoded",contentType:"application/x-www-form-urlencoded"}):s={};var f={url:e,type:n,async:r,data:t,success:a,error:a,statusCode:{404:function(){}},mimeType:s.mimeType,contentType:s.contentType,complete:function(e,t){var n=e.getResponseHeader("SLD-MESSAGE-KEY");n&&n!=""&&odataclient.getSLDMessage(n)}};typeof i.accepts=="undefined"?f.beforeSend=function(e){e.setRequestHeader("Accept","application/json"),e.setRequestHeader(c3Identifier.AppKey,c3Identifier.AppIdentifier),e.setRequestHeader("securityToken",window.localStorage.getItem("securityToken")),o!=undefined&&e.setRequestHeader("actorGroupId",o)}:i.accepts?f.beforeSend=function(e){e.setRequestHeader("Accept",i.accepts),e.setRequestHeader(c3Identifier.AppKey,c3Identifier.AppIdentifier),e.setRequestHeader("securityToken",window.localStorage.getItem("securityToken")),o!==undefined&&e.setRequestHeader("actorGroupId",o)}:o!==undefined&&(xhr.setRequestHeader("actorGroupId",o),xhr.setRequestHeader("securityToken",window.localStorage.getItem("securityToken"))),$.ajax(f)},getValidValues:function(e,t,n,r){var i=null,s=odataclient.getServiceUrl(e)+"/"+"GetValidValues?ResourceType='"+t+"'&PropertyName='"+n+"'",o=undefined,u=!0;return r===undefined&&(u=!1),this.ajax(s,o,"GET",u,function(e,t){i={},i.data=[],t=="success"?(e.d&&(i.data=e.d.results),r!==undefined&&r(i,t)):requestError(e,t)}),i}};var c3=c3||{};c3.service=c3.service||{},$.extend(c3.service,{serviceName:c3config.SLDPath,getDataByUrl:function(e){jQuery.support.cors=!0;var t={};t.error=requestError;var n=odataclient.oData(e,t).from();return n},getDetail:function(e){var t=e.__deferred.uri,n=t.split("/"),r=n[2];return r!=location.host&&(n[2]=location.host,t=n.join("/")),this.getDataByUrl(t)},batchRequest:function(e){return $.c3BaseClient.batchRequest(e)},getValidValues:function(e,t,n){return $.c3BaseClient.getValidValues(this.serviceName,e,t,n)},updateSystemInformation:function(e,t){var n=odataclient.getServiceUrl(this.serviceName),r={};r.funName="update"+sldEntitySet.SystemInformation;var i=sldEntitySet.SystemInformation+"("+e.ID+")";odataclient.oData(n,r).update(i,e,t)},getApplicationIdentifiers:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.ApplicationIdentifiers,e);return t},createApplicationIdentifier:function(e,t){$.c3BaseClient.createData(this.serviceName,sldEntitySet.ApplicationIdentifiers,e,t)},updateApplicationIdentifier:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.ApplicationIdentifiers,e,t)},deleteApplicationIdentifier:function(e,t){$.c3BaseClient.deleteData(this.serviceName,sldEntitySet.ApplicationIdentifiers,e,t)},getApplicationIdentifierStatus:function(e){return this.getValidValues(sldEntityType.ApplicationIdentifier,sldEntity.ApplicationIdentifier.Status,e)},generateIdentifier:function(e,t){var n={AppName:"'"+e+"'"};$.c3BaseClient.callBindingService("GET",sldEntitySet.ApplicationIdentifiers,"GenerateIdentifier",n,t)},validateIdentifier:function(e,t){var n={Identifier:"'"+e+"'"};$.c3BaseClient.callBindingService("GET",sldEntitySet.ApplicationIdentifiers,"ValidateIdentifier",n,t)},retrieveWorkstations:function(){var e=null,t="RetrieveWorkstations";return e=$.c3BaseClient.getData(this.serviceName,t),e},getTasks:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.Tasks,e);return t},getSubTask:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.Tasks+"("+e+")"+"/SubTasks");return t},getTaskProgress:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.Tasks+"("+e+")/GetTaskProperties");return t},getTaskProperties:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.TaskParameters,e);return t},getTaskResult:function(e){var t=sldEntitySet.Tasks+"("+e+")/GetResult";return $.c3BaseClient.getData(this.serviceName,t)},archiveTask:function(e,t){$.c3BaseClient.updateData(this.serviceName,sldEntitySet.Tasks,e,t)},getSystemInformations:function(e){var t=$.c3BaseClient.getData(this.serviceName,sldEntitySet.SystemInformation,e);return t},cloneObj:function(e){var t;e.constructor==Object?t=new e.constructor:t=new e.constructor(e.valueOf());for(var n in e)t[n]!=e[n]&&(typeof e[n]=="object"?t[n]=this.cloneObj(e[n]):t[n]=e[n]);return t.toString=e.toString,t.valueOf=e.valueOf,t},exportCSV:function(e){$.c3BaseClient.exportCSV(this.serviceName,e)},convertData:function(e){var t=[];if(undefined!=e)for(var n=0;n<e.length;n++){var r={};for(var i in e[n])if("__metadata"!=i)if(typeof e[n][i]=="object")for(var s in e[n][i]){if(s==="results"&&$.isArray(e[n][i].results)){r[i]=e[n][i].results;break}if(s=="__deferred"){r[i]=e[n][i];break}if("__metadata"!=s)if(typeof e[n][i][s]=="object")for(var o in e[n][i][s]){if(o==="results"&&$.isArray(e[n][i][s].results)){r[i+"_"+s]=e[n][i][s].results;break}if(o=="__deferred"){r[i+"_"+s]=e[n][i][s];break}o!="__metadata"&&(r[i+"_"+s+"_"+o]=e[n][i][s][o])}else r[i+"_"+s]=e[n][i][s]}else r[i]=e[n][i];else r[i]=e[n][i];t.push(r)}return t}}),function(e){e.fn.popupManager=function(e,t,n,r,i){return new popupManager(this,e,t,n,r,i)}}(jQuery),function(e){e.fn.c3popwin=function(e,t,n,r,i){return new c3popwin(this,e,t,n,r,i)}}(jQuery);var isIe=document.all?!0:!1;(function(e){e.fn.c3tab=function(e,t){return new c3tab(this,e,t)}})(jQuery),textbox.validityMessages={valueMissing:localizedString("VALIDITY_VALUEMISSSING"),patternMismatch:localizedString("VALIDITY_PATTERNMISMATCH"),duplicated:localizedString("VALIDITY_NAMEDUPLICATED")},function($){"use strict";var gridview=function(){function printElementCount(e,t){rowsLabel!=null&&rowsLabel!=undefined&&delegate.printRecordsCount!=undefined&&(delegate.getPrintRecordsCountOption()==1?rowsLabel.html("").append(String.format(localizedString("AUDIT_LOG_TOTAL_ROWS_LABEL"),e,t)):rowsLabel.html(""))}function getDelegate(){return delegate}function isReady(){return container[0].clientWidth>0?!0:!1}function searchText(inputText){var text=$.trim(inputText),regStr=text.replace(/\\/g,"\\\\");regStr=="."&&(regStr=regStr.replace(/./g,"\\."));var allTr=tbody.find("tr");if(allTr&&allTr.length>0)for(var i=0;i<allTr.length;i++)allTr[i].style.display=null;var alltd=tbody.find("td");if(alltd&&alltd.length>0)for(var i=0;i<alltd.length;i++){var td=alltd[i],originalText=$(td).attr("OriginalText");originalText&&$(td).first().text(originalText)}var hideTrs=tbody.find("tr:notContainsNotCaseSensitive('"+text+"')");if(hideTrs&&hideTrs.length>0)for(var i=0;i<hideTrs.length;i++)hideTrs[i].style.display="none";var trs=tbody.find("tr:containsNotCaseSensitive('"+text+"')"),tds=tbody.find("td:containsNotCaseSensitive('"+text+"')");if(tds&&tds.length>0)for(var j=0;j<tds.length;j++){var td=tds[j],children=$(td).first().children();if(!children||children.length<=0){var reg="/"+regStr+"/i",matchText=$(td).first().text().match(eval(reg));$(td).attr({OriginalText:$(td).first().text()});var newText=$(td).first().text().replace(eval(reg),"<b style='color:#FFFF00;background-color:#000000;'>"+matchText+"</b>");$(td).first().html(newText).append(children)}}}function sort(e){if(doNotSortFlag){doNotSortFlag=!1;return}if(startMove)return;var t=$(this),n=!1;t.length==0&&sortedBy!=null?(t=sortedBy,n=!1):(n=!0,sortedBy=t);var r=t.attr("dataType"),i=t.attr("sortType"),s=t.find("#btnSort");if(!s||s.length==0)s=$("<a>").attr({id:"btnSort"}).addClass("sort_down"),t.find("section").append(s);n&&($(".sort_down").removeClass(),$(".sort_up").removeClass(),!i||i===""?(i="ASC",s.addClass("sort_up"),t.attr("sortType","ASC")):i==="ASC"?(i="DESC",s.addClass("sort_down"),t.attr("sortType","DESC")):i==="DESC"&&(i="ASC",s.addClass("sort_up"),t.attr("sortType","ASC")));var o=t.index()+1,u=[],a=tbody.find("tr");e!=null&&e.data?$.each(a,function(n){var r=$(this).data("dataIndex");if(r===undefined){t.data("dataIndex",n);var i=e.data.delegation.getRow(n)}else var i=e.data.delegation.getRow(r);u[n]=a[n],u[n].sortData=i[e.data.sortedBy]}):$.each(a,function(e){var n=t.data("dataIndex");n===undefined&&$(this).data("dataIndex",e),u[e]=a[e]}),u.sort(sortData(o,r,i)),$.each(u,function(e){u[e].sortData!==undefined&&delete u[e].sortData}),$(".sorted").removeClass(),t.addClass("sorted");var f=document.createDocumentFragment();$.each(u,function(e){f.appendChild(u[e])}),tbody.append(f)}function sortData(e,t,n){var r=function(e,t){switch(t){case"number":return parseFloat(e)||0;case"datetime":return Date.parse(e)||0;default:return e}};return function(i,s){var o,u;if(i.sortData!==undefined)o=r(i.sortData,t),u=r(s.sortData,t);else{var a=$(i).find("td:nth-child("+e+")").text(),f=$(s).find("td:nth-child("+e+")").text();o=r(a,t),u=r(f,t)}return!t||t==="string"?(o+="",u+="",n==="ASC"?o.localeCompare(u):u.localeCompare(o)):n==="ASC"?o>u:o<u}}function onMousedown(e){var t=$(this);if(t.prevAll().length<1||t.nextAll().length<1)return;var n=t.offset(),r=e.clientX-n.left;r<2||t.width()-r<2?(t.css({cursor:"col-resize"}),startMove=!0,r<t.width()/2?currentTh=t.prev():currentTh=t):(currentTh=null,startMove=!1)}function onMousemove(e){var t=$(this),n=t.offset().left,r=e.clientX-n;if(startMove==1&&currentTh){var i=currentTh.offset(),s=currentTh.prevAll().length;if(s!=0){var o=e.clientX-i.left;currentTh.width(o),thead.find("th").eq(s).width(o),onAfterDragged()}}r<2||t.width()-r<2?t.css({cursor:"col-resize"}):startMove||t.css({cursor:"default"})}function onMouseup(e){var t=$(this);t.css({cursor:"default"});if(startMove==1&&currentTh){var n=currentTh.offset(),r=currentTh.prevAll().length,i=e.clientX-n.left;r!=0?(currentTh.width(i),thead.find("th").eq(r).width(i),onAfterDragged(),currentTh=null,startMove=!1):(currentTh=null,startMove=!1)}}function onAfterDragged(){var e=[],t=tbody.find("tr");$.each(t,function(n){e[n]=t[n]});var n=document.createDocumentFragment();$.each(e,function(t){n.appendChild(e[t])}),tbody.append(n)}function show(){delegate.autoResize!=null&&delegate.autoResize()>0&&container&&$(gridContainer).css("height",$(window).height()-delegate.autoResize()+"px"),isReady()?(onShow(),isShown=!0):window.setTimeout(function(e){return function(){e.show()}}(this),800)}function onShow(){thead.empty(),tbody.empty(),delegate&&(renderHeader(),renderBody(),delegate.pagingMode===!0&&(pagingArea||(pagingArea=new PagingArea(container,delegate.pageSize)),pagingArea.refreshPageArea())),offset=table.position()}function reload(){delegate.autoResize!=null&&delegate.autoResize()>0&&container&&$(gridContainer).css("height",$(window).height()-delegate.autoResize()+"px"),isShown&&(tbody.empty(),delegate&&(renderBody(),delegate.pagingMode===!0&&(pagingArea||(pagingArea=new PagingArea(container,delegate.pageSize)),pagingArea.refreshPageArea()))),sort(null)}function refreshContent(){isShown&&(tbody.empty(),delegate&&(renderBody(),pagingAction&&(pagingAction.call(pagingArea),pagingAction=null,pagingLoadWindow&&pagingLoadWindow.close()))),sort(null)}function renderHeader(){if(delegate.getHeaderSpec){colSpec=delegate.getHeaderSpec();var e=$("<tr>").css("position","inherit");if(checkType)checkType==1?(checkAllCtrl=$("<input>").attr({type:"checkbox"}),delegate.HideCheckAll==1?checkAllCtrl.css({display:"none"}):checkAllCtrl.css({display:"inline"}),delegate.removeCheckAll?e.append($("<th>").css({width:"20px"})):(checkAllCtrl.click(function(){opCheckOnAll(this.checked)}),e.append($("<th>").append(checkAllCtrl).css({width:"20px"})))):checkType==2&&e.append($("<th>").css({width:"20px"}));else if(delegate.needExport&&delegate.needExport()==0)e.append($("<th>").addClass("row_indicator_noIcon"));else{var t=$("<th>").addClass("row_indicator").css("cursor","pointer");t.attr("title",localizedString("BTN_EXPORT_TIP")),t.click(function(){var e=delegate.getRowCount();if(e&&e>0){var t=[];for(var n=0;n<e;n++)t.push(delegate.getRow(n));var r=delegate.getHeaderSpec();new exportCSV(this,{colList:r,data:t})}}),e.append(t)}for(var n=0;n<colSpec.length;n++){var r=colSpec[n],i=$("<th>");i.bind("dblclick",sort),delegate.disableSort?delegate.disableSort()||delegate.pagingMode===!1&&(r.sortedBy?i.bind("mouseup",{sortedBy:r.sortedBy,delegation:delegate},sort):i.bind("mouseup",sort)):delegate.pagingMode===!1&&(r.sortedBy?i.bind("mouseup",{sortedBy:r.sortedBy,delegation:delegate},sort):i.bind("mouseup",sort)),i.bind("mousedown",onMousedown),i.bind("mousemove",onMousemove),i.bind("mouseup",onMouseup),r.width&&(i.css({width:r.width}),floatHeader&&floatHeader.find("th").eq(n+1).width(r.width)),r.dataType&&i.attr("dataType",r.dataType),i.attr("title",r.description);var s=$("<section>").css({display:"block","float":"left"});if(r.filter){var o=$("<a>").attr({href:"#",id:"btnFilter_"+n}).addClass("filter");o.click(function(e,t){return function(n){var r=t,i=$("<section>").css({padding:"0 10px"}).addClass("gridPopup");if(t.filter.mode==0){var s=$("<div>").addClass("row"),o=$("<input>").attr({type:"textbox"});s.append($("<div>").append(t.description).addClass("rowName")),s.append($("<div>").append(o).addClass("rowValue"));var u=$("<div>").addClass("toolbar"),a=$("<input>").attr({type:"button",value:localizedString("MISC_FILTER")}),f=$("<input>").attr({type:"button",value:localizedString("MISC_RESET")});u.append(a),u.append(f),i.append(s),i.append(u),a.click(function(){e.addClass("filtered"),e.filterField||(e.filterField={},filters.push(e.filterField)),e.filterField.columnName=r.name,e.filterField.filter=o.val(),e.filterField["filter"]==""&&e.removeClass("filtered"),self.reload(),e.popup.close()}),f.click(function(){o.val(""),o.focus()})}else if(t.filter.mode==1){var l=$("<select>").attr({multiple:!0}).addClass("datalist"),c={};for(var h=-1;h<rowCount;h++){var p=-1,d=null;if(h!=-1){d=delegate.getRow(h);if(d.VisibleFilterValue==0&&e.filtered!=1)continue;p=d[t.name];if(c[p]!=undefined){c[p].dataArray.push(d);continue}c[p]={},c[p].dataArray=[],c[p].dataArray.push(d)}var v=$("<option>"),m=!0;d!=null?m=d.VisibleFilterValue==0?!1:!0:e.filtered==1&&(m=!1);var g=$("<input>").attr({type:"checkbox",checked:m});v.append(g),h==-1?(g.allSelector=!0,g.addClass("All"),v.append("All")):v.append(p),v.attr({value:p}),l.append(v),g.filteredField=c[p],v.click(function(e,t){return function(n){if(this.disabled!=1){var r=!e.attr("checked");t&&(t.VisibleFilterValue=r),e.attr("checked",r);if(e.allSelector){var i=l.find("option>input");i.attr("checked",r),showAllData(r)}else{r==0&&l.find("option>input.All").attr("checked",!1);for(var s=0;s<e.filteredField.dataArray.length;s++)e.filteredField.dataArray[s].VisibleFilterValue=r}}}}(g,d))}l.find("option").length==1&&(l.find("option").attr("disabled",!0),l.find("input").attr("disabled",!0));var u=$("<div>").addClass("toolbar").addClass("mode2"),a=$("<input>").attr({type:"button",value:localizedString("MISC_OK")}),y=$("<input>").attr({type:"button",value:localizedString("MISC_CANCEL")});a.click(function(){var t=l.find("option>input.All").attr("checked");t?(e.filtered=!1,e.removeClass("filtered")):(e.filtered=!0,e.addClass("filtered")),self.reload(),e.popup.close()}),y.click(function(){e.popup.close()}),u.append(a),u.append(y),i.append(l),i.append(u)}e.popup?e.popup.getVisible()?e.popup.close():(e.popup.remove(".gridPopup"),e.popup.append(i),e.popup.show(),t.filter.mode==0&&o.focus()):(t.filter.mode==0?e.popup=$(e).popupManager(320,120,!0,localizedString("MISC_FILTER_TITLE")):t.filter.mode==1&&(e.popup=$(e).popupManager(250,330,!0,localizedString("MISC_FILTER_TITLE"))),e.popup.append(i),t.filter.mode==0&&o.focus())}}(o,r))}s.append(r.description),r.filter&&s.append(o),i.append(s),e.append(i)}thead.append(e)}}function showAllData(e){for(var t=0;t<rowCount;t++){var n=delegate.getRow(t);n.VisibleFilterValue=e}}function renderFloatHeader(){isReady()?onRenderFloatHeader():window.setTimeout(function(){renderFloatHeader()},800)}function onRenderFloatHeader(){var e=$("<table>").addClass("grid").attr({cellspacing:0}),t=$("<thead>"),n=$("<tr>"),r=floatHeader?floatHeader.find("th"):thead.find("th");for(var i=0;i<r.length;i++){var s=$(r[i]),o=$("<th>");o.css({width:s[0].style.width||s.width()+"px"}),o.addClass(s[0].className),i==0&&checkType==0?(o.css("cursor","pointer"),o.click(function(){var e=delegate.getRowCount();if(e&&e>0){var t=[];for(var n=0;n<e;n++)t.push(delegate.getRow(n));var r=delegate.getHeaderSpec();new exportCSV(this,{colList:r,data:t})}}),o.attr("title",localizedString("BTN_EXPORT_TIP"))):(o.attr("dataType",s.attr("dataType")),delegate.disableSort?delegate.disableSort()||o.bind("mouseup",sort):o.bind("mouseup",sort)),o.bind("mousedown",onMousedown),o.bind("mousemove",onMousemove),o.bind("mouseup",onMouseup);var u=s.contents();for(var a=0;a<u.length;a++)o.append(u[a]),s.append($(u[a]).clone());n.append(o)}var f=offset==null?0:offset.left+"px",l=offset==null?0:offset.top+"px",c=tbody.width()+"px";offset.top<0&&(l="1px"),e.css({width:c,top:l,left:f,position:"absolute"}),t.append(n),e.append(t),gridContainer.append(e),floatHeader&&floatHeader.remove(),floatHeader=e}function renderBody(){if(delegate.getRow!=undefined&&delegate.getRowCount!=undefined){rowCount=delegate.getRowCount();if(!rowCount){renderTip(),checkAllCtrl&&checkAllCtrl.attr({checked:0}).css("display","none");return}tip&&tip.remove(),checkAllCtrl&&(delegate.HideCheckAll==1?checkAllCtrl.css({display:"none"}):checkAllCtrl.css({display:"inline"}));var e=-1;delegate.getDefaultSelectedIndex&&(e=delegate.getDefaultSelectedIndex());var t=String(parseInt(Math.random()*100)),n=!1;for(var r=0;r<rowCount;r++){var i=$("<tr>"),s=delegate.getRow(r);if(delegate.alterColor&&s[delegate.alterColor]&&r>0){var o=delegate.getRow(r-1);s[delegate.alterColor]!==o[delegate.alterColor]?(n||i.addClass("stripe"),n=!n):n&&i.addClass("stripe")}checkType&&checkType==1&&(rowCount==0||rowCount>tbody.find("td:nth-child(1) input[type=checkbox]:checked").length)&&checkAllCtrl.attr("checked",!1);if(filters){var u=!1;if(filters.length==0)u=!0;else{var a=0;for(var f=0;f<filters.length;f++){var l=filters[f];(l["filter"]==undefined||l["filter"]==null||l["filter"]==""||s[l.columnName].indexOf($.trim(l["filter"]))!=-1)&&a++}a==filters.length&&(u=!0)}if(!u)continue}if(s.VisibleFilterValue==0)continue;if(checkType&&checkType==1){var c=$("<input>").attr({type:"checkbox"});i.append($("<td>").css({width:"20px"}).append(c)),gvCtrls.push(c),c.click(function(){var e=r;return function(t){var n={isChecked:this.checked,index:e,target:this};onRowChecked.call(n),delegate.removeCheckAll||(!this.checked&&checkAllCtrl.attr("checked")?checkAllCtrl.attr("checked",!1):rowCount>0&&rowCount==tbody.find("td:nth-child(1) input[type=checkbox]:checked").length&&checkAllCtrl.attr("checked",!0)),t.stopPropagation()}}());if(delegate.selectedData&&delegate.selectedData.length>0&&delegate.selectedData.length>0)for(var f=0;f<delegate.selectedData.length;f++)s.ID==delegate.selectedData[f]&&(c.attr({checked:!0}),c.click())}else if(checkType&&checkType==2){var h=$("<input>").attr({type:"radio",name:"radio"+t});i.append($("<td>").css({width:"20px"}).append(h)),gvCtrls.push(h),h.click(function(){var e=r;return function(t){var n={index:e};onRowChecked.call(n),t.stopPropagation()}}())}else i.append($("<td>").addClass("row_indicator"));renderRowContent(delegate,r,s,i,colSpec),i.click(function(){var e=r;return function(){var t=delegate.shouldExpandOnRowSelect==undefined||delegate.shouldExpandOnRowSelect&&delegate.shouldExpandOnRowSelect();t&&$(this).find(".groupToggle").click(),tbody.find("tr").removeClass("selected"),checkType!=1&&$(this).addClass("selected"),delegate.getNotAllowedSelected&&$(this).removeClass("selected"),onRowSelected(e)}}());if(typeof e=="number"){if(e>=0&&e==r)if(checkType&&checkType==1){var p=$(i).find('input[type="checkbox"]');p.size()>0&&$(p[0]).attr("checked","true"),rowCount==1&&!delegate.removeCheckAll&&checkAllCtrl.attr("checked",!0)}else if(checkType&&checkType==2){var d=$(i).find('input[type="radio"]');d.size()>0&&$(d[0]).attr("checked","true"),i.addClass("selected")}else i.addClass("selected")}else if(typeof e=="object")for(var f=0;f<e.length;f++)if(e[f]>=0&&e[f]==r)if(checkType&&checkType==1){var p=$(i).find('input[type="checkbox"]');p.size()>0&&$(p[0]).attr("checked","true"),rowCount==1&&!delegate.removeCheckAll&&checkAllCtrl.attr("checked",!0)}else if(checkType&&checkType==2){var d=$(i).find('input[type="radio"]');d.size()>0&&$(d[0]).attr("checked",!0),i.addClass("selected")}else i.addClass("selected");tbody.append(i),delegate.getSubDelegate&&renderSubRows(i,s,r)}!delegate.removeCheckAll&&rowCount>0&&rowCount==tbody.find("td:nth-child(1) input[type=checkbox]:checked").length&&checkAllCtrl.attr("checked",!0);var v=$(tbody).width();floatHeader!=null&&v>0&&$(floatHeader).css("width",v)}}function renderSubRows(e,t,n){var r=null,i=[],s=$("<a href='#'>").addClass("groupToggle");delegate.getSubDelegate&&(r=delegate.getSubDelegate(n));var o=function(){var t=r.getRowCount&&r.getRowCount()||0,n=r.getHeaderSpec&&r.getHeaderSpec()||colSpec,o=null;for(var u=0;u<t;u++){var a=$("<tr>").addClass("subRow"),f=r.getRow(u);checkType&&checkType==1?a.append($("<td>").css({width:"20px"})):checkType&&checkType==2?a.append($("<td>").css({width:"20px"})):a.append($("<td>").addClass("row_indicator")),renderRowContent(r,u,f,a,n),a.find("td:eq(1)").addClass("indent"),o!=null?o.after(a):e.after(a),o=a,i.push(a),(!r.shouldBeExapnd||!r.shouldBeExpand())&&a.hide()}for(var l=0;l<i.length;l++)s.hasClass("expand")?i[l].show(500):i[l].hide(500)};e.find("td:eq(1)").prepend(function(e,n){return s.click(function(e){var n=$(this);n.toggleClass("expand");if(r.loadSubData&&i.length<=0)r.loadSubData(t,o);else if(!r.loadSubData&&i<=0)o();else for(var s=0;s<i.length;s++)n.hasClass("expand")?i[s].show(500):i[s].hide(500);e.stopPropagation(),window.setTimeout(renderFloatHeader,500)}),s})}function renderRowContent(e,t,n,r,i){for(var s=0;s<i.length;s++){var o=i[s],u=$("<td>");t==0&&o.width&&u.css({width:o.width});var a={data:n,colName:o.name,row:t,col:s,cell:u,parentRow:r},f=null;e.getCell&&(f=e.getCell.call(a)),f==null?u.text(n[o.name]):u.append(f),typeof n[o["name"]]=="string"&&(f==null?u.attr("title",n[o.name]):typeof f=="string"&&u.attr("title",f)),r.append(u)}}function renderTip(){if(delegate&&delegate.getTip){tip&&tip.remove(),tip=$("<div>").addClass("tip").append(delegate.getTip()),gridContainer.append(tip);var e=(gridContainer.height()-thead.height()-tip.height()-(tip.height()==0?40:0))/2;tip.css({"padding-top":e+"px"})}}function onRowSelected(e){for(var t=0;t<rowSelectedEvent.length;t++)if(delegate&&delegate.getRow){var n={data:delegate.getRow(e),index:e};rowSelectedEvent[t].call(n)}else rowSelectedEvent[t].call({index:e})}function onRowChecked(){for(var e=0;e<rowCheckEvent.length;e++)delegate&&delegate.getRow?(this.data=delegate.getRow(this),rowCheckEvent[e].call(this)):rowCheckEvent[e].call(this)}function opCheckOnAll(e){var t=tbody.find("tr td:nth-child(1) input:checkbox");for(var n=0;n<t.length;n++)if(t[n].checked!=e){t[n].checked=e;var r={isChecked:e,index:n};onRowChecked.call(r)}}function setDoNotSortFlag(e){doNotSortFlag=e}function PagingArea(e,t){pagingArea=$("<div>").addClass("paging"),$(e).append(pagingArea),this.pageSize=t,this.totalCount=0,this.totalPageCount=0,this.currentCount=0,this.height=30,rowsLabel=$("<label>").addClass("totalCount"),self.printElementCount=printElementCount,this.pageLabel=$("<label>").append(localization.AUDIT_LOG_PAGING_LABEL).css({"vertical-align":"middle"}),this.prePage=$("<input>").attr({title:"previous page",type:"button",value:"< "}).css({"margin-right":"10px","vertical-align":"middle"}),this.firstPage=$("<input>").attr({title:"first page",type:"button",value:"|<"}).css({"margin-right":"5px","vertical-align":"middle"}),this.nextPage=$("<input>").attr({title:"next page",type:"button",value:" >"}).css({"margin-left":"10px","vertical-align":"middle"}),this.lastPage=$("<input>").attr({title:"last page",type:"button",value:">|"}).css({"margin-left":"5px","vertical-align":"middle"}),this.currentPageBox=$("<input>").css({"margin-left":"10px","vertical-align":"middle",width:"2em","text-align":"right"}),this.pageNumLabel=$("<label>").attr({id:"grid_pageNumber"}).css({width:"100px","vertical-align":"middle"}),pagingArea.append(rowsLabel),pagingArea.append(this.firstPage),pagingArea.append(this.prePage),pagingArea.append(this.pageLabel),pagingArea.append(this.currentPageBox),this.pageNumLabel.append(" of "+this.currentCount),pagingArea.append(this.pageNumLabel),pagingArea.append(this.nextPage),pagingArea.append(this.lastPage),this.currentPageBox.blur(function(){$(this).val(pagingArea.currentCount)}),this.currentPageBox.keydown(function(e){if(e.keyCode==13){var t=$(this).val(),n=new RegExp("^[1-9]\\d*$");if(!n.test(t)||t>pagingArea.totalPageCount){$(this).val(pagingArea.currentCount);return}if(t==pagingArea.currentCount)return;t==1?PagingArea.first():t==pagingArea.totalPageCount?PagingArea.last():(pagingArea.currentCount=parseInt(t),pagingAction=function(){this.firstPage.attr({disabled:!1}),this.prePage.attr({disabled:!1}),this.nextPage.attr({disabled:!1}),this.lastPage.attr({disabled:!1})},PagingArea.LoadPage((t-1)*pagingArea.pageSize,pagingArea.pageSize))}e.keyCode===8||e.keyCode===9||e.keyCode>=46&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105||(e.preventDefault(),e.stopPropagation())}),this.bind(this.firstPage,"click",PagingArea.first),this.bind(this.prePage,"click",PagingArea.pre),this.bind(this.nextPage,"click",PagingArea.next),this.bind(this.lastPage,"click",PagingArea.last)}var container=arguments[0],opts=arguments[1]||{},delegate=opts.delegate,checkType=opts.checkType||0,gvCtrls=[],self=this,colSpec=null,gridContainer=$("<div>").addClass("gridContainer"),table=$("<table>").addClass("grid").attr({cellspacing:0}),thead=$("<thead>"),tbody=$("<tbody>"),pagingArea=null,pagingAction=null,pagingLoadWindow=null,rowCount=0,tip=null,floatHeader=null,offset=null,checkAllCtrl=null,isShown=!1,filters=[],rowSelectedEvent=[],rowCheckEvent=[],rowsLabel=null,sortedBy=null,startMove=!1,currentTh=null,doNotSortFlag=!1;$("body").bind("mouseup",onMouseup),self.autoResize=function(){delegate.autoResize!=null&&delegate.autoResize()>0&&container&&$(gridContainer).css("height",$(window).height()-delegate.autoResize()+"px")},$(window).resize(function(){self.autoResize()}),PagingArea.prototype.refreshPageArea=function(){if(delegate.getRowCount&&!delegate.getRowCount()>0){this.firstPage.attr({disabled:!0}),this.prePage.attr({disabled:!0}),this.nextPage.attr({disabled:!0}),this.lastPage.attr({disabled:!0}),this.currentCount=0,this.totalPageCount=0,this.pageNumLabel.html("").append(" of "+this.totalPageCount),self.printElementCount(delegate.getRowCount(),this.totalCount),this.currentPageBox.val(0).attr({disabled:!0});return}if(delegate.getTotalCount){this.totalCount=delegate.getTotalCount(),delegate.splitPage!=undefined&&(delegate.getSplitPage()==0?this.pageSize=this.totalCount:delegate.pageSize!=undefined&&delegate.getPageSize()!=this.pageSize&&(this.pageSize=delegate.getPageSize())),this.totalPageCount=Math.ceil(this.totalCount/this.pageSize),this.currentCount=0,self.printElementCount(delegate.getRowCount(),this.totalCount);if(this.totalCount>this.pageSize){this.firstPage.attr({disabled:!0}),this.prePage.attr({disabled:!0}),this.nextPage.attr({disabled:!1}),this.lastPage.attr({disabled:!1}),this.currentCount=1,this.currentPageBox.val(this.currentCount).attr({disabled:!1}),this.pageNumLabel.html("").append(" of "+this.totalPageCount);return}this.totalCount==0?this.currentCount=0:this.currentCount=1,this.firstPage.attr({disabled:!0}),this.prePage.attr({disabled:!0}),this.nextPage.attr({disabled:!0}),this.lastPage.attr({disabled:!0}),this.pageNumLabel.html("").append(" of "+this.totalPageCount),self.printElementCount(delegate.getRowCount(),this.totalCount),this.currentPageBox.val(this.currentCount).attr({disabled:!0})}},PagingArea.first=function(){pagingAction=function(){this.currentCount=1,this.firstPage.attr({disabled:!0}),this.prePage.attr({disabled:!0}),this.nextPage.attr({disabled:!1}),this.lastPage.attr({disabled:!1}),this.currentPageBox.val(this.currentCount)},PagingArea.LoadPage(0,pagingArea.pageSize)},PagingArea.pre=function(){pagingAction=function(){this.currentCount--,this.nextPage.attr({disabled:!1}),this.lastPage.attr({disabled:!1}),this.currentCount==1?(this.firstPage.attr({disabled:!0}),this.prePage.attr({disabled:!0})):(this.firstPage.attr({disabled:!1}),this.prePage.attr({disabled:!1})),this.currentPageBox.val(this.currentCount)};var e=pagingArea.currentCount-1;PagingArea.LoadPage((e-1)*pagingArea.pageSize,pagingArea.pageSize)},PagingArea.next=function(){pagingAction=function(){this.currentCount++,this.firstPage.attr({disabled:!1}),this.prePage.attr({disabled:!1}),this.currentCount==this.totalPageCount?(this.nextPage.attr({disabled:!0}),this.lastPage.attr({disabled:!0})):(this.nextPage.attr({disabled:!1}),this.lastPage.attr({disabled:!1})),this.currentPageBox.val(this.currentCount)};var e=pagingArea.currentCount+1;PagingArea.LoadPage((e-1)*pagingArea.pageSize,pagingArea.pageSize)},PagingArea.last=function(){pagingAction=function(){this.currentCount=this.totalPageCount,this.firstPage.attr({disabled:!1}),this.prePage.attr({disabled:!1}),this.nextPage.attr({disabled:!0}),this.lastPage.attr({disabled:!0}),this.currentPageBox.val(this.currentCount)};var e=pagingArea.totalPageCount;PagingArea.LoadPage((e-1)*pagingArea.pageSize,pagingArea.pageSize)},PagingArea.LoadPage=function(e,t){if(delegate.showLoadingWindow==undefined||delegate.showLoadingWindow!==!1)pagingLoadWindow||(pagingLoadWindow=new loadingWindow),pagingLoadWindow.show();delegate.loadPage(e,t)},PagingArea.prototype.bind=function(e,t,n){var r=e.data("events");if(r==undefined){e.bind(t,n);return}var i=r[t];if(i==undefined){e.bind(t,n);return}},PagingArea.prototype.unbind=function(e,t){var n=e.data("events");if(n){var r=n[t];r&&e.unbind(t)}},self.show=show,self.reset=function(e){e&&e.delegate&&(delegate=e.delegate)},self.rowSelectedEvent=rowSelectedEvent,self.rowCheckEvent=rowCheckEvent,self.reload=reload,self.searchText=searchText,self.getDelegate=getDelegate,self.refreshContent=refreshContent,self.setDoNotSortFlag=setDoNotSortFlag,table.append(thead),table.append(tbody);if(container){gridContainer.append(table),$(container).append(gridContainer),delegate.pagingMode===!0&&(pagingArea||(pagingArea=new PagingArea(container,delegate.pageSize)),pagingArea.refreshPageArea());if(delegate&&delegate.getGridHeight){gridContainer.css({height:delegate.getGridHeight()+"px"}),gridContainer.bind("scroll",renderFloatHeader),$(window).bind("resize",function(){floatHeader&&(table.width()==0?floatHeader.remove():renderFloatHeader())});var containerHeight=delegate.pagingMode?delegate.getGridHeight()+pagingArea.height+6+"px":delegate.getGridHeight()+6+"px";container.css({overflow:"hidden",position:"relative"})}var dragger=$("<div>").addClass("dragger").attr("draggable","true"),sizeManager=new function(){var e=0,t=0,n=gridContainer.height(),r=n,i=0,s=this,o=Number.MAX_VALUE,u=!1,a=delegate.pagingMode?pagingArea.height+6:6;this.resizeStart=function(t){e=t.pageY,i=t.screenY,o=table.height(),n=gridContainer.height(),MouseButton.leftMouseBtn==t.which&&($(window).bind("mousemove",s.resize),$(window).bind("mouseup",s.resizeEnd),u=!0)},this.resizeEnd=function(e){MouseButton.leftMouseBtn==e.which&&(n=gridContainer.height(),$(window).unbind("mousemove",s.resize),$(window).unbind("mouseup",s.resizeEnd),delegate.autoResize!=null&&delegate.autoResize()>0&&delegate.forceAutoResize!=null&&delegate.forceAutoResize()===!0&&$(window).resize(),u=!1)},this.resize=function(r){u===!0&&(t=r.pageY-e,gridContainer.height(n+t+"px"))},this.maximize=function(e){if(delegate.getDetailsID!=null){var t=delegate.getDetailsID();if(t.is(":visible")===!0){t.hide();var i=$("#main").outerHeight(),s=gridContainer.parent().parent(),o=s.find(".title_panel").first().outerHeight(!0),u=s.find(".tools").first().outerHeight(!0),a=s.find(".paging").first().outerHeight(!0),f=s.find(".dragger").first().outerHeight(!0);gridContainer.height(i-o-u-a-f),r=n}else t.show(),gridContainer.height(r)}}};$(container).append(dragger),self.disableDragger=function(){dragger.unbind("mousedown",sizeManager.resizeStart)},dragger.bind("mousedown",sizeManager.resizeStart),dragger.bind("dblclick",sizeManager.maximize),(opts&&opts.undraggable==1||delegate.getDraggable!=null&&delegate.getDraggable()===!1)&&self.disableDragger()}};$.fn.gridview=function(e){return new gridview(this,e)}}(jQuery),function(e){"use strict";function t(t,n){var r=e('<div id="SLD_divTooltip"></div>').addClass("popup-tip"),i=10,s=10;if(n.messageList){var o=e("<table>");for(var u=0;u<n.messageList.length;u++){var a=n.messageList[u],f=e("<tr>");if(a.statusClass){var l=e("<td>"),c=e("<label>").addClass("ShowIcon_tip").addClass(a.statusClass);l.append(c),f.append(l)}var h=e("<td>").addClass("tipcell"),p=e("<div>").append(a.message);h.append(p),f.append(h),o.append(f)}r.append(o)}this.show=function(t){t=t?t:window.event;var n=parseInt(document.documentElement.scrollWidth),o=parseInt(document.documentElement.scrollHeight),u=parseInt(document.body.clientHeight+document.body.clientTop),a=e(this);a.find("*").each(function(){var t=e(this).attr("title");t!==undefined&&t.length>0&&e(this).attr("title","")}),e("body").append(r);var f=r.width(),l=r.height(),c=t.clientX+i,h=t.clientY+s,p=c+f-n>0?t.clientX-i-f:c,d=h+l-u>0?t.clientY-s-l:h;r.css({top:d+"px",left:p+"px"}),r.width(),r.fadeIn("slow")},this.remove=function(){e("#SLD_divTooltip").remove()}}e.fn.c3tip=function(e){var n=new t(this,e);return this.bind("mouseover",n.show).bind("mouseout",n.remove),this}}(jQuery),function(e){e.fn.dataform=function(e){return new dataform(this,e)}}(jQuery),function(e){e.fn.c3progress=function(e,t){return new c3progress(this,e,t)}}(jQuery),function(e){e.fn.c3progressWithStatus=function(e,t,n){return new c3progressWithStatus(this,e,t,n)}}(jQuery);var c3=c3||{};c3.task=function(e,t){var n=[],r=[],i=[],s=e||localizedString("MISC_DATA_PROCESSING"),o=t||10,u=this,a=0,f=0,l="";this.doneEvent=n,this.errorEvent=r,this.updateEvent=i,this.getStatus=function(){return a},this.getCompletePercent=function(){return f},this.getResultDesc=function(){return l},this.getWeight=function(){return o},this.getName=function(){return s},this.update=function(e){var t=e.data,n=t.Status;n=="Successful"||n=="Canceled"?a=2:n=="Failed"?a=-1:n=="Processing"?a=1:a=0,f=parseInt(t.ProgressPercentage),errorCode=t.ErrorCode,l=t.ResultDescription;for(var r=0,s=i.length;r<s;r++)i[r](e);a!=-1&&a!=2&&window.setTimeout(function(){u.execute()},c3config.Clocker*1e3),-1==a&&Utility.logTaskError(t)},this.success=function(e){for(var t=0,r=n.length;t<r;t++)n[t](e)},this.error=function(e){for(var t=0,n=r.length;t<n;t++)r[t](e)},this.ajaxCallBackConfig={success:u.success,error:u.error},this.updateCallback={success:u.update,error:u.error}};var c3=c3||{};c3.dialog=function(e){"use strict";function u(){if(t.finish){t.finish();for(var e=0;e<t.finishEvent.length;e++)t.finishEvent[e]()}else t.close()}c3.module.call(this),this._container=$("<div>");var t=this,n=$("<div>").addClass("mess"),r=e||{},i=function(){var e=localizedString("MISC_FINISH");return r.getActionButtonText&&(e=r.getActionButtonText()),e},s=function(){var e=localizedString("MISC_CLOSE");return r.getCloseButtonText&&(e=r.getCloseButtonText()),e},o;this.dom=this._container,this.onCancel=[],this.onClose=[],this.onShow=[],this.finishEvent=[],this.getId=function(){return"simpleWin"},this.getTitle=function(){return"WIZARD"},this.getWidth=function(){return 600},this.getHeight=function(){return 480},this.onFinish=function(){if(r&&r.validator){var e=r.validator;if(e){e.validEvent?e.checkValidity():e.checkValidity()&&u();return}}u()},this.cancel=function(){for(var e=0;e<this.onCancel.length;e++)this.onCancel[e]();t.close()},this.close=function(){for(var e=0;e<this.onClose.length;e++)this.onClose[e]();this.pop&&this.pop.close(),this.pop=null},this.show=function(e){this.onInit(),r&&r.validator&&r.validator.validEvent&&r.validator.validEvent.push(u),this.dom.attr({id:this.getId()}),this.dom.addClass("simpleWin"),this.dom.append(this.createContent()),this.dom.append(this.createToolBar()),this.pop=this.dom.c3popwin(this.getWidth(),this.getHeight(),this.getTitle(),{maskRegion:e});if(r&&r.hideCloseButton==1){var t=this.dom.find("#simpleWin_btnCancel");t.size()>0&&$(t[0]).css("display","none")}for(var n=0;n<this.onShow.length;n++)this.onShow[n]();this.onViewAppear()},this.showError=function(e){n&&n.length>0&&(n.addClass("error"),n.html(e),n.attr({title:e}),n.show(500))},o=function(e,t,n,r){if(n.error==undefined||r!=undefined){var i=retriveErrorMessage(t.responseText);showError(i)}},this.createToolBar=function(){var e=$("<div>").addClass("tools");return this.btnCancel=$("<input>").attr({id:this.getId()+"_btnCancel",type:"button",value:s()}),r.getActionButton?this.btnFinish=r.getActionButton():this.btnFinish=$("<input>").attr({id:this.getId()+"_btnFinish",type:"button",value:i()}),this.btnCancel.bind("click",function(){t.cancel()}),this.btnFinish&&this.btnFinish.bind("click",t.onFinish),e.append(n),n.ajaxError(o),n.hide(),r.getActionButton||e.append(this.btnFinish),e.append(this.btnCancel),e},this.createContent=function(){var e=$("<div>").addClass("main");return e.append(this.content),e},this.readyForFinish=function(){t.btnFinish.removeAttr("disabled")},this.disableFinish=function(){t.btnFinish.attr({disabled:!0})},this.disableClose=function(){t.btnCancel.attr({disabled:!0})},this.readyForClose=function(){t.btnCancel.removeAttr("disabled")}};var c3=c3||{};c3.wizard=function(){function r(){if(e.step==0){e.beforePrepareSteps.push(function(){var t=e.dom.find(".steps");t.size()>0&&e.dom.find(".steps").remove()});if(e.beforePrepareSteps.length)for(var t=0,n=e.beforePrepareSteps.length;t<n;t++)e.beforePrepareSteps[t]();e.maxStep=e.getStepCount()}if(e.step<e.maxStep){e.step++;for(var t=e.step-1;t<e.steps.length;t++){if(!e.steps[t].getIsDisabled())break;e.step++}}else e.onFinish();e.step==e.maxStep&&e.btnNext.attr({value:"Finish"}),e.step>e.minStep&&e.btnBack.removeAttr("disabled"),e.minStep==0&&e.step==1&&(e.createSteps(),e.stepPanel&&e.dom.append(e.stepPanel),e.welcomePanel.hide(),e.stepPanel.show()),!e.welcomePanel&&e.minStep==1&&e.step==1&&(e.createSteps(),e.stepPanel&&e.dom.append(e.stepPanel),e.stepPanel.show());if(e.step>0){e.prepareStep();for(var t=0;t<e.nextEvent.length;t++)e.nextEvent[t](e.step)}if(e.getStepCount()>7){var r=e.dom.find(".steps");if(r.size()>0){var i=e.step-3,s=e.getStepCount()-7;if(i>0&&i<=s){var o=$(r[0]).css("margin-top");o=isNaN(parseFloat(o))?0:parseFloat(o),e.moveAnimation($(r[0]),o,-1*i*50)}var u=e.dom.find(".to_be_continued");e.step+4==e.getStepCount()&&u.size()>0&&$(u[0]).css({display:"none"})}}e.resetError()}function i(t,n,r){n!=r&&(n>r?n--:n++,t.css("margin-top",n+"px"),setTimeout(function(){e.moveAnimation(t,n,r)},10))}function s(){var t=e.step;for(var n=e.step-1;n<e.steps.length;n++){if(e.steps[n].getIsDisabled())continue;var r=e.stepList.find("li#step_"+n+" label#step_num_"+n);r.empty(),r.append(t++)}}function o(t){if(e.step>0){var n=e.getStep(e.step-1).validator;if(n){n.validEvent?n.checkValidity():n.checkValidity()&&r();return}}r()}var e=this,t=$("<div>").addClass("mess");this.dom=$("<div>");var n=arguments[0]||null;this.beforePrepareSteps=[],this.nextEvent=[],this.backEvent=[],this.cancelEvent=[],this.closeEvent=[],this.showEvent=[],this.step=0,this.minStep=0,this.maxStep=0,this.getId=function(){return"wizard"},this.getTitle=function(){return"WIZARD"},this.getWidth=function(){return 720},this.getHeight=function(){return 480},this.getWelcomeScreen=function(){},this.getStepCount=function(){return 0},this.getStep=function(e){return $("<div>")},this.getStepName=function(e){return"STEP_NAME"},this.getStepTitle=function(e){return"STEP_TITLE"},this.getStepSubtitle=function(e){return"STEP_SUBTITLE"},this.next=r,this.moveAnimation=i,this.back=function(){e.resetError();if(e.getStepCount()>7){var t=e.dom.find(".steps");if(t.size()>0){var n=e.step-3,r=$(t[0]).css("margin-top");r=isNaN(parseFloat(r))?0:parseFloat(r);var i=Math.abs(r/50);r+=50,n==i&&r<=0&&e.moveAnimation($(t[0]),r-50,r);var s=e.dom.find(".to_be_continued");e.step+3<e.getStepCount()&&s.size()>0&&$(s[0]).css({display:"inline"})}}e.step==e.maxStep&&e.btnNext.attr({value:"Next >"});if(e.step>e.minStep){e.step--;for(var o=e.step-1;o>=0;o--){if(!e.steps[o].getIsDisabled())break;e.step--}e.btnNext.removeAttr("disabled")}e.step==e.minStep&&e.btnBack.attr("disabled",1);if(e.step==0)e.welcomePanel.show(),e.stepPanel.hide(),e.btnBack.attr("disabled",1);else{e.prepareStep();for(var o=0;o<e.backEvent.length;o++)e.backEvent[o](o)}},this.prepareStep=function(){e.step>0&&(e.stepTitle.html(e.getStepTitle(e.step-1)),e.stepSubtitle.html(e.getStepSubtitle(e.step-1)),e.stepList.find("li").removeClass("selected"),e.stepList.find("li:lt("+(e.step-1)+")").removeClass("unfinished"),e.stepList.find("li:eq("+(e.step-1)+")").addClass("selected"),e.stepList.find("li:gt("+(e.step-1)+")").addClass("unfinished"),e.stepMain.find(".stepContent").hide(),e.getStep(e.step-1).onViewWillAppear())},this.readyForNext=function(){e.btnNext.removeAttr("disabled")},this.enableNext=this.readyForNext,this.disableNext=function(){e.btnNext.attr({disabled:"true"})},this.disableBack=function(){e.btnBack.attr({disabled:"true"})},this.disableCancel=function(){e.btnCancel.attr({disabled:"true"})},this.enableBack=function(){e.btnBack.removeAttr("disabled")},this.disableStep=function(t){var n=[];$.isArray(t)?n=$.merge(n,t):n.push(t),$.each(n,function(t,n){if(n<e.step-1)throw new RangeError("Cannot disable previous step. (Current step:"+e.step+"; Step to disable:"+n+")");if(n==e.step-1)throw new RangeError("Cannot disable current step.")}),$.each(n,function(t,n){var r=n;e.stepList.find("li#step_"+r).hide(),e.getStep(r).setIsDisabled(!0)}),s()},this.enableStep=function(t){var n=[];$.isArray(t)?n=$.merge(n,t):n.push(t),$.each(n,function(t,n){var r=n;e.stepList.find("li#step_"+r).show(),e.getStep(r).setIsDisabled(!1)}),s()},this.onFinish=function(){this.finish&&this.finish(),this.close()},this.cancel=function(){for(var t=0;t<this.cancelEvent.length;t++)this.cancelEvent[t]();e.close()},this.close=function(){for(var e=0;e<this.closeEvent.length;e++)this.closeEvent[e]();this.pop.close(),this.pop=null},this.show=function(){this.onInit&&this.onInit(),this.onInitNotification&&this.onInitNotification(),this.dom.attr({id:this.getId()}),this.dom.addClass("wizard"),this.createWelcome(),this.welcomePanel?this.dom.append(this.welcomePanel):this.next(),this.dom.append(this.createToolBar()),this.pop=this.dom.c3popwin(this.getWidth(),this.getHeight(),this.getTitle(),null,n);for(var e=0;e<this.showEvent.length;e++)this.showEvent[e]();this.btnNext.focus()},this.showError=function(e){t&&t.length>0&&(t.addClass("error"),t.html(e),t.attr({title:e}),t.show(100))};var u=function(e,t){if(arguments[2].error!=undefined)return;var n=retriveErrorMessage(t.responseText);showError(n)};this.createToolBar=function(){var n=$("<div>").addClass("tools");return this.btnCancel=$("<input>").attr({id:this.getId()+"_btnCancel",type:"button",value:"Cancel"}),this.btnBack=$("<input>").attr({id:this.getId()+"_btnBack",type:"button",value:"< Back",disabled:1}),this.btnNext=$("<input>").attr({id:this.getId()+"_btnNext",type:"button",value:"Next >"}),this.btnBack.bind("click",this.back),this.btnNext.bind("click",o),this.btnCancel.bind("click",function(){e.cancel()}),n.append(t),t.ajaxError(u),t.hide(),n.append(this.btnCancel),n.append(this.btnBack),n.append(this.btnNext),n},this.createWelcome=function(){this.welcomePanel=this.getWelcomeScreen(),this.welcomePanel||(this.minStep=1)},this.createSteps=function(){this.stepPanel=$("<div>").css({height:"400px"}),this.stepMain=$("<div>").addClass("main"),this.stepTitle=$("<h1>"),this.stepSubtitle=$("<h2>");var t=$("<hgroup>");t.append(this.stepTitle),t.append(this.stepSubtitle),this.stepMain.append(t);var n=$("<div>").css({height:"400px",width:"30.7%","float":"left",overflow:"hidden"}),i=$("<div>").css({height:"350px",width:"100%","float":"left",overflow:"hidden"});this.stepList=$("<ul>").attr({"class":"steps"}),this.stepList.css({height:this.getHeight()});var s=this.getStepCount(),o=0;for(var u=0;u<s;u++){var a=$("<li>").addClass("unfinished");a.attr({id:"step_"+u}),e.steps[u].getIsDisabled()?a.hide():o++,a.append($("<label>").attr({id:"step_num_"+u}).append(o).addClass("stepNum")),a.append($("<label>").append(this.getStepName(u)).addClass("stepName")),this.stepList.append(a)}i.append(this.stepList),n.append(i),this.getStepCount()>7?n.append($("<div>").addClass("to_be_continued")):i.css({height:"400px"}),this.stepPanel.append(n);for(var u=0;u<this.maxStep;u++){var f=this.getStep(u);this.stepMain.append(f.getContainer().addClass("stepContent")),f.validator&&f.validator.validEvent&&f.validator.validEvent.push(r)}this.stepPanel.append(this.stepMain)},this.resetError=function(){t&&(t.attr("class","mess"),t.html(""),t.hide(500))}},c3.wizard.welcomeTemplate=function(e,t,n,r,i){var s=$("<div>").addClass("welcome").append($("<h1>").append(e)).append($("<p>").append(t));return n&&r&&i&&s.append($("<fieldset>").addClass("fieldset").append($("<legend>").append($("<span>").css("font-weight","bold").append(n))).append($("<div>").addClass("guide_description").append(r)).append($("<div>").append(i))),s};var c3=c3||{};c3.module=function(){this._isInit=!1,this._isInitNotification=!1,this._isDisabled=!1,this.getContainer=function(){return this._container},this.getTitle=function(){return this._title},this.onInit=function(){},this.onInitNotification=function(){},this.onResize=function(){},this.onViewWillAppear=function(){this._isInit||(this._isInit=!0,this.onInit()),this._isInitNotification||(this._isInitNotification=!0,this.onInitNotification()),this.getContainer().show(),this.onViewAppear()},this.onViewAppear=function(){},this.onViewWillDisappear=function(){},this.onViewDisappear=function(){},this.getIsDisabled=function(){return this._isDisabled},this.setIsDisabled=function(e){this._isDisabled=e}},function(e){e.fn.searchHelper=function(e,t){return new searchHelper(this,e,t)}}(jQuery),window.confirm=confirmWin;var MessageBoxIcon={CONFIRM:0,ERROR:1,INFORMATION:2,QUESTION:3,WARNING:4},MessageBoxButton={OKCANCEL:0,YESNO:1,OK:2,CLOSE:3},MessageBox={confirm:function(e){if(typeof e!="object"){var t=e;e={},e.msg=t}return e&&(e.icon=MessageBoxIcon.CONFIRM,e.buttons=MessageBoxButton.YESNO),msgBox(e)},prompt:function(e){if(typeof e!="object"){var t=e;e={},e.msg=t}return e&&(e.title||(e.title=localizedString("MSGBOX_CONFIRMATION")),null==e.width&&(e.width=320),null==e.height&&(e.height=150),e.multiline?e.buttons=MessageBoxButton.OKCANCEL:e.buttons=MessageBoxButton.CLOSE),msgBox(e,!0)},show:function(e){return e.buttons||(e.buttons=MessageBoxButton.YESNO),msgBox(e)}};(function(){"use strict";var e;e=function(e){var t=function(){return $("<input>").attr({type:"button"})};return new window.BaseControl(e,t)},window.Button=e})(),function(){"use strict";var e,t,n,r={},i,s={},o,u=["datasource","selectedDataItem"],a=["type","bindings","commands","header","fields","empty","getCell","getTotalCount","getViewContent","permissionitems","text","html","gridHeight","style","visiable","gridExport"],f=["onRowSelected","getCell","getTotalCount","submit"];s.setbindings=function(e,t,n,r){var i,s,o=function(s){var o=function(t){u.indexOf(s)!==-1?(r[s]=t,r[s+"Updated"].apply(null,[t])):s==="text"?e.text(t):s==="visiable"?t===!0?e.show():e.hide():e.attr(s,t)};t.subscribe(n.bindings[i],o)};if(n.commands)for(i in n.commands)n.commands.hasOwnProperty(i)&&f.indexOf(i)===-1&&e.bind(i,t[n.commands[i]]);if(n.style)for(i in n.style)n.style.hasOwnProperty(i)&&e.css(i,n.style[i]);if(n.bindings)for(i in n.bindings)n.bindings.hasOwnProperty(i)&&(o(i),u.indexOf(i)!==-1?r[i]=t[n.bindings[i]]:i==="text"?e.text(t[n.bindings[i]]):e.attr(i,t[n.bindings[i]]));for(i in n)n.hasOwnProperty(i)&&(a.indexOf(i)===-1?e.attr(i,n[i]):i==="text"&&e.text(n[i]))},r.div=function(e,t,n){var r=$("<div>");return s.setbindings(r,t,e),r},r.lable=function(e,t,n){var r=$("<lable>");return s.setbindings(r,t,e),r},r.selector=function(e,t,n){var r=$("<select>"),i={},o=e.displayItem;return i.datasourceUpdated=function(e){var t,n,i,s;r.empty();for(t=0,n=e.length;t<n;t++)s=e[t],i=$("<option>").attr({value:s[o],title:s[o]}).append(s[o]),r.append(i)},s.setbindings(r,t,e,i),e.hasOwnProperty("commands")&&e.commands.hasOwnProperty("onRowSelected")&&r.bind("change",function(){if($(this).val()==="")return;t[e.commands.onRowSelected].apply(t,[$(this).val()])}),r},r.refresh=function(e,t,n){var r=$("<a>").attr({title:"Refresh"}).addClass("refresh");return s.setbindings(r,t,e),r},r.button=function(e,t,r){var i=new Button,o,u;return s.setbindings(i.dom,t,e),e.hasOwnProperty("content")&&(o=n(e.content,t,r),i.dom.append(o)),i.dom},r.split=function(e,t,n){return(new window.Split).dom},r.gridview=function(e,t,n){var r=$("<section>"),i,o,u={},a,f,l;return u.selectedDataItemUpdated=function(e){},u.datasourceUpdated=function(r){var s,o=[],l=function(t){return u.selectedItem===undefined?!1:t[e.gridKey]===u.selectedItem[e.gridKey]};i.index=undefined;if(u.datasource.length>0)if(e.hasOwnProperty("gridKey")&&n){o=r.filter(l);if(o.length>0)u.selectindex=r.indexOf(o[0]),u.selectedItem=o[0],n&&(t.selectedDataItem=o[0]),e.commands&&(e.commands.hasOwnProperty("onRowSelected")&&e.commands.onRowSelected!=="masterRowSelected"&&t[e.commands.onRowSelected].apply(t,[u.selectindex]),e.bindings&&e.bindings.hasOwnProperty("selectedDataItem")&&(t[e.bindings.selectedDataItem]=o[0]));else for(a=0,f=i.rowSelectedEvent.length;a<f;a++)i.rowSelectedEvent[a].apply(i,[])}else for(a=0,f=i.rowSelectedEvent.length;a<f;a++)i.rowSelectedEvent[a].apply(i,[]);else u.datasource.length===0&&(u.selectindex=-1,u.selectedItem=undefined);i.reload()},u.selectindex=-1,o={pagingMode:t.title=="Resellers"&&e.bindings.datasource!="SUs"&&e.bindings.datasource!="Customers"&&e.bindings.datasource!="Licenses"&&e.bindings.datasource!="Storage"&&e.bindings.datasource!="Auths"&&e.bindings.datasource!="Users"?!0:!1,pageSize:10,getHeaderSpec:function(){return e.header},getRowCount:function(){return u.datasource===null?0:u.datasource.length},getRow:function(e){return u.datasource[e]},getDefaultSelectedIndex:function(){return u.selectindex},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getTotalCount:function(){},loadPage:function(e,n){c3.service.getResellers().expand("Group").skip(e).top(n).query({success:function(e){t.masterDataSource.clear();for(var n=0;n<e.data.length;n++)t.masterDataSource.push(e.data[n]);t.masterGrid.refreshContent(),t.masterRowSelected(0)},error:function(e){}})},getCell:function(){}},e.hasOwnProperty("gridExport")&&e.gridExport===!1&&(o.needExport=function(){return!1}),n&&(e.bindings===undefined||e.bindings.datasource===undefined)&&(u.datasource=t.masterDataSource,t.subscribe("masterDataSource",function(e){u.datasource=e,u.datasourceUpdated()})),s.setbindings(r,t,e,u),e.gridHeight!==undefined&&(o.getGridHeight=function(){return e.gridHeight}),i=$(r).gridview({delegate:o}),n&&(i.disableDragger(),t.masterGrid=i,i.rowSelectedEvent.push(function(){u.selectindex!==this.index&&(this.index=this.index===undefined?0:this.index,u.selectindex=this.index,t.masterRowSelected(this.index),u.selectedItem=u.datasource[this.index])})),e.commands!==undefined&&(e.commands.hasOwnProperty("onRowSelected")&&e.commands.onRowSelected!=="masterRowSelected"&&i.rowSelectedEvent.push(function(){u.selectindex!==this.index&&(this.index=this.index===undefined?0:this.index,u.selectindex=this.index,t[e.commands.onRowSelected].apply(t,[this.index]),u.selectedItem=u.datasource[this.index])}),e.hasOwnProperty("getCell")&&t[e.getCell]!==undefined&&typeof t[e.getCell]=="function"&&(o.getCell=function(){var n=this;return t[e.getCell].apply(n,[n])}),e.hasOwnProperty("getTotalCount")&&t[e.getTotalCount]!==undefined&&typeof t[e.getTotalCount]=="function"&&(o.getTotalCount=function(){var n=this;return t[e.getTotalCount].apply(n,[n])})),e.bindings&&e.bindings.hasOwnProperty("selectedDataItem")&&i.rowSelectedEvent.push(function(){u.selectindex!==this.index&&(this.index=this.index===undefined?0:this.index,u.selectindex=this.index,t[e.bindings.selectedDataItem]=u.datasource[this.index],u.selectedItem=u.datasource[this.index])}),e.hasOwnProperty("empty")&&e.empty.hasOwnProperty("text")&&e.empty.hasOwnProperty("command")&&(o.getTip=function(){return Utility.CreateTipBoard(e.empty.text,function(){t[e.empty.command].apply(t,null)})}),i.show(),r},r.dataform=function(e,t,n){var r=$("<section>"),i=[],o=e.fields,u={},a={},f={},l;return a.datasourceUpdated=function(e){l.setDataSource(a.datasource),l.dataBind(),l.changeMode(0)},a.datasource=[],i.push(o),u={getColumns:function(){return i},getViewContent:function(){}},e.hasOwnProperty("hideToolbar")&&(f.hideToolbar=e.hideToolbar),l=$(r).dataform({delegate:u,hideToolbar:f.hideToolbar}),!n&&(e.bindings===undefined||e.bindings.datasource===undefined)&&(a.datasource=t.selectedDataItem,t.subscribe("selectedDataItem",function(e){a.datasource=e,a.datasourceUpdated()})),e.hasOwnProperty("commands")&&e.commands.hasOwnProperty("submit")&&(l.submit=function(n,r){t[e.commands.submit].apply(null,[{data:n,callback:r}])}),e.hasOwnProperty("getViewContent")&&(u.getViewContent=function(){var n=this;return t[e.getViewContent].apply(n,[n])}),s.setbindings(r,t,e,a),r},n=function(e,t,n){var i=e.type,s;return s=r[i].apply(null,[e,t,n]),s},o=function(e,t,r){var i,s,o,u;i=$("<section>").addClass("tools");for(s=0,o=e.left.length;s<o;s++)i.append(n(e.left[s],t,r));for(s=0,o=e.right.length;s<o;s++)u=$("<div>").css({"float":"right"}),u.append(n(e.right[s],t,r)),i.append(u);return i},t=function(e,t){function x(e,t){var n,r,i=0;for(n=0,r=e.length;n<r;n++)$(e[n]).click(function(){var n=e.index(this);if(i===n)return;$(e).removeClass("selected"),$(e).removeClass("brother"),$(this).addClass("selected"),n!==-1&&$(e[n-1]).addClass("brother"),$(t[i]).hide(),$(t[n]).show(),i=n});$(t[0]).show()}var r=t.id,i=e.master,s=e.details,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;u=t.view;for(a=0,f=i.toolbars.length;a<f;a++)l=i.toolbars[a],c=o(l,t,!0),u.append(c);v=n(i.content,t,!0),u.append(v);if(s===undefined||s.tabs===undefined)return;m=$("<section>").addClass("tab").attr("id",r+"detailContainer"),m.append($("<h1>").append(s.title)),g=$("<ul>").addClass("detail_tab_header"),b=$("<section>").attr({id:r+"_tab_body"}).addClass("detail_tab_body");for(a=0,f=s.tabs.length;a<f;a++){w=s.tabs[a],S=$("<section>"),y=$("<a>").attr({href:"#"}).append(w.title),a===0&&y.addClass("selected"),g.append($("<li>").attr({id:r+a.toString()}).append(y));for(h=0,p=w.toolbars.length;h<p;h++)l=w.toolbars[h],c=o(l,t,!1),S.append(c);v=n(w.content,t,!1),S.append(v),S.hide(),b.append(S)}x($("a",g),$("> section",b)),m.append(g),m.append(b),u.append(m)},e=function(e,t){this.loading=new window.loadingWindow,this.loadingCount=0,this.m_subscribeList={},this.tmpl=t,this.id=e,this.view=$("<section>").attr({id:e}),this.container=$("<section>").attr({id:e+"container"}),this.container.append(this.view),this.isInited=!1,this.defineProperty("masterDataSource",[]),this.defineProperty("selectedDataItem")},e.prototype.timeout=function(e,t){var n=this,r,i=function(){if(n.noTimer===!0)return;e.call(),n.timeout.apply(n,[e,t])};n.noTimer===undefined&&(n.noTimer=!1),r=window.setTimeout(i,t),n.timeroutId=r},e.prototype.elementResize=function(e,t){var n=this;(function(){var r=e.width(),i=e.height();n.timeout(function(){if(e.width()>0||e.height()>0)r=e.width(),i=e.height(),t.call(),n.noTimer=!0},500)})()},e.prototype.stopTimeout=function(){window.clearTimeout(this.timeroutId),this.timeroutId=undefined},e.prototype.showloading=function(){this.loadingCount++,this.loadingCount>0&&this.loading.show()},e.prototype.stoploading=function(){this.loadingCount--,this.loadingCount===0?this.loading.close():this.loadingCount<0&&(this.loadingCount=0)},e.prototype.setTitle=function(e){this.title=e,$(".title_panel",this.container).length===0?this.container.prepend($("<div>").attr("class","title_panel").append(this.title)):$(".title_panel",this.container).text(e)},e.prototype.getTitle=function(){return this.title},e.prototype.render=function(e,n){var r=this,i;if(!this.isInited||n)this.view.empty(),this.isInited=!0,t(e,this),this.onInitNotification(),this.onLoaded();r.timeroutId===undefined&&(i=$("#"+this.id+"detailContainer",this.view),this.elementResize(i,function(){if(i.width()===0&&i.height()===0)return;var e=r.masterGrid.getDelegate(),t=i.height();e.autoResize=function(){return t+230},r.masterGrid.autoResize()}))},e.prototype.masterRowSelected=function(e){this.selectedDataItem=this.masterDataSource[e]},e.prototype.defineProperty=function(e,t){var n=this;(function(){var t=null;Object.defineProperty(n,e,{get:function(){return t},set:function(r){t=r,n.publish(e,[r])}})})(),t!==undefined&&(n[e]=t)},e.prototype.defineCommand=function(e,t){this[e]=t===undefined?function(){}:t},e.prototype.subscribe=function(e,t){this.m_subscribeList[e]===undefined&&(this.m_subscribeList[e]=[]);var n=this.m_subscribeList[e],r=function(e){return e===t};n.filter(r).length===0&&this.m_subscribeList[e].push(t)},e.prototype.observe=function(e){var t=this;return{onChanged:function(n){t.subscribe(e,n)}}},e.prototype.publish=function(e,t){var n=this.m_subscribeList[e],r,i;if(n)for(r=0,i=n.length;r<i;r++)n[r].apply(null,t)},e.prototype.onLoaded=function(){throw"please override onLoaded function!"},e.prototype.onInitNotification=function(){},e.prototype.reload=function(){this.onLoaded()},e.prototype.onViewWillAppear=function(){var e=this;this.render(this.tmpl,!1)},e.prototype.show=function(){this.container.show()},e.prototype.hide=function(){this.container.hide(),this.stopTimeout()},e.prototype.onViewWillDisappear=function(){this.hide()},e.prototype.getContainer=function(){return this.container},window.MDModule=e,window.MDModule.buildConstruct=function(e,t,n){var r,i,s,o;return e instanceof window.MDModule?(o=e,s=t):(r=e,i=t,s=n,o=new window.MDModule(e,t)),n.prototype=o,s}}(),typeof dojo!="undefined"?dojo.provide("org.cometd"):(this.org=this.org||{},org.cometd={}),org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(e){throw"Abstract"},org.cometd.Utils={},org.cometd.Utils.isString=function(e){return e===undefined||e===null?!1:typeof e=="string"||e instanceof String},org.cometd.Utils.isArray=function(e){return e===undefined||e===null?!1:e instanceof Array},org.cometd.Utils.inArray=function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1},org.cometd.Utils.setTimeout=function(e,t,n){return window.setTimeout(function(){try{t()}catch(n){e._debug("Exception invoking timed function",t,n)}},n)},org.cometd.Utils.clearTimeout=function(e){window.clearTimeout(e)},org.cometd.TransportRegistry=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,r,i){var s=[];for(var o=0;o<e.length;++o){var u=e[o];t[u].accept(n,r,i)===!0&&s.push(u)}return s},this.negotiateTransport=function(n,r,i,s){for(var o=0;o<e.length;++o){var u=e[o];for(var a=0;a<n.length;++a)if(u===n[a]){var f=t[u];if(f.accept(r,i,s)===!0)return f}}return null},this.add=function(n,r,i){var s=!1;for(var o=0;o<e.length;++o)if(e[o]===n){s=!0;break}return s||(typeof i!="number"?e.push(n):e.splice(i,0,n),t[n]=r),!s},this.find=function(n){for(var r=0;r<e.length;++r)if(e[r]===n)return t[n];return null},this.remove=function(n){for(var r=0;r<e.length;++r)if(e[r]===n){e.splice(r,1);var i=t[n];return delete t[n],i}return null},this.clear=function(){e=[],t={}},this.reset=function(){for(var n=0;n<e.length;++n)t[e[n]].reset()}},org.cometd.Transport=function(){var e,t;this.registered=function(n,r){e=n,t=r},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,n){return org.cometd.Utils.setTimeout(t,e,n)},this.clearTimeout=function(e){org.cometd.Utils.clearTimeout(e)},this.convertToMessages=function(e){if(org.cometd.Utils.isString(e))try{return org.cometd.JSON.fromJSON(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(org.cometd.Utils.isArray(e))return e;if(e===undefined||e===null)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(e,t,n){throw"Abstract"},this.getType=function(){return e},this.send=function(e,t){throw"Abstract"},this.reset=function(){this._debug("Transport",e,"reset")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(e){function t(){}return t.prototype=e,new t},org.cometd.RequestTransport=function(){function o(e){while(s.length>0){var t=s[0],n=t[0],r=t[1];if(n.url===e.url&&n.sync===e.sync){s.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",r.id);continue}break}}function u(e,t){this.transportSend(e,t),t.expired=!1;if(!e.sync){var n=this.getConfiguration().maxNetworkDelay,r=n;t.metaConnect===!0&&(r+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",r,"ms for the response, maxNetworkDelay",n);var i=this;t.timeout=this.setTimeout(function(){t.expired=!0,t.xhr&&t.xhr.abort();var n="Request "+t.id+" of transport "+i.getType()+" exceeded "+r+" ms max network delay";i._debug(n),i.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,"timeout",n)},r)}}function a(e){var t=++n,r={id:t,metaConnect:!1};i.length<this.getConfiguration().maxConnections-1?(i.push(r),u.call(this,e,r)):(this._debug("Transport",this.getType(),"queueing request",t,"envelope",e),s.push([e,r]))}function f(e){var t=e.id;this._debug("Transport",this.getType(),"metaConnect complete, request",t);if(r!==null&&r.id!==t)throw"Longpoll request mismatch, completing request "+t;r=null}function l(e,t){var n=org.cometd.Utils.inArray(e,i);n>=0&&i.splice(n,1);if(s.length>0){var r=s.shift(),u=r[0],f=r[1];this._debug("Transport dequeued request",f.id);if(t)this.getConfiguration().autoBatch&&o.call(this,u),a.call(this,u),this._debug("Transport completed request",e.id,u);else{var l=this;this.setTimeout(function(){l.complete(f,!1,f.metaConnect),u.onFailure(f.xhr,u.messages,"error","Previous request failed")},0)}}}function c(e){if(r!==null)throw"Concurrent metaConnect requests not allowed, request id="+r.id+" not yet completed";var t=++n;this._debug("Transport",this.getType(),"metaConnect send, request",t,"envelope",e);var i={id:t,metaConnect:!0};u.call(this,e,i),r=i}var e=new org.cometd.Transport,t=org.cometd.Transport.derive(e),n=0,r=null,i=[],s=[];return t.complete=function(e,t,n){n?f.call(this,e):l.call(this,e,t)},t.transportSend=function(e,t){throw"Abstract"},t.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,"Empty HTTP response"))},t.transportFailure=function(e,t,n,r){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n,r))},t.send=function(e,t){t?c.call(this,e):a.call(this,e)},t.abort=function(){e.abort();for(var t=0;t<i.length;++t){var n=i[t];this._debug("Aborting request",n),n.xhr&&n.xhr.abort()}r&&(this._debug("Aborting metaConnect request",r),r.xhr&&r.xhr.abort()),this.reset()},t.reset=function(){e.reset(),r=null,i=[],s=[]},t},org.cometd.LongPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e),n=!0;return t.accept=function(e,t,r){return n||!t},t.xhrSend=function(e){throw"Abstract"},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var r=this;try{var i=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(e.messages),onSuccess:function(i){r._debug("Transport",r.getType(),"received response",i);var s=!1;try{var o=r.convertToMessages(i);o.length===0?(n=!1,r.transportFailure(e,t,"no response",null)):(s=!0,r.transportSuccess(e,t,o))}catch(u){r._debug(u),s||(n=!1,r.transportFailure(e,t,"bad response",u))}},onError:function(s,o){n=!1,i?r.setTimeout(function(){r.transportFailure(e,t,s,o)},0):r.transportFailure(e,t,s,o)}}),i=!1}catch(s){n=!1,this.setTimeout(function(){r.transportFailure(e,t,"error",s)},0)}},t.reset=function(){e.reset(),n=!0},t},org.cometd.CallbackPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e),n=2e3;return t.accept=function(e,t,n){return!0},t.jsonpSend=function(e){throw"Abstract"},t.transportSend=function(e,t){var r=this,i=0,s=e.messages.length,o=[];while(s>0){var u=org.cometd.JSON.toJSON(e.messages.slice(i,i+s)),a=e.url.length+encodeURI(u).length;if(a>n){if(s===1){var f="Bayeux message too big ("+a+" bytes, max is "+n+") "+"for transport "+this.getType();this.setTimeout(function(){r.transportFailure(e,t,"error",f)},0);return}--s;continue}o.push(s),i+=s,s=e.messages.length-i}var l=e;if(o.length>1){var c=0,h=o[0];this._debug("Transport",this.getType(),"split",e.messages.length,"messages into",o.join(" + ")),l=this._mixin(!1,{},e),l.messages=e.messages.slice(c,h),l.onSuccess=e.onSuccess,l.onFailure=e.onFailure;for(var p=1;p<o.length;++p){var d=this._mixin(!1,{},e);c=h,h+=o[p],d.messages=e.messages.slice(c,h),d.onSuccess=e.onSuccess,d.onFailure=e.onFailure,this.send(d,t.metaConnect)}}this._debug("Transport",this.getType(),"sending request",t.id,"envelope",l);try{var v=!0;this.jsonpSend({transport:this,url:l.url,sync:l.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(l.messages),onSuccess:function(e){var n=!1;try{var i=r.convertToMessages(e);i.length===0?r.transportFailure(l,t,"no response"):(n=!0,r.transportSuccess(l,t,i))}catch(s){r._debug(s),n||r.transportFailure(l,t,"bad response",s)}},onError:function(e,n){v?r.setTimeout(function(){r.transportFailure(l,t,e,n)},0):r.transportFailure(l,t,e,n)}}),v=!1}catch(m){this.setTimeout(function(){r.transportFailure(l,t,"error",m)},0)}},t},org.cometd.WebSocketTransport=function(){function c(){var e=n.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",e);var t=this,r=null,i=n.getConfiguration().connectTimeout;i>0&&(r=this.setTimeout(function(){r=null,a||(t._debug("Transport",t.getType(),"timed out while connecting to URL",e,":",i,"ms"),t.onClose(1002,"Connect Timeout"))},i));var s=new org.cometd.WebSocket(e);s.onopen=function(){t._debug("WebSocket opened",s),r&&(t.clearTimeout(r),r=null);if(s!==u){t._debug("Ignoring open event, WebSocket",u);return}t.onOpen()},s.onclose=function(e){var n=e?e.code:1e3,i=e?e.reason:undefined;t._debug("WebSocket closed",n,"/",i,s),r&&(t.clearTimeout(r),r=null);if(s!==u){t._debug("Ignoring close event, WebSocket",u);return}t.onClose(n,i)},s.onerror=function(){s.onclose({code:1002})},s.onmessage=function(e){t._debug("WebSocket message",e,s);if(s!==u){t._debug("Ignoring message event, WebSocket",u);return}t.onMessage(e)},u=s,this._debug("Transport",this.getType(),"configured callbacks on",s)}function h(e,t){var n=org.cometd.JSON.toJSON(e.messages);u.send(n),this._debug("Transport",this.getType(),"sent",e,"metaConnect =",t);var r=this.getConfiguration().maxNetworkDelay,i=r;t&&(i+=this.getAdvice().timeout,f=!0);var s=[];for(var a=0;a<e.messages.length;++a){var l=e.messages[a];if(l.id){s.push(l.id);var c=this;o[l.id]=this.setTimeout(function(){u&&u.close(1e3,"Timeout")},i)}}this._debug("Transport",this.getType(),"waiting at most",i,"ms for messages",s,"maxNetworkDelay",r,", timeouts:",o)}function p(e,t){try{u===null?c.call(this):a&&h.call(this,e,t)}catch(n){this.setTimeout(function(){e.onFailure(u,e.messages,"error",n)},0)}}var e=new org.cometd.Transport,t=org.cometd.Transport.derive(e),n,r=!0,i=!1,s={},o={},u=null,a=!1,f=!1,l;return t.onOpen=function(){this._debug("Transport",this.getType(),"opened",u),a=!0,i=!0,this._debug("Sending pending messages",s);for(var e in s){var t=s[e],n=t[0],r=t[1];l=n.onSuccess,h.call(this,n,r)}},t.onMessage=function(e){this._debug("Transport",this.getType(),"received websocket message",e,u);var t=!1,n=this.convertToMessages(e.data),r=[];for(var i=0;i<n.length;++i){var a=n[i];if(/^\/meta\//.test(a.channel)||a.data===undefined)if(a.id){r.push(a.id);var c=o[a.id];c&&(this.clearTimeout(c),delete o[a.id],this._debug("Transport",this.getType(),"removed timeout for message",a.id,", timeouts",o))}"/meta/connect"===a.channel&&(f=!1),"/meta/disconnect"===a.channel&&!f&&(t=!0)}var h=!1;for(var p=0;p<r.length;++p){var d=r[p];for(var v in s){var m=v.split(","),g=org.cometd.Utils.inArray(d,m);if(g>=0){h=!0,m.splice(g,1);var y=s[v][0],b=s[v][1];delete s[v],m.length>0&&(s[m.join(",")]=[y,b]);break}}}h&&this._debug("Transport",this.getType(),"removed envelope, envelopes",s),l.call(this,n),t&&u.close(1e3,"Disconnect")},t.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t,u),r=i;for(var n in o)this.clearTimeout(o[n]);o={};for(var l in s){var c=s[l][0],h=s[l][1];h&&(f=!1),c.onFailure(u,c.messages,"closed "+e+"/"+t)}s={},u!==null&&a&&u.close(1e3,"Close"),a=!1,u=null},t.registered=function(t,r){e.registered(t,r),n=r},t.accept=function(e,t,i){return r&&!!org.cometd.WebSocket&&n.websocketEnabled!==!1},t.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"metaConnect =",t);var n=[];for(var r=0;r<e.messages.length;++r){var i=e.messages[r];i.id&&n.push(i.id)}s[n.join(",")]=[e,t],this._debug("Transport",this.getType(),"stored envelope, envelopes",s),p.call(this,e,t)},t.reset=function(){e.reset(),u!==null&&a&&u.close(1e3,"Reset"),r=!0,i=!1,o={},s={},u=null,a=!1,l=null},t},org.cometd.Cometd=function(e){function E(e){return org.cometd.Utils.isString(e)}function S(e){return e===undefined||e===null?!1:typeof e=="function"}function x(e,t){if(window.console){var n=window.console[e];S(n)&&n.apply(window.console,t)}}function T(e){t._debug("Configuring cometd object with",e),E(e)&&(e={url:e}),e||(e={}),w=t._mixin(!1,w,e);if(!w.url)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var n=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(w.url),i=n[2],s=n[8],o=n[9];r=t._isCrossDomain(i);if(w.appendMessageTypeToURL)if(o!==undefined&&o.length>0)t._info("Appending message type to URI "+s+o+" is not supported, disabling 'appendMessageTypeToURL' configuration"),w.appendMessageTypeToURL=!1;else{var u=s.split("/"),a=u.length-1;s.match(/\/$/)&&(a-=1),u[a].indexOf(".")>=0&&(t._info("Appending message type to URI "+s+" is not supported, disabling 'appendMessageTypeToURL' configuration"),w.appendMessageTypeToURL=!1)}}function N(){for(var e in h){var n=h[e];for(var r=0;r<n.length;++r){var i=n[r];i&&!i.listener&&(delete n[r],t._debug("Removed subscription",i,"for channel",e))}}}function C(e){o!==e&&(t._debug("Status",o,"->",e),o=e)}function k(){return o==="disconnecting"||o==="disconnected"}function L(){return++u}function A(e,n,r,i,s){try{return n.call(e,i)}catch(o){t._debug("Exception during execution of extension",r,o);var u=t.onExtensionException;if(S(u)){t._debug("Invoking extension exception callback",r,o);try{u.call(t,o,r,s,i)}catch(a){t._info("Exception during execution of exception callback in extension",r,a)}}return i}}function O(e){for(var t=0;t<v.length;++t){if(e===undefined||e===null)break;var n=w.reverseIncomingExtensions?v.length-1-t:t,r=v[n],i=r.extension.incoming;if(S(i)){var s=A(r.extension,i,r.name,e,!1);e=s===undefined?e:s}}return e}function M(e){for(var t=0;t<v.length;++t){if(e===undefined||e===null)break;var n=v[t],r=n.extension.outgoing;if(S(r)){var i=A(n.extension,r,n.name,e,!0);e=i===undefined?e:i}}return e}function _(e,n){var r=h[e];if(r&&r.length>0)for(var i=0;i<r.length;++i){var s=r[i];if(s)try{s.callback.call(s.scope,n)}catch(o){t._debug("Exception during notification",s,n,o);var u=t.onListenerException;if(S(u)){t._debug("Invoking listener exception callback",s,o);try{u.call(t,o,s.handle,s.listener,n)}catch(a){t._info("Exception during execution of listener callback",s,a)}}}}}function D(e,t){_(e,t);var n=e.split("/"),r=n.length-1;for(var i=r;i>0;--i){var s=n.slice(0,i).join("/")+"/*";i===r&&_(s,t),s+="*",_(s,t)}}function P(){d!==null&&org.cometd.Utils.clearTimeout(d),d=null}function H(e){P();var n=m.interval+p;t._debug("Function scheduled in",n,"ms, interval =",m.interval,"backoff =",p,e),d=org.cometd.Utils.setTimeout(t,e,n)}function F(e,n,r,i){for(var o=0;o<n.length;++o){var u=n[o];u.id=""+L(),a&&(u.clientId=a),u=M(u),u!==undefined&&u!==null?n[o]=u:n.splice(o--,1)}if(n.length===0)return;var f=w.url;w.appendMessageTypeToURL&&(f.match(/\/$/)||(f+="/"),i&&(f+=i));var l={url:f,sync:e,messages:n,onSuccess:function(e){try{B.call(t,e)}catch(n){t._debug("Exception during handling of messages",n)}},onFailure:function(e,n,r,i){try{j.call(t,e,n,r,i)}catch(s){t._debug("Exception during handling of failure",s)}}};t._debug("Send",l),s.send(l,r)}function I(e){f>0||c===!0?l.push(e):F(!1,[e],!1)}function q(){p=0}function R(){p<w.maxBackoff&&(p+=w.backoffIncrement)}function U(){++f}function z(){var e=l;l=[],e.length>0&&F(!1,e,!1)}function W(){--f;if(f<0)throw"Calls to startBatch() and endBatch() are not paired";f===0&&!k()&&!c&&z()}function X(){if(!k()){var e={channel:"/meta/connect",connectionType:s.getType()};b||(e.advice={timeout:0}),C("connecting"),t._debug("Connect sent",e),F(!1,[e],!0,"connect"),C("connected")}}function V(){C("connecting"),H(function(){X()})}function $(e){e&&(m=t._mixin(!1,{},w.advice,e),t._debug("New advice",m))}function J(e){P(),e&&s.abort(),a=null,C("disconnected"),f=0,q(),l.length>0&&(j.call(t,undefined,l,"error","Disconnected"),l=[])}function K(e){a=null,N(),k()?(i.reset(),$(w.advice)):$(t._mixin(!1,m,{reconnect:"retry"})),f=0,c=!0,g=e;var n="1.0",o=i.findTransportTypes(n,r,w.url),u={version:n,minimumVersion:"0.9",channel:"/meta/handshake",supportedConnectionTypes:o,advice:{timeout:m.timeout,interval:m.interval}},l=t._mixin(!1,{},g,u);s=i.negotiateTransport(o,n,r,w.url),t._debug("Initial transport is",s.getType()),C("handshaking"),t._debug("Handshake sent",l),F(!1,[l],!1,"handshake")}function Q(){C("handshaking"),c=!0,H(function(){K(g)})}function G(e){D("/meta/handshake",e),D("/meta/unsuccessful",e);var t=!k()&&m.reconnect!=="none";t?(R(),Q()):J(!1)}function Y(e){if(e.successful){a=e.clientId;var n=i.negotiateTransport(e.supportedConnectionTypes,e.version,r,w.url);if(n===null)throw"Could not negotiate transport with server; client "+i.findTransportTypes(e.version,r,w.url)+", server "+e.supportedConnectionTypes;s!==n&&(t._debug("Transport",s,"->",n),s=n),c=!1,z(),e.reestablish=y,y=!0,D("/meta/handshake",e);var o=k()?"none":m.reconnect;switch(o){case"retry":q(),V();break;case"none":J(!1);break;default:throw"Unrecognized advice action "+o}}else G(e)}function Z(e,t){G({successful:!1,failure:!0,channel:"/meta/handshake",request:t,xhr:e,advice:{reconnect:"retry",interval:p}})}function et(e){D("/meta/connect",e),D("/meta/unsuccessful",e);var t=k()?"none":m.reconnect;switch(t){case"retry":V(),R();break;case"handshake":i.reset(),q(),Q();break;case"none":J(!1);break;default:throw"Unrecognized advice action"+t}}function tt(e){b=e.successful;if(b){D("/meta/connect",e);var t=k()?"none":m.reconnect;switch(t){case"retry":q(),V();break;case"none":J(!1);break;default:throw"Unrecognized advice action "+t}}else et(e)}function nt(e,t){b=!1,et({successful:!1,failure:!0,channel:"/meta/connect",request:t,xhr:e,advice:{reconnect:"retry",interval:p}})}function rt(e){J(!0),D("/meta/disconnect",e),D("/meta/unsuccessful",e)}function it(e){e.successful?(J(!1),D("/meta/disconnect",e)):rt(e)}function st(e,t){rt({successful:!1,failure:!0,channel:"/meta/disconnect",request:t,xhr:e,advice:{reconnect:"none",interval:0}})}function ot(e){D("/meta/subscribe",e),D("/meta/unsuccessful",e)}function ut(e){e.successful?D("/meta/subscribe",e):ot(e)}function at(e,t){ot({successful:!1,failure:!0,channel:"/meta/subscribe",request:t,xhr:e,advice:{reconnect:"none",interval:0}})}function ft(e){D("/meta/unsubscribe",e),D("/meta/unsuccessful",e)}function lt(e){e.successful?D("/meta/unsubscribe",e):ft(e)}function ct(e,t){ft({successful:!1,failure:!0,channel:"/meta/unsubscribe",request:t,xhr:e,advice:{reconnect:"none",interval:0}})}function ht(e){D("/meta/publish",e),D("/meta/unsuccessful",e)}function pt(e){e.successful===undefined?e.data?D(e.channel,e):t._debug("Unknown message",e):e.successful?D("/meta/publish",e):ht(e)}function dt(e,t){ht({successful:!1,failure:!0,channel:t.channel,request:t,xhr:e,advice:{reconnect:"none",interval:0}})}function vt(e){e=O(e);if(e===undefined||e===null)return;$(e.advice);var t=e.channel;switch(t){case"/meta/handshake":Y(e);break;case"/meta/connect":tt(e);break;case"/meta/disconnect":it(e);break;case"/meta/subscribe":ut(e);break;case"/meta/unsubscribe":lt(e);break;default:pt(e)}}function mt(e){var t=h[e];if(t)for(var n=0;n<t.length;++n)if(t[n])return!0;return!1}function gt(e,t){var n={scope:e,method:t};if(S(e))n.scope=undefined,n.method=e;else if(E(t)){if(!e)throw"Invalid scope "+e;n.method=e[t];if(!S(n.method))throw"Invalid callback "+t+" for scope "+e}else if(!S(t))throw"Invalid callback "+t;return n}function yt(e,n,r,i){var s=gt(n,r);t._debug("Adding listener on",e,"with scope",s.scope,"and callback",s.method);var o={channel:e,scope:s.scope,callback:s.method,listener:i},u=h[e];u||(u=[],h[e]=u);var a=u.push(o)-1;return o.id=a,o.handle=[e,a],t._debug("Added listener",o,"for channel",e,"having id =",a),o.handle}function bt(e){var n=h[e[0]];n&&(delete n[e[1]],t._debug("Removed listener",e))}var t=this,n=e||"default",r=!1,i=new org.cometd.TransportRegistry,s,o="disconnected",u=0,a=null,f=0,l=[],c=!1,h={},p=0,d=null,v=[],m={},g,y=!1,b=!1,w={connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(e,t,n){var r=t||{};for(var i=2;i<arguments.length;++i){var s=arguments[i];if(s===undefined||s===null)continue;for(var o in s){var u=s[o],a=r[o];if(u===t)continue;if(u===undefined)continue;if(e&&typeof u=="object"&&u!==null)if(u instanceof Array)r[o]=this._mixin(e,a instanceof Array?a:[],u);else{var f=typeof a!="object"||a instanceof Array?{}:a;r[o]=this._mixin(e,f,u)}else r[o]=u}}return r},this._warn=function(){x("warn",arguments)},this._info=function(){w.logLevel!=="warn"&&x("info",arguments)},this._debug=function(){w.logLevel==="debug"&&x("debug",arguments)},this._isCrossDomain=function(e){return e&&e!==window.location.host};var B,j;this.send=I,this.receive=vt,B=function(e){t._debug("Received",e);for(var n=0;n<e.length;++n){var r=e[n];vt(r)}},j=function(e,n,r,i){t._debug("handleFailure",e,n,r,i);for(var s=0;s<n.length;++s){var o=n[s],u=o.channel;switch(u){case"/meta/handshake":Z(e,o);break;case"/meta/connect":nt(e,o);break;case"/meta/disconnect":st(e,o);break;case"/meta/subscribe":at(e,o);break;case"/meta/unsubscribe":ct(e,o);break;default:dt(e,o)}}},this.registerTransport=function(e,t,n){var r=i.add(e,t,n);return r&&(this._debug("Registered transport",e),S(t.registered)&&t.registered(e,this)),r},this.getTransportTypes=function(){return i.getTransportTypes()},this.unregisterTransport=function(e){var t=i.remove(e);return t!==null&&(this._debug("Unregistered transport",e),S(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){i.clear()},this.findTransport=function(e){return i.find(e)},this.configure=function(e){T.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e){C("disconnected"),y=!1,K(e)},this.disconnect=function(e,t){if(k())return;t===undefined&&typeof e!="boolean"&&(t=e,e=!1);var n={channel:"/meta/disconnect"},r=this._mixin(!1,{},t,n);C("disconnecting"),F(e===!0,[r],!1,"disconnect")},this.startBatch=function(){U()},this.endBatch=function(){W()},this.batch=function(e,t){var n=gt(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(r){throw this._debug("Exception during execution of batch",r),this.endBatch(),r}},this.addListener=function(e,t,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!E(e))throw"Illegal argument type: channel must be a string";return yt(e,t,n,!0)},this.removeListener=function(e){if(!org.cometd.Utils.isArray(e))throw"Invalid argument: expected subscription, not "+e;bt(e)},this.clearListeners=function(){h={}},this.subscribe=function(e,t,n,r){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!E(e))throw"Illegal argument type: channel must be a string";if(k())throw"Illegal state: already disconnected";S(t)&&(r=n,n=t,t=undefined);var i=!mt(e),s=yt(e,t,n,!1);if(i){var o={channel:"/meta/subscribe",subscription:e},u=this._mixin(!1,{},r,o);I(u)}return s},this.unsubscribe=function(e,t){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(k())throw"Illegal state: already disconnected";this.removeListener(e);var n=e[0];if(!mt(n)){var r={channel:"/meta/unsubscribe",subscription:n},i=this._mixin(!1,{},t,r);I(i)}},this.clearSubscriptions=function(){N()},this.publish=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!E(e))throw"Illegal argument type: channel must be a string";if(k())throw"Illegal state: already disconnected";var r={channel:e,data:t},i=this._mixin(!1,{},n,r);I(i)},this.getStatus=function(){return o},this.isDisconnected=k,this.setBackoffIncrement=function(e){w.backoffIncrement=e},this.getBackoffIncrement=function(){return w.backoffIncrement},this.getBackoffPeriod=function(){return p},this.setLogLevel=function(e){w.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!E(e))throw"Illegal argument type: extension name must be a string";var n=!1;for(var r=0;r<v.length;++r){var i=v[r];if(i.name===e){n=!0;break}}return n?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(v.push({name:e,extension:t}),this._debug("Registered extension",e),S(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!E(e))throw"Illegal argument type: extension name must be a string";var t=!1;for(var n=0;n<v.length;++n){var r=v[n];if(r.name===e){v.splice(n,1),t=!0,this._debug("Unregistered extension",e);var i=r.extension;S(i.unregistered)&&i.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<v.length;++t){var n=v[t];if(n.name===e)return n.extension}return null},this.getName=function(){return n},this.getClientId=function(){return a},this.getURL=function(){return w.url},this.getTransport=function(){return s},this.getConfiguration=function(){return this._mixin(!0,{},w)},this.getAdvice=function(){return this._mixin(!0,{},m)},org.cometd.WebSocket=window.WebSocket,org.cometd.WebSocket||(org.cometd.WebSocket=window.MozWebSocket)},function(e){function t(e,t){if(t)for(var n in t){if(n.toLowerCase()==="content-type")continue;e.setRequestHeader(n,t[n])}}function n(){var n=new org.cometd.LongPollingTransport,r=org.cometd.Transport.derive(n);return r.xhrSend=function(n){return e.ajax({url:n.url,async:n.sync!==!0,type:"POST",contentType:"application/json;charset=UTF-8",data:n.body,xhrFields:{withCredentials:!0},beforeSend:function(e){return t(e,n.headers),!0},success:n.onSuccess,error:function(e,t,r){n.onError(t,r)}})},r}function r(){var n=new org.cometd.CallbackPollingTransport,r=org.cometd.Transport.derive(n);return r.jsonpSend=function(n){e.ajax({url:n.url,async:n.sync!==!0,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:n.body},beforeSend:function(e){return t(e,n.headers),!0},success:n.onSuccess,error:function(e,t,r){n.onError(t,r)}})},r}org.cometd.JSON.toJSON=JSON.stringify,org.cometd.JSON.fromJSON=JSON.parse,e.Cometd=function(e){var t=new org.cometd.Cometd(e);return org.cometd.WebSocket&&t.registerTransport("websocket",new org.cometd.WebSocketTransport),t.registerTransport("long-polling",new n),t.registerTransport("callback-polling",new r),t},e.cometd=new e.Cometd}(jQuery),typeof dojo!="undefined"&&dojo.provide("org.cometd.ReloadExtension"),org.cometd.COOKIE||(org.cometd.COOKIE={},org.cometd.COOKIE.set=function(e,t,n){throw"Abstract"},org.cometd.COOKIE.get=function(e){throw"Abstract"}),org.cometd.ReloadExtension=function(e){function a(e){if(r&&r.handshakeResponse!==null){l(e),r.cookiePath=s;var t=org.cometd.JSON.toJSON(r);n("Reload extension saving cookie value",t),org.cometd.COOKIE.set(i,t,{"max-age":o,path:s,expires:new Date((new Date).getTime()+o*1e3)})}}function f(e){return r.url==e.url}function l(e){e&&(typeof e.cookieMaxAge=="number"&&(o=e.cookieMaxAge),typeof e.cookieName=="string"&&(i=e.cookieName),typeof e.cookiePath=="string"&&(s=e.cookiePath))}var t,n,r=null,i="org.cometd.reload",s="/",o=5,u=!1;this.configure=l,this.registered=function(e,r){t=r,t.reload=a,n=t._debug},this.unregistered=function(){delete t.reload,t=null},this.outgoing=function(e){var s=e.channel;if(s=="/meta/handshake"){r={},r.url=t.getURL();var o=org.cometd.COOKIE.get(i);n("Reload extension found cookie value",o);if(o)try{var a=org.cometd.JSON.fromJSON(o);org.cometd.COOKIE.set(i,"",{"max-age":-1,path:a.cookiePath,expires:-1});if(a.handshakeResponse&&f(a))return n("Reload extension restoring state",a),setTimeout(function(){n("Reload extension replaying handshake response",a.handshakeResponse),r.handshakeResponse=a.handshakeResponse,r.transportType=a.transportType,r.reloading=!0;var e=t._mixin(!0,{},r.handshakeResponse,{ext:{reload:!0}});e.supportedConnectionTypes=[r.transportType],t.receive(e),n("Reload extension replayed handshake response",e)},0),u||(u=!0,t.startBatch()),null;n("Reload extension could not restore state",a)}catch(l){n("Reload extension error while trying to restore cookie",l)}}else s=="/meta/connect"&&(r.transportType||(r.transportType=e.connectionType,n("Reload extension tracked transport type",r.transportType)));return e},this.incoming=function(e){if(e.successful)switch(e.channel){case"/meta/handshake":r.handshakeResponse||(r.handshakeResponse=e,n("Reload extension tracked handshake response",e));break;case"/meta/disconnect":r=null;break;case"/meta/connect":u&&(t.endBatch(),u=!1);break;default:}return e},l(e)},function(e){"use strict";var t=window.hasOwnProperty("sessionStorage")&&window.sessionStorage!==null,n=function(e,n,r){n===null&&(r.expires=-1,r["max-age"]=-1);var i=new Date,s=r.expires,o,u=r["max-age"];i.setDate(i.getDate()+s),t?u!==-1?window.sessionStorage[e]=window.escape(n):window.sessionStorage.removeItem(e):(o=window.escape(n)+(i===null?"":"; expires="+i.toUTCString())+"; path="+r.path,window.document.cookie=e+"="+o)},r=function(e){var n,r,i,s,o=window.document.cookie.split(";");if(t){i=window.sessionStorage[e];if(i!==undefined)return window.unescape(i)}else for(n=0,s=o.length;n<s;n++){r=o[n].substr(0,o[n].indexOf("=")),i=o[n].substr(o[n].indexOf("=")+1),r=r.replace(/^\s+|\s+$/g,"");if(r===e)return window.unescape(i)}return null};org.cometd.COOKIE.set=n,org.cometd.COOKIE.get=r,e.cometd.registerExtension("reload",new org.cometd.ReloadExtension)}(jQuery),function(){"use strict";var e=$.cometd,t=!1,n=!1,r=null,i=null,s=null,o="/resources/",u=[],a={},f=window.document.location.protocol+"//"+window.document.location.host+"/sld/notification",l=[],c=org.cometd.COOKIE?org.cometd.COOKIE.get("org.cometd.reload"):null,h=function(n){if(e.isDisconnected()){t=!1,r!==null&&r.apply(null,[]);return}var o=t;t=n.successful===!0,!o&&t&&i!==null?i.apply(null,[]):o&&!t&&s!==null&&s.apply(null,[])},p=function(e,t){var n=u.filter(function(n){return n[0]===o+e&&n[2]===t});return n.length>0?n[0]:null},d=function(e,t){var n=p(e,t),r=l.filter(function(n){return n.sEntity===e&&n.fCallback===t}),i=!1;if(n!==null||r.length>0)i=!0;return i},v=function(t,r){if(typeof r!="function"||typeof t!="string")throw"subscribe's parameters type error";if(d(t,r))return;var i={sEntity:t,fCallback:r},s;n?(s=t.indexOf(o)===0?t:o+t,i=e.subscribe(s,r),i[2]=r,u.push(i)):l.push(i)},m=function(){if(u.length>0){var e=u,t=0,n=0,r;u=[];for(n=e.length;t<n;t++)r=e[t],v(r[0],r[2])}},g=function(t){n=t.successful===!0;if(n){e.clearSubscriptions(),m();while(l.length>0){var r=l.shift();v(r.sEntity,r.fCallback)}}},y=function(){e.handshake()},b=function(){e.disconnect(!0),t=n=!1,u=[],l=[],a={}},w=function(r){var i=0;$(document).click(function(){i=0}),$(document).mousemove(function(){i=0}),$(document).keypress(function(){i=0}),c3.service.getSystemInformations().filter("Name eq 'ClientSession_Timeout'").query(function(e){function r(){i+=30,i>=t&&(b(),clearInterval(n),c3.service.getCurrentOperator().query({success:function(){s()},error:function(){}}))}function s(){c3.service.logout().query(function(){window.appmgr=null,window.inframgr=null,window.accmgr=null,window.supportability=null,$("body").empty(),cometdManager.disconnect(),document.location.reload();var e=new c3init;e.init(),sessionStorage&&(sessionStorage.selectedIndex=c3config.DefaultSelectedPageIndex)})}var t=1200;e.data&&e.data.length>0&&(t=parseInt(e.data[0].Value)*60,isNaN(t)&&(time=1200));var n=window.setInterval(r,3e4)}),t=n=!1;if(r===undefined||r===null)r={};r.url===undefined&&(r.url=f),e.init(r)},E=function(){e.unregisterTransport("websocket"),e.addListener("/meta/connect",h),e.addListener("/meta/handshake",g),$(window).unload(function(){e.reload?e.reload():b()})},S=function(e){if(typeof e!="function")throw"setConnectionClosedHandler error: fCallback must be a function";r=e},x=function(e){if(typeof e!="function")throw"setConnectionEstablishedHandler error: fCallback must be a function";i=e},T=function(e){if(typeof e!="function")throw"setConnectionBrokenHandler error: fCallback must be a function";s=e},N=function(t,n){var r=p(t,n);e.unsubscribe(r),u=u.filter(function(e){return e!==r})},C=function(){return u},k=function(e){return u.filter(function(t){return t[0]===o+e})},L=function(e){var t=e.data.data,n={},r=null,i=t.length,s=0;for(;s<i;s++)r=t[s],n[r.propertyName]=r.propertyNewValue;return n},A=function(){return t},O=function(){return n},M=function(){return e},_=function(e,t){a[e]=t},D=function(e){delete a[e]},P=function(){return a},H=function(e){return a[e]},B=function(){var t;this.registered=function(e,n){t=n},this.outgoing=function(t){if(t.channel==="/meta/subscribe"){var n=t.subscription,r=n.substring(o.length,n.length),i=H(r);i&&(t.subscription=n+"?"+i,e._debug("add filter:"),e._debug(t))}}},j=function(){if(c){var e=JSON.parse(c);w({url:e.url})}},F={init:w,subscribe:v,setConnectionClosedHandler:S,setConnectionBrokenHandler:T,setConnectionEstablishedHandler:x,unSubscribe:N,getSubscribeList:C,getSubscribeListByName:k,disconnect:b,getMessageNewValue:L,getConnectedStatus:A,getHandShakeStatus:O,getCometd:M,setChannelFilter:_,removeChannelFilter:D,getChannelFilterValue:H};E(),e.registerExtension("filterExt",new B),j(),window.cometdManager=F}();var psValidator=function(e,t,n){"use strict";function i(t){var r=e.PSSessions;if(t>=r.length){var s=[];for(var o=0;o<r.length;o++)r[o].Sessions&&r[o].Sessions.length>0&&s.push(r[o]);if(s.length>0){var u=new c3retrieveAllSBOClientSessions(e,s);u.show()}else n();e.lw&&e.lw.close()}else r[t].SBOClientID>0?c3.service.retrieveSBOClientSessions(r[t].SBOClientID,function(e){if(e.d&&e.d.results&&e.d.results.length>0){r[t].Sessions=[];for(var n=0;n<e.d.results.length;n++)r[t].Sessions.push({Status:e.d.results[n].Status,Name:e.d.results[n].Name,Username:e.d.results[n].Username,PSName:""})}i(t+1)}):i(t+1)}var r=function(e){var t=new textbox({isRequired:!0,pattern:"([0-9a-zA-Z-_.]){1,}"}),n=new textbox({isRequired:!0,type:"password"}),r={getActionButtonText:function(){return localizedString("MISC_OK")},validator:{checkValidity:function(){return t.checkValidity()&&n.checkValidity()}}};c3.dialog.call(this,r),this.getId=function(){return"credentialDialog"},this.getTitle=function(){return localizedString("MISC_CONFIRM")},this.getWidth=function(){return 400},this.getHeight=function(){return 220},this.content=$("<div>");var i=this;this.onInit=function(){var e=$("<div>");e.css({margin:"0 5px 15px 5px"}),e.html(localizedString("REGPS_CONFIRM_MSG_SERVICEACCOUNT")),i.content.append(e),i.content.append(Utility.CreateRow(localizedString("MISC_USERNAME"),t.attr({width:"80px"}))),i.content.append(Utility.CreateRow(localizedString("MISC_PASSWORD"),n.attr({width:"80px"}))),i.content.append($("<div>").css({"padding-left":"37%","padding-top":"5px"}))},this.finish=function(){var r=t.val(),s=n.val(),o={success:function(){e({username:r,password:s}),i.close()}};suManager.validateClientAgentServiceAccount({userName:r,password:s},o)}};this.checkValidity=function(){var s=e.PSSessions,o=s.length;if(o>0&&t.Version>="882.075.11")for(var u=0;u<o;u++)if(s[u].SBOVersion!=t.Version){var a=function(n){e.lw||(e.lw=new loadingWindow),e.lw.show(),t.ClientAgentServiceAccount={UserName:n.username,Password:n.password};for(var r=0;r<s.length;r++)s[r].Sessions=[];i(0)},f=new r(a);f.show();return}n()}},c3huwizard=function(){"use strict";var e=function(t){function O(e){h.SWrepositoryCountLabel.empty(),e.data==0?h.SWrepositoryCountLabel.append(e.data).attr({"class":"alert_text"}):h.SWrepositoryCountLabel.append(e.data).attr({"class":"icon_title"})}function M(e){h.mailerCountLabel.empty(),e.data==0?h.mailerCountLabel.append(e.data).attr({"class":"alert_text"}):h.mailerCountLabel.append(e.data).attr({"class":"icon_title"})}function _(e){h.DBinstanceCountLabel.empty(),e.data==0?h.DBinstanceCountLabel.append(e.data).attr({"class":"alert_text"}):h.DBinstanceCountLabel.append(e.data).attr({"class":"icon_title"})}function D(e){h.presentationserverCountLabel.empty(),e.data==0?h.presentationserverCountLabel.append(e.data).attr({"class":"alert_text"}):h.presentationserverCountLabel.append(e.data).attr({"class":"icon_title"})}function P(e){h.licenseserverCountLabel.empty(),e.data==0?h.licenseserverCountLabel.append(e.data).attr({"class":"alert_text"}):h.licenseserverCountLabel.append(e.data).attr({"class":"icon_title"})}function H(e){h.commonDBCountLabel.empty(),e.data==0?h.commonDBCountLabel.append(e.data).attr({"class":"alert_text"}):h.commonDBCountLabel.append(e.data).attr({"class":"icon_title"})}function B(e){h.AnalyticsService.empty(),e.data==0?h.AnalyticsService.append(e.data).attr({"class":"alert_text"}):h.AnalyticsService.append(e.data).attr({"class":"icon_title"})}function j(e){h.XAppService.empty(),e.data==0?h.XAppService.append(e.data).attr({"class":"alert_text"}):h.XAppService.append(e.data).attr({"class":"icon_title"})}function F(e){h.B1iCountLabel.empty(),e.data==0?h.B1iCountLabel.append(e.data).attr({"class":"alert_text"}):h.B1iCountLabel.append(e.data).attr({"class":"icon_title"})}function I(e){h.SharedFolderCountLabel.empty(),e.data==0?h.SharedFolderCountLabel.append(e.data).attr({"class":"alert_text"}):h.SharedFolderCountLabel.append(e.data).attr({"class":"icon_title"})}function q(e){h.TenantsStorageCountLabel.empty(),e.data==0?h.TenantsStorageCountLabel.append(e.data).attr({"class":"alert_text"}):h.TenantsStorageCountLabel.append(e.data).attr({"class":"icon_title"})}function R(e){h.ImplRepositoryCountLabel.empty(),e.data==0?h.ImplRepositoryCountLabel.append(e.data).attr({"class":"alert_text"}):h.ImplRepositoryCountLabel.append(e.data).attr({"class":"icon_title"})}function U(e){h.CpyTempRepositoryCountLabel.empty(),e.data==0?h.CpyTempRepositoryCountLabel.append(e.data).attr({"class":"alert_text"}):h.CpyTempRepositoryCountLabel.append(e.data).attr({"class":"icon_title"})}function z(e){h.BAServiceLabel.empty(),e.data==0?h.BAServiceLabel.append(e.data).attr({"class":"alert_text"}):h.BAServiceLabel.append(e.data).attr({"class":"icon_title"})}function W(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_DBInstance(e)}),t=$("<section>").addClass("icon_DBInstance"),n=$("<section>").append(localizedString("RES_MS_SQL_LF")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.DBinstanceCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function X(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_SBOCOMMON(e)}),t=$("<section>").addClass("icon_SBOCOMMON"),n=$("<section>").append(localizedString("RES_SBO_COMMON_LF")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.commonDBCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function V(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_B1a(e)}),t=$("<section>").addClass("icon_ANALITICS"),n=$("<section>").append(localizedString("RES_B1AH_SERVER")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.AnalyticsService).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function J(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_B1a(e)}),t=$("<section>").addClass("icon_ANALITICS"),n=$("<section>").append(localizedString("RES_XAPP_SERVICE")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.XAppService).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function K(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_SWRepository(e)}),t=$("<section>").addClass("icon_SWRepository"),n=$("<section>").append(localizedString("SOFTWAREREPO_LF")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.SWrepositoryCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function Q(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_LicenseServer(e)}),t=$("<section>").addClass("icon_LicenseServer"),n=$("<section>").append(localizedString("RES_LIC_SERVER_LF")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.licenseserverCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function G(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_PresentationServer(e)}),t=$("<section>").addClass("icon_PresentationServer"),n=$("<section>").append(localizedString("RES_PRESENTATION_SERVER_LF")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.presentationserverCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function Y(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_BAServer(e)}),t=$("<section>").addClass("icon_ANALITICS"),n=$("<section>").append(localizedString("RESPOOL_B1BROWSERACCESSSERVER_TLT")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.BAServiceLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function Z(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_B1i(e)}),t=$("<section>").addClass("icon_B1i"),n=$("<section>").append(localizedString("RES_B1I_SERVER_LF")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.B1iCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function et(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_Mailer(e)}),t=$("<section>").addClass("icon_Mailer"),n=$("<section>").append(localizedString("RES_MAILER_SERVICE")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.mailerCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function tt(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_SharedFolder(e)}),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append(localizedString("RES_SHARED_FOLDER_OPTION")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.SharedFolderCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function nt(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_TenantsStorage(e)}),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append(localizedString("RES_TENANTS_STORAGE_LF")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.TenantsStorageCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function rt(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_ImplRepository(e)}),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append(localizedString("RES_SHARED_IMPL_REPOSITORY_LF")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.ImplRepositoryCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function it(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_CompanyTemplateRepository(e)}),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append(localizedString("RES_COMPANY_TEMPLATE_REPOSITORY_LF")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(h.CpyTempRepositoryCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}this.base=c3.wizard;var n=function(){t&&t.reload()};this.base(n),this.getHeight=function(){return 520};var r=localizedString("WIZARD_HU_CRT"),i=localizedString("WIZARD_HU_WEL_TITLE"),s=localizedString("WIZARD_HU_WEL_CONTENT"),o=localizedString("WIZARD_HU_GUIDE_TITLE"),u=localizedString("WIZARD_HU_GUIDE_DESCRIPTION"),a=$("<div>").addClass("guide_main"),f=[localizedString("WIZARD_HU_BASICSETTINGS"),localizedString("WIZARD_HU_SWRESOURCE"),localizedString("WIZARD_HU_PSERVER"),localizedString("WIZARD_HU_BASERVERS"),localizedString("WIZARD_HU_OPERATOR_CREDENTS"),localizedString("WIZARD_HU_REVIEW"),localizedString("MISC_PROGRESS&FINISH")],l=[localizedString("WIZARD_HU_BASICSETTINGS"),localizedString("WIZARD_HU_SWINFO"),localizedString("WIZARD_HU_PRESENTATION"),localizedString("WIZARD_HU_BASERVER"),localizedString("WIZARD_HU_OPERATOR_CREDENTS"),localizedString("WIZARD_HU_REVIEW"),localizedString("MISC_PROGRESS&FINISH")],c=[localizedString("WIZARD_HU_INPUTHUINFO"),localizedString("WIZARD_HU_SWSUBTITLE"),localizedString("WIZARD_HU_PRESENTATIONSUBTITLE"),localizedString("WIZARD_HU_BASSUBTITLE"),localizedString("WIZARD_HU_OPERATOR_CREDENTS_INFO"),localizedString("WIZARD_HU_REVIEWSUBTITLE"),""],h=this,p=arguments[1]||undefined,d=$("<div>").addClass("element_group"),v=$("<div>").addClass("element_box1"),m=$("<div>").addClass("element_box1"),g=$("<div>").addClass("element_box1"),y=$("<div>").addClass("element_box1"),b=$("<div>").addClass("element_box1"),w=$("<div>").addClass("element_box1"),E=$("<div>").addClass("element_box1"),S=$("<div>").addClass("element_box1"),x=$("<div>").addClass("element_box1"),T=$("<div>").addClass("element_box1"),N=$("<div>").addClass("element_box1"),C=$("<div>").addClass("element_box1"),k=$("<div>").addClass("element_box1"),L=$("<div>").addClass("element_box1");h.SWrepositoryCountLabel=$("<label>"),h.mailerCountLabel=$("<label>"),h.DBinstanceCountLabel=$("<label>"),h.presentationserverCountLabel=$("<label>"),h.licenseserverCountLabel=$("<label>"),h.commonDBCountLabel=$("<label>"),h.B1iCountLabel=$("<label>"),h.SharedFolderCountLabel=$("<label>"),h.TenantsStorageCountLabel=$("<label>"),h.ImplRepositoryCountLabel=$("<label>"),h.CpyTempRepositoryCountLabel=$("<label>"),h.AnalyticsService=$("<label>"),h.XAppService=$("<label>"),h.BAServiceLabel=$("<label>");var A=function(){c3.service.getSWRepositories().count().query(O),c3.service.getMailerServices().count().query(M),c3.service.getDBServerInstances().count().query(function(e){c3.service.getHostingUnits().count().query(function(t){var n=parseInt(e.data);isNaN(n)&&(n=0);var r=parseInt(t.data);isNaN(r)&&(r=0),_({data:n-r})})}),c3.service.getPresentationServers().filter("ServiceUnit eq null").count().query(D),c3.service.getLicenseServers().filter("Status eq 'Online'").count().query(P),c3.service.getCommonDBs().count().query(function(e){c3.service.getHostingUnits().count().query(function(t){var n=parseInt(e.data);isNaN(n)&&(n=0);var r=parseInt(t.data);isNaN(r)&&(r=0),H({data:n-r})})}),c3.service.getB1iServers().count().query(function(e){c3.service.getHostingUnits().filter("IntegrationComponent ne null").count().query(function(t){var n=parseInt(e.data);isNaN(n)&&(n=0);var r=parseInt(t.data);isNaN(r)&&(r=0),F({data:n-r})})}),c3.service.getB1aServers().count().query(function(e){c3.service.getHostingUnits().filter("AnalyticsService ne null").count().query(function(t){var n=parseInt(e.data);isNaN(n)&&(n=0);var r=parseInt(t.data);isNaN(r)&&(r=0),B({data:n-r})})}),c3.service.getXAppServices().count().query(function(e){c3.service.getHostingUnits().filter("XAppService ne null").count().query(function(t){var n=parseInt(e.data);isNaN(n)&&(n=0);var r=parseInt(t.data);isNaN(r)&&(r=0),j({data:n-r})})}),c3.service.getBrowserAccessServers().expand("ServiceUnit").filter("ServiceUnit eq null").count().query(z),c3.service.getSharedFolders().count().query(I),c3.service.getTenantsStorages().count().query(q),c3.service.getImplementationRepositories().count().query(R),c3.service.getCompanyTemplateRepositories().count().query(U)};A(),a.append(d),d.append(v).append(x).append(E).append(S).append(m).append(g).append(b).append(y).append(T).append(N).append(C).append(k).append(L),d.css({height:"200px","overflow-y":"scroll"}),v.append(W()),m.append(K()),g.append(Q()),y.append(Z()),b.append(G()),w.append(et()),E.append(tt()),S.append(nt()),x.append(X()),T.append(rt),N.append(it),C.append(V()),k.append(J()),L.append(Y()),this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.SoftwareRepositories,function(e){c3.service.getSWRepositories().count().query(O)}),cometdManager.subscribe(sldEntitySet.LicenseServers,function(e){c3.service.getLicenseServers().filter("Status eq 'Online'").count().query(P)}),cometdManager.subscribe(sldEntitySet.DatabaseInstances,function(e){c3.service.getDBServerInstances().count().query(function(e){c3.service.getHostingUnits().count().query(function(t){var n=parseInt(e.data);isNaN(n)&&(n=0);var r=parseInt(t.data);isNaN(r)&&(r=0),_({data:n-r})})})}),cometdManager.subscribe(sldEntitySet.CommonDatabases,function(e){c3.service.getCommonDBs().count().query(function(e){c3.service.getHostingUnits().count().query(function(t){var n=parseInt(e.data);isNaN(n)&&(n=0);var r=parseInt(t.data);isNaN(r)&&(r=0),H({data:n-r})})})}),cometdManager.subscribe(sldEntitySet.PresentationServers,function(e){c3.service.getPresentationServers().filter("ServiceUnit eq null").count().query(D)}),cometdManager.subscribe(sldEntitySet.SharedFolders,function(e){c3.service.getSharedFolders().count().query(I)}),cometdManager.subscribe(sldEntitySet.TenantsStorages,function(e){c3.service.getTenantsStorages().count().query(q)}),cometdManager.subscribe(sldEntitySet.IntegrationComponents,function(e){c3.service.getB1iServers().count().query(function(e){c3.service.getHostingUnits().filter("IntegrationComponent ne null").count().query(function(t){var n=parseInt(e.data);isNaN(n)&&(n=0);var r=parseInt(t.data);isNaN(r)&&(r=0),F({data:n-r})})})}),cometdManager.subscribe(sldEntitySet.AnalyticService,function(e){c3.service.getB1aServers().count().query(function(e){c3.service.getHostingUnits().filter("AnalyticsService ne null").count().query(function(t){var n=parseInt(e.data);isNaN(n)&&(n=0);var r=parseInt(t.data);isNaN(r)&&(r=0),B({data:n-r})})})}),cometdManager.subscribe(sldEntitySet.XAppService,function(e){c3.service.getXAppServices().count().query(function(e){c3.service.getHostingUnits().filter("XAppService ne null").count().query(function(t){var n=parseInt(e.data);isNaN(n)&&(n=0);var r=parseInt(t.data);isNaN(r)&&(r=0),j({data:n-r})})})}),cometdManager.subscribe(sldEntitySet.ImplementationRepositories,function(e){c3.service.getImplementationRepositories().count().query(R)}),cometdManager.subscribe(sldEntitySet.CompanyTemplateRepositories,function(e){c3.service.getCompanyTemplateRepositories().count().query(U)}),cometdManager.subscribe(sldEntitySet.B1WebServers,function(e){c3.service.getBrowserAccessServers().expand("ServiceUnit").filter("ServiceUnit eq null").count().query(z)})},this.HUEntity={},this.onInit=function(){this.steps=[new e.basicSetting(this,p),new e.infraComponents(this),new e.presentationServers(this),new e.browserAccessServers(this),new e.operatorCredentials(this),new e.review(this),new e.processing(this)],c3ModuleManager.Listeners.push(new c3Listener("Referech_SUCreation_WelcomeOverview",A))},this.getId=function(){return"huwizard"},this.getTitle=function(){return r},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(i,s,o,u,a)},this.getStepCount=function(){return h.steps.length},this.getStepTitle=function(e){return l[e]},this.getStepSubtitle=function(e){return c[e]},this.getStepName=function(e){return f[e]},this.getStep=function(e){return this.steps[e]},this.getSelectedDBType=function(){return this.selectedDBType},this.setSelectedDBType=function(e){return this.selectedDBType=e},this.finish=function(){t&&t.reload()}};return e.basicSetting=function(){function h(){r=this.value,a.setSelectedDBType(r),g()}function p(n){n.css("border","1px solid red"),e.html(t),e.css({left:n.offset().left,top:n.offset().top+20}),$("body").append(e),window.setTimeout(function(){$(window).bind("mousedown keydown",function(){d(n)})},500),n.bind("focus",function(){n.css("border","0")})}function d(t){$(window).unbind("mousedown keydown",function(){d(t)}),e.remove()}function m(){a.HUEntity.Name=l.Name.Value.val(),a.HUEntity.Version=l.Version.Value.find("option:selected").html(),a.HUEntity.InstallationPackageRepository={ID:parseInt(l.Version.Value.val())},a.HUEntity.Purpose=l.Type.Value.val(),a.HUEntity.Description=l.Description.Value.val(),a.HUEntity.Status="Online",a.HUEntity.ServerType=a.getSelectedDBType()}function g(){c3.service.getSWRepositories().query(function(e){l.Version.Value.find("option").remove(),l.Version.Value.append($("<option>"));var t=null;for(var n=0;n<e.data.length;n++){if(r=="")break;if(r===ServerType.MSSQL_SERVER&&e.data[n].HANAenabled===!0)continue;if(r===ServerType.HANA_SERVER&&e.data[n].SQLenabled===!0)continue;t=$("<option>").append(e.data[n].Version).attr({value:e.data[n].ID}),f.TargetVersionId?f.TargetVersionId==e.data[n].ID&&t.attr({selected:"selected"}):a.HUEntity&&a.HUEntity.Version&&a.HUEntity.Version==e.data[n].Version&&t.attr({selected:"selected"}),l.Version.Value.append(t)}})}this.base=c3.module,this.base(),this._container=$("<div>");var e=$("<div>").addClass("error_bubble"),t=localizedString("VALIDITY_PATTERNMISMATCH"),n=$("<div>"),r="",i=$("<label>").append(localizedString("MSSQL")),s=$("<input>").attr({name:"DBSelectionRadioBtn",type:"radio",editable:!0,checked:!1,value:ServerType.MSSQL_SERVER}).click(h);s.html(localizedString("MSSQL"));var o=$("<label>").append(localizedString("HANA")),u=$("<input>").attr({name:"DBSelectionRadioBtn",type:"radio",editable:!0,checked:!1,value:ServerType.HANA_SERVER}).click(h);u.html(localizedString("HANA")),n.append(s).append(i).append(u).append(o);var a=arguments[0]||{},f=arguments[1]||{},l={Name:{Name:localizedString("WIZARD_HU_HUNAME"),Value:new textbox({isRequired:!0,maxlength:100,pattern:"[^'#&]*"})},DBType:{Name:localizedString("MISC_DBTYPE"),Value:n},Version:{Name:localizedString("MISC_VERSION"),Value:new dropdownlist({isRequired:!0})},Type:{Name:localizedString("COLUMN_PURPOSE"),Value:new dropdownlist({isRequired:!0})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},c=new function(){var e=[],t=function(){function o(e){e.data.length>0?l.Name.Value.showErrorMessage(textbox.validityMessages.duplicated):a()}function u(){a()}function a(){m(),e.length>0&&e[0]()}var t=l[localizedString("MISC_DESCRIPTION")].Value.val(),n=l.Name.Value.checkValidity()&&l.Version.Value.checkValidity()&&l.Type.Value.checkValidity();t.length>0?t.indexOf("'")>=0||t.indexOf("#")>=0||t.indexOf("&")>=0?(n=n&&!1,p(l[localizedString("MISC_DESCRIPTION")].Value,this._container)):(n=n&&!0,$(l[localizedString("MISC_DESCRIPTION")].Value),d(l[localizedString("MISC_DESCRIPTION")].Value)):(n=n&&!0,$(l[localizedString("MISC_DESCRIPTION")].Value),d(l[localizedString("MISC_DESCRIPTION")].Value));if(l.Type.Value.val()==="Trial"){var r=l.Version.Value.find("option:selected").text(),i=r.split("."),s=parseInt(i.join(""));s<"88207007"&&(n=n&&!1,l.Version.Value.showErrorMessage(localizedString("VERSION_CHECK_4TRIALSU")))}n&&c3.service.getHostingUnits().filter(String.format("Name eq '{0}'",encodeURI(l.Name.Value.val()))).query({success:o,error:u})};this.validEvent=e,this.checkValidity=t};f.TargetVersionId&&l.Version.Value.attr({disabled:"disabled"}),this.validator=c,this.onInit=function(){this._container.append(v),c.validEvent.push(m),y()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.SoftwareRepositories,function(e){g()})};var v=function(){var e=$("<div>");for(var t in l){var n=Utility.CreateRow(l[t].Name,l[t].Value);e.append(n)}return e};this.onViewAppear=function(){};var y=function(){g(),l.Type.Value.find("option").remove(),l.Type.Value.append($("<option>"));var e=c3.service.getHUPurposeValues();c3.service.getHUPurposeValues(function(e){var t=null;for(var n=0;n<e.data.length;n++)t=$("<option>").val(e.data[n]),t.append(e.data[n]),l.Type.Value.append(t)})}},e.infraComponents=function(){function s(e,t){e!=null&&t!=null&&$(e).find("option").each(function(e,n){$(n).val()!=t?$(n).removeAttr("selected"):$(n).attr("selected",!0)})}function o(){t.HUEntity.LicenseServer={ID:e.License.Value.val()},t.HUEntity.DBServerInstance={ID:e.MSSql.Value.val()},t.HUEntity.SharedFolder={ID:e.SharedFolder.Value.val()},t.HUEntity.B1iServer={ID:e.B1i.Value.val()},t.HUEntity.Mailer={ID:e.Mailer.Value.val()},t.HUEntity.TenantsStorage={ID:e.TenantsStorage.Value.val()},t.HUEntity.PackageRepositoty={ID:e.ImplRepository.Value.val()},t.HUEntity.CompanyTemplateRepositoty={ID:e.CompanyTemplateRepository.Value.val()},t.HUEntity.AnalyticsService={ID:e.B1A.Value.val()},t.HUEntity.XAppService={ID:e.XAPP.Value.val()},n.SelectedValues={},n.SelectedValues.LicenseServer=e.License.Value.find("option:selected").text(),n.SelectedValues.DBServerInstance=e.MSSql.Value.find("option:selected").text(),n.SelectedValues.SharedFolder=e.SharedFolder.Value.find("option:selected").text(),n.SelectedValues.SBOCommon=e.SBOCommon.Value.val(),n.SelectedValues.B1iServer=e.B1i.Value.find("option:selected").text(),n.SelectedValues.Mailer=e.Mailer.Value.find("option:selected").text(),n.SelectedValues.TenantsStorage=e.TenantsStorage.Value.find("option:selected").text(),n.SelectedValues.PackageRepositoty=e.ImplRepository.Value.find("option:selected").text(),n.SelectedValues.CompanyTemplateRepositoty=e.CompanyTemplateRepository.Value.find("option:selected").text(),n.SelectedValues.AnalyticsService=e.B1A.Value.find("option:selected").text(),n.SelectedValues.XAppService=e.XAPP.Value.find("option:selected").text()}function f(){c3.service.getLicenseServers().expand("Machine").filter("Status eq 'Online'").query(function(n){e.License.Value.find("option").remove(),e.License.Value.append($("<option>"));var r=null;for(var i=0;i<n.data.length;i++)if(n.data[i].Machine){if(t.getSelectedDBType()==ServerType.HANA_SERVER){if(n.data[i].Port=="30000")continue}else if(t.getSelectedDBType()==ServerType.MSSQL_SERVER&&n.data[i].Port=="40000")continue;r=$("<option>").attr({value:n.data[i].ID}).text(n.data[i].Machine.Hostname+":"+n.data[i].Port),t.HUEntity&&t.HUEntity.LicenseServer&&t.HUEntity.LicenseServer.ID==n.data[i].ID&&r.attr({selected:"selected"}),e.License.Value.append(r)}})}function l(){c3.service.getDBServerInstances().filter("Status eq 'Online' and LifeCycleStatus eq 'Running'").expand("Machine,CommonDatabases").query(function(n){e.MSSql.Value.find("option").remove(),e.MSSql.Value.append($("<option>"));var r=null;c3.service.getHostingUnits().expand("CommonDatabase").query(function(i){for(var s=0;s<n.data.length;s++)if(n.data[s].Machine){var o=n.data[s].CommonDatabases.results;if(o.length>0){if(o[0].Version!==t.HUEntity.Version)continue;var u=!1;for(var a=0;a<i.data.length;a++)if(i.data[a].CommonDatabase.ID===o[0].ID){u=!0;break}if(u)continue}r=$("<option>").attr({value:n.data[s].ID,serverType:n.data[s].ServerType}).text(n.data[s].Name),t.HUEntity&&t.HUEntity.DBServerInstance&&t.HUEntity.DBServerInstance.ID==n.data[s].ID&&r.attr({selected:"selected"}),e.MSSql.Value.append(r)}})})}function c(){c3.service.getSharedFolders().query(function(n){e.SharedFolder.Value.find("option").remove(),e.SharedFolder.Value.append($("<option>"));var r=null;for(var i=0;i<n.data.length;i++)r=$("<option>").attr({value:n.data[i].ID}).text(n.data[i].URI),t.HUEntity&&t.HUEntity.SharedFolder&&t.HUEntity.SharedFolder.ID==n.data[i].ID&&r.attr({selected:"selected"}),e.SharedFolder.Value.append(r)})}function h(){c3.service.getB1iServers().query(function(n){e.B1i.Value.find("option").remove(),e.B1i.Value.append($("<option>")),c3.service.getHostingUnits().expand("IntegrationComponent").query(function(r){for(var i=0;i<n.data.length;i++){var s=n.data[i].ID,o=n.data[i].URL,u=!1;for(var a=0;a<r.data.length;a++)if(r.data[a].IntegrationComponent&&s==r.data[a].IntegrationComponent.ID){u=!0;break}if(!u){var f=$("<option>").attr({value:s}).text(o);t.HUEntity&&t.HUEntity.B1iServer&&t.HUEntity.B1iServer.ID==s&&f.attr({selected:"selected"}),e.B1i.Value.append(f)}}})})}function p(){c3.service.getXAppServices().query(function(n){e.XAPP.Value.find("option").remove(),e.XAPP.Value.append($("<option>")),c3.service.getHostingUnits().expand("XAppService").query(function(r){for(var i=0;i<n.data.length;i++){var s=n.data[i].ID,o=n.data[i].Link,u=!1;for(var a=0;a<r.data.length;a++)if(r.data[a].XAppService&&s==r.data[a].XAppService.ID){u=!0;break}if(!u){var f=$("<option>").attr({value:s}).text(o);t.HUEntity&&t.HUEntity.XAppService&&t.HUEntity.XAppService.ID==s&&f.attr({selected:"selected"}),e.XAPP.Value.append(f)}}})})}function d(){c3.service.getB1aServers().query(function(n){e.B1A.Value.find("option").remove(),e.B1A.Value.append($("<option>")),c3.service.getHostingUnits().expand("AnalyticsService").query(function(r){for(var i=0;i<n.data.length;i++){var s=n.data[i].ID,o=n.data[i].URL,u=!1;for(var a=0;a<r.data.length;a++)if(r.data[a].AnalyticsService&&s==r.data[a].AnalyticsService.ID){u=!0;break}if(!u){var f=$("<option>").attr({value:s}).text(o);t.HUEntity&&t.HUEntity.AnalyticsService&&t.HUEntity.AnalyticsService.ID==s&&f.attr({selected:"selected"}),e.B1A.Value.append(f)}}})})}function v(){c3.service.getMailerServices().query(function(n){e.Mailer.Value.find("option").remove(),e.Mailer.Value.append($("<option>")),c3.service.getHostingUnits().expand("Mailer").query(function(r){for(var i=0;i<n.data.length;i++){var s=n.data[i].ID,o=n.data[i].Name,u=!1;for(var a=0;a<r.data.length;a++)if(r.data[a].Mailer&&s==r.data[a].Mailer.ID){u=!0;break}if(!u){var f=$("<option>").attr({value:s}).text(o);t.HUEntity&&t.HUEntity.Mailer&&t.HUEntity.Mailer.ID==s&&f.attr({selected:"selected"}),e.Mailer.Value.append(f)}}})})}function m(){c3.service.getTenantsStorages().query(function(n){e.TenantsStorage.Value.find("option").remove(),e.TenantsStorage.Value.append($("<option>"));var r=null;for(var i=0;i<n.data.length;i++)r=$("<option>").text(n.data[i].URI).attr({value:n.data[i].ID}),t.HUEntity&&t.HUEntity.TenantsStorage&&t.HUEntity.TenantsStorage.ID==n.data[i].ID&&r.attr({selected:"selected"}),e.TenantsStorage.Value.append(r)})}function g(){c3.service.getImplementationRepositories().filter("Status eq 'Available' and Reseller eq null").query(function(n){e.ImplRepository.Value.find("option").remove(),e.ImplRepository.Value.append($("<option>"));var r=null;for(var i=0;i<n.data.length;i++)r=$("<option>").text(n.data[i].URI).attr({value:n.data[i].ID}),t.HUEntity&&t.HUEntity.PackageRepositoty&&t.HUEntity.PackageRepositoty.ID==n.data[i].ID&&r.attr({selected:"selected"}),e.ImplRepository.Value.append(r)})}function y(){c3.service.getCompanyTemplateRepositories().filter("Status eq 'Available' and Reseller eq null").query(function(n){e.CompanyTemplateRepository.Value.find("option").remove(),e.CompanyTemplateRepository.Value.append($("<option>"));var r=null;for(var i=0;i<n.data.length;i++)r=$("<option>").text(n.data[i].URI).attr({value:n.data[i].ID}),t.HUEntity&&t.HUEntity.CompanyTemplateRepositoty&&t.HUEntity.CompanyTemplateRepositoty.ID==n.data[i].ID&&r.attr({selected:"selected"}),e.CompanyTemplateRepository.Value.append(r)})}this.base=c3.module,this.base(),this._container=$("<div>");var e={License:{Name:"* "+localizedString("WIZARD_HU_LIVSVR"),Value:new dropdownlist({isRequired:!0})},MSSql:{Name:"* "+localizedString("WIZARD_HU_MSSQL"),Value:new dropdownlist({isRequired:!0})},SBOCommon:{Name:"* "+localizedString("WIZARD_HU_SBOCOMMON"),Value:new textbox},SharedFolder:{Name:"* "+localizedString("RES_SHARED_FOLDER_OPTION"),Value:new dropdownlist({isRequired:!0})},TenantsStorage:{Name:"* "+localizedString("RES_TENANTS_STORAGE"),Value:new dropdownlist({isRequired:!0})},B1i:{Name:localizedString("WIZARD_HU_B1I"),Value:new dropdownlist({isRequired:!1})},Mailer:{Name:localizedString("WIZARD_HU_MAILERSVC"),Value:new dropdownlist({isRequired:!1})},ImplRepository:{Name:localizedString("RES_SHARED_IMPL_REPOSITORY"),Value:new dropdownlist({isRequired:!1})},B1A:{Name:localizedString("RES_B1AH_SERVER"),Value:new dropdownlist({isRequired:!1})},XAPP:{Name:localizedString("RES_XAPP_SERVICE"),Value:new dropdownlist({isRequired:!1})},CompanyTemplateRepository:{Name:localizedString("RES_COMPANY_TEMPLATE_REPOSITORY"),Value:new dropdownlist({isRequired:!1})}};e.MSSql.Value.attr({id:"MSSQL"});var t=arguments[0]||{},n=this;this.validator=new function(){var n=[],r=function(){o();var n=e.License.Value.checkValidity()&&e.MSSql.Value.checkValidity()&&e.SharedFolder.Value.checkValidity()&&e.TenantsStorage.Value.checkValidity()&&e.B1i.Value.checkValidity()&&e.Mailer.Value.checkValidity()&&e.ImplRepository.Value.checkValidity()&&e.CompanyTemplateRepository.Value.checkValidity();if(!n)return!1;t.next()};this.checkValidity=r};var r=function(n){c3.service.getHostingUnits().filter("TenantsStorage/ID eq "+e.TenantsStorage.Value.val()).query(function(e){if(e.data&&e.data.length>0){var r=$("<div>");n?r.html(localizedString("SU_CREATION_TENANTSSTORAGE_CONFIRM")):r.html(localizedString("SU_CREATION_SHAREDFOLDER_CONFIRM")+"<br/>"+localizedString("SU_CREATION_TENANTSSTORAGE_CONFIRM"));var i=MessageBox.confirm({msg:r,width:380,height:185});i.yesEvent.push(function(){t.next()})}else if(!n){var r=$("<div>");r.html(localizedString("SU_CREATION_SHAREDFOLDER_CONFIRM"));var i=MessageBox.confirm({msg:r,width:350,height:150});i.yesEvent.push(function(){t.next()})}else t.next()})};this.onInit=function(){e.SBOCommon.Value.attr({readonly:!0}),this._container.append(i());var t=$("<div>").append(localizedString("WIZARD_HU_OPT"));t.addClass("row"),t.css({position:"absolute",bottom:"2.5em"}),this._container.append(t),u()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.LicenseServers,function(e){f()}),cometdManager.subscribe(sldEntitySet.DatabaseInstances,function(e){l()}),cometdManager.subscribe(sldEntitySet.SharedFolders,function(e){c()}),cometdManager.subscribe(sldEntitySet.IntegrationComponents,function(e){h()}),cometdManager.subscribe(sldEntitySet.Mailers,function(e){v()}),cometdManager.subscribe(sldEntitySet.TenantsStorages,function(e){m()}),cometdManager.subscribe(sldEntitySet.ImplementationRepositories,function(e){g()}),cometdManager.subscribe(sldEntitySet.CompanyTemplateRepositories,function(e){y()}),cometdManager.subscribe(sldEntitySet.AnalyticService,function(e){d()}),cometdManager.subscribe(sldEntitySet.XAppService,function(e){p()})};var i=function(){var t=$("<div>"),r=null;for(var i in e){r=Utility.CreateRow(e[i].Name,e[i].Value);if(i=="SharedFolder"||i=="TenantsStorage")e[i].Value.attr({id:i}),e[i].Value.bind("change",function(){var t=this;if($(t).val()==""){$(t).attr("id")=="SharedFolder"?n.CurrentSharedFolder="":n.CurrentTenantStorage="";return}n.lw_sf=new loadingWindow,n.lw_sf.show();var r="";$(t).attr("id")=="SharedFolder"?r="SharedFolder/ID eq "+e.SharedFolder.Value.val():r="TenantsStorage/ID eq "+e.TenantsStorage.Value.val(),c3.service.getHostingUnits().filter(r).query(function(e){n.lw_sf.close();if(e.data&&e.data.length>0){var r=$("<div>");$(t).attr("id")=="SharedFolder"?r.html(localizedString("SU_CREATION_SHAREDFOLDER_CONFIRM")):r.html(localizedString("SU_CREATION_TENANTSSTORAGE_CONFIRM"));var i=MessageBox.confirm({msg:r,width:380,height:150});i.yesEvent.push(function(){$(t).attr("id")=="SharedFolder"?n.CurrentSharedFolder=$(t).val():n.CurrentTenantStorage=$(t).val()}),i.noEvent.push(function(){$(t).attr("id")=="SharedFolder"?!n.CurrentSharedFolder||n.CurrentSharedFolder==null?s(t,""):s(t,n.CurrentSharedFolder):!n.CurrentTenantStorage||n.CurrentTenantStorage==null?s(t,""):s(t,n.CurrentTenantStorage)})}else $(t).attr("id")=="SharedFolder"?n.CurrentSharedFolder=$(t).val():n.CurrentTenantStorage=$(t).val()})});i==="TenantsStorage"&&r.css({"border-bottom":"1px solid #B1C0D3","padding-bottom":"10px","margin-bottom":"0"}),t.append(r)}return t},u=function(){e.MSSql.Value.bind("change",function(){t.HUEntity.DBServerInstance={ID:$(this).val()},""!=$(this).find("option:selected").val()&&c3.service.getDBServerInstances(e.MSSql.Value.find("option:selected").val()).expand("CommonDatabases").query(function(n){0!=n.data.CommonDatabases.results.length?(e.SBOCommon.Value.val(n.data.CommonDatabases.results[0].Name),t.HUEntity.CommDB={ID:n.data.CommonDatabases.results[0].ID}):(e.SBOCommon.Value.val(localizedString("WIZARD_HU_SBOCOMMONCRT")),t.HUEntity.CommDB={ID:null})})}),e.License.Value.bind("change",function(){t.HUEntity.LicenseServer={ID:$(this).val()},e.MSSql.Value.find("option:disabled").removeAttr("disabled"),e.MSSql.Value.find("option:selected").removeAttr("selected"),e.SBOCommon.Value.val("");if(""!=$(this).find("option:selected").val()){var n=e.License.Value.find("option:selected").text().split(":")[1];for(var r=0;r<$("#MSSQL")[0].options.length;r++){var i=$("#MSSQL")[0].options[r].getAttribute("serverType");i!=null&&i===ServerType.HANA_SERVER?n=="30000"&&$("#MSSQL")[0].options[r].setAttribute("disabled",!0):i!=null&&i.indexOf(ServerType.MSSQL_SERVER)!=-1&&n=="40000"&&$("#MSSQL")[0].options[r].setAttribute("disabled",!0)}}})};this.onViewAppear=function(){e.License.Value.val()&&(t.HUEntity.LicenseServer={ID:e.License.Value.val()}),e.MSSql.Value.val()&&(t.HUEntity.DBServerInstance={ID:e.MSSql.Value.val()}),e.B1i.Value.val()&&(t.HUEntity.B1iServer={ID:e.B1i.Value.val()}),e.B1A.Value.val()&&(t.HUEntity.AnalyticsService={ID:e.B1A.Value.val()}),e.XAPP.Value.val()&&(t.HUEntity.XAppService={ID:e.XAPP.Value.val()}),e.Mailer.Value.val()&&(t.HUEntity.Mailer={ID:e.Mailer.Value.val()}),e.TenantsStorage.Value.val()&&(t.HUEntity.TenantsStorage={ID:e.TenantsStorage.Value.val()}),e.ImplRepository.Value.val()&&(t.HUEntity.PackageRepositoty={ID:e.ImplRepository.Value.val()}),e.CompanyTemplateRepository.Value.val()&&(t.HUEntity.CompanyTemplateRepositoty={ID:e.CompanyTemplateRepository.Value.val()}),e.SharedFolder.Value.val()&&(t.HUEntity.SharedFolder={ID:e.SharedFolder.Value.val()}),this.SelectedValues=[],a()};var a=function(){f(),l(),c(),h(),v(),m(),g(),y(),d(),p()}},e.presentationServers=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"name",description:localizedString("RESPOOL_PSSERVER_COLUMN_HOSTNAME"),type:"text",width:"30%"},{name:"ServerType",description:localizedString("MISC_TYPE"),type:"text",width:"20%"},{name:"SBOVersion",description:localizedString("SBOVERSION"),type:"text",width:"38%"}],n=null,r=arguments[0]||{};this.gridData=[],e.PSSessions=[],this.onInit=function(){var i=$("<div>"),s=$("<div>").addClass("tools");s.addClass("toolsbar");var o=$("<input>").attr({type:"button",value:localizedString("MISC_ADD")}).click(function(){var t=new c3registerPresServer(e);t.show()}),u=$("<div>"),a={getHeaderSpec:function(){return t},getRowCount:function(){return e.gridData.length},getRow:function(t){return e.gridData[t]},getGridHeight:function(){return 330},getTip:function(){return Utility.CreateTipBoard(localizedString("WIZARD_HU_PRESENTATION"),function(){var t=new c3registerPresServer(e);t.show()})},getDefaultSelectedIndex:function(){if(r.HUEntity.PresentationServers!=null&&r.HUEntity.PresentationServers.length>0){var e=[];for(var t=0;t<r.HUEntity.PresentationServers.length;t++)e.push(r.HUEntity.PresentationServers[t].Index);return e.length>0?e:-1}return-1},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}};n=u.gridview({delegate:a,checkType:1}),n.rowCheckEvent.push(function(){var t=this,n=t.index,i=e.gridData[n],s=r.HUEntity;s.PresentationServers||(s.PresentationServers=[],e.PSSessions=[]);var o=s.PresentationServers,u=e.PSSessions;if(this.isChecked){var a={ID:i.ID,Index:n},f={ID:i.ID,SBOClientID:i.SBOClientID,MachineID:i.MachineID,Name:i.name,Status:i.Status,SBOVersion:i.SBOVersion};o.push(a),u.push(f),i.Selected=!0}else{i.Selected=!1;for(var l=0;l<o.length;l++)if(i.ID==o[l].ID){o.remove(l),u.remove(l);break}}}),n.show(),i.append(u),this._container.append(i)},this.validator=new psValidator(e,r.HUEntity,r.next),e.Next=function(){r.next()};var i=function(){r&&r.readyForNext&&r.readyForNext()};this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.PresentationServers,function(e){s()})};var s=function(){c3.service.getPresentationServers().expand("Machine,SBOClient").filter("ServiceUnit eq null and Status eq 'Online'").query(function(t){e.gridData=[];var r=[];c3.service.getBrowserAccessServers().expand("Machine,SBOClient, ServiceUnit").filter("ServiceUnit ne null").query(function(i){if(i.data&&i.data.length>0)for(var s=0;s<i.data.length;s++)r.push({Name:i.data[s].Name,ID:i.data[s].ID,MachineName:i.data[s].Machine.Hostname,SUID:i.data[s].ServiceUnit.ID});for(var s=0;s<t.data.length;s++){var o=!1;for(var u=0;u<r.length;u++)if(r[u].MachineName==t.data[s].Machine.Hostname){o=!0;break}o==0&&e.gridData.push({name:t.data[s].Name,ID:t.data[s].ID,Status:t.data[s].Status,Description:t.data[s].Description,ServerType:t.data[s].ServerType,Selected:!1,SBOClientID:t.data[s].SBOClient==null?null:t.data[s].SBOClient.ID,SBOVersion:t.data[s].SBOClient==null?null:t.data[s].SBOClient.Version,MachineName:t.data[s].Machine.Hostname,MachineID:t.data[s].Machine.ID})}c3.service.retrieveWorkstations().query(function(t){if(t.data&&t.data.length>0)for(var r=0;r<e.gridData.length;r++){var i=!1;for(var s=0;s<t.data.length>0;s++)if(t.data[s].Hostname==e.gridData[r].MachineName&&t.data[s].Status=="Available"){i=!0,e.gridData[r].SLDAgentStatus="Available";break}i||e.gridData.remove(r--)}else e.gridData=[];n.reload()})})})};this.reload=function(){this.onViewAppear()},this.onViewAppear=function(){s()}},e.browserAccessServers=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"name",description:localizedString("RESPOOL_PSSERVER_COLUMN_HOSTNAME"),type:"text",width:"30%"},{name:"ServerType",description:localizedString("RESPOOL_BAS_COLUMN_SLDCLIENTDBTYPE"),type:"text",width:"20%"},{name:"SBOVersion",description:localizedString("SBOVERSION"),type:"text",width:"38%"}],n=null,r=arguments[0]||{};this.gridData=[],e.BASessions=[],this.onInit=function(){var i=$("<div>"),s=$("<div>").addClass("tools");s.addClass("toolsbar");var o=$("<input>").attr({type:"button",value:localizedString("MISC_ADD")}).click(function(){var t=new c3registerBAServer(e);t.show()}),u=$("<div>"),a={getHeaderSpec:function(){return t},getRowCount:function(){return e.gridData.length},getRow:function(t){return e.gridData[t]},getGridHeight:function(){return 330},getTip:function(){return Utility.CreateTipBoard(localizedString("WIZARD_HU_BASERVER"),function(){var t=new c3registerBAServer(e);t.show()})},getDefaultSelectedIndex:function(){if(r.HUEntity.BrowserAccessServers!=null&&r.HUEntity.BrowserAccessServers.length>0){var e=[];for(var t=0;t<r.HUEntity.BrowserAccessServers.length;t++)e.push(r.HUEntity.BrowserAccessServers[t].Index);return e.length>0?e:-1}return-1},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}};n=u.gridview({delegate:a,checkType:1}),n.rowCheckEvent.push(function(){var t=this,n=t.index,i=e.gridData[n],s=r.HUEntity;s.BrowserAccessServers||(s.BrowserAccessServers=[],e.BASessions=[]);var o=s.BrowserAccessServers,u=e.BASessions;if(this.isChecked){var a={ID:i.ID,Index:n},f={ID:i.ID,SBOClientID:i.SBOClientID,MachineID:i.MachineID,Name:i.name,Status:i.Status,SBOVersion:i.SBOVersion};o.push(a),u.push(f),i.Selected=!0}else{i.Selected=!1;for(var l=0;l<o.length;l++)if(i.ID==o[l].ID){o.remove(l),u.remove(l);break}}}),n.show(),i.append(u),this._container.append(i)},this.validator=new function(){this.checkValidity=function(){(!r.HUEntity.PresentationServers||r.HUEntity.PresentationServers.length<=0)&&(!r.HUEntity.BrowserAccessServers||r.HUEntity.BrowserAccessServers.length<=0)?r.disableStep(4):r.enableStep(4),r.next()}},e.Next=function(){r.next()};var i=function(){r&&r.readyForNext&&r.readyForNext()};this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.B1WebServers,function(e){s()})};var s=function(){c3.service.getBrowserAccessServers().expand("Machine,SBOClient").filter("ServiceUnit eq null and Status eq 'Online'").query(function(t){e.gridData=[];var r=[];c3.service.getPresentationServers().expand("Machine,SBOClient,ServiceUnit").filter("ServiceUnit ne null").query({success:function(i){if(i.data&&i.data.length>0)for(var s=0;s<i.data.length;s++)r.push({Name:i.data[s].Name,ID:i.data[s].ID,MachineName:i.data[s].Machine.Hostname,SUID:i.data[s].ServiceUnit.ID});for(var s=0;s<t.data.length;s++){var o=!1;for(var u=0;u<r.length;u++)if(r[u].MachineName==t.data[s].Machine.Hostname){o=!0;break}o==0&&e.gridData.push({name:t.data[s].Name,ID:t.data[s].ID,Status:t.data[s].Status,Description:t.data[s].Description,Selected:!1,SBOClientID:t.data[s].SBOClient==null?null:t.data[s].SBOClient.ID,SBOVersion:t.data[s].SBOClient==null?null:t.data[s].SBOClient.Version,ServerType:t.data[s].SBOClient==null?null:t.data[s].SBOClient.ServerType,MachineName:t.data[s].Machine.Hostname,MachineID:t.data[s].Machine.ID})}n.reload()},error:function(r){for(var i=0;i<t.data.length;i++)e.gridData.push({name:t.data[i].Name,ID:t.data[i].ID,Status:t.data[i].Status,Description:t.data[i].Description,Selected:!1,SBOClientID:t.data[i].SBOClient==null?null:t.data[i].SBOClient.ID,SBOVersion:t.data[i].SBOClient==null?null:t.data[i].SBOClient.Version,ServerType:t.data[i].SBOClient==null?null:t.data[i].SBOClient.ServerType,MachineName:t.data[i].Machine.Hostname,MachineID:t.data[i].Machine.ID});n.reload()}})})};this.reload=function(){this.onViewAppear()},this.onViewAppear=function(){s()}},e.operatorCredentials=function(){function u(){var e=this.checked}function a(n){n.css("border","1px solid red"),e.html(t),e.css({left:n.offset().left,top:n.offset().top+20}),$("body").append(e),window.setTimeout(function(){$(window).bind("mousedown keydown",function(){f(n)})},500),n.bind("focus",function(){n.css("border","0")})}function f(t){$(window).unbind("mousedown keydown",function(){f(t)}),e.remove()}function c(){var e={UserName:s.PS_NAME.Value.val(),Password:s.PS_PASS.Value.val()};r.HUEntity.ClientAgentServiceAccount=e}this.base=c3.module,this.base(),this._container=$("<div>");var e=$("<div>").addClass("error_bubble"),t=localizedString("VALIDITY_PATTERNMISMATCH"),n=$("<input>").attr({name:"UseCredentsForBoth",type:"checkbox",editable:!0,checked:!1}).click(u),r=arguments[0]||{},i=arguments[1]||{},s={PS_NAME:{Name:localizedString("MISC_USERNAME"),Value:new textbox({isRequired:!0,pattern:"([0-9a-zA-Z-_.]){1,}"})},PS_PASS:{Name:localizedString("MISC_PASSWORD"),Value:new textbox({isRequired:!0,type:"password"})}},o=new function(){var e=[],t=function(){function i(){c(),e.length>0&&e[0]()}var t=s.PS_NAME.Value.val(),n=s.PS_PASS.Value.val(),r={success:function(){i()}};suManager.validateClientAgentServiceAccount({userName:t,password:n},r)};this.validEvent=e,this.checkValidity=t};this.validator=o,this.onInit=function(){this._container.append(l),o.validEvent.push(c)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.SoftwareRepositories,function(e){})};var l=function(){var e=$("<div>");for(var t in s){var n=Utility.CreateRow(s[t].Name,s[t].Value);e.append(n)}return e};this.onViewAppear=function(){(!r.HUEntity.PresentationServers||r.HUEntity.PresentationServers.length<=0)&&(!r.HUEntity.BrowserAccessServers||r.HUEntity.BrowserAccessServers.length<=0)&&r.next()}},e.review=function(){function u(){i=[];if(r.HUEntity.PresentationServers&&r.HUEntity.PresentationServers.length>0)for(var e=0;e<r.HUEntity.PresentationServers.length;e++)for(var t=0;t<r.steps[2].gridData.length;t++)if(r.HUEntity.PresentationServers[e].ID==r.steps[2].gridData[t].ID){i.push(r.steps[2].gridData[t]);break}s.reload()}function a(e,t){var r=$("<div>").addClass("row"),i=$("<div>").append(e);return r.append(i),n.push(i),r}this.base=c3.module,this.base(),this._container=$("<div>");var e=[localizedString("WIZARD_HU_HUSETTINGS"),localizedString("WIZARD_HU_SWRESOURCE"),localizedString("WIZARD_HU_PSERVER")],t=[[localizedString("WIZARD_HU_HUNAME"),localizedString("MISC_TYPE"),localizedString("MISC_VERSION"),localizedString("MISC_DESCRIPTION")],[localizedString("WIZARD_HU_LIVSVR"),localizedString("WIZARD_HU_MSSQL"),localizedString("WIZARD_HU_SBOCOMMON"),localizedString("WIZARD_HU_B1I"),localizedString("WIZARD_HU_MAILERSVC"),localizedString("RES_SHARED_FOLDER_OPTION"),localizedString("RES_TENANTS_STORAGE"),localizedString("RES_SHARED_IMPL_REPOSITORY"),localizedString("SU_LABEL_CPYTEMPREP"),localizedString("RES_B1AH_SERVER"),localizedString("RES_XAPP_SERVICE")],[""]],n=[],r=arguments[0]||{},i=[],s=null,o={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"name",description:localizedString("RESPOOL_PSSERVER_COLUMN_HOSTNAME"),type:"text",width:"30%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"58%"}]},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 150},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}};this.onInit=function(){var n=$("<div>").addClass("review"),r=$("<div>");s=r.gridview({delegate:o}),s.show();for(var i=0;i<e.length;i++){var u=$("<div>").append(e[i]).addClass("blockHeader"),f=$("<div>").append(u).addClass("block");for(var l=0;l<t[i].length;l++){var c=$("<div>");2==i&&0==l&&f.append(r),t[i][l]&&f.append(a(t[i][l]+": "))}n.append(f)}this._container.append(n)},this.onViewAppear=function(){n[0].text(n[0].html().split(":")[0]+": "+r.HUEntity.Name),n[1].text(n[1].html().split(":")[0]+": "+r.HUEntity.Purpose),n[2].text(n[2].html().split(":")[0]+": "+r.HUEntity.Version),n[3].text(n[3].html().split(":")[0]+": "+r.HUEntity.Description),n[4].text(n[4].html().split(":")[0]+": "+r.steps[1].SelectedValues.LicenseServer),n[5].text(n[5].html().split(":")[0]+": "+r.steps[1].SelectedValues.DBServerInstance),n[6].text(n[6].html().split(":")[0]+": "+r.steps[1].SelectedValues.SBOCommon),n[7].text(n[7].html().split(":")[0]+": "+r.steps[1].SelectedValues.B1iServer),n[8].text(n[8].html().split(":")[0]+": "+r.steps[1].SelectedValues.Mailer),n[9].text(n[9].html().split(":")[0]+": "+r.steps[1].SelectedValues.SharedFolder),n[10].text(n[10].html().split(":")[0]+": "+r.steps[1].SelectedValues.TenantsStorage),n[11].text(n[11].html().split(":")[0]+": "+r.steps[1].SelectedValues.PackageRepositoty),n[12].text(n[12].html().split(":")[0]+": "+r.steps[1].SelectedValues.CompanyTemplateRepositoty),n[13].text(n[13].html().split(":")[0]+": "+r.steps[1].SelectedValues.AnalyticsService),n[14].text(n[14].html().split(":")[0]+": "+r.steps[1].SelectedValues.XAppService),u(),r&&r.readyForNext&&r.readyForNext()}},e.processing=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=[{Name:localizedString("WIZARD_HU_TESTDBCONNECTION"),Handle:{}},{Name:localizedString("WIZARD_HU_TESTLICSVR"),Handle:{}},{Name:localizedString("WIZARD_HU_CRTHU"),Handle:{}}],t=arguments[0]||{};this.onInit=function(){t.disableBack(),t.disableCancel(),t.disableNext(),t.HUEntity.B1iServer.ID=parseInt(t.HUEntity.B1iServer.ID),t.HUEntity.AnalyticsService.ID=parseInt(t.HUEntity.AnalyticsService.ID),t.HUEntity.XAppService.ID=parseInt(t.HUEntity.XAppService.ID),t.HUEntity.DBServerInstance.ID=parseInt(t.HUEntity.DBServerInstance.ID),t.HUEntity.LicenseServer.ID=parseInt(t.HUEntity.LicenseServer.ID),t.HUEntity.CommDB.ID=parseInt(t.HUEntity.CommDB.ID),t.HUEntity.SharedFolder.ID=parseInt(t.HUEntity.SharedFolder.ID),t.HUEntity.TenantsStorage.ID=parseInt(t.HUEntity.TenantsStorage.ID),t.HUEntity.CommDB.Name="SBO-COMMON",t.HUEntity.B1iServer.ID||delete t.HUEntity.B1iServer,t.HUEntity.XAppService.ID||delete t.HUEntity.XAppService,t.HUEntity.AnalyticsService.ID||delete t.HUEntity.AnalyticsService,t.HUEntity.PackageRepositoty.ID||delete t.HUEntity.PackageRepositoty,t.HUEntity.CompanyTemplateRepositoty.ID||delete t.HUEntity.CompanyTemplateRepositoty;var n=!1;this._container.append(Utility.CreateProgressRow(e[0].Name,function(){var e=this,r=t.steps[1].SelectedValues.DBServerInstance,i={success:function(t){n=t.d.TestDBServerConnection,t.d.TestDBServerConnection?e.setValue(100):e.setFailed()},error:function(){e.setFailed()}};c3.service.testConnectDBServer(r,null,null,null,null,i)},e[0].Handle)),this._container.append(Utility.CreateProgressRow(e[1].Name,function(){var e=this,n=t.HUEntity.LicenseServer.ID;c3.service.testConnectLicenseServerByID(n,{success:function(t,n){t.d.TestConnection?e.setValue(100):e.setFailed()},error:function(t,n){e.setFailed()}})},e[1].Handle));var r=0;e[0].Handle.progressBar.finishEvent.push(function(){n?suManager.createServiceUnit(t.HUEntity,{success:function(e){r=e.d.CreateServiceUnitAsync},error:function(e){r=-1}}):e[2].Handle.progressBar.setFailed()}),this._container.append(Utility.CreateProgressRow(e[2].Name,function(){var e=this;r!==0&&r!==-1?c3.service.getTaskProgress(r).query(function(t){var n=t.data.GetTaskProperties.split(",");"Failed"==n[0]?c3.service.getTasks(r).expand("TaskParameters").query(function(t){e.setFailed(t.data.ResultDescription),Utility.logTaskError(t.data)}):"Successful"==n[0]?e.setValue(100):e.setValue(parseInt(n[1]))}):-1===r?e.setFailed():e.setValue(0)},e[2].Handle));for(var i=0,s=e.length;i<s;i++)i<s-1?e[i].Handle.progressBar.finishEvent.push(function(e){return function(t){e.progressBar.start()}}(e[i+1].Handle)):e[i].Handle.progressBar.finishEvent.push(function(e){return function(e){t&&t.readyForNext&&t.readyForNext()}}(e[i].Handle));e[0].Handle.progressBar.start()}},e}();c3tenantPreUpgrade.step1=function(){function d(e){for(var t=0;t<l.length;t++)if(l[t].SUID=i.HostingUnitId){if(l[t].Tenants.length>0)for(var n=0;n<l[t].Tenants.length;n++)if(l[t].Tenants[n].ID==e.ID){l[t].Tenants.remove(n);break}break}}function v(e){if(l.length==0)l.push({SUID:i.HostingUnitId,Tenants:[e]});else{var t=!1;for(var n=0;n<l.length;n++)if(l[n].SUID==i.HostingUnitId){if(l[n].Tenants.length>0){var r=!1;for(var s=0;s<l[n].Tenants.length;s++)if(l[n].Tenants[s].ID==e.ID){r=!0;break}r==0&&l[n].Tenants.push(e)}else l[n].Tenants.push(e);t=!0;break}t||l.push({SUID:i.HostingUnitId,Tenants:[e]})}}function m(){var e="serviceUnit_toolbar",t=$("<section>").attr({id:e}).addClass("tools"),n=$("<div>").addClass("dropdown_list_wrap").css("float","left");u=$("<select>").css("width","200px"),u.change(function(){f=u.val(),w(parseInt(f)),i.HostingUnitId=parseInt(f)}),o=$("<span>").css("float","left").css("font-weight","bold").css("font-size","12px"),n.append(u);var r=$("<input>").attr("type","textbox").css("float","right").css("width","130px"),s=$("<a>").attr({href:"#"}).addClass("refresh").css("float","right");return s.click(function(){b()}),t.append(n),t.append($("<span>").html("&nbsp;&nbsp;").css("float","left")),t.append(o),t.append(s),t.append($("<span>").html("&nbsp;&nbsp;").css("float","right")),self.toolbar=t,t}function g(){c3.service.getHostingUnits().filter("Status eq 'Online' and Purpose ne 'Staging'").expand("CommonDatabase/DatabaseInstance").query(function(e){if(e!=null&&e.data!=null){a=[],u.find("option").remove();for(var t=0;t<e.data.length;t++){var n=$("<option>").attr({text:e.data[t].Name,value:e.data[t].ID});u.append(n),a.push({ID:e.data[t].ID,Name:e.data[t].Name,Version:e.data[t].Version,DBType:e.data[t].CommonDatabase.DatabaseInstance.ServerType})}i.HostingUnitId!=null&&i.HostingUnitId>0?(u.val(String(i.HostingUnitId)),f=String(i.HostingUnitId),i.HostingUnitId=parseInt(u.val()),i.HostingUnitId=isNaN(i.HostingUnitId)?0:i.HostingUnitId):(f=u.val(),i.HostingUnitId=parseInt(u.val()));for(var t=0;t<a.length;t++)f==String(a[t].ID)&&(o.empty(),o.append(localizedString("MISC_VERSION")+": "+a[t].Version),r.Version=a[t].Version,r.DBType=a[t].DBType);b()}})}function y(){while(r.TenantList.length>0)r.TenantList.remove(0)}this.base=c3.module,this.base(),this._container=$("<div>");var e=localizedString("PREUPGRADE_LABEL_TNTLIST"),t=[localizedString("PREUPGRADE_LABEL_UPGTNTS")],n=[{name:"Name",description:localizedString("TENANT"),type:"text",width:"60px"},{name:"status",description:localizedString("MISC_STATUS"),type:"text",width:"70px"},{name:"LifeCycleStatus",description:localizedString("PREUPGRADE_LABEL_LSTATUS"),type:"text",width:"110px"},{name:"CustomerName",description:localizedString("CUSTOMER"),type:"text",width:"70px"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"120px"}],r=arguments[0]||{},i=arguments[1]||null,s=arguments[2]||null;r.TenantList=[];var o=null,u=null,a=[],f=null,l=[],c=null,h=[],p={getHeaderSpec:function(){return n},getRowCount:function(){return h.length},getRow:function(e){return h[e]},getGridHeight:function(){return 310},getCell:function(){var e=null;if(this.colName=="status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],t.showText=!1,e=new statusControl(t)}return e}};this.onInit=function(){var e=$("<div>"),t=$("<div>");c=t.gridview({delegate:p,checkType:1}),c.rowCheckEvent.push(function(){var e=this.index,t=h[e];if(this.isChecked){var n=!1;for(var i=0;i<r.TenantList.length;i++){var s=r.TenantList[i];if(s.ID==t.ID){n=!0;break}}n||r.TenantList.push(t),v(t)}else for(var i=0;i<r.TenantList.length;i++){var s=r.TenantList[i];if(s.ID==t.ID){r.TenantList.remove(i),d(t);break}}E()}),c.rowSelectedEvent.push(function(){var e=this.index,t=this.data}),c.show(),e.append(t),this._container.append(m()),this._container.append(e)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){g()}),cometdManager.subscribe(sldEntitySet.Tenants,function(e){b()})},this.onViewAppear=function(){g(),E()};var b=function(){h=[],null!=i&&i.results!=null&&i.results.length>0&&i.HostingUnitId>0?w(parseInt(i.HostingUnitId)):f!=null&&f.length>0?w(parseInt(f)):c.reload()},w=function(e){if(isNaN(e)){h=[],c.reload(),E();return}if(o!=null&&a.length>0)for(var t=0;t<a.length;t++)e==a[t].ID&&($(o).text(localizedString("MISC_VERSION")+": "+a[t].Version),r.Version=a[t].Version,r.DBType=a[t].DBType);y(),c3.service.getHostingUnits(e).expand("Tenants/Customer,Tenants/CompanyDatabase").query(function(t){h=[];var n=!1;if(t!=null&&t.data!=null&&t.data.Tenants!=null&&t.data.Tenants.results!=null&&t.data.Tenants.results.length>0){if(t.data["Status"]!="Online"){self.suSelect&&w(parseInt(self.suSelect.val()));return}var o=t.data.Tenants.results;if(o!=null&&o.length>0)for(var u=0;u<o.length;u++)if(o[u].Status=="Online"&&o[u].LifeCycleStatus=="Running"){var a="";o[u].Customer&&(a=o[u].Customer.Name),h.push({status:o[u].Status,Name:o[u].CompanyDatabase.CompanyName,ID:o[u].ID,CompanyDatabase:o[u].CompanyDatabase,Purpose:o[u].Purpose,CustomerName:a,LifeCycleStatus:o[u].LifeCycleStatus}),s&&o[u].ID==s.ID&&(n=!0)}}p.getDefaultSelectedIndex=function(){if(l.length==0){if(i&&s&&s.ID>0&&h.length>0&&n){for(var t=0;t<h.length;t++)if(h[t].ID==s.ID){var o=!1;for(var u=0;u<r.TenantList.length;u++)if(r.TenantList[u].ID==h[t].ID){o=!0;break}return o||r.TenantList.push(h[t]),v(h[t]),E(),s=null,t}return 0}p.getDefaultSelectedIndex=function(){return-1}}else for(var t=0;t<l.length;t++)if(l[t].SUID==e){var a=l[t].Tenants,f=[];for(var u=0;u<a.length;u++)for(var c=0;c<h.length;c++)if(a[u].ID==h[c].ID){f.push(c);var o=!1;for(var d=0;d<r.TenantList.length;d++)if(r.TenantList[d].ID==h[c].ID){o=!0;break}o||r.TenantList.push(h[c]);break}return f.length>0?f:-1}},c.reload(),E()})},E=function(){if(r&&r.readyForNext){if(r.TenantList==null||r.TenantList.length==0){r.disableNext();return}r.readyForNext()}}},c3tenantPreUpgrade.step2=function(){function a(){var t="targetVersion_toolbar",n=$("<section>").attr({id:t}).addClass("tools"),r=$("<input>").attr({value:localizedString("MISC_NEW"),type:"button",id:"preUpgrade_btnNew"}).css("float","left");r.click(function(){var t=new c3newSWRepository(e);t.show()}),n.append(r);var i=$("<a>").attr({href:"#"}).addClass("refresh").css("float","right");return i.click(function(){f()}),n.append(i),e.toolbar=n,n}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t="Upgrade Version List",n=[{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"120px"},{name:"NoOfSU",description:localizedString("PREUPGRADE_LABEL_NOOFSU"),type:"text",width:"160px"}],r=arguments[0]||{},i=arguments[1]||null,s=null,o=[],u={getHeaderSpec:function(){return n},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 310},getTip:function(){return Utility.CreateTipBoard(localizedString("PREUPGRADE_LABEL_UPGV"),function(){var t=new c3newSWRepository(e);t.show()})},getCell:function(){if(this.colName=="NoOfSU"){var e=$("<Label>"),t=o[this.row];return tenantManager.getNumberOfServiceUnitBySoftwareRepositoryID(t.ID,function(t){e.text(t.data)}),e}}};this.onInit=function(){var t=$("<div>");s=t.gridview({delegate:u}),s.rowSelectedEvent.push(function(){var e=this.index,t=o[e];r.TargetVersionIPR=t.ID,l()}),s.show(),e._container.append(a()),e._container.append(t)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.SoftwareRepositories,function(e){f()})},this.onViewAppear=function(){r.TargetVersionIPR=null,f(),l()};var f=function(){o=[],s.reload(),c3.service.getSWRepositories().query(function(e){if(e&&e.data&&e.data.length>0){var t=[];for(var n in e.data){var i=isHANA(r.DBType)&&e.data[n].HANAenabled||isMSSQL(r.DBType)&&e.data[n].SQLenabled?!0:!1;r.Version&&e.data[n].Version>r.Version&&i&&t.push(e.data[n])}o=t,s.reload()}})},l=function(){r&&r.readyForNext&&(r.TargetVersionIPR&&r.TargetVersionIPR>0?r.readyForNext():r.disableNext())};e.reload=function(){this.onViewAppear()}},c3tenantPreUpgrade.step3=function(){this.base=c3.module,this.base(),this._container=$("<div>");var delegate=arguments[0]||{},tenants=arguments[1]||null,strBodyHeader=localizedString("STARTTESTING_TLT_PTP"),pColHeaders=[{name:"Name",description:localizedString("HU_GD_NAME"),type:"text",width:"25%"},{name:"Errors",description:localizedString("ERRORS"),type:"text",width:"15%"},{name:"Warnings",description:localizedString("WARNINGS"),type:"text",width:"15%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"45%"}],gridView=null,gridData=[],subDelegates=[],taskList=[],errorsDomList=[],warningsDomList=[],subtask_dom_list=[],warning_sub_dom_list=[],error_sub_dom_list=[],companyCount=0,count=0,gridDelegate={disableSort:function(){return!0},getHeaderSpec:function(){return pColHeaders},getRowCount:function(){return gridData.length},getRow:function(e){return gridData[e]},getGridHeight:function(){return 340},getCell:function(){if(this.colName=="Errors"){var errors=$("<label>");return errorsDomList.push({RowIndex:this.row,Cell:errors}),errors}if(this.colName=="Warnings"){var warnings=$("<label>");return warningsDomList.push({RowIndex:this.row,Cell:warnings}),warnings}if(this.colName=="Result"){var cellContent=$("<div>"),container=this,targetVersionIPR=delegate.TargetVersionIPR,tenantId=this.data.ID,ProgressHandles=[],rowIndex=this.row;return c3.service.PreUpgradeTesting(this.data.CompanyDatabase.ID,targetVersionIPR,{success:function(result,status){var tskid=0;"ERROR"==status.toUpperCase()||"CANCELLED"==status.toUpperCase()||"ROLLBACK"==status[0].toUpperCase()?(delegate.readyForNext(),function(e){e.c3progress(function(){this.setFailed()},{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0})}(cellContent)):"SUCCESS"==status.toUpperCase()&&(tskid=result.d.PreUpgradeTestingAsync,taskList.push({tenantId:tenantId,taskId:tskid}),ProgressHandles.push(function(e){return e.c3progress(function(e){return function(){return getProgress(this,e,container)}}(tskid),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0})}(cellContent)));for(var i=0,ii=ProgressHandles.length;i<ii;i++)0==i&&ProgressHandles[i].start(),i<ii-1?ProgressHandles[i].finishEvent.push(function(e){return function(t){e.start()}}(ProgressHandles[i+1])):ProgressHandles[i].finishEvent.push(function(handler){return function(e){count--,delegate&&delegate.readyForNext&&count==0&&delegate.readyForNext(),c3.service.getTasks(tskid).expand("SubTasks").query(function(result){if(result.data&&result.data.SubTasks&&result.data.SubTasks.results&&result.data.SubTasks.results.length>0){var subtaskid=result.data.SubTasks.results[1].ID;c3.service.getTaskResult(subtaskid).query(function(result){if(result!=null&&result.data!=null&&result.data.GetResult!=null){var errorArray=eval(result.data.GetResult),errorsCount=0,warningsCount=0;if(errorArray!=null&&errorArray.length>0){var text=localizedString("MISC_SUCCESS");for(var index=0;index<errorArray.length;index++){if(errorArray[index].Type=="Error"){text=localizedString("MISC_ERROR");break}errorArray[index].Type=="Warning"&&(text=localizedString("MISC_WARNING"))}for(var index in errorArray)errorArray[index].Type=="Error"?errorsCount++:errorArray[index].Type=="Warning"&&warningsCount++;var span=$("<a>").attr({href:"#"}).text(text);span.click(function(){var e=new c3tenantPreUpgrade_errorMessage(this,errorArray,tenantId);e.show()}),$(cellContent).find("#errorLabel").remove(),$(cellContent).append(span)}if(errorsDomList&&errorsDomList.length>0)for(var idx in errorsDomList)if(errorsDomList[idx].RowIndex==rowIndex){$(errorsDomList[idx].Cell).text(errorsCount);break}if(warningsDomList&&warningsDomList.length>0)for(var idx in warningsDomList)if(warningsDomList[idx].RowIndex==rowIndex){$(warningsDomList[idx].Cell).text(warningsCount);break}}})}})}}(ProgressHandles[i]))},error:function(e){count--;var t=cellContent.c3progress(function(){return function(){t.setFailed(localizedString("TRIAL_SELECT_FAILED"))}}(),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0});return t.start(),cellContent}}),cellContent}}};this.onInit=function(){delegate.disableBack();var e=$("<div>"),t=$("<div>");gridView=t.gridview({delegate:gridDelegate}),gridView.show(),e.append(t),LoadData(),this._container.append(e),delegate.disableCancel(),delegate.disableNext()},this.onViewAppear=function(){};var counter=0,TenantCounter=0,getProgress=function(progressBar,tid,rowContainer){c3.service.getTaskProgress(tid).query(function(result){var status=result.data.GetTaskProperties.split(",");"FAILED"==status[0].toUpperCase().toUpperCase()||"CANCELLED"==status[0].toUpperCase()||"ROLLBACK"==status[0].toUpperCase()?c3.service.getTasks(tid).expand("SubTasks").query(function(e){if(e.data&&e.data.SubTasks&&e.data.SubTasks.results&&e.data.SubTasks.results.length>0){var t=e.data.SubTasks.results[1].ID;c3.service.getTasks(tid).expand("TaskParameters").query(function(e){progressBar.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)})}}):"SUCCESSFUL"==status[0].toUpperCase()?c3.service.getTasks(tid).expand("SubTasks").query(function(result){if(result.data&&result.data.SubTasks&&result.data.SubTasks.results&&result.data.SubTasks.results.length>0){var subtaskid=result.data.SubTasks.results[1].ID;c3.service.getTaskResult(subtaskid).query(function(result1){if(result1!=null&&result1.data!=null&&result1.data.GetResult!=null){var errorArray=eval(result1.data.GetResult),msg="";if(errorArray&&errorArray.length>0)for(var k=0;k<errorArray.length;k++)errorArray[k].Type=="Warning"&&(msg+=errorArray[k].Description+"\r\n");msg!=""&&msg.length>0?progressBar.setWarning(msg):progressBar.setValue(100)}}),rowContainer.data.errorLabel!=null&&rowContainer.data.errorLabel.text(0)}}):progressBar.setValue(parseInt(status[1]))})},LoadData=function(){delegate&&delegate.TenantList&&(gridData=delegate.TenantList,count=delegate.TenantList.length,gridView.reload())}};var c3UpgradeType={Standard:"Standard",Simulation:"Simulation"};c3tenantUpgrade.chooseTenants=function(){function d(e){for(var t=0;t<l.length;t++)if(l[t].SUID=i.HostingUnitId){if(l[t].Tenants.length>0)for(var n=0;n<l[t].Tenants.length;n++)if(l[t].Tenants[n].ID==e.ID){l[t].Tenants.remove(n);break}break}}function v(e){if(l.length==0)l.push({SUID:i.HostingUnitId,Tenants:[e]});else{var t=!1;for(var n=0;n<l.length;n++)if(l[n].SUID==i.HostingUnitId){if(l[n].Tenants.length>0){var r=!1;for(var s=0;s<l[n].Tenants.length;s++)if(l[n].Tenants[s].ID==e.ID){r=!0;break}r==0&&l[n].Tenants.push(e)}else l[n].Tenants.push(e);t=!0;break}t||l.push({SUID:i.HostingUnitId,Tenants:[e]})}}function m(){var e="serviceUnit_toolbar",t=$("<section>").attr({id:e}).addClass("tools"),n=$("<div>").addClass("dropdown_list_wrap").css("float","left"),r=$("<select>").css("width","200px");r.change(function(){f=r.val(),f!=""&&f.length>0&&(w(parseInt(f)),i.HostingUnitId=parseInt(f))}),o=$("<span>").css("float","left").css("font-weight","bold").css("font-size","12px"),a.suSelect=r,n.append(r);var s=$("<input>").attr("type","textbox").css("float","right").css("width","130px"),u=$("<a>").attr({href:"#"}).addClass("refresh").css("float","right");return u.click(function(){b()}),t.append(n),t.append($("<span>").html("&nbsp;&nbsp;").css("float","left")),t.append(o),t.append(u),t.append($("<span>").html("&nbsp;&nbsp;").css("float","right")),a.toolbar=t,t}function g(){c3.service.getHostingUnits().filter("Status eq 'Online' and Purpose ne 'Staging'").query(function(e){if(e!=null&&e.data!=null){u=[],a.suSelect.find("option").remove();for(var t=0;t<e.data.length;t++){var n=$("<option>").attr({text:e.data[t].Name,value:e.data[t].ID});a.suSelect.append(n),u.push({ID:e.data[t].ID,Name:e.data[t].Name,Version:e.data[t].Version})}i.HostingUnitId!=null&&i.HostingUnitId>0?(a.suSelect.val(String(i.HostingUnitId)),f=String(i.HostingUnitId),i.HostingUnitId=parseInt(a.suSelect.val()),i.HostingUnitId=isNaN(i.HostingUnitId)?0:i.HostingUnitId):(f=a.suSelect.val(),i.HostingUnitId=parseInt(a.suSelect.val()));for(var t=0;t<u.length;t++)f==String(u[t].ID)&&(o.empty(),o.append(localizedString("COLUMN_VERSION")+": "+u[t].Version),r.Version=u[t].Version);b()}})}function y(){while(r.TenantList.length>0)r.TenantList.remove(0)}function S(e){if(e==r.TenantList.length){b(r.next);return}if(r.TenantList[e].isHANA){S(++e);return}c3.service.getActiveConnections(r.TenantList[e].CompanyDatabase.ID,function(t){if(t.d&&t.d.results&&t.d.results.length>0){var n=t.d.results.length;if(n>0){var i=$("<div>").append(localizedString("TNT_UPGRADE_STEP1_COFIRM_MSG")),t=MessageBox.show({msg:i,width:420,height:180,icon:MessageBoxIcon.WARNING});t.yesEvent.push(function(){r.next()}),b();return}}S(++e)})}this.base=c3.module,this.base(),this._container=$("<div>");var e=localizedString("PREUPGRADE_LABEL_TNTLIST"),t=[localizedString("PREUPGRADE_LABEL_UPGTNTS")],n=[{name:"status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("TENANT"),type:"text",width:"15%"},{name:"ActiveConnection",description:localizedString("ATVCONCTION_POPWIN_BODY_TLT"),type:"text",width:"30%"},{name:"CustomerName",description:localizedString("CUSTOMER"),type:"text",width:"25%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"20%"}],r=arguments[0]||{},i=arguments[1]||null,s=arguments[2]||null;r.TenantList=[];var o=null,u=[],a=this,f=null,l=[],c=null,h=[],p={getHeaderSpec:function(){return n},getRowCount:function(){return h.length},getRow:function(e){return h[e]},getGridHeight:function(){return 280},getCell:function(){var e=null;if(this.colName=="status"){var t={};t.text=this.data[this.colName],t.showText=!1,e=new statusControl(t)}else if(this.colName=="ActiveConnection"){var n=$("<a>").attr({href:"#"}).text("0"),r=this.data;return this.data.isHANA||c3.service.getActiveConnections(this.data.CompanyDatabase.ID,function(e){if(e.d&&e.d.results&&e.d.results.length>0){var t=e.d.results.length;$(n).text(t),r.ActiveConnection=t,$(n).click(function(){var t=new c3activeConnections(a,e.d.results);t.show()})}}),n}return e}};this.onInit=function(){var e=$("<div>"),t=$("<div>");c=t.gridview({delegate:p,checkType:1}),c.rowCheckEvent.push(function(){var e=this.index,t=h[e];if(this.isChecked){var n=!1;for(var i=0;i<r.TenantList.length;i++){var s=r.TenantList[i];if(s.ID==t.ID){n=!0;break}}n||r.TenantList.push(t),v(t)}else for(var i=0;i<r.TenantList.length;i++){var s=r.TenantList[i];if(s.ID==t.ID){r.TenantList.remove(i),d(t);break}}E()}),c.rowSelectedEvent.push(function(){var e=this.index,t=this.data}),c.show();var n=$("<div>").css("padding-top","5px").append("* "+localizedString("TNT_UPGRADE_STEP_TIPMSG"));e.append(t),this._container.append(m()),this._container.append(e),this._container.append(n)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){g()}),cometdManager.subscribe(sldEntitySet.Tenants,function(e){b()})},this.onViewAppear=function(){r.UpgradeType==c3UpgradeType.Simulation?(r.disableStep([r.stepsIdx.CHOOSE_STAGING_SU]),r.disableStep([r.stepsIdx.PRE_UPGRADE_TESTING])):(r.enableStep([r.stepsIdx.CHOOSE_STAGING_SU]),r.enableStep([r.stepsIdx.PRE_UPGRADE_TESTING])),r.DatabaseNameList=[],g(),E()};var b=function(){var e=arguments[0]||null;h=[],null!=i&&i.results!=null&&i.results.length>0&&i.HostingUnitId>0?w(parseInt(i.HostingUnitId),e):f!=null&&f.length>0?w(parseInt(f),e):(c.reload(),e!=null&&e())},w=function(e,t){function f(e){var t={};for(var n in e)typeof e[n]=="object"?t[n]=f(e[n]):typeof e[n]!="function"&&(t[n]=e[n]);return t}if(isNaN(e)){h=[],c.reload(),E();return}if(o!=null&&u.length>0)for(var n=0;n<u.length;n++)e==u[n].ID&&($(o).text(localizedString("COLUMN_VERSION")+": "+u[n].Version),r.Version=u[n].Version);y();if(isNaN(e)||e<=0){h=[],c.reload(),t!=null&&t();return}c3.service.getHostingUnits(e).expand("Tenants/Customer,Tenants/CompanyDatabase,LicenseServer,SoftwareRepository").query(function(n){h=[];var o=!1;if(n!=null&&n.data!=null&&n.data.Tenants!=null&&n.data.Tenants.results!=null&&n.data.Tenants.results.length>0){if(n.data["Status"]!="Online"){a.suSelect&&w(parseInt(a.suSelect.val()));return}var u=n.data.Tenants.results;if(u!=null&&u.length>0)for(var d=0;d<u.length;d++)if(u[d].Status=="Online"&&u[d].LifeCycleStatus=="Running"){var m="";u[d].Customer&&(m=u[d].Customer.Name),h.push({status:u[d].Status,Name:u[d].CompanyDatabase.CompanyName,DBName:u[d].CompanyDatabase.Name,ID:u[d].ID,CompanyDatabase:u[d].CompanyDatabase,Purpose:u[d].Purpose,CustomerName:m,LifeCycleStatus:u[d].LifeCycleStatus,LicenseServerID:n.data.LicenseServer.ID,ServiceUnitName:n.data.Name,ServiceUnitVersion:n.data.Version,ServiceUnitPurpose:n.data.Purpose,ServiceUnitStatus:n.data.Status,isHANA:n.data.SoftwareRepository.HANAenabled}),s&&u[d].ID==s.ID&&(o=!0)}}p.getDefaultSelectedIndex=function(){if(l.length==0){if(i&&s&&s.ID>0&&h.length>0&&o){for(var t=0;t<h.length;t++)if(h[t].ID==s.ID)return r.TenantList.push(f(h[t])),v(h[t]),E(),s=null,t;return 0}p.getDefaultSelectedIndex=function(){return-1}}else for(var t=0;t<l.length;t++)if(l[t].SUID==e){var n=l[t].Tenants,u=[];for(var a=0;a<n.length;a++)for(var c=0;c<h.length;c++)if(n[a].ID==h[c].ID){u.push(c),r.TenantList.push(f(h[c]));break}return u.length>0?u:-1}},c.reload(),E(),t!=null&&t()})},E=function(){if(r&&r.readyForNext){if(r.TenantList==null||r.TenantList.length==0){r.disableNext();return}r.readyForNext()}};this.validator=new function(){var e=[],t=function(){if(r.TenantList.length==0)return!1;S(0)};this.checkValidity=t}},c3tenantUpgrade.targetSU=function(){function a(){var t="targetSU_toolbar",n=$("<section>").attr({id:t}).addClass("tools"),r=$("<input>").attr({value:"New",type:"button",id:"su_btnNew"}).css("float","left");r.click(function(){var t=new c3huwizard(e);t.show()}),c3.hasPermission([permissionItems.operator])&&n.append(r);var i=$("<a>").attr({href:"#"}).addClass("refresh").css("float","right");return i.click(function(){f()}),n.append(i),e.toolbar=n,n}function c(t,n,i){c3.service.CheckDatabaseExist(t,n,function(t){if(t.d&&t.d.CheckDatabaseExist==1){var s=!1;for(var o=0;o<r.DatabaseNameList.length;o++)if(r.DatabaseNameList[o].TenantID==i){s=!0;break}s||r.DatabaseNameList.push({TenantID:i,CurDBName:n,NewDBName:null,DBInstID:r.TargetServiceUnit.CommonDatabase.DatabaseInstance.ID})}e.checkCount++;if(e.checkCount==r.TenantList.length){e.checkCount=0;if(r.DatabaseNameList.length>0){var u=new c3changeDBName(e,r.DatabaseNameList);u.show(),u.finishEvent.push(function(){c3.service.getUndeloyedExtensionsForTenantUpgrade(e.tenantIDList,r.TargetServiceUnit.ID,function(e){h(e)})})}else c3.service.getUndeloyedExtensionsForTenantUpgrade(e.tenantIDList,r.TargetServiceUnit.ID,function(e){h(e)})}})}function h(t){var n=[];if(t!=null&&t.d!=null){var i=c3.service.convertData(t.d.results);for(var s=0;s<i.length;s++)n.push({Name:i[s].ExtensionName,Version:i[s].ExtensionVersion,Vendor:i[s].ExtensionVendor,Type:convertToDisplayExtensionType(i[s].ExtensionType),Warning:localizedString("TNT_UPGRADE_EXT_WARNING_"+i[s].ErrorCode)})}e.lwindow.close();if(n!=null&&n.length>0){var o=$("<section>").css({"margin-top":"5px"}),u=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"25%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"20%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"20%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"15%"},{name:"Warning",description:localizedString("MISC_WARNING"),type:"text",width:"20%"}],a={needExport:function(){return!1},getHeaderSpec:function(){return u},getRowCount:function(){return n.length},getRow:function(e){return n[e]},getGridHeight:function(){return 130},getNotAllowedSelected:function(){return!0},getCell:function(){if(this.colName=="Warning"){var e=this.data,t=$("<div>").addClass("warningMessage").attr({title:localizedString("MISC_WARNING")}),n=$("<a>").attr({href:"#",title:localizedString("MISC_WARNING")}).text(localizedString("MISC_WARNING"));return n.click(function(){var t=$(this).popupManager(200,120,!1,localizedString("MISC_WARNING"),!0),n=$("<div>").css({margin:"17px 0 0 10px",height:"80",overflow:"auto"}).append(e.Warning);t.append(n),t.show()}),t.append(n),t}}},f=$(o).gridview({delegate:a,checkType:0});f.show();var l=$("<div>").append(localizedString("TNT_UPGRADE_STEP2_ADDONCHECK")),c=$("<hr>"),h=$("<div>").append(l).append(c).append(o),t=MessageBox.confirm({msg:h,width:500,height:300});t.yesEvent.push(function(){r.next()})}else r.next()}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t="Upgrade Service Unit List",n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"13%"},{name:"Name",description:localizedString("HOSTUNIT"),type:"text",width:"20%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"20%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"20%"},{name:"NoOfTenant",description:localizedString("TNTUPGRADE_LABEL_NOOFTNT"),type:"text",width:"27%"}],r=arguments[0]||{},i=arguments[1]||null;e.checkCount=0,e.tenantIDList=[],r.DatabaseNameList=[];var s=null,o=[],u={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 250},getTip:function(){return c3.hasPermission([permissionItems.operator])?Utility.CreateTipBoard(localizedString("HOSTUNIT"),function(){var t=new c3huwizard(e);t.show()}):Utility.CreateTipBoard(localizedString("HOSTUNIT"),!1,null)},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.showText=!1,e=new statusControl(t)}else if(this.colName=="NoOfTenant"){var n=$("<span>").text("0");return c3.service.getTenants().expand("CompanyDatabase").filter("ServiceUnit/ID eq "+this.data.ID).count().query(function(e){e.data&&e.data.length>0&&$(n).text(e.data)}),n}return e}};this.onInit=function(){var t=$("<div>");s=t.gridview({delegate:u}),s.rowSelectedEvent.push(function(){var e=this.index,t=o[e];r.TargetServiceUnit=t,r.TargetVersionIPR=t.SoftwareRepository.ID,r.TargetVersion=t.SoftwareRepository.Version,l()}),s.show(),e._container.append(a()),e._container.append(t),r.disableNext(),f()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){f()})},this.onViewAppear=function(){(r.lastLoadedUpgradeType!=r.UpgradeType||r.lastHanaEnabled!=r.TenantList[0].isHANA)&&f()};var f=function(){r.lastLoadedUpgradeType=r.UpgradeType,r.lastHanaEnabled=r.TenantList[0].isHANA,o=[],c3.service.getHostingUnits().expand("SoftwareRepository, LicenseServer, CommonDatabase/DatabaseInstance").filter("Status eq 'Online'  and Version gt '"+r.Version+"' and LicenseServer/Status eq 'Online' and LicenseServer/ID eq "+r.TenantList[0].LicenseServerID+(r.TenantList[0].isHANA!=null&&r.TenantList[0].isHANA==1?" and SoftwareRepository/HANAenabled eq true ":" and SoftwareRepository/SQLenabled eq true ")+(r.UpgradeType==c3UpgradeType.Simulation?"":" and Purpose ne 'Staging' ")).query(function(e){o=e.data,s.reload(),l()})},l=function(){r.TargetServiceUnit&&r.TargetServiceUnit.ID>0?r.readyForNext():r.disableNext()};this.validator=new function(){var t=[],n=function(){if(r.TargetServiceUnit==null||r.TargetServiceUnit.ID==null){r.disableNext();return}if((r.UpgradeType==null||r.UpgradeType==c3UpgradeType.Standard)&&r.TargetServiceUnit.Purpose=="Staging"){r.disableNext();return}var t=[];e.lwindow=new loadingWindow,e.lwindow.show();for(var n=0;n<r.TenantList.length;n++){var i=r.TenantList[n].ID;e.tenantIDList.push(i),c(r.TargetServiceUnit.CommonDatabase.DatabaseInstance.ID,r.TenantList[n].DBName,r.TenantList[n].ID)}e.lwindow.close()};this.checkValidity=n},e.reload=function(){this.onViewAppear()}},c3tenantUpgrade.stagingSU=function(){function a(){var t="stagingSU_toolbar",n=$("<section>").attr({id:t}).addClass("tools"),r=$("<input>").attr({value:"New",type:"button",id:"su_btnNew"}).css("float","left");r.click(function(){var t=new c3huwizard(e);t.show()}),c3.hasPermission([permissionItems.operator])&&n.append(r);var i=$("<a>").attr({href:"#"}).addClass("refresh").css("float","right");return i.click(function(){c()}),n.append(i),e.toolbar=n,n}function f(e){var t=!1,n=0,i=function(i){c3.service.getTenants(i).expand("Customer/Reseller").query(function(i){n++,i.data&&i.data.Customer&&i.data.Customer.Reseller?c3.service.getServiceUnitsOfReseller(i.data.Customer.Reseller.ID,{success:function(i){if(i&&i.d&&i.d.results&&i.d.results.length>0)for(var s=0;s<i.d.results.length;s++){var o=i.d.results[s];r.TargetServiceUnit.ID==o.ID&&(t=!0)}n==r.chosenTenants.length&&e(t)}}):n==r.chosenTenants.length&&(null==i.data.Customer.Reseller&&(t=!0),e(t))})};if(r.chosenTenants!=undefined&&r.chosenTenants.length>0)for(var s=0;s<r.chosenTenants.length;s++)i(r.chosenTenants[s].ID);else e(t)}function l(){if(e.useStagingSURadio&&e.useStagingSURadio.attr("checked")==1&&!r.StagingServiceUnit){r.disableNext();return}r.readyForNext()}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=localizedString("TNTUPGRADE_STEP_STAGINGSU_TLT"),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"13%"},{name:"Name",description:localizedString("HOSTUNIT"),type:"text",width:"20%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"20%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"20%"},{name:"NoOfTenant",description:localizedString("TNTUPGRADE_LABEL_NOOFTNT"),type:"text",width:"27%"}],r=arguments[0]||{},i=arguments[1]||null,s=null,o=[],u={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 240},getTip:function(){return Utility.CreateTipBoard(localizedString("TNTUPGRADE_STAGINGSU_EMPTY_TIP"),!1,null)},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.showText=!1,e=new statusControl(t)}else if(this.colName=="NoOfTenant"){var n=$("<span>").text("0");return c3.service.getTenants().filter("ServiceUnit/ID eq "+this.data.ID).count().query(function(e){e.data&&e.data.length>0&&$(n).text(e.data)}),n}return e}};this.onInit=function(){var t=$("<div>"),n=$("<div>");s=n.gridview({delegate:u}),s.rowSelectedEvent.push(function(){var e=this.index,t=o[e];r.StagingServiceUnit=t,l()}),s.show();var i=$("<input>").attr({type:"radio",name:"useStaging"});i.click(function(){r.StagingServiceUnit=null,t.css("display","none"),l()});var f=$("<div>").css({padding:"13px 0 2px 5px"}).append(i).append("&nbsp;&nbsp;&nbsp;").append($("<span>").append(localizedString("TNTUPGRADE_STEP_STAGINGSU_USESTAGING")));e._container.append(f),i.click(),e.useTargetSURadio=i;var h=$("<input>").attr({type:"radio",name:"useStaging"});h.click(function(){t.css("display","block"),r.StagingServiceUnit=null,c()});var p=$("<div>").css({padding:"2px 0 13px 5px"}).append(h).append("&nbsp;&nbsp;&nbsp;").append($("<span>").append(localizedString("TNTUPGRADE_STEP_STAGINGSU_NOTUSE")));e._container.append(p),e.useStagingSURadio=h,t.append(a()),t.append(n),e._container.append(t)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(t){e.useStagingSURadio.attr("checked")==1&&c()})},this.onViewAppear=function(){l()};var c=function(){o=[],c3.service.getHostingUnits().expand("SoftwareRepository, LicenseServer, CommonDatabase/DatabaseInstance").filter("Status eq 'Online' and Version eq '"+r.TargetVersion+"' and Purpose eq 'Staging'").query(function(e){for(var t=0;t<e.data.length;t++)e.data[t].CommonDatabase.DatabaseInstance.ServerType==r.TargetServiceUnit.CommonDatabase.DatabaseInstance.ServerType&&o.push(e.data[t]);s.reload(),l()})};e.reload=function(){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),e.useStagingSURadio.attr("checked")==1&&c()),this.onViewAppear(),l()};var h={validEvent:[],checkValidity:function(){r.disableNext();var e=function(e){if(!e){var t=new MessageBox.confirm(localizedString("TENANT_UPGRADE_ASSIGN_SU"));t.yesEvent.push(function(){r.next()}),t.noEvent.push(function(){r.readyForNext()})}else r.next()};f(e)}};this.validator=h},c3tenantUpgrade.preUpgradeTesting=function(){function createToolBar(){var e="preupgrade_toolbar",t=$("<section>").attr({id:e}).addClass("tools"),n=$("<input>").attr({value:localizedString("TNTUPGRADE_BTN_STARTTESTING"),type:"button",id:"btnStart"}).css("float","left");n.click(function(){var e=[];for(var t=0;t<self.PreUpgradeRecords.length;t++)self.PreUpgradeRecords[t].TaskID==null&&e.push(cloneObject(self.PreUpgradeRecords[t]));var n=new c3startTesting(e,self,delegate.TargetVersionIPR);n.show()});var r=$("<a>").attr({href:"#"}).addClass("refresh").css("float","right");return r.click(function(){LoadData()}),t.append(n),t.append(r),self.toolbar=t,t}function cloneObject(e){if(null==e)return null;var t={};for(var n in e)typeof e[n]=="object"?t[n]=cloneObject(e[n]):typeof e[n]!="function"&&(t[n]=e[n]);return t}function GetLatestPreUpgradeResult(data){tenantManager.getLastPreUpgradeTestingResult(data.CompanyID,delegate.TargetVersion,!0,function(result){data.Errors=null,data.Warnings=null,data.PUResult=null,data.TaskID=null;if(result.d&&result.d.GetLastPreUpgradeResult&&result.d.GetLastPreUpgradeResult.length>0){var resultData=eval("({"+result.d.GetLastPreUpgradeResult+"})");data.Errors=0,data.Warnings=0;if(resultData.Result&&resultData.Result.length>0)for(var i=0;i<resultData.Result.length;i++)resultData.Result[i].Type=="Error"?data.Errors++:resultData.Result[i].Type=="Warning"&&data.Warnings++;data.PUResult=resultData.Result}var taskQuery=c3.service.getTasks().filter("ResourceType eq 'Tenant' and ResourceID eq "+data.ID+" and TaskType eq 'PreUpgradeTenant' and Status eq 'Processing'");taskQuery.query(function(e){e!=null&&e.data!=null&&e.data.length>0&&(data.TaskID=e.data[0].ID,data.Errors=null,data.Warnings=null,data.PUResult=null),self.count++;if(self.count==self.ts.length){self.count=0,gridData=self.PreUpgradeRecords;for(var t=0;t<self.PreUpgradeRecords.length;t++)self.PreUpgradeRecords[t].TaskID>0&&self.countTask++;gridView.reload(),validate();return}})})}this.base=c3.module,this.base(),this._container=$("<div>");var self=this,strBodyHeader="Pre-Upgrade Testing",pColHeaders=[{name:"Name",description:localizedString("HU_GD_NAME"),type:"text",width:"25%"},{name:"Errors",description:localizedString("ERRORS"),type:"text",width:"15%"},{name:"Warnings",description:localizedString("WARNINGS"),type:"text",width:"15%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"45%"}],delegate=arguments[0]||{},tenants=arguments[1]||null;self.count=0,delegate.confirmCheckItems=[],self.errorItems=[],delegate.chosenTenants=[],self.countTask=null,self.ts=null;var gridView=null,gridData=[],gridDelegate={getHeaderSpec:function(){return pColHeaders},getRowCount:function(){return gridData.length},getRow:function(e){return gridData[e]},getGridHeight:function(){return 250},getTip:function(){return Utility.CreateTipBoard(localizedString("STARTTESTING_EMPTY_TIP_PART"),null,!0)},getCell:function(){var e=null,t=this;if(this.colName=="Result"){if(t.data.TaskID!=null&&t.data.TaskID>0){var n=$("<div>"),r=[];r.push(function(e){return e.c3progress(function(e){return function(){return getProgress(this,e,t)}}(t.data.TaskID),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0})}(n));for(var i=0,s=r.length;i<s;i++)0==i&&r[i].start(),i<s-1?r[i].finishEvent.push(function(e){return function(t){e.start()}}(r[i+1])):r[i].finishEvent.push(function(e){return function(e){self.countTask--,self.countTask==0&&(self.loadingWin=new loadingWindow,self.loadingWin.show(),setTimeout(function(){LoadData(!0),self.loadingWin!=null&&self.loadingWin.close()},5e3))}}(r[i]));return n}var o=$("<div>"),u=localizedString("MISC_SUCCESS");this.data.Errors!=null&&this.data.Errors>0?(u=localizedString("MISC_ERROR"),self.errorItems.push({TenantID:t.data.ID})):this.data.Warnings!=null&&this.data.Warnings>0&&(u=localizedString("MISC_WARNING"));var a=o.c3progress(function(e){return function(){e=="Error"?a.setFailed():e=="Warning"?a.setWarning():a.setValue(100)}}(u),{max:100,dur:c3config.Clocker-2,async:1,width:80,hwf:!0,showError:!0});a.start();if(delegate.confirmCheckItems.length>0)for(var i=0;i<delegate.confirmCheckItems.length;i++)if(t.data.ID==delegate.confirmCheckItems[i].TenantID&&delegate.confirmCheckItems[i].AllConfirmed==1)return u=localizedString("TNTUPGRADE_LABEL_CONFIRMED"),$("<a>").text(u);var f=$("<a>").attr({href:"#"}).text(u);return f.click(function(){var e=this,n=!1;u=="Warning"&&(n=!0);var r=new c3tenantPreUpgrade_errorMessage(this,t.data.PUResult,t.data.ID,n,delegate.confirmCheckItems);r.show(),r.finishEvent.push(function(){for(var n=0;n<delegate.confirmCheckItems.length;n++)t.data.ID==delegate.confirmCheckItems[n].TenantID&&delegate.confirmCheckItems[n].AllConfirmed==1&&$(e).unbind("click").removeAttr("href").text(localizedString("TNTUPGRADE_LABEL_CONFIRMED"));validate()})}),this.data.Errors==null&&this.data.Warnings==null?null:(o.append(f),o)}return e}},getProgress=function(progressBar,tid,rowContainer){c3.service.getTaskProgress(tid).query(function(result){var status=result.data.GetTaskProperties.split(",");"FAILED"==status[0].toUpperCase().toUpperCase()||"CANCELLED"==status[0].toUpperCase()||"ROLLBACK"==status[0].toUpperCase()?(self.loadingWin!=null&&self.loadingWin.close(),c3.service.getTasks(tid).expand("SubTasks").query(function(e){if(e.data&&e.data.SubTasks&&e.data.SubTasks.results&&e.data.SubTasks.results.length>0){var t=e.data.SubTasks.results[1].ID;c3.service.getTasks(tid).expand("TaskParameters").query(function(e){progressBar.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)})}})):"SUCCESSFUL"==status[0].toUpperCase()?(c3.service.getTasks(tid).expand("SubTasks").query(function(result){if(result.data&&result.data.SubTasks&&result.data.SubTasks.results&&result.data.SubTasks.results.length>0){var subtaskid=result.data.SubTasks.results[1].ID;c3.service.getTaskResult(subtaskid).query(function(result1){if(result1!=null&&result1.data!=null&&result1.data.GetResult!=null){var errorArray=eval(result1.data.GetResult),msg="";if(errorArray&&errorArray.length>0)for(var k=0;k<errorArray.length;k++)errorArray[k].Type=="Warning"&&(msg+=errorArray[k].Description+"\r\n");msg!=""&&msg.length>0?progressBar.setWarning(msg):progressBar.setValue(100)}})}}),rowContainer.data.errorLabel!=null&&rowContainer.data.errorLabel.text(0)):progressBar.setValue(parseInt(status[1]))})};this.onInit=function(){var e=$("<div>");gridView=e.gridview({delegate:gridDelegate,checkType:1}),gridView.rowCheckEvent.push(function(){var e=this.index,t=gridData[e];if(this.isChecked){var n=!1;for(var r=0;r<delegate.chosenTenants.length;r++){var i=delegate.chosenTenants[r];if(i.ID==t.ID){n=!0;break}}n||delegate.chosenTenants.push(cloneObject(t))}else for(var r=0;r<delegate.chosenTenants.length;r++){var i=delegate.chosenTenants[r];if(i.ID==t.ID){delegate.chosenTenants.remove(r);break}}validate()}),gridView.show(),self._container.append(createToolBar()),self._container.append(e);var t=$("<div>").html("<br/>* "+localizedString("TNT_UPGRADE_STEP5_TIPMSG"));self._container.append(t)},this.onViewAppear=function(){if(delegate.TenantList.length>0){self.ts=[];for(var e=0;e<delegate.TenantList.length;e++)self.ts.push(cloneObject(delegate.TenantList[e]))}delegate.disableNext(),LoadData(),delegate.confirmCheckItems=[]};var LoadData=function(){gridData=[],self.countTask=0,self.count=0,arguments[0]==1&&(self.countTask=-99),self.errorItems=[],delegate.chosenTenants=[];if(self.ts&&self.ts.length>0){self.PreUpgradeRecords=[];for(var e=0;e<self.ts.length;e++)self.PreUpgradeRecords.push({ID:self.ts[e].ID,CompanyID:self.ts[e].CompanyDatabase.ID,Name:self.ts[e].Name});for(var t=0;t<self.PreUpgradeRecords.length;t++)GetLatestPreUpgradeResult(self.PreUpgradeRecords[t])}else gridView.reload(),validate()},validate=function(){if(delegate.chosenTenants.length==0){delegate.disableNext();return}for(var e=0;e<delegate.chosenTenants.length;e++){if(delegate.chosenTenants[e].PUResult==null){delegate.disableNext();return}if(delegate.chosenTenants[e].Errors>0){delegate.disableNext();return}if(delegate.chosenTenants[e].Warnings>0){delegate.disableNext();if(!(delegate.confirmCheckItems.length>0))return;var t=!1;for(var n=0;n<delegate.confirmCheckItems.length;n++){delegate.chosenTenants[e].ID==delegate.confirmCheckItems[n].TenantID&&(t=!0);if(delegate.chosenTenants[e].ID==delegate.confirmCheckItems[n].TenantID&&delegate.confirmCheckItems[n].AllConfirmed==0){delegate.disableNext();return}delegate.chosenTenants[e].ID==delegate.confirmCheckItems[n].TenantID&&delegate.confirmCheckItems[n].AllConfirmed==1&&delegate.readyForNext()}if(!t){delegate.disableNext();return}}else delegate.readyForNext()}};self.reload=function(){LoadData()}},c3tenantUpgrade.processingUpgrade=function(){function c(){a=[],e.count=0;if(r.UpgradeType!=null&&r.UpgradeType==c3UpgradeType.Simulation){r.chosenTenants=[];for(var t=0;t<r.TenantList.length;t++)r.chosenTenants.push({ID:r.TenantList[t].ID,CompanyID:r.TenantList[t].CompanyDatabase.ID,Name:r.TenantList[t].Name})}s=r.chosenTenants.length;for(var t=0;t<r.chosenTenants.length;t++){var n={Name:r.chosenTenants[t].Name,ID:r.chosenTenants[t].ID,StagingSUID:r.StagingServiceUnit==null?null:r.StagingServiceUnit.ID,TargetSUID:r.TargetServiceUnit.ID};h(n,t)}}function h(t,n){var i=null;if(r.confirmCheckItems!=null&&r.confirmCheckItems.length>0)for(var s=0;s<r.confirmCheckItems.length;s++)if(r.confirmCheckItems[s].TenantID==t.ID&&r.confirmCheckItems[s].AllConfirmed==1&&r.confirmCheckItems[s].ConfirmItems.length>0){i=[];for(var o=0;o<r.confirmCheckItems[s].ConfirmItems.length;o++)i.push(parseInt(r.confirmCheckItems[s].ConfirmItems[o].CheckID))}var u=null;if(r.DatabaseNameList!=null&&r.DatabaseNameList.length>0)for(var s=0;s<r.DatabaseNameList.length;s++)r.DatabaseNameList[s].TenantID==t.ID&&r.DatabaseNameList[s].NewDBName!=null&&r.DatabaseNameList[s].NewDBName.length>0&&(u=r.DatabaseNameList[s].NewDBName);var f={};for(var s=0;s<r.TenantList.length;s++)if(r.TenantList[s].ID==t.ID){f.tenant={name:r.TenantList[s].Name,status:r.TenantList[s].status,purpose:r.TenantList[s].Purpose,customerName:r.TenantList[s].CustomerName,dbname:r.TenantList[s].DBName,newDBName:u},f.sourceServiceUnit={name:r.TenantList[s].ServiceUnitName,purpose:r.TenantList[s].ServiceUnitPurpose,status:r.TenantList[s].ServiceUnitStatus,version:r.TenantList[s].ServiceUnitVersion};break}f.targetServiceUnit={name:r.TargetServiceUnit.Name,status:r.TargetServiceUnit.Status,purpose:r.TargetServiceUnit.Purpose,version:r.TargetServiceUnit.Version},r.StagingServiceUnit!=null&&r.StagingServiceUnit.ID>0&&(f.stagingServiceUnit={name:r.StagingServiceUnit.Name,status:r.StagingServiceUnit.Status,purpose:r.StagingServiceUnit.Purpose,version:r.StagingServiceUnit.Version}),tenantManager.MoveAndUpgradeTenantAsync(t.ID,t.StagingSUID,t.TargetSUID,i,u,function(i,s){var o=0;if("SUCCESS"==s.toUpperCase())o=i.d.TenantUpgradeAsync;else if("ERROR"==s.toUpperCase()){r.readyForNext();return}c3.hasPermission([permissionItems.operator])?(t.TaskID=o,a.push(t),p(n,o)):c3.service.getTasks().filter("ID eq "+o).query(function(i){if(i.data!=null&&i.data.length>0){if(i.data[0].Status=="WaitingForApproval"){var s=$("<div>").attr("class","rar_request_panel").css({"line-height":"25px",margin:"0 20px 0 20px"}).append(localizedString("VARREQUEST_NEEDAPPROVE"));e._container.html(s),r.readyForNext();return}t.TaskID=o,a.push(t),p(n,o)}else t.TaskID=o,a.push(t),p(n,o)})},f,r.UpgradeType!=null&&r.UpgradeType==c3UpgradeType.Simulation)}function p(t,n){var i=[];o[t]={},o[t].getRow=function(e){return i[e]},o[t].getRowCount=function(){return i.length},o[t].getCell=function(){if(this.colName=="Result"){var e=this.data.TaskID,t=$("<div>"),n=this,r=this.row,i=[];e==0?function(e){e.c3progress(function(){this.setFailed()},{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0})}(t):i.push(function(t){return t.c3progress(function(e){return function(){return l(this,e,n)}}(e),{max:100,dur:c3config.Clocker-2,async:1,width:60,swf:!0,async:1,hwf:!0})}(t));for(var s=0,o=i.length;s<o;s++)0==s&&i[s].start(),s<o-1&&i[s].finishEvent.push(function(e){return function(t){e.start()}}(i[s+1]));return t}return null},c3.service.getSubTask(n).query(function(t){if(t.data&&t.data.length>0)for(var n=0;n<t.data.length;n++)i.push({Name:t.data[n].Description,TaskID:t.data[n].ID});e.count++,e.count==r.chosenTenants.length&&(u.show(),u.reload())})}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t="Upgrade",n=[{name:"Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"60%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"40%"}],r=arguments[0]||{},i=arguments[1]||null,s=0,o=[],u=null,a=[],f={needExport:function(){return!1},disableSort:function(){return!0},getHeaderSpec:function(){return n},getRowCount:function(){return a.length},getRow:function(e){return a[e]},getGridHeight:function(){return 342},getSubDelegate:function(e){return o[e]},getTip:function(){return Utility.CreateTipBoard(localizedString("TNTUPGRADE_EMPTY_TIP"),null,!0)},getCell:function(){if(this.colName=="Result"){var e=this.data.TaskID,t=this.data.ID,n=$("<div>"),i=this,o=this.row,u=[];e==0?function(e){e.c3progress(function(){this.setFailed()},{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0})}(n):u.push(function(t){return t.c3progress(function(e){return function(){return l(this,e,i)}}(e),{max:100,dur:c3config.Clocker-2,async:1,width:60,swf:!0,async:1,hwf:!0})}(n));for(var a=0,f=u.length;a<f;a++)0==a&&u[a].start(),a<f-1?u[a].finishEvent.push(function(e){return function(t){e.start()}}(u[a+1])):u[a].finishEvent.push(function(e){return function(e){s--,r&&r.readyForNext&&s==0&&r.readyForNext()}}(u[a]));return n}return null}},l=function(e,t,n){c3.service.getTaskProgress(t).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase().toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(t).expand("TaskParameters").query(function(t){e.setFailed(t.data.ResultDescription),Utility.logTaskError(t.data)}):"SUCCESSFUL"==i[0].toUpperCase()?(e.setValue(100),n.data.errorLabel!=null&&n.data.errorLabel.text(0)):e.setValue(parseInt(i[1]))})};this.onInit=function(){var t=$("<div>");u=t.gridview({delegate:f}),u.rowSelectedEvent.push(function(){var e=this.index,t=a[e]}),e._container.append(t),r.disableCancel(),r.disableNext(),r.disableBack(),c()},this.onViewAppear=function(){}},c3startTesting.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t="Pre-Upgrade Testing",n=[{name:"Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"25%"},{name:"Errors",description:localizedString("ERRORS"),type:"text",width:"15%"},{name:"Warnings",description:localizedString("WARNINGS"),type:"text",width:"15%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"45%"}],r=arguments[0]||{},i=arguments[1]||[];r.PreUgpTenants=[];var s=arguments[2]||null,o=null,u=[],a={getHeaderSpec:function(){return n},getRowCount:function(){return u.length},getRow:function(e){return u[e]},getGridHeight:function(){return 342},getTip:function(){return Utility.CreateTipBoard(localizedString("STARTTESTING_EMPTY_TIP_PART"),null,!0)},getCell:function(){var e=null,t=this;if(this.colName=="Result"){var n=localizedString("MISC_SUCCESS");this.data.Errors!=null&&this.data.Errors>0?n=localizedString("MISC_ERROR"):this.data.Warnings!=null&&this.data.Warnings>0&&(n=localizedString("MISC_WARNING"));if(t.data.PUResult==null||t.data.PUResult.length==0)n="";var r=$("<a>").attr({href:"#"}).text(n);return r.click(function(){var e=new c3tenantPreUpgrade_errorMessage(this,t.data.PUResult,t.data.ID);e.show()}),this.data.Errors==null&&this.data.Warnings==null?null:r}return e}};this.onInit=function(){var t=$("<div>");o=t.gridview({delegate:a,checkType:1}),o.rowCheckEvent.push(function(){var e=this.index,t=u[e];if(this.isChecked){var n=!1;for(var i=0;i<r.PreUgpTenants.length;i++){var s=r.PreUgpTenants[i];if(s.ID==t.ID){n=!0;break}}n||r.PreUgpTenants.push(t)}else for(var i=0;i<r.PreUgpTenants.length;i++){var s=r.PreUgpTenants[i];if(s.ID==t.ID){r.PreUgpTenants.remove(i);break}}l()}),o.show(),e._container.append(t),f()},this.onViewAppear=function(){};var f=function(){u=i,o.reload(),l()},l=function(){if(r&&r.PreUgpTenants&&r.PreUgpTenants.length>0){r.readyForNext();return}r.disableNext()}},c3startTesting.step2=function(){function LoadData(){gridData=[],self.countFlag=0,count=delegate.PreUgpTenants.length;for(var e=0;e<delegate.PreUgpTenants.length;e++){var t={CompanyID:delegate.PreUgpTenants[e].CompanyID,TargetVersionIPR:targetVersion,ID:delegate.PreUgpTenants[e].ID,Name:delegate.PreUgpTenants[e].Name};PreUpgradeTesting(t)}}function PreUpgradeTesting(e){c3.service.PreUpgradeTesting(e.CompanyID,e.TargetVersionIPR,{success:function(t,n){e.TaskID=0,"SUCCESS"==n.toUpperCase()&&(e.TaskID=t.d.PreUpgradeTestingAsync),self.countFlag++,gridData.push(e),self.countFlag==delegate.PreUgpTenants.length&&gridView.reload()},error:function(t){e.TaskID=0,self.countFlag++,gridData.push(e),self.countFlag==delegate.PreUgpTenants.length&&gridView.reload()}})}this.base=c3.module,this.base(),this._container=$("<div>");var delegate=arguments[0]||{},targetVersion=arguments[2]||null,strBodyHeader=localizedString("STARTTESTING_TLT_PTP"),pColHeaders=[{name:"Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"25%"},{name:"Errors",description:localizedString("ERRORS"),type:"text",width:"15%"},{name:"Warnings",description:localizedString("WARNINGS"),type:"text",width:"15%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"45%"}],gridView=null,gridData=[],subDelegates=[],errorsDomList=[],warningsDomList=[],count=0,gridDelegate={getHeaderSpec:function(){return pColHeaders},getRowCount:function(){return gridData.length},getRow:function(e){return gridData[e]},getGridHeight:function(){return 340},getCell:function(){if(this.colName=="Errors"){var errors=$("<label>");return errorsDomList.push({RowIndex:this.row,Cell:errors}),errors}if(this.colName=="Warnings"){var warnings=$("<label>");return warningsDomList.push({RowIndex:this.row,Cell:warnings}),warnings}if(this.colName=="Result"){var taskid=this.data.TaskID,tenantId=this.data.ID,cellContent=$("<div>"),container=this,rowIndex=this.row,ProgressHandles=[];if(taskid==0){count--,delegate&&delegate.readyForNext&&count==0&&delegate.readyForNext();var pgsContainer=cellContent.c3progress(function(){return function(){pgsContainer.setFailed(localizedString("TRIAL_SELECT_FAILED"))}}(),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0});return pgsContainer.start(),cellContent}ProgressHandles.push(function(e){return e.c3progress(function(e){return function(){return getProgress(this,e,container)}}(taskid),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0})}(cellContent));for(var i=0,ii=ProgressHandles.length;i<ii;i++)0==i&&ProgressHandles[i].start(),i<ii-1?ProgressHandles[i].finishEvent.push(function(e){return function(t){e.start()}}(ProgressHandles[i+1])):ProgressHandles[i].finishEvent.push(function(handler){return function(e){count--,delegate&&delegate.readyForNext&&count==0&&delegate.readyForNext(),c3.service.getTasks(taskid).expand("SubTasks").query(function(result){if(result.data&&result.data.SubTasks&&result.data.SubTasks.results&&result.data.SubTasks.results.length>0){var subtaskid=result.data.SubTasks.results[1].ID;c3.service.getTaskResult(subtaskid).query(function(result){if(result!=null&&result.data!=null&&result.data.GetResult!=null){var errorArray=eval(result.data.GetResult),errorsCount=0,warningsCount=0;if(errorArray!=null&&errorArray.length>0){var text=localizedString("MISC_SUCCESS");for(var index=0;index<errorArray.length;index++){if(errorArray[index].Type=="Error"){text=localizedString("MISC_ERROR");break}errorArray[index].Type=="Warning"&&(text=localizedString("MISC_WARNING"))}for(var index in errorArray)errorArray[index].Type=="Error"?errorsCount++:errorArray[index].Type=="Warning"&&warningsCount++;var span=$("<a>").attr({href:"#"}).text(text);span.click(function(){var e=new c3tenantPreUpgrade_errorMessage(this,errorArray,tenantId);e.show()}),$(cellContent).find("#errorLabel").remove(),$(cellContent).append(span)}if(errorsDomList&&errorsDomList.length>0)for(var idx in errorsDomList)if(errorsDomList[idx].RowIndex==rowIndex){$(errorsDomList[idx].Cell).text(errorsCount);break}if(warningsDomList&&warningsDomList.length>0)for(var idx in warningsDomList)if(warningsDomList[idx].RowIndex==rowIndex){$(warningsDomList[idx].Cell).text(warningsCount);break}}})}})}}(ProgressHandles[i]));return cellContent}return null}},getProgress=function(progressBar,tid,rowContainer){c3.service.getTaskProgress(tid).query(function(result){var status=result.data.GetTaskProperties.split(",");"FAILED"==status[0].toUpperCase().toUpperCase()||"CANCELLED"==status[0].toUpperCase()||"ROLLBACK"==status[0].toUpperCase()?c3.service.getTasks(tid).expand("SubTasks").query(function(e){if(e.data&&e.data.SubTasks&&e.data.SubTasks.results&&e.data.SubTasks.results.length>0){var t=e.data.SubTasks.results[1].ID;c3.service.getTasks(tid).expand("TaskParameters").query(function(e){progressBar.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)})}}):"SUCCESSFUL"==status[0].toUpperCase()?(c3.service.getTasks(tid).expand("SubTasks").query(function(result){if(result.data&&result.data.SubTasks&&result.data.SubTasks.results&&result.data.SubTasks.results.length>0){var subtaskid=result.data.SubTasks.results[1].ID;c3.service.getTaskResult(subtaskid).query(function(result1){if(result1!=null&&result1.data!=null&&result1.data.GetResult!=null){var errorArray=eval(result1.data.GetResult),msg="";if(errorArray&&errorArray.length>0)for(var k=0;k<errorArray.length;k++)errorArray[k].Type=="Warning"&&(msg+=errorArray[k].Description+"\r\n");msg!=""&&msg.length>0?progressBar.setWarning(msg):progressBar.setValue(100)}})}}),rowContainer.data.errorLabel!=null&&rowContainer.data.errorLabel.text(0)):progressBar.setValue(parseInt(status[1]))})};this.onInit=function(){var e=$("<div>"),t=$("<div>");gridView=t.gridview({delegate:gridDelegate}),gridView.show(),e.append(t),LoadData(),this._container.append(e),delegate.disableBack(),delegate.disableCancel(),delegate.disableNext()},this.onViewAppear=function(){}},c3newCustomer.customerProfile=function(){function r(){var t=$("<div>");for(var r in n){var i=Utility.CreateRow(n[r].Name,n[r].Value);t.append(i)}return e.TrialRequest&&(n.Name.Value.val(e.TrialRequest.Name),n.ContactPerson.Value.val(e.TrialRequest.ContactPerson),n.Country.Value.val(e.TrialRequest.Country),n.EmployeeCount.Value.val(e.TrialRequest.EmployeeCount),n.Industry.Value.val(e.TrialRequest.Industry),n.Phone.Value.val(e.TrialRequest.Phone),n.Email.Value.val(e.TrialRequest.Email),n.Location.Value.val(e.TrialRequest.Location)),t}function i(){e.TrialRequest&&(e.CustomerEntity.TrialRequestID=e.TrialRequest.ID),e.CustomerEntity.Name=n.Name.Value.val(),e.CustomerEntity.ContactPerson=n.ContactPerson.Value.val(),e.CustomerEntity.Country=n.Country.Value.val(),e.CustomerEntity.EmployeeCount=n.EmployeeCount.Value.val(),e.CustomerEntity.Industry=n.Industry.Value.val(),e.CustomerEntity.Phone=n.Phone.Value.val(),e.CustomerEntity.Email=n.Email.Value.val(),e.CustomerEntity.Location=n.Location.Value.val(),e.CustomerEntity.Description=n.Description.Value.val()}this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=this,n={Name:{Name:localizedString("MISC_CUSTNAME"),Value:new textbox({isRequired:!0})},ContactPerson:{Name:localizedString("COLUMN_CONTACTPERSON"),Value:new textbox({isRequired:!1})},Phone:{Name:localizedString("CUSTOMER_COLUMN_PHONE"),Value:new textbox({isRequired:!1})},Email:{Name:localizedString("CUSTOMER_COLUMN_EMAIL"),Value:new textbox({isRequired:!1})},EmployeeCount:{Name:localizedString("CUSTOMERCREATION_LABEL_EMPLOYEECOUNT"),Value:new textbox({isRequired:!1,pattern:"[0-9]*"})},Country:{Name:localizedString("CUSTOMER_COLUMN_COUNTRY"),Value:new textbox({isRequired:!1})},Location:{Name:localizedString("CUSTOMER_COLUMN_LOCATION"),Value:new textbox({isRequired:!1})},Industry:{Name:localizedString("TRIAL_COLUMN_INDUSTRY"),Value:new textbox({isRequired:!1})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}};this.validator=new function(){var e=[],t=function(){function c(e){e.data&&e.data.length>0?n.Name.Value.showErrorMessage(textbox.validityMessages.duplicated):p()}function h(){p()}function p(){i(),e.length>0&&e[0]()}var t=!0;if(n.EmployeeCount.Value.val()&&n["EmployeeCount"].Value.val()!=""){t=n.EmployeeCount.Value.checkValidity();if(t){var r=parseInt(n.EmployeeCount.Value.val());r>2147483647&&(t=t&&!1,n.EmployeeCount.Value.showErrorMessage(localizedString("CUSTOMER_CRATION_EMPLOYEECOUNT_MAX")))}}var s=!0;if(n.Email.Value.val()&&n["Email"].Value.val()!=""){var o=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;s=o.test(n.Email.Value.val()),s||n.Email.Value.showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH"))}var u=!0;if(n.Phone.Value.val()&&n["Phone"].Value.val()!=""){var a=/^(\+\d{2,3} )*[\d]+(-[\d]+)*$/;u=a.test(n.Phone.Value.val()),u||n.Phone.Value.showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH"))}var f=n.Name.Value.checkValidity()&&s&&u&&t;if(f){var l=n.Name.Value.val();l=l.replace(new RegExp("'","gm"),"''"),l=encodeURIComponent(l),c3.service.getCustomers().filter(String.format("Name eq '{0}'",l)).query({success:c,error:h})}};this.validEvent=e,this.checkValidity=t},this.onInit=function(){this._container.append(r())}},c3newCustomer.importLicenseFile=function(){function l(t){if(!t){n.attr("src",c3Icon.Failed).css("display","inline"),alert(localizedString("IMPORTLICFILE_IMPORTERROR_INVALIDLICFILE"));return}c3.service.parseLicenseFile(t,{error:function(){e.btnImport.removeAttr("disabled"),n.attr("src",c3Icon.Failed).css("display","inline")},success:function(r){if(!(r.d&&r.d.results&&r.d.results.length>0)){e.btnImport.removeAttr("disabled"),n.attr("src",c3Icon.Failed).css("display","inline"),alert(localizedString("IMPORTLICFILE_IMPORTERROR_INVALIDLICFILE"));return}var i=!1;for(var o=0;o<s.length;o++)if(r.d.results[0].InstallationNumber==s[o].InstallationNumber){i=!0;var u=r.d.results[r.d.results.length-1];r.d.results.remove(r.d.results.length-1),c3.service.getLicenseFiles().filter("InstallationNumber eq '"+s[o].InstallationNumber+"' and LicenseServer/ID eq "+s[o].LicenseServer_ID).query(function(i){if(i.data&&i.data.length>0){var s=i.data[0];c3.service.getLicenseModulesByLicenseFileId(s.ID).query(function(i){if(i.data&&i.data.length>0){var s=new c3importLicenseFileConfimation(e,i.data,r.d.results,t);s.finishEvent.push(function(){e.loadLicenseFile(),e.btnImport.removeAttr("disabled"),n.attr("src",c3Icon.Success).css("display","inline")}),s.onClose.push(function(){n.css("display","none"),e.btnImport.removeAttr("disabled")}),s.show()}})}});return}i||c(t)}})}function c(t){c3.service.importLicenseFile(t,function(t){if(t.response!=null){var r=JSON.parse(t.response);if(r.error!=null&&r.error.code!=null){n.attr("src",c3Icon.Failed).css("display","inline");return}}e.btnImport.removeAttr("disabled"),n.attr("src",c3Icon.Success).css("display","inline")})}function m(){var e=$("<div>").addClass("licenseRow");e.append($("<div>").append(localizedString("RES_VIEWLIC_LICFILE")).addClass("rowName"));var t=$("<input>").attr({type:"file",name:"LicenseContent",size:"30"});return e.append($("<div>").append(t).addClass("rowValue")),n.hide(),e.append(n),e}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=$("<div>"),n=$("<img>").attr({src:c3Icon.Failed}),r=arguments[0]||{},i=null,s=[],o=-1,u={getHeaderSpec:function(){return[{name:"InstallationNumber",description:localizedString("COLUMN_INSTALL_NO")+" / "+localizedString("WIZARD_TENANT_LIVMDL"),type:"text",width:"50%"},{name:"LicenseServer_Name",description:localizedString("CUSTOMERCREATION_LABEL_SERVERNAME")+" / "+localizedString("WIZARD_TENANT_AVINUM"),type:"text",width:"50%"}]},getRowCount:function(){return s.length},disableSort:function(){return!0},getRow:function(e){return s[e]},getGridHeight:function(){return 260},getSubDelegate:function(e){return a[e]},getDefaultSelectedIndex:function(){return o},shouldExpandOnRowSelect:function(){return!1}},a=[],f=$("<input>").attr({type:"button",value:localizedString("DATAFORM_IMPORT")}).click(function(){var t=this,r={success:function(e){d(),h(),$(t).attr({disabled:!1}),n.attr({src:c3Icon.Success,title:""})},error:function(e){$(t).attr({disabled:!1});var r=localizedString("CUSTOMERCREATION_LABEL_UPLOADING");e&&(r=retriveErrorMessage(e.responseText)),n.attr({src:c3Icon.Failed,title:r})}},i=e.getContainer().find("input[type=file]"),s=!1;for(var o=0;o<i.length;o++)i[o].files&&i[o].files.length&&i[o].files[0].size>0&&($(t).attr({disabled:!0}),getLicenseFileContent(i[o],l),s=!0);s&&(n.attr({src:c3Icon.Loading}),n.show())});e.btnImport=f;var h=function(){e.trialVersionCheckbox[0].checked?(s=[],i.reload()):(e.loadingWin.show(),c3.service.getLicenseFiles().expand("LicenseServer").query(function(t){s=[],a=[];var n=c3.service.convertData(t.data),r=n,o=0;for(var u=0,f=r.length;u<f;u++)s.push(r[u]),p(o),o++;i.reload(),e.loadingWin.close()}))};this.loadLicenseFile=h;var p=function(e){var t=[];a.push({}),a[e].getHeaderSpec=function(){return[{name:"Description",description:localizedString("COLUMN_INSTALL_NO"),type:"text",width:"50%"},{name:"Available",description:localizedString("COLUMN_SYS_NO"),type:"text",width:"50%"}]},a[e].getRow=function(e){return function(t){return e[t]}}(t),a[e].getRowCount=function(e){return function(){return e.length}}(t),a[e].loadSubData=function(e,n){c3.service.getLicenseModulesByLicenseFileId(e.ID).query(function(e){if(null!=e.data&&0<e.data.length)for(var r=0;r<e.data.length;r++)t.push(e.data[r]);n()})}};this.onInit=function(){t.append(m());var n=$("<div>").css({"margin-top":"5px"});i=n.gridview({delegate:u}),i.rowSelectedEvent.push(function(){o==this.index?(o=-1,r.CustomerEntity.InstallationNumber=null,i.reload()):this.data&&this.data.ID&&(r.CustomerEntity.InstallationNumber=this.data.InstallationNumber,o=this.index),d()});var s=$("<div>").append(t).append(f).append(n),a=$("<input>").attr({type:"checkbox"});e.trialVersionCheckbox=a,e.trialVersionCheckbox.click(function(){e.trialVersionCheckbox[0].checked?(s.css("display","none"),r.CustomerEntity.Type="TrialCustomer",d()):(s.css("display","block"),r.CustomerEntity.InstallationNumber==-1&&(r.CustomerEntity.InstallationNumber=null),o=-1,i.reload(),r.CustomerEntity.Type="Customer",d()),h()});var l=$("<div>").css({"padding-left":"5px","padding-top":"5px"}).append(a).append("&nbsp;&nbsp;&nbsp;").append($("<span>").css({"font-weight":"bold"}).append("Trial"));e._container.append(l),e._container.append(s),i.show(),e.loadingWin=new loadingWindow},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.LicenseFiles,function(t){e.loadLicenseFile()})},this.onViewAppear=function(){n&&n.hide(),r.TrialRequest?(e.trialVersionCheckbox.attr({checked:"true",disabled:"true"}),e.floatDiv.css({display:"block"}),r.CustomerEntity.Type="TrialCustomer"):e.trialVersionCheckbox[0].checked&&e.trialVersionCheckbox[0].checked==1?r.CustomerEntity.Type="TrialCustomer":r.CustomerEntity.Type="Customer",h(),d()};var d=function(){r&&r.readyForNext&&r.readyForNext()},v={checkValidity:function(){var t=e._container.parent(".main"),n=t.find("#withoutLicenseTip");return n&&n.hide(),r.CustomerEntity.Type==="TrialCustomer"&&(r.CustomerEntity.InstallationNumber="-1"),!0}};this.validator=v},c3newCustomer.addSystemUser=function(){function l(e){o=e,h()}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=$("<div>"),r=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"90%"}],i=null,s=[],o=-1,u={getHeaderSpec:function(){return r},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 320},getDefaultSelectedIndex:function(){return o},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}},a=$("<input>").attr({type:"button",value:localizedString("MISC_ADD")}),f=$("<input>").attr({type:"button",value:localizedString("MISC_REMOVE")});a.click(function(){var t=new c3addSystemUser(e,0,null,!1,"customer");t.finishEvent.push(function(){p(t.User)}),t.show()}),f.click(function(){s.remove(o),o=-1,i.reload(),h()}),this.onInit=function(){var e=$("<div>").append(a).append(f).addClass("tools toolsbar"),t=$("<div>").addClass("tblUp");i=t.gridview({delegate:u}),i.rowSelectedEvent.push(function(){o!=this.index&&l(this.index)}),this._container.append(e),this._container.append(t),i.show()},validator=new function(){var e=[],n=function(){function a(){c(s),e.length>0&&e[0]()}var n=!1;for(var r=0;r<s.length;r++)for(var i=0;i<s.length;i++)r!==i&&s[r].Name==s[i].Name&&(n=!0);n&&t.showError(localizedString("CUSTOMER_CREATION_SYSTEMUSER_REAPEATED"));if(!n&&t.CustomerEntity.Type==="TrialCustomer"){var o={};o.success=function(e){var n=e.d.results;if(n){var r=0;for(var i=0;i<s.length;i++){var o=!1;for(var u=0;u<n.length;u++)if(s[i].Name==n[u].SystemUsername){o=!0;break}o||r++}r>2?t.showError(localizedString("CUSTOMER_CREATION_TWOUSERS_LIMIT")):a()}else a()},o.error=function(e){a()};var u={};c3.service.getOperators(u,o)}else n||a()};this.validEvent=e,this.checkValidity=n},this.validator=validator,this.onViewAppear=function(){t&&t.readyForNext&&t.readyForNext(),t.CustomerEntity?a.attr({disabled:!1}):a.attr({disabled:!0}),s||(s=[]),i.reload(),h()};var c=function(e){t.CustomerEntity.Users=[];for(var n=0;n<e.length;n++){var r={ID:e[n].ID,SystemUser:e[n].Name,Status:e[n].Status,Domain:e[n].Domain};t.CustomerEntity.Users.push(r)}},h=function(){t&&t.readyForNext?t.readyForNext():t.disableNext(),o==-1?f.attr({disabled:!0}):f.attr({disabled:!1})},p=function(e){for(var n=0;n<s.length;n++)if(e.Name==s[n].Name){t.showError(localizedString("CUSTOMER_CREATION_SYSTEMUSER_REAPEATED"));return}s.push(e),i.reload(),h()}},c3newCustomer.addTenant=function(){function h(e){i=e,p()}this.base=c3.module,this.base(),this._container=$("<div>");var e="Company List",t=[{name:"CompanyDatabase_Name",description:localizedString("CUSTOMERCREATION_LABEL_TNTNAME"),type:"text",width:"30%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"20%"},{name:"CompanyDatabase_DBName",description:localizedString("TNT_COLUMN_DBNAME"),type:"text",width:"30%"},{name:"CompanyDatabase_PName",description:localizedString("WIZARD_CPYDB_PNAME"),type:"text",width:"20%"}],n=this,r=arguments[0]||{},i=0,s={checkValidity:function(){return!0}};this.validator=s;var o=null,u=[],a=[],f={getHeaderSpec:function(){return t},getRowCount:function(){return u.length},getRow:function(e){return u[e]},getGridHeight:function(){return 320},getDefaultSelectedIndex:function(){return i}},l=$("<input>").attr({type:"button",value:localizedString("MISC_NEW")}),c=$("<input>").attr({type:"button",value:localizedString("MISC_REMOVE")});this.onInit=function(){var e=$("<div>"),t=$("<div>");o=t.gridview({delegate:f}),o.show();var s=$("<div>").addClass("tools");s.addClass("toolsbar"),l.click(function(){var e=new c3newTenant(n,!1,r.CustomerEntity,!1,a,r.TrialRequest);e.finish=d,e.show()}),c.click(function(){u&&u.length>0&&i>-1&&(u.remove(i),a.remove(i),i=0),o.reload(),p()}),o.rowSelectedEvent.push(function(){i!=this.index&&h(this.index)}),s.append(l),s.append($("<span>").addClass("split")),s.append(c),e.append(s),e.append(t),this._container.append(e)},this.onViewAppear=function(){p()};var s={checkValidity:function(){if(r.CustomerEntity.Type=="TrialCustomer"&&u.length==0)return r.showError(localizedString("CUSTCREATION_WIZARD_TRIALCUST_NOTENANTS_WARNING")),!1;var e=!1;for(var t=0;t<a.length;t++)for(var n=0;n<a.length;n++)t!==n&&a[t].CompanyDatabase.Name==a[n].CompanyDatabase.Name&&(e=!0);return e?r.showError(localizedString("CUSTOMER_CREATION_CPYNAME_REAPEATED")):v(a),!e}};this.validator=s;var p=function(){i==-1?c.attr({disabled:!0}):c.attr({disabled:!1}),r.CustomerEntity&&r.CustomerEntity.Type==="TrialCustomer"&&(u&&u.length>=1?l.attr({disabled:!0}):l.attr({disabled:!1}),r&&r.readyForNext&&u&&1==u.length?r.readyForNext():r.disableNext())},d=function(e){a.push(e);var t=c3.service.convertData([e]);u.push(t[0]),o.reload(),p()},v=function(e){r.CustomerEntity.Tenants=[];for(var t=0;t<e.length;t++)r.CustomerEntity.Tenants.push(e[t])}},c3newCustomer.review=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=arguments[1]||{},r=null,i=[],s={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"CompanyDatabase_Name",description:localizedString("CUSTOMERCREATION_LABEL_TNTNAME"),type:"text",width:"30%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"20%"},{name:"CompanyDatabase_DBName",description:localizedString("TNT_COLUMN_DBNAME"),type:"text",width:"30%"},{name:"CompanyDatabase_PName",description:localizedString("WIZARD_CPYDB_PNAME"),type:"text",width:"20%"}]},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 180}},o=null,u=[],a={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"SystemUser",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"90%"}]},getRowCount:function(){return u.length},getRow:function(e){return u[e]},getGridHeight:function(){return 180},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}};this.onInit=function(){var e=$("<div>").attr("class","review"),n=$("<div>").attr("class","block");n.append($("<div>").attr("class","blockHeader").append(localizedString("CUSTOMER"))),n.append($("<div>").attr("class","row").append(localizedString("COLUMN_MSSQL_NAME")+": "+t.CustomerEntity.Name)),n.append($("<div>").attr("class","row").append(localizedString("COLUMN_CONTACTPERSON")+": "+t.CustomerEntity.ContactPerson)),n.append($("<div>").attr("class","row").append(localizedString("CUSTOMER_COLUMN_COUNTRY")+": "+t.CustomerEntity.Country)),n.append($("<div>").attr("class","row").append(localizedString("CUSTOMERCREATION_LABEL_EMPLOYEECOUNT")+": "+t.CustomerEntity.EmployeeCount)),n.append($("<div>").attr("class","row").append(localizedString("TRIAL_COLUMN_INDUSTRY")+": "+t.CustomerEntity.Industry)),n.append($("<div>").attr("class","row").append(localizedString("CUSTOMER_COLUMN_PHONE")+": "+t.CustomerEntity.Phone)),n.append($("<div>").attr("class","row").append(localizedString("CUSTOMER_COLUMN_EMAIL")+": "+t.CustomerEntity.Email)),n.append($("<div>").attr("class","row").append(localizedString("CUSTOMER_COLUMN_LOCATION")+": "+t.CustomerEntity.Location)),n.append($("<div>").attr("class","row").append(localizedString("EDITCPYDB_COLUMN_DESC")+": "+t.CustomerEntity.Description)),n.append($("<div>").attr("class","row").append(localizedString("RES_LIC_INSTALLATION_NUM")+": "+t.CustomerEntity.InstallationNumber)),e.append(n);var f=$("<div>").attr("class","block");f.append($("<div>").attr("class","blockHeader").append(localizedString("RESPOOL_OPERATOR_TLT")));if(t.CustomerEntity.Users!=null&&t.CustomerEntity.Users.length>0){var l=$("<div>");o=l.gridview({delegate:a}),o.show(),u=t.CustomerEntity.Users,o.reload(),f.append(l)}e.append(f);var c=$("<div>").attr("class","block");c.append($("<div>").attr("class","blockHeader").append(localizedString("TENANTS")));if(t.CustomerEntity.Tenants!=null&&t.CustomerEntity.Tenants.length>0){var h=$("<div>");r=h.gridview({delegate:s}),r.show(),i=c3.service.convertData(t.CustomerEntity.Tenants),r.reload(),c.append(h)}e.append(c),this._container.append(e)},this.onViewAppear=function(){this._container.html(""),this.onInit()}},c3newCustomer.process=function(){function s(r){var i={};e._container.append(Utility.CreateProgressRow(localizedString("CUSTOMERCREATION_LABEL_CRTCUSTOMER"),function(){var e=this;o(r,e)},i)),i.progressBar.finishEvent.push(function(){t&&t.readyForNext&&t.readyForNext()}),n.push(i);for(var s=0;s<n.length;s++)n[s].progressBar.start()}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=[],r=0,i={success:function(e){r=e.d.CreateCustomerAsync,s(r)},error:function(e){r=-1,s(r)}};this.onInit=function(){t.disableBack(),t.disableCancel(),t.disableNext(),c3.hasPermission([permissionItems.operator])?customerManager.createCustomer(t.CustomerEntity,i):(e.load1=new loadingWindow,e.load1.show(),customerManager.createCustomer(t.CustomerEntity,{success:function(n){var r=n.d.CreateCustomerAsync;r!=null&&r>0&&c3.service.getTasks(r).query(function(n){if(n.data!=null)if(n.data.Status=="WaitingForApproval"){var i=$("<div>").attr("class","rar_request_panel").css({"line-height":"25px",margin:"0 20px 0 20px"}).append(localizedString("VARREQUEST_NEEDAPPROVE"));e._container.append(i),t.readyForNext(),e.load1.close()}else s(r),e.load1.close()})},error:function(t){s(-1),e.load1.close()}}))};var o=function(e,t){e>0?c3.service.getTaskProgress(e).query(function(n){var r=n.data.GetTaskProperties.split(",");"Failed"==r[0]||"Cancelled"==r[0]||"Rollback"==r[0]?c3.service.getTasks(e).expand("TaskParameters").query(function(e){t.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)}):"Successful"==r[0]?t.setValue(100):t.setValue(parseInt(r[1]))}):-1===e?t.setFailed():t.setValue(0)}};var c3CompanyDBCreationStrategy={New:"New",FromPkg:"FromPkg",FromBackup:"FromBackup"};c3newTenant.step_FromPackage_SelectPackage=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{};e.TenantEntity.CompanyDatabase={};var t=null,n=[],r={getHeaderSpec:function(){return[{name:"SolutionName",description:"Solution Name",type:"text",width:"100%"}]},getRowCount:function(){return n.length},getRow:function(e){return n[e]},getGridHeight:function(){return 300},shouldExpandOnRowSelect:function(){return!1}},i=this,s=$("<input>").attr({type:"button",value:"Refresh"}).click(function(){u(),e&&e.disableNext&&e.disableNext()});this.onInit=function(){var n=$("<div>").css({"float":"left"});t=n.gridview({delegate:r}),t.rowSelectedEvent.push(function(){e.TenantEntity.CompanyDatabase.BackupFile&&(e.TenantEntity.CompanyDatabase.BackupFile=""),e.TenantEntity.CompanyDatabase.PackageFile=this.data.Path,o()}),i._container.append(n),t.show(),i._container.append($("<div>").css({"float":"right"}).append(s));var u=new loadingWindow;i.loadingWin=u},this.onViewAppear=function(){u(),o(),e&&e.disableNext&&e.disableNext()},this.reload=function(){u()};var o=function(){e&&e.readyForNext&&(e.TenantEntity.CompanyDatabase.PackageFile?e.readyForNext():e.disableNext())},u=function(){n=[];if(c3.hasPermission([permissionItems.operator]))if(e.TenantEntity.ServiceUnit.ImplementationRepository&&e.TenantEntity.ServiceUnit.ImplementationRepository.ID){i.loadingWin.show();var r=e.TenantEntity.ServiceUnit.ImplementationRepository.ID;tenantManager.getSolutionPackageFiles(r,function(e){i.loadingWin.close(),n=e,n.length<=0&&log.warning("APPLICATION",localizedString("TENANT_LOADPACKAGEFILE_NOFILE_WARNING"),null),t.reload()})}else log.warning("APPLICATION",localizedString("TENANT_LOADPACKAGEFILE_NOASSIGN_WARNING"),null),t.reload();else{i.loadingWin.show();if(e.TenantEntity.ServiceUnit.ImplementationRepository==null||e.TenantEntity.ServiceUnit.ImplementationRepository.ID==null)c3.service.getImplementationRepositories().filter("Reseller/ID ne null").expand("Reseller").query(function(e){if(e.data==null||e.data.length==0)t.reload(),i.loadingWin.close();else{var r=e.data[0].ID;tenantManager.getSolutionPackageFiles(r,function(e){n=e,t.reload(),i.loadingWin.close()})}});else{var r=e.TenantEntity.ServiceUnit.ImplementationRepository.ID;tenantManager.getSolutionPackageFiles(r,function(e){n=e,c3.service.getImplementationRepositories().filter("Reseller/ID ne null").expand("Reseller").query(function(e){if(e.data==null||e.data.length==0)t.reload(),i.loadingWin.close();else{var r=e.data[0].ID;tenantManager.getSolutionPackageFiles(r,function(e){if(e!=null&&e.length>0)for(var r=0;r<e.length;r++)n.push(e[r]);t.reload(),i.loadingWin.close()})}})})}}}},c3newTenant.step_FromPackage_VerifyPackageInfo=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=new loadingWindow,n={SPInfo:{Name:$("<u>").append(localizedString("TNTCREATION_LABEL_PAKINFO")),Value:$("<lable>").append("&nbsp;")},SPName:{Name:localizedString("TNTCREATION_LABEL_SULNAME"),Value:$("<input>").attr({readonly:"true"})},Industry:{Name:localizedString("TRIAL_COLUMN_INDUSTRY"),Value:$("<input>").attr({readonly:"true"})},IndustrySpecific:{Name:localizedString("TNTCREATION_LABEL_IDSPECIFIC"),Value:$("<input>").attr({readonly:"true"})},Country:{Name:localizedString("CUSTOMER_COLUMN_COUNTRY"),Value:$("<input>").attr({readonly:"true"})},B1Version:{Name:localizedString("TNTCREATION_LABEL_B1VERSION"),Value:$("<input>").attr({readonly:"true"})},SPVersion:{Name:localizedString("TNTCREATION_LABEL_SULV"),Value:$("<input>").attr({readonly:"true"})},CreationDate:{Name:localizedString("TNTCREATION_LABEL_CREATIONDATE"),Value:$("<input>").attr({readonly:"true"})},VendorInfo:{Name:$("<u>").append(localizedString("TNTCREATION_LABEL_VENDORINFO")),Value:$("<lable>").append("&nbsp;")},CompanyName:{Name:localizedString("MISC_CPYNAME"),Value:$("<input>").attr({readonly:"true"})},ContactPerson:{Name:localizedString("COLUMN_CONTACTPERSON"),Value:$("<input>").attr({readonly:"true"})},Email:{Name:localizedString("CUSTOMER_COLUMN_EMAIL"),Value:$("<input>").attr({readonly:"true"})},TelephoneNumber:{Name:localizedString("TNTCREATION_LABEL_TELNO"),Value:$("<input>").attr({readonly:"true"})}},r=this,i=null;this.onInit=function(){r._container.append(a())},this.onViewAppear=function(){f(),e.disableNext(),s()},this.reload=function(){f(),e.disableNext(),s()};var s=function(){f();var n=e.TenantEntity.CompanyDatabase.PackageFile,r=e.TenantEntity.ServiceUnit.ID;t.show(),tenantManager.getSolutionPackageContent(n,e.TenantEntity.ServiceUnit.SoftwareRepository.ID,function(e){var t=parseInt(e);!isNaN(t)&&t>0&&o(t)})},o=function(e){c3.service.getTaskProgress(e).query(function(t){var n=t.data.GetTaskProperties.split(",");"Failed"==n[0]||"Cancelled"==n[0]?(u(e),c3.service.getTasks(e).expand("TaskParameters").query(function(e){Utility.logTaskError(e.data)})):"Successful"==n[0]?u(e):setTimeout(function(){o(e)},5e3)})},u=function(n){tenantManager.getSolutionPackageInformation(n,function(n){null!=n.COA&&(e.TenantEntity.CompanyDatabase.COAList=n.COA,e.TenantEntity.CompanyDatabase.BaseLanguage=n.BaseLanguage,e.TenantEntity.CompanyDatabase.PakLocalization=n.LocalSettings,e.TenantEntity.CompanyDatabase.Country=n.Country,l(n)),t.close()})},a=function(){var e=$("<div>"),t=$("<div>").css({height:"20px"}),r=null;for(var i in n)r=Utility.CreateRow(n[i].Name,n[i].Value),n[i].Name&&n[i].Name.length>0&&r.css({height:"15px"}),e.append(r);return e},f=function(){n.SPName.Value.attr({disabled:!0,value:""}),n.Industry.Value.attr({disabled:!0,value:""}),n.IndustrySpecific.Value.attr({disabled:!0,value:""}),n.Country.Value.attr({disabled:!0,value:""}),n.B1Version.Value.attr({disabled:!0,value:""}),n.SPVersion.Value.attr({disabled:!0}),n.CreationDate.Value.attr({disabled:!0,value:""}),n.CompanyName.Value.attr({disabled:!0,value:""}),n.ContactPerson.Value.attr({disabled:!0,value:""}),n.Email.Value.attr({disabled:!0,value:""}),n.TelephoneNumber.Value.attr({disabled:!0,value:""})},l=function(t){n.SPName.Value.attr({value:t.SolutionName}),n.Industry.Value.attr({value:t.Industry}),n.IndustrySpecific.Value.attr({value:t.IndustrySpecific}),n.Country.Value.attr({value:t.Country}),n.B1Version.Value.attr({value:t.B1Version}),n.SPVersion.Value.attr({value:t.Version}),n.CreationDate.Value.attr({value:t.CreationDate}),n.CompanyName.Value.attr({value:t.Vendor.companyName}),n.ContactPerson.Value.attr({value:""}),n.Email.Value.attr({value:""}),n.TelephoneNumber.Value.attr({value:""}),e.readyForNext()}},c3newTenant.step_FromPackage_SelectCOA=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=null,n={ChartOfAccounts:{Name:localizedString("MISC_COA"),Value:new dropdownlist({isRequired:!0})}},r=this,i=new function(){var t=function(){return e.TenantEntity.CompanyDatabase.COA=r.suSelect.val(),e.TenantEntity.CompanyDatabase.COA?("Pre-Defined"==e.TenantEntity.CompanyDatabase.COA?e.TenantEntity.CompanyDatabase.COA="#":"UserDefined"==e.TenantEntity.CompanyDatabase.COA&&(e.TenantEntity.CompanyDatabase.COA="U"),!0):!1};this.checkValidity=t};this.validator=i,this.onViewAppear=function(){},this.onInit=function(){s()};var s=function(){var n=$("<section>").attr({id:"coa_id"}).addClass("tools"),i=$("<div>").addClass("dropdown_list_wrap").css("float","left"),s=$("<select>").css("width","250px");r.suSelect=s;if(e.TenantEntity.CompanyDatabase&&e.TenantEntity.CompanyDatabase.COAList){for(var a in e.TenantEntity.CompanyDatabase.COAList){var f=$("<option>").attr({text:a,value:a});s.append(f)}var l=$("<option>").attr({text:"User Defined",value:"UserDefined"});s.append(l),c3.service.getChartOfAccountList(e.TenantEntity.ServiceUnit.CommonDatabase.ID,e.TenantEntity.CompanyDatabase.Localization).query(function(e){var t=null;for(var n=0;n<e.data.length;n++)t=$("<option>").append(e.data[n]),s.append(t)})}i.append(s),n.append(i),r._container.append(n),s.change(function(){var n=null,r=s.val();for(var i in e.TenantEntity.CompanyDatabase.COAList)if(i==r){n=e.TenantEntity.CompanyDatabase.COAList[i],n=o(n);break}r=="UserDefined"?n="<br/>"+localizedString("WIZARD_CRTDB_PKG_STEP4_USERDEFINED"):r!="Pre-Defined"&&(n="<br/>"+localizedString("WIZARD_CRTDB_PKG_STEP4_PREDEFINED")),t.html(n)});var c=null,h=s.val();for(var p in e.TenantEntity.CompanyDatabase.COAList)if(p==h){c=e.TenantEntity.CompanyDatabase.COAList[p],c=o(c);break}u(c)},o=function(e){return e=e.replace(/\n/g,"<br/>"),e=e.replace(/\s{3}/g,"<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>"),e},u=function(e){t=$("<div>").css({"overflow-y":"scroll",height:"310px"}),t.html(e),r._container.append(t)},a=function(){n.ChartOfAccounts.Value.find("option").remove(),n.ChartOfAccounts.Value.append($("<option>"));var e=null;for(var t=0;t<1;t++)e=$("<option>").append("Predefined"),n.ChartOfAccounts.Value.append(e)}},c3newTenant.step_FromBackup_SelectBackupFile=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=null,n=[],r={getHeaderSpec:function(){return[{name:"BackupName",description:localizedString("TNTCREATION_COLUMN_BAKNAME"),type:"text",width:"35%"},{name:"Localization",description:localizedString("MISC_LOCATION"),type:"text",width:"35%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"30%"}]},getRowCount:function(){return n.length},getRow:function(e){return n[e]},getGridHeight:function(){return 300},shouldExpandOnRowSelect:function(){return!1}},i=this,s=$("<input>").attr({type:"button",value:localizedString("MISC_REFRESH")}).click(function(){u(),e&&e.disableNext&&e.disableNext()});this.onInit=function(){var n=$("<div>").css({"float":"left"});t=n.gridview({delegate:r}),t.rowSelectedEvent.push(function(){e.TenantEntity.CompanyDatabase.PackageFile&&(e.TenantEntity.CompanyDatabase.PackageFile=""),e.TenantEntity.CompanyDatabase.BackupFile=this.data.Path,o()}),i._container.append(n),t.show(),i._container.append($("<div>").css({"float":"right"}).append(s));var u=new loadingWindow;i.loadingWin=u},this.onViewAppear=function(){u(),o(),e&&e.disableNext&&e.disableNext()},this.reload=function(){u()};var o=function(){e&&e.readyForNext&&(e.TenantEntity.CompanyDatabase.BackupFile?e.readyForNext():e.disableNext())},u=function(){n=[],t.reload();var r=null;if(e.TenantEntity.LicenseServer.LicenseFiles&&e.TenantEntity.LicenseServer.LicenseFiles.results)for(var s=0;s<e.TenantEntity.LicenseServer.LicenseFiles.results.length;s++)if(e.TenantEntity.LicenseServer.LicenseFiles.results[s].InstallationNumber==e.TenantEntity.Customer.InstallationNumber){r=e.TenantEntity.LicenseServer.LicenseFiles.results[s];break}var o=null,u=null,a=e.TenantEntity.DatabaseInstance.ServerType=="HANADB"?!0:!1;null!=r&&(o=r.Localization);var f=e.TenantEntity.ServiceUnit.Version.split(".");null!=f&&f.length>0&&(u=f[0]+f[1]),c3.hasPermission([permissionItems.operator])?e.TenantEntity.ServiceUnit.CompanyTemplateRepository?(i.loadingWin.show(),tenantManager.getCompanyTemplateRepositoriesByID(e.TenantEntity.ServiceUnit.CompanyTemplateRepository.ID,function(e){i.loadingWin.close();if(e&&e.length>0)for(var r=0;r<e.length;r++){if(e[r].isHANA!==a)continue;null==o||o=="WW"?e[r].Version==null||e[r].Version==""||e[r].Version=="Unknown"?n.push(e[r]):e[r].Version==u&&n.push(e[r]):e[r].Version==null||e[r].Version==""||e[r].Version=="Unknown"?n.push(e[r]):e[r].Version==u&&e[r].Localization==o&&n.push(e[r])}else log.warning("APPLICATION",localizedString("TENANT_LOADBACKUPFILE_NOFILE_WARNING"),null);n.length<=0&&log.warning("APPLICATION",localizedString("TENANT_LOADBACKUPFILE_NOMATCHLOCALIZATION_WARNING"),null),t.reload()})):(log.warning("APPLICATION",localizedString("TENANT_LOADBACKUPFILE_NOASSIGN_WARNING"),null),t.reload()):(i.loadingWin.show(),e.TenantEntity.ServiceUnit.CompanyTemplateRepository==null?c3.service.getCompanyTemplateRepositories().filter("Reseller/ID ne null").expand("Reseller").query(function(e){if(e.data==null||e.data.length==0)t.reload(),i.loadingWin.close();else{var r=e.data[0].ID;tenantManager.getCompanyTemplateRepositoriesByID(r,function(e){if(e&&e.length>0)for(var r=0;r<e.length;r++){if(result[r].isHANA!==a)continue;null==o||o=="WW"?e[r].Version==null||e[r].Version==""||e[r].Version=="Unknown"?n.push(e[r]):e[r].Version==u&&n.push(e[r]):e[r].Version==null||e[r].Version==""||e[r].Version=="Unknown"?n.push(e[r]):e[r].Version==u&&e[r].Localization==o&&n.push(e[r])}t.reload(),i.loadingWin.close()})}}):tenantManager.getCompanyTemplateRepositoriesByID(e.TenantEntity.ServiceUnit.CompanyTemplateRepository.ID,function(e){for(var r=0;r<e.length;r++){if(e[r].isHANA!==a)continue;null==o||o=="WW"?e[r].Version==null||e[r].Version==""||e[r].Version=="Unknown"?n.push(e[r]):e[r].Version==u&&n.push(e[r]):e[r].Version==null||e[r].Version==""||e[r].Version=="Unknown"?n.push(e[r]):e[r].Version==u&&e[r].Localization==o&&n.push(e[r])}c3.service.getCompanyTemplateRepositories().filter("Reseller/ID ne null").expand("Reseller").query(function(r){if(r.data==null||r.data.length==0)t.reload(),i.loadingWin.close();else{var s=r.data[0].ID;tenantManager.getCompanyTemplateRepositoriesByID(s,function(r){for(var s=0;s<r.length;s++){if(e[s].isHANA!==a)continue;null==o||o=="WW"?r[s].Version==null||r[s].Version==""||r[s].Version=="Unknown"?n.push(r[s]):r[s].Version==u&&n.push(r[s]):r[s].Version==null||r[s].Version==""||r[s].Version=="Unknown"?n.push(r[s]):r[s].Version==u&&r[s].Localization==o&&n.push(r[s])}t.reload(),i.loadingWin.close()})}})}))}},c3newTenant.step_Common_SelectCustomer=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=localizedString("WIZARD_TENANT_HULIST"),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("MISC_CUSTNAME"),type:"text",width:"30%"},{name:"Type",description:localizedString("TNTCREATION_COLUMN_CTMTYPE"),type:"text",width:"30%"},{name:"InstallationNumber",description:localizedString("RES_LIC_INSTALLATION_NUM"),type:"text",width:"30%"}],r=this,i=null,s=[],o={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 347},getTip:function(){return Utility.CreateTipBoard(localizedString("CUSTOMER"),function(){var e=new c3newCustomer(r);e.show()})},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}else this.colName=="InstallationNumber"?this.data[this.colName]==="-1"&&(e="Trial Version"):this.colName=="Type"&&this.data[this.colName]==="TrialCustomer"&&(e="Trial Customer");return e}};this.onInit=function(){var t=$("<div>");i=t.gridview({delegate:o}),i.rowSelectedEvent.push(function(){e.TenantEntity.Customer=this.data,u()}),this._container.append(t),i.show();var n=new loadingWindow;r.loadingWin=n},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Customers,function(e){r.reload()})},this.onViewAppear=function(){a(),u(),e&&e.disableNext&&e.disableNext()};var u=function(){e&&e.readyForNext&&(e.TenantEntity.Customer?e.readyForNext():e.disableNext())};this.validator=new function(){var t=[],n=function(){function n(t){t.data&&parseInt(t.data)>=1?e.showError(localizedString("CUSTOMER_CREATION_TENANTS_GREATER_THAN_ONE")):i()}function r(){i()}function i(){t.length>0&&t[0]()}e.TenantEntity.Customer&&e.TenantEntity.Customer.Type==="TrialCustomer"?c3.service.getTenants().filter("Customer/ID eq "+e.TenantEntity.Customer.ID).count().query({success:n,error:r}):i()};this.validEvent=t,this.checkValidity=n},this.reload=function(){a()};var a=function(){s=[],r.loadingWin.show(),c3.service.getCustomers().filter("Status eq 'Online'").expand("Group,Group/Users,Reseller/Group").query(function(e){r.loadingWin.close(),s=e.data,i.reload()})}},c3newTenant.step_Common_SelectServiceUnit=function(){function l(t){if(e.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg||e.DBCreationStrategy==c3CompanyDBCreationStrategy.FromBackup)var n="Purpose ne 'Staging' and LicenseServer/Status eq 'Online' and Status eq 'Online' and CommonDatabase/DatabaseInstance/ServerType ne 'HANADB'";else var n="Purpose ne 'Staging' and LicenseServer/Status eq 'Online' and Status eq 'Online'";c3.service.getHostingUnits().filter(n+t).expand("Tenants,Tenants/CompanyDatabase,LicenseServer,LicenseServer/LicenseFiles, CommonDatabase, CommonDatabase/DatabaseInstance,CompanyTemplateRepository,SoftwareRepository,ImplementationRepository").query(function(t){if(e.TenantEntity.Customer.InstallationNumber==null||e.TenantEntity.Customer.InstallationNumber=="-1"){s=t.data;for(var n=0;n<t.data.length;n++)t.data[n].Tenants?s[n].TenantNum=t.data[n].Tenants.results.length:s[n].TenantNum=0}else if(t.data&&t.data.length>0)for(var n=0;n<t.data.length;n++){var o=!1;if(t.data[n].LicenseServer&&t.data[n].LicenseServer.LicenseFiles.results)for(var u=0;u<t.data[n].LicenseServer.LicenseFiles.results.length;u++)if(t.data[n].LicenseServer.LicenseFiles.results[u].InstallationNumber==e.TenantEntity.Customer.InstallationNumber){o=!0;break}o&&(t.data[n].Tenants?t.data[n].TenantNum=t.data[n].Tenants.results.length:t.data[n].TenantNum=0,s.push(t.data[n]))}i.reload(),r.loadingWin.close()})}this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=localizedString("WIZARD_TENANT_HULIST"),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"20%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"20%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"20%"},{name:"TenantNum",description:localizedString("COLUMN_CUSTNUM"),type:"text",width:"30%"}],r=this,i=null,s=[],o={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 347},getTip:function(){var t=c3.hasPermission([permissionItems.operator]);return t?e.DBCreationStrategy=="FromPkg"?u(localizedString("HOSTUNIT"),function(){var e=new c3huwizard(r);e.show()}):Utility.CreateTipBoard(localizedString("HOSTUNIT"),function(){var e=new c3huwizard(r);e.show()}):e.DBCreationStrategy=="FromPkg"?u(localizedString("HOSTUNIT"),null,!0):Utility.CreateTipBoard(localizedString("HOSTUNIT"),null,!0)},getCell:function(){var e=null;if(this.colName=="LicenseServer"){var t={};t.text=this.data[this.colName].Status,e=new statusControl(t)}if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}},u=function(e,t,n,r){var i=$("<span>"),s=$("<a href='#'>").append("Create");r==undefined?i.append("No "+e+"s based on Microsoft SQL server currently exist. "):i.append(r),s.click(function(){t&&t()});if(t!=null&&typeof t=="function"||n==0)i.append(s),i.append(" a new "+e+" based on Microsoft SQL server.");return i};this.onInit=function(){var t=$("<div>");i=t.gridview({delegate:o}),i.rowSelectedEvent.push(function(){e.TenantEntity.ServiceUnit=this.data,this.data.LicenseServer?e.TenantEntity.LicenseServer=this.data.LicenseServer:e.TenantEntity.LicenseServer=null,e.TenantEntity.DatabaseInstance=this.data.CommonDatabase.DatabaseInstance,a()}),this._container.append(t),i.show();var n=new loadingWindow;r.loadingWin=n},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){r.reload()})},this.onViewAppear=function(){f(),a(),e&&e.disableNext&&e.disableNext()};var a=function(){e&&e.readyForNext&&(e.TenantEntity.ServiceUnit&&e.TenantEntity.LicenseServer?e.readyForNext():e.disableNext())};this.reload=function(){f()};var f=function(){s=[];var t="";if(e.TrialRequest||e.TenantEntity.Purpose==="Trial"||e.TenantEntity.Customer.Type=="TrialCustomer")t=" and (Purpose eq 'Productive' or Purpose eq 'Trial')";r.loadingWin.show(),e.TenantEntity.Customer.Reseller!=undefined&&e.TenantEntity.Customer.Reseller.Group!=undefined&&c3.hasPermission([permissionItems.operator])?$.c3BaseClient.actAsGroups(e.TenantEntity.Customer.Reseller.Group.ID).toCall(function(){l(t)}):l(t)}},c3newTenant.step_Common_TenantInformation=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{};t.TenantEntity.CompanyDatabase={};var n={Name:{Name:localizedString("CUSTOMERCREATION_LABEL_TNTNAME"),Value:new textbox({isRequired:!0,maxlength:90,pattern:"[0-9a-zA-Z_-]*"})},DBName:{Name:localizedString("TNT_COLUMN_DBNAME"),Value:new textbox({isRequired:!0,maxlength:90,pattern:"[0-9a-zA-Z_]*"})},Purpose:{Name:localizedString("COLUMN_PURPOSE"),Value:new dropdownlist({isRequired:!0})},AuthenticationType:{Name:localizedString("COLUMN_AUTH"),Value:new dropdownlist({isRequired:!0})},TrialPeriod:{Name:localizedString("TNT_COLUMN_TRIALPRIOD"),Value:new textbox({isRequired:!0,pattern:"[0-9]*"})},ContactPerson:{Name:localizedString("COLUMN_CONTACTPERSON"),Value:new textbox({isRequired:!1})},Phone:{Name:localizedString("CUSTOMER_COLUMN_PHONE"),Value:new textbox({isRequired:!1})},Email:{Name:localizedString("CUSTOMER_COLUMN_EMAIL"),Value:new textbox({isRequired:!1})},Localization:{Name:localizedString("TNTCREATION_COLUMN_LOCALSETTING"),Value:new dropdownlist({isRequired:!0})},COA:{Name:localizedString("MISC_COA"),Value:new dropdownlist({isRequired:!0})},BaseLanguage:{Name:localizedString("TNTCREATION_COLUMN_BASELAN"),Value:new dropdownlist({isRequired:!0})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},r=new function(){var r=[],s=function(){function b(){r.length>0&&r[0]()}e.ldl=new loadingWindow,e.ldl.show(),t.TenantEntity.ContactPerson=n.ContactPerson.Value.val(),t.TenantEntity.Phone=n.Phone.Value.val(),t.TenantEntity.Email=n.Email.Value.val(),t.TenantEntity.Purpose=n.Purpose.Value.val(),t.TenantEntity.Description=n.Description.Value.val(),t.TenantEntity.CompanyDatabase.Name=n.Name.Value.val(),t.TenantEntity.CompanyDatabase.DBName=n.DBName.Value.val(),t.TenantEntity.CompanyDatabase.Localization=n.Localization.Value.val(),t.TenantEntity.CompanyDatabase.LocalizationTxt=n.Localization.Value.txt(),t.TenantEntity.CompanyDatabase.COA=n.COA.Value.val(),t.TenantEntity.CompanyDatabase.COATxt=n.COA.Value.txt(),t.TenantEntity.CompanyDatabase.BaseLanguage=n.BaseLanguage.Value.val(),t.TenantEntity.CompanyDatabase.BaseLanguageTxt=n.BaseLanguage.Value.txt(),n["AuthenticationType"].Value.val()==localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")?t.TenantEntity.CompanyDatabase.IsTrustedConnection=!0:t.TenantEntity.CompanyDatabase.IsTrustedConnection=!1,t.TenantEntity.CompanyDatabase.COA&&"UserDefined"==t.TenantEntity.CompanyDatabase.COA&&(t.TenantEntity.CompanyDatabase.COA="U");if(t.TenantEntity.Customer.InstallationNumber==null)t.TenantEntity.LicenseFile=null;else if(t.TenantEntity.Purpose=="Trial")t.TenantEntity.LicenseFile=null;else if(t.TenantEntity.LicenseServer.LicenseFiles&&t.TenantEntity.LicenseServer.LicenseFiles.results)for(var s=0;s<t.TenantEntity.LicenseServer.LicenseFiles.results.length;s++)if(t.TenantEntity.LicenseServer.LicenseFiles.results[s].InstallationNumber==t.TenantEntity.Customer.InstallationNumber){t.TenantEntity.LicenseFile=t.TenantEntity.LicenseServer.LicenseFiles.results[s];break}var o=i(t.TenantEntity.CompanyDatabase.DBName);if(!o)return e.ldl!=null&&e.ldl.close(),!1;var u=!0;if(n.Email.Value.val()&&n["Email"].Value.val()!=""){var a=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;u=a.test(n.Email.Value.val());if(!u)return n.Email.Value.showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH")),e.ldl!=null&&e.ldl.close(),!1}var f=!0;if(n.Phone.Value.val()&&n["Phone"].Value.val()!=""){var l=/^(\+\d{2,3} )*[\d]+(-[\d]+)*$/;f=l.test(n.Phone.Value.val());if(!f)return n.Phone.Value.showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH")),e.ldl!=null&&e.ldl.close(),!1}var c=!0;if(t.TenantEntity.Purpose=="Trial"){c=n.TrialPeriod.Value.checkValidity();if(c){t.TenantEntity.CompanyDatabase.TrialPeriod=parseInt(n.TrialPeriod.Value.val());if(t.TenantEntity.CompanyDatabase.TrialPeriod>93||t.TenantEntity.CompanyDatabase.TrialPeriod<=0)return c=c&&!1,n.TrialPeriod.Value.showErrorMessage(localizedString("TNT_CREATION_EXTDAY_LIMIT")),e.ldl!=null&&e.ldl.close(),!1}}else t.TenantEntity.CompanyDatabase.TrialPeriod=null;var h=!0;if(t.TenantEntity.Purpose=="Trial"&&t.TenantEntity.ServiceUnit){var p=t.TenantEntity.ServiceUnit.Version,d=p.split("."),v=parseInt(d.join(""));if(v<"88207007")return h=h&&!1,n.Purpose.Value.showErrorMessage(localizedString("TNT_CREATION_TRIAL_NOTSUPPORT")),e.ldl!=null&&e.ldl.close(),!1}var m=!0;if((!t.TenantEntity.CompanyDatabase.Localization||t.TenantEntity.CompanyDatabase.Localization=="")&&t.DBCreationStrategy!=c3CompanyDBCreationStrategy.FromBackup&&t.TenantEntity.Purpose=="Trial")return n.Localization.Value.showErrorMessage(localizedString("VALIDITY_VALUEMISSSING")),m=m&&!1,e.ldl!=null&&e.ldl.close(),!1;var g=!0;if(t.TenantEntity.Purpose!="Trial"&&t.TenantEntity.LicenseFile&&t.DBCreationStrategy!=c3CompanyDBCreationStrategy.FromBackup&&t.TenantEntity.LicenseFile.Localization!="WW"&&t.TenantEntity.LicenseFile.Localization!=t.TenantEntity.CompanyDatabase.Localization)return g=g&&!1,n.Localization.Value.showErrorMessage(localizedString("TENANT_LOCALIZATION_NOT_MATCHES")),e.ldl!=null&&e.ldl.close(),!1;var y=!0;t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromBackup?(t.TenantEntity.CompanyDatabase.creationOption=2,y=n.Name.Value.checkValidity()&&n.DBName.Value.checkValidity()&&o&&n.Purpose.Value.checkValidity()&&u&&f&&c&&h):t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg?(t.TenantEntity.CompanyDatabase.creationOption=1,y=n.Name.Value.checkValidity()&&n.DBName.Value.checkValidity()&&o&&n.Purpose.Value.checkValidity()&&u&&f&&c&&h&&m&&g&&n.BaseLanguage.Value.checkValidity()):(t.TenantEntity.CompanyDatabase.creationOption=0,y=n.Name.Value.checkValidity()&&n.DBName.Value.checkValidity()&&o&&n.Purpose.Value.checkValidity()&&u&&f&&c&&h&&m&&g&&n.Localization.Value.checkValidity()&&n.COA.Value.checkValidity()&&n.BaseLanguage.Value.checkValidity()),y?c3.service.getTenants().filter("CompanyDatabase/CompanyName eq '"+n.Name.Value.val()+"'").query(function(r){r.data&&r.data.length>0?(n.Name.Value.showErrorMessage(localizedString("TNT_CREATION_TNTNAME_EXIST")),e.ldl!=null&&e.ldl.close()):t.TenantEntity.ServiceUnit&&t.TenantEntity.ServiceUnit.CommonDatabase&&t.TenantEntity.ServiceUnit.CommonDatabase.DatabaseInstance?c3.service.checkDatabaseExist(t.TenantEntity.ServiceUnit.CommonDatabase.DatabaseInstance.ID,t.TenantEntity.CompanyDatabase.DBName).query({success:function(r){e.ldl!=null&&e.ldl.close(),r.data.CheckDatabaseExist?n.DBName.Value.showErrorMessage(localizedString("TNT_CREATION_DBNAME_EXIST")):b()},error:function(){e.ldl!=null&&e.ldl.close(),b()}}):(e.ldl!=null&&e.ldl.close(),b())}):e.ldl!=null&&e.ldl.close()};this.validEvent=r,this.checkValidity=s};this.validator=r,this.onInit=function(){n.Name.Value.bind("change",function(){var e=n.Name.Value.val();/[\u4E00-\u9FA5]/.test(e)==0&&n.DBName.Value.attr({value:n.Name.Value.val()})}),this._container.append(s()),o()};var i=function(e){var r=!0;if(t.TenantEntity.ServiceUnit&&t.TenantEntity.ServiceUnit.Tenants.results)for(var i=0;i<t.TenantEntity.ServiceUnit.Tenants.results.length;i++)if(e===t.TenantEntity.ServiceUnit.Tenants.results[i].CompanyDatabase.Name){r=!1,n.DBName.Value.showErrorMessage(localizedString("TNT_CREATION_DBNAME_EXIST"));break}return r},s=function(){var r=$("<div>");for(var i in n){if(t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromBackup)if(i=="Localization"||i=="COA"||i=="BaseLanguage")continue;if(t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg&&i=="COA")continue;var s=Utility.CreateRow(n[i].Name,n[i].Value);i=="TrialPeriod"&&(s=Utility.CreateRow(n[i].Name,n[i].Value," Days"),e.TrialPeriodRow=s,e.TrialPeriodRow.hide()),s.css({height:"18px"}),r.append(s)}return n.TrialPeriod.Value.css({width:"20%"}),n.TrialPeriod.Value.val("31"),t.TenantEntity&&t.TenantEntity.Customer&&(n.Email.Value.val(t.TenantEntity.Customer.Email),n.Phone.Value.val(t.TenantEntity.Customer.Phone),n.ContactPerson.Value.val(t.TenantEntity.Customer.ContactPerson)),r};this.onViewAppear=function(){u(t.TenantEntity),a()};var o=function(){n.Localization.Value.bind("change",function(){n.COA.Value.find("option").remove();var e=$(this).val();c3.service.getChartOfAccountList(t.TenantEntity.ServiceUnit.CommonDatabase.ID,e).query(function(e){var t=null;for(var r=0;r<e.data.length;r++)t=$("<option>").append(e.data[r]),n.COA.Value.append(t);t=$("<option>").attr({text:"User Defined",value:"UserDefined"}),n.COA.Value.append(t)})}),n.Purpose.Value.bind("change",function(){var n=$(this).val();n=="Trial"?(e.TrialPeriodRow.show(),f(t.TenantEntity,!0)):(e.TrialPeriodRow.hide(),f(t.TenantEntity))})},u=function(e){c3.service.getTenantPurpose(function(t){n.Purpose.Value.find("option").remove(),n.Purpose.Value.append($("<option>"));var r=null;for(var i=0;i<t.data.length;i++)r=$("<option>").append(t.data[i]),e&&e.Purpose==t.data[i]&&r.attr({selected:"selected"}),n.Purpose.Value.append(r);a()}),n.AuthenticationType.Value.find("option").remove();var r=null,i=null;r=$("<option>").append(localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")).attr({value:localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")}),i=$("<option>").append(localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")).attr({value:localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")});var s=t.TenantEntity.ServiceUnit.Version,o=s.split("."),u=parseInt(o.join(""));u>"88207300"?(i.attr({selected:"selected"}),n.AuthenticationType.Value.attr({disabled:0})):(r.attr({selected:"selected"}),n.AuthenticationType.Value.attr({disabled:1})),t.TenantEntity.DatabaseInstance.ServerType==="HANADB"&&(i.attr({selected:"selected"}),n.AuthenticationType.Value.attr({disabled:1})),n.AuthenticationType.Value.append(i),n.AuthenticationType.Value.append(r);var l=!1;if(n.Purpose.Value.val()&&n["Purpose"].Value.val()!=""&&n["Purpose"].Value.val()=="Trial"||t.TrialRequest||t.TenantEntity.ServiceUnit.Purpose=="Trial"||t.TenantEntity.Customer.Type=="TrialCustomer")l=!0;f(e,l),c3.service.getBaseLanguageList(t.TenantEntity.ServiceUnit.SoftwareRepository.ID).query(function(r){n.BaseLanguage.Value.find("option").remove(),n.BaseLanguage.Value.append($("<option>"));var i=r.data;for(var s=0;s<i.length;s++){var o=i[s].split(",");option=$("<option>").append(o[0]).attr({value:o[1]}),e&&e.CompanyDatabase.BaseLanguage==o[1]&&option.attr({selected:"selected"}),n.BaseLanguage.Value.append(option)}t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg&&n.BaseLanguage.Value.attr({disabled:1})})},a=function(){t.TrialRequest||t.TenantEntity.ServiceUnit.Purpose=="Trial"||t.TenantEntity.Customer.Type=="TrialCustomer"?(n.Purpose.Value.val("Trial"),n.Purpose.Value.attr({disabled:!0}),e.TrialPeriodRow.show()):(n.Purpose.Value.attr({disabled:!1}),t.TenantEntity&&t.TenantEntity.Purpose=="Trial"?e.TrialPeriodRow.show():e.TrialPeriodRow.hide())},f=function(e,r){c3.service.getLocalizationList(t.TenantEntity.ServiceUnit.CommonDatabase.ID).query(function(i){n.Localization.Value.find("option").remove(),n.Localization.Value.append($("<option>"));var s=null,o=!1,u=null;if(t.TenantEntity.Customer.InstallationNumber==null)o=!0;else if(t.TenantEntity.Customer&&t.TenantEntity.Customer.InstallationNumber=="-1"||r&&r==1)o=!0;else if(t.TenantEntity.LicenseServer.LicenseFiles&&t.TenantEntity.LicenseServer.LicenseFiles.results)for(var a=0;a<t.TenantEntity.LicenseServer.LicenseFiles.results.length;a++)if(t.TenantEntity.LicenseServer.LicenseFiles.results[a].InstallationNumber==t.TenantEntity.Customer.InstallationNumber){u=t.TenantEntity.LicenseServer.LicenseFiles.results[a],u.Localization==="WW"&&(o=!0);break}for(var a=0;a<i.data.length;a++)if(o){var f=i.data[a].split(",")[0];s=$("<option>").append(i.data[a]).attr({value:f}),t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg?e&&e.CompanyDatabase.PakLocalization==f&&s.attr({selected:"selected"}):e&&e.CompanyDatabase.Localization==f&&s.attr({selected:"selected"}),n.Localization.Value.append(s)}else{var f=i.data[a].split(",")[0];u&&f==u.Localization&&(s=$("<option>").append(i.data[a]).attr({value:f}),t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg?e&&e.CompanyDatabase.PakLocalization==f&&s.attr({selected:"selected"}):e&&e.CompanyDatabase.Localization==f&&s.attr({selected:"selected"}),n.Localization.Value.append(s))}t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg&&n.Localization.Value.attr({disabled:!0})})}},c3newTenant.step_Common_PostingPeriods=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t={},n={PCode:{Name:localizedString("WIZARD_CPYDB_PCODE"),Value:new textbox({isRequired:!0,maxlength:20})},PName:{Name:localizedString("WIZARD_CPYDB_PNAME"),Value:new textbox({isRequired:!0,maxlength:20})},PSubType:{Name:localizedString("WIZARD_CPYDB_PSUBTYPE"),Value:new dropdownlist({isRequired:!0})},PNumber:{Name:localizedString("WIZARD_CPYDB_PSUBNAME"),Value:new textbox({isRequired:!0,pattern:"\\d+"})},PDate:{Name:localizedString("WIZARD_CPYDB_PDATE"),Value:Utility.CreateDateFromTo(e.TenantEntity.CompanyDatabase,t)}},r=[{Name:localizedString("MISC_YEAR"),Value:"Y"},{Name:localizedString("MISC_QUARTER"),Value:"Q"},{Name:localizedString("MISC_MONTH"),Value:"M"},{Name:localizedString("MISC_DAY"),Value:"D"}],i=new function(){var r=function(){var r=e.TenantEntity.CompanyDatabase;r.PCode=n.PCode.Value.val(),r.PName=n.PName.Value.val(),r.PSubType=n.PSubType.Value.val(),r.PNum=parseInt(n.PNumber.Value.val());var i=n.PCode.Value.checkValidity()&&n.PName.Value.checkValidity()&&n.PSubType.Value.checkValidity()&&n.PNumber.Value.checkValidity()&&t.frombox.checkValidity()&&t.tobox.checkValidity();if(!i)return!1;var s=new Date(t.frombox.val()),o=new Date(t.tobox.val());if(s>o)return alert(localizedString("SU_CREATION_POSTINGPRID_DATECHECK")),!1;var u=$.datepicker.formatDate("yymmdd",s),a=$.datepicker.formatDate("yymmdd",o);if(!r.PStart||r.PStart!=u)r.PStart=u;if(!r.PEnd||r.PEnd!=a)r.PEnd=a;return!0};this.checkValidity=r};this.validator=i,this.onInit=function(){this._container.append(s()),n.PNumber.Value.attr({disabled:!0,value:1}),u(),o()};var s=function(){var e=$("<div>"),t=null;for(var r in n)t=Utility.CreateRow(n[r].Name,n[r].Value),"PDate"===r&&t.addClass("chooseFromDate"),e.append(t);return e};this.onViewAppear=function(){a(),e.TenantEntity.CompanyDatabase.PSubType=n.PSubType.Value.find("option:selected").val()};var o=function(){n.PSubType.Value.bind("change",function(){switch(n.PSubType.Value.val()){case"Y":n.PNumber.Value.attr({disabled:!0,value:1});break;case"Q":n.PNumber.Value.attr({disabled:!0,value:4});break;case"M":n.PNumber.Value.attr({disabled:!0,value:12});break;case"D":n.PNumber.Value.attr({disabled:!1,value:""})}})},u=function(){var e=(new Date).getFullYear();n.PCode.Value.val(e),n.PName.Value.val(e),t.frombox.val("01/01/"+e),t.tobox.val("12/31/"+e)},a=function(){var t=null;n.PSubType.Value.find("option").remove();for(var i=0;i<r.length;i++)t=$("<option>").append(r[i].Name),t.val(r[i].Value),e.TenantEntity.CompanyDatabase.PSubType==r[i].Value&&t.attr({selected:"selected"}),n.PSubType.Value.append(t)}},c3newTenant.step_Common_DeployExtensions=function(){function u(e){s=e.data,s.length==0&&(o.getTip=function(){return Utility.CreateTipBoard(localizedString("EXTENSION_LOWER"),null,!0)}),i.reload()}function a(t){e.TenantEntity.Extensions.push(s[t])}function f(t){for(var n=0;n<e.TenantEntity.Extensions.length;n++)if(s[t].ID==e.TenantEntity.Extensions[n].ID){e.TenantEntity.Extensions.remove(n);break}}this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=localizedString("WIZARD_TENANT_DEPLOYEXTENSION_STEP"),n=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"30%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"30%"},{name:"Provider",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"30%"}],r=this,i=null,s=[];e.TenantEntity.Extensions=[];var o={getHeaderSpec:function(){return n},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 347},removeCheckAll:function(){return!0}};this.onInit=function(){var e=$("<div>");i=e.gridview({delegate:o,checkType:1}),i.rowCheckEvent.push(function(){this.isChecked?a(this.index):f(this.index)}),this._container.append(e),i.show()},this.onViewAppear=function(){this.reload()},this.reload=function(){suManager.getExtensionsByCommonDB(e.TenantEntity.ServiceUnit.CommonDatabase.ID,u,e.TenantEntity.ServiceUnit.Version)}},c3newTenant.step_Common_AddUsers=function(){function g(e){var t=a[e];if(t&&t.LicenseModules&&t.OriginalLicenseModules&&h&&h.length>0)for(var n=0;n<h.length;n++){var r=h[n];r.CheckBox.attr({checked:!1});var i=parseInt(r.CountLabel.text()),s=!1;for(var o=0;o<t.LicenseModules.length;o++)if(r.Type===t.LicenseModules[o].Type){s=!0;break}var l=!1;for(var c=0;c<t.OriginalLicenseModules.length;c++)if(r.Type===t.OriginalLicenseModules[c].Type){l=!0;break}s&&!l?r.CountLabel.text(++i):!s&&l&&i>0&&r.CountLabel.text(--i)}a.remove(f),u.reload()}function y(n){f=n;var r=a[n];r&&(r.TODO="Modify");if(r&&r.LicenseModules){c.UpSelectedRowData=r;if(c.onRefresh)for(var i=0;i<c.onRefresh.length;i++)c.onRefresh[i]();if(0<a.length)for(var s=0;s<h.length;s++)h[s].CheckBox.attr({disabled:!1});else for(var s=0;s<h.length;s++)h[s].CheckBox.attr({disabled:!0})}else if(r&&t.TenantEntity.LicenseFile&&t.TenantEntity.LicenseFile.ID>0){e.loadingWin.show();var o={success:function(n){r.OriginalLicenseModules=[],r.LicenseModules=[];if(n.data&&n.data.length>0)for(var i=0;i<n.data.length;i++)r.LicenseModules.push({Type:n.data[i].Type}),r.OriginalLicenseModules.push({Type:n.data[i].Type});var s=t.ExistsTenants;if(s&&s.length>0)for(var i=0;i<s.length;i++)if(s[i].Users&&s[i].Users.length>0){var o=!1;for(var u=0;u<s[i].Users.length;u++)if(s[i].Users[u].SBOUser.toUpperCase()===r.B1Username.toUpperCase()&&s[i].Users[u].LicenseModules&&s[i].Users[u].LicenseModules.length>0){for(var a=0;a<s[i].Users[u].LicenseModules.length;a++)r.LicenseModules.push({Type:s[i].Users[u].LicenseModules[a]}),r.OriginalLicenseModules.push({Type:s[i].Users[u].LicenseModules[a]});o=!0;break}if(o)break}e.loadingWin.close()},error:function(){e.loadingWin.close()}};c3.service.getLicenseModulesBySBOUser(t.TenantEntity.LicenseFile.ID,r.B1Username).query(o)}else if(0<a.length&&n!=-1)for(var s=0;s<h.length;s++)h[s].CheckBox.attr({disabled:!1});else for(var s=0;s<h.length;s++)h[s].CheckBox.attr({disabled:!0})}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=$("<div>"),r=null,s=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"B1Username",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"27%"},{name:"SystemUsername",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"27%"},{name:"SuperUser",description:localizedString("B1_SUPERUSER"),type:"text",width:"18%"},{name:"PowerUser",description:localizedString("B1_POWERUSER"),type:"text",width:"18%"}],o=[{name:"Description",description:localizedString("COLUMN_B1USERTYPELIC"),type:"text",width:"35%"},{name:"",description:localizedString("COLUMN_USED"),type:"text",width:"10%"},{name:"",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"25%"},{name:"Quota",description:localizedString("COLUMN_QUOTA"),type:"text",width:"30%"}],u=null,a=[],f=0,l={getHeaderSpec:function(){return s},getRowCount:function(){return a.length},getRow:function(e){return a[e]},getGridHeight:function(){return 136},getDefaultSelectedIndex:function(){return f},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}if(this.colName=="SuperUser"||this.colName=="PowerUser")e=$("<input>").attr({type:"checkbox",disabled:"disabled",checked:this.data[this.colName]});return e}},c=null,h=[],p=[],d={getHeaderSpec:function(){return o},getRowCount:function(){return h.length},getRow:function(e){return h[e]},getGridHeight:function(){return 178}},v=$("<input>").attr({type:"button",value:localizedString("TENANT_EXTENSION_ASSIGN")}),m=$("<input>").attr({type:"button",value:localizedString("MISC_REMOVE")});v.click(function(){var n={CustomerID:t.TenantEntity.Customer.ID,CustomerGroupID:function(){var e=null;return t.TenantEntity.Customer.Group?e=t.TenantEntity.Customer.Group.ID:t.TenantEntity.Customer.Group_ID&&(e=t.TenantEntity.Customer.Group_ID),e}(),TenantID:t.TenantEntity.ID,TenantGroupID:t.TenantEntity.Group==null||t.TenantEntity.Group==undefined?undefined:t.TenantEntity.Group.ID,InstallationNumber:t.TenantEntity.Customer.InstallationNumber,TenantUsers:a,CustomerUsers:new function(){var e=[];if(t.TenantEntity.Customer.Users)for(var n=0;n<t.TenantEntity.Customer.Users.length;n++)e.push({ID:t.TenantEntity.Customer.Users[n].ID,systemUsername:t.TenantEntity.Customer.Users[n].SystemUser,status:t.TenantEntity.Customer.Users[n].Status});return e}},r=new c3addCustomerUsers(e,n);r.finishEvent.push(function(){w(r.selectedItems)}),r.show()}),m.click(function(){g(f),y(f)}),this.onInit=function(){var t=$("<div>").append(v).addClass("tools toolsbar"),n=$("<div>").addClass("tblUp");u=n.gridview({delegate:l}),u.rowSelectedEvent.push(function(){y(this.index)});var r=$("<div>").addClass("tblDown");c=r.gridview({delegate:d}),this._container.append(t),this._container.append(n),this._container.append(r),u.show(),c.show(),b();var i=new loadingWindow;e.loadingWin=i},validator=new function(){var e=[],n=function(){function o(){E(a),e.length>0&&e[0]()}var n=!1;for(i=0,ii=a.length;i<ii;i++)i<ii-1&&a[i].B1Username==a[i+1].B1Username&&(n=!0);n&&t.showError(localizedString("TNT_CREATION_USERCODE_REPEATED"));if(!n&&t.TenantEntity.Purpose==="Trial"){var r={};r.success=function(e){var n=e.d.results;if(n){var r=0;for(var i=0;i<a.length;i++){var s=!1;for(var u=0;u<n.length;u++)if(a[i].SystemUsername==n[u].SystemUsername){s=!0;break}s||r++}r>2?t.showError(localizedString("TNT_CREATION_TRIAL_TWOUSERS")):o()}else o()},r.error=function(e){o()};var s={};c3.service.getOperators(s,r)}else n||o()};this.validEvent=e,this.checkValidity=n},this.validator=validator;var b=function(){function r(e){var n=t.ExistsTenants;if(n&&n.length>0&&e.data&&e.data.length>0)for(var r=0;r<n.length;r++)if(n[r].Users&&n[r].Users.length>0)for(var i=0;i<n[r].Users.length;i++)if(n[r].Users[i].LicenseModules&&n[r].Users[i].LicenseModules.length>0)for(var s=0;s<n[r].Users[i].LicenseModules.length;s++)for(var o=0;o<e.data.length;o++)n[r].Users[i].LicenseModules[s]===e.data[o].Type&&--e.data[o].Available;h=e.data;for(var r=0;r<e.data.length;r++)typeof t.TenantEntity.Customer.ID!="undefined"?e.data[r].TotalQuota==null?e.data[r].TotalQuota=localizedString("UNLIMTIED"):e.data[r].Quota=e.data[r].TotalQuota:e.data[r].Quota=localizedString("UNLIMTIED");p=[];for(var r=0;r<e.data.length;r++)p.push(c3.service.cloneObj(e.data[r]));d.getCell=function(){if(1==this.col){var e=$("<input>").attr({type:"checkbox",disabled:"disabled"}),n=$("<label>").text(parseInt(this.data.Available)),r=this.data;this.data.CountLabel=n,this.data.CheckBox=e;var i=this;return c.onRefresh.push(function(){if(null!=c.UpSelectedRowData&&0<c.UpSelectedRowData.LicenseModules.length)for(var t=0;t<c.UpSelectedRowData.LicenseModules.length;t++){if(c.UpSelectedRowData.LicenseModules[t].Type==i.data.Type){e.attr("checked")||e.attr({checked:!0});break}e.attr("checked")&&e.attr({checked:!1})}else e.attr("checked")&&e.attr({checked:!1})}),e.bind("click",{gridData:this.data},function(t){var n={},r="";n=$(t.data.gridData.CountLabel).text().split("/"),n.length==2?r="/"+parseInt(n[1]):r="";var i=parseInt($(t.data.gridData.CountLabel).text());if(0>=i&&$(this).attr("checked"))$(this).attr({checked:!1});else if(0==i&&!$(this).attr("checked")){$(t.data.gridData.CountLabel).text(++i+r),++t.data.gridData.Available;for(var s=0;s<c.UpSelectedRowData.LicenseModules.length;s++)if(t.data.gridData.Type==c.UpSelectedRowData.LicenseModules[s].Type){c.UpSelectedRowData.LicenseModules.remove(s);break}}else if(e.attr("checked"))$(t.data.gridData.CountLabel).text(--i+r),--t.data.gridData.Available,c.UpSelectedRowData.LicenseModules.push({Type:t.data.gridData.Type});else{$(t.data.gridData.CountLabel).text(++i+r),++t.data.gridData.Available;for(var s=0;s<c.UpSelectedRowData.LicenseModules.length;s++)if(t.data.gridData.Type==c.UpSelectedRowData.LicenseModules[s].Type){c.UpSelectedRowData.LicenseModules.remove(s);break}}}),e}if(2==this.col)return this.data.CountLabel?(typeof t.TenantEntity.Customer.ID=="undefined"?this.data.CountLabel.text(this.data.CountLabel.text()+"/"+(this.data.Total-this.data.TotalQuota)):this.data.CountLabel.text(this.data.CountLabel.text()+"/"+this.data.Total),this.data.CountLabel):0;3==this.col&&typeof this.data[this.colName]=="undefined"&&(this.data[this.colName]=localizedString("UNLIMTIED"))},c.onRefresh=[],c.reload()}for(var n=0;n<a.length;n++)a[n].LicenseModules=undefined,data=a[n],y(n),e.loadingWindow&&e.loadingWindow.close(),a[n].LicenseModules=a[n].OriginalLicenseModules;y(-1),u.reload(),t.TenantEntity.Purpose!=="Trial"&&t.TenantEntity.LicenseServer&&t.TenantEntity.Customer&&t.TenantEntity.Customer.InstallationNumber?c3.service.getLicenseFiles().filter("InstallationNumber eq '"+t.TenantEntity.Customer.InstallationNumber+"' and LicenseServer/ID eq "+t.TenantEntity.LicenseServer.ID).query(function(e){e.data&&e.data.length>0&&(typeof t.TenantEntity.Customer.ID!="undefined"?c3.service.getLicenseModulesPerCustomer(e.data[0].ID,t.TenantEntity.Customer.ID).query(r):c3.service.getLicenseModulesPerCustomer(e.data[0].ID,null).query(r))}):(h=[],p=[],c.reload())};this.onViewAppear=function(){t&&t.readyForNext&&t.readyForNext(),t.TenantEntity?v.attr({disabled:!1}):v.attr({disabled:!0}),a||(a=[]),u.reload(),b()};var w=function(e){if(e){var n=[];for(var r=0;r<p.length;r++)n.push(c3.service.cloneObj(p[r]));h=n,t.LicenseModules=n,c.reload(),a=[];for(var i=0;i<e.length;i++){var s={};s.ID=e[i].ID,s.SystemUsername=e[i].SystemUsername,s.B1Username=e[i].B1Username,s.Status=e[i].Status,s.SuperUser=e[i].SuperUser,s.PowerUser=e[i].PowerUser;var o=!1;for(var r=0;r<a.length;r++)if(a[r].SystemUsername==s.SystemUsername){o=!0;break}o||a.push(s)}for(var r=0;r<a.length;r++)f=r,a[r]!==undefined&&(a[r].LicenseModules=undefined),y(f);f=-1,y(f),u.reload()}},E=function(e){t.TenantEntity.Users=[];for(var n=0;n<e.length;n++){var r={SystemUser:e[n].SystemUsername,SBOUser:e[n].B1Username,OSUserBinding:e[n].SystemUsername,Status:e[n].Status,LicenseModules:[],IsSuperUser:e[n].SuperUser,IsPowerUser:e[n].PowerUser};if(t.TenantEntity.Purpose!=="Trial"&&e[n].LicenseModules)if(e[n].TODO&&e[n].TODO=="Modify")for(var i=0;i<e[n].LicenseModules.length;i++)r.LicenseModules.push(e[n].LicenseModules[i].Type);else r.LicenseModules=null;else r.LicenseModules=null;t.TenantEntity.Users.push(r)}}},c3newTenant.step_Common_SelectSBOSharedFolder=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"8%"},{name:"URI",description:localizedString("MISC_PATH"),type:"text",width:"92%"}],r=null,i=[],s={getHeaderSpec:function(){return n},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 310},getTip:function(){return Utility.CreateTipBoard(localizedString("TENANT_SHARED_FOLDER_TITLE"),function(){var t=new c3registerB1Share("SBOSharedFolder",e);t.show()})},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}};this.reload=function(){o()},this.onInit=function(){var e=$("<div>"),n=$("<div>");r=n.gridview({delegate:s}),r.rowSelectedEvent.push(function(){var e=this.index,n=i[e];t.TenantEntity.SBOSharedFolder={ID:n.ID},u()}),r.show(),e.append(n),this._container.append(e),o()};var o=function(){c3.service.getB1SharedFolders().filter("TenantID eq null").query(function(e){i=[];if(e.data)for(var t=0;t<e.data.length;t++)i.push(e.data[t]);r.reload()})},u=function(){if(t&&t.readyForNext&&t.TenantEntity.SBOSharedFolder&&t.TenantEntity.SBOSharedFolder.ID&&t.TenantEntity.SBOSharedFolder.ID>0){t.readyForNext();return}t.disableNext()};this.onViewAppear=function(){t.TenantEntity.SBOSharedFolder&&t.TenantEntity.SBOSharedFolder.ID&&(t.TenantEntity.SBOSharedFolder=null),o(),u()}},c3newTenant.step_Review=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=[{name:"SystemUser",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"20%"},{name:"UserCode",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"20%"},{name:"LicenseModulesString",description:localizedString("WIZARD_TENANT_LIVMDL"),type:"text",width:"60%"}],r=null,i=[],s={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 180}};this.onInit=function(){var e=$("<div>").attr("class","review"),n=$("<div>").attr("class","block");n.append($("<div>").attr("class","blockHeader").append(localizedString("CUSTOMER"))),t.TenantEntity.Customer!=null&&(n.append($("<div>").attr("class","row").append(localizedString("COLUMN_MSSQL_NAME")+": "+t.TenantEntity.Customer.Name)),n.append($("<div>").attr("class","row").append(localizedString("MISC_TYPE")+": "+t.TenantEntity.Customer.Type)),n.append($("<div>").attr("class","row").append(localizedString("RES_LIC_INSTALLATION_NUM")+": "+t.TenantEntity.Customer.InstallationNumber))),e.append(n);var o=$("<div>").attr("class","block");o.append($("<div>").attr("class","blockHeader").append(localizedString("HOSTUNIT"))),t.TenantEntity.ServiceUnit!=null&&(o.append($("<div>").attr("class","row").append(localizedString("COLUMN_MSSQL_NAME")+": "+t.TenantEntity.ServiceUnit.Name)),o.append($("<div>").attr("class","row").append(localizedString("MISC_TYPE")+": "+t.TenantEntity.ServiceUnit.Purpose)),o.append($("<div>").attr("class","row").append(localizedString("MISC_VERSION")+": "+t.TenantEntity.ServiceUnit.Version))),e.append(o);var u=$("<div>").attr("class","block");u.append($("<div>").attr("class","blockHeader").append(localizedString("TENANT"))),t.TenantEntity!=null&&t.TenantEntity.CompanyDatabase!=null&&(u.append($("<div>").attr("class","row").append(localizedString("COLUMN_MSSQL_NAME")+": "+t.TenantEntity.CompanyDatabase.Name)),u.append($("<div>").attr("class","row").append(localizedString("TNT_COLUMN_DBNAME")+": "+t.TenantEntity.CompanyDatabase.DBName)),u.append($("<div>").attr("class","row").append(localizedString("COLUMN_PURPOSE")+": "+t.TenantEntity.Purpose))),e.append(u);var a=$("<div>").attr("class","block");a.append($("<div>").attr("class","blockHeader").append(localizedString("TENANT_LICENSE_ASSIGN_TITLE")));if(t.TenantEntity.Users!=null&&t.TenantEntity.Users.length>0){var f=$("<div>");r=f.gridview({delegate:s}),r.show(),i=[];for(var l=0;l<t.TenantEntity.Users.length;l++){var c="";if(t.TenantEntity.Users[l].LicenseModules!=null&&t.TenantEntity.Users[l].LicenseModules.length>0)for(var h=0;h<t.TenantEntity.Users[l].LicenseModules.length;h++){var p="";for(var d=0;d<t.LicenseModules.length;d++)if(t.LicenseModules[d].Type==t.TenantEntity.Users[l].LicenseModules[h]){p=t.LicenseModules[d].Description;break}h<t.TenantEntity.Users[l].LicenseModules.length-1?c+=p+", ":c+=p}var v=localizedString("B1_NORMALUSER");t.TenantEntity.Users[l].IsPowerUser==1&&(v=localizedString("B1_POWERUSER")),t.TenantEntity.Users[l].IsSuperUser==1&&(v=localizedString("B1_SUPERUSER")),i.push({SystemUser:t.TenantEntity.Users[l].SystemUser,UserCode:t.TenantEntity.Users[l].SBOUser,UserType:v,LicenseModulesString:c})}r.reload(),a.append(f)}e.append(a),this._container.append(e)},this.onViewAppear=function(){this._container.html(""),this.onInit()}},c3newTenant.step_Common_Finish=function(){function s(r){var i={};e._container.append(Utility.CreateProgressRow("Creating Tenant",function(){var e=this;o(r,e)},i)),i.progressBar.finishEvent.push(function(){t&&t.readyForNext&&t.readyForNext()}),n.push(i);for(var s=0;s<n.length;s++)n[s].progressBar.start()}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=[],r=0,i={success:function(e){r=e.d.CreateTenantAsync,s(r)},error:function(e){r=-1,s(r)}};this.onInit=function(){t.disableBack(),t.disableCancel(),t.disableNext(),c3.hasPermission([permissionItems.operator])?tenantManager.createTenant(t.TenantEntity,t.LicenseModules,i):(e.load1=new loadingWindow,e.load1.show(),tenantManager.createTenant(t.TenantEntity,t.LicenseModules,{success:function(n){var r=n.d.CreateTenantAsync;r!=null&&r>0&&c3.service.getTasks(r).query(function(n){if(n.data!=null)if(n.data.Status=="WaitingForApproval"){var i=$("<div>").attr("class","rar_request_panel").css({"line-height":"25px",margin:"0 20px 0 20px"}).append(localizedString("VARREQUEST_NEEDAPPROVE"));e._container.append(i),t.readyForNext(),e.load1.close()}else s(r),e.load1.close()})},error:function(t){s(-1),e.load1.close()}}))};var o=function(e,t){e>0?c3.service.getTaskProgress(e).query(function(n){var r=n.data.GetTaskProperties.split(",");"Failed"==r[0]||"Cancelled"==r[0]||"Rollback"==r[0]?c3.service.getTasks(e).expand("TaskParameters").query(function(e){t.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)}):"Successful"==r[0]?t.setValue(100):t.setValue(parseInt(r[1]))}):-1===e?t.setFailed():t.setValue(0)}},c3registerTenant.step_Common_SelectCustomer=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=localizedString("WIZARD_TENANT_HULIST"),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("MISC_CUSTNAME"),type:"text",width:"30%"},{name:"Type",description:localizedString("TNTCREATION_COLUMN_CTMTYPE"),type:"text",width:"30%"},{name:"InstallationNumber",description:localizedString("RES_LIC_INSTALLATION_NUM"),type:"text",width:"30%"}],r=this,i=null,s=[],o={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 347},getTip:function(){return Utility.CreateTipBoard(localizedString("CUSTOMER"),function(){var e=new c3newCustomer(r);e.show()})},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}else this.colName=="InstallationNumber"?this.data[this.colName]==="-1"&&(e="Trial Version"):this.colName=="Type"&&this.data[this.colName]==="TrialCustomer"&&(e="Trial Customer");return e}};this.onInit=function(){var t=$("<div>");i=t.gridview({delegate:o}),i.rowSelectedEvent.push(function(){e.TenantEntity.Customer=this.data,u()}),this._container.append(t),i.show();var n=new loadingWindow;r.loadingWin=n},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Customers,function(e){r.reload()})},this.onViewAppear=function(){a(),u(),e&&e.disableNext&&e.disableNext()};var u=function(){e&&e.readyForNext&&(e.TenantEntity.Customer?e.readyForNext():e.disableNext())};this.validator=new function(){var t=[],n=function(){function n(t){t.data&&parseInt(t.data)>=1?e.showError(localizedString("CUSTOMER_CREATION_TENANTS_GREATER_THAN_ONE")):i()}function r(){i()}function i(){t.length>0&&t[0]()}e.TenantEntity.Customer&&e.TenantEntity.Customer.Type==="TrialCustomer"?c3.service.getTenants().filter("Customer/ID eq "+e.TenantEntity.Customer.ID).count().query({success:n,error:r}):i()};this.validEvent=t,this.checkValidity=n},this.reload=function(){a()};var a=function(){s=[],r.loadingWin.show(),c3.service.getCustomers().filter("Status eq 'Online'").expand("Group,Group/Users,Reseller/Group").query(function(e){r.loadingWin.close(),s=e.data,i.reload()})}},c3registerTenant.step_Common_SelectServiceUnit=function(){function l(t){if(e.DBCreationStrategy=="FromPkg")var n="Purpose ne 'Staging' and LicenseServer/Status eq 'Online' and Status eq 'Online' and CommonDatabase/DatabaseInstance/ServerType ne 'HANADB'";else var n="Purpose ne 'Staging' and LicenseServer/Status eq 'Online' and Status eq 'Online'";c3.service.getHostingUnits().filter(n+t).expand("Tenants,Tenants/CompanyDatabase,LicenseServer,LicenseServer/LicenseFiles, CommonDatabase, CommonDatabase/DatabaseInstance,CompanyTemplateRepository,SoftwareRepository,ImplementationRepository").query(function(t){if(e.TenantEntity.Customer.InstallationNumber==null||e.TenantEntity.Customer.InstallationNumber=="-1"){s=t.data;for(var n=0;n<t.data.length;n++)t.data[n].Tenants?s[n].TenantNum=t.data[n].Tenants.results.length:s[n].TenantNum=0}else if(t.data&&t.data.length>0)for(var n=0;n<t.data.length;n++){var o=!1;if(t.data[n].LicenseServer&&t.data[n].LicenseServer.LicenseFiles.results)for(var u=0;u<t.data[n].LicenseServer.LicenseFiles.results.length;u++)if(t.data[n].LicenseServer.LicenseFiles.results[u].InstallationNumber==e.TenantEntity.Customer.InstallationNumber){o=!0;break}o&&(t.data[n].Tenants?t.data[n].TenantNum=t.data[n].Tenants.results.length:t.data[n].TenantNum=0,s.push(t.data[n]))}i.reload(),r.loadingWin.close()})}this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=localizedString("WIZARD_TENANT_HULIST"),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"20%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"20%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"20%"},{name:"TenantNum",description:localizedString("COLUMN_CUSTNUM"),type:"text",width:"30%"}],r=this,i=null,s=[],o={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 347},getTip:function(){var t=c3.hasPermission([permissionItems.operator]);return t?e.DBCreationStrategy=="FromPkg"?u(localizedString("HOSTUNIT"),function(){var e=new c3huwizard(r);e.show()}):Utility.CreateTipBoard(localizedString("HOSTUNIT"),function(){var e=new c3huwizard(r);e.show()}):e.DBCreationStrategy=="FromPkg"?u(localizedString("HOSTUNIT"),null,!0):Utility.CreateTipBoard(localizedString("HOSTUNIT"),null,!0)},getCell:function(){var e=null;if(this.colName=="LicenseServer"){var t={};t.text=this.data[this.colName].Status,e=new statusControl(t)}if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}},u=function(e,t,n,r){var i=$("<span>"),s=$("<a href='#'>").append("Create");r==undefined?i.append("No "+e+"s based on SQL server currently exist. "):i.append(r),s.click(function(){t&&t()});if(t!=null&&typeof t=="function"||n==0)i.append(s),i.append(" a new "+e+" based on SQL server.");return i};this.onInit=function(){var t=$("<div>");i=t.gridview({delegate:o}),i.rowSelectedEvent.push(function(){e.TenantEntity.ServiceUnit=this.data,this.data.LicenseServer?e.TenantEntity.LicenseServer=this.data.LicenseServer:e.TenantEntity.LicenseServer=null,e.TenantEntity.DatabaseInstance=this.data.CommonDatabase.DatabaseInstance,a()}),this._container.append(t),i.show();var n=new loadingWindow;r.loadingWin=n},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){r.reload()})},this.onViewAppear=function(){f(),a(),e&&e.disableNext&&e.disableNext()};var a=function(){e&&e.readyForNext&&(e.TenantEntity.ServiceUnit&&e.TenantEntity.LicenseServer?e.readyForNext():e.disableNext())};this.reload=function(){f()};var f=function(){s=[];var t="";if(e.TrialRequest||e.TenantEntity.Purpose==="Trial"||e.TenantEntity.Customer.Type=="TrialCustomer")t=" and (Purpose eq 'Productive' or Purpose eq 'Trial')";r.loadingWin.show(),e.TenantEntity.Customer.Reseller!=undefined&&e.TenantEntity.Customer.Reseller.Group!=undefined&&c3.hasPermission([permissionItems.operator])?$.c3BaseClient.actAsGroups(e.TenantEntity.Customer.Reseller.Group.ID).toCall(function(){l(t)}):l(t)}},c3registerTenant.step_Common_TenantInformation=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{};t.TenantEntity.CompanyDatabase={};var n={DBName:{Name:localizedString("TNT_COLUMN_DBNAME"),Value:new dropdownlist({isRequired:!0})},Name:{Name:localizedString("CUSTOMERCREATION_LABEL_TNTNAME"),Value:new textbox({isRequired:!0,maxlength:90,pattern:"[0-9a-zA-Z_-]*"})},Localization:{Name:localizedString("TNTREGISTRATION_LABEL_LOCALIZATION"),Value:(new textbox({isRequired:!0,maxlength:90})).attr({disabled:!0})},Version:{Name:localizedString("TNTREGISTRATION_LABEL_VERSION"),Value:(new textbox({isRequired:!0,maxlength:90})).attr({disabled:!0})},Purpose:{Name:localizedString("COLUMN_PURPOSE"),Value:new dropdownlist({isRequired:!0})},AuthenticationType:{Name:localizedString("COLUMN_AUTH"),Value:new dropdownlist({isRequired:!0})},TrialPeriod:{Name:localizedString("TNT_COLUMN_TRIALPRIOD"),Value:new textbox({isRequired:!0,pattern:"[0-9]*"})},ContactPerson:{Name:localizedString("COLUMN_CONTACTPERSON"),Value:new textbox({isRequired:!1})},Phone:{Name:localizedString("CUSTOMER_COLUMN_PHONE"),Value:new textbox({isRequired:!1})},Email:{Name:localizedString("CUSTOMER_COLUMN_EMAIL"),Value:new textbox({isRequired:!1})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}};n.DBName.Value.attr({id:"DBName"});var r=new function(){var r=[],s=function(){function y(){r.length>0&&r[0]()}e.ldl=new loadingWindow,e.ldl.show(),t.TenantEntity.ContactPerson=n.ContactPerson.Value.val(),t.TenantEntity.Phone=n.Phone.Value.val(),t.TenantEntity.Email=n.Email.Value.val(),t.TenantEntity.Purpose=n.Purpose.Value.val(),t.TenantEntity.Description=n.Description.Value.val(),t.TenantEntity.CompanyDatabase.Name=n.Name.Value.val(),t.TenantEntity.CompanyDatabase.DBName=n.DBName.Value.val(),t.TenantEntity.CompanyDatabase.Localization=n.Localization.Value.val(),t.TenantEntity.CompanyDatabase.COA="U",t.TenantEntity.CompanyDatabase.BaseLanguage=1,t.TenantEntity.CompanyDatabase.PCode=(new Date).getFullYear(),t.TenantEntity.CompanyDatabase.PName=(new Date).getFullYear(),t.TenantEntity.CompanyDatabase.PSubType=1,t.TenantEntity.CompanyDatabase.PNum=1,t.TenantEntity.CompanyDatabase.PStart="01/01/"+t.TenantEntity.CompanyDatabase.PCode,t.TenantEntity.CompanyDatabase.PEnd="12/31/"+t.TenantEntity.CompanyDatabase.PCode,n["AuthenticationType"].Value.val()==localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")?t.TenantEntity.CompanyDatabase.IsTrustedConnection=!0:t.TenantEntity.CompanyDatabase.IsTrustedConnection=!1,t.TenantEntity.CompanyDatabase.COA&&"UserDefined"==t.TenantEntity.CompanyDatabase.COA&&(t.TenantEntity.CompanyDatabase.COA="U");if(t.TenantEntity.Customer.InstallationNumber==null)t.TenantEntity.LicenseFile=null;else if(t.TenantEntity.Purpose=="Trial")t.TenantEntity.LicenseFile=null;else if(t.TenantEntity.LicenseServer.LicenseFiles&&t.TenantEntity.LicenseServer.LicenseFiles.results)for(var s=0;s<t.TenantEntity.LicenseServer.LicenseFiles.results.length;s++)if(t.TenantEntity.LicenseServer.LicenseFiles.results[s].InstallationNumber==t.TenantEntity.Customer.InstallationNumber){t.TenantEntity.LicenseFile=t.TenantEntity.LicenseServer.LicenseFiles.results[s];break}var o=i(t.TenantEntity.CompanyDatabase.DBName);if(!o)return e.ldl!=null&&e.ldl.close(),!1;var u=!0;if(n.Email.Value.val()&&n["Email"].Value.val()!=""){var a=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;u=a.test(n.Email.Value.val());if(!u)return n.Email.Value.showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH")),e.ldl!=null&&e.ldl.close(),!1}var f=!0;if(n.Phone.Value.val()&&n["Phone"].Value.val()!=""){var l=/^(\+\d{2,3} )*[\d]+(-[\d]+)*$/;f=l.test(n.Phone.Value.val());if(!f)return n.Phone.Value.showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH")),e.ldl!=null&&e.ldl.close(),!1}var c=!0;if(t.TenantEntity.Purpose=="Trial"){c=n.TrialPeriod.Value.checkValidity();if(c){t.TenantEntity.CompanyDatabase.TrialPeriod=parseInt(n.TrialPeriod.Value.val());if(t.TenantEntity.CompanyDatabase.TrialPeriod>93||t.TenantEntity.CompanyDatabase.TrialPeriod<=0)return c=c&&!1,n.TrialPeriod.Value.showErrorMessage(localizedString("TNT_CREATION_EXTDAY_LIMIT")),e.ldl!=null&&e.ldl.close(),!1}}else t.TenantEntity.CompanyDatabase.TrialPeriod=null;var h=!0;if(t.TenantEntity.Purpose=="Trial"&&t.TenantEntity.ServiceUnit){var p=t.TenantEntity.ServiceUnit.Version,d=p.split("."),v=parseInt(d.join(""));if(v<"88207007")return h=h&&!1,n.Purpose.Value.showErrorMessage(localizedString("TNT_CREATION_TRIAL_NOTSUPPORT")),e.ldl!=null&&e.ldl.close(),!1}var m=!0;if(t.TenantEntity.Purpose!="Trial"&&t.TenantEntity.LicenseFile&&t.DBCreationStrategy!=c3CompanyDBCreationStrategy.FromBackup&&t.TenantEntity.LicenseFile.Localization!="WW"&&t.TenantEntity.LicenseFile.Localization!=t.TenantEntity.CompanyDatabase.Localization)return m=m&&!1,n.Localization.Value.showErrorMessage(localizedString("TENANT_LOCALIZATION_NOT_MATCHES")),e.ldl!=null&&e.ldl.close(),!1;var g=!0;t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromBackup?(t.TenantEntity.CompanyDatabase.creationOption=2,g=n.Name.Value.checkValidity()&&n.DBName.Value.checkValidity()&&o&&n.Purpose.Value.checkValidity()&&u&&f&&c&&h):t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg?(t.TenantEntity.CompanyDatabase.creationOption=1,g=n.Name.Value.checkValidity()&&n.DBName.Value.checkValidity()&&o&&n.Purpose.Value.checkValidity()&&u&&f&&c&&h&&m&&n.BaseLanguage.Value.checkValidity()):(t.TenantEntity.CompanyDatabase.creationOption=0,g=n.Name.Value.checkValidity()&&n.DBName.Value.checkValidity()&&o&&n.Purpose.Value.checkValidity()&&u&&f&&c&&h&&m),g?c3.service.getTenants().filter("CompanyDatabase/CompanyName eq '"+n.Name.Value.val()+"'").query(function(r){r.data&&r.data.length>0?(n.Name.Value.showErrorMessage(localizedString("TNT_CREATION_TNTNAME_EXIST")),e.ldl!=null&&e.ldl.close()):t.TenantEntity.ServiceUnit&&t.TenantEntity.ServiceUnit.CommonDatabase&&t.TenantEntity.ServiceUnit.CommonDatabase.DatabaseInstance?c3.service.checkDatabaseExist(t.TenantEntity.ServiceUnit.CommonDatabase.DatabaseInstance.ID,t.TenantEntity.CompanyDatabase.DBName).query({success:function(r){e.ldl!=null&&e.ldl.close(),r.data.CheckDatabaseExist?y():n.DBName.Value.showErrorMessage(localizedString("TNT_CREATION_DBNAME_NOT_EXIST"))},error:function(){e.ldl!=null&&e.ldl.close(),y()}}):(e.ldl!=null&&e.ldl.close(),y())}):e.ldl!=null&&e.ldl.close()};this.validEvent=r,this.checkValidity=s};this.validator=r,this.onInit=function(){n.DBName.Value.bind("change",function(){for(var e=0;e<$("#DBName")[0].options.length;e++)$("#DBName")[0].options[e].getAttribute("value")==n["DBName"].Value.val()&&(n.Name.Value.val($("#DBName")[0].options[e].getAttribute("companyName")),n.Localization.Value.val($("#DBName")[0].options[e].getAttribute("localization")),n.Version.Value.val($("#DBName")[0].options[e].getAttribute("version")))}),this._container.append(s()),u()};var i=function(e){var r=!0;if(t.TenantEntity.ServiceUnit&&t.TenantEntity.ServiceUnit.Tenants.results)for(var i=0;i<t.TenantEntity.ServiceUnit.Tenants.results.length;i++)if(e===t.TenantEntity.ServiceUnit.Tenants.results[i].CompanyDatabase.Name){r=!1,n.DBName.Value.showErrorMessage(localizedString("TNT_CREATION_DBNAME_EXIST"));break}return r},s=function(){var r=$("<div>");for(var i in n){if(t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromBackup)if(i=="Localization"||i=="COA"||i=="BaseLanguage")continue;if(t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg&&i=="COA")continue;var s=Utility.CreateRow(n[i].Name,n[i].Value);i=="TrialPeriod"&&(s=Utility.CreateRow(n[i].Name,n[i].Value," Days"),e.TrialPeriodRow=s,e.TrialPeriodRow.hide()),s.css({height:"18px"}),r.append(s)}return n.TrialPeriod.Value.css({width:"20%"}),n.TrialPeriod.Value.val("31"),t.TenantEntity&&t.TenantEntity.Customer&&(n.Email.Value.val(t.TenantEntity.Customer.Email),n.Phone.Value.val(t.TenantEntity.Customer.Phone),n.ContactPerson.Value.val(t.TenantEntity.Customer.ContactPerson)),r};this.onViewAppear=function(){a(t.TenantEntity),f()};var o=function(){c3.service.getDbInstanceCompaniesList(t.TenantEntity.DatabaseInstance.ID,!0).query({success:function(t){n.DBName.Value.find("option").remove();if(t&&t.data){t.data.sort(function(e,t){return e.Name.localeCompare(t.Name)});for(var r=0;r<t.data.length;r++){var i=t.data[r].Name,s=$("<option>").append(t.data[r].Name).attr({value:i,companyName:t.data[r].CompanyName,localization:t.data[r].Localization,version:t.data[r].Version});n.DBName.Value.append(s)}if(n.DBName.Value.val())for(var r=0;r<$("#DBName")[0].options.length;r++)$("#DBName")[0].options[r].getAttribute("value")==n["DBName"].Value.val()&&(n.Name.Value.val($("#DBName")[0].options[r].getAttribute("companyName")),n.Localization.Value.val($("#DBName")[0].options[r].getAttribute("localization")),n.Version.Value.val($("#DBName")[0].options[r].getAttribute("version")))}},error:function(){}})},u=function(){n.Purpose.Value.bind("change",function(){var t=$(this).val();t=="Trial"?e.TrialPeriodRow.show():e.TrialPeriodRow.hide()})},a=function(e){c3.service.getTenantPurpose(function(t){n.Purpose.Value.find("option").remove(),n.Purpose.Value.append($("<option>"));var r=null;for(var i=0;i<t.data.length;i++)r=$("<option>").append(t.data[i]),e&&e.Purpose==t.data[i]&&r.attr({selected:"selected"}),n.Purpose.Value.append(r);f()}),n.AuthenticationType.Value.find("option").remove();var r=null,i=null;r=$("<option>").append(localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")).attr({value:localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")}),i=$("<option>").append(localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")).attr({value:localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")});var s=t.TenantEntity.ServiceUnit.Version,u=s.split("."),a=parseInt(u.join(""));a>"88207300"?(i.attr({selected:"selected"}),n.AuthenticationType.Value.attr({disabled:0})):(r.attr({selected:"selected"}),n.AuthenticationType.Value.attr({disabled:1})),t.TenantEntity.DatabaseInstance.ServerType==="HANADB"&&(i.attr({selected:"selected"}),n.AuthenticationType.Value.attr({disabled:1})),n.AuthenticationType.Value.append(i),n.AuthenticationType.Value.append(r);var l=!1;if(n.Purpose.Value.val()&&n["Purpose"].Value.val()!=""&&n["Purpose"].Value.val()=="Trial"||t.TrialRequest||t.TenantEntity.ServiceUnit.Purpose=="Trial"||t.TenantEntity.Customer.Type=="TrialCustomer")l=!0;o()},f=function(){t.TrialRequest||t.TenantEntity.ServiceUnit.Purpose=="Trial"||t.TenantEntity.Customer.Type=="TrialCustomer"?(n.Purpose.Value.val("Trial"),n.Purpose.Value.attr({disabled:!0}),e.TrialPeriodRow.show()):(n.Purpose.Value.attr({disabled:!1}),t.TenantEntity&&t.TenantEntity.Purpose=="Trial"?e.TrialPeriodRow.show():e.TrialPeriodRow.hide())},l=function(e,r){c3.service.getLocalizationList(t.TenantEntity.ServiceUnit.CommonDatabase.ID).query(function(i){n.Localization.Value.find("option").remove(),n.Localization.Value.append($("<option>"));var s=null,o=!1,u=null;if(t.TenantEntity.Customer.InstallationNumber==null)o=!0;else if(t.TenantEntity.Customer&&t.TenantEntity.Customer.InstallationNumber=="-1"||r&&r==1)o=!0;else if(t.TenantEntity.LicenseServer.LicenseFiles&&t.TenantEntity.LicenseServer.LicenseFiles.results)for(var a=0;a<t.TenantEntity.LicenseServer.LicenseFiles.results.length;a++)if(t.TenantEntity.LicenseServer.LicenseFiles.results[a].InstallationNumber==t.TenantEntity.Customer.InstallationNumber){u=t.TenantEntity.LicenseServer.LicenseFiles.results[a],u.Localization==="WW"&&(o=!0);break}for(var a=0;a<i.data.length;a++)if(o){var f=i.data[a].split(",")[0];s=$("<option>").append(i.data[a]).attr({value:f}),t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg?e&&e.CompanyDatabase.PakLocalization==f&&s.attr({selected:"selected"}):e&&e.CompanyDatabase.Localization==f&&s.attr({selected:"selected"}),n.Localization.Value.append(s)}else{var f=i.data[a].split(",")[0];u&&f==u.Localization&&(s=$("<option>").append(i.data[a]).attr({value:f}),t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg?e&&e.CompanyDatabase.PakLocalization==f&&s.attr({selected:"selected"}):e&&e.CompanyDatabase.Localization==f&&s.attr({selected:"selected"}),n.Localization.Value.append(s))}t.DBCreationStrategy==c3CompanyDBCreationStrategy.FromPkg&&n.Localization.Value.attr({disabled:!0})})}},c3registerTenant.step_Common_PostingPeriods=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t={},n={PCode:{Name:localizedString("WIZARD_CPYDB_PCODE"),Value:new textbox({isRequired:!0,maxlength:20})},PName:{Name:localizedString("WIZARD_CPYDB_PNAME"),Value:new textbox({isRequired:!0,maxlength:20})},PSubType:{Name:localizedString("WIZARD_CPYDB_PSUBTYPE"),Value:new dropdownlist({isRequired:!0})},PNumber:{Name:localizedString("WIZARD_CPYDB_PSUBNAME"),Value:new textbox({isRequired:!0,pattern:"\\d+"})},PDate:{Name:localizedString("WIZARD_CPYDB_PDATE"),Value:Utility.CreateDateFromTo(e.TenantEntity.CompanyDatabase,t)}},r=[{Name:localizedString("MISC_YEAR"),Value:"Y"},{Name:localizedString("MISC_QUARTER"),Value:"Q"},{Name:localizedString("MISC_MONTH"),Value:"M"},{Name:localizedString("MISC_DAY"),Value:"D"}],i=new function(){var r=function(){var r=e.TenantEntity.CompanyDatabase;r.PCode=n.PCode.Value.val(),r.PName=n.PName.Value.val(),r.PSubType=n.PSubType.Value.val(),r.PNum=parseInt(n.PNumber.Value.val());var i=n.PCode.Value.checkValidity()&&n.PName.Value.checkValidity()&&n.PSubType.Value.checkValidity()&&n.PNumber.Value.checkValidity()&&t.frombox.checkValidity()&&t.tobox.checkValidity();if(!i)return!1;var s=new Date(t.frombox.val()),o=new Date(t.tobox.val());if(s>o)return alert(localizedString("SU_CREATION_POSTINGPRID_DATECHECK")),!1;var u=$.datepicker.formatDate("yymmdd",s),a=$.datepicker.formatDate("yymmdd",o);if(!r.PStart||r.PStart!=u)r.PStart=u;if(!r.PEnd||r.PEnd!=a)r.PEnd=a;return!0};this.checkValidity=r};this.validator=i,this.onInit=function(){this._container.append(s()),n.PNumber.Value.attr({disabled:!0,value:1}),o(),u()};var s=function(){var e=$("<div>"),t=null;for(var r in n)t=Utility.CreateRow(n[r].Name,n[r].Value),"PDate"===r&&t.addClass("chooseFromDate"),e.append(t);return e};this.onViewAppear=function(){a(),e.TenantEntity.CompanyDatabase.PSubType=n.PSubType.Value.find("option:selected").val()};var o=function(){var e=(new Date).getFullYear();n.PCode.Value.val(e),n.PName.Value.val(e),t.frombox.val("01/01/"+e),t.tobox.val("12/31/"+e)},u=function(){n.PSubType.Value.bind("change",function(){switch(n.PSubType.Value.val()){case"Y":n.PNumber.Value.attr({disabled:!0,value:1});break;case"Q":n.PNumber.Value.attr({disabled:!0,value:4});break;case"M":n.PNumber.Value.attr({disabled:!0,value:12});break;case"D":n.PNumber.Value.attr({disabled:!1,value:""})}})},a=function(){var t=null;n.PSubType.Value.find("option").remove();for(var i=0;i<r.length;i++)t=$("<option>").append(r[i].Name),t.val(r[i].Value),e.TenantEntity.CompanyDatabase.PSubType==r[i].Value&&t.attr({selected:"selected"}),n.PSubType.Value.append(t)}},c3registerTenant.step_Common_AddUsers=function(){function g(e){var t=a[e];if(t&&t.LicenseModules&&t.OriginalLicenseModules&&h&&h.length>0)for(var n=0;n<h.length;n++){var r=h[n];r.CheckBox.attr({checked:!1});var i=parseInt(r.CountLabel.text()),s=!1;for(var o=0;o<t.LicenseModules.length;o++)if(r.Type===t.LicenseModules[o].Type){s=!0;break}var l=!1;for(var c=0;c<t.OriginalLicenseModules.length;c++)if(r.Type===t.OriginalLicenseModules[c].Type){l=!0;break}s&&!l?r.CountLabel.text(++i):!s&&l&&i>0&&r.CountLabel.text(--i)}a.remove(f),u.reload()}function y(n){f=n;var r=a[n];r&&(r.TODO="Modify");if(r&&r.LicenseModules){c.UpSelectedRowData=r;if(c.onRefresh)for(var i=0;i<c.onRefresh.length;i++)c.onRefresh[i]();if(0<a.length)for(var s=0;s<h.length;s++)h[s].CheckBox.attr({disabled:!1});else for(var s=0;s<h.length;s++)h[s].CheckBox.attr({disabled:!0})}else if(r&&t.TenantEntity.LicenseFile&&t.TenantEntity.LicenseFile.ID>0){e.loadingWin.show();var o={success:function(n){r.OriginalLicenseModules=[],r.LicenseModules=[];if(n.data&&n.data.length>0)for(var i=0;i<n.data.length;i++)r.LicenseModules.push({Type:n.data[i].Type}),r.OriginalLicenseModules.push({Type:n.data[i].Type});var s=t.ExistsTenants;if(s&&s.length>0)for(var i=0;i<s.length;i++)if(s[i].Users&&s[i].Users.length>0){var o=!1;for(var u=0;u<s[i].Users.length;u++)if(s[i].Users[u].SBOUser.toUpperCase()===r.B1Username.toUpperCase()&&s[i].Users[u].LicenseModules&&s[i].Users[u].LicenseModules.length>0){for(var a=0;a<s[i].Users[u].LicenseModules.length;a++)r.LicenseModules.push({Type:s[i].Users[u].LicenseModules[a]}),r.OriginalLicenseModules.push({Type:s[i].Users[u].LicenseModules[a]});o=!0;break}if(o)break}e.loadingWin.close()},error:function(){e.loadingWin.close()}};c3.service.getLicenseModulesBySBOUser(t.TenantEntity.LicenseFile.ID,r.B1Username).query(o)}else if(0<a.length&&n!=-1)for(var s=0;s<h.length;s++)h[s].CheckBox.attr({disabled:!1});else for(var s=0;s<h.length;s++)h[s].CheckBox.attr({disabled:!0})}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=$("<div>"),r=null,s=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"B1Username",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"27%"},{name:"SystemUsername",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"27%"},{name:"SuperUser",description:localizedString("B1_SUPERUSER"),type:"text",width:"18%"},{name:"PowerUser",description:localizedString("B1_POWERUSER"),type:"text",width:"18%"}],o=[{name:"Description",description:localizedString("COLUMN_B1USERTYPELIC"),type:"text",width:"35%"},{name:"",description:localizedString("COLUMN_USED"),type:"text",width:"10%"},{name:"",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"25%"},{name:"Quota",description:localizedString("COLUMN_QUOTA"),type:"text",width:"30%"}],u=null,a=[],f=0,l={getHeaderSpec:function(){return s},getRowCount:function(){return a.length},getRow:function(e){return a[e]},getGridHeight:function(){return 136},getDefaultSelectedIndex:function(){return f},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}if(this.colName=="SuperUser"||this.colName=="PowerUser")e=$("<input>").attr({type:"checkbox",disabled:"disabled",checked:this.data[this.colName]});return e}},c=null,h=[],p=[],d={getHeaderSpec:function(){return o},getRowCount:function(){return h.length},getRow:function(e){return h[e]},getGridHeight:function(){return 178}},v=$("<input>").attr({type:"button",value:localizedString("TENANT_EXTENSION_ASSIGN")}),m=$("<input>").attr({type:"button",value:localizedString("MISC_REMOVE")});v.click(function(){var n={CustomerID:t.TenantEntity.Customer.ID,CustomerGroupID:function(){var e=null;return t.TenantEntity.Customer.Group?e=t.TenantEntity.Customer.Group.ID:t.TenantEntity.Customer.Group_ID&&(e=t.TenantEntity.Customer.Group_ID),e}(),TenantID:t.TenantEntity.ID,TenantGroupID:t.TenantEntity.Group==null||t.TenantEntity.Group==undefined?undefined:t.TenantEntity.Group.ID,InstallationNumber:t.TenantEntity.Customer.InstallationNumber,TenantUsers:a,CustomerUsers:new function(){var e=[];if(t.TenantEntity.Customer.Users)for(var n=0;n<t.TenantEntity.Customer.Users.length;n++)e.push({ID:t.TenantEntity.Customer.Users[n].ID,systemUsername:t.TenantEntity.Customer.Users[n].SystemUser,status:t.TenantEntity.Customer.Users[n].Status});return e}},r=new c3addCustomerUsers(e,n);r.finishEvent.push(function(){w(r.selectedItems)}),r.show()}),m.click(function(){g(f),y(f)}),this.onInit=function(){var t=$("<div>").append(v).addClass("tools toolsbar"),n=$("<div>").addClass("tblUp");u=n.gridview({delegate:l}),u.rowSelectedEvent.push(function(){y(this.index)});var r=$("<div>").addClass("tblDown");c=r.gridview({delegate:d}),this._container.append(t),this._container.append(n),this._container.append(r),u.show(),c.show(),b();var i=new loadingWindow;e.loadingWin=i},validator=new function(){var e=[],n=function(){function o(){E(a),e.length>0&&e[0]()}var n=!1;for(i=0,ii=a.length;i<ii;i++)i<ii-1&&a[i].B1Username==a[i+1].B1Username&&(n=!0);n&&t.showError(localizedString("TNT_CREATION_USERCODE_REPEATED"));if(!n&&t.TenantEntity.Purpose==="Trial"){var r={};r.success=function(e){var n=e.d.results;if(n){var r=0;for(var i=0;i<a.length;i++){var s=!1;for(var u=0;u<n.length;u++)if(a[i].SystemUsername==n[u].SystemUsername){s=!0;break}s||r++}r>2?t.showError(localizedString("TNT_CREATION_TRIAL_TWOUSERS")):o()}else o()},r.error=function(e){o()};var s={};c3.service.getOperators(s,r)}else n||o()};this.validEvent=e,this.checkValidity=n},this.validator=validator;var b=function(){function r(e){var n=t.ExistsTenants;if(n&&n.length>0&&e.data&&e.data.length>0)for(var r=0;r<n.length;r++)if(n[r].Users&&n[r].Users.length>0)for(var i=0;i<n[r].Users.length;i++)if(n[r].Users[i].LicenseModules&&n[r].Users[i].LicenseModules.length>0)for(var s=0;s<n[r].Users[i].LicenseModules.length;s++)for(var o=0;o<e.data.length;o++)n[r].Users[i].LicenseModules[s]===e.data[o].Type&&--e.data[o].Available;h=e.data;for(var r=0;r<e.data.length;r++)typeof t.TenantEntity.Customer.ID!="undefined"?e.data[r].TotalQuota==null?e.data[r].TotalQuota=localizedString("UNLIMTIED"):e.data[r].Quota=e.data[r].TotalQuota:e.data[r].Quota=localizedString("UNLIMTIED");p=[];for(var r=0;r<e.data.length;r++)p.push(c3.service.cloneObj(e.data[r]));d.getCell=function(){if(1==this.col){var e=$("<input>").attr({type:"checkbox",disabled:"disabled"}),n=$("<label>").text(parseInt(this.data.Available)),r=this.data;this.data.CountLabel=n,this.data.CheckBox=e;var i=this;return c.onRefresh.push(function(){if(null!=c.UpSelectedRowData&&0<c.UpSelectedRowData.LicenseModules.length)for(var t=0;t<c.UpSelectedRowData.LicenseModules.length;t++){if(c.UpSelectedRowData.LicenseModules[t].Type==i.data.Type){e.attr("checked")||e.attr({checked:!0});break}e.attr("checked")&&e.attr({checked:!1})}else e.attr("checked")&&e.attr({checked:!1})}),e.bind("click",{gridData:this.data},function(t){var n={},r="";n=$(t.data.gridData.CountLabel).text().split("/"),n.length==2?r="/"+parseInt(n[1]):r="";var i=parseInt($(t.data.gridData.CountLabel).text());if(0>=i&&$(this).attr("checked"))$(this).attr({checked:!1});else if(0==i&&!$(this).attr("checked")){$(t.data.gridData.CountLabel).text(++i+r),++t.data.gridData.Available;for(var s=0;s<c.UpSelectedRowData.LicenseModules.length;s++)if(t.data.gridData.Type==c.UpSelectedRowData.LicenseModules[s].Type){c.UpSelectedRowData.LicenseModules.remove(s);break}}else if(e.attr("checked"))$(t.data.gridData.CountLabel).text(--i+r),--t.data.gridData.Available,c.UpSelectedRowData.LicenseModules.push({Type:t.data.gridData.Type});else{$(t.data.gridData.CountLabel).text(++i+r),++t.data.gridData.Available;for(var s=0;s<c.UpSelectedRowData.LicenseModules.length;s++)if(t.data.gridData.Type==c.UpSelectedRowData.LicenseModules[s].Type){c.UpSelectedRowData.LicenseModules.remove(s);break}}}),e}if(2==this.col)return this.data.CountLabel?(typeof t.TenantEntity.Customer.ID=="undefined"?this.data.CountLabel.text(this.data.CountLabel.text()+"/"+(this.data.Total-this.data.TotalQuota)):this.data.CountLabel.text(this.data.CountLabel.text()+"/"+this.data.Total),this.data.CountLabel):0;3==this.col&&typeof this.data[this.colName]=="undefined"&&(this.data[this.colName]=localizedString("UNLIMTIED"))},c.onRefresh=[],c.reload()}for(var n=0;n<a.length;n++)a[n].LicenseModules=undefined,data=a[n],y(n),e.loadingWindow&&e.loadingWindow.close(),a[n].LicenseModules=a[n].OriginalLicenseModules;y(-1),u.reload(),t.TenantEntity.Purpose!=="Trial"&&t.TenantEntity.LicenseServer&&t.TenantEntity.Customer&&t.TenantEntity.Customer.InstallationNumber?c3.service.getLicenseFiles().filter("InstallationNumber eq '"+t.TenantEntity.Customer.InstallationNumber+"' and LicenseServer/ID eq "+t.TenantEntity.LicenseServer.ID).query(function(e){e.data&&e.data.length>0&&(typeof t.TenantEntity.Customer.ID!="undefined"?c3.service.getLicenseModulesPerCustomer(e.data[0].ID,t.TenantEntity.Customer.ID).query(r):c3.service.getLicenseModulesPerCustomer(e.data[0].ID,null).query(r))}):(h=[],p=[],c.reload())};this.onViewAppear=function(){t&&t.readyForNext&&t.readyForNext(),t.TenantEntity?v.attr({disabled:!1}):v.attr({disabled:!0}),a||(a=[]),u.reload(),b()};var w=function(e){if(e){var n=[];for(var r=0;r<p.length;r++)n.push(c3.service.cloneObj(p[r]));h=n,t.LicenseModules=n,c.reload(),a=[];for(var i=0;i<e.length;i++){var s={};s.ID=e[i].ID,s.SystemUsername=e[i].SystemUsername,s.B1Username=e[i].B1Username,s.Status=e[i].Status,s.SuperUser=e[i].SuperUser,s.PowerUser=e[i].PowerUser;var o=!1;for(var r=0;r<a.length;r++)if(a[r].SystemUsername==s.SystemUsername){o=!0;break}o||a.push(s)}for(var r=0;r<a.length;r++)f=r,a[r]!==undefined&&(a[r].LicenseModules=undefined),y(f);f=-1,y(f),u.reload()}},E=function(e){t.TenantEntity.Users=[];for(var n=0;n<e.length;n++){var r={SystemUser:e[n].SystemUsername,SBOUser:e[n].B1Username,OSUserBinding:e[n].SystemUsername,Status:e[n].Status,LicenseModules:[],IsSuperUser:e[n].SuperUser,IsPowerUser:e[n].PowerUser};if(t.TenantEntity.Purpose!=="Trial"&&e[n].LicenseModules)if(e[n].TODO&&e[n].TODO=="Modify")for(var i=0;i<e[n].LicenseModules.length;i++)r.LicenseModules.push(e[n].LicenseModules[i].Type);else r.LicenseModules=null;else r.LicenseModules=null;t.TenantEntity.Users.push(r)}}},c3registerTenant.step_Review=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=[{name:"SystemUser",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"20%"},{name:"UserCode",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"20%"},{name:"LicenseModulesString",description:localizedString("WIZARD_TENANT_LIVMDL"),type:"text",width:"60%"}],r=null,i=[],s={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 180}};this.onInit=function(){var e=$("<div>").attr("class","review"),n=$("<div>").attr("class","block");n.append($("<div>").attr("class","blockHeader").append(localizedString("CUSTOMER"))),t.TenantEntity.Customer!=null&&(n.append($("<div>").attr("class","row").append(localizedString("COLUMN_MSSQL_NAME")+": "+t.TenantEntity.Customer.Name)),n.append($("<div>").attr("class","row").append(localizedString("MISC_TYPE")+": "+t.TenantEntity.Customer.Type)),n.append($("<div>").attr("class","row").append(localizedString("RES_LIC_INSTALLATION_NUM")+": "+t.TenantEntity.Customer.InstallationNumber))),e.append(n);var o=$("<div>").attr("class","block");o.append($("<div>").attr("class","blockHeader").append(localizedString("HOSTUNIT"))),t.TenantEntity.ServiceUnit!=null&&(o.append($("<div>").attr("class","row").append(localizedString("COLUMN_MSSQL_NAME")+": "+t.TenantEntity.ServiceUnit.Name)),o.append($("<div>").attr("class","row").append(localizedString("MISC_TYPE")+": "+t.TenantEntity.ServiceUnit.Purpose)),o.append($("<div>").attr("class","row").append(localizedString("MISC_VERSION")+": "+t.TenantEntity.ServiceUnit.Version))),e.append(o);var u=$("<div>").attr("class","block");u.append($("<div>").attr("class","blockHeader").append(localizedString("TENANT"))),t.TenantEntity!=null&&t.TenantEntity.CompanyDatabase!=null&&(u.append($("<div>").attr("class","row").append(localizedString("COLUMN_MSSQL_NAME")+": "+t.TenantEntity.CompanyDatabase.Name)),u.append($("<div>").attr("class","row").append(localizedString("TNT_COLUMN_DBNAME")+": "+t.TenantEntity.CompanyDatabase.DBName)),u.append($("<div>").attr("class","row").append(localizedString("COLUMN_PURPOSE")+": "+t.TenantEntity.Purpose))),e.append(u);var a=$("<div>").attr("class","block");a.append($("<div>").attr("class","blockHeader").append(localizedString("TENANT_LICENSE_ASSIGN_TITLE")));if(t.TenantEntity.Users!=null&&t.TenantEntity.Users.length>0){var f=$("<div>");r=f.gridview({delegate:s}),r.show(),i=[];for(var l=0;l<t.TenantEntity.Users.length;l++){var c="";if(t.TenantEntity.Users[l].LicenseModules!=null&&t.TenantEntity.Users[l].LicenseModules.length>0)for(var h=0;h<t.TenantEntity.Users[l].LicenseModules.length;h++){var p="";for(var d=0;d<t.LicenseModules.length;d++)if(t.LicenseModules[d].Type==t.TenantEntity.Users[l].LicenseModules[h]){p=t.LicenseModules[d].Description;break}h<t.TenantEntity.Users[l].LicenseModules.length-1?c+=p+", ":c+=p}var v=localizedString("B1_NORMALUSER");t.TenantEntity.Users[l].IsPowerUser==1&&(v=localizedString("B1_POWERUSER")),t.TenantEntity.Users[l].IsSuperUser==1&&(v=localizedString("B1_SUPERUSER")),i.push({SystemUser:t.TenantEntity.Users[l].SystemUser,UserCode:t.TenantEntity.Users[l].SBOUser,UserType:v,LicenseModulesString:c})}r.reload(),a.append(f)}e.append(a),this._container.append(e)},this.onViewAppear=function(){this._container.html(""),this.onInit()}},c3registerTenant.step_Common_Finish=function(){function s(r){var i={};e._container.append(Utility.CreateProgressRow("Creating Tenant",function(){var e=this;o(r,e)},i)),i.progressBar.finishEvent.push(function(){t&&t.readyForNext&&t.readyForNext()}),n.push(i);for(var s=0;s<n.length;s++)n[s].progressBar.start()}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=[],r=0,i={success:function(e){r=e.d.RegisterTenantAsync,s(r)},error:function(e){r=-1,s(r)}};this.onInit=function(){t.disableBack(),t.disableCancel(),t.disableNext(),c3.hasPermission([permissionItems.operator])?tenantManager.registerTenant(t.TenantEntity,t.LicenseModules,i):(e.load1=new loadingWindow,e.load1.show(),tenantManager.registerTenant(t.TenantEntity,t.LicenseModules,{success:function(n){var r=n.d.CreateTenantAsync;r!=null&&r>0&&c3.service.getTasks(r).query(function(n){if(n.data!=null)if(n.data.Status=="WaitingForApproval"){var i=$("<div>").attr("class","rar_request_panel").css({"line-height":"25px",margin:"0 20px 0 20px"}).append(localizedString("VARREQUEST_NEEDAPPROVE"));e._container.append(i),t.readyForNext(),e.load1.close()}else s(r),e.load1.close()})},error:function(t){s(-1),e.load1.close()}}))};var o=function(e,t){e>0?c3.service.getTaskProgress(e).query(function(n){var r=n.data.GetTaskProperties.split(",");"Failed"==r[0]||"Cancelled"==r[0]||"Rollback"==r[0]?c3.service.getTasks(e).expand("TaskParameters").query(function(e){t.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)}):"Successful"==r[0]?t.setValue(100):t.setValue(parseInt(r[1]))}):-1===e?t.setFailed():t.setValue(0)}},c3newSBOCommon.step1=function(){function i(){c3.service.getSWRepositories().count().query(s),c3.service.getDBServerInstances().count().query(o),c3.service.getCommonDBs().count().query(l)}function s(e){self.SWrepositoryCountLabel.empty(),e.data==0?self.SWrepositoryCountLabel.append(e.data).addClass("alert_text"):self.SWrepositoryCountLabel.append(e.data).addClass("icon_title")}function o(e){self.DBinstanceCountLabel.empty(),e.data==0?self.DBinstanceCountLabel.append(e.data).addClass("alert_text"):self.DBinstanceCountLabel.append(e.data).addClass("icon_title")}function u(){var e=$("<div>"),t=$("<section>").addClass("icon_DBInstance"),n=$("<section>").append(localizedString("RES_MS_SQL")).addClass("icon_title");return box_count=$("<section>").addClass("icon_title").append("(").append(self.DBinstanceCountLabel).append(")"),e.append($("<div>").css({"float":"none"}).append(t).append(n).append(box_count)),e}function a(){var e=$("<div>"),t=$("<section>").addClass("icon_SWRepository"),n=$("<section>").append(localizedString("SOFTWAREREPO")).addClass("icon_title");return box_count=$("<section>").addClass("icon_title").append("(").append(self.SWrepositoryCountLabel).append(")"),e.append($("<div>").css({"float":"none"}).append(t).append(n).append(box_count)),e}function f(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_SBOCOMMON(e)}),t=$("<section>").addClass("icon_SBOCOMMON"),n=$("<section>").append(localizedString("RES_SBO_COMMON")).addClass("icon_title"),r=$("<section>").addClass("icon_title").append("(").append(self.commonDBCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function l(e){self.commonDBCountLabel.empty(),e.data==0?self.commonDBCountLabel.append(e.data).addClass("alert_text"):self.commonDBCountLabel.append(e.data).addClass("icon_title")}function h(){c3.service.getDBServerInstances().expand("Machine, CommonDatabases").filter("Status eq 'Online' and LifeCycleStatus eq 'Running'").query(function(e){t.ChoseMSSQL.Value.find("option").remove(),t.ChoseMSSQL.Value.append($("<option>"));var n=null;for(var r=0;r<e.data.length;r++){var i=e.data[r].CommonDatabases.length;i=i==null?e.data[r].CommonDatabases.results.length:i,e.data[r].Machine&&0>=i&&(n=$("<option>").attr({value:e.data[r].ID,"data-version":e.data[r].ServerVersion,"data-server_type":e.data[r].ServerType}).append(e.data[r].Name),t.ChoseMSSQL.Value.append(n))}})}function p(e){var n=null;isHANA(e)?n="HANAenabled eq true":isMSSQL(e)&&(n="SQLenabled eq true"),n&&c3.service.getSWRepositories().filter(n).query(function(e){t.Version.Value.find("option").remove(),t.Version.Value.append($("<option>"));var n=null;for(var r=0;r<e.data.length;r++)n=$("<option>").append(e.data[r].Version).attr({value:e.data[r].ID}),t.Version.Value.append(n)})}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t={ChoseMSSQL:{Name:localizedString("WIZARD_SBO_MSSQLINST"),Value:new dropdownlist({isRequired:!0})},Name:{Name:localizedString("MISC_NAME"),Value:$("<input>").val("SBO-COMMON").attr({disabled:"disabled"})},Version:{Name:localizedString("MISC_VERSION"),Value:new dropdownlist({isRequired:!0})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},n={checkValidity:function(){return e.SBOCommonEntity.DBName=t.Name.Value.val(),e.SBOCommonEntity.DBInstanceID=parseInt(t.ChoseMSSQL.Value.val()),e.SBOCommonEntity.SoftwareRepositoryID=parseInt(t.Version.Value.val()),e.SBOCommonEntity.Description=t.Description.Value.val(),t.ChoseMSSQL.Value.checkValidity()&&t.Version.Value.checkValidity()}};this.validator=n,this.reset=function(){i(),c(),t.ChoseMSSQL.Value.val(""),t.Version.Value.val(""),t.Description.Value.val("")},this.onInit=function(){var e=localizedString("WIZARD_NEWSBO_GUIDE_TITLE"),n=localizedString("WIZARD_NEWSBO_GUIDE_DESCRIPTION"),s=$("<div>").addClass("guide_main"),o=$("<div>").addClass("element_group").css({width:"450px",height:"82px"}),l=$("<div>").addClass("element_box1"),c=$("<div>").addClass("element_box1"),h=$("<div>").addClass("element_box1"),p=$("<div>").addClass("element_box1");self.SWrepositoryCountLabel=$("<label>"),self.DBinstanceCountLabel=$("<label>"),self.commonDBCountLabel=$("<label>"),s.append(o),o.append(l).append(c).append(h).append(p),l.append(u()),c.append(a()),h.append($("<div>").addClass("right_arrow")),p.append(f()),i(),this._container.append($("<fieldset>").css({height:"150px","margin-bottom":"5px"}).append($("<legend>").append($("<span>").css("font-weight","bold").append(e))).append($("<div>").addClass("guide_description").append(n)).append(s));for(var d in t){var v=Utility.CreateRow(t[d].Name,t[d].Value);d==="ChoseMSSQL"&&v.css({"margin-bottom":"0"}),this._container.append(v)}var m=c3.service.isEditableCommonDatabaseName();m.query(function(e){var n=e.data.IsEditableCommonDatabaseName;n&&t.Name.Value.removeAttr("disabled")}),r()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.DatabaseInstances,function(e){h(),c3.service.getDBServerInstances().count().query(o)}),cometdManager.subscribe(sldEntitySet.CommonDatabases,function(e){c3.service.getCommonDBs().count().query(l)})};var r=function(){t.ChoseMSSQL.Value.bind("change",function(){t.Version.Value.find("option").remove();var e=$(this).find("option:selected").data("server_type");p(e)})};this.onViewAppear=function(){c()};var c=function(){h()}},c3editCompanyDB.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=localizedString("EDITCPYDB_LABEL_TLT"),n=[localizedString("EDITCPYDB_COLUMN_DBNAME"),localizedString("EDITCPYDB_COLUMN_DESC"),localizedString("EDITCPYDB_COLUMN_DBTYPE")],r=[$("<input>").attr({readonly:1}),$("<textarea>"),$("<select>")],i=[localizedString("EDITCPYDB_CHECK_USERDEFINED"),localizedString("EDITCPYDB_CHECK_USERDEFINED_OBJ")];this.onInit=function(){var e=$("<div>"),i=$("<div>").append(t).addClass("title");e.append(i),e.append(Utility.CreateRow(n[0],r[0])),e.append(Utility.CreateRow(n[1],r[1])),e.append(Utility.CreateRow(n[2],r[2])),this._container.append(e),s()};var s=function(){r[1].bind("input",function(){e.companyEntity.Description=$(this).val(),u()}),r[2].bind("change",function(){e.companyEntity.Purpose=$(this).val(),u()})},o=function(t){e.DBServerInstance&&e.DBServerInstance.DBInst.LM&&r[0].val(e.DBServerInstance.DBInst.LM.Hostname+"/"+e.DBServerInstance.DBInst.Name),c3.service.getCompanyPurpose(function(e){r[2].find("option").remove(),r[2].append($("<option>"));var n=null;for(var i=0;i<e.data.length;i++)n=$("<option>").append(e.data[i]),t&&t.Purpose==e.data[i]&&n.attr({selected:"selected"}),r[2].append(n)})};this.onViewAppear=function(){r[0].attr({value:e.companyEntity.Name}),r[1].attr({value:e.companyEntity.Description}),o(e.companyEntity)};var u=function(){e&&e.readyForNext&&(e.companyEntity.Name&&e.companyEntity.Purpose?e.readyForNext():e.disableNext())}},c3editCompanyDBTest.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=localizedString("EDITCPYDB_LABEL_TLT"),n=[localizedString("EDITCPYDB_COLUMN_DBNAME"),localizedString("EDITCPYDB_COLUMN_DESC"),localizedString("EDITCPYDB_COLUMN_DBTYPE")],r=[$("<label>"),new dropdownlist({isRequired:!0}),new dropdownlist({isRequired:!0}),$("<textarea>")],i=[localizedString("EDITCPYDB_CHECK_USERDEFINED"),localizedString("EDITCPYDB_CHECK_USERDEFINED_OBJ")];this.onInit=function(){this._container.append(Utility.CreateRow(n[0],r[0])),this._container.append(Utility.CreateRow(n[1],r[1])),this._container.append(Utility.CreateRow(n[2],r[2])),this._container.append(Utility.CreateRow(n[3],r[3])),s()};var s=function(){r[1].bind("change",function(){e.companyEntity.Status=$(this).val()}),r[2].bind("change",function(){e.companyEntity.Purpose=$(this).val()}),r[3].bind("change",function(){e.companyEntity.Description=$(this).val()})},o=function(t){e.companyEntity&&r[0].text(e.companyEntity.CompanyDB_CompanyName),c3.service.getCompanyStatus(function(e){r[1].find("option").remove(),r[1].append($("<option>"));var n=null;for(var i=0,s=e.data.length;i<s;i++)n=$("<option>").append(e.data[i]),t&&t.Status==e.data[i]&&n.attr({selected:"selected"}),r[1].append(n)}),c3.service.getCompanyPurpose(function(e){r[2].find("option").remove(),r[2].append($("<option>"));var n=null;for(var i=0;i<e.data.length;i++)n=$("<option>").append(e.data[i]),t&&t.Purpose==e.data[i]&&n.attr({selected:"selected"}),r[2].append(n)})};this.onViewAppear=function(){r[0].append(e.companyEntity.CompanyName),r[1].attr({value:e.companyEntity.Status}),r[2].attr({value:e.companyEntity.Purpose}),r[3].attr({value:e.companyEntity.Description}),o(e.companyEntity)};var u={checkValidity:function(){return r[1].checkValidity()&&r[2].checkValidity()}};this.validator=u},c3registerMSSql.step1=function(){function o(){var e=s[1].searchHelper(100,{container:self._container});self.searchCtrl=e,self.searchCtrl.selection=function(e){f(e)},self.sqlInstanceData=[],c3.service.retrieveSQLInstances(undefined,function(e){if(e.data.RetrieveSQLInstances!==undefined){var t=e.data.RetrieveSQLInstances.split(";");for(var n=0;n<t.length;n++){var r={};r.name=t[n],r.value=t[n],self.sqlInstanceData.push(r),self.searchCtrl.setDataReady(!0),self.searchCtrl.bindData(self.sqlInstanceData)}}})}function u(e){s[2].find("option").remove();var t=null,n=null;e||(t=$("<option>").append(localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")).attr({value:localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")}),s[2].append(t)),n=$("<option>").append(localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")).attr({value:localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")}),s[2].append(n),e?(n.attr({selected:"selected"}),s[3].attr({readonly:!1}),s[4].attr({readonly:!1})):(t.attr({selected:"selected"}),s[3].attr({readonly:!0}),s[4].attr({readonly:!0}))}function a(){query=c3.service.getSWRepositories(),query.query(function(e){s[0].find("option").remove();var t=null,n=null;t=$("<option>").append(localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLSERVER")).attr({value:localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLSERVER")}),s[0].append(t);for(var r=0;r<e.data.length;r++)if(e.data[r].HANAenabled==1){n=$("<option>").append(localizedString("RESPOOL_DBINSTANCE_COLUMN_HANA")).attr({value:localizedString("RESPOOL_DBINSTANCE_COLUMN_HANA")}),s[0].append(n);break}s[0].val(localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLSERVER"))})}function f(t){var n=t.split("\\");e.MSSQLEntity.Machine={},n.length>1?(e.MSSQLEntity.Machine.Hostname=n[0],e.MSSQLEntity.Name=t):(e.MSSQLEntity.Machine.Hostname=n[0],e.MSSQLEntity.Name=t);var t=s[2].val();t==localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")&&(e.MSSQLEntity.IsTrustedConnection=!0),t==localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")&&(e.MSSQLEntity.IsTrustedConnection=!1),s[0].val()==localizedString("RESPOOL_DBINSTANCE_COLUMN_HANA")?e.MSSQLEntity.ServerType="HANADB":e.MSSQLEntity.ServerType=s[0].val(),e.MSSQLEntity.Username=s[3].val(),e.MSSQLEntity.Password=s[4].val(),e.MSSQLEntity.Description=s[5].val()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite"),self=this,self.testIcon=null;var e=arguments[0]||{},t="Use Trusted Connection",n=$("<div>");n.append($("<input>").attr({type:"checkbox",checked:"true",disabled:"true"})),n.append(t);var r=$("<input>").attr({type:"button",value:localizedString("MISC_TEST_CONNECTION")}).click(function(){if(!validator.checkValidity())return;r.attr({disabled:1}),1<s[6].children().length?$(s[6].children()[1]).attr({src:c3Icon.Loading}):s[6].append($("<img>").attr({src:c3Icon.Loading}));var n={};n.error=function(e){e.responseText&&e.responseText.length>0&&(1<s[6].children().length?(self.testIcon=s[6].children()[1],$(s[6].children()[1]).attr({src:c3Icon.Failed,title:retriveErrorMessage(e.responseText)}).css({display:"inline"})):(self.testIcon=$("<img>"),s[6].append(self.testIcon.attr({src:c3Icon.Failed,title:retriveErrorMessage(e.responseText)})))),r.attr({disabled:0})},n.success=function(e){e.d.TestDBServerConnection?1<s[6].children().length?(self.testIcon=s[6].children()[1],$(s[6].children()[1]).attr({src:c3Icon.Success}).css({display:"inline"})):(self.testIcon=$("<img>"),s[6].append(self.testIcon.attr({src:c3Icon.Success}))):1<s[6].children().length?(self.testIcon=s[6].children()[1],$(s[6].children()[1]).attr({src:c3Icon.Failed}).css({display:"inline"})):(self.testIcon=$("<img>"),s[6].append(self.testIcon.attr({src:c3Icon.Failed}))),r.attr({disabled:0})},c3.service.testConnectDBServer(e.MSSQLEntity.Name,e.MSSQLEntity.ServerType,e.MSSQLEntity.IsTrustedConnection,e.MSSQLEntity.Username,e.MSSQLEntity.Password,n)}),i=[localizedString("COLUMN_SERVERTYPE"),localizedString("COLUMN_SERVERNAME"),localizedString("COLUMN_AUTH"),localizedString("COLUMN_USERNAME"),localizedString("COLUMN_PASSWORD"),localizedString("MISC_DESCRIPTION"),""],s=[new dropdownlist({isRequired:!0}),new textbox({isRequired:!0}),new dropdownlist({isRequired:!0,isRequired:!0}),new textbox({isRequired:!1}),new textbox({isRequired:!1,type:"Password"}),$("<textarea>"),$("<div>").append(r)];validator={checkValidity:function(){var e=s[1].checkValidity();return e==0?e:s[2].val()==localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")&&$.trim(s[3].val())==""?(s[3].showErrorMessage(localizedString("FIELDREQUIRED")),!1):s[2].val()==localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")&&$.trim(s[4].val())==""?(s[4].showErrorMessage(localizedString("FIELDREQUIRED")),!1):(f(s[1].val()),e)}},this.validator=validator,this.reset=function(){s[1].val(""),s[3].val(""),s[4].val(""),s[5].val("")},this.onInit=function(){for(var e=0;e<i.length;e++){var t=Utility.CreateRow(i[e],s[e]);6==e&&t.css({"padding-bottom":"10px","margin-bottom":"0"}),this._container.append(t)}s[1].bind("keyup",function(e){if(e.keyCode!=9&&e.keyCode!=27){var t=s[1].val(),n=self.sqlInstanceData,r=[];for(var i=0;i<n.length;i++){var o=n[i];o.name.startsWith(t.toUpperCase())&&r.push(o)}self.searchCtrl.bindData(r),t!=""&&r.length!=0?self.searchCtrl.show():self.searchCtrl.close(),f(t)}});var n=new loadingWindow;self.loadingWin=n,u(),a(),s[2].bind("change",function(e){var t=s[2].val();t==localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")&&(s[3].attr({readonly:!0}),s[4].attr({readonly:!0}),s[3].val(""),s[4].val("")),t==localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")&&(s[3].attr({readonly:!1}),s[4].attr({readonly:!1}))}),s[0].bind("change",function(e){var t=s[0].val();t==localizedString("RESPOOL_DBINSTANCE_COLUMN_HANA")?(s[2].val(localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")),u(!0)):u(!1)})},this.onViewAppear=function(){o()}},c3registerLicenseServer.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=$("<input>").attr({type:"button",value:localizedString("MISC_TEST_CONNECTION")});t.click(function(){if(!i.checkValidity())return;t.attr({disabled:!0}),1<n.TestConnection.Value.children().length?$(n.TestConnection.Value.children()[1]).attr({src:c3Icon.Loading}):n.TestConnection.Value.append($("<img>").attr({src:c3Icon.Loading})),c3.service.testConnectLicenseServerByServerName(e.LicenseServerEntity.Machine.Hostname+":"+e.LicenseServerEntity.Port,{success:function(e){t.removeAttr("disabled"),e.d.TestConnectionByServerName?1<n.TestConnection.Value.children().length?$(n.TestConnection.Value.children()[1]).attr({src:c3Icon.Success}):n.TestConnection.Value.append($("<img>").attr({src:c3Icon.Success})):1<n.TestConnection.Value.children().length?$(n.TestConnection.Value.children()[1]).attr({src:c3Icon.Failed,title:retriveErrorMessage(e.responseText)}):n.TestConnection.Value.append($("<img>").attr({src:c3Icon.Failed,title:retriveErrorMessage(e.responseText)}))},error:function(e){t.removeAttr("disabled"),1<n.TestConnection.Value.children().length?$(n.TestConnection.Value.children()[1]).attr({src:c3Icon.Failed,title:retriveErrorMessage(e.responseText)}):n.TestConnection.Value.append($("<img>").attr({src:c3Icon.Failed,title:retriveErrorMessage(e.responseText)}))}})});var n={Hostname:{Name:localizedString("MISC_HOSTNAME"),Value:new textbox({isRequired:!0})},Port:{Name:localizedString("MISC_PORT"),Value:new textbox({isRequired:!0})},TestConnection:{Name:"",Value:$("<div>").append(t)},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},r=function(){var e=$("<div>");for(var t in n)e.append(Utility.CreateRow(n[t].Name,n[t].Value));return e};this.onInit=function(){this._container.append(r)},this.reset=function(){n.Hostname.Value.val(""),n.Port.Value.val("30000"),n.Description.Value.val("")};var i=new function(){var t=[],r=function(){return e.LicenseServerEntity.Name=n.Hostname.Value.val(),e.LicenseServerEntity.Machine={},e.LicenseServerEntity.Machine.Hostname=n.Hostname.Value.val(),e.LicenseServerEntity.Port=n.Port.Value.val(),e.LicenseServerEntity.Description=n.Description.Value.val(),n.Hostname.Value.checkValidity()&&n.Port.Value.checkValidity()};this.checkValidity=r};this.validator=i,this.onViewAppear=function(){n.Port.Value.val(3e4)}},c3registerPresServer.step1=function(){function s(){var t=r[0].searchHelper(100,{container:e._container});e.searchCtrl=t,e.searchCtrl.selection=function(e){r[2].attr({value:o(e).LogicalMachine.Hostname})};var n={};e.data=[],c3.service.getPresentationServers().expand("HostingUnit, LogicalMachine").query(function(t){if(t.data.length>0)for(var n=0;n<t.data.length;n++)if(t.data[n].HostingUnit==null){var r={};r.name=t.data[n].Name,r.value=t.data[n].Name,r.data=t.data[n],e.data.push(r),e.searchCtrl.setDataReady(!0),e.searchCtrl.bindData(e.data)}})}function o(t){var n=null;for(var r=0;r<e.data.length;r++)e.data[r].value==t&&(n=e.data[r].data);return n}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=this,t=arguments[0]||{},n=[localizedString("COLUMN_MSSQL_NAME"),localizedString("MISC_TYPE"),localizedString("MISC_HOSTNAME"),localizedString("MISC_DESCRIPTION")],r=[new textbox({isRequired:!0}),new dropdownlist({isRequired:!0}),new textbox({isRequired:!0}),$("<textarea>")],i={checkValidity:function(){return 1<r[3].children().length&&$(r[3].children()[1]).attr({src:""}),t.PresServerEntity.Name=r[0].val(),t.PresServerEntity.ServerType=r[1].val(),t.PresServerEntity.Machine={},t.PresServerEntity.Machine.Hostname=r[2].val(),t.PresServerEntity.Description=r[3].val(),r[0].checkValidity()&&r[1].checkValidity()&&r[2].checkValidity()}};this.validator=i,this.onInit=function(){for(var e=0;e<n.length;e++)this._container.append(Utility.CreateRow(n[e],r[e]));c3.service.getPresentationServerType(function(e){r[1].find("option").remove(),r[1].append($("<option>"));var n=null;for(var i=0;i<e.data.length;i++)n=$("<option>").append(e.data[i]).attr({value:e.data[i]}),t.presServerEntity&&t.PresServerEntity.ServerType==e.data[i]&&n.attr({selected:"selected"}),!t.presServerEntity&&e.data[i]=="Unknown"&&n.attr({selected:"selected"}),r[1].append(n)})},this.reset=function(){r[0].val(""),r[1].val(""),r[2].val(""),r[3].val("")},this.onViewAppear=function(){t.setLink&&s()}};var c3registerSBOCommon=function(){var e=function(){function i(){c3.service.getSWRepositories().count().query(s),c3.service.getDBServerInstances().count().query(u),c3.service.getCommonDBs().count().query(c)}function s(e){o.SWrepositoryCountLabel.empty(),e.data==0?o.SWrepositoryCountLabel.append(e.data).addClass("alert_text"):o.SWrepositoryCountLabel.append(e.data).addClass("icon_title")}function u(e){o.DBinstanceCountLabel.empty(),e.data==0?o.DBinstanceCountLabel.append(e.data).addClass("alert_text"):o.DBinstanceCountLabel.append(e.data).addClass("icon_title")}function a(){var e=$("<div>"),t=$("<section>").addClass("icon_DBInstance"),n=$("<section>").append(localizedString("RES_MS_SQL")).addClass("icon_title");return box_count=$("<section>").addClass("icon_title").append("(").append(o.DBinstanceCountLabel).append(")"),e.append($("<div>").css({"float":"none"}).append(t).append(n).append(box_count)),e}function f(){var e=$("<div>"),t=$("<section>").addClass("icon_SWRepository"),n=$("<section>").append(localizedString("SOFTWAREREPO")).addClass("icon_title");return box_count=$("<section>").addClass("icon_title").append("(").append(o.SWrepositoryCountLabel).append(")"),e.append($("<div>").css({"float":"none"}).append(t).append(n).append(box_count)),e}function l(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_SBOCOMMON(e)}),t=$("<section>").addClass("icon_SBOCOMMON"),n=$("<section>").append(localizedString("RES_SBO_COMMON")).addClass("icon_title"),r=$("<section>").addClass("icon_title").append("(").append(o.commonDBCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function c(e){o.commonDBCountLabel.empty(),e.data==0?o.commonDBCountLabel.append(e.data).addClass("alert_text"):o.commonDBCountLabel.append(e.data).addClass("icon_title")}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite").css({"margin-top":"0"});var e=arguments[0]||{},t={ChoseMSSQL:{Name:localizedString("WIZARD_SBO_MSSQLINST"),Value:new dropdownlist({isRequired:!0})},Name:{Name:localizedString("MISC_NAME"),Value:$("<input>").val("SBO-COMMON").attr({disabled:"disabled"})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},n={checkValidity:function(){return e.SBOCommonEntity.Name=t.Name.Value.val(),e.SBOCommonEntity.DatabaseInstance={__metadata:{uri:"DatabaseInstances("+parseInt(t.ChoseMSSQL.Value.val())+")"}},e.SBOCommonEntity.Description=t.Description.Value.val(),t.ChoseMSSQL.Value.checkValidity()}};this.validator=n,this.reset=function(){i(),r(),t.ChoseMSSQL.Value.val(""),t.Description.Value.val("")},this.onViewAppear=function(){r()};var r=function(){c3.service.getDBServerInstances().expand("Machine, CommonDatabases").filter("Status eq 'Online' and LifeCycleStatus eq 'Running'").query(function(e){t.ChoseMSSQL.Value.find("option").remove(),t.ChoseMSSQL.Value.append($("<option>"));var n=null;for(var r=0;r<e.data.length;r++){var i=e.data[r].CommonDatabases.length;i=i==null?e.data[r].CommonDatabases.results.length:i,e.data[r].Machine&&0>=i&&(n=$("<option>").attr({value:e.data[r].ID,version:e.data[r].ServerVersion}).append(e.data[r].Name),t.ChoseMSSQL.Value.append(n))}})};this.validator=n,this.onInit=function(){var e=localizedString("WIZARD_SBO_GUIDE_TITLE"),n=localizedString("WIZARD_SBO_GUIDE_DESCRIPTION"),r=$("<div>").addClass("guide_main"),s=$("<div>").addClass("element_group").css({width:"450px",height:"82px"}),u=$("<div>").addClass("element_box1"),c=$("<div>").addClass("element_box1"),h=$("<div>").addClass("element_box1"),p=$("<div>").addClass("element_box1");o.SWrepositoryCountLabel=$("<label>"),o.DBinstanceCountLabel=$("<label>"),o.commonDBCountLabel=$("<label>"),r.append(s),s.append(u).append(c).append(h).append(p),u.append(a()),c.append(f()),h.append($("<div>").addClass("right_arrow")),p.append(l()),i(),this._container.append($("<fieldset>").css({height:"150px","margin-bottom":"5px"}).append($("<legend>").append($("<span>").css("font-weight","bold").append(e))).append($("<div>").addClass("guide_description").append(n)).append(r));for(var d in t){var v=Utility.CreateRow(t[d].Name,t[d].Value);d==="ChoseMSSQL"&&v.css({"margin-bottom":"0"}),this._container.append(v)}var m=c3.service.isEditableCommonDatabaseName();m.query(function(e){var n=e.data.IsEditableCommonDatabaseName;n&&t.Name.Value.removeAttr("disabled")})},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.DatabaseInstances,function(e){r(),c3.service.getDBServerInstances().count().query(u)}),cometdManager.subscribe(sldEntitySet.SoftwareRepositories,function(e){c3.service.getSWRepositories().count().query(s)}),cometdManager.subscribe(sldEntitySet.CommonDatabases,function(e){c3.service.getCommonDBs().count().query(c)})}},t=!1,n={},r=new e(this),i={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:r.validator},s={register:function(e){var t=e.SBOCommonEntity,n=this;this.base=c3.task,this.base(localizedString("REGISTSF_TLT_SCDR"),5),this.execute=function(){c3.service.registerCommonDB(t,this.ajaxCallBackConfig),n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("New-SBOCommon")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview")),c3ModuleManager.notifyMessage(new c3Message("Referesh_Extension"))})}}};this.base=c3.dialog,this.base(i),this.SBOCommonEntity=n,this.view=r;var o=this,u=arguments[0]||undefined,a=[new s.register(o)],f={taskCount:a.length,getTask:function(e){return a[e]},finishEvent:[function(){o.readyForFinish()}],successEvent:[function(){t=!0,o.view.reset()}],failedEvent:[function(){o.view.reset()}],successMessage:localizedString("MISC_DONE")},l=new multiTaskProcess(f);this.onInit=function(){this.view.onInit(),this.view.onInitNotification(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear(),l.placeAt(this.view.getContainer())},this.getId=function(){return"registerSBOCommon"},this.getTitle=function(){return localizedString("WIZARD_SBO_REG")},this.finish=function(){o.disableFinish(),l.start()},this.onClose.push(function(){u&&t&&u.reload()})};c3registerB1i.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=[localizedString("MISC_NAME"),localizedString("WIZARD_B1I_URL"),localizedString("WIZARD_B1I_ACCESSURL"),localizedString("MISC_HOSTNAME"),localizedString("MISC_DESCRIPTION")],n=[new textbox({isRequired:!0}),new textbox({isRequired:!0}),new textbox({isRequired:!1,pattern:"^((https|http)?://).+"}),new textbox({isRequired:!0}),$("<textarea>")],r={checkValidity:function(){return e.B1iEntity.Name=n[0].val(),e.B1iEntity.URL=$.trim(n[1].val()),e.B1iEntity.AccessURL=$.trim(n[2].val()),e.B1iEntity.Machine={},e.B1iEntity.Machine.Hostname=n[3].val(),e.B1iEntity.Description=n[4].val(),n[0].checkValidity()&&n[1].checkValidity()&&n[2].checkValidity()&&n[3].checkValidity()}};this.validator=r,this.reset=function(){n[0].val(""),n[1].val(""),n[2].val(""),n[3].val(""),n[4].val("")},this.onInit=function(){for(var e=0;e<t.length;e++)this._container.append(Utility.CreateRow(t[e],n[e]))},this.onViewAppear=function(){e.B1iEntity.Status="Online"}},c3registerBAServer.step1=function(){function s(){var t=r[0].searchHelper(100,{container:e._container});e.searchCtrl=t,e.searchCtrl.selection=function(e){r[1].attr({value:o(e).LogicalMachine.Hostname})};var n={};e.data=[],c3.service.getBrowserAccessServers().expand("HostingUnit, LogicalMachine").query(function(t){if(t.data.length>0)for(var n=0;n<t.data.length;n++)if(t.data[n].HostingUnit==null){var r={};r.name=t.data[n].Name,r.value=t.data[n].Name,r.data=t.data[n],e.data.push(r),e.searchCtrl.setDataReady(!0),e.searchCtrl.bindData(e.data)}})}function o(t){var n=null;for(var r=0;r<e.data.length;r++)e.data[r].value==t&&(n=e.data[r].data);return n}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=this,t=arguments[0]||{},n=[localizedString("COLUMN_MSSQL_NAME"),localizedString("MISC_HOSTNAME"),localizedString("WIZARD_BAS_PORT"),localizedString("WIZARD_BAS_CERT_FILE"),localizedString("WIZARD_BAS_CERT_PASS"),localizedString("MISC_DESCRIPTION")],r=[new textbox({isRequired:!0}),new textbox({isRequired:!0}),new textbox({isRequired:!0,pattern:"(6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3})",placeholder:"1-65535"}),$("<input>").attr({type:"file",name:"CertificationFile",size:"30"}),new textbox({type:"password",isRequired:!1}),$("<textarea>")],i={checkValidity:function(){return t.BAServerEntity.Name=r[0].val(),t.BAServerEntity.Machine={},t.BAServerEntity.Machine.Hostname=r[1].val(),t.BAServerEntity.CertFile=r[3][0],t.BAServerEntity.CertPass=r[4].val(),t.BAServerEntity.Description=r[5].val(),t.BAServerEntity.AccessURL="https://"+r[1].val()+window.localStorage.getItem("SLDFullyDomainName")+":"+r[2].val()+"/dispatcher",t.BAServerEntity.MetaData="eyJzZXJ2ZXJzIjpbeyJuYW1lIjoiRGlzcGF0Y2hlcjRCMVdlYlNlcnZlciIsImNsYXNzTmFtZSI6ImNvbS5zYXAuYjEuc2xkLmh0dHBEaXNwYXRjaGVyLmIxV2ViU2VydmVyLkRpc3BhdGNoZXI0QjFXZWJTZXJ2ZXIiLCJ0YXJnZXRIb3N0IjpbXSwicnVsZSI6eyJjbGFzc05hbWUiOiJjb20uc2FwLmIxLnNsZC5odHRwRGlzcGF0Y2hlci5jb3JlLm1hdGNoUnVsZXMuQWNjZXB0RXZlcnl0aGluZ1J1bGUiLCJwcm9wZXJ0aWVzIjpbXX0sInByb3BlcnRpZXMiOlt7Im5hbWUiOiJzZXNzaW9uVGltZW91dCIsInZhbHVlIjoiMzAifSx7Im5hbWUiOiJpbml0aWFsRGVsYXk0Q2xlYW51cEpvYiIsInZhbHVlIjoiNSJ9LHsibmFtZSI6ImV4ZWN1dGlvbkRlbGF5NENsZWFudXBKb2IiLCJ2YWx1ZSI6IjUifSx7Im5hbWUiOiJpbml0aWFsUG9vbFNpemUiLCJ2YWx1ZSI6IjEwIn0seyJuYW1lIjoibWF4UG9vbFNpemUiLCJ2YWx1ZSI6IjIwMCJ9LHsibmFtZSI6Im1pblBvcnROdW1iZXIiLCJ2YWx1ZSI6IjUwMDAwIn0seyJuYW1lIjoiQjFXZWJTZXJ2ZXJMb2NhbFBhdGgiLCJ2YWx1ZSI6IkM6XFxQcm9ncmFtIEZpbGVzICh4ODYpXFxTQVBcXFNBUCBCdXNpbmVzcyBPbmVcXFNBUCBCdXNpbmVzcyBPbmUuZXhlIn1dfV19",r[0].checkValidity()&&r[1].checkValidity()&&r[2].checkValidity()}};this.validator=i,this.onInit=function(){for(var e=0;e<n.length;e++)this._container.append(Utility.CreateRow(n[e],r[e]))},this.reset=function(){r[0].val(""),r[1].val(""),r[2].val(""),r[3].val(""),r[4].val("")},this.onViewAppear=function(){t.setLink&&s()}},c3B1AHRegister.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=[localizedString("MISC_NAME"),localizedString("WIZARD_B1A_PATH"),localizedString("WIZARD_B1A_ACCESSURL"),localizedString("MISC_HOSTNAME"),localizedString("MISC_DESCRIPTION")],n=[new textbox({isRequired:!0}),new textbox({isRequired:!0}),new textbox({isRequired:!1,pattern:"^((https|http)?://).+"}),new textbox({isRequired:!0}),$("<textarea>")],r={checkValidity:function(){return e.B1aEntity.Name=n[0].val(),e.B1aEntity.URL=$.trim(n[1].val()),e.B1aEntity.AccessURL=$.trim(n[2].val()),e.B1aEntity.Machine={},e.B1aEntity.Machine.Hostname=n[3].val(),e.B1aEntity.Description=n[4].val(),n[0].checkValidity()&&n[1].checkValidity()&&n[2].checkValidity()&&n[3].checkValidity()}};this.validator=r,this.reset=function(){n[0].val(""),n[1].val(""),n[2].val(""),n[3].val(""),n[4].val("")},this.onInit=function(){for(var e=0;e<t.length;e++)this._container.append(Utility.CreateRow(t[e],n[e]))},this.onViewAppear=function(){e.B1aEntity.Status="Online"}},c3XAppRegister.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=[localizedString("MISC_NAME"),localizedString("WIZARD_XAPP_URL"),localizedString("MISC_DESCRIPTION")],n=[new textbox({isRequired:!0}),new textbox({isRequired:!0,pattern:"^((https|http)?://).+"}),new textbox({isRequired:!1}),$("<textarea>")],r={checkValidity:function(){var t=new RegExp("^((https|http)?://)?([^:/]*).*"),r=$.trim(n[1].val()).match(t)[3];return e.XAppEntity.Name=n[0].val(),e.XAppEntity.Link=$.trim(n[1].val()),e.XAppEntity.Machine={},e.XAppEntity.Machine.Hostname=r,e.XAppEntity.Description=n[2].val(),n[0].checkValidity()&&n[1].checkValidity()&&n[2].checkValidity()}};this.validator=r,this.reset=function(){n[0].val(""),n[1].val(""),n[2].val("")},this.onInit=function(){for(var e=0;e<t.length;e++)this._container.append(Utility.CreateRow(t[e],n[e]))},this.onViewAppear=function(){e.XAppEntity.Status="Online"}},c3registerB1Share.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=arguments[1]||{},n=[localizedString("MISC_PATH"),localizedString("MISC_DESCRIPTION")],r=[new textbox({isRequired:!0}),$("<textarea>")],i={checkValidity:function(){e.B1ShareEntity.URI=$.trim(r[0].val()),e.B1ShareEntity.Description=r[1].val();if(t=="CompanyTemplateRepository"||t=="TenantsStorage")e.B1ShareEntity.MountPoint=r[2].val();return r[0].checkValidity()}};this.validator=i;if(t=="CompanyTemplateRepository"||t=="TenantsStorage")n=[localizedString("MISC_PATH"),localizedString("MISC_DESCRIPTION"),localizedString("COLUMN_MOUNTPOINT")],r=[new textbox({isRequired:!0}),$("<textarea>"),new textbox({isRequired:!1})];this.reset=function(){r[0].val(""),r[1].val(""),r[2]!=null&&r[2].val("")},this.onInit=function(){for(var e=0;e<n.length;e++)this._container.append(Utility.CreateRow(n[e],r[e]))},this.onViewAppear=function(){}},c3registerMailer.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t={Name:{Name:localizedString("MISC_NAME"),Value:new textbox({isRequired:!0})},Hostname:{Name:localizedString("MISC_HOSTNAME"),Value:new textbox({isRequired:!0})},Port:{Name:localizedString("MISC_PORT"),Value:new textbox({isRequired:!0})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},n={checkValidity:function(){return e.MailerEntity.Name=t.Name.Value.val(),e.MailerEntity.Machine={},e.MailerEntity.Machine.Hostname=t.Hostname.Value.val(),e.MailerEntity.Port=parseInt(t.Port.Value.val()),e.MailerEntity.Description=t.Description.Value.val(),t.Name.Value.checkValidity()&&t.Hostname.Value.checkValidity()&&t.Port.Value.checkValidity()}};this.validator=n,this.reset=function(){t.Name.Value.val(""),t.Hostname.Value.val(""),t.Port.Value.val(""),t.Description.Value.val("")},this.onInit=function(){for(var e in t)this._container.append(Utility.CreateRow(t[e].Name,t[e].Value));t.Port.Value.val(25)}},c3registerMailServer.stepSmtpSettings=function(e){this.base=c3.module,this.base(),this._container=$("<div>");var t=this,n=e||{},r={SmtpHost:{Name:localizedString("MAIL_SERVER_SMTP_HOST"),Value:new textbox({isRequired:!1,pattern:"^(((25[0-5]|2[0-4]\\d|1\\d\\d|\\d{1,2})\\.){3}(25[0-5]|2[0-4]\\d|1\\d\\d|\\d{1,2})|([a-zA-Z]([\\da-zA-Z\\.\\-]?){0,61}[\\da-zA-Z]))$"})},SmtpPort:{Name:localizedString("MAIL_SERVER_SMTP_PORT"),Value:new textbox({isRequired:!1,pattern:"(6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3})",placeholder:"1-65535"})},SmtpSecurity:{Name:localizedString("MAIL_SERVER_SMTP_SECURITY"),Value:new dropdownlist({isRequired:!1})},SmtpSslPort:{Name:localizedString("MAIL_SERVER_SMTP_SSL_PORT"),Value:new textbox({isRequired:!1,pattern:"(6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3})",placeholder:"1-65535"})},SmtpUsername:{Name:localizedString("MAIL_SERVER_SMTP_USERNAME"),Value:new textbox({isRequired:!1})},SmtpPassword:{Name:localizedString("MAIL_SERVER_SMTP_PASSWORD"),Value:new textbox({isRequired:!1,type:"Password"})}};this.validator=new function(){var e=function(){return n.checkValidity(r)};this.checkValidity=e},this.onInit=function(){this._container.append(n.initializeUI(r)),r.SmtpPort.Value.val("25"),r.SmtpSslPort.Value.val("465"),n.initializeUiSecurityValidValues(r.SmtpSecurity.Value)}},c3registerMailServer.stepOtherSettings=function(e){this.base=c3.module,this.base(),this._container=$("<div>");var t=this,n=e||{},r={EmailDelimiter:{Name:localizedString("MAIL_SERVER_EMAIL_DELIMITER"),Value:new textbox({isRequired:!1})},DefaultFromEmailAddress:{Name:localizedString("MAIL_SERVER_DEFAULT_FROM_EMAIL"),Value:new textbox({isRequired:!0,pattern:"^\\w+[\\w\\._-]*\\w+\\@(((25[0-5]|2[0-4]\\d|1\\d\\d|\\d{1,2})\\.){3}(25[0-5]|2[0-4]\\d|1\\d\\d|\\d{1,2})|([a-zA-Z]([\\da-zA-Z\\.\\-]?){0,61}[\\da-zA-Z]))$"})},DefaultFromEmailName:{Name:localizedString("MAIL_SERVER_DEFAULT_FROM_NAME"),Value:new textbox({isRequired:!1})},DefaultCharset:{Name:localizedString("MAIL_SERVER_DEFAULT_CHARSET"),Value:new textbox({isRequired:!1})}};this.validator=new function(){var e=function(){return n.checkValidity(r)};this.checkValidity=e},this.onInit=function(){this._container.append(n.initializeUI(r))},this.onViewAppear=function(){n.clearTask()}},c3assignServiceUnits.step1=function(e){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var t=arguments[0]||{},n="Assign Service Units to Reseller",r=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"20%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"20%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"20%"},{name:"TenantNum",description:localizedString("COLUMN_CUSTNUM"),type:"text",width:"30%"}],i=this,s=null,o=[];this.parent=e;var u={needExport:function(){return!1},getHeaderSpec:function(){return r},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 347},getTip:function(){return Utility.CreateTipBoard(localizedString("HOSTUNIT"),function(){},!0)},getCell:function(){var e=null;if(this.colName=="LicenseServer"){var t={};t.text=this.data[this.colName].Status,e=new statusControl(t)}if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}};this.onInit=function(){var e=$("<div>");s=e.gridview({delegate:u,checkType:1}),s.rowCheckEvent.push(function(){var e=this.index;if(this.isChecked){var n=!1;for(var r=0;r<t.suIds.length;r++)t.suIds[r]==o[e].ID&&(n=!0);n||t.suIds.push(o[e].ID)}else{var n=!1,i=-1;for(var r=0;r<t.suIds.length;r++)t.suIds[r]==o[e].ID&&(n=!0,i=r);n&&i>=0&&t.suIds.remove(i)}}),this._container.append(e),s.show();var n=new loadingWindow;i.loadingWin=n},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){i.reload()})},this.onViewAppear=function(){f(),a()};var a=function(){return!0};this.reload=function(){f()};var f=function(){o=[];var e="";i.loadingWin.show(),c3.service.getHostingUnits().filter("LicenseServer/Status eq 'Online' and Status eq 'Online'"+e).expand("Tenants,Tenants/CompanyDatabase,LicenseServer,LicenseServer/LicenseFiles, CommonDatabase, CommonDatabase/DatabaseInstance,CompanyTemplateRepository,SoftwareRepository,ImplementationRepository").query(function(e){i.loadingWin.close();if(e.data&&e.data.length>0)for(var t=0;t<e.data.length;t++){var n=function(n){return n.ID===e.data[t].ID};if(i.parent.controller.SUs&&i.parent.controller.SUs.filter(n).length>0)continue;o.push(e.data[t]),e.data[t].Tenants?e.data[t].TenantNum=e.data[t].Tenants.results.length:o[t].TenantNum=0}s.reload()})}},c3assignCustomer.step1=function(e){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite"),this.parent=e;var t=arguments[0]||{},n="Assign Customers to Reseller",r=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"30%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"20%"},{name:"InstallationNumber",description:localizedString("COLUMN_INSTALL_NO"),type:"text",width:"40%"}],i=this,s=null,o=[],u={needExport:function(){return!1},getHeaderSpec:function(){return r},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 347},getTip:function(){return Utility.CreateTipBoard(localizedString("CUSTOMER"),function(){},!0)},getCell:function(){var e=null;if(this.colName=="LicenseServer"){var t={};t.text=this.data[this.colName].Status,e=new statusControl(t)}if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}if(this.colName=="InstallationNumber")if(this.data[this.colName]==null||this.data[this.colName]=="")e=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("RESELLER_ASSIGN")}).bind("click",this.data,function(e){var t=new c3changeLicenseFile(i,e.data,parent,1);t.show()});else{var n=!1;if(i.parent.Customer_Lic_Mapping)for(var r=0;r<i.parent.Customer_Lic_Mapping.length;r++)if(this.data.ID==i.parent.Customer_Lic_Mapping[r].CustomerID){n=!0;break}n&&(e=$("<div>").append(this.data[this.colName]).append($("<label>").addClass("ShowIcon Cancel").attr({title:localizedString("RESELLER_UNASSIGN")}).bind("click",this.data,function(e){e.data.InstallationNumber="";if(i.parent.Customer_Lic_Mapping)for(var t=0;t<i.parent.Customer_Lic_Mapping.length;t++)if(e.data.ID==i.parent.Customer_Lic_Mapping[t].CustomerID){i.parent.Customer_Lic_Mapping.remove(t);break}i.gridView.reload()})))}return e}};this.onInit=function(){var e=$("<div>");s=e.gridview({delegate:u,checkType:1}),i.gridView=s,s.rowCheckEvent.push(function(){var e=this.index;if(this.isChecked){var n=!1;for(var r=0;r<t.suIds.length;r++)t.suIds[r]==o[e].ID&&(n=!0);n||t.suIds.push(o[e].ID)}else{var n=!1,i=-1;for(var r=0;r<t.suIds.length;r++)t.suIds[r]==o[e].ID&&(n=!0,i=r);n&&i>=0&&t.suIds.remove(i)}}),this._container.append(e),s.show();var n=new loadingWindow;i.loadingWin=n},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){i.reload()})},this.onViewAppear=function(){f(),a()};var a=function(){return!0};this.reload=function(){f()};var f=function(){o=[];var e="";i.loadingWin.show(),c3.service.getCustomers().expand("Reseller").query(function(e){i.loadingWin.close();if(e.data&&e.data.length>0)for(var t=0;t<e.data.length;t++){var n=function(n){return n.ID===e.data[t].ID};if(e.data[t].Reseller!==null||i.parent.controller.Customers&&i.parent.controller.Customers.filter(n).length>0)continue;o.push(e.data[t])}s.reload()})}},c3addCustomerUsers.step1=function(){function l(){var e=null,t=this;if(this.colName=="Status"){var n={};n.text=this.data[this.colName],n.textalign="center",e=new statusControl(n)}else{if(this.colName=="IsOperator"||this.colName=="IsPowerUser"){var i=$("<input>").attr("type","checkbox"),s="PowerUser";if(this.colName=="IsOperator"){var o=this.data[this.colName];i.attr("disabled",Math.abs(o-1)),s="SuperUser"}var u=this.row;this.data[s]==1&&$(i).attr("checked",!0);if(s=="PowerUser")for(var a=0;a<r.opCheckboxDoms.length;a++)if(r.opCheckboxDoms[a].RowIndex==u&&$(r.opCheckboxDoms[a]["SuperUser"]).attr("checked")==1){$(i).attr({disabled:!0,checked:!0});break}var f=this.data,l=0;i.click(function(){var e=!1;if($(this).attr("checked")==1||$(this).attr("checked")==1||$(this).attr("checked")=="checked")e=!0;if(s=="SuperUser")for(var t=0;t<r.opCheckboxDoms.length;t++)r.opCheckboxDoms[t].RowIndex==u&&r.opCheckboxDoms[t].PowerUser&&(e?($(r.opCheckboxDoms[t].PowerUser).attr({disabled:!0,checked:!0}),c(f,"PowerUser",!0)):$(r.opCheckboxDoms[t].PowerUser).removeAttr("disabled"));c(f,s,e)});var h=!1;for(var a=0;a<r.opCheckboxDoms.length;a++)if(r.opCheckboxDoms[a].RowIndex==u){r.opCheckboxDoms[a][s]=i,h=!0;break}if(!h){var p={RowIndex:u,Name:t.data.SystemUsername};p[s]=i,r.opCheckboxDoms.push(p)}return i}if(this.colName=="B1Username"){var d=this.data[this.colName],v=(new textbox({pattern:"([0-9a-zA-Z-_.]){0,}"})).attr({maxlength:8}).css({width:"126px",height:"20px"}).val(d);v.val(d);var t=this;return this.text=v,v.bind("change",function(){c(t.data,"B1Username",t.text.val())}),v}}return e}function c(t,n,i){for(var s in t)if(s==n){t[s]=i;break}for(var o=0;o<r.CustomerUsers.length;o++)if(r.CustomerUsers[o].SystemUsername==t.SystemUsername){r.CustomerUsers[o]=t;break}for(var o=0;o<e.selectedItems.length;o++)if(e.selectedItems[o].SystemUsername==t.SystemUsername){e.selectedItems[o]=t;break}}function h(){}function p(){e.btnFinish&&e.selectedItems&&e.selectedItems.length>0?e.btnFinish.attr({disabled:!1}):e.btnFinish.attr({disabled:!0})}function g(){if(t&&t.TenantUsers&&t.TenantUsers.length>0){if(n){for(var u=0;u<r.CustomerUsers.length;u++)for(var a=0;a<t.TenantUsers.length;a++)if(r.CustomerUsers[u].SystemUsername==t.TenantUsers[a].Name){r.CustomerUsers.remove(u--);break}e.selectedItems=[]}else for(var a=0;a<t.TenantUsers.length;a++){var f=!1;for(var l=0;l<e.selectedItems.length;l++)if(e.selectedItems[l].SystemUsername==t.TenantUsers[a].SystemUsername){f=!0;break}f||e.selectedItems.push(y(t.TenantUsers[a]))}var c=[];for(var a=0;a<t.TenantUsers.length;a++)for(var u=0;u<r.CustomerUsers.length;u++)if(t.TenantUsers[a].SystemUsername==r.CustomerUsers[u].SystemUsername){r.CustomerUsers[u].PowerUser=t.TenantUsers[a].PowerUser,r.CustomerUsers[u].SuperUser=t.TenantUsers[a].SuperUser,r.CustomerUsers[u].B1Username=t.TenantUsers[a].B1Username,r.CustomerUsers[u].Status=t.TenantUsers[a].Status,c.push(u);break}o.getDefaultSelectedIndex=function(){return c.length>0?c:-1}}s=r.CustomerUsers,i.reload()}function y(e){var t={};for(var n in e)typeof e[n]=="object"?t[n]=y(e[n]):typeof e[n]!="function"&&(t[n]=e[n]);return t}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=arguments[1]||{},n=arguments[2]||!1,r=this;r.checkboxDoms=[],r.opCheckboxDoms=[],e.selectedItems=[];var i=null,s=[],o={getHeaderSpec:function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"B1Username",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"28%"},{name:"SystemUsername",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"25%"},{name:"IsOperator",description:localizedString("COLUMN_ISSUPERUSER"),type:"text",width:"18%"},{name:"IsPowerUser",description:localizedString("B1_POWERUSER"),type:"text",width:"17%"}]},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 190},getCell:function(){var e=null,t=this;if(this.colName=="Status"){var n={};n.text=this.data[this.colName],n.textalign="center",e=new statusControl(n)}else{if(this.colName=="IsOperator"||this.colName=="IsPowerUser"){var i=$("<input>").attr("type","checkbox"),s="PowerUser";if(this.colName=="IsOperator"){var o=this.data[this.colName];i.attr("disabled",Math.abs(o-1)),s="SuperUser"}var u=this.row;this.data[s]==1&&$(i).attr("checked",!0);if(s=="PowerUser")for(var a=0;a<r.checkboxDoms.length;a++)if(r.checkboxDoms[a].RowIndex==u&&$(r.checkboxDoms[a]["SuperUser"]).attr("checked")==1){$(i).attr({disabled:!0,checked:!0});break}var f=this.data,l=0;i.click(function(){var e=!1;if($(this).attr("checked")==1||$(this).attr("checked")==1||$(this).attr("checked")=="checked")e=!0;if(s=="SuperUser")for(var t=0;t<r.checkboxDoms.length;t++)r.checkboxDoms[t].RowIndex==u&&r.checkboxDoms[t].PowerUser&&(e?($(r.checkboxDoms[t].PowerUser).attr({disabled:!0,checked:!0}),c(f,"PowerUser",!0)):$(r.checkboxDoms[t].PowerUser).removeAttr("disabled"));c(f,s,e)});var h=!1;for(var a=0;a<r.checkboxDoms.length;a++)if(r.checkboxDoms[a].RowIndex==u){r.checkboxDoms[a][s]=i,h=!0;break}if(!h){var p={RowIndex:u,Name:t.data.SystemUsername};p[s]=i,r.checkboxDoms.push(p)}return i}if(this.colName=="B1Username"){var d=this.data[this.colName],v=(new textbox({pattern:"([0-9a-zA-Z-_.]){0,}"})).attr({maxlength:8}).css({width:"126px",height:"20px"}).val(d);v.val(d);var t=this;return this.text=v,v.bind("change",function(){c(t.data,"B1Username",t.text.val())}),v}}return e},getTip:function(){return Utility.CreateTipBoard(localizedString("ADDCUSTOMERUSER_POPWIN_EMPTY_TIP_PART"),null,!0)}},u=null,a=[],f={getHeaderSpec:function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"B1Username",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"28%"},{name:"SystemUsername",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"25%"},{name:"IsOperator",description:localizedString("COLUMN_ISSUPERUSER"),type:"text",width:"18%"},{name:"IsPowerUser",description:localizedString("B1_POWERUSER"),type:"text",width:"17%"}]},getRowCount:function(){return a.length},getRow:function(e){return a[e]},getGridHeight:function(){return 190},getCell:l,getTip:function(){return Utility.CreateTipBoard(localizedString("ADDCUST_POP_OPT_GIRD_EMPTY"),null,!0)}};this.onInit=function(){var t=$("<div>"),n=$("<section>");i=n.gridview({delegate:o,checkType:1}),i.show(),i.rowCheckEvent.push(function(){var t=this.index,n=s[t];if(this.isChecked){var r=!1;for(var i=0;i<e.selectedItems.length;i++)if(n.SystemUsername==e.selectedItems[i].SystemUsername){r=!0;break}r||e.selectedItems.push({ID:n.ID,SystemUsername:n.SystemUsername,B1Username:n.B1Username,Status:n.Status,SuperUser:n.SuperUser,PowerUser:n.PowerUser})}else for(var i=0;i<e.selectedItems.length;i++)if(n.SystemUsername==e.selectedItems[i].SystemUsername){e.selectedItems.remove(i);break}});var l=$("<div>").append("*"+localizedString("PROMPT")).css({width:"100%",padding:"2px 0 8px 0"});t.append(l);var c=$("<div>").css({width:"100%",padding:"5px 0 2px 0","font-weight":"bold"}).append(localizedString("ADDCUST_POP_NORMALUSER_TLT")),h=$("<div>").css({width:"100%",padding:"5px 0 2px 0","font-weight":"bold"}).append(localizedString("ADDCUST_POP_OPT_TLT")),p=$("<section>");u=p.gridview({delegate:f,checkType:1}),u.show(),u.rowCheckEvent.push(function(){var t=this.index,n=a[t];if(this.isChecked){var r=!1;for(var i=0;i<e.selectedItems.length;i++)if(n.SystemUsername==e.selectedItems[i].SystemUsername){r=!0;break}r||e.selectedItems.push({ID:n.ID,SystemUsername:n.SystemUsername,B1Username:n.B1Username,Status:n.Status,SuperUser:n.SuperUser,PowerUser:n.PowerUser})}else for(var i=0;i<e.selectedItems.length;i++)if(n.SystemUsername==e.selectedItems[i].SystemUsername){e.selectedItems.remove(i);break}});var d=$("<div>").css({width:"100%",color:"Red","padding-top":"10px"});t.append(c).append(n).append(h).append(p).append(d),r.errorPanel=d,r.body=t,this._container.append(t)},this.onViewAppear=function(){d()};var d=function(){var e=new loadingWindow;e.show(),r.loadingWin=e,r.CustomerUsers=[],r.CloudOperators=[];if(!n){var o=null;t&&t.CustomerID&&t.CustomerID>0&&(o=t.CustomerID),customerManager.getOperatorDetailsByCustomer(o,function(e){if(t.SelectedUsers&&t.SelectedUsers.length>0){t.TenantUsers=[];for(var n=0;n<t.SelectedUsers.length;n++)t.TenantUsers.push({B1Username:t.SelectedUsers[n].B1Username,ID:t.SelectedUsers[n].ID,LicenseModules:[],OriginalLicenseModules:[],PowerUser:t.SelectedUsers[n].PowerUser,SuperUser:t.SelectedUsers[n].SuperUser,Status:t.SelectedUsers[n].status,SystemUsername:t.SelectedUsers[n].systemUsername,TODO:"Modify"})}if(t.CustomerUsers&&t.CustomerUsers.length>0){for(var n=0;n<t.CustomerUsers.length;n++){var i=t.CustomerUsers[n],s=i.systemUsername;s&&s.length>8&&(s=s.substring(0,8)),i.B1Username&&i.B1Username.length>0&&(s=i.B1Username);var o=!1;for(var u=0;u<r.CustomerUsers.length;u++)if(r.CustomerUsers[u].SystemUsername==i.systemUsername){o=!0;break}if(!o)if(e&&e.length>0){var a=!1;for(var f=0;f<e.length;f++)if(e[f].domainUserName==i.systemUsername){a=!0;break}a||r.CustomerUsers.push({ID:i.ID,SystemUsername:i.systemUsername,Status:i.status,B1Username:s,IsOperator:!1,IsPowerUser:!1,PowerUser:!1,SuperUser:!1})}else r.CustomerUsers.push({ID:i.ID,SystemUsername:i.systemUsername,Status:i.status,B1Username:s,IsOperator:!1,IsPowerUser:!1,PowerUser:!1,SuperUser:!1})}m(t)}else t.CustomerGroupID&&t.CustomerGroupID>0?c3.service.getUsersByGroup(t.CustomerGroupID).query(function(e){if(e.data&&e.data.length>0)for(var n=0;n<e.data.length;n++){var i=e.data[n].SystemUsername;i&&i.length>8&&(i=i.substring(0,8)),r.CustomerUsers.push({ID:e.data[n].ID,Status:e.data[n].Status,SystemUsername:e.data[n].SystemUsername,B1Username:i,IsOperator:!1,IsPowerUser:!1,PowerUser:!1,SuperUser:!1})}m(t)}):r.loadingWin.close()})}else t.CustomerGroupID!=null&&t.CustomerGroupID>0?c3.service.getUsersByGroup(t.CustomerGroupID).query(function(n){if(n.data&&n.data.length>0){for(var o=0;o<n.data.length;o++){var u=n.data[o].SystemUsername;u&&u.length>8&&(u=u.substring(0,8));var a=!1;for(var f=0;f<t.TenantUsers.length;f++)if(t.TenantUsers[f].SystemUsername==n.data[o].SystemUsername){a=!0;break}a||r.CustomerUsers.push({ID:n.data[o].ID,Status:n.data[o].Status,SystemUsername:n.data[o].SystemUsername,B1Username:u,IsOperator:!1,IsPowerUser:!1,PowerUser:!1,SuperUser:!1})}m(t)}else s=[],i.reload(),e.close()}):(s=[],i.reload(),e.close());r.ldw=new loadingWindow,r.ldw.show();var o=null;t&&t.CustomerID&&t.CustomerID>0&&(o=t.CustomerID),customerManager.getOperatorDetailsByCustomer(o,function(e){if(e&&e.length>0)for(var n=0;n<e.length;n++){var i=e[n].domainUserName;i&&i.length>0&&i.length<8?i=i.substring(0,8):i=null,r.CloudOperators.push({ID:e[n].id,SystemUsername:e[n].domainUserName,Status:e[n].status,B1Username:i,IsOperator:e[n].roleName==="Cloud Operator",IsPowerUser:!0,PowerUser:!1,SuperUser:!1})}t&&t.CustomerID>0?c3.service.getTenants().filter("Customer/ID eq "+t.CustomerID).query(function(e){if(e.data&&e.data.length>0){var n=e.data,i=n.length,s=0;for(var o=0;o<n.length;o++)c3.service.getTenantUsers(n[o].ID).query(function(e){if(e.data&&e.data.length>0)for(var n=0;n<e.data.length;n++)for(var o=0;o<r.CloudOperators.length;o++)e.data[n].SystemUsername==r.CloudOperators[o].SystemUsername&&(r.CloudOperators[o].B1Username=e.data[n].SBOUsername);s++;if(s==i){v(t);return}})}else v(t)}):v(t)})},v=function(t){for(var i=0;i<r.CloudOperators.length;i++)(r.CloudOperators[i].B1Username=="_psu_1"||r.CloudOperators[i].B1Username=="_psu_2")&&r.CloudOperators.remove(i--);if(t&&t.TenantUsers&&t.TenantUsers.length>0){var s=[];if(n){for(var o=0;o<t.TenantUsers.length;o++)for(var i=0;i<r.CloudOperators.length;i++)if(t.TenantUsers[o].SystemUsername==r.CloudOperators[i].SystemUsername){r.CloudOperators.remove(i--);break}e.selectedItems=[]}else for(var o=0;o<t.TenantUsers.length;o++){var l=!1;for(var c=0;c<e.selectedItems.length;c++)if(e.selectedItems[c].SystemUsername==t.TenantUsers[o].SystemUsername){l=!0;break}l||e.selectedItems.push(y(t.TenantUsers[o]))}for(var o=0;o<t.TenantUsers.length;o++)for(var i=0;i<r.CloudOperators.length;i++)if(t.TenantUsers[o].SystemUsername==r.CloudOperators[i].SystemUsername){r.CloudOperators[i].PowerUser=t.TenantUsers[o].PowerUser,r.CloudOperators[i].SuperUser=t.TenantUsers[o].SuperUser,r.CloudOperators[i].B1Username=t.TenantUsers[o].B1Username,r.CloudOperators[i].Status=t.TenantUsers[o].Status,s.push(i);break}f.getDefaultSelectedIndex=function(){return s.length>0?s:-1}}a=r.CloudOperators,u.reload(),r.ldw.close()},m=function(e){e&&e.CustomerID>0?c3.service.getTenants().filter("Customer/ID eq "+e.CustomerID).query(function(e){if(e.data&&e.data.length>0){var t=e.data,n=t.length,i=0;for(var s=0;s<t.length;s++)c3.service.getTenantUsers(t[s].ID).query(function(e){if(e.data&&e.data.length>0)for(var t=0;t<e.data.length;t++)for(var s=0;s<r.CustomerUsers.length;s++)e.data[t].SystemUsername==r.CustomerUsers[s].SystemUsername&&(r.CustomerUsers[s].B1Username=e.data[t].SBOUsername);i++;if(i==n){g(),r.loadingWin.close();return}})}else g(),r.loadingWin.close()}):(g(),r.loadingWin.close())}},c3loadTenantUsers.step1=function(){function o(e){var t={};return t.text=n.Messages[e],t.className=n.Icons[e],t.showText=!0,statusControl(t)}function u(e,t){var r="Unknown",i=!1,s=!1;if(e!="new"&&e.substr(0,1)!="-"&&e!="")for(var o=0;o<n.SystemUsers.length;o++)if(n.SystemUsers[o].SystemUsername==e){r=n.SystemUsers[o].Status,i=n.SystemUsers[o].IsOperator,s=n.SystemUsers[o].IsPowerUser;break}c(t,"Status",r),c(t,"IsOperator",i),c(t,"IsPowerUser",s)}function a(e){var r=new c3addSystemUser(n,0,null,!1,"customer");r.finishEvent.push(function(){var i=r.User,s={success:function(t,i){f(r.User.Name);var s=r.User.Name;s&&s.length>0&&s.length<8?s=s.substring(0,8):s=null,n.SystemUsers.push({ID:-1,SystemUsername:r.User.Name,Status:r.User.Status,B1Username:s,IsOperator:!1,UserType:0,IsPowerUser:!0,PowerUser:!1,SuperUser:!1}),n.checkboxDoms[e].SystemUsername.val(r.User.Name),n.checkboxDoms[e].SystemUsername.change()},error:function(e,t){}},o=null;t&&t.CustomerID&&t.CustomerID>0&&(o=t.CustomerID),customerManager.createCustomerUser(o,i,s)}),r.show()}function f(e){var t=$("<option>").attr({value:e}).append("&nbsp;&nbsp;&nbsp;"+e);for(var r=0;r<n.checkboxDoms.length;r++){var i=n.checkboxDoms[r].SystemUsername.find('option[value="-1-"]');i.length==0&&(i=n.checkboxDoms[r].SystemUsername.find('option[value="-2-"]')),i.length>0?i.before(t.clone()):n.checkboxDoms[r].SystemUsername.append(t.clone())}}function l(e,t,r){for(var i=0;i<n.checkboxDoms.length;i++){var s=t.substr(0,1)=="-"||n.checkboxDoms[i].RowIndex!=e&&t!=""&&t!="new";n.checkboxDoms[i].SystemUsername.find('option[value="'+t+'"]').attr({disabled:s}),s=r.substr(0,1)=="-",n.checkboxDoms[i].SystemUsername.find('option[value="'+r+'"]').attr({disabled:s})}}function c(e,t,r){for(var i in e)if(i==t){e[i]=r;break}for(var s=0;s<n.TenantUsers.length;s++)if(n.TenantUsers[s].B1Username==e.B1Username){n.TenantUsers[s]=e;break}}function h(){e.btnFinish&&e.selectedItems&&e.selectedItems.length>0?e.btnFinish.attr({disabled:!1}):e.btnFinish.attr({disabled:!0})}function g(){if(t&&t.TenantUsers&&t.TenantUsers.length>0)for(var e=0;e<t.TenantUsers.length;e++)for(var s=0;s<n.TenantUsers.length;s++)if(t.TenantUsers[e].B1Username==n.TenantUsers[s].B1Username){n.TenantUsers[s].PowerUser=t.TenantUsers[e].PowerUser,n.TenantUsers[s].SuperUser=t.TenantUsers[e].SuperUser,n.TenantUsers[s].Action=n.Actions.stExists,n.TenantUsers[s].SystemUsername=t.TenantUsers[e].SystemUsername;break}n.TenantUsers.sort(function(e,t){return e.Action-t.Action}),i=n.TenantUsers,r.reload()}function y(e){var t={};for(var n in e)typeof e[n]=="object"?t[n]=y(e[n]):typeof e[n]!="function"&&(t[n]=e[n]);return t}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=arguments[1]||{},n=this;n.checkboxDoms=[],n.Messages=[localizedString("LOADTENANTUSER_POPWIN_DEFAULT_MESSAGE"),localizedString("LOADTENANTUSER_POPWIN_USER_FOUND"),localizedString("LOADTENANTUSER_POPWIN_USER_OVERWRITTEN"),localizedString("LOADTENANTUSER_POPWIN_ERROR"),localizedString("LOADTENANTUSER_POPWIN_ALREADY_ASSIGNED"),localizedString("LOADTENANTUSER_POPWIN_BLOCKED")],n.Actions=Object.freeze({stNotImporting:0,stAutomatic:1,stManual:2,stError:3,stExists:4,stBlockedUser:5}),n.Icons=["UserSkip","UserQuestion","UserAdd","UserErr","UserLocked","UserLocked"],e.selectedItems=[];var r=null,i=[],s={getHeaderSpec:function(){return[{name:"B1Username",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"12%"},{name:"SystemUsername",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"20%"},{name:"IsOperator",description:localizedString("COLUMN_ISSUPERUSER"),type:"text",width:"12%"},{name:"IsPowerUser",description:localizedString("B1_POWERUSER"),type:"text",width:"12%"},{name:"Action",description:localizedString("MISC_STATUS"),type:"text"}]},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 400},getCell:function(){var e=null,t=this;if(this.colName=="IsOperator"||this.colName=="IsPowerUser"){var r=$("<input>").attr("type","checkbox"),i="PowerUser";if(this.colName=="IsOperator"){var s=this.data[this.colName];r.attr("disabled",Math.abs(s-1)),i="SuperUser"}var f=this.row;this.data[i]==1&&$(r).attr("checked",!0);if(i=="PowerUser")for(var h=0;h<n.checkboxDoms.length;h++)if(n.checkboxDoms[h].RowIndex==f&&$(n.checkboxDoms[h]["SuperUser"]).attr("checked")==1){$(r).attr({disabled:!0,checked:!0});break}this.data.Action>=n.Actions.stExists&&$(r).attr({disabled:!0});var p=this.data,d=0;r.click(function(){var e=!1;if($(this).attr("checked")==1||$(this).attr("checked")==1||$(this).attr("checked")=="checked")e=!0;if(i=="SuperUser")for(var t=0;t<n.checkboxDoms.length;t++)if(n.checkboxDoms[t].RowIndex==f&&n.checkboxDoms[t].PowerUser){e?($(n.checkboxDoms[t].PowerUser).attr({disabled:!0,checked:!0}),$(n.checkboxDoms[t].SuperUser).removeAttr("disabled"),c(p,"PowerUser",!0)):$(n.checkboxDoms[t].PowerUser).removeAttr("disabled");break}c(p,i,e)});var v=!1;for(var h=0;h<n.checkboxDoms.length;h++)if(n.checkboxDoms[h].RowIndex==f){n.checkboxDoms[h][i]=r,v=!0;break}if(!v){var m={RowIndex:f,Name:t.data.SystemUsername};m[i]=r,n.checkboxDoms.push(m)}return r}if(this.colName=="SystemUsername"){var g=this.data[this.colName],y=n.dropdown.clone(),t=this;t.text=y,y.bind("change",function(){var e=t.text.val(),r=t.data[t.colName];e=="new"&&(a(t.row),t.text.val(""),e=t.text.val());var i=n.Actions.stNotImporting;e!="new"&&e.substr(0,1)!="-"&&e!=""&&(i=n.Actions.stManual),t.parentRow.find("td").last().empty().append(o(i)),u(e,t.data);for(var s=0;s<n.checkboxDoms.length;s++)if(n.checkboxDoms[s].RowIndex==t.row){if(t.data.IsOperator)$(n.checkboxDoms[s].PowerUser).attr({disabled:t.data.SuperUser}),$(n.checkboxDoms[s].SuperUser).removeAttr("disabled");else{var f=t.data.IsPowerUser;$(n.checkboxDoms[s].PowerUser).attr({disabled:!f}),$(n.checkboxDoms[s].SuperUser).attr({disabled:!0,checked:!1}),c(t.data,"SuperUser",!1)}break}l(t.row,e,r),c(t.data,"Action",i),c(t.data,t.colName,e)}),y.val(g),u(g,this.data),this.data.Action>=n.Actions.stExists&&y.attr({disabled:!0});var v=!1;for(var h=0;h<n.checkboxDoms.length;h++)if(n.checkboxDoms[h].RowIndex==this.row){n.checkboxDoms[h][this.colName]=y,v=!0;break}if(!v){var m={RowIndex:this.row,Name:t.data.B1Username};m[this.colName]=y,n.checkboxDoms.push(m)}return l(this.row,g,""),y}if(this.colName=="Action")return o(this.data[this.colName]);if(this.colName=="B1Username"){var b=this.data[this.colName],w=$("<span>").append(b);return this.data.Action>=n.Actions.stExists&&w.toggleClass("disabled"),w}return e},getTip:function(){return Utility.CreateTipBoard(localizedString("LOADTENANTUSER_POPWIN_EMPTY_TIP_PART"),null,!0)}};this.onInit=function(){var e=$("<div>"),t=$("<section>");r=t.gridview({delegate:s,checkType:0}),n.gridView=r,r.show();var i=$("<div>").append("* "+localizedString("PROMPT")).css({width:"100%",padding:"2px 0 8px 0"});e.append(i);var o=$("<div>").css({width:"100%",padding:"5px 0 2px 0","font-weight":"bold"}).append(localizedString("ADDCUST_POP_NORMALUSER_TLT")),u=$("<div>").css({width:"100%",color:"Red","padding-top":"10px"});e.append(t).append(u),n.errorPanel=u,n.body=e,this._container.append(e)},this.onViewAppear=function(){p()};var p=function(){var e=new loadingWindow;e.show(),n.loadingWin=e,n.TenantUsers=[],n.CloudOperators=[],n.SystemUsers=[];var r=null;t&&t.CustomerID&&t.CustomerID>0&&(r=t.CustomerID),customerManager.getOperatorDetailsByCustomer(r,function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++){var r=e[t].domainUserName;r&&r.length>0&&r.length<8?r=r.substring(0,8):r=null,n.CloudOperators.push({ID:e[t].id,SystemUsername:e[t].domainUserName,Status:e[t].status,B1Username:r,IsOperator:e[t].roleName==="Cloud Operator",UserType:e[t].roleName==="Cloud Operator"?2:1,IsPowerUser:!0,PowerUser:!1,SuperUser:!1})}d()})},d=function(){t.CustomerGroupID!=null&&t.CustomerGroupID>0?c3.service.getUsersByGroup(t.CustomerGroupID).query(function(e){if(e.data&&e.data.length>0)for(var t=0;t<e.data.length;t++){var r=e.data[t].SystemUsername;r&&r.length>0&&r.length<8?r=r.substring(0,8):r=null,n.SystemUsers.push({ID:e.data[t].ID,SystemUsername:e.data[t].SystemUsername,Status:e.data[t].Status,B1Username:r,IsOperator:!1,UserType:0,IsPowerUser:!0,PowerUser:!1,SuperUser:!1})}v()}):v()},v=function(){function e(e,t){return e.SystemUsername>t.SystemUsername?1:e.SystemUsername<t.SystemUsername?-1:0}n.SystemUsers.sort(e),n.CloudOperators.sort(e);for(var s=0;s<n.CloudOperators.length;s++)n.CloudOperators[s].IsOperator||n.SystemUsers.push(n.CloudOperators[s]);for(var s=0;s<n.CloudOperators.length;s++)n.CloudOperators[s].IsOperator&&n.SystemUsers.push(n.CloudOperators[s]);n.CloudOperators=null;var o=[localizedString("ADDCUST_POP_NORMALUSER_TLT"),localizedString("RESPOOL_RESELLER_TLTS"),localizedString("RESPOOL_TAB_LABEL_OPERATORS")],u=$("<select>");u.attr({size:"1"}),u.css({width:"125px",height:"20px"}),u.find("option").remove(),u.append($("<option>"));var a=-1,f=!0;for(var s=0;s<n.SystemUsers.length;s++)f&&(f=!1,a=0,u.append($("<option>").attr({value:"-"+a+"-",disabled:!0}).append(o[a])),u.append($("<option>").attr({value:"new"}).append("&nbsp;&nbsp;&nbsp;"+localizedString("DROPDOWNLIST_NEWOPTION")))),n.SystemUsers[s].UserType!=a&&(a=n.SystemUsers[s].UserType,u.append($("<option>").attr({value:"-"+a+"-",disabled:!0}).append(o[a]))),u.append($("<option>").attr({value:n.SystemUsers[s].SystemUsername}).append("&nbsp;&nbsp;&nbsp;"+n.SystemUsers[s].SystemUsername));n.dropdown=u,t.TenantID!=null&&t.TenantID>0?c3.service.loadTenantUsers(t.TenantID).query(function(e){var s=["WORKFLOW","B1I","_PSU_1","_PSU_2"];if(e.data&&e.data.length>0){for(var o=0;o<e.data.length;o++)n.TenantUsers.push({ID:e.data[o].ID,B1Username:e.data[o].SBOUsername,SystemUsername:"",IsOperator:!1,IsPowerUser:!1,PowerUser:e.data[o].IsSuperuser,SuperUser:!1,Status:"Unknown",Action:s.indexOf(e.data[o].SBOUsername.toUpperCase())==-1?n.Actions.stNotImporting:n.Actions.stBlockedUser});m(t)}else i=[],r.reload(),n.loadingWin.close()}):(i=[],r.reload(),n.loadingWin.close())},m=function(e){e&&e.CustomerID>0?c3.service.getTenants().filter("Customer/ID eq "+e.CustomerID).query(function(t){if(t.data&&t.data.length>0){var r=t.data,i=r.length,s=0;for(var o=0;o<r.length;o++)c3.service.getTenantUsers(r[o].ID).query(function(t){if(t.data&&t.data.length>0)for(var r=0;r<t.data.length;r++)for(var o=0;o<n.TenantUsers.length;o++)if(t.data[r].SBOUsername==n.TenantUsers[o].B1Username&&t.data[r].SystemUsername){var u=!1;if(e&&e.TenantUsers&&e.TenantUsers.length>0)for(var a=0;a<e.TenantUsers.length;a++)if(e.TenantUsers[a].SystemUsername==t.data[r].SystemUsername){u=!0;break}u||n.TenantUsers[o].SystemUsername||(n.TenantUsers[o].Action<n.Actions.stExists&&(n.TenantUsers[o].Action=n.Actions.stAutomatic),n.TenantUsers[o].SystemUsername=t.data[r].SystemUsername)}s++;if(s==i){g(),n.loadingWin.close();return}})}else g(),n.loadingWin.close()}):(g(),n.loadingWin.close())}},c3assignLicFileToReseller.step1=function(e){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite"),this.parent=e;var t=arguments[0]||{},n="Assign Service Units to Reseller",r=[{name:"InstallationNumber",description:localizedString("COLUMN_INSTALL_NO"),type:"text",width:"30%"},{name:"SystemNumber",description:localizedString("COLUMN_SYS_NO"),type:"text",width:"25%"},{name:"Localization",description:localizedString("MISC_LOCATION"),type:"text",width:"25%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"20%"}],i=this,s=null,o=[],u={needExport:function(){return!1},getHeaderSpec:function(){return r},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 347},getTip:function(){return Utility.CreateTipBoard(localizedString("TENANT_LICENSE_FILE"),function(){},!0)},getCell:function(){var e=null;if(this.colName=="LicenseServer"){var t={};t.text=this.data[this.colName].Status,e=new statusControl(t)}if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}};this.onInit=function(){var e=$("<div>");s=e.gridview({delegate:u,checkType:1}),s.rowCheckEvent.push(function(){var e=this.index;if(this.isChecked){var n=!1;for(var r=0;r<t.licenseFiles.length;r++)t.licenseFiles[r].ID==o[e].ID&&(n=!0);n||t.licenseFiles.push(o[e])}else{var n=!1,i=-1;for(var r=0;r<t.licenseFiles.length;r++)t.licenseFiles[r].ID==o[e].ID&&(n=!0,i=r);n&&i>=0&&t.licenseFiles.remove(i)}}),this._container.append(e),s.show();var n=new loadingWindow;i.loadingWin=n},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){i.reload()})},this.onViewAppear=function(){f(),a()};var a=function(){return!0};this.reload=function(){f()};var f=function(){o=[];var e="";i.loadingWin.show(),c3.service.getLicenseFiles().expand("LicenseServer").query(function(e){i.loadingWin.close();if(e.data&&e.data.length>0)for(var t=0;t<e.data.length;t++){var n=function(n){return n.ID===e.data[t].ID},r=e.data[t],u=0;if(i.parent.controller.Licenses&&i.parent.controller.Licenses.filter(n).length>0){u++;continue}o.push(e.data[t])}s.reload()})}},c3newSWRepository.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=this,n={RootPath:{Name:localizedString("WIZADR_SWREPO_ROOTPATH"),Value:new textbox({isRequired:!0})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},r={checkValidity:function(){return t.version&&t.version.hide(),t.uri&&t.uri.hide(),e.SWRepositoryEntity.RootURI=n.RootPath.Value.val(),e.SWRepositoryEntity.Description=n.Description.Value.val(),n.RootPath.Value.checkValidity()}};this.validator=r,this.reset=function(){n.RootPath.Value.val(""),n.Description.Value.val("")},this.onInit=function(){for(var e in n)this._container.append(Utility.CreateRow(n[e].Name,n[e].Value))}},c3importLicenseFile.step1=function(){function a(){var e=$("<div>").addClass("licenseRow");e.append($("<div>").append(localizedString("RES_VIEWLIC_LICFILE")).addClass("rowName_licserver"));var t=$("<input>").attr({type:"file",name:"LicenseContent",size:"30"}),n=$("<img>").attr({alt:"",src:c3Icon.Loading}).css("display","none");o.iptStatus=n,e.append($("<div>").append(t).append(n).addClass("rowValue_licserver"));var r=$("<input>").attr({type:"button",value:localizedString("DATAFORM_IMPORT")}).click(function(){o.iptStatus.css("display","inline").attr({src:c3Icon.Loading});var t=e.find("input[type=file]");if(t.size()>0){var n={};getLicenseFileContent(t[0],f)}});return e.append($("<div>").attr("class","rowBtn_licserver").append(r)),e}function f(e){if(!e){o.iptStatus.attr("src",c3Icon.Failed).css("display","inline"),alert(localizedString("IMPORTLICFILE_IMPORTERROR_INVALIDLICFILE"));return}c3.service.parseLicenseFile(e,{error:function(){o.iptStatus.attr("src",c3Icon.Failed).css("display","inline")},success:function(t){if(!(t.d&&t.d.results&&t.d.results.length>0)){o.iptStatus.attr("src",c3Icon.Failed).css("display","inline"),alert(localizedString("IMPORTLICFILE_IMPORTERROR_INVALIDLICFILE"));return}var n=!1;for(var r=0;r<s.length;r++)if(t.d.results[0].InstallationNumber==s[r].InstallationNumber){n=!0;var a=t.d.results[t.d.results.length-1];t.d.results.remove(t.d.results.length-1),c3.service.getLicenseFiles().filter("InstallationNumber eq '"+s[r].InstallationNumber+"' and LicenseServer/ID eq "+i.ID).query(function(n){if(n.data&&n.data.length>0){var r=n.data[0];c3.service.getLicenseModulesByLicenseFileId(r.ID).query(function(n){if(n.data&&n.data.length>0){var r=new c3importLicenseFileConfimation(o,n.data,t.d.results,e);r.finishEvent.push(function(){u!=null&&(u.reload(),o.iptStatus.attr("src",c3Icon.Success).css("display","inline"))}),r.onClose.push(function(){o.iptStatus.css("display","none")}),r.show()}})}});return}n||l(e)}})}function l(n){c3.service.importLicenseFile(n,function(n){if(n.response!=null){var r=JSON.parse(n.response);if(r.error!=null&&r.error.code!=null){o.iptStatus.attr("src",c3Icon.Failed).css("display","inline");return}}c3.service.getDetail(i.LicenseFiles).expand("LicenseServer").query(function(n){if(n.data&&n.data.length>0){var r=c3.service.convertData(n.data);t=r,e.reload(),o.iptStatus.attr("src",c3Icon.Success).css("display","inline")}})})}function c(){!s||s.length==0?(t=[],e.reload()):(t=s,e.reload())}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=null,t=[],n={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"InstallationNumber",description:localizedString("COLUMN_INSTALL_NO"),type:"text",width:"50%"},{name:"SystemNumber",description:localizedString("COLUMN_SYS_NO"),type:"text",width:"50%"}]},getRowCount:function(){return t.length},getRow:function(e){return t[e]},getGridHeight:function(){return 345}},r=arguments[0]||{},i=arguments[1]||{},s=arguments[2]||[],o=this,u=arguments[3]||null;this.onInit=function(){var t=$("<div>"),r=$("<div>").css({"float":"left",width:"100%"});e=r.gridview({delegate:n}),o._container.append(t.append(a())),o._container.append(r),e.show()},this.onViewAppear=function(){c()}},c3importLicenseFileConfimation.step1=function(){function l(){var e=$("<div>"),t=$("<div>").append(localizedString("IMPORTLIC_POPWIN_CONFIRM_WARNINGMSG"));return e.append(t),e}function c(){t=u,f.dbModulesCount.text(u.length+localizedString("IMPORTLIC_POPWIN_CONFIRM_UNIT")),e.reload(),i=a,f.fileModulesCount.text(a.length+localizedString("IMPORTLIC_POPWIN_CONFIRM_UNIT")),r.reload()}c3.module.call(this),this._container=$("<div>").addClass("wizard_lite");var e=null,t=[],n={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Description",description:localizedString("RESPOOL_LICSERVER_COLUMN_LICTYPE"),type:"text",width:"35%"},{name:"StartDate",description:localizedString("COLUMN_CREATE_DATE"),type:"text",width:"20%"},{name:"ExpirationDate",description:localizedString("RESPOOL_LICSERVER_COLUMN_EXPIREDDATE"),type:"text",width:"25%"},{name:"Available",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"20%"}]},getRowCount:function(){return t.length},getRow:function(e){return t[e]},getGridHeight:function(){return 150},getCell:function(){if(this.colName=="StartDate"||this.colName=="ExpirationDate"){var e=this.data[this.colName];return convertToDate(e).dateString()}return this.colName=="Available"?this.data[this.colName]+"/"+this.data.Total:null}},r=null,i=[],s={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Description",description:localizedString("RESPOOL_LICSERVER_COLUMN_LICTYPE"),type:"text",width:"35%"},{name:"StartDate",description:localizedString("COLUMN_CREATE_DATE"),type:"text",width:"20%"},{name:"ExpirationDate",description:localizedString("RESPOOL_LICSERVER_COLUMN_EXPIREDDATE"),type:"text",width:"25%"},{name:"Available",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"20%"}]},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 150},getCell:function(){if(this.colName=="StartDate"||this.colName=="ExpirationDate"){var e=this.data[this.colName];return convertToDate(e).dateString()}return this.colName=="Available"?this.data[this.colName]+"/"+this.data.Total:null}},o=arguments[0]||{},u=arguments[1]||{},a=arguments[2]||[],f=this;this.onInit=function(){f._container.append(l());var t=$("<div>").css({"float":"left"});e=t.gridview({delegate:n});var i=$("<legend>").css({"padding-left":"10px","line-height":"25px"}).append(localizedString("IMPORTLIC_POPWIN_CONFIRM_DBPANEL_TLT")+":"),o=$("<fieldset>").attr("class","confirmFieldset").append(i);f.dbModulesCount=$("<span>").css({"padding-left":"10px","font-weight":"bold"}),i.append(f.dbModulesCount),o.append(t),f._container.append(o);var u=$("<div>").css({"float":"left"});r=u.gridview({delegate:s});var a=$("<legend>").css({"padding-left":"10px","line-height":"25px"}).append(localizedString("IMPORTLIC_POPWIN_CONFIRM_FILEPANEL_TLT")+":"),c=$("<fieldset>").attr("class","confirmFieldset").append(a);f.fileModulesCount=$("<span>").css({"padding-left":"10px","font-weight":"bold"}),a.append(f.fileModulesCount),c.append(u),f._container.append(c);var h=$("<div>").css({"float":"left"});h.text(localizedString("IMPORTLIC_POPWIN_CONFIRM_TIPMSG")),f._container.append(h),e.show(),r.show()},this.onViewAppear=function(){c()}};var FileField=function(){};FileField.prototype.id=undefined,FileField.prototype.filename="",FileField.prototype.name="",FileField.prototype.displayName="",FileField.prototype.className="subFile",FileField.prototype.control=null;var AddOnInfo=function(){var e=new FileField;e.name="ard",e.className="",e.displayName=localizedString("WIZARD_SWREPO_EXTENSION_ARD_FILE"),this.ardField=e,e=new FileField,e.name="instname",e.displayName=localizedString("WIZARD_SWREPO_EXTENSION_INSTALL_FILE"),this.installField=e,e=new FileField,e.name="zipnameinst",e.displayName=localizedString("WIZARD_SWREPO_EXTENSION_INSTALL_PARAM_FILE"),this.installParamField=e,e=new FileField,e.name="uninstname",e.displayName=localizedString("WIZARD_SWREPO_EXTENSION_UNINSTALL_FILE"),this.unInstallField=e,e=new FileField,e.name="zipnameuninst",e.displayName=localizedString("WIZARD_SWREPO_EXTENSION_UNINSTALL_PARAM_FILE"),this.unInstallParamField=e,e=new FileField,e.name="ugdname",e.displayName=localizedString("WIZARD_SWREPO_EXTENSION_UPGRADE_FILE"),this.upgradeField=e,e=new FileField,e.name="zipnameugd",e.displayName=localizedString("WIZARD_SWREPO_EXTENSION_UPGRADE_PARAM_FILE"),this.upgradeParamField=e};c3importAddOn.step1=function(){function s(e,t,n){var r=$("<div>"),i=$("<input>").attr({type:"file"}).css({visibility:"collapse",height:"0px",width:"0px"}),s=new textbox({isRequired:!0,isReadonly:!0,isDisabled:!0}),o=$("<input>").attr({type:"button","class":"browseBtn",value:localizedString("MISC_BROWSE")});t&&i.attr("multiple","multiple"),e.id!=undefined&&s.attr({id:e.id}),e.name!=undefined&&e.name!=""&&s.attr({name:e.name}),o.click(function(){i.click()}),i.bind("change",n),s.placeAt(r),r.append(o),r.append(i);var u=Utility.CreateRow(e.displayName,r);return e.control=s,u.fileField=e,e.className!=""&&u.addClass(e.className),u.attr("name",e.className),u}function o(e){var t=!1;for(var n=0,r=e.length;n<r;n++){var i=e[n],s=i.getExtName();if(String.compare(s,"ard",!0)){t=!0;break}}return t}function u(n){var r=$("<div>").attr({"class":"upload-control",id:"upload-control"}),i=t.UploadNumber,u=new AddOnInfo;if(n){var c=$("<a>").attr({"class":"close",href:"#"}).append(localizedString("MISC_REMOVE"));c.click(function(){$(this.parentElement).remove(),t.UploadQueue[i]=undefined,t.UploadNumber--;for(var n=0;n<e.formControls.length;n++)if(e.formControls[n]["ard"].attr("id")==i){var r=n;break}e.formControls.remove(r)}),r.append(c)}var h={},p=["exe","zip","ini"],d=s(u.ardField,!0,function(n){var c=n.target.files;if(!o(c)){var p=localizedString("WIZARD_SWREPO_EXTENSION_FILE_TYPE_ERROR");p=String.format(p,u.ardField.displayName.toLowerCase()),u.ardField.control.showErrorMessage(p);return}t.UploadQueue[i]={ArdFileName:"",ArdInfo:null,Files:[]};for(var v=0,m=c.length;v<m;v++){var g=c[v],y=g.getExtName();if(String.compare(y,"ard",!0)){if(g.size>e.maxFileSize){var p=localizedString("WIZARD_SWREPO_EXTENSION_FILE_SIZE_EXCEED");u.ardField.control.showErrorMessage(p);return}if(f(g.name))continue;t.UploadQueue[i].ArdFileName=g.name,t.UploadQueue[i].Files.clear(),r.find(".subFile").remove();for(var b in h)b!="ard"&&(h[b]=undefined);t.UploadQueue[i].Files.push(g),d.fileField.control.val(g.name);var w=new FileReader;w.onload=function(n){var o=(new DOMParser).parseFromString(n.target.result,"text/xml"),f=l(o);for(var p in u){if(p=="unInstallField"||p=="unInstallParamField")if(f[u["unInstallField"].name]==f[u["installField"].name])continue;if(u[p].name!="ard"){u[p].filename=f[u[p].name];if(u[p].filename!=""){var d=a(c,u[p].filename),v=function(n){return s(n,!1,function(r){var s=r.target.files[0];if(s.size>e.maxFileSize){var o=localizedString("WIZARD_SWREPO_EXTENSION_FILE_SIZE_EXCEED");n.control.showErrorMessage(o)}else if(String.compare(n.filename,s.name,!0))n.control.val(s.name),t.UploadQueue[i].Files.push(s);else{var o=localizedString("WIZARD_SWREPO_EXTENSION_FILE_TYPE_ERROR");o=String.format(o,n.displayName.toLowerCase()),n.control.showErrorMessage(o)}})}(u[p]);d!=undefined&&(v.fileField.control.val(d.name),t.UploadQueue[i].Files.push(d)),r.append(v),h[v.fileField.name]=v.fileField.control}}}},w.readAsText(g);break}}});return r.append(d),d.fileField.control.attr({id:i}),h.ard=d.fileField.control,e.formControls.push(h),t.UploadNumber++,r}function a(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n],s=i.getExtName();if(String.compare(i.name,t,!0))return i}}function f(e){for(var n in t.UploadQueue)if(t.UploadQueue[n]!=undefined&&String.compare(e,t.UploadQueue[n].ArdFileName,!0))return!0;return!1}function l(e){var t=e.documentElement.firstElementChild,n={};for(var r in t.attributes)n[t.attributes[r].name]=t.attributes[r].nodeValue;return n}this.base=c3.module,this.base(),this._container=$("<div>").attr({id:"importAddOnStep1"}),this.uploadPanel=$("<div>").attr({id:"upload-addon-panel"}),this.formControls=[];var e=this;e.maxFileSize=1073741824;var t=arguments[0]||{},n=new loadingWindow,r=$("<a>").attr({href:"#"}).text(localizedString("IMPORTADDON_LINK_ADDMORE"));r.click(function(){e.uploadPanel.append(u(!0))}),this.onInit=function(){var t=new AddOnInfo;e.uploadPanel.append(u(!1)),e._container.append(e.uploadPanel),e._container.append(r)},this.onViewAppear=function(){};var i={checkValidity:function(){var t=!0;for(var n=0,r=e.formControls.length;n<r;n++)for(var i in e.formControls[n])e.formControls[n][i]!=undefined&&!e.formControls[n][i].checkValidity()&&(t=!1);return t}};this.validator=i},c3importAddOn.step2=function(){function n(){var n=$("<section>"),r=[{name:"ExtName",description:localizedString("EXTENSION")+" "+localizedString("MISC_NAME"),type:"text",width:"50%"},{name:"Status",description:localizedString("WIZARD_SWREPO_EXTENSION_UPLOAD_STATUS"),type:"text",width:"50%"}];e.data=[],e.failureData=[],e.ProgressCols={};for(var i in t.UploadQueue){i=parseInt(i);if(t.UploadQueue[i]!=undefined){var s=$("<progress>").attr({value:"0",max:"100",id:i});e.ProgressCols[i]=s,e.data.push({ExtName:t.UploadQueue[i].ArdFileName.substring(0,t.UploadQueue[i].ArdFileName.lastIndexOf(".")),Status:s})}}var o={getHeaderSpec:function(){return r},getRowCount:function(){return e.data.length},getRow:function(t){return e.data[t]},getGridHeight:function(){return 340}};e.gridDelegate=o;var u=$(n).gridview({delegate:o});u.show(),e.dataGrid=u;var a=0;for(var i in t.UploadQueue){i=parseInt(i);var f=new FormData;if(t.UploadQueue[i]!=undefined){for(var l=0,c=t.UploadQueue[i].Files.length;l<c;l++)f.append("ard"+l,t.UploadQueue[i].Files[l]);var h=new XMLHttpRequest,p=null,d=function(e,t,n){t.attr("value","0"),t.addClass("progress_wrap").addClass("failed").attr("title",e.target.statusText)},v=function(e,t){return function(n){d(n,t,e)}}(t.UploadQueue[i].ArdFileName,e.ProgressCols[i]),m=function(e){e.lengthComputable&&(p=e.total,console.log("File length: "+p))},g=function(e,t){e.lengthComputable&&(t.max=e.total,t.value=e.loaded)},y=function(e){return function(e,n,r){var i=e.target;i.status<200||i.status>=300?(console.log(r+" upload failed!"),d(e,n,r)):(n.attr("value","0"),n.addClass("progress_wrap").addClass("done")),++a==t.UploadNumber&&t.enableNext()}}(e.ProgressCols[i]);h.upload.addEventListener("loadstart",m),h.upload.addEventListener("progress",function(e){return function(t){g(t,e)}}(e.ProgressCols[i][0])),h.addEventListener("load",function(e,t){return function(n){y(n,e,t)}}(e.ProgressCols[i],t.UploadQueue[i].ArdFileName)),h.addEventListener("error",v),h.addEventListener("abort",v),h.open("POST","/sld/extension/Import",!0),h.send(f)}}return n}this.base=c3.module,this.base();var e=this,t=arguments[0];this._container=$("<div>").attr({id:"importAddOnStep2"}),this.onInit=function(){t.disableBack(),t.disableNext(),t.disableCancel(),console.log(t.UploadQueue),e._container.append(n())}},c3importDynamicKey.step1=function(){function i(){var t=$("<div>").addClass("licenseRow");t.append($("<div>").append(localizedString("ImportDetatil"))),t.append($("<div>").html("<br></br>")),t.append($("<div>").append(localizedString("DynamicKey")).addClass("rowName"));var n=$("<input>").attr({type:"file",name:"DynamicKeyContent",size:"30"});t.append($("<div>").append(n).addClass("rowValue")),t.append($("<div>").html("<br></br>")),t.append($("<div>").append(localizedString("SiteUserPassword")).addClass("rowName"));var r=new textbox({type:"password",isRequired:!0});return r.css({width:"192px",height:"18px"}),r.placeAt(t),e.checks.push(r),t}var e=this;this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite"),e.checks=[];var t=arguments[0]||{},n=arguments[1]||null;this.onInit=function(){var t=$("<div>");e._container.append(t.append(i()))};var r={checkValidity:function(){var t=!0;for(var n=0,r=e.checks.length;n<r;n++)t=e.checks[n].checkValidity();return t}};this.validator=r;var s=function(n){var r=n,i=r.indexOf("%3D");i!=-1&&(r=r.substring(0,i)+"'");var s={};s.success=function(e){t.readyForFinish(),e.d.ImportDynamicKey?alert(localizedString("ImportConfigSuccess")):alert(localizedString("ImportConfigSuccess"))},s.error=function(){t.readyForFinish()},c3.service.ImportDynamicKey(r,e.checks[0].val(),s)};this.importDkey=function(){var t=e.getContainer().find("input[type=file]");for(var n=0;n<t.length;n++)t[n].files&&t[n].files.length&&t[n].files[0].size>0&&readDKeyFileContent(t[n],s)},this.onViewAppear=function(){}},c3exportDynamicKey.step1=function(){function i(){var t=$("<div>").addClass("licenseRow");t.append($("<div>").append(localizedString("ExportDetail"))),t.append($("<div>").html("<br></br>")),t.append($("<div>").append(localizedString("SiteUserPassword")).addClass("rowName"));var n=new textbox({type:"password",isRequired:!0});return n.css({width:"192px",height:"18px"}),n.placeAt(t),e.checks.push(n),t}var e=this;this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite"),e.checks=[];var t=arguments[0]||{},n=arguments[1]||null;this.onInit=function(){var t=$("<div>");e._container.append(t.append(i()))};var r={checkValidity:function(){var t=!0;for(var n=0,r=e.checks.length;n<r;n++)t=e.checks[n].checkValidity();return t}};this.validator=r,this.exportDkey=function(){exportOpt={},exportOpt.success=function(e){t.readyForFinish()},exportOpt.error=function(){t.readyForFinish()},c3.service.ExportDynamicKey(exportOpt,e.checks[0].val())},this.onViewAppear=function(){}},c3registerImplRepository.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t={Path:{Name:localizedString("MISC_PATH"),Value:new textbox({isRequired:!0})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},n={checkValidity:function(){return e.PackageRepositoryEntity.URI=$.trim(t.Path.Value.val()),e.PackageRepositoryEntity.Description=t.Description.Value.val(),t.Path.Value.checkValidity()}};this.validator=n,this.reset=function(){t.Path.Value.val(""),t.Description.Value.val("")},this.onInit=function(){for(var e in t)this._container.append(Utility.CreateRow(t[e].Name,t[e].Value))}},c3registerCompanyTemplateRepository.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t={Path:{Name:localizedString("MISC_PATH"),Value:new textbox({isRequired:!0})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},n={checkValidity:function(){return e.CompanyTemplateRepositoryEntity.URI=$.trim(t.Path.Value.val()),e.CompanyTemplateRepositoryEntity.Description=t.Description.Value.val(),t.Path.Value.checkValidity()}};this.validator=n,this.reset=function(){t.Path.Value.val(""),t.Description.Value.val("")},this.onInit=function(){for(var e in t)this._container.append(Utility.CreateRow(t[e].Name,t[e].Value))}},c3tenantPreUpgrade_errorMessage.step1=function(){function h(){var r=0;for(var i=0;i<u.length;i++)if(u[i].TenantID==n){r=u[i].ConfirmItems.length;break}var s=0;for(var i=0;i<t.length;i++)t[i].Type=="Warning"&&s++;e.readyForFinish&&s==r?e.btnFinish.removeAttr("disabled"):e.btnFinish.attr({disabled:!0}),o!=1&&e.btnFinish.removeAttr("disabled")}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=arguments[1]||undefined,n=arguments[2]||undefined,r=localizedString("PREUPGRADE_LABEL_TNTLIST"),i=[localizedString("PREUPGRADE_LABEL_UPGTNTS")],s=null,o=arguments[3]||null,u=arguments[4]||[];o==1?s=[{name:"CheckID",description:localizedString("PREUPGERROR_COLUMN_CHECKID"),type:"text",width:"15%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"15%"},{name:"Description",description:localizedString("MISC_DESCRIPTION"),type:"text",width:"40%"},{name:"SAPNote",description:localizedString("PREUPGERROR_COLUMN_SAPNOTE"),type:"text",width:"15%"},{name:"Confirm",description:localizedString("PREUPGERROR_BTN_CONFIRM"),type:"text",width:"15%"}]:s=[{name:"CheckID",description:localizedString("PREUPGERROR_COLUMN_CHECKID"),type:"text",width:"15%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"15%"},{name:"Description",description:localizedString("MISC_DESCRIPTION"),type:"text",width:"50%"},{name:"SAPNote",description:localizedString("PREUPGERROR_COLUMN_SAPNOTE"),type:"text",width:"20%"}];var a=null,f=[],l={getHeaderSpec:function(){return s},getRowCount:function(){return f.length},getRow:function(e){return f[e]},getGridHeight:function(){return 310},getCell:function(){if(this.colName=="SAPNote"){var e=$("<a>"),t=f[this.row];return e.text(t.SAPNote).attr({href:"#"}).bind("click",function(){window.open(t.SAPNoteURL)}),e}if(this.colName=="Confirm"){var t=f[this.row];if(t.Type=="Warning"){var r=$("<input>").attr({type:"checkbox"});if(u!=null)for(var i=0;i<u.length;i++)if(u[i].TenantID==n){for(var s=0;s<u[i].ConfirmItems.length;s++)if(u[i].ConfirmItems[s].CheckID==t.CheckID){r.attr("checked",1);break}break}return r.click(function(){if(this.checked==1){var e=!1;for(var r=0;r<u.length;r++)if(u[r].TenantID==n){e=!0,u[r].ConfirmItems||(u[r].ConfirmItems=[]),u[r].ConfirmItems.push({CheckID:t.CheckID});break}e||u.push({TenantID:n,ConfirmItems:[{CheckID:t.CheckID}]})}else for(var r=0;r<u.length;r++)if(u[r].TenantID==n){for(var i=0;i<u[r].ConfirmItems.length;i++)if(u[r].ConfirmItems[i].CheckID==t.CheckID){u[r].ConfirmItems.remove(i);break}break}h()}),r}return null}}};this.onInit=function(){var e=$("<div>"),r=$("<div>").append($("<span>").html(localizedString("PREUPGERROR_LABEL_TNTID")+":&nbsp;&nbsp;&nbsp;&nbsp;"));r.append($("<strong>").text(n)).append("<br/><br/>");var i=$("<div>").append($("<span>").html(localizedString("MISC_RESULT")+":&nbsp;&nbsp;&nbsp;&nbsp;")),s="Successful";if(t&&t.length>0)for(var o in t){if(t[o].Type=="Error"){s=localizedString("PREUPGERROR_LABEL_ERRORDECT");break}t[o].Type=="Warning"&&(s=localizedString("PREUPGERROR_LABEL_WARNINGDECT"))}i.append($("<strong>").text(s)).append("<br/><br/>");var u=$("<div>");a=u.gridview({delegate:l}),a.show(),e.append(r),e.append(i),e.append(u),this._container.append(e)},this.onViewAppear=function(){c(),h()};var c=function(){f=t,a.reload(),o&&e.btnFinish.attr({disabled:!0})}},c3activeConnections.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=arguments[1]||undefined,n=localizedString("ATVCONCTION_POPWIN_BODY_TLT"),r=[localizedString("ATVCONCTION_POPWIN_BODY_TLT")],i=[{name:"hostname",description:localizedString("HOSTUNIT"),type:"text",width:"25%"},{name:"companyname",description:localizedString("TENANT"),type:"text",width:"20%"},{name:"username",description:localizedString("ATVCONCTION_POPWIN_COLUMN_USERNAME"),type:"text",width:"30%"},{name:"applicationname",description:localizedString("ATVCONCTION_POPWIN_COLUMN_APPLICATION"),type:"text",width:"25%"}],s=null,o=[],u={getHeaderSpec:function(){return i},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 325}};this.onInit=function(){var e=$("<div>"),t=$("<div>").append(localizedString("TNT_UPGRADE_STEP1_ACTIVECONN_NOTE")).append("<br/><br/>"),n=$("<div>");s=n.gridview({delegate:u}),s.show(),e.append(t),e.append(n),this._container.append(e)},this.onViewAppear=function(){a()};var a=function(){var e=[];if(t&&t.length>0)for(var n=0;n<t.length;n++){var r=t[n].split(",");r.length==4&&e.push({hostname:r[0],companyname:r[1],username:r[2],applicationname:r[3]})}o=e,s.reload()}},c3activeCompanyDBConnections.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=arguments[1]||undefined,n=localizedString("ATVCONCTION_POPWIN_BODY_TLT"),r=[localizedString("ATVCONCTION_POPWIN_BODY_TLT")],i=[{name:"hostname",description:localizedString("HOSTUNIT"),type:"text",width:"25%"},{name:"companyname",description:localizedString("TENANT"),type:"text",width:"20%"},{name:"username",description:localizedString("ATVCONCTION_POPWIN_COLUMN_USERNAME"),type:"text",width:"30%"},{name:"applicationname",description:localizedString("ATVCONCTION_POPWIN_COLUMN_APPLICATION"),type:"text",width:"25%"}],s=null,o=[],u={getHeaderSpec:function(){return i},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 325}};this.onInit=function(){var e=$("<div>"),t=$("<div>").append(localizedString("TNT_CHANGE_STEP1_ACTIVECONN_NOTE")).append("<br/><br/>"),n=$("<div>");s=n.gridview({delegate:u}),s.show(),e.append(t),e.append(n),this._container.append(e)},this.onViewAppear=function(){a()};var a=function(){var e=[];if(t&&t.length>0)for(var n=0;n<t.length;n++){var r=t[n].split(",");r.length==4&&e.push({hostname:r[0],companyname:r[1],username:r[2],applicationname:r[3]})}o=e,s.reload()}},c3extensionInstall.step1=function(){function a(){var e=$("<section>"),t=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"25%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"20%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"15%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"15%"},{name:"Property",description:localizedString("DETAIL_PROPERTY"),type:"text",width:"15%"}],n={getHeaderSpec:function(){return t},getRowCount:function(){return r.addonData.length},getRow:function(e){return r.addonData[e]},getGridHeight:function(){return 290},getCell:function(){if(this.colName=="Property"){var e=this.data;if(e.Properties&&e.Properties.length>0){var t=[];for(var n=0,i=e.Properties.length;n<i;n++)e.Properties[n].Layer=="Deployment"&&t.push({ID:e.Properties[n].ID,Name:e.Properties[n].PropertyName,Value:e.Properties[n].PropertyValue,Config:e.Properties[n].Configurable,Description:e.Properties[n].Description,ValidValues:e.Properties[n].ValidValuesInfo});if(t.length>0){var s=$("<div>"),o=lkb=$("<a>").text(localizedString("MISC_EDIT")).attr({href:"#",title:localizedString("MISC_EDIT")});return e.editDeploymentPropertyAddons=[],e.Properties=t,r.addonData[this.row].NewProperties=e.editDeploymentPropertyAddons,o.click(function(){var t=new c3editExtensionDeployment(e);t.show()}),s.append(o),s}}}},removeCheckAll:function(){return!0}};r.gridDelegate=n;var i=$(e).gridview({delegate:n,checkType:1});return i.rowCheckEvent.push(function(){this.isChecked?f(this):h(this.index)}),i.show(),r.dataGrid=i,e}function f(t){var n=t.index,i=t,s=r.addonData[n],a=e.AddonEntity.ID,f=s.ValidateValue,c=[],v=!1;if(s.Vendor!="SAP")for(var m=0;m<f.length;m++){var g=f[m].FromVersion,y=f[m].ToVersion;c.push({From:g,To:y}),d(e.AddonEntity.SuVersion,g,y)&&(v=!0)}if(!v&&c.length>0){var b=$("<section>").css({"margin-top":"5px"}),w=[{name:"From",description:localizedString("MISC_FROM"),type:"text",width:"50%"},{name:"To",description:localizedString("MISC_TO"),type:"text",width:"50%"}],E={getHeaderSpec:function(){return w},getRowCount:function(){return c.length},getRow:function(e){return c[e]},getGridHeight:function(){return 130}},S=$(b).gridview({delegate:E,checkType:0});S.show();var x=o?localizedString("EXTENSION_STEP_COFIRM_INCOMPATIBLE_MSG_NOCONTINUE"):localizedString("EXTENSION_STEP_COFIRM_INCOMPATIBLE_MSG"),T=$("<div>").attr("class","warningSamllDiv").append($("<div>").attr({"margin-left":"50"}).append(x)),N=$("<hr>"),C=$("<div>").append(T).append(N).append(b),k=confirm(C,420,300,{title:localizedString("MISC_WARNING"),oktext:localizedString("MISC_CONTINUE"),hideFinish:o,canceltext:u});k.okEvent.push(function(){l(t)}),k.cancelEvent.push(function(){i.target.checked=!1,h(n)}),k.closeEvent.push(function(){i.target.checked=!1,h(n)})}else l(t);a.push(s),p()}function l(t){var n=t.index,i=t,s=r.addonData[n],o=e.config,u=!1,a=!1,f=!1,l=!1,p=null;for(var d=0,v=o.length;d<v;d++){var m=o[d];if(m.Name==s.Name&&m.Vendor==s.Vendor&&s.IsMulti!=sldEntity.ExtensionType.LightweightMV){u=!0,a=m.Status=="Installing",f=m.Status=="Upgrading",l=m.Status=="ToUninstall"||m.Status=="Uninstalling"||m.Status=="UninstallationFailed"||m.Status=="InstallationFailed"||m.Status=="UpgradeFailed",p=m.Status;break}}if(u){var g,y=null,b=null;if(s.IsMulti==sldEntity.ExtensionType.Addon)g=$("<div>").attr("class","warningDiv").append(localizedString("EXTENSION_STEP_COFIRM_NOTALLOWED_UPGRADE_MSG")),y=confirm(g,350,180,{title:localizedString("MISC_WARNING"),hideFinish:!0,canceltext:localizedString("MISC_CLOSE")});else{var w,E=function(e,t,n,r){g=$("<div>").attr("class","warningDiv").append(e);var i=confirm(g,350,180,{title:localizedString("MISC_WARNING"),oktext:t,canceltext:localizedString("MISC_NO"),hideNo:!n});return i.okEvent.push(r),i};b=function(){i.target.checked=!1,h(n)};var S,x;a||f||l?(w=String.format(localizedString("EXTENSION_UPGRADE_NOT_POSSIBLE"),localizedString("ExtensionStatus_"+p)),S=localizedString("MISC_OK"),x=!1):(w=localizedString("EXTENSION_STEP_COFIRM_UPDATE_MSG"),S=localizedString("MISC_YES"),x=!0,b=function(){c(t)}),g=$("<div>").attr("class","warningDiv").append(w),y=E(w,S,x,b)}y.cancelEvent.push(function(){i.target.checked=!1,h(n)}),y.closeEvent.push(function(){i.target.checked=!1,h(n)})}else c(t)}function c(t){var n=t.index,i=t,s=r.addonData[n],o=e.AddonEntity.ID,u=!1;for(var a=0,f=o.length;a<f;a++){var l=o[a];if(s.ID!=l.ID&&s.Name==l.Name&&s.Vendor==l.Vendor&&l.IsMulti!=sldEntity.ExtensionType.LightweightMV){u=!0;break}}if(u){var c=$("<div>").attr("class","warningDiv").append(localizedString("EXTENSION_STEP_COFIRM_MULTIVERSION_MSG")),p=confirm(c,350,180,{title:localizedString("MISC_WARNING"),hideFinish:!0,canceltext:localizedString("MISC_CLOSE")}),d=function(){i.target.checked=!1,h(n)};p.cancelEvent.push(d),p.closeEvent.push(d)}}function h(t){for(var n=0;n<e.AddonEntity.ID.length;n++)e.AddonEntity.ID[n].ID==r.addonData[t].ID&&e.AddonEntity.ID.remove(n);p()}function p(){e.AddonEntity.ID.length>0?e.enableNext():e.disableNext()}function d(e,t,n){var r=e.replace(/\./g,""),i=t.replace(/\./g,""),s=n.replace(/\./g,""),o=parseInt(r),u=parseInt(i),a=parseInt(s);return o<=a&&o>=u}function v(){var t=[],n=r.addonData,i=e.AddonEntity.ID;for(var s=0;s<n.length;s++)if(n[s].Group=="C")for(var o=0;o<i.length;o++)n[s].ID==i[o].ID&&t.push(n[s]);return t}function m(){if(e.step>0){var t=e.getStep(e.step-1).validator;if(t){t.validEvent?t.checkValidity():t.checkValidity()&&e.next();return}}e.next()}function g(t){if(e.step!=1){m();return}var n=v();if(n.length>0){var r=$("<section>").css({"margin-top":"5px"}),i=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"30%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"25%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"20%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"25%"}],s={getHeaderSpec:function(){return i},getRowCount:function(){return n.length},getRow:function(e){return n[e]},getGridHeight:function(){return 130}},o=$(r).gridview({delegate:s,checkType:0});o.show();var u=$("<div>").attr("class","warningSamllDiv").append($("<div>").attr({"margin-left":"50"}).append(localizedString("EXTENSION_STEP_COFIRM_MANDATORY_MSG"))),a=$("<hr>"),f=$("<div>").append(u).append(a).append(r),l=confirm(f,420,300,{title:localizedString("MISC_WARNING"),oktext:localizedString("MISC_CONTINUE"),canceltext:localizedString("MISC_CANCEL")});l.okEvent.push(function(){m()}),l.cancelEvent.push(function(){})}else m()}function y(){c3.service.getExtensionToBeInstalled(e.AddonEntity.SuID).expand("ExtensionProperties,ExtensionValidities").filter("ExtensionProperties/Layer eq 'Deployment'").query(function(t){var n=t.data,i=[],s=e.config;for(var o=0,u=n.length;o<u;o++){var a=!1;for(var f=0,l=s.length;f<l;f++)if(s[f].ExtensionID==n[o].ID){a=!0;break}if(a)continue;var c={};c.ID=n[o].ID,c.Properties=n[o].ExtensionProperties.results,c.ValidateValue=n[o].ExtensionValidities.results,c.Name=n[o].Name,c.Vendor=n[o].Vendor,c.Type=convertToDisplayExtensionType(n[o].Type),c.IsMulti=n[o].Type,c.Version=n[o].Version,c.Group=n[o].Group,i.push(c)}i.length==0&&(r.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("EXTENSION_LOWER"),null,!0)}),r.addonData=i,r.dataGrid.reload()})}this.base=c3.module,this.base(),this._container=$("<div>");var e=arguments[0]||{},t=arguments[1]||{},n=[],r=this,i=[],s=!1,o=s,u=o?localizedString("MISC_CLOSE"):localizedString("MISC_CANCEL");this.onInit=function(){e.disableNext(),e.btnNext.unbind("click"),e.btnNext.bind("click",g);var t=$("<div>").addClass("gridviewContainer");t.append(a),r.addonData=[],e.AddonEntity.ID=[],e.AddonEntity.Name=[];var n={};n.success=function(e){e&&e.d.IsExtensionCompatibilityCheckOn&&(s=!0,o=s,u=o?localizedString("MISC_CLOSE"):localizedString("MISC_CANCEL"))},c3.service.getExtensionCompatibilityCheckSwitch(n),this._container.append(t),y()},this.onViewAppear=function(){p()}},c3extensionInstall.step2=function(){function i(){n++,n>=t.AddonEntity.ID.length&&t.enableNext()}this.base=c3.module,this.base(),this._container=$("<div>").attr({id:"step2"});var e=this._container,t=arguments[0]||{},n=0;this.onInit=function(){t.disableBack(),t.disableCancel(),t.disableNext();var n=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"22%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"20%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"18%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"15%"},{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"25%"}],i=t.AddonEntity.ID,s={getHeaderSpec:function(){return n},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 290},getCell:function(){if(this.colName=="Status"){var e=this.data,n=this,i=$("<div>"),s={CommonDatabaseID:t.AddonEntity.CommonDatabase,ExtensionID:e.ID};if(e.NewProperties&&e.NewProperties.length>0){var o=[];for(var u=0,a=e.NewProperties.length;u<a;u++)o.push({Name:e.NewProperties[u].Name,Value:e.NewProperties[u].Value});s.DeploymentProperties=o}return c3.service.createExtensionDeployments(s,function(e,s){if(s=="success"){var o=-1;o=e.d.CreateExtensionDeploymentAsync,o!=-1&&function(e){var t=e.c3progress(function(e){return function(){return r(t,e,n)}}(o),{max:100,dur:c3config.Clocker-2,async:1,width:90,hwf:!0,showError:!1});return t}(i).start()}if(s=="error"){var u=$("<div>").append($("<img>").attr({src:c3Icon.Failed,title:retriveErrorMessage(e.responseText)}));i.append(u),t.readyForNext()}}),i}},removeCheckAll:function(){return!0}},o=$("<div>").addClass("areaDiv"),u=$(o).gridview({delegate:s});u.show(),e.append(o)};var r=function(e,t,n){c3.service.getTaskProgress(t).query(function(r){var s=r.data.GetTaskProperties.split(","),o=s[0].toUpperCase();"FAILED"==o||"CANCELLED"==o||"ROLLBACK"==o?c3.service.getTasks(t).query(function(t){e.setFailed(t.data.ResultDescription),i()}):"SUCCESSFUL"==o?(e.setValue(100,localizedString("MISC_DONE")),i(),n.data.errorLabel!=null&&n.data.errorLabel.text(0)):(s[0]!="Pending"&&s[0]!="Done"?s[0]=localizedString("MISC_TASK_PROCESSING"):s[0]=="Pending"&&(s[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),"100"==s[1]?e.setValue(99,localizedString("MISC_TASK_PROCESSING")):e.setValue(parseInt(s[1]),s[0]))})}},c3enableAddOn.step1=function(){function c(){var t=$("<section>"),n=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"30%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"30%"},{name:"Provider",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"30%"}],r={getHeaderSpec:function(){return n},getRowCount:function(){return e.addOnData.length},getRow:function(t){return e.addOnData[t]},getGridHeight:function(){return Utility.MasterTableHeight},getCell:function(){}};e.gridDelegate=r;var i=$(t).gridview({delegate:r,checkType:1});return i.rowCheckEvent.push(function(){this.isChecked?h(this.index):p(this.index)}),i.show(),e.dataGrid=i,t}function h(t){l.push(e.addOnData[t])}function p(t){l.splice($.inArray(e.addOnData[t],l))}function d(){var e=suManager.getExtensionsByCommonDB(a.par.ServiceUnit_CommonDatabase_ID,v)}function v(t){var n={},r=[],i=!1;for(var s=0;s<t.data.length;s++){for(var o=0;o<f.length;o++){if(f[o].ExtensionID==t.data[s].ExtensionID){i=!0;break}i=!1}i||r.push({ID:t.data[s].ID,ExtensionID:t.data[s].ExtensionID,Name:t.data[s].Name,Version:t.data[s].Version,Provider:t.data[s].Provider,Status:t.data[s].Status,Type:t.data[s].Type,__metadata:t.data[s].__metadata})}var n=r;e.addOnData=n}this.base=c3.module,this.base(),this.id="enableAddOnWizard",this._container=$("<div>").addClass("wizard_lite").attr({id:this.id});var e=this,t=$("<input type='radio' id='rbAddOn' name='ext_switch' checked='checked'>"),n=$("<input type='radio' id='rbB1Script' name='ext_switch'>"),r=$("<label for='rbB1Script'>").text(localizedString("B1SCRIPT")+"(2)"),i=$("<section>").attr({id:"addOnPanel"}),s=$("<section>").attr({id:"b1ScriptPanel"}),o=[i,s],u=$("<label>").text(localizedString("WIZARD_ENABLE_ADDON_WARNING_MSG")),a=arguments[0]||{},f=a.config,l=[];e.addOnData=d(),e.addonTeanant=[],this.onInit=function(){this._container.append($("<label>").text(localizedString("WIZARD_ENABLE_ADDON_OTHER_EXT_IN_SU")));var e=$("<div>").css({"margin-bottom":"10px","margin-top":"10px"}).append($("<label>").text(localizedString("WIZARD_ENABLE_ADDON_GUIDE_SENTENCE")));i.append(e),i.append(c()),this._container.append(i),this._container.append(s),this._container.append(u)},this.onViewAppear=function(){e.dataGrid.reload()},this.enableAddon=function(){var e={};e.ExtensionDeployment={},e.ExtensionDeployment.__metadata={},e.CompanyDatabase={},e.CompanyDatabase.__metadata={},e.CompanyDatabase.__metadata.uri=a.parent.companyDatabase;var t={};t.success=function(e){a.parent.reloadExtensions()},t.error=function(e){};for(var n=0;n<l.length;n++)e.ExtensionDeployment.__metadata.uri=l[n].__metadata,c3.service.createExtensionAssignments(e,t)}},c3userPreference.step1=function(){function o(){var e=tenantManager.getUserPreferenceByAssignment(n.config.ID,u)}function u(e){i=e.data,r.gridViewu.reload()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=[{name:"UserName",description:localizedString("USER_PREFERENCE_COL_UNAME"),type:"text",width:"50%"},{name:"StartupMode",description:localizedString("USER_PREFERENCE_COL_STARTUPMODE"),type:"text",width:"50%"}],t=null,n=arguments[0]||{};this.tenant=n.delegate.tenant;var r=this,i=[],s={getHeaderSpec:function(){return e},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 270},getDefaultSelectedIndex:function(){return 0}};this.onInit=function(){var e="Name: "+n.delegate.selectedExtension.Name+"&nbsp;&nbsp;&nbsp; &nbsp; Version: "+n.delegate.selectedExtension.Version,i=$("<hr>").addClass("hrSplit"),o=$("<div>").append(localizedString("USER_PREFERENCE_DESCRIPTION")).append(i);r._container.append(o);var u=null,a=$("<div>").css({"margin-top":"10px"});t=a.gridview({delegate:s}),t.rowSelectedEvent.push(function(){selectedRowData=this.data}),r.gridViewu=t,r._container.append(a),t.show()},this.onViewAppear=function(){s.getCell=function(){if(this.colName=="StartupMode"){var e=$("<div>").addClass("statusControl"),t=this,n={};n.ID=t.data.ID;var r=["Default","Automatic","Manual","Disabled"],i=$("<select>").bind("change",function(){selectedValue=i.find("option:selected").val();var e={};e.ID=t.data.ID,e.StartupMode=selectedValue;var n={};n.success=function(e){o()},n.error=function(e){o(),console.log(e)},c3.service.updateUserPreference(e,n)});for(var s=0;s<r.length;s++){var u=localizedString(Utility.startupModeTextKey(r[s]));optionType=$("<option>").attr({value:r[s],title:u}).append(u),this.data.StartupMode==r[s]&&optionType.attr({selected:!0}),i.append(optionType)}var a=$("<span>").append(localizedString(Utility.startupModeTextKey(this.data.StartupMode))),f=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel"),l=$("<div>").css({"float":"left","padding-top":"3px"}).append(f);f.click(function(){h.hide(),a.show(),l.hide(),c.show()});var c=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){l.show(),h.show(),a.hide(),c.hide()}),h=$("<div>").css({"float":"left"}).attr({title:localizedString(Utility.startupModeTextKey(this.data.StartupMode))}).append(i);return h.hide(),l.hide(),e.append(a).append(h).append(c).append(l),e}},o()},this.onFinish=function(){}},c3setExtensionPath.step1=function(){function r(e){var t=$("<select>"),n=e==undefined?24:e;for(var r=0;r<n;r++){var i=r.padLeft(2),s=$("<option>").attr("value",i).append(i);t.append(s)}return t}function i(){var e=$("<select>");for(var t=0;t<6;t++){var n=t.padRight(2),r=$("<option>").attr("value",n).append(n);e.append(r)}return e}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=this,t=arguments[0]||{},n={checkValidity:function(){t.ExtensionPathEntity.URI=$.trim(e.txtPath.val()),t.ExtensionPathEntity.schedualChecked=e.schedualChecked.is(":checked")?!0:!1,t.ExtensionPathEntity.compatibilityCheck=e.enableCompCheck.is(":checked")?!0:!1;var n=e.dateBox.val(),r=n.split("/"),i=r[2],s=r[0],o=r[1],u=new Date(i,s-1,o,e.timeHour.val(),e.timeMinute.val(),e.timeSecond.val()),a=u.getTime();return t.ExtensionPathEntity.StartTime="\\/Date("+a.toString()+")\\/",e.timeHour.val(parseInt(e.timeHour.val(),10).padLeft(2)),e.timeMinute.val(parseInt(e.timeMinute.val(),10).padLeft(2)),e.timeSecond.val(parseInt(e.timeSecond.val(),10).padLeft(2)),t.ExtensionPathEntity.IntervalTime=e.intervalTime.val(),e.modifyPath?e.txtPath.checkValidity()&&e.dateBox.checkValidity()&&e.intervalTime.checkValidity():e.dateBox.checkValidity()&&e.intervalTime.checkValidity()}};this.validator=n,this.onInit=function(){function X(){e.dateBox.attr({disabled:0}),e.timeHour.attr({disabled:0}),e.timeMinute.attr({disabled:0}),e.timeSecond.attr({disabled:0}),e.intervalTime.attr({disabled:0})}function V(){e.dateBox.attr({disabled:1}),e.timeHour.attr({disabled:1}),e.timeMinute.attr({disabled:1}),e.timeSecond.attr({disabled:1}),e.intervalTime.attr({disabled:1})}var n=$("<div>").addClass("pathContainer"),r=$("<input>").addClass("cunrrentPath").attr({readonly:!0,type:"text"});r.attr({value:t.ExtensionPathEntity.URI});var i=localizedString("WIZARD_ADDON_CURRENT_PATH"),s=new textbox({isRequired:!0,pattern:'^(\\\\\\\\[^/\\\\:*?"<>|]+([\\\\][^/\\\\:*?"<>|]+)*[\\\\]*[.]*)?'}),o=$("<div>").addClass("divTxtCon");s.placeAt(o),o.removeClass("divTxtCon"),e.txtPath=s,e.txtPath.attr({value:t.ExtensionPathEntity.URI});var u=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){r.hide(),o.addClass("divTxtCon"),e.txtPath.attr({value:t.prePath}),a.show(),u.hide(),e.modifyPath=!0}),a=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel").click(function(){r.show(),o.removeClass("divTxtCon"),u.show(),a.hide(),e.modifyPath=!1}),f=$("<div>").addClass("divIconEdit").append(u),l=$("<div>").addClass("divIconCancel").append(a),c=$("<div>").addClass("divVal").append(i),h=$("<div>").addClass("divTxt").append(r).append(o);e.divTxtCon=o,e.editEnable=u,e.editCancel=a,e.labelCurrentPath=r,n.append(c).append(h).append(f).append(l),t.ExtensionPathEntity.URI==""||t.ExtensionPathEntity.URI==undefined?(o.addClass("divTxtCon"),e.editEnable.hide(),r.hide(),a.show(),e.modifyPath=!0):(o.removeClass("divTxtCon"),r.show(),u.show()),a.hide(),this._container.append(n);var p=$("<legend>"),d=$("<fieldset>").append(p),v={},m=$("<input>").attr({type:"checkbox",id:"enableSchedule",checked:!0});m.click(function(e){this.checked?X():V()}),e.schedualChecked=m;var g=$("<section>"),y=$("<label>").attr({"for":"enableSchedule"}).append(localizedString("WIZARD_ADDON_ENABLE_SCHEDULE"));p.append(m),p.append(y),e.schedual={};var b=$("<div>"),w=$("<div>").css({"float":"left"}),E=new textbox({isRequired:!0});E.css({height:"20px"}),e.dateBox=E,w.append(E.bind("keydown",function(e){e.preventDefault()}).datepicker({onSelect:function(t,n){e.schedual.PStart=$.datepicker.formatDate("yymmdd",new Date(t))}})),E.bind("contextmenu",function(){return!0}).bind("selectstart",function(){return!0}).bind("paste",function(){return!1}).css({imeMode:"disabled","-moz-user-select":"none"}),e.startTimeControl=b;var S=$("<div>").addClass("timeBoxContainer"),x=$("<div>").css({"float":"left"}),T=$("<input>").attr({type:"text",maxlength:2}).addClass("timeHour").keydown(function(e){return e.which>47&&e.which<58&&!e.shiftKey||e.which==46||e.which==8||e.which>36&&e.which<41||e.which>95&&e.which<106?!0:!1}).keyup(function(e){this.value>23&&(this.value=23),this.value=this.value.replace(/[^\d]/g,"")}).focus(function(){k.attr({checked:"checked"})}).blur(function(){this.value==""&&(this.value="00"),this.value=parseInt(this.value,10).padLeft(2)}),N=$("<input>").attr({type:"text",maxlength:2}).addClass("timeMinute").keydown(function(e){return e.which>47&&e.which<58&&!e.shiftKey||e.which==46||e.which==8||e.which>36&&e.which<41||e.which>95&&e.which<106?!0:!1}).keyup(function(e){this.value>59&&(this.value=59),this.value=this.value.replace(/[^\d]/g,"")}).focus(function(){L.attr({checked:"checked"})}).blur(function(){this.value==""&&(this.value="00"),this.value=parseInt(this.value,10).padLeft(2)}),C=$("<input>").attr({type:"text",maxlength:2}).addClass("timeMinute").keydown(function(e){return e.which>47&&e.which<58&&!e.shiftKey||e.which==46||e.which==8||e.which>36&&e.which<41||e.which>95&&e.which<106?!0:!1}).keyup(function(e){this.value>59&&(this.value=59),this.value=this.value.replace(/[^\d]/g,"")}).focus(function(){A.attr({checked:"checked"})}).blur(function(){this.value==""&&(this.value="00"),this.value=parseInt(this.value,10).padLeft(2)}),k=$("<input type='radio' id='h' value='h' name='ext_switch' checked='checked'>").css({display:"none"}),L=$("<input type='radio' id='m' value='m' name='ext_switch'>").css({display:"none"}),A=$("<input type='radio' id='m' value='s' name='ext_switch'>").css({display:"none"}),O=$("<label>").text(":"),M=$("<label>").text(":");T.bind("contextmenu",function(){return!0}).bind("selectstart",function(){return!0}).bind("paste",function(){return!1}).css({imeMode:"disabled"}),N.bind("contextmenu",function(){return!0}).bind("selectstart",function(){return!0}).bind("paste",function(){return!1}).css({imeMode:"disabled"}),C.bind("contextmenu",function(){return!0}).bind("selectstart",function(){return!0}).bind("paste",function(){return!1}).css({imeMode:"disabled"}),e.timeHour=T,e.timeMinute=N,e.timeSecond=C,x.append(T).append(O).append(N).append(M).append(C),S.append(k).append(L).append(A);var _=$("<div>").addClass("timeUdContainer"),D=$("<label>").addClass("iconUpTime"),P=$("<label>").addClass("iconDownTime");e.timeUp=D,e.timeDown=P,D.mouseover(function(){e.schedualChecked.attr("checked")==1&&(D.removeClass("iconUpTime"),D.addClass("iconUpTimehover"))}).mouseout(function(){e.schedualChecked.attr("checked")==1&&(D.removeClass("iconUpTimehover"),D.addClass("iconUpTime"))}),P.mouseover(function(){e.schedualChecked.attr("checked")==1&&(P.removeClass("iconDownTime"),P.addClass("iconDownTimehover"))}).mouseout(function(){e.schedualChecked.attr("checked")==1&&(P.removeClass("iconDownTimehover"),P.addClass("iconDownTime"))}),D.click(function(){if(e.schedualChecked.attr("checked")==1){var t=$('input:radio[name="ext_switch"]:checked').val();if(t=="h"){var n=e.timeHour.val()==""?0:e.timeHour.val(),r=parseInt(n,10);r<23&&r++,e.timeHour.val(r.padLeft(2))}if(t=="m"){var n=e.timeMinute.val()==""?0:e.timeMinute.val(),r=parseInt(n,10);r<59&&r++,e.timeMinute.val(r.padLeft(2))}if(t=="s"){var n=e.timeSecond.val()==""?0:e.timeSecond.val(),r=parseInt(n,10);r<59&&r++,e.timeSecond.val(r.padLeft(2))}}}),P.click(function(){if(e.schedualChecked.attr("checked")==1){var t=$('input:radio[name="ext_switch"]:checked').val();if(t=="h"){var n=e.timeHour.val()==""?0:e.timeHour.val(),r=parseInt(n,10);r!=0&&r--,e.timeHour.val(r.padLeft(2))}if(t=="m"){var n=e.timeMinute.val()==""?0:e.timeMinute.val(),r=parseInt(n,10);r!=0&&r--,e.timeMinute.val(r.padLeft(2))}if(t=="s"){var n=e.timeSecond.val()==""?0:e.timeSecond.val(),r=parseInt(n,10);r!=0&&r--,e.timeSecond.val(r.padLeft(2))}}}),_.append(D).append(P),S.append(x),S.append(_),b.append(w).append(S),row=Utility.CreateRow(localizedString("WIZARD_ADDON_STARTTIME"),b),g.append(row);var H=new textbox({isRequired:!0,maxlength:4});H.css({height:"20px"}),H.bind("keydown",function(e){return e.which>47&&e.which<58&&!e.shiftKey||e.which==46||e.which==8||e.which>36&&e.which<41||e.which>95&&e.which<106?!0:!1}).keyup(function(e){this.value==0&&this.value!=""&&(this.value=1),this.value=this.value.replace(/[^\d]/g,"")}),e.intervalTime=H,H.bind("contextmenu",function(){return!0}).bind("paste",function(){return!1}).css({imeMode:"disabled"});var B=$("<div>").append(localizedString("WIZARD_ADDON_TIME_INTERVAL")).addClass("rowName"),j=$("<div>").addClass("rowValue");H.placeAt(j),j.children(".txt_box_wrap").removeClass("txt_box_wrap"),row=$("<div>").addClass("row").append(B).append(j),g.append(row);var F=$("<div>").addClass("scheduleSuccess").append($("<label>").css({"padding-top":"3px","padding-left":"20px"}).addClass("ShowIcon Success")).append("Done"),I=$("<label>").append(""),q=$("<div>").addClass("scheduleSuccess").append($("<label>").css({"padding-top":"3px","padding-left":"20px"}).addClass("ShowIcon Failed"));e.failedMessage=I,e.Success=F,e.Failed=q,e.Failed.append(e.failedMessage),d.append(g),e.settingContainer=g,this._container.append(d);var R=$("<div>").addClass("compatibilityCheckContainer"),U=$("<input>").attr({type:"checkbox",id:"enableCompCheck",checked:!1}),z=$("<label>").append(localizedString("WIZARD_ADDON_ENABLE_COMPATIBILITY_CHECK"));U.click(function(e){if(this.checked){var t=MessageBox.show({msg:localizedString("EXTENSION_STEP_COFIRM_COMPATIBILITYCHECK_ON_MSG"),width:340,height:190,icon:MessageBoxIcon.WARNING,buttons:MessageBoxButton.YESNO});t.noEvent.push(function(){this.checked=!1,U.attr({checked:!1})})}else{var t=MessageBox.show({msg:localizedString("EXTENSION_STEP_COFIRM_COMPATIBILITYCHECK_OFF_MSG"),width:340,height:220,icon:MessageBoxIcon.WARNING,buttons:MessageBoxButton.YESNO});t.noEvent.push(function(){this.checked=!0,U.attr({checked:!0})})}}),R.append(U).append(z),e.enableCompCheck=U,this._container.append(R);var W=$("<div>");W.append(F).append(q),this._container.append(W),c3.service.getExtensionSyncSchedual(v,function(t){var n=t.d.ExtensionSynchronizationSetting,r={},i=null;r.EnableSchedule=n.EnableSchedule,n.EnableCompatibilityCheck&&U.attr({checked:!0});var s=n.StartTime;if(s==null||s==""||s==undefined)i=new Date(Date.now()),r.year=i.getFullYear(),r.month=i.getMonth()+1,r.day=i.getDate().padLeft(2),r.date=r.month.padLeft(2)+"/"+r.day+"/"+r.year,r.hour=i.getHours().padLeft(2),r.min=i.getMinutes().padLeft(2),r.sec=i.getSeconds().padLeft(2);else{var o=new Date(parseInt(s.substring(6)));r.year=o.getFullYear(),r.month=o.getMonth()+1,r.day=o.getDate().padLeft(2),r.date=r.month.padLeft(2)+"/"+r.day+"/"+r.year,r.hour=o.getHours().padLeft(2),r.min=o.getMinutes().padLeft(2),r.sec=o.getSeconds().padLeft(2)}var u=parseInt(n.Interval);r.IntervalHour=u==0?1:u,m.attr({checked:r.EnableSchedule}),r.EnableSchedule?X():V(),e.dateBox.val(r.date),e.timeHour.val(r.hour),e.timeMinute.val(r.min),e.timeSecond.val(r.sec),e.intervalTime.val(r.IntervalHour)})},this.onViewAppear=function(){}},c3assignExtension.step1=function(){function l(){var t=$("<section>"),n=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"25%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"20%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"15%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"15%"},{name:"Property",description:localizedString("DETAIL_PROPERTY"),type:"text",width:"15%"}],r={getHeaderSpec:function(){return n},getRowCount:function(){return e.addOnData.length},getRow:function(t){return e.addOnData[t]},getGridHeight:function(){return 280},getCell:function(){if(this.colName=="Property"){var e=this.data;if(e.Type!=localizedString("EXTENSION_TYPE_ADDON")){var t=$("<div>"),n=lkb=$("<a>").text(localizedString("LINK_DETAILS")).attr({href:"#",title:localizedString("LINK_DETAILS")});if(!e.newProperties){var r=[];for(var i=0,s=e.ExtensionProperties.results.length;i<s;i++){var o=e.ExtensionProperties.results;o[i].Layer=="Assignment"&&r.push({ID:o[i].ID,Name:o[i].PropertyName,Value:o[i].PropertyValue,Config:o[i].Configurable,Description:o[i].Description,ValidValues:o[i].ValidValuesInfo})}e.newProperties=r}return n.click(function(){var t=new c3editExtensionAssProperty(e,"Assign");t.show()}),t.append(n),t}return $("<div>")}},removeCheckAll:function(){return!0}};e.gridDelegate=r;var i=$(t).gridview({delegate:r,checkType:1});return i.rowCheckEvent.push(function(){this.isChecked?c(this):h(this)}),i.show(),e.dataGrid=i,t}function c(t){var n=t.index,r=e.addOnData[n];for(var i=0;i<f.length;i++)if(f[i].Name==r.Name&&f[i].Vendor==r.Vendor){t.target.checked=!1;var s=$("<div>").attr("class","warningDiv").append(localizedString("RES_MISC_MULTI_VERSION_SELECTED_WARNING"));confirm(s,350,180,{title:localizedString("MISC_WARNING"),hideFinish:!0,canceltext:localizedString("MISC_CLOSE")});return}f.push(e.addOnData[n]),p()}function h(t){var n=t.index;for(var r=0;r<f.length;r++)f[r].ID==e.addOnData[n].ID&&f.remove(r);p()}function p(){f.length>0?u.enableNext():u.disableNext()}function d(){c3.service.GetAssignableExtensions(u.parent.tenant.ID).expand("Extension,Extension/ExtensionProperties").filter("Extension/ExtensionProperties/Layer eq 'Assignment'").query(function(e){v(e)})}function v(t){var n={},r=[],i=!1,s;for(var o=0;o<t.data.length;o++)s=t.data[o],r.push({ID:s.ID,ExtensionID:s.Extension.ID,Name:s.Extension.Name,Version:s.Extension.Version,Vendor:s.Extension.Vendor,Status:s.Extension.Status,Type:convertToDisplayExtensionType(s.Extension.Type),ExtensionProperties:s.Extension.ExtensionProperties,__metadata:s.__metadata.uri});var n=r;n.length==0&&(e.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("EXTENSION_LOWER"),null,!0)}),e.addOnData=n,e.dataGrid.reload()}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=$("<input type='radio' id='rbAddOn' name='ext_switch' checked='checked'>"),n=$("<input type='radio' id='rbB1Script' name='ext_switch'>"),r=$("<label for='rbB1Script'>").text(localizedString("B1SCRIPT")+"(2)"),i=$("<section>").attr({id:"addOnPanel"}),s=$("<section>").attr({id:"b1ScriptPanel"}),o=[i,s],u=arguments[0]||{},a=u.config,f=[];e.addOnData=[],u.addonTeanant=[],u.selectItems=f,this.onInit=function(){u.disableNext(),i.append(l());var e=$("<div>").append(i),t=$("<div>").css({"padding-top":"15px"}).append(e);this._container.append(t),p(),d()},this.onViewAppear=function(){p()}},c3assignExtension.step2=function(){function o(){var t=null;if(this.colName=="Status"){var n=$("<div>").css({height:"15px"}),r=$("<label>").addClass("ShowIcon").addClass("Success");r.css({"padding-left":"20px","padding-top":"3px",display:"none"}),n.css({"text-align":"left"});var s=$("<label>").addClass("ShowIcon").addClass("Failed");s.css({"padding-left":"20px","padding-top":"3px",display:"none"}),n.append(r),n.append(s);var o=[],u=this.data.newProperties,a=this.data.ExtensionProperties;if(this.data.newProperties!=null&&u.length>0)for(var f=0,l=u.length;f<l;f++)o.push({Configurable:u[f].Config,Description:u[f].Description,ValidValues:u[f].ValidValues,Name:u[f].Name,Value:u[f].Value});else for(var f=0,l=a.length;f<l;f++)o.push({Configurable:a[f].Config,Description:a[f].Description,ValidValues:a[f].ValidValues,Name:a[f].Name,Value:a[f].Value});var c={ExtensionAssignmentParam:{}};c.ExtensionAssignmentParam.extensionDeploymentId=this.data.ID,c.ExtensionAssignmentParam.companyDBId=e.parent.companyDatabase.ID,c.ExtensionAssignmentParam.properties=o;var h=null,h=new i.assign(c),p={taskCount:1,getTask:function(e){if(e==0)return h},finishEvent:[function(){e.enableNext()}],successEvent:[function(){r.css({display:"inline"}),s.css({display:"none"})}],failedEvent:[function(){s.css({display:"inline"}),r.css({display:"none"})}],ShowStatusTxt:!1,successMessage:localizedString("MISC_DONE")},d=new multiTaskProcess(p);d.placeAt(n,100,13),d.start(),t=n}return t}this.base=c3.module,this.base(),this._container=$("<div>").attr({id:"step2"});var e=arguments[0]||{},t=e.config,n=0,r=this,i={assign:function(e){var t=this;this.base=c3.task,this.base("",100),this.execute=function(){callback=this.ajaxCallBackConfig,c3.service.createExtensionAssignment(e,callback)}}},s={};s.success=function(t){e.parent.reloadExtensions(),e.enableNext(),item.Status="Success"},s.error=function(t){item.Status="Failed",e.enableNext(),item.ErrorMessage=t.statusText},this.onInit=function(){e.disableBack(),e.disableNext(),e.disableCancel();var t=$("<section>").attr({id:"addOnPanel"}),n=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"22%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"20%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"18%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"15%"},{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"25%"}];r.addOnData=e.selectItems;var i={getHeaderSpec:function(){return n},getRowCount:function(){return r.addOnData.length},getRow:function(e){return r.addOnData[e]},getGridHeight:function(){return 280},getCell:o};r.gridDelegate=i;var s=$(t).gridview({delegate:i,checkType:0});s.show(),r.dataGrid=s;var u=$("<div>").append(t),a=$("<div>").css({"padding-top":"15px"}).append(u);this._container.append(a)},this.onViewAppear=function(){}},c3extensionSyncReportHistory.step1=function(){function f(e,t){var n=(t-1)*e;c3.service.getExtensionSyncLogs().orderby("StartTime desc").skip(n).top(e).query(l)}function l(e){var t=e.data,n=[];for(var s=0;s<t.length;s++)n.push({DateTime:t[s].StartTime==null?"":convertToFamatDateTime(t[s].StartTime),Duration:t[s].EndTime==null?"":convertToFamatDateTime(t[s].EndTime),Type:t[s].Type,Success:t[s].SuccessCount==undefined?"":t[s].SuccessCount,Failure:t[s].FailureCount==undefined?"":t[s].FailureCount,Report:t[s].Report,ID:t[s].ID});u=n,u.length==0&&(r.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("SYNCREPORT_EMPTY_TIP_PART"),null,!0)}),r.gridViewu.reload(),n.length==0&&(i=0,o=0),r.currentPageNum.html(""),r.currentPageNum.append(i+" of "+o),r.current.append(r.currentPageNum)}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=[{name:"DateTime",description:localizedString("COLUMN_STARTTIME"),type:"text",width:"25%"},{name:"Duration",description:localizedString("COLUMN_ENDTIME"),type:"text",width:"25%"},{name:"Type",description:localizedString("MISC_MODE"),type:"text",width:"18%"},{name:"Success",description:localizedString("MISC_SUCCESS"),type:"text",width:"12%"},{name:"Failure",description:localizedString("MISC_FAILURE"),type:"text",width:"10%"},{name:"Report",description:localizedString("MISC_REPORT"),type:"text",width:"10%"}],t=null,n=arguments[0]||{},r=this,i=1,s=8,o=0,u=[],a={getHeaderSpec:function(){return e},getRowCount:function(){return u.length},getRow:function(e){return u[e]},getGridHeight:function(){return 270},getDefaultSelectedIndex:function(){return 0}};r.gridDelegate=a,this.onInit=function(){var e=localizedString("EXTENSION_SYNC_HISTORY_SUBTITLE"),n=$("<hr>").addClass("hrSplit"),u=$("<div>").append(e).append(n);r._container.append(u);var l=null,c=$("<div>").css({"margin-top":"10px"});t=c.gridview({delegate:a}),t.rowSelectedEvent.push(function(){selectedRowData=this.data}),r.gridViewu=t,t.show(),a.getCell=function(){if(this.colName=="Report"){var e=this,t=$("<div>"),n=$("<a>").attr({href:"#",value:localizedString("MISC_DETAIL")}).text(localizedString("MISC_DETAIL"));return n.click(function(){var t=new c3extensionSyncReportList(r,e.data.ID);t.show()}),t.append(n),t}if(this.colName=="Type"){var e=this,i=$("<div>");return i.append(localizedString(e.data.Type.toUpperCase())).attr({title:localizedString(e.data.Type.toUpperCase())}),i}};var h=$("<div>").css({"margin-top":"10px","text-align":"center"}),p=$("<label>").append("Page: ").css({"margin-right":"10px"}),d=$("<label>").attr({id:"currentPageNum"}).css({width:"100px"}),v=$("<a>").append("<").attr({title:"previous page",href:"#"}).css({"margin-right":"10px"}),m=$("<a>").append(">").attr({title:"next page",href:"#"}).css({"margin-right":"10px"}),g=$("<a>").append("<<").attr({title:"first page",href:"#"}).css({"margin-right":"10px"}),y=$("<a>").append(">>").attr({title:"last page",href:"#"}).css({"margin-right":"10px"});r.current=p,r.currentPageNum=d,c3.service.getExtensionSyncLogs().count().query(function(e){var t=parseInt(e.data,10);o=Math.ceil(t/s),r.current.append(r.currentPageNum),g.click(function(){t==0?i=0:(i=1,f(s,i))}),v.click(function(){i>1&&(i--,f(s,i))}),m.click(function(){i<o&&(i++,f(s,i))}),y.click(function(){t==0?(i==0,o=0):(i=o,f(s,i))}),h.append(p).append(g),h.append(v),h.append(m),h.append(y),r._container.append(c),r._container.append(h)})},this.onViewAppear=function(){f(s,i)},this.onFinish=function(){}},c3extensionSyncReportList.step1=function(){function r(){e.isHistoryView?c3.service.getExtensionSyncDetails().expand("ExtensionSynchronizationLog").filter("ExtensionSynchronizationLog/ID eq "+e.logID).query(function(e){var t=e.data;i(t)}):c3.service.currentExtensionSynchronizationDetails(e.extensionSyncReportEntity,function(e){var t=e.d.results;t.length>0?c3.service.getExtensionSyncDetails(t[0].ID).expand("ExtensionSynchronizationLog/Type").query(function(e){t[0].ExtensionSynchronizationLog.Type=e.data.ExtensionSynchronizationLog.Type,i(t)}):i(t)})}function i(e){var t=[],r;e.length>0&&(r=e[0].ExtensionSynchronizationLog.Type===undefined?localizedString("MANUALLY"):localizedString(e[0].ExtensionSynchronizationLog.Type.toUpperCase()));for(var i=0;i<e.length;i++)t.push({ExtensionName:e[i].ExtensionName,Provider:e[i].ExtensionProvider,Type:convertToDisplayExtensionType(e[i].ExtensionType),Version:e[i].ExtensionVersion,SyncType:r,DateTime:convertToFamatDateTime(e[i].DateTime),Status:e[i].Status,ErrorMessage:e[i].ErrorMessage});n.gridDatau=t,n.gridViewu.reload()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=e.isHistoryView?!0:!1,n=this;n.gridDatau=[],this.onInit=function(){var e=localizedString("EXTENSION_SYNC"),r=$("<div>").addClass("loading").attr("title",localizedString("MISC_DATA_LOADING"));r.css({visibility:"hidden"}),n.loadingIcon=r;var i=$("<hr>").addClass("hrSplit"),s=$("<div>").append(e).css({"float":"left"});n._container.append(s),n._container.append(r),n._container.append(i);var o=[{name:"ExtensionName",description:localizedString("COLUMN_NAME"),type:"text",width:"18%"},{name:"Provider",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"15%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"12%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"14%"},{name:"SyncType",description:localizedString("MISC_MODE"),type:"text",width:"15%"},{name:"DateTime",description:localizedString("COLUMN_DATETIME"),type:"text",width:"25%"},{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"16%"}],u={getHeaderSpec:function(){return o},getRowCount:function(){return n.gridDatau.length},getRow:function(e){return n.gridDatau[e]},getGridHeight:function(){return 270},getDefaultSelectedIndex:function(){return 0},getTip:function(){if(n.gridDatau.length==0&&t)return Utility.CreateTipBoard(localizedString("SYNCREPORT_EMPTY_TIP_PART"),null,!0)},getCell:function(){if(this.colName=="Status"){var e=this.data,t=$("<div>"),n=$("<a>").attr({href:"#"}).append(e.Status);return e.Status=="Failed"?n.click(function(){var t=$(this).popupManager(200,120,!1,localizedString("MISC_ERRORINFO"),!0),n=$("<div>").css({margin:"17px 0 0 10px",height:"80",overflow:"auto"}).append(e.ErrorMessage);t.append(n),t.show()}):n.addClass("successStatus"),t.append(n),t}}};n.gridDelegate=u;var a=$("<div>").css({"margin-top":"10px"}),f=a.gridview({delegate:u});n.gridViewu=f,n._container.append(a),f.show()},this.onViewAppear=function(){if(e.isHistoryView)r();else{var i={},s=$("<div>").css({visibility:"hidden","margin-top":"-25px"}),o=-1;e.taskID&&(o=parseInt(e.taskID,10),n.loadingIcon.css({visibility:"visible"})),s.append(Utility.CreateExtProcessRow("progress",function(){var e=this;o>0?(n.progressBarHandle=i,c3.service.getTaskProgress(o).query(function(i){var s=i.data.GetTaskProperties.split(",");"Failed"==s[0]?c3.service.getTasks(o).expand("TaskParameters").query(function(t){e.setFailed(t.data.ResultDescription),Utility.logTaskError(t.data)}):"Successful"==s[0]?(e.setValue(100),t=!0,r(),n.loadingIcon.css({visibility:"hidden"}),c3ModuleManager.notifyMessage(new c3Message("SynchronizeExtension"))):(e.setValue(parseInt(s[1])),r())})):e.setValue(0)},i)),n._container.append(s),i.progressBar.start()}}},c3registerAppToken.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=[localizedString("MISC_NAME"),localizedString("SLDCLIENT_COLUMN_IDENTIFIER")," ",localizedString("MISC_DESCRIPTION")],n=[new textbox({isRequired:!0}),new textbox({isRequired:!0}),$("<input>").attr({type:"button",id:"btnGenerate",value:localizedString("REGISTSLDCLIENT_BTN_GENT")}).css({width:"60px"}),$("<textarea>")],r=new function(){var t=[],r=function(){function i(e){e.d&&!e.d.ValidateIdentifier?n[1].showErrorMessage(localizedString("REGISTSLDCLIENT_ERROR_INVALIDIDF")):o()}function s(e){n[1].showErrorMessage(localizedString("REGISTSLDCLIENT_ERROR_INVALIDIDF"))}function o(){e.AppTokenEntity.Name=n[0].val(),e.AppTokenEntity.Identifier=$.trim(n[1].val()),e.AppTokenEntity.Description=n[3].val(),t.length>0&&t[0]()}var r=n[0].checkValidity()&&n[1].checkValidity();r&&c3.service.validateIdentifier(n[1].val(),{success:i,error:s})};this.validEvent=t,this.checkValidity=r};this.validator=r,this.reset=function(){n[0].val(""),n[1].val(""),n[3].val("")},this.onInit=function(){for(var e=0;e<t.length;e++)this._container.append(Utility.CreateRow(t[e],n[e]));n[2].click(function(){var e=n[0].val();c3.service.generateIdentifier(e,function(e){n[1].val(e.d.GenerateIdentifier)})})},this.onViewAppear=function(){e.AppTokenEntity.Status="Active"}},c3changeDBName.step1=function(){function l(){}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=arguments[1]||undefined,n=this,r=localizedString("TNTUPGRADE_CKDBNAME_GRID_DBLIST_TLT"),i=[localizedString("TNTUPGRADE_CKDBNAME_GRID_DBLIST_TLT")],s=[{name:"CurDBName",description:localizedString("TNTUPGRADE_CKDBNAME_GRID_COLUMN_CURDBNAME"),type:"text",width:"40%"},{name:"NewDBName_Input",description:localizedString("TNTUPGRADE_CKDBNAME_GRID_COLUMN_NEWDBNAME"),type:"text",width:"60%"}],o=null,u=[],a={needExport:function(){return!1},getHeaderSpec:function(){return s},getRowCount:function(){return u.length},getRow:function(e){return u[e]},getGridHeight:function(){return 290},getCell:function(){if(this.colName=="NewDBName_Input"){var e=(new textbox({pattern:"[0-9a-zA-Z_]*"})).attr({maxlength:90}).css({width:"150px",height:"20px"});e.val(this.data.NewDBName);var n=this.data.TenantID;return e.bind("change",function(){var e=$.trim($(this).val());for(var r=0;r<t.length;r++)if(t[r].TenantID==n){t[r].NewDBName=e;break}}),e}return null}};this.onInit=function(){var e=$("<div>"),t=$("<div>").text(localizedString("TNTUPGRADE_CKDBNAME_TIP")).css({"padding-bottom":"10px","line-height":"18px"}),r=$("<div>");o=r.gridview({delegate:a}),o.show();var i=$("<div>").css({color:"red",padding:"8px 0 5px 5px"});n.errorDiv=i,e.append(t),e.append(r),e.append(i),this._container.append(e),f(),l()},this.onViewAppear=function(){};var f=function(){u=t,o.reload()}},c3changeLicenseFile.step1=function(){function o(){if(r.trigger==0)c3.service.retrieveAvailableLicenseFiles(i.ID,function(n){if(n.d&&n.d.results&&n.d.results.length>0){t=n.d.results;var r=0;for(var i=0;i<t.length;i++)(function(n){c3.service.checkLicenseFileIsShared(t[n].ID,"License",{success:function(i){r++,i.d&&i.d.results&&(i.d.results.length>0?i.d.results[0].IsShared===!0?t[n].IsShared=localizedString("Shared"):t[n].IsShared=localizedString("Exclusive"):t[n].IsShared=localizedString("Exclusive")),r===t.length&&e.reload()},error:function(n){r++,r===t.length&&e.reload()}})})(i)}});else if(r.trigger==1)if(r.parent&&r.parent.parent&&r.parent.parent.controller&&r.parent.parent.controller.selectedDataItem){var n=r.parent.parent.controller.selectedDataItem.ID,s={success:function(n){n.d&&n.d.results&&n.d.results.length>0&&(t=n.d.results,e.reload())},error:function(){t=[],e.reload()}};c3.service.getLicensesOfReseller(n,s)}else t=[],e.reload()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=null,t=[],n={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"InstallationNumber",description:localizedString("COLUMN_INSTALL_NO"),type:"text",width:"25%"},{name:"SystemNumber",description:localizedString("COLUMN_SYS_NO"),type:"text",width:"25%"},{name:"Localization",description:localizedString("MISC_LOCATION"),type:"text",width:"20%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"15%"},{name:"IsShared",description:localizedString("IsShared"),type:"text",width:"15%"}]},getRowCount:function(){return t.length},getRow:function(e){return t[e]},getGridHeight:function(){return 340}},r=arguments[0]||{},i=arguments[1]||{},s=this;this.onInit=function(){var t=$("<div>").css("padding","5px 0 15px 0").text(localizedString("CGLIC_CUSTOMER_MSG")),i=$("<div>").css({"float":"left"});e=i.gridview({delegate:n}),e.rowSelectedEvent.push(function(){r.selectedLicenseFile=this.data}),s._container.append(t).append(i),e.show()},this.onViewAppear=function(){o()}},c3editExtensionDeployment.step1=function(){function h(e){var t=[];if(i.delegate.editDeploymentPropertyAddons.length>0){for(var n=0,s=i.delegate.editDeploymentPropertyAddons.length;n<s;n++)t.push({ID:i.delegate.editDeploymentPropertyAddons[n].ID,Name:i.delegate.editDeploymentPropertyAddons[n].Name,Value:i.delegate.editDeploymentPropertyAddons[n].Value,Config:i.delegate.editDeploymentPropertyAddons[n].Config,Description:i.delegate.editDeploymentPropertyAddons[n].Description,ValidValues:i.delegate.editDeploymentPropertyAddons[n].ValidValues});i.delegate.editDeploymentPropertyAddons=[]}else e!=null&&e.length>0&&(t=e);r.gridDataPro=t,r.gridViewPro.reload()}function p(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var r=0;r<n.length;r++){var i=$("<a>").attr({href:"#"}).append(n[r]);t.append($("<li>").attr({id:e+r.toString()}).append(i))}return t}function d(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");return t.append(m()),t}function v(){var t=e+"_plainContent",n=$("<section>").attr({id:t}),i=null;r.gridDatau=[];var s={getHeaderSpec:function(){return c},getRowCount:function(){return r.gridDatau.length},getRow:function(e){return r.gridDatau[e]},getGridHeight:function(){return 230},getDefaultSelectedIndex:function(){return 0}},o=$("<div>");return i=o.gridview({delegate:s}),i.rowSelectedEvent.push(function(){}),r.gridViewu=i,n.append(o),i.show(),n}function m(){var t=e,n=$("<section>").attr({id:t+"_property"}),i=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"20%"},{name:"Value",description:localizedString("MISC_VALUE"),type:"text",width:"40%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"40%"}],s=null;r.gridDataPro=[];var o={getHeaderSpec:function(){return i},getRowCount:function(){return r.gridDataPro.length},getRow:function(e){return r.gridDataPro[e]},getGridHeight:function(){return 230},getDefaultSelectedIndex:function(){return 0}},u=$("<div>");return s=u.gridview({delegate:o}),s.rowSelectedEvent.push(function(){}),r.gridViewPro=s,r.gridDelegatePro=o,n.append(u),s.show(),n}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e="propertychange",t=$("<section>").attr({id:e}).addClass("tab"),n=[localizedString("DETAIL_PLAIN"),localizedString("DETAIL_PROPERTY")],r=this,i=arguments[0]||{},s=i.delegate.Name,o=i.delegate.Version,u=i.delegate.Vendor,a=i.delegate.ID,f=[localizedString("COLUMN_NAME"),localizedString("COLUMN_VERSION"),localizedString("COLUMN_PROVIDER")],l=[$("<label>").text(s),$("<label>").text(o),$("<label>").text(u)],c=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"30%"},{name:"Value",description:localizedString("MISC_VALUE"),type:"text",width:"70%"}];this.onInit=function(){for(var e=0;e<f.length;e++)r._container.append(Utility.CreateRow(f[e],l[e]));t.append(d()).css({"margin-top":"20px"}),r._container.append(t),h(i.delegate.Properties)},this.onViewAppear=function(){r.gridDelegatePro.getCell=function(){if(this.colName=="Value"){var e=$("<div>").addClass("statusControl"),t=this,n={};n.ID=t.data.ID,n.Name=t.data.Name,n.Value=t.data.Value,n.Config=t.data.Config,n.Description=t.data.Description,n.ValidValues=t.data.ValidValues;var r=new textbox({maxlength:500});r.attr({value:t.data.Value,width:"20px"}),r.bind("blur",function(){if($.trim(r.val())==""){r.showErrorMessage(localizedString("EXTENSION_PROPERTY_VALUE_EMPTY_WARNING_MSG"));return}n.Value=r.val(),s.empty(),s.text(n.Value),c.hide(),s.show(),u.hide(),f.show()});var s=$("<div>").addClass("td_editproperty"),o=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel"),u=$("<div>").css({"float":"left","padding-top":"3px"});o.click(function(){c.hide(),s.show(),u.hide(),f.show()});var a=$("<select>"),f=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){r.attr({value:n.Value}),u.show(),c.show(),s.hide(),f.hide()}),l=$("<div>").css({"float":"left"}).append(f),c=$("<div>").css({"float":"left"}).attr({title:t.data.Value}),h={};t.data.ValidValues!=null&&t.data.ValidValues!=undefined&&$.trim(t.data.ValidValues)!=""&&(h=JSON.parse(t.data.ValidValues));if(!jQuery.isEmptyObject(h)){for(var p in h)optionType=$("<option>").attr({value:h[p],title:p}).append(p),n.Value==h[p]&&(s.text(p).attr({title:p}),optionType.attr({selected:!0}).attr({title:p}),a.attr({title:p})),a.append(optionType);a.bind("change",function(e){var t=a.find("option:selected").val();n.Value=t,s.empty();for(var r in h)n.Value==h[r]&&(s.text(r).attr({title:r}),a.attr({title:r}));c.hide(),s.show(),u.hide(),f.show()}),c.append(a),u.append(o)}else s.text(n.Value).attr({title:n.Value}),r.placeAt(c),u.append(o);return c.hide(),u.hide(),this.data.Config?e.append(s).append(c).append(l).append(u):e.append(s),i.delegate.editDeploymentPropertyAddons.push(n),e}}}},c3editExtensionAssignment.step1=function(){function c(e){var t=[];if(i.delegate.editAssignmentPropertyAddons.length>0){for(var n=0,s=i.delegate.editAssignmentPropertyAddons.length;n<s;n++)t.push({ID:i.delegate.editAssignmentPropertyAddons[n].ID,Name:i.delegate.editAssignmentPropertyAddons[n].Name,Value:i.delegate.editAssignmentPropertyAddons[n].Value,Config:i.delegate.editAssignmentPropertyAddons[n].Config,Description:i.delegate.editAssignmentPropertyAddons[n].Description,ValidValues:i.delegate.editAssignmentPropertyAddons[n].ValidValues});i.delegate.editAssignmentPropertyAddons=[]}else e!=null&&e.length>0&&(t=e);r.gridDataPro=t,r.gridViewPro.reload()}function h(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var r=0;r<n.length;r++){var i=$("<a>").attr({href:"#"}).append(n[r]);t.append($("<li>").attr({id:e+r.toString()}).append(i))}return t}function p(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");return t.append(v()),t}function d(){var t=e+"_plainContent",n=$("<section>").attr({id:t}),i=null,s=[],o={getHeaderSpec:function(){return l},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 230},getDefaultSelectedIndex:function(){return 0}},u=$("<div>");return i=u.gridview({delegate:o}),i.rowSelectedEvent.push(function(){}),r.gridViewu=i,n.append(u),i.show(),n}function v(){var t=e,n=$("<section>").attr({id:t+"_property"}),i=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"20%"},{name:"Value",description:localizedString("MISC_VALUE"),type:"text",width:"40%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"40%"}],s=null;r.gridDataPro=[];var o={getHeaderSpec:function(){return i},getRowCount:function(){return r.gridDataPro.length},getRow:function(e){return r.gridDataPro[e]},getGridHeight:function(){return 230},getDefaultSelectedIndex:function(){return 0}};r.gridDelegatePro=o;var u=$("<div>");return s=u.gridview({delegate:o}),s.rowSelectedEvent.push(function(){}),r.gridViewPro=s,n.append(u),s.show(),n}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e="propertychange",t=$("<section>").attr({id:e}).addClass("tab"),n=[localizedString("DETAIL_PROPERTY")],r=this,i=arguments[0]||{},s=i.delegate.Name,o=i.delegate.Version,u=i.delegate.Vendor,a=[localizedString("COLUMN_NAME"),localizedString("COLUMN_VERSION"),localizedString("COLUMN_PROVIDER")],f=[$("<label>").text(s),$("<label>").text(o),$("<label>").text(u)],l=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"30%"},{name:"Value",description:localizedString("MISC_VALUE"),type:"text",width:"70%"}];this.onInit=function(){for(var e=0;e<a.length;e++)r._container.append(Utility.CreateRow(a[e],f[e]));t.append(p()).css({"margin-top":"20px"}),r._container.append(t),c(i.delegate.ExtensionProperties)},this.onViewAppear=function(){r.gridDelegatePro.getCell=function(){if(this.colName=="Value"){var e=$("<div>").addClass("statusControl"),t=this,n={};n.ID=t.data.ID,n.Name=t.data.Name,n.Value=t.data.Value,n.Config=t.data.Config,n.Description=t.data.Description,n.ValidValues=t.data.ValidValues;var r=new textbox({maxlength:500});r.attr({value:t.data.Value,width:"20px"}),r.bind("blur",function(){if($.trim(r.val())==""){r.showErrorMessage(localizedString("EXTENSION_PROPERTY_VALUE_EMPTY_WARNING_MSG"));return}n.Value=r.val(),s.empty(),s.text(n.Value),c.hide(),s.show(),u.hide(),f.show()});var s=$("<div>").addClass("td_editproperty"),o=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel"),u=$("<div>").css({"float":"left","padding-top":"3px"});o.click(function(){c.hide(),s.show(),u.hide(),f.show()});var a=$("<select>").attr({title:t.data.Value}),f=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){r.attr({value:n.Value}),u.show(),c.show(),s.hide(),f.hide()}),l=$("<div>").css({"float":"left"}).append(f),c=$("<div>").css({"float":"left"}).attr({title:t.data.Value}),h={};t.data.ValidValues!=null&&t.data.ValidValues!=undefined&&$.trim(t.data.ValidValues)!=""&&(h=JSON.parse(t.data.ValidValues));if(!jQuery.isEmptyObject(h)){for(var p in h)optionType=$("<option>").attr({value:h[p],title:p}).append(p),n.Value==h[p]&&(s.text(p).attr({title:p}),optionType.attr({selected:!0}).attr({title:p}),a.attr({title:p})),a.append(optionType);a.bind("change",function(e){var t=a.find("option:selected").val();n.Value=t,s.empty();for(var r in h)n.Value==h[r]&&(s.text(r).attr({title:r}),a.attr({title:r}));c.hide(),s.show(),u.hide(),f.show()}),c.append(a),u.append(o)}else s.text(n.Value).attr({title:n.Value}),r.placeAt(c),u.append(o);return c.hide(),u.hide(),this.data.Config?e.append(s).append(c).append(l).append(u):e.append(s),i.delegate.editAssignmentPropertyAddons.push(n),e}}}};var c3extensionInstallationStatus=function(){"use strict";var e=arguments[0]||{},t=arguments[1]||{},n=function(e,t,n,r,i,s){c3.module.apply(this),this._container=$("<div>").addClass("wizard_lite"),this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ExtensionInstallations,function(e){v()})},this.isEdit=!1;var o=arguments[0]||{},u="ExtensionStatus_",a=[localizedString("COLUMN_NAME"),localizedString("COLUMN_VERSION"),localizedString("COLUMN_PROVIDER")],f=[$("<label>").text(e),$("<label>").text(t),$("<label>").text(n)],l=[{name:"PresentationName",description:localizedString("EXTENSION_STATUS_COL_SERVERNAME"),type:"text",width:"50%"},{name:"Status",description:localizedString("HUEXTENSION_EXTESNIONSTATUS"),type:"text",width:"50%"}],c=null,h=this,p=[],d={getHeaderSpec:function(){return l},getRowCount:function(){return p.length},getRow:function(e){return p[e]},getGridHeight:function(){return 260},getDefaultSelectedIndex:function(){return 0}};this.onInit=function(){for(var e=0;e<a.length;e++)h._container.append(Utility.CreateRow(a[e],f[e]));var t=$("<div>").css({"margin-bottom":"10px","margin-left":"38px"}).append(localizedString("HUEXTENSION_EXTESNIONINSTALLSTATUS_DESC")),n=$("<div>").css({"margin-top":"10px"}).append(t);c=n.gridview({delegate:d}),h.gridViewu=c,h._container.append(n),c.show()};var v=function(){c3.service.getExtesnionInstallations().expand("PresentationServer,B1WebServer,ExtensionDeployment/Extension").filter("ExtensionDeployment/Extension/ID eq "+r+" and ExtensionDeployment/CommonDatabase/ID eq "+s).query(function(e){var t=e.data,n=[];for(var r=0;r<t.length;r++)n.push({ID:t[r].ID,PresentationName:t[r].PresentationServer==undefined?t[r].B1WebServer.Name:t[r].PresentationServer.Name,Status:t[r].Status});p=n,h.gridViewu.reload()})};this.onViewAppear=function(){d.getCell=function(){if(this.colName=="Status"){this.data.Status=this.data.Status=="Failed"?"InstallationFailed":this.data.Status;var t=$("<label>").append(localizedString(u+this.data.Status)),n=$("<div>").addClass("statusControl");if(e!="XLReporter"&&e!="SBOScript"){var r=this,s={};s.ID=r.data.ID;var o=["ToInstall","ToUpgrade","ToUninstall","Installing","Upgrading","Uninstalling","Installed","Failed"],a=["ToInstall","Installing","Installed","InstallationFailed"],f=$("<select>").bind("change",function(){var e=f.find("option:selected").val(),t={};t.ID=r.data.ID,t.Status=e;var n={};n.success=function(e){h.isEdit=!0,v()},n.error=function(e){v(),console.log(e)},c3.service.updateExtensionInstallations(t,n)}),l=null;if(i)for(var c=0;c<a.length;c++){var p=$("<option>").attr({value:a[c],title:localizedString(u+a[c])}).append(localizedString(u+a[c]));this.data.Status==a[c]&&p.attr({selected:!0}),f.append(p)}else{switch(this.data.Status){case"ToInstall":l=["ToInstall","InstallationFailed"];break;case"Installing":l=["Installing","Installed","InstallationFailed"];break;case"InstallationFailed":l=["ToInstall","InstallationFailed"];break;case"ToUpgrade":l=["ToUpgrade","UpgradeFailed"];break;case"Upgrading":l=["Upgrading","Installed","UpgradeFailed"];break;case"UpgradeFailed":l=["ToUpgrade","UpgradeFailed"];break;case"ToUninstall":l=["ToUninstall","UninstallationFailed"];break;case"Uninstalling":l=["Uninstalling","UninstallationFailed"];break;case"UninstallationFailed":l=["ToUninstall","UninstallationFailed"]}if(l)for(var c=0;c<l.length;c++){var p=$("<option>").attr({value:l[c],title:localizedString(u+l[c])}).append(localizedString(u+l[c]));this.data.Status==o[c]&&p.attr({selected:!0}),f.append(p)}}var d=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel"),m=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}),g=$("<div>").css({"float":"left","padding-top":"3px"}).append(d);d.click(function(){b.hide(),t.show(),g.hide(),m.show()}),m.click(function(){g.show(),b.show(),t.hide(),m.hide()});var y=this.data.Status,b=$("<div>").css({"float":"left"}).attr({title:localizedString(y)}).append(f);b.hide(),g.hide(),n.append(t);if(i){var w=this.data.ID;if(y=="InstallationFailed"||y=="Failed"){var E=$("<label>").addClass("ShowIcon Retry").attr({title:localizedString("MISC_RETRY")}).click(function(){var e={success:function(e){h.isEdit=!0,v()},error:function(e){v(),console.log(e)}},t={ID:w,Status:"ToInstall"};c3.service.updateExtensionInstallations(t,e)});n.append(b).append(E)}else if(y=="UpgradeFailed"){var E=$("<label>").addClass("ShowIcon Retry").attr({title:localizedString("MISC_RETRY")}).click(function(){var e={success:function(e){h.isEdit=!0,v()},error:function(e){v(),console.log(e)}},t={ID:w,Status:"ToUpgrade"};c3.service.updateExtensionInstallations(t,e)});n.append(b).append(E)}else if(y=="UninstallationFailed"){var E=$("<label>").addClass("ShowIcon Retry").attr({title:localizedString("MISC_RETRY")}).click(function(){var e={success:function(e){h.isEdit=!0,v()},error:function(e){v(),console.log(e)}},t={ID:w,Status:"ToUninstall"};c3.service.updateExtensionInstallations(t,e)});n.append(b).append(E)}else n.append(b).append(m).append(g)}else{var y=this.data.Status,w=this.data.ID;if(y=="InstallationFailed"||y=="Failed"){var E=$("<label>").addClass("ShowIcon Retry").attr({title:localizedString("MISC_RETRY")}).click(function(){var e={success:function(e){h.isEdit=!0,v()},error:function(e){v(),console.log(e)}},t={ID:w,Status:"ToInstall"};c3.service.updateExtensionInstallations(t,e)});n.append(b).append(E)}else if(y=="UpgradeFailed"){var E=$("<label>").addClass("ShowIcon Retry").attr({title:localizedString("MISC_RETRY")}).click(function(){var e={success:function(e){h.isEdit=!0,v()},error:function(e){v(),console.log(e)}},t={ID:w,Status:"ToUpgrade"};c3.service.updateExtensionInstallations(t,e)});n.append(b).append(E)}else if(y=="UninstallationFailed"){var E=$("<label>").addClass("ShowIcon Retry").attr({title:localizedString("MISC_RETRY")}).click(function(){var e={success:function(e){h.isEdit=!0,v()},error:function(e){v(),console.log(e)}},t={ID:w,Status:"ToUninstall"};c3.service.updateExtensionInstallations(t,e)});n.append(b).append(E)}}}else n.append(t);return n}},v()}},r=new n(e.Name,e.Version,e.Vendor,e.ExtensionID,e.IsTraditional,e.commonDatabaseId),i=localizedString("HUEXTENSION_EXTENSIONINSTALLSTATUS_VIEW"),s={getActionButton:function(){return null},getCloseButtonText:function(){return localizedString("MISC_OK")}};this.base=c3.dialog,this.base(s),this.view=r;var o=this;this.onInit=function(){this.view.onInit(),this.view.onInitNotification(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getTitle=function(){return i},this.getId=function(){return"c3extensionInstallationStatus"},this.finish=function(){o.close()},this.onClose.push(function(){t&&o.view.isEdit&&t.reload()})};c3editextensionDepProperty.step1=function(){function p(){c3.service.getExtesnionInstallations().expand("PresentationServer,B1WebServer,ExtensionDeployment/Extension").filter("ExtensionDeployment/Extension/ID eq "+a).query(function(e){var t=e.data,n=0;for(var r=0;r<t.length;r++)(t[r].Status=="ToInstall"||t[r].Status=="Failed")&&n++;var i=n==t.length?!0:!1;c3.service.getExtensionDeploymentProperties().expand("ExtensionDeployment").filter("ExtensionDeployment/ID eq "+f).query(function(e){e.data.length>0?d(e,i):d({data:[]})})})}function d(e){var t=e.data,n=arguments[1]||!1,i=[];for(var s=0;s<t.length;s++)i.push({ID:t[s].ID,Name:t[s].PropertyName,Value:t[s].PropertyValue,Config:t[s].Configurable,Description:t[s].Description,IsEditable:n,ValidValues:t[s].ValidValuesInfo});r.gridDataPro=i,r.gridViewPro.reload()}function v(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var r=0;r<n.length;r++){var i=$("<a>").attr({href:"#"}).append(n[r]);t.append($("<li>").attr({id:e+r.toString()}).append(i))}return t}function m(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");return t.append(y()),t}function g(){var t=e+"_plainContent",n=$("<section>").attr({id:t}),i=null;r.gridDatau=[];var s={getHeaderSpec:function(){return h},getRowCount:function(){return r.gridDatau.length},getRow:function(e){return r.gridDatau[e]},getGridHeight:function(){return 230},getDefaultSelectedIndex:function(){return 0}},o=$("<div>");return i=o.gridview({delegate:s}),i.rowSelectedEvent.push(function(){}),r.gridViewu=i,n.append(o),i.show(),n}function y(){var t=e,n=$("<section>").attr({id:t+"_property"}),i=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"20%"},{name:"Value",description:localizedString("MISC_VALUE"),type:"text",width:"40%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"40%"}],s=null;r.gridDataPro=[];var o={getHeaderSpec:function(){return i},getRowCount:function(){return r.gridDataPro.length},getRow:function(e){return r.gridDataPro[e]},getGridHeight:function(){return 230},getDefaultSelectedIndex:function(){return 0}},u=$("<div>");return s=u.gridview({delegate:o}),s.rowSelectedEvent.push(function(){}),r.gridViewPro=s,r.gridDelegatePro=o,n.append(u),s.show(),n}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e="propertychange",t=$("<section>").attr({id:e}).addClass("tab"),n=[localizedString("DETAIL_PLAIN"),localizedString("DETAIL_PROPERTY")],r=this,i=arguments[0]||{},s=i.delegate.Name,o=i.delegate.Version,u=i.delegate.Vendor,a=i.delegate.ExtensionID,f=i.delegate.ID,l=[localizedString("COLUMN_NAME"),localizedString("COLUMN_VERSION"),localizedString("COLUMN_PROVIDER")],c=[$("<label>").text(s),$("<label>").text(o),$("<label>").text(u)],h=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"30%"},{name:"Value",description:localizedString("MISC_VALUE"),type:"text",width:"70%"}];this.onInit=function(){for(var e=0;e<l.length;e++)r._container.append(Utility.CreateRow(l[e],c[e]));t.append(m()).css({"margin-top":"20px"}),r._container.append(t),p()},this.onViewAppear=function(){r.gridDelegatePro.getCell=function(){if(this.data.Config&&this.data.IsEditable||this.data.ValidValues!=null&&$.trim(this.data.ValidValues)!="")if(this.colName=="Value"){var e=this,t={},n=e.data,r=$("<div>").addClass("statusControl"),i=$("<div>").addClass("td_editproperty").text(n.Value).attr({title:n.Value});t.ID=n.ID;if(n.Config){var s=new textbox({maxlength:500}),o=s.attr({value:n.Value,width:"20px"}).bind("change",function(){t.PropertyValue=s.val().trim()}),u=$("<select>").bind("change",function(e){var n=u.find("option:selected").val();t.PropertyValue=n}),a=function(e){var t={success:function(e){p()},error:function(e){console.log(e)}};c3.service.updateExtensionDeploymentProperties(e,t)},f=$("<label>").attr({title:localizedString("MISC_SAVE")}).addClass("ShowIcon Save").click(function(){if($.trim(t.PropertyValue)==""){s.showErrorMessage(localizedString("EXTENSION_PROPERTY_VALUE_EMPTY_WARNING_MSG"));return}a(t)}),l=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel").click(function(){d.hide(),h.show()}),c=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){s.val(n.Value),u.val(n.Value),d.show(),h.hide(),o.focus()}),h=$("<div>").css({"float":"left"}).append(i).append(c),d=$("<div>").css({"float":"left"}).attr({title:n.Value}),v={};n.ValidValues&&$.trim(n.ValidValues)!=""&&(v=JSON.parse(n.ValidValues)),jQuery.isEmptyObject(v)?d.append(o):($.each(v,function(e){optionType=$("<option>").attr({value:v[e],title:e}).append(e),v[e]==n.Value&&(i.text(e).attr({title:e}),optionType.attr({selected:!0}),u.attr({title:e})),u.append(optionType)}),d.append(u)),d.append(f).append(l),d.hide(),r.append(h).append(d)}else r.append(i);return r}}}},c3editExtensionAssProperty.step1=function(){function d(){if(n.selectedProperty){n.btnDelete.attr({disabled:0});if(r.originalProps.length>0){var e=r.originalProps,t=n.selectedProperty;for(var i=0;i<e.length;i++)if(e[i].PropertyName==t.Name){n.btnDelete.attr({disabled:1});return}}}else n.btnDelete.attr({disabled:1})}function v(){r.isAssignWizard?m(r.delegate.newProperties):c3.service.getExtensionAssignmentProperties().filter("ExtensionAssignment/ID eq "+a).query(function(e){var t=e.data,n=[];if(t.length>0)for(var r=0;r<t.length;r++)n.push({ID:t[r].ID,Name:t[r].PropertyName,Value:t[r].PropertyValue,Config:t[r].Configurable,Description:t[r].Description,ValidValues:t[r].ValidValuesInfo});m(n)})}function m(e){n.gridDataPro=e,n.gridViewPro.reload(),e.length>0?n.selectedProperty=e[0]:n.selectedProperty=undefined,d()}function g(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");return t.append(y()),t}function y(){var t=e,r=$("<section>").attr({id:t+"_property"}),i=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"20%"},{name:"Value",description:localizedString("MISC_VALUE"),type:"text",width:"40%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"40%"}],s=null;n.gridDataPro=[];var o={getHeaderSpec:function(){return i},getRowCount:function(){return n.gridDataPro.length},getRow:function(e){return n.gridDataPro[e]},getGridHeight:function(){return 230},getDefaultSelectedIndex:function(){return 0}},u=$("<div>");return s=u.gridview({delegate:o}),s.rowSelectedEvent.push(function(){n.selectedProperty=n.gridDataPro[this.index],d()}),n.gridViewPro=s,n.gridDelegatePro=o,r.append(u),s.show(),r}function b(){var e=this,t=$("<div>").addClass("wizard_lite"),n={},i=[localizedString("MISC_NAME"),localizedString("MISC_VALUE"),localizedString("COLUMN_DESC")],s=new textbox({maxlength:100,isRequired:!0}),o=new textbox({maxlength:500,isRequired:!0}),u=new textbox({maxlength:500}),f=[s,o,u];s.bind("blur",function(){n.name=s.val()}),o.bind("blur",function(){n.value=o.val()}),u.bind("blur",function(){n.desc=u.val()});for(var l=0;l<i.length;l++)t.append(Utility.CreateRow(i[l],f[l]));var c={getActionButtonText:function(){return localizedString("MISC_SAVE")},validator:{checkValidity:function(){return s.checkValidity()&&o.checkValidity()}}};e.base=c3.dialog,e.base(c),e.getId=function(){return"newAssignProperty"},e.getTitle=function(){return"New Assignment Property"},e.getWidth=function(){return 380},e.getHeight=function(){return 225},e.content=t,e.onViewAppear=function(){t.show()};var h={success:function(){e.close(),v()}};e.finish=function(){if(r.isAssignWizard){var t=r.delegate.newProperties,n=s.val(),i=!1;for(var f=0;f<t.length;f++)if(t[f].Name==n){i=!0;break}i?s.showErrorMessage(textbox.validityMessages.duplicated):(e.close(),r.delegate.newProperties.push({Name:$.trim(s.val()),Value:$.trim(o.val()),Description:$.trim(u.val()),Config:!0,ValidValues:"{}",ExtensionAssignment:{__metadata:{uri:"ExtensionAssignments("+a+")"}}}),v())}else{var l={PropertyName:$.trim(s.val()),PropertyValue:$.trim(o.val()),Description:$.trim(u.val()),Configurable:!0,ValidValuesInfo:"{}",ExtensionAssignment:{__metadata:{uri:"ExtensionAssignments("+a+")"}}};c3.service.createExtensionAssignmentProperty(l,h)}}}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e="propertychange",t=$("<section>").attr({id:e}).addClass("tab"),n=this,r=arguments[0]||{},i=r.delegate.Name,s=r.delegate.Version,o=r.delegate.Vendor,u=r.delegate.ExtensionID,a=r.delegate.ID,f=[localizedString("COLUMN_NAME"),localizedString("COLUMN_VERSION"),localizedString("COLUMN_PROVIDER")],l=[$("<label>").text(i),$("<label>").text(s),$("<label>").text(o)],c=$("<input>").attr({value:localizedString("EXTENSION_ASSIGNMENT_PROPERTY_BUTTON_NEW"),type:"button"}),h=$("<input>").attr({value:localizedString("EXTENSION_ASSIGNMENT_PROPERTY_BUTTON_DELETE"),type:"button"}),p=$("<div>").addClass("btnbar").append(c).append(h);c.click(function(){var e=new b;e.show()}),h.click(function(){if(n.selectedProperty){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_DELETE_CONFIRM"),localizedString("EXTENSION_ASSIGNMENT_PROPERTY")));e.yesEvent.push(function(){if(r.isAssignWizard){var e=r.delegate.newProperties,t=n.selectedProperty,i=[];for(var s=0;s<e.length;s++)e[s].Name!=t.Name&&i.push(e[s]);r.delegate.newProperties=i,v()}else{var o={ID:n.selectedProperty.ID},u={success:function(){v()}};c3.service.deleteExtensionAssignmentProperty(o,u)}})}}),h.attr("disabled","disabled"),n.btnDelete=h,this.update=function(){d()},this.onInit=function(){for(var e=0;e<f.length;e++)n._container.append(Utility.CreateRow(f[e],l[e]));n._container.append(p),t.append(g()).css({"margin-top":"0px"}),n._container.append(t),v()},this.onViewAppear=function(){n.gridDelegatePro.getCell=function(){if(this.data.Config||this.data.ValidValues!=null&&$.trim(this.data.ValidValues)!="")if(this.colName=="Value"){var e=this,t={},i=e.data,s=$("<div>").addClass("statusControl"),o=$("<div>").addClass("td_editproperty").text(i.Value).attr({title:i.Value});t.ID=i.ID;if(i.Config){var u=new textbox({maxlength:500}),a=u.attr({value:i.Value,width:"20px"}).bind("change",function(){t.PropertyValue=u.val().trim()}),f=$("<select>").bind("change",function(e){var n=f.find("option:selected").val();t.PropertyValue=n}),l=function(e){if(r.isAssignWizard)n.selectedProperty.Value=e.PropertyValue,v();else{var t={success:function(e){v()},error:function(e){console.log(e)}};c3.service.updateExtensionAssignmentProperties(e,t)}},c=$("<label>").attr({title:localizedString("MISC_SAVE")}).addClass("ShowIcon Save").click(function(){if($.trim(t.PropertyValue)==""){u.showErrorMessage(localizedString("EXTENSION_PROPERTY_VALUE_EMPTY_WARNING_MSG"));return}l(t)}),h=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel").click(function(){m.hide(),d.show()}),p=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){u.val(i.Value),f.val(i.Value),m.show(),d.hide(),a.focus()}),d=$("<div>").css({"float":"left"}).append(o).append(p),m=$("<div>").css({"float":"left"}).attr({title:i.Value}),g={};i.ValidValues&&$.trim(i.ValidValues)!=""&&(g=JSON.parse(i.ValidValues)),jQuery.isEmptyObject(g)?m.append(a):($.each(g,function(e){optionType=$("<option>").attr({value:g[e],title:e}).append(e),g[e]==i.Value&&(o.text(e).attr({title:e}),optionType.attr({selected:!0}),f.attr({title:e})),f.append(optionType)}),m.append(f)),m.append(c).append(h),m.hide(),s.append(d).append(m)}else s.append(o);return s}}}},function(){"use strict";var e={};(function(){var t=function(e){var t,n;n=this,this.base=c3.task,this.base(localizedString("REG_US_TITLE"),100),t=this.ajaxCallBackConfig,this.execute=function(){n.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("RefreshStorageGrid")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))}),c3.service.createUserStorage(e,t)}};e.registTask=t})(),function(){var t=$("<div>").addClass("wizard_lite"),n={},r=[localizedString("MISC_PATH"),localizedString("COLUMN_URI"),localizedString("MISC_DESCRIPTION")],i=[],s=function(){return i=[new textbox({isRequired:!0}),new textbox({isRequired:!1}),$("<textarea>")]},o={checkValidity:function(){return n.Data.UNC=$.trim(i[0].val()),n.Data.URI=$.trim(i[1].val()),n.Data.Description=i[2].val(),i[0].checkValidity()}},u=function(){return t},a=function(){i[0].val(""),i[1].val(""),i[2].val("")},f=function(){var e=0,n;t.html(""),s();for(n=r.length;e<n;e++)t.append(Utility.CreateRow(r[e],i[e]))},l=function(){this.base=c3.module,this.base(),this.getContainer=u,n=arguments[0]||{},this.validator=o,this.reset=a,this.onInit=f};e.step1=l}(),function(){var t,n=!1,r={},i,s,o,u,a,f,l,c,h,p,d,v,m;c=function(){this.view.onInit(),this.content=this.view.getContainer()},h=function(){this.view.onViewAppear(),u.placeAt(this.view.getContainer())},p=function(){return"registerUsersStorage"},d=function(){return localizedString("REG_US_FOLDER")},v=function(){s.disableFinish(),u.start()},m=function(){o&&n&&o.reload()},l=function(){a=new e.registTask(r),f={taskCount:1,getTask:function(e){if(e===0)return a},finishEvent:[function(){s.readyForFinish()}],successEvent:[function(){n=!0,s.close()}],successMessage:localizedString("MISC_DONE")},u=new multiTaskProcess(f),this.view=t=new e.step1(this),i={getActionButtonText:function(){return localizedString("MISC_REGISTER")},validator:t.validator},this.base=c3.dialog,this.base(i),this.Data=r,s=this,o=arguments[1]||undefined,this.onInit=c,this.onViewAppear=h,this.getId=p,this.getTitle=d,this.finish=v,this.onClose.push(m)},window.C3RegisterUserStorage=l}()}(),c3retrieveSBOClientSession.step1=function(){function o(){var n=new loadingWindow;n.show(),i&&i>0?c3.service.retrieveSBOClientSessions(i,function(r){t=[],r.d&&r.d.results&&r.d.results.length>0&&(t=r.d.results),n.close(),e.reload()}):(n.close(),t=[],e.reload())}function u(n){t=n,e.reload()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=null,t=[],n={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"Name",description:localizedString("RTVSBOSESSION_COLUMN_CLTNAME"),type:"text",width:"44%"},{name:"Username",description:localizedString("ATVCONCTION_POPWIN_COLUMN_USERNAME"),type:"text",width:"44%"}]},getRowCount:function(){return t.length},getRow:function(e){return t[e]},getGridHeight:function(){return 270}},r=arguments[0]||{},i=arguments[1]||null,s=this;this.onInit=function(){var t=$("<div>").css({padding:"5px 0 15px 0","float":"left"}).html(localizedString("RTVSBOSESSION_POPWIN_TIP_MSG")),r=$("<div>").css({"float":"left"});e=r.gridview({delegate:n});var i=$("<div>").css({width:"100%",padding:"5px 0 10px 0 ","float":"left"}),o=$("<span>").css({width:"100%","float":"left",color:"red",padding:"8px 0 5px 5px"});s.errorPanel=o,i.append(o),s._container.append(t).append(r).append(i),e.show()},this.onViewAppear=function(){o()},this.BindData=u},c3retrieveAllSBOClientSessions.step1=function(){function u(){t=[];if(s.length>0)for(var n=0;n<s.length;n++)t.push({Name:s[n].Name,Status:s[n].Status}),a(n,s[n].Sessions);else e.reload()}function a(t,r){var i=r;n[t]={},n[t].getRow=function(e){return i[e]},n[t].getRowCount=function(){return i.length},t==s.length-1&&e.reload()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=null,t=[],n=[],r={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Name",description:localizedString("WIZARD_HU_PRESENTATION")+"/"+localizedString("RTVSBOSESSION_COLUMN_CLTNAME"),type:"text",width:"56%"},{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"Username",description:localizedString("ATVCONCTION_POPWIN_COLUMN_USERNAME"),type:"text",width:"32%"}]},getRowCount:function(){return t.length},getRow:function(e){return t[e]},getSubDelegate:function(e){return n[e]},getGridHeight:function(){return 320},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}},i=arguments[0]||{},s=arguments[1]||[],o=this;this.onInit=function(){var t=$("<div>").css({padding:"5px 0 15px 0","float":"left"}).html(localizedString("RTVALLSBOSESSION_POPWIN_TIP_MSG")),n=$("<div>").css({"float":"left"});e=n.gridview({delegate:r}),o._container.append(t).append(n),e.show()},this.onViewAppear=function(){u()}},function(){"use strict";var e={},t,n;(function(){var r=function(e){var r,i;i=this,this.base=c3.task,this.base(localizedString("RES_UPGRADELICENSE"),100),r=this.ajaxCallBackConfig,this.execute=function(){i.doneEvent.push(function(){c3ModuleManager.notifyMessage(new c3Message("RefreshStorageGrid")),c3ModuleManager.notifyMessage(new c3Message("ReferechOverview")),c3ModuleManager.notifyMessage(new c3Message("Referech_SUCreation_WelcomeOverview"))}),c3.service.deployLiscenseServer(t.ID,n.ID,r)}};e.registTask=r})(),function(){var t=$("<div>").addClass("wizard_lite"),n,r,i,s,o,u,a,f,l=function(){n=$("<section>").attr({id:"swDataGrid"});var e=[{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"20%"},{name:"RootURI",description:localizedString("RESPOOL_SHAREDFOLDER_COLUMN_SPKGPATH"),type:"text",width:"80%"}],t={needExport:function(){return!1},getHeaderSpec:function(){return e},getRowCount:function(){return r.data.length},getRow:function(e){return r.data[e]},getGridHeight:function(){return 320},getDefaultSelectedIndex:function(){return o}};return r.gridDelegate=t,u=$(n).gridview({delegate:t}),u.rowSelectedEvent.push(function(){o!==this.index&&(o=this.index,s=r.data[this.index]),i.readyForFinish()}),r.dataGrid=u,n},c=function(e){r.data=[];var t=c3.service.convertData(e.data),n,i,s,o,u="",a,l=0,c;n=f.Version.replace(".","","g").substring(0,6);for(i=0,s=t.length;i<s;i++)o=t[i],u=o.Version.replace(".","","g").substring(0,6),+n<+u&&r.data.push(o);r.dataGrid.reload()},h=function(){var e=c3.service.getSWRepositories();e.query(c)},p={checkValidity:function(){return o===-1?!1:!0}},d=function(){return t},v=function(){var e=0,t;u.show(),h()},m=function(){return s},g=function(e){u=null,this.base=c3.module,this.base(),this.getContainer=d,r=this,i=e,r.data=[],s=null,o=-1,this.onInit=v,this.validator=p,this.getSelectedItem=m,f=i.getLicensServer(),t.html(l())};e.step1=g}(),function(){var r,i=!1,s={},o,u,a,f,l,c,h,p,d,v,m,g,y,b;p=function(){this.view.onInit(),this.content=this.view.getContainer()},d=function(){this.view.onViewAppear(),u.disableFinish()},v=function(){return"c3SoftwareRepositoryList"},m=function(){return localizedString("RES_SELECT_SW")},g=function(){t=a.getSelectedItem(),n=u.view.getSelectedItem(),u.disableFinish();var e=$("<div>");e.html(localizedString("DPYLS_CONFIRM_WARNING")+"<br/>");var r=MessageBox.show({msg:e,width:400,height:180,icon:MessageBoxIcon.WARNING});r.yesEvent.push(function(){function e(e,t){var n={};u._container.find(".progress_wrap").size()>0&&$(u._container.find(".progress_wrap").parent()).remove(),u._container.append(Utility.CreateProcessRow(function(){var t=this;-1!=e?-2==e?n.progressBar.setFailed():(u.progressBarHandle=n,c3.service.getTaskProgress(e).query(function(t){var r=t.data.GetTaskProperties.split(",");"Failed"==r[0]?c3.service.getTasks(e).expand("TaskParameters").query(function(e){n.progressBar.setFailed(e.data.ResultDescription),Utility.logTaskError(e.data)}):"Successful"==r[0]?n.progressBar.setValue(100,localizedString("MISC_DONE")):(r[0]!="Pending"&&r[0]!="Done"?r[0]=localizedString("MISC_TASK_PROCESSING"):r[0]=="Pending"&&(r[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),n.progressBar.setValue(parseInt(r[1]),r[0]))})):n.progressBar.setValue(0,localizedString("SBOCOMMON_PROGRESS_WAIRING"))},n)),n.progressBar.start()}c3.service.deployLiscenseServer(t.ID,n.ID,function(t){var n=-1;t.d&&t.d.DeployLicenseServerAsync>0?n=t.d.DeployLicenseServerAsync:n=-2,e(n,t)})})},b=function(){a&&i&&a.reload()},y=function(){return a.getSelectedItem()},h=function(){l=new e.registTask(s),u=this,a=arguments[0]||undefined,this.getLicensServer=y,this.base=c3.dialog,this.Data=s,this.view=r=new e.step1(this),o={getActionButtonText:function(){return localizedString("MISC_OK")},validator:r.validator},this.base(o),this.onInit=p,this.onViewAppear=d,this.getId=v,this.getTitle=m,this.finish=g,this.onClose.push(b)},window.C3SoftwareRepositoryList=h}()}(),c3duplicateTenant.targetSU=function(){function u(){var e="duplicateTnt_toolbar",t=$("<section>").attr({id:e}).addClass("tools"),n=$("<div>").addClass("dropdown_list_wrap").css("float","left"),r=$("<select>").css("width","130px");r.change(function(){f()}),s.suSelect=r,n.append(r);var i=$("<input>").attr("type","textbox").css("float","right").css("width","130px"),o=$("<a>").attr({href:"#"}).addClass("refresh").css("float","right");return o.click(function(){f()}),t.append(n),t.append(o),t.append($("<span>").html("&nbsp;&nbsp;").css("float","right")),s.toolbar=t,t}function a(){s.suSelect.find("option").remove(),s.suSelect.append($("<option>").val("all").append(localizedString("ALL")).attr("selected",!0)),this.resellerGrpId!=undefined&&c3.hasPermission([permissionItems.operator])?$.c3BaseClient.actAsGroups(this.resellerGrpId).toCall(function(){c3.service.getSWRepositories().query(function(e){if(e.data&&e.data.length>0)for(var n=0;n<e.data.length;n++){if(isHANA(t.ServiceUnit_CommonDatabase_DatabaseInstance.ServerType)&&e.data[n].HANAenabled!=1)continue;if(!isHANA(t.ServiceUnit_CommonDatabase_DatabaseInstance.ServerType)&&e.data[n].HANAenabled==1)continue;s.suSelect.append($("<option>").val(e.data[n].ID).append(e.data[n].Version))}})}):c3.service.getSWRepositories().query(function(e){if(e.data&&e.data.length>0)for(var n=0;n<e.data.length;n++){if(isHANA(t.ServiceUnit_CommonDatabase_DatabaseInstance.ServerType)&&e.data[n].HANAenabled!=1)continue;if(!isHANA(t.ServiceUnit_CommonDatabase_DatabaseInstance.ServerType)&&e.data[n].HANAenabled==1)continue;s.suSelect.append($("<option>").val(e.data[n].ID).append(e.data[n].Version))}})}function l(){e.TargetServiceUnit!=null&&e.TargetServiceUnit.ID>0?e.readyForNext():e.disableNext()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=arguments[1]||null;e.TargetServiceUnit=null;var n=null,r=[],i={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"30%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"30%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"30%"}]},getRowCount:function(){return r.length},getRow:function(e){return r[e]},getGridHeight:function(){return 300},shouldExpandOnRowSelect:function(){return!1},getTip:function(){return c3.hasPermission([permissionItems.operator])?Utility.CreateTipBoard(localizedString("DUPTNT_WIZARD_STEP1_EMPTY"),function(){var e=new c3huwizard(s);e.show()}):Utility.CreateTipBoard(localizedString("DUPTNT_WIZARD_STEP1_EMPTY"),!1,null)},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}},s=this,o=$("<input>").attr({type:"button",value:"Refresh"}).click(function(){f()});this.onInit=function(){var t=$("<div>").css({"float":"left",width:"480px"});n=t.gridview({delegate:i}),n.rowSelectedEvent.push(function(){e.TargetServiceUnit=this.data,l()}),s._container.append(u()),s._container.append(t),n.show()},this.onViewAppear=function(){a(),f()},this.reload=function(){f()};var f=function(){r=[],e.TargetServiceUnit=null,s.targetSU_loading=new loadingWindow,s.targetSU_loading.show();var o=!0,u="Status eq 'Online' and Purpose ne 'Staging' ";s.suSelect.val()!="all"&&(flag=!1,u+=" and SoftwareRepository/ID eq "+s.suSelect.val());var a=function(){c3.service.getHostingUnits().filter(u).expand("LicenseServer,CommonDatabase/DatabaseInstance").query(function(u){var a=-1;if(u.data&&u.data.length>0){r.clear();if(o)for(var f=0;f<u.data.length;f++)t.ServiceUnit_LicenseServer_ID==u.data[f].LicenseServer.ID&&u.data[f].CommonDatabase.DatabaseInstance.ServerType==t.ServiceUnit_CommonDatabase_DatabaseInstance.ServerType&&(u.data[f].Version>=t.ServiceUnit_Version?r.push(u.data[f]):u.data[f].Version==t.ServiceUnit_Version&&(r.push(u.data[f]),e.TargetServiceUnit=u.data[f],a=r.length-1));else r=u.data}i.getDefaultSelectedIndex=function(){return a},n.reload(),s.targetSU_loading.close(),l()})};this.resellerGrpId!=undefined&&c3.hasPermission([permissionItems.operator])?$.c3BaseClient.actAsGroups(this.resellerGrpId).toCall(function(){a()}):a()};this.validator=new function(){var n=[],r=function(){if(t.ServiceUnit_Version<e.TargetServiceUnit.Version){var n=new c3selectStagingSU4Duplicate(s,e);n.show()}else e.next()};this.checkValidity=r}},c3duplicateTenant.extension=function(){function u(){var e=$("<input>").attr({type:"button",value:"Refresh"}).css({"float":"right"}).click(function(){a()}),t=$("<div>").css("width","100%").append(e);return t}function f(t,n){var r={};r.success=function(r){r&&r.d.IsExtensionCompatibilityCheckOn?e.compatibilityCheckSwitch=!0:e.compatibilityCheckSwitch=!1,c3.service.getExtensionDeployments().expand("Extension").filter("CommonDatabase/ID eq "+n+" and (Extension/Type eq 'AddOn' or Extension/Type eq 'LightAddOn' or Extension/Type eq 'LightAddOnMV') ").query(t)},c3.service.getExtensionCompatibilityCheckSwitch(r)}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=arguments[1]||null,r=[],i=null,s=[],o={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"30%"},{name:"Version",description:localizedString("DUPTNT_WIZARD_STEP4_COLUMN_SOURCEVERSION"),type:"text",width:"30%"},{name:"TargetVersion",description:localizedString("DUPTNT_WIZARD_STEP4_COLUMN_TARGETVERSION"),type:"text",width:"40%"}]},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 270},shouldExpandOnRowSelect:function(){return!1},getTip:function(){return Utility.CreateTipBoard(localizedString("DUPTNT_WIZARD_STEP2_EMPTY"),null,!0)},getCell:function(){var t=null;if(this.colName=="Name"){var n=this.parentRow.find("td:nth-child(1) input[type=checkbox]");n&&(this.data["CheckboxMode"]=="DefaultSelected"?n.attr({checked:!0}):(this.data["CheckboxMode"]=="DefaultUnselected_NotSuppWarning"||this.data["CheckboxMode"]=="DefaultUnSelected")&&n.attr({checked:!1})),t=this.data[this.colName]}else if(this.colName=="TargetVersion"){var r=this.data;if(r.IsSystemAddon!=1){var i=$("<span>").css("float","left").append(r.TargetVersions[0].Version).attr({title:r.TargetVersions[0].Version}),s=$("<div>").append(i);if(r.IsLightAddonMV==1){for(var o=0;o<r.TargetVersions.length;o++)if(r.TargetVersions[o].SameVersion==1){i.text(r.TargetVersions[o].Version);break}if(r.TargetVersions.length>1){var u=$("<div>").attr({"class":"addon_selecter"}),a=$("<ul>");for(var o=0;o<r.TargetVersions.length;o++){var f=$("<li>").append(r.TargetVersions[o].Version).data("ID",r.TargetVersions[o].ExtensionID);f.click(function(){var t=$(this).text();$(i).attr("title",t),t.length>20&&(t=t.substring(0,20)+"..."),$(i).text(t),r.SelectedExtensionID=$(this).data("ID")==null?r.ExtensionID:$(this).data("ID"),e.pop!=null&&e.pop.close()}),a.append(f)}u.append(a);var l=$("<img>").attr({src:"css/icons/dropdownlist_btn.png","class":"addon_icon"});l.click(function(){e.pop=null,e.pop=$(this).popupManager(300,40+r.TargetVersions.length*25,!1,localizedString("DUPTNT_WIZARD_STEP4_CHOSEADDON")),e.pop.show(),e.pop.append(u)}),s.append(l)}}return s}if(r.TargetVersions.length>0)return $("<span>").css("float","left").append(r.TargetVersions[0].Version).attr({title:r.TargetVersions[0].Version})}return t}};this.onInit=function(){var t=$("<div>").css({"float":"left"});o.HideCheckAll=!0,i=t.gridview({delegate:o,checkType:1}),i.rowCheckEvent.push(function(){var t=s[this.index],n=this;if(this.isChecked){if(t.CheckboxMode=="DefaultUnselected_NotSuppWarning"){var i=new c3extensionNotSupportWarning(e,t.ExtensionValidities,this.target,r,t);i.show();return}if(t.CheckboxMode=="DefaultUnSelected_EnableCompatibility"){var o=MessageBox.prompt({msg:localizedString("TNT_DUP_EXT_WARNING"),width:350,height:150,title:localizedString("AVAILABLE_STATUS_WARNING")});$(n.target).attr({checked:!1});return}r.push(t)}else for(var u=0;u<r.length;u++)if(r[u].ExtensionID==t.ExtensionID){r.remove(u);break}}),e._container.append(t),e._container.append(u()),e._container.append($("<div>").css({width:"100%","float":"left",padding:"8px 0 5px 0"}).html("* "+localizedString("DUPTNT_WIZARD_ADDON_TIPMSG"))),i.show()},this.onViewAppear=function(){a()},this.reload=function(){a()},this.validator=new function(){var e=[],n=function(){t.Extensions=[];for(var e=0;e<r.length;e++){var n=r[e].ExtensionID;r[e].SelectedExtensionID!=null&&(n=r[e].SelectedExtensionID),t.Extensions.push({ID:r[e].ExtensionID,SelectedID:r[e].SelectedExtensionID,Name:r[e].Name,Version:r[e].Version,Vendor:r[e].Vendor,Type:r[e].Type,CheckboxMode:r[e].CheckboxMode,IsSystemAddon:r[e].IsSystemAddon,ExtensionValidities:r[e].ExtensionValidities})}return!0};this.checkValidity=n};var a=function(){r=[],e.lw0=new loadingWindow,e.lw0.show();var o={success:function(n){var o={},u=[];o.data={};if(n.data&&null!=n.data){var a={success:function(a){for(var f=0;f<n.data.length;f++){var l=!1,c=!1,h=!1,p=!1,d=!1;if(a.data&&null!=a.data)for(var v=0;v<a.data.length;v++){n.data[f].ExtensionDeployment.Extension.IsBuiltIn==1&&(d=!0),n.data[f].ExtensionDeployment.Extension.Type=="LightAddOn"?(h=!0,p=!1):n.data[f].ExtensionDeployment.Extension.Type=="LightAddOnMV"&&(h=!1,p=!0);if(n.data[f].ExtensionDeployment.Extension.Name==a.data[v].Extension.Name&&n.data[f].ExtensionDeployment.Extension.Vendor==a.data[v].Extension.Vendor){if(n.data[f].ExtensionDeployment.Extension.Version==a.data[v].Extension.Version){l=!0,c=!0;break}l=!0,c=!1}}if(d){var m="DefaultSelected",g={};for(var y=0;y<a.data.length;y++)if(n.data[f].ExtensionDeployment.Extension.Name==a.data[y].Extension.Name&&n.data[f].ExtensionDeployment.Extension.Vendor==a.data[y].Extension.Vendor){g.ExtensionID=a.data[y].Extension.ID,g.Version=a.data[y].Extension.Version,g.Type=a.data[y].Extension.Type;break}var b=n.data[f].ExtensionDeployment.Extension.ID;g.ExtensionID!=null&&(b=g.ExtensionID);var w={ExtensionID:n.data[f].ExtensionDeployment.Extension.ID,Name:n.data[f].ExtensionDeployment.Extension.Name,Version:n.data[f].ExtensionDeployment.Extension.Version,Vendor:n.data[f].ExtensionDeployment.Extension.Vendor,Type:convertToDisplayExtensionType(n.data[f].ExtensionDeployment.Extension.Type),CheckboxMode:m,TargetVersions:[g],IsSystemAddon:!0,SelectedExtensionID:b,ExtensionValidities:n.data[f].ExtensionDeployment.Extension.ExtensionValidities&&n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results.length>0?n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results:[]};u.push(w),r.push(w)}else{var m="DefaultSelected",E=[],b=n.data[f].ExtensionDeployment.Extension.ID,S=!1;for(var x=0;x<a.data.length;x++)if(n.data[f].ExtensionDeployment.Extension.Name==a.data[x].Extension.Name&&n.data[f].ExtensionDeployment.Extension.Vendor==a.data[x].Extension.Vendor){var T={};T.ExtensionID=a.data[x].Extension.ID,T.Version=a.data[x].Extension.Version,T.Type=a.data[x].Extension.Type,a.data[x].Extension.Version==n.data[f].ExtensionDeployment.Extension.Version&&(T.SameVersion=!0,S=!0,b=a.data[x].Extension.ID),E.push(T);if(!p)break}E.length>0&&S!=1&&(b=E[0].ExtensionID);if(p){if(!c){m="DefaultUnSelected",E.push({ExtensionID:null,Version:localizedString("DUPTNT_WIZARD_STEP4_DEPLOYSOURCE")});if(E.length==1&&n.data[f].ExtensionDeployment.Extension.ExtensionValidities&&n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results&&n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results.length>0){var N=!1;for(var y=0;y<n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results.length;y++){var C=n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results[y];if(C.FromVersion<=t.TargetServiceUnit.Version&&C.ToVersion>=t.TargetServiceUnit.Version){N=!0;break}}N||(m="DefaultUnselected_NotSuppWarning",e.compatibilityCheckSwitch==1&&(m="DefaultUnSelected_EnableCompatibility"))}}var w={ExtensionID:n.data[f].ExtensionDeployment.Extension.ID,Name:n.data[f].ExtensionDeployment.Extension.Name,Version:n.data[f].ExtensionDeployment.Extension.Version,Vendor:n.data[f].ExtensionDeployment.Extension.Vendor,Type:convertToDisplayExtensionType(n.data[f].ExtensionDeployment.Extension.Type),CheckboxMode:m,TargetVersions:E,IsSystemAddon:!1,IsLightAddonMV:p,SelectedExtensionID:b,ExtensionValidities:n.data[f].ExtensionDeployment.Extension.ExtensionValidities&&n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results.length>0?n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results:[]};u.push(w),m=="DefaultSelected"&&r.push(w)}else if(c){var w={ExtensionID:n.data[f].ExtensionDeployment.Extension.ID,Name:n.data[f].ExtensionDeployment.Extension.Name,Version:n.data[f].ExtensionDeployment.Extension.Version,Vendor:n.data[f].ExtensionDeployment.Extension.Vendor,Type:convertToDisplayExtensionType(n.data[f].ExtensionDeployment.Extension.Type),CheckboxMode:m,TargetVersions:E,IsSystemAddon:!1,SelectedExtensionID:b,ExtensionValidities:n.data[f].ExtensionDeployment.Extension.ExtensionValidities&&n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results.length>0?n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results:[]};u.push(w),r.push(w)}else{m="DefaultUnSelected";if(E.length==0){E.push({ExtensionID:null,Version:localizedString("DUPTNT_WIZARD_STEP4_DEPLOYSOURCE")});if(n.data[f].ExtensionDeployment.Extension.ExtensionValidities&&n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results&&n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results.length>0){var N=!1;for(var y=0;y<n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results.length;y++){var C=n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results[y];if(C.FromVersion<=t.TargetServiceUnit.Version&&C.ToVersion>=t.TargetServiceUnit.Version){N=!0;break}}N||(m="DefaultUnselected_NotSuppWarning",h==1&&e.compatibilityCheckSwitch==1&&(m="DefaultUnSelected_EnableCompatibility"))}}var w={ExtensionID:n.data[f].ExtensionDeployment.Extension.ID,Name:n.data[f].ExtensionDeployment.Extension.Name,Version:n.data[f].ExtensionDeployment.Extension.Version,Vendor:n.data[f].ExtensionDeployment.Extension.Vendor,Type:convertToDisplayExtensionType(n.data[f].ExtensionDeployment.Extension.Type),CheckboxMode:m,TargetVersions:E,IsSystemAddon:!1,SelectedExtensionID:b,ExtensionValidities:n.data[f].ExtensionDeployment.Extension.ExtensionValidities&&n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results.length>0?n.data[f].ExtensionDeployment.Extension.ExtensionValidities.results:[]};u.push(w),m=="DefaultSelected"&&r.push(w)}}}o.data=u,s=o.data,t.ExtensionGridData=s,i.reload(),e.lw0.close()},error:function(){s=[],i.reload(),e.lw0.close()}};f(a,t.TargetServiceUnit.CommonDatabase.ID)}},error:function(){s=[],i.reload(),e.lw0.close()}};c3.service.getExtensionAssignments().expand("ExtensionDeployment/Extension/ExtensionValidities").filter("CompanyDatabase/ID eq "+n.CompanyDatabase_ID+" and (ExtensionDeployment/Extension/Type eq 'AddOn' or ExtensionDeployment/Extension/Type eq 'LightAddOn' or ExtensionDeployment/Extension/Type eq 'LightAddOnMV') ").query(o)}},c3duplicateTenant.tenantInfo=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=arguments[1]||null;t.TenantEntity=null;var r={CustomerName:{Name:localizedString("MISC_CUSTNAME"),Value:new textbox({isRequired:!0,isDisabled:!0})},ServiceUnitName:{Name:localizedString("WIZARD_HU_HUNAME"),Value:new textbox({isRequired:!0,isDisabled:!0})},TenantName:{Name:localizedString("CUSTOMERCREATION_LABEL_TNTNAME"),Value:new textbox({isRequired:!0,maxlength:90,pattern:"[0-9a-zA-Z_-]*"})},DatabaseName:{Name:localizedString("TNT_COLUMN_DBNAME"),Value:new textbox({isRequired:!0,maxlength:90,pattern:"[0-9a-zA-Z_]*"})},Purpose:{Name:localizedString("COLUMN_PURPOSE"),Value:new dropdownlist({isRequired:!0})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},i=new function(){var e=[],n=function(){var e=r.TenantName.Value.checkValidity()&&r.DatabaseName.Value.checkValidity();if(!e)return!1;t.TenantEntity={},t.TenantEntity.TenantName=$.trim(r.TenantName.Value.val()),t.TenantEntity.DatabaseName=$.trim(r.DatabaseName.Value.val()),t.TenantEntity.Purpose=r.Purpose.Value.val(),t.TenantEntity.Description=r.Description.Value.val(),c3.service.getTenants().filter("CompanyDatabase/CompanyName eq '"+r.TenantName.Value.val()+"'").query(function(e){if(e.data&&e.data.length>0){r.TenantName.Value.showErrorMessage(localizedString("TNT_CREATION_TNTNAME_EXIST"));return}c3.service.checkDatabaseExist(t.TargetServiceUnit.CommonDatabase.DatabaseInstance.ID,t.TenantEntity.DatabaseName).query(function(e){if(e.data.CheckDatabaseExist){r.DatabaseName.Value.showErrorMessage(localizedString("TNT_CREATION_DBNAME_EXIST"));return}t.next()})})};this.validEvent=e,this.checkValidity=n};this.validator=i,this.onInit=function(){r.TenantName.Value.bind("change",function(){r.DatabaseName.Value.attr({value:r.TenantName.Value.val()})}),this._container.append(s())};var s=function(){var e=$("<div>");for(var i in r){var s=Utility.CreateRow(r[i].Name,r[i].Value);s.css({height:"28px"}),e.append(s)}return c3.service.getTenantPurpose(function(e){r.Purpose.Value.find("option").remove();var t=null;for(var n=0;n<e.data.length;n++)e.data[n]!="Trial"&&(t=$("<option>").val(e.data[n]),t.append(e.data[n]),r.Purpose.Value.append(t));r.Purpose.Value.val("Testing")}),r.CustomerName.Value.val(n.Customer_Name),r.ServiceUnitName.Value.val(t.TargetServiceUnit.Name),r.TenantName.Value.val(n.CompanyDatabase_CompanyName+"_duplicate"),r.DatabaseName.Value.val(n.CompanyDatabase_Name+"_duplicate"),e};this.onViewAppear=function(){r.ServiceUnitName.Value.val(t.TargetServiceUnit.Name)}},c3duplicateTenant.tenantUsers=function(){function f(e,t,r){var i=e.Type,s=!1,o=-1;if(n.currentUser.LicenseModules!=null&&n.currentUser.LicenseModules.length>0){for(var u=0;u<n.currentUser.LicenseModules.length;u++)if(i==n.currentUser.LicenseModules[u]){s=!0,o=u;break}}else n.currentUser.LicenseModules=[];var a=null;for(var u=0;u<n.CountLabels.length;u++)if(r==n.CountLabels[u].Index){a=n.CountLabels[u].Label;break}if(t){if(!s){n.currentUser.LicenseModules.push(i);for(var u=0;u<n.LicenseModuleDoms.length;u++)if(n.LicenseModuleDoms[u].ModuleType==i){n.LicenseModuleDoms[u].Available--;break}}if(a!=null){var f=parseInt($(a).text())-1;isNaN(f)||$(a).text(f+"/"+e.Total)}}else{if(s&&o!=-1){for(var u=0;u<n.LicenseModuleDoms.length;u++)if(n.LicenseModuleDoms[u].ModuleType==n.currentUser.LicenseModules[o]){n.LicenseModuleDoms[u].Available++;break}n.currentUser.LicenseModules.remove(o)}if(a!=null){var f=parseInt($(a).text())+1;isNaN(f)||$(a).text(f+"/"+e.Total)}}}function l(){for(var e=0;e<n.LicenseModuleDoms.length;e++){n.LicenseModuleDoms[e].Available>0&&(n.LicenseModuleDoms[e].Checkbox.removeAttr("disabled"),n.LicenseModuleDoms[e].Checkbox.removeAttr("checked"));if(n.currentUser!=null&&n.currentUser.LicenseModules!=null&&n.currentUser.LicenseModules.length>0){var t=n.currentUser.LicenseModules;for(var r=0;r<t.length;r++)if(t[r]==n.LicenseModuleDoms[e].ModuleType){n.LicenseModuleDoms[e].Checkbox.removeAttr("disabled"),n.LicenseModuleDoms[e].Checkbox.attr("checked",!0);break}}}}function c(){var e="duplicateTnt_toolbar",s=$("<section>").attr({id:e}).addClass("tools"),o=$("<input>").attr({value:localizedString("TENANT_EXTENSION_ASSIGN"),type:"button"});s.append(o),o.click(function(){var e={CustomerID:t.Customer_ID,CustomerGroupID:t.Customer_Group_ID,TenantID:t.ID,InstallationNumber:t.Customer_InstallationNumber,CustomerUsers:new function(){var e=[];for(var t=0;t<i.length;t++)e.push({ID:i[t].ID,systemUsername:i[t].Name,status:i[t].Status,B1Username:i[t].B1UserName,IsOperator:i[t].IsSuperUser,IsPowerUser:i[t].IsPowerUser,PowerUser:i[t].IsPowerUser,SuperUser:i[t].IsSuperUser});return e},SelectedUsers:new function(){var e=[];for(var t=0;t<i.length;t++)e.push({ID:i[t].ID,systemUsername:i[t].Name,status:i[t].Status,B1Username:i[t].B1UserName,IsOperator:i[t].IsSuperUser,IsPowerUser:i[t].IsPowerUser,PowerUser:i[t].IsPowerUser,SuperUser:i[t].IsSuperUser});return e}};c3.service.getUsersByGroup(t.Customer_Group_ID).query(function(t){if(t.data&&t.data.length>0)for(var r=0;r<t.data.length;r++){var i=!1;for(var s=0;s<e.CustomerUsers.length;s++)if(t.data[r].SystemUsername==e.CustomerUsers[s].systemUsername){i=!0;break}i||e.CustomerUsers.push({ID:t.data[r].ID,status:t.data[r].Status,systemUsername:t.data[r].SystemUsername})}var o=new c3addCustomerUsers(n,e);o.finishEvent.push(function(){h(o.selectedItems),n.btnChangeUser.attr("disabled",!0),v()}),o.show()})});var u=$("<input>").attr({value:localizedString("DUPTNT_WIZARD_CHANGESYSUSER_BTN_TEXT"),type:"button",disabled:!0});return s.append($("<span>").addClass("split")).append(u),u.click(function(){var e=new c3changeSystemUser(n,t,n.currentUser,r,i);e.show(),e.finishEvent.push(function(){n.btnChangeUser.attr("disabled",1)})}),n.btnChangeUser=u,n.toolbar=s,s}function h(e){if(e==null||e.length==0)i=[];else{for(var t=0;t<e.length;t++){var n=!1;for(var s=0;s<i.length;s++)if(e[t].SystemUsername==i[s].Name){n=!0,i[s].Status=e[t].Status,i[s].B1UserName=e[t].B1Username,i[s].IsPowerUser=e[t].PowerUser,i[s].IsSuperUser=e[t].SuperUser;var o=localizedString("B1_NORMALUSER");i[s].IsPowerUser==1&&(o=localizedString("B1_POWERUSER")),i[s].IsSuperUser==1&&(o=localizedString("B1_SUPERUSER")),i[s].B1UserType=o;break}if(!n){var o=localizedString("B1_NORMALUSER");e[t].PowerUser==1&&(o=localizedString("B1_POWERUSER")),e[t].SuperUser==1&&(o=localizedString("B1_SUPERUSER")),i.push({B1UserName:e[t].B1Username,B1UserType:o,Id:e[t].ID,IsPowerUser:e[t].PowerUser,IsSuperUser:e[t].SuperUser,LicenseAssigns:"",LicenseModules:[],Name:e[t].SystemUsername,RoleId:null,Status:e[t].Status})}}for(var s=0;s<i.length;s++){var n=!1;for(var t=0;t<e.length;t++)if(e[t].SystemUsername==i[s].Name){n=!0;break}n||i.remove(s--)}}r.reload(),p()}function p(){if(n.LicenseModuleDoms&&n.LicenseModuleDoms.length>0)for(var e=0;e<n.LicenseModuleDoms.length;e++)n.LicenseModuleDoms[e].Checkbox.attr({disabled:1,checked:!1})}function v(){i.length>0?(e.TenantUsers=i,e.readyForNext()):(e.TenantUsers=[],e.readyForNext())}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=arguments[1]||{},n=this;n.currentUser=null,n.LicenseModuleDoms=[],n.CountLabels=[];var r=null,i=[],s={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"Name",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"30%"},{name:"B1UserName",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"28%"},{name:"UserType",description:localizedString("COLUMN_USERTYPE"),type:"text",width:"30%"}]},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 130},getTip:function(){return Utility.CreateTipBoard(localizedString("DUPTNT_WIZARD_STEP3_EMPTY"),null,!0)},shouldExpandOnRowSelect:function(){return!1},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}else this.colName=="UserType"&&(e=$("<span>").text(localizedString("B1_NORMALUSER")),this.data.IsPowerUser==1&&e.text(localizedString("B1_POWERUSER")),this.data.IsSuperUser==1&&e.text(localizedString("B1_SUPERUSER")));return e}},o=null,u=[],a={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Description",description:localizedString("COLUMN_B1USERTYPELIC"),type:"text",width:"35%"},{name:"Selected",description:localizedString("COLUMN_USED"),type:"text",width:"10%"},{name:"CountLabel",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"25%"},{name:"Quota",description:localizedString("COLUMN_QUOTA"),type:"text",width:"30%"}]},getRowCount:function(){return u.length},getRow:function(e){return u[e]},getGridHeight:function(){return 178},getCell:function(){if(this.colName=="CountLabel"){var e=$("<span>");return e.text(this.data.Count+"/"+this.data.Total),n.CountLabels.push({Index:this.row,Label:e}),e}if(this.colName=="Selected"){var t=this.data,r=this.row,i=$("<input>").attr({type:"checkbox"});return n.currentUser==null&&i.attr("disabled",1),i.click(function(){$(this).attr("checked")==1?f(t,!0,r):f(t,!1,r)}),n.LicenseModuleDoms.push({Available:this.data.Count,Checkbox:i,ModuleType:this.data.Type}),i}return this.colName=="Quota"&&(this.data["TotalQuota"]==null?this.data[this.colName]=localizedString("UNLIMTIED"):this.data[this.colName]=this.data.TotalQuota),null}};this.onInit=function(){var e=$("<div>").css({"float":"left"});r=e.gridview({delegate:s}),r.rowSelectedEvent.push(function(){n.currentUser=this.data,n.btnChangeUser.removeAttr("disabled");for(var e=0;e<n.LicenseModuleDoms.length;e++)n.LicenseModuleDoms[e].Checkbox.attr("disabled",!0),n.LicenseModuleDoms[e].Checkbox.attr("checked",!1);l()}),n._container.append(c()),n._container.append(e),r.show();var t=$("<div>").css({"float":"left"});o=t.gridview({delegate:a}),o.rowSelectedEvent.push(function(){}),n._container.append(t),o.show(),d()},this.onViewAppear=function(){},this.reload=function(){d()};var d=function(){i=[],n.currentUser=null,n.CountLabels=[],n.slw=new loadingWindow,n.slw.show(),tenantManager.loadTenantUsers(t,function(){t&&t.Users&&t.Users.length>0&&(i=t.Users),r.reload(),v();if(!t.LicenseFile_ID){n.slw.close(),o.reload();return}c3.service.getLicenseModulesPerCustomer(t.LicenseFile_ID,t.Customer_ID).query(function(t){u=[];if(t.data&&t.data.length>0){var r=t.data,i=[];for(var s=0;s<r.length;s++)r[s].Used=r[s].Total-r[s].Available,r[s].IsExpired?r[s].Status="Expired":r[s].Status="Available",r[s].Count=r[s].Available,i.push(r[s]);r=null,u=i,e.LicenseModules=i}n.slw.close(),o.reload()})})}},c3duplicateTenant.review=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=arguments[0]||{},n=arguments[1]||{},r=null,i=[],s={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"SystemUser",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"20%"},{name:"UserCode",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"20%"},{name:"LicenseModulesString",description:localizedString("WIZARD_TENANT_LIVMDL"),type:"text",width:"60%"}]},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 180}},o=null,u=[],a={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"30%"},{name:"Version",description:localizedString("DUPTNT_WIZARD_STEP4_COLUMN_SOURCEVERSION"),type:"text",width:"30%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"20%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"20%"}]},getRowCount:function(){return u.length},getRow:function(e){return u[e]},getGridHeight:function(){return 180}};this.onInit=function(){var e=$("<div>").attr("class","review"),f=$("<div>").attr("class","block");f.append($("<div>").attr("class","blockHeader").append(localizedString("CUSTOMER"))),f.append($("<div>").attr("class","row").append(localizedString("COLUMN_MSSQL_NAME")+": "+n.Customer_Name)),f.append($("<div>").attr("class","row").append(localizedString("MISC_TYPE")+": "+n.Customer_Type)),f.append($("<div>").attr("class","row").append(localizedString("RES_LIC_INSTALLATION_NUM")+": "+n.Customer_InstallationNumber)),e.append(f);var l=$("<div>").attr("class","block");l.append($("<div>").attr("class","blockHeader").append(localizedString("HOSTUNIT"))),t.TargetServiceUnit!=null&&(l.append($("<div>").attr("class","row").append(localizedString("COLUMN_MSSQL_NAME")+": "+t.TargetServiceUnit.Name)),l.append($("<div>").attr("class","row").append(localizedString("MISC_TYPE")+": "+t.TargetServiceUnit.Purpose)),l.append($("<div>").attr("class","row").append(localizedString("MISC_VERSION")+": "+t.TargetServiceUnit.Version))),e.append(l);var c=$("<div>").attr("class","block");c.append($("<div>").attr("class","blockHeader").append(localizedString("TENANT"))),c.append($("<div>").attr("class","row").append(localizedString("COLUMN_MSSQL_NAME")+": "+t.TenantEntity.TenantName)),c.append($("<div>").attr("class","row").append(localizedString("TNT_COLUMN_DBNAME")+": "+t.TenantEntity.DatabaseName)),c.append($("<div>").attr("class","row").append(localizedString("COLUMN_PURPOSE")+": "+t.TenantEntity.Purpose)),e.append(c);var h=$("<div>").attr("class","block");h.append($("<div>").attr("class","blockHeader").append(localizedString("TENANT_LICENSE_ASSIGN_TITLE")));if(t.TenantUsers!=null&&t.TenantUsers.length>0){var p=$("<div>");r=p.gridview({delegate:s}),r.show(),i=[];for(var d=0;d<t.TenantUsers.length;d++){var v="";if(t.TenantUsers[d].LicenseModules!=null&&t.TenantUsers[d].LicenseModules.length>0)for(var m=0;m<t.TenantUsers[d].LicenseModules.length;m++){var g="";for(var y=0;y<t.LicenseModules.length;y++)if(t.LicenseModules[y].Type==t.TenantUsers[d].LicenseModules[m]){g=t.LicenseModules[y].Description;break}m<t.TenantUsers[d].LicenseModules.length-1?v+=g+", ":v+=g}var b=localizedString("B1_NORMALUSER");t.TenantUsers[d].IsPowerUser==1&&(b=localizedString("B1_POWERUSER")),t.TenantUsers[d].IsSuperUser==1&&(b=localizedString("B1_SUPERUSER")),i.push({SystemUser:t.TenantUsers[d].Name,UserCode:t.TenantUsers[d].B1UserName,UserType:b,LicenseModulesString:v})}t.UsersCache=i,r.reload(),h.append(p)}e.append(h);var w=$("<div>").attr("class","block");w.append($("<div>").attr("class","blockHeader").append(localizedString("EXTENSION")));if(t.Extensions!=null&&t.Extensions.length>0&&t.ExtensionGridData!=null&&t.ExtensionGridData.length>0){var E=[];for(var d=0;d<t.Extensions.length;d++)for(var m=0;m<t.ExtensionGridData.length;m++)if(t.ExtensionGridData[m].ExtensionID==t.Extensions[d].ID){E.push(t.ExtensionGridData[m]);break}var S=$("<div>");o=S.gridview({delegate:a}),o.show(),w.append(S),u=E,o.reload()}e.append(w),this._container.append(e)},this.onViewAppear=function(){this._container.html(""),this.onInit()}},c3duplicateTenant.processDuplicate=function(){function f(e){var n=[];t[e]={},t[e].getRow=function(e){return n[e]},t[e].getRowCount=function(){return n.length},t[e].getCell=function(){if(this.colName=="Result"){var e=this.data.TaskID,t=$("<div>"),n=this,r=this.row,i=[];e==0?function(e){e.c3progress(function(){this.setFailed()},{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0})}(t):i.push(function(t){return t.c3progress(function(e){return function(){return o(this,e,n)}}(e),{max:100,dur:c3config.Clocker-2,async:1,width:60,swf:!0,async:1,hwf:!0})}(t));for(var s=0,u=i.length;s<u;s++)0==s&&i[s].start(),s<u-1&&i[s].finishEvent.push(function(e){return function(t){e.start()}}(i[s+1]));return t}return null},c3.service.getSubTask(i[0].TaskID).query(function(e){n=[];if(e.data&&e.data.length>0)for(var t=0;t<e.data.length;t++)n.push({Name:e.data[t].Description,TaskID:e.data[t].ID});u.ld1.close(),r.reload()})}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=[],n=arguments[1]||{},r=null,i=[],s={needExport:function(){return!1},disableSort:function(){return!0},getHeaderSpec:function(){return[{name:"Name",description:localizedString("HU_GD_NAME"),type:"text",width:"65%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"35%"}]},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 300},getSubDelegate:function(e){return t[e]},shouldExpandOnRowSelect:function(){return!1},getCell:function(){var t=null;if(this.colName=="Result"){var n=this.data.TaskID,r=$("<div>"),i=this,s=this.row,u=[];n==0?function(e){e.c3progress(function(){this.setFailed()},{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0})}(r):u.push(function(e){return e.c3progress(function(e){return function(){return o(this,e,i)}}(n),{max:100,dur:c3config.Clocker-2,async:1,width:60,swf:!0,async:1,hwf:!0})}(r));for(var a=0,f=u.length;a<f;a++)0==a&&u[a].start(),a<f-1?u[a].finishEvent.push(function(e){return function(t){e.start()}}(u[a+1])):u[a].finishEvent.push(function(t){return function(t){e.readyForNext()}}(u[a]));return r}return t}},o=function(e,t,n){c3.service.getTaskProgress(t).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(t).expand("TaskParameters").query(function(t){e.setFailed(t.data.ResultDescription),Utility.logTaskError(t.data)}):"SUCCESSFUL"==i[0].toUpperCase()?(e.setValue(100),n.data.errorLabel!=null&&n.data.errorLabel.text(0)):e.setValue(parseInt(i[1]))})},u=this;this.onInit=function(){e.disableCancel(),e.disableNext(),e.disableBack(),a()},this.onViewAppear=function(){},this.reload=function(){a()};var a=function(){i=[],u.ld1=new loadingWindow,u.ld1.show();var t={description:e.TenantEntity.Description,purpose:e.TenantEntity.Purpose,companyDatabase:{companyName:e.TenantEntity.TenantName,name:e.TenantEntity.DatabaseName},serviceUnit:{id:e.TargetServiceUnit.ID},licenseFile:{id:n.LicenseFile_ID},extensions:function(){var t=[];if(e.Extensions&&e.Extensions.length>0)for(var n=0;n<e.Extensions.length;n++){var r=e.Extensions[n].ID;e.Extensions[n].SelectedID!=null&&(r=e.Extensions[n].SelectedID),t.push({id:r})}return t}(),users:function(){var t=[];if(e.TenantUsers&&e.TenantUsers.length>0)for(var n=0;n<e.TenantUsers.length;n++)t.push({status:e.TenantUsers[n].Status,systemUsername:e.TenantUsers[n].Name,sboUsername:e.TenantUsers[n].B1UserName,isSuperSBOUser:Boolean(e.TenantUsers[n].IsSuperUser),isPowerSBOUser:Boolean(e.TenantUsers[n].IsPowerUser),licenseModules:function(){var t=[];if(e.TenantUsers[n].LicenseModules)for(var r=0;r<e.TenantUsers[n].LicenseModules.length;r++)t.push({type:e.TenantUsers[n].LicenseModules[r]});else t=null;return t}()});return t}()},o={targetServiceUnit:{name:e.TargetServiceUnit.Name,status:e.TargetServiceUnit.Status,purpose:e.TargetServiceUnit.Purpose,version:e.TargetServiceUnit.Version},tenant:{customerName:n.Customer_Name,name:e.TenantEntity.TenantName,dbname:e.TenantEntity.DatabaseName,purpose:e.TenantEntity.Purpose,description:e.TenantEntity.Description},users:function(){var t=[];if(e.TenantUsers&&e.TenantUsers.length>0)for(var n=0;n<e.TenantUsers.length;n++)for(var r=0;r<e.UsersCache.length;r++)if(e.TenantUsers[n].Name==e.UsersCache[r].SystemUser){t.push(e.UsersCache[r]);break}return t}(),extension:e.Extensions},a=null;e.StagingServiceUnit&&e.StagingServiceUnit.ID>0&&(a=e.StagingServiceUnit.ID,o.stagingServiceUnit={name:e.StagingServiceUnit.Name,status:e.StagingServiceUnit.Status,purpose:e.StagingServiceUnit.Purpose,version:e.StagingServiceUnit.Version}),tenantManager.DuplicateTeant(n.ID,t,a,o,{success:function(t){if(t.d&&t.d.DuplicateTenantAsync>0){i.push({Name:e.TenantEntity.TenantName,TaskID:t.d.DuplicateTenantAsync});var n=t.d.DuplicateTenantAsync;c3.service.getTasks().filter("ID eq "+n).query(function(t){if(t.data!=null&&t.data.length>0){if(t.data[0].Status=="WaitingForApproval"){var n=$("<div>").attr("class","rar_request_panel").css({"line-height":"25px",margin:"0 20px 0 20px"}).append(localizedString("VARREQUEST_NEEDAPPROVE"));u._container.html(n),e.readyForNext(),u.ld1.close();return}var i=$("<div>").css({"float":"left"});r=i.gridview({delegate:s}),r.rowSelectedEvent.push(function(){}),u._container.append(i),r.show(),f(0)}})}else{var o=$("<div>").css({"float":"left"});r=o.gridview({delegate:s}),r.rowSelectedEvent.push(function(){}),u._container.append(o),r.show(),u.ld1.close(),r.reload()}},error:function(e){u.ld1.close(),Utility.logError(e.response)}})}},c3selectStagingSU4Duplicate.step1=function(){function a(){var t="stagingSU_toolbar",n=$("<section>").attr({id:t}).addClass("tools"),r=$("<input>").attr({value:"New",type:"button",id:"su_btnNew"}).css("float","left");r.click(function(){var t=new c3huwizard(e);t.show()}),c3.hasPermission([permissionItems.operator])&&n.append(r);var i=$("<a>").attr({href:"#"}).addClass("refresh").css("float","right");return i.click(function(){f()}),n.append(i),e.toolbar=n,n}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=localizedString("TNTUPGRADE_STEP_STAGINGSU_TLT"),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"13%"},{name:"Name",description:localizedString("HOSTUNIT"),type:"text",width:"20%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"20%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"20%"},{name:"NoOfTenant",description:localizedString("TNTUPGRADE_LABEL_NOOFTNT"),type:"text",width:"27%"}],r=arguments[0]||{},i=arguments[1]||{},s=null,o=[],u={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 230},getTip:function(){return Utility.CreateTipBoard(localizedString("TNTUPGRADE_STAGINGSU_EMPTY_TIP"),null,!0)},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}else if(this.colName=="NoOfTenant"){var n=$("<span>").text("0");return c3.service.getTenants().filter("ServiceUnit/ID eq "+this.data.ID).count().query(function(e){e.data&&e.data.length>0&&$(n).text(e.data)}),n}return e}};this.onInit=function(){var t=$("<div>").html(localizedString("DUPTNT_WIZARD_STEP1_CONFIRM"));t.attr("class","tip_panel"),e._container.append(t);var n=$("<div>").css({visibility:"hidden","float":"left",width:"500px"}),r=$("<div>");s=r.gridview({delegate:u}),s.rowSelectedEvent.push(function(){var e=this.index,t=o[e];i.StagingServiceUnit=t}),s.show();var l=$("<input>").attr({type:"radio",name:"useStaging",selected:!0});l.click(function(){i.StagingServiceUnit=null,$(n).css("visibility","hidden"),e.msgPanel.text(""),h.slideDown("normal")});var c=$("<div>").css({padding:"13px 0 2px 5px","float":"left"}).append(l).append("&nbsp;&nbsp;&nbsp;").append($("<span>").append(localizedString("TNTUPGRADE_STEP_STAGINGSU_USESTAGING")));e._container.append(c),e.useTargetSURadio=l;var h=$("<div>").attr("class","msg_panel"),p=$("<div>").attr("class","msg_label"),d=$("<div>").attr("class","msg_label"),v=$("<div>").attr("class","msg_label"),m=$("<div>").attr("class","msg_label"),g=$("<div>").attr("class","msg_label");e._container.append(h),h.append(p).append(d).append(v).append(m).append(g),p.append($("<div>").attr("class","msg_label_tlt").append(localizedString("HOSTUNIT")+" :")).append($("<div>").attr({"class":"msg_label_val",title:i.TargetServiceUnit.Name}).append(i.TargetServiceUnit.Name)),d.append($("<div>").attr("class","msg_label_tlt").append(localizedString("COLUMN_VERSION")+" :")).append($("<div>").attr({"class":"msg_label_val",title:i.TargetServiceUnit.Version}).append(i.TargetServiceUnit.Version)),v.append($("<div>").attr("class","msg_label_tlt").append(localizedString("MISC_STATUS")+" :")).append($("<div>").attr({"class":"msg_label_val",title:i.TargetServiceUnit.Status}).append(i.TargetServiceUnit.Status)),m.append($("<div>").attr("class","msg_label_tlt").append(localizedString("COLUMN_PURPOSE")+" :")).append($("<div>").attr({"class":"msg_label_val",title:i.TargetServiceUnit.Purpose}).append(i.TargetServiceUnit.Purpose)),g.append($("<div>").attr("class","msg_label_tlt").append(localizedString("MISC_DESCRIPTION")+" :")).append($("<div>").attr({"class":"msg_label_val",title:i.TargetServiceUnit.Description}).append(i.TargetServiceUnit.Description)),e.suMsg=h;var y=$("<input>").attr({type:"radio",name:"useStaging"});y.click(function(){e.msgPanel.text(""),$(n).css("visibility","visible"),h.slideUp("normal"),i.StagingServiceUnit=null,f()});var b=$("<div>").css({padding:"2px 0 13px 5px","float":"left"}).append(y).append("&nbsp;&nbsp;&nbsp;").append($("<span>").append(localizedString("TNTUPGRADE_STEP_STAGINGSU_NOTUSE")));e._container.append(b),e.useStagingSURadio=y,n.append(a()),n.append(r),e._container.append(n),e.msgPanel=$("<span>").css({color:"Red","float":"left","padding-top":"10px"}).text(""),e._container.append(e.msgPanel)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(t){e.useStagingSURadio.attr("checked")==1&&f()})},this.onViewAppear=function(){e.useTargetSURadio.click()};var f=function(){o=[],c3.service.getHostingUnits().expand("SoftwareRepository, LicenseServer, CommonDatabase/DatabaseInstance").filter("Status eq 'Online' and Version eq '"+i.TargetServiceUnit.Version+"' and Purpose eq 'Staging'").query(function(e){for(var t=0;t<e.data.length;t++)e.data[t].CommonDatabase.DatabaseInstance.ServerType==i.TargetServiceUnit.CommonDatabase.DatabaseInstance.ServerType&&o.push(e.data[t]);s.reload()})};this.reload=function(){f()}},c3syncException.step1=function(){function o(){t=i,e.reload()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=null,t=[],n={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"PresentationServerName",description:localizedString("RES_PRESENTATION_SERVER"),type:"text",width:"30%"},{name:"ClientVersion",description:localizedString("RESPOOL_PS_COLUMN_SLDCLIENTVR"),type:"text",width:"30%"},{name:"ServiceUnitName",description:localizedString("HOSTUNIT"),type:"text",width:"20%"},{name:"ServiceUnitVersion",description:localizedString("COLUMN_VERSION"),type:"text",width:"20%"}]},getRowCount:function(){return t.length},getRow:function(e){return t[e]},getGridHeight:function(){return 328}},r=arguments[0]||{},i=arguments[1]||[],s=this;this.onInit=function(){var t=$("<div>").css({padding:"5px 0 15px 0","float":"left","line-height":"18px"}).html(localizedString("PS_SYNC_EXCEPTION")),r=$("<div>").css({"float":"left"});e=r.gridview({delegate:n}),s._container.append(t).append(r),e.show()},this.onViewAppear=function(){o()}},c3unregisterPSWarning.step1=function(){function o(){t=i,e.reload()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=null,t=[],n={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"Name",description:localizedString("RTVSBOSESSION_COLUMN_CLTNAME"),type:"text",width:"44%"},{name:"Username",description:localizedString("ATVCONCTION_POPWIN_COLUMN_USERNAME"),type:"text",width:"44%"}]},getRowCount:function(){return t.length},getRow:function(e){return t[e]},getGridHeight:function(){return 300}},r=arguments[0]||{},i=arguments[1]||[],s=this;this.onInit=function(t){var r;t==0?r=$("<div>").css({padding:"5px 0 15px 0","float":"left"}).html(localizedString("UNREG_PS_WARNING")):r=$("<div>").css({padding:"5px 0 15px 0","float":"left"}).html(localizedString("UNREG_BAS_WARNING"));var i=$("<div>").css({"float":"left"});e=i.gridview({delegate:n}),s._container.append(r).append(i),e.show()},this.onViewAppear=function(){o()}};var c3newSUViaRef=function(){"use strict";var e=function(t){this.base=c3.wizard;var n=function(){t&&t.reload()};this.base(n);var r=localizedString("SUCREATION_REF_WIZARD_TITLE"),i=localizedString("SUCREATION_REF_WIZARD_WELCOME_TITLE"),s=localizedString("SUCREATION_REF_WIZARD_WELCOME_DESC"),o=[localizedString("SUCREATION_REF_WIZARD_STEP1_NAME"),localizedString("SUCREATION_REF_WIZARD_STEP2_NAME"),localizedString("SUCREATION_REF_WIZARD_STEP3_NAME"),localizedString("SUCREATION_REF_WIZARD_BAS_NAME"),localizedString("WIZARD_HU_OPERATOR_CREDENTS"),localizedString("SUCREATION_REF_WIZARD_STEP4_NAME"),localizedString("SUCREATION_REF_WIZARD_STEP5_NAME"),localizedString("SUCREATION_REF_WIZARD_STEP6_NAME")],u=[localizedString("SUCREATION_REF_WIZARD_STEP1_TLT"),localizedString("SUCREATION_REF_WIZARD_STEP2_TLT"),localizedString("SUCREATION_REF_WIZARD_STEP3_TLT"),localizedString("SUCREATION_REF_WIZARD_BAS_TLT"),localizedString("WIZARD_HU_OPERATOR_CREDENTS"),localizedString("SUCREATION_REF_WIZARD_STEP4_TLT"),localizedString("SUCREATION_REF_WIZARD_STEP5_TLT"),localizedString("SUCREATION_REF_WIZARD_STEP6_TLT")],a=[localizedString("SUCREATION_REF_WIZARD_STEP1_SUBTLT"),localizedString("SUCREATION_REF_WIZARD_STEP2_SUBTLT"),localizedString("SUCREATION_REF_WIZARD_STEP3_SUBTLT"),localizedString("SUCREATION_REF_WIZARD_BAS_TLT"),localizedString("WIZARD_HU_OPERATOR_CREDENTS_INFO"),localizedString("SUCREATION_REF_WIZARD_STEP4_SUBTLT"),localizedString("SUCREATION_REF_WIZARD_STEP5_SUBTLT"),localizedString("SUCREATION_REF_WIZARD_STEP6_SUBTLT")],f=this,l=arguments[1]||{};this.onInit=function(){this.steps=[new e.basicSetting(this,l),new e.infraComponents(this,l),new e.prensentationServers(this,l),new e.browserAccessServers(this,l),new e.operatorCredentials(this),new e.deployAddons(this,l),new e.review(this,l),new e.processCreation(this,l)]},this.getId=function(){return"createSU_ref"},this.getTitle=function(){return r},this.getWelcomeScreen=function(){return c3.wizard.welcomeTemplate(i,s)},this.getStepCount=function(){return o.length},this.getStepTitle=function(e){return u[e]},this.getStepSubtitle=function(e){return a[e]},this.getStepName=function(e){return o[e]},this.getStep=function(e){return this.steps[e]},this.finish=function(){t&&t.reload()}};return e.basicSetting=function(){function s(t){t.css("border","1px solid red"),e.html(txt),e.css({left:t.offset().left,top:t.offset().top+20}),$("body").append(e),window.setTimeout(function(){$(window).bind("mousedown keydown",function(){o(t)})},500),t.bind("focus",function(){t.css("border","0")})}function o(t){$(window).unbind("mousedown keydown",function(){o(t)}),e.remove()}function a(){t.ServiceUnitEntity.Name=r.Name.Value.val(),t.ServiceUnitEntity.Version=r.Version.Value.find("option:selected").html(),t.ServiceUnitEntity.InstallationPackageRepository={ID:parseInt(r.Version.Value.val())},t.ServiceUnitEntity.Purpose=r.Type.Value.val(),t.ServiceUnitEntity.Description=r.Description.Value.val(),t.ServiceUnitEntity.Status="Online"}function f(){c3.service.getSWRepositories().query(function(e){r.Version.Value.find("option").remove();var t=null;for(var i=0;i<e.data.length;i++){if(n.SoftwareRepository.HANAenabled===!0&&e.data[i].HANAenabled!==!0)continue;if(n.SoftwareRepository.HANAenabled!==!0&&e.data[i].HANAenabled===!0)continue;e.data[i].Version>n.Version?t=$("<option>").append(e.data[i].Version).attr({value:e.data[i].ID}):e.data[i].Version==n.Version&&(t=$("<option>").append(e.data[i].Version).attr({value:e.data[i].ID,selected:"selected"})),r.Version.Value.append(t)}})}this.base=c3.module,this.base(),this._container=$("<div>");var e=$("<div>").addClass("error_bubble"),t=arguments[0]||{},n=arguments[1]||{},r={Name:{Name:localizedString("WIZARD_HU_HUNAME"),Value:new textbox({isRequired:!0,maxlength:100,pattern:"[^'#&]*"})},Version:{Name:localizedString("MISC_VERSION"),Value:new dropdownlist({isRequired:!0})},Type:{Name:localizedString("COLUMN_PURPOSE"),Value:new dropdownlist({isRequired:!0})},Description:{Name:localizedString("MISC_DESCRIPTION"),Value:$("<textarea>")}},i=new function(){var e=[],t=function(){function l(e){e.data.length>0?r.Name.Value.showErrorMessage(textbox.validityMessages.duplicated):h()}function c(){h()}function h(){a(),e.length>0&&e[0]()}var t=r[localizedString("MISC_DESCRIPTION")].Value.val(),n=r.Name.Value.checkValidity()&&r.Version.Value.checkValidity()&&r.Type.Value.checkValidity();t.length>0?t.indexOf("'")>=0||t.indexOf("#")>=0||t.indexOf("&")>=0?(n=n&&!1,s(r[localizedString("MISC_DESCRIPTION")].Value,this._container)):(n=n&&!0,$(r[localizedString("MISC_DESCRIPTION")].Value),o(r[localizedString("MISC_DESCRIPTION")].Value)):(n=n&&!0,$(r[localizedString("MISC_DESCRIPTION")].Value),o(r[localizedString("MISC_DESCRIPTION")].Value));if(r.Type.Value.val()==="Trial"){var i=r.Version.Value.find("option:selected").text(),u=i.split("."),f=parseInt(u.join(""));f<"88207007"&&(n=n&&!1,r.Version.Value.showErrorMessage(localizedString("VERSION_CHECK_4TRIALSU")))}n&&c3.service.getHostingUnits().filter(String.format("Name eq '{0}'",encodeURI(r.Name.Value.val()))).query({success:l,error:c})};this.validEvent=e,this.checkValidity=t};this.validator=i,t.ServiceUnitEntity={},this.onInit=function(){this._container.append(u),i.validEvent.push(a),l()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.SoftwareRepositories,function(e){f()})};var u=function(){var e=$("<div>");for(var t in r){var n=Utility.CreateRow(r[t].Name,r[t].Value);e.append(n)}return e};this.onViewAppear=function(){};var l=function(){f(),r.Type.Value.find("option").remove(),r.Type.Value.append($("<option>"));var e=c3.service.getHUPurposeValues();c3.service.getHUPurposeValues(function(e){var t=null;for(var n=0;n<e.data.length;n++)e.data[n]!="Staging"&&e.data[n]!="Trial"&&(t=$("<option>").val(e.data[n]),t.append(e.data[n]),r.Type.Value.append(t))})}},e.infraComponents=function(){function u(e,t){e!=null&&t!=null&&$(e).find("option").each(function(e,n){$(n).val()!=t?$(n).removeAttr("selected"):$(n).attr("selected",!0)})}function a(){n.ServiceUnitEntity.LicenseServer={ID:r.LicenseServer.ID,Name:r.LicenseServer.Name},n.ServiceUnitEntity.DBServerInstance={ID:t.MSSql.Value.val(),Name:t.MSSql.Value.find("option:selected").text()},n.ServiceUnitEntity.SharedFolder={ID:t.SharedFolder.Value.val(),Name:t.SharedFolder.Value.find("option:selected").text()},n.ServiceUnitEntity.B1iServer={ID:t.B1i.Value.val(),Name:t.B1i.Value.find("option:selected").text()},n.ServiceUnitEntity.Mailer={ID:t.Mailer.Value.val(),Name:t.Mailer.Value.find("option:selected").text()},n.ServiceUnitEntity.TenantsStorage={ID:t.TenantsStorage.Value.val(),Name:t.TenantsStorage.Value.find("option:selected").text()},n.ServiceUnitEntity.PackageRepositoty={ID:t.ImplRepository.Value.val(),Name:t.ImplRepository.Value.find("option:selected").text()},n.ServiceUnitEntity.CompanyTemplateRepositoty={ID:t.CompanyTemplateRepository.Value.val(),Name:t.CompanyTemplateRepository.Value.find("option:selected").text()},n.ServiceUnitEntity.SBOCommon={ID:null,Name:"SBO-COMMON"}}function c(){c3.service.getDBServerInstances().filter("Status eq 'Online' and LifeCycleStatus eq 'Running'").expand("Machine,CommonDatabases").query(function(e){t.MSSql.Value.find("option").remove(),t.MSSql.Value.append($("<option>")),t.MSSql.Value.append($("<option>").val("new").append(localizedString("DROPDOWNLIST_NEWOPTION")));for(var i=0;i<e.data.length;i++)if(e.data[i].Machine){var s=e.data[i].CommonDatabases.results;if(s.length>0)continue;if(isHANA(e.data[i].ServerType)&&r.SoftwareRepository.HANAenabled!==!0)continue;if(!isHANA(e.data[i].ServerType)&&r.SoftwareRepository.HANAenabled===!0)continue;var o=$("<option>").attr({value:e.data[i].ID}).text(e.data[i].Name);n.ServiceUnitEntity&&n.ServiceUnitEntity.DBServerInstance&&n.ServiceUnitEntity.DBServerInstance.ID==e.data[i].ID&&o.attr({selected:"selected"}),t.MSSql.Value.append(o)}})}function h(){c3.service.getSharedFolders().query(function(e){t.SharedFolder.Value.find("option").remove(),t.SharedFolder.Value.append($("<option>"));var r=null;for(var i=0;i<e.data.length;i++)r=$("<option>").attr({value:e.data[i].ID}).text(e.data[i].URI),n.ServiceUnitEntity&&n.ServiceUnitEntity.SharedFolder&&n.ServiceUnitEntity.SharedFolder.ID==e.data[i].ID&&r.attr({selected:"selected"}),t.SharedFolder.Value.append(r)})}function p(){c3.service.getB1iServers().query(function(e){t.B1i.Value.find("option").remove(),t.B1i.Value.append($("<option>")),c3.service.getHostingUnits().expand("IntegrationComponent").query(function(r){for(var i=0;i<e.data.length;i++){var s=e.data[i].ID,o=e.data[i].URL,u=!1;for(var a=0;a<r.data.length;a++)if(r.data[a].IntegrationComponent&&s==r.data[a].IntegrationComponent.ID){u=!0;break}if(!u){var f=$("<option>").attr({value:s}).text(o);n.ServiceUnitEntity&&n.ServiceUnitEntity.B1iServer&&n.ServiceUnitEntity.B1iServer.ID==s&&f.attr({selected:"selected"}),t.B1i.Value.append(f)}}})})}function d(){c3.service.getMailerServices().query(function(e){t.Mailer.Value.find("option").remove(),t.Mailer.Value.append($("<option>")),c3.service.getHostingUnits().expand("Mailer").query(function(r){for(var i=0;i<e.data.length;i++){var s=e.data[i].ID,o=e.data[i].Name,u=!1;for(var a=0;a<r.data.length;a++)if(r.data[a].Mailer&&s==r.data[a].Mailer.ID){u=!0;break}if(!u){var f=$("<option>").attr({value:s}).text(o);n.ServiceUnitEntity&&n.ServiceUnitEntity.Mailer&&n.ServiceUnitEntity.Mailer.ID==s&&f.attr({selected:"selected"}),t.Mailer.Value.append(f)}}})})}function v(){c3.service.getTenantsStorages().query(function(e){t.TenantsStorage.Value.find("option").remove(),t.TenantsStorage.Value.append($("<option>"));var r=null;for(var i=0;i<e.data.length;i++)r=$("<option>").text(e.data[i].URI).attr({value:e.data[i].ID}),n.ServiceUnitEntity&&n.ServiceUnitEntity.TenantsStorage&&n.ServiceUnitEntity.TenantsStorage.ID==e.data[i].ID&&r.attr({selected:"selected"}),t.TenantsStorage.Value.append(r)})}function m(){c3.service.getImplementationRepositories().filter("Status eq 'Available' and Reseller eq null").query(function(e){t.ImplRepository.Value.find("option").remove(),t.ImplRepository.Value.append($("<option>"));var r=null;for(var i=0;i<e.data.length;i++)r=$("<option>").text(e.data[i].URI).attr({value:e.data[i].ID}),n.ServiceUnitEntity&&n.ServiceUnitEntity.PackageRepositoty&&n.ServiceUnitEntity.PackageRepositoty.ID==e.data[i].ID&&r.attr({selected:"selected"}),t.ImplRepository.Value.append(r)})}function g(){c3.service.getCompanyTemplateRepositories().filter("Status eq 'Available' and Reseller eq null").query(function(e){t.CompanyTemplateRepository.Value.find("option").remove(),t.CompanyTemplateRepository.Value.append($("<option>"));var r=null;for(var i=0;i<e.data.length;i++)r=$("<option>").text(e.data[i].URI).attr({value:e.data[i].ID}),n.ServiceUnitEntity&&n.ServiceUnitEntity.CompanyTemplateRepositoty&&n.ServiceUnitEntity.CompanyTemplateRepositoty.ID==e.data[i].ID&&r.attr({selected:"selected"}),t.CompanyTemplateRepository.Value.append(r)})}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t={License:{Name:"* "+localizedString("WIZARD_HU_LIVSVR"),Value:(new textbox).attr({disabled:1})},MSSql:{Name:"* "+localizedString("WIZARD_HU_MSSQL"),Value:new dropdownlist({isRequired:!0,newHandler:function(){var t=new c3registerMSSql(e);t.show()}})},SBOCommon:{Name:"* "+localizedString("WIZARD_HU_SBOCOMMON"),Value:(new textbox).attr({disabled:1})},SharedFolder:{Name:"* "+localizedString("RES_SHARED_FOLDER_OPTION"),Value:new dropdownlist({isRequired:!0})},TenantsStorage:{Name:"* "+localizedString("RES_TENANTS_STORAGE"),Value:new dropdownlist({isRequired:!0})},B1i:{Name:localizedString("WIZARD_HU_B1I"),Value:new dropdownlist({isRequired:!1})},Mailer:{Name:localizedString("WIZARD_HU_MAILERSVC"),Value:new dropdownlist({isRequired:!1})},ImplRepository:{Name:localizedString("RES_SHARED_IMPL_REPOSITORY"),Value:new dropdownlist({isRequired:!1})},CompanyTemplateRepository:{Name:localizedString("RES_COMPANY_TEMPLATE_REPOSITORY"),Value:new dropdownlist({isRequired:!1})}},n=arguments[0]||{},r=arguments[1]||{};this.validator=new function(){var e=[],r=function(){a();var e=t.SharedFolder.Value.checkValidity()&&t.MSSql.Value.checkValidity()&&t.B1i.Value.checkValidity()&&t.Mailer.Value.checkValidity()&&t.TenantsStorage.Value.checkValidity()&&t.ImplRepository.Value.checkValidity()&&t.CompanyTemplateRepository.Value.checkValidity();if(!e)return!1;if(t["MSSql"].Value.val()=="new")return t.MSSql.Value.showErrorMessage(localizedString("VALIDITY_VALUEMISSSING")),!1;c3.service.getDBServerInstances(t.MSSql.Value.val()).expand("CommonDatabases").query(function(e){if(e.data&&e.data.CommonDatabases&&e.data.CommonDatabases.results&&e.data.CommonDatabases.results.length>0){var t=$("<div>");t.html(localizedString("SUCREATION_REF_WIZARD_STEP2_DELCOMDB_WARNING"));var r=MessageBox.show({msg:t,width:350,height:180,icon:MessageBoxIcon.WARNING,buttons:MessageBoxButton.CLOSE});return r.closeEvent.push(function(){return!1}),!1}n.next()})};this.checkValidity=r};var i=function(){c3.service.getHostingUnits().filter("SharedFolder/ID eq "+t.SharedFolder.Value.val()).query(function(e){e.data&&e.data.length>0?s(!1):s(!0)})},s=function(e){c3.service.getHostingUnits().filter("TenantsStorage/ID eq "+t.TenantsStorage.Value.val()).query(function(t){if(t.data&&t.data.length>0){var r=$("<div>");e?r.html(localizedString("SU_CREATION_TENANTSSTORAGE_CONFIRM")):r.html(localizedString("SU_CREATION_SHAREDFOLDER_CONFIRM")+"<br/>"+localizedString("SU_CREATION_TENANTSSTORAGE_CONFIRM"));var i=MessageBox.show({msg:r,width:350,height:180,icon:MessageBoxIcon.WARNING});i.yesEvent.push(function(){n.next()})}else if(!e){var r=$("<div>");r.html(localizedString("SU_CREATION_SHAREDFOLDER_CONFIRM"));var i=MessageBox.show({msg:r,width:350,height:150,icon:MessageBoxIcon.WARNING});i.yesEvent.push(function(){n.next()})}else n.next()})};this.onInit=function(){this._container.append(o());var e=$("<div>").append(localizedString("WIZARD_HU_OPT"));e.addClass("row"),e.css({position:"absolute",bottom:"4em"}),this._container.append(e),f()},this.reload=function(){c()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.DatabaseInstances,function(e){c()}),cometdManager.subscribe(sldEntitySet.SharedFolders,function(e){h()}),cometdManager.subscribe(sldEntitySet.IntegrationComponents,function(e){p()}),cometdManager.subscribe(sldEntitySet.Mailers,function(e){d()}),cometdManager.subscribe(sldEntitySet.TenantsStorages,function(e){v()}),cometdManager.subscribe(sldEntitySet.ImplementationRepositories,function(e){m()}),cometdManager.subscribe(sldEntitySet.CompanyTemplateRepositories,function(e){g()})};var o=function(){var n=$("<div>"),r=null;for(var i in t){r=Utility.CreateRow(t[i].Name,t[i].Value);if(i=="SharedFolder"||i=="TenantsStorage")t[i].Value.attr({id:i}),t[i].Value.bind("change",function(){var n=this;if($(n).val()==""){$(n).attr("id")=="SharedFolder"?e.CurrentSharedFolder="":e.CurrentTenantStorage="";return}e.lw_sf=new loadingWindow,e.lw_sf.show();var r="";$(n).attr("id")=="SharedFolder"?r="SharedFolder/ID eq "+t.SharedFolder.Value.val():r="TenantsStorage/ID eq "+t.TenantsStorage.Value.val(),c3.service.getHostingUnits().filter(r).query(function(t){e.lw_sf.close();if(t.data&&t.data.length>0){var r=$("<div>");$(n).attr("id")=="SharedFolder"?r.html(localizedString("SU_CREATION_SHAREDFOLDER_CONFIRM")):r.html(localizedString("SU_CREATION_TENANTSSTORAGE_CONFIRM"));var i=MessageBox.confirm({msg:r,width:380,height:150});i.yesEvent.push(function(){$(n).attr("id")=="SharedFolder"?e.CurrentSharedFolder=$(n).val():e.CurrentTenantStorage=$(n).val()}),i.noEvent.push(function(){$(n).attr("id")=="SharedFolder"?!e.CurrentSharedFolder||e.CurrentSharedFolder==null?u(n,""):u(n,e.CurrentSharedFolder):!e.CurrentTenantStorage||e.CurrentTenantStorage==null?u(n,""):u(n,e.CurrentTenantStorage)})}else $(n).attr("id")=="SharedFolder"?e.CurrentSharedFolder=$(n).val():e.CurrentTenantStorage=$(n).val()})});i==="TenantsStorage"&&r.css({"border-bottom":"1px solid #B1C0D3","padding-bottom":"10px","margin-bottom":"0"}),n.append(r),i!="License"&&i!="SBOCommon"&&t[i].Value.bind("change",function(){a()})}return n},f=function(){t.License.Value.val(r.LicenseServer.Name),t.SBOCommon.Value.val(localizedString("WIZARD_HU_SBOCOMMONCRT"))};this.onViewAppear=function(){l()};var l=function(){c(),h(),p(),d(),v(),m(),g()}},e.prensentationServers=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"name",description:localizedString("RESPOOL_PSSERVER_COLUMN_HOSTNAME"),type:"text",width:"25%"},{name:"ServerType",description:localizedString("MISC_TYPE"),type:"text",width:"12%"},{name:"SBOClientVersion",description:localizedString("SBOVERSION"),type:"text",width:"30%"},{name:"ServiceUnit",description:localizedString("HOSTUNIT"),type:"text",width:"21%"}],n=null,r=arguments[0]||{},i=arguments[1]||{};this.gridData=[],e.PSSessions=[],this.onInit=function(){var s=$("<div>"),o=$("<div>").addClass("tools");o.addClass("toolsbar");var u=$("<input>").attr({type:"button",value:localizedString("MISC_ADD")}).click(function(){var t=new c3registerPresServer(e);t.show()});o.append(u);var a=$("<div>"),f={getHeaderSpec:function(){return t},getRowCount:function(){return e.gridData.length},getRow:function(t){return e.gridData[t]},getGridHeight:function(){return 300},getTip:function(){return Utility.CreateTipBoard(localizedString("WIZARD_HU_PRESENTATION"),function(){var t=new c3registerPresServer(e);t.show()})},getDefaultSelectedIndex:function(){if(r.ServiceUnitEntity.PresentationServers!=null&&r.ServiceUnitEntity.PresentationServers.length>0){var e=[];for(var t=0;t<r.ServiceUnitEntity.PresentationServers.length;t++)e.push(r.ServiceUnitEntity.PresentationServers[t].Index);return e.length>0?e:-1}return-1},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}};f.HideCheckAll=!0,n=a.gridview({delegate:f,checkType:1}),n.rowCheckEvent.push(function(){var t=this,n=t.index,s=e.gridData[n],o=r.ServiceUnitEntity;o.PresentationServers||(o.PresentationServers=[],e.PSSessions=[]);var u=o.PresentationServers,a=e.PSSessions;if(!this.isChecked){s.Selected=!1;for(var c=0;c<u.length;c++)if(s.ID==u[c].ID){u.remove(c),a.remove(c);break}return}e.lw0=new loadingWindow,e.lw0.show();var f={ID:s.ID,Index:n},l={ID:s.ID,SBOClientID:s.SBOClientID,MachineID:s.MachineID,Name:s.name,Status:s.Status,SBOVersion:s.SBOClientVersion};if(s.SBOClientID>0&&o.Version!=s.SBOClientVersion){c3.service.getExtensionDeployments().expand("Extension/ExtensionValidities").filter("CommonDatabase/ID eq "+i.CommonDatabase.ID).query(function(n){var r=[];n.data&&n.data.length>0&&(r=c3.service.convertData(n.data));if(r.length>0)if(s.ServiceUnitID>0){var i=new c3extensionWarning4HighVersion(e,r,u,a,e.gridData,t);i.show(),e.lw0.close()}else{var o=MessageBox.show({msg:localizedString("SUCREATION_REF_WIZARD_STEP3_GONEXT_WARNING"),width:350,height:230,icon:MessageBoxIcon.WARNING});o.yesEvent.push(function(){u.push(f),a.push(l),s.Selected=!0,e.lw0.close()}),o.noEvent.push(function(){$(t.target).attr({checked:!1}),e.lw0.close()})}else u.push(f),a.push(l),s.Selected=!0,e.lw0.close()});return}u.push(f),a.push(l),s.Selected=!0,e.lw0.close()}),n.show(),s.append(o),s.append(a),this._container.append(s)},this.validator=new psValidator(e,r.ServiceUnitEntity,r.next),e.Next=function(){r.next()};var s=function(){r&&r.readyForNext&&r.readyForNext()};this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.PresentationServers,function(e){o()})};var o=function(){e.gridData=[],c3.service.getHostingUnits(i.ID).expand("PresentationServers/SBOClient, PresentationServers/Machine").query(function(t){if(t.data.PresentationServers&&t.data.PresentationServers.results&&t.data.PresentationServers.results.length>0)for(var r=0;r<t.data.PresentationServers.results.length;r++){var s=t.data.PresentationServers.results[r];e.gridData.push({name:s.Name,ID:s.ID,Status:s.Status,Description:s.Description,ServerType:s.ServerType,Selected:!1,SBOClientID:s.SBOClient==null?null:s.SBOClient.ID,SBOClientVersion:s.SBOClient==null?null:s.SBOClient.Version,MachineName:s.Machine.Hostname,MachineID:s.Machine.ID,ServiceUnit:i.Name,ServiceUnitID:i.ID})}c3.service.getPresentationServers().expand("Machine,SBOClient").filter("ServiceUnit eq null and Status eq 'Online'").query(function(t){var r=[];c3.service.getBrowserAccessServers().expand("Machine,SBOClient, ServiceUnit").filter("ServiceUnit ne null").query(function(i){if(i.data&&i.data.length>0)for(var s=0;s<i.data.length;s++)r.push({Name:i.data[s].Name,ID:i.data[s].ID,MachineName:i.data[s].Machine.Hostname,SUID:i.data[s].ServiceUnit.ID});for(var s=0;s<t.data.length;s++){var o=!1;for(var u=0;u<r.length;u++)if(r[u].MachineName==t.data[s].Machine.Hostname){o=!0;break}o==0&&e.gridData.push({name:t.data[s].Name,ID:t.data[s].ID,Status:t.data[s].Status,Description:t.data[s].Description,ServerType:t.data[s].ServerType,Selected:!1,SBOClientID:t.data[s].SBOClient==null?null:t.data[s].SBOClient.ID,SBOClientVersion:t.data[s].SBOClient==null?null:t.data[s].SBOClient.Version,MachineName:t.data[s].Machine.Hostname,MachineID:t.data[s].Machine.ID,ServiceUnit:null,ServiceUnitID:null})}c3.service.retrieveWorkstations().query(function(t){if(t.data&&t.data.length>0)for(var r=0;r<e.gridData.length;r++){var i=!1;for(var s=0;s<t.data.length>0;s++)if(t.data[s].Hostname==e.gridData[r].MachineName&&t.data[s].Status=="Available"){i=!0,e.gridData[r].SLDAgentStatus="Available";break}i||e.gridData.remove(r--)}else e.gridData=[];n.reload()})})})})};this.reload=function(){this.onViewAppear()},this.onViewAppear=function(){o()}},e.browserAccessServers=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"name",description:localizedString("RESPOOL_PSSERVER_COLUMN_HOSTNAME"),type:"text",width:"30%"},{name:"ServerType",description:localizedString("RESPOOL_BAS_COLUMN_SLDCLIENTDBTYPE"),type:"text",width:"20%"},{name:"SBOVersion",description:localizedString("SBOVERSION"),type:"text",width:"38%"}],n=null,r=arguments[0]||{},i=arguments[1]||{};this.gridData=[],e.BASessions=[],this.onInit=function(){var i=$("<div>"),s=$("<div>").addClass("tools");s.addClass("toolsbar");var o=$("<input>").attr({type:"button",value:localizedString("MISC_ADD")}).click(function(){var e=new c3registerBAServer(parent);e.show()});s.append(o);var u=$("<div>"),a={getHeaderSpec:function(){return t},getRowCount:function(){return e.gridData.length},getRow:function(t){return e.gridData[t]},getGridHeight:function(){return 300},getTip:function(){return Utility.CreateTipBoard(localizedString("WIZARD_HU_BASERVER"),function(){var e=new c3registerBAServer(parent);e.show()})},getDefaultSelectedIndex:function(){if(r.ServiceUnitEntity.BrowserAccessServers!=null&&r.ServiceUnitEntity.BrowserAccessServers.length>0){var e=[];for(var t=0;t<r.ServiceUnitEntity.BrowserAccessServers.length;t++)e.push(r.ServiceUnitEntity.BrowserAccessServers[t].Index);return e.length>0?e:-1}return-1},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}};n=u.gridview({delegate:a,checkType:1}),n.rowCheckEvent.push(function(){var t=this,n=t.index,i=e.gridData[n],s=r.ServiceUnitEntity;s.BrowserAccessServers||(s.BrowserAccessServers=[],e.BASessions=[]);var o=s.BrowserAccessServers,u=e.BASessions;if(this.isChecked){var a={ID:i.ID,Index:n},f={ID:i.ID,SBOClientID:i.SBOClientID,MachineID:i.MachineID,Name:i.name,Status:i.Status,SBOVersion:i.SBOVersion};o.push(a),u.push(f),i.Selected=!0}else{i.Selected=!1;for(var l=0;l<o.length;l++)if(i.ID==o[l].ID){o.remove(l),u.remove(l);break}}}),n.show(),i.append(s),i.append(u),this._container.append(i)},this.validator=new function(){this.checkValidity=function(){(!r.ServiceUnitEntity.PresentationServers||r.ServiceUnitEntity.PresentationServers.length<=0)&&(!r.ServiceUnitEntity.BrowserAccessServers||r.ServiceUnitEntity.BrowserAccessServers.length<=0)?r.disableStep(4):r.enableStep(4),r.next()}},e.Next=function(){r.next()};var s=function(){r&&r.readyForNext&&r.readyForNext()};this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.B1WebServers,function(e){o()})};var o=function(){c3.service.getBrowserAccessServers().expand("Machine,SBOClient").filter("ServiceUnit eq null and Status eq 'Online'").query(function(t){e.gridData=[];var n=[];c3.service.getPresentationServers().expand("Machine,SBOClient,ServiceUnit").filter("ServiceUnit ne null").query(function(r){if(r.data&&r.data.length>0)for(var i=0;i<r.data.length;i++)n.push({Name:r.data[i].Name,ID:r.data[i].ID,MachineName:r.data[i].Machine.Hostname,SUID:r.data[i].ServiceUnit.ID});for(var i=0;i<t.data.length;i++){var s=!1;for(var o=0;o<n.length;o++)if(n[o].MachineName==t.data[i].Machine.Hostname){s=!0;break}s==0&&e.gridData.push({name:t.data[i].Name,ID:t.data[i].ID,Status:t.data[i].Status,Description:t.data[i].Description,Selected:!1,SBOClientID:t.data[i].SBOClient==null?null:t.data[i].SBOClient.ID,SBOVersion:t.data[i].SBOClient==null?null:t.data[i].SBOClient.Version,ServerType:t.data[i].SBOClient==null?null:t.data[i].SBOClient.ServerType,MachineName:t.data[i].Machine.Hostname,MachineID:t.data[i].Machine.ID})}})})};this.reload=function(){this.onViewAppear()},this.onViewAppear=function(){o()}},e.operatorCredentials=function(){function u(){var e=this.checked}function a(n){n.css("border","1px solid red"),e.html(t),e.css({left:n.offset().left,top:n.offset().top+20}),$("body").append(e),window.setTimeout(function(){$(window).bind("mousedown keydown",function(){f(n)})},500),n.bind("focus",function(){n.css("border","0")})}function f(t){$(window).unbind("mousedown keydown",function(){f(t)}),e.remove()}function c(){var e={UserName:s.PS_NAME.Value.val(),Password:s.PS_PASS.Value.val()};r.ServiceUnitEntity.ClientAgentServiceAccount=e}this.base=c3.module,this.base(),this._container=$("<div>");var e=$("<div>").addClass("error_bubble"),t=localizedString("VALIDITY_PATTERNMISMATCH"),n=$("<input>").attr({name:"UseCredentsForBoth",type:"checkbox",editable:!0,checked:!1}).click(u),r=arguments[0]||{},i=arguments[1]||{},s={PS_NAME:{Name:localizedString("MISC_USERNAME"),Value:new textbox({isRequired:!0,pattern:"([0-9a-zA-Z-_.]){1,}"})},PS_PASS:{Name:localizedString("MISC_PASSWORD"),Value:new textbox({isRequired:!0,type:"password"})}},o=new function(){var e=[],t=function(){function i(){c(),e.length>0&&e[0]()}var t=s.PS_NAME.Value.val(),n=s.PS_PASS.Value.val(),r={success:function(){i()}};suManager.validateClientAgentServiceAccount({userName:t,password:n},r)};this.validEvent=e,this.checkValidity=t};this.validator=o,this.onInit=function(){this._container.append(l),o.validEvent.push(c)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.SoftwareRepositories,function(e){})};var l=function(){var e=$("<div>");for(var t in s){var n=Utility.CreateRow(s[t].Name,s[t].Value);e.append(n)}return e};this.onViewAppear=function(){(!r.ServiceUnitEntity.PresentationServers||r.ServiceUnitEntity.PresentationServers.length<=0)&&(!r.ServiceUnitEntity.BrowserAccessServers||r.ServiceUnitEntity.BrowserAccessServers.length<=0)&&r.next()}},e.deployAddons=function(){function f(){var t="serviceunit_addons_toolbar",n=$("<section>").attr({id:t}).addClass("tools");return e.toolbar=n,n}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t="deploy_add_ons",n=[{name:"Extension_Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"30%"},{name:"Extension_Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"20%"},{name:"Extension_Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"25%"},{name:"Extension_Type",description:localizedString("MISC_TYPE"),type:"text",width:"25%"}],r=arguments[0]||{},i=arguments[1]||null;r.SelectedAddOns=[];var s=null,o=[],u={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return o.length},getRow:function(e){return o[e]},shouldExpandOnRowSelect:function(){return!1},getGridHeight:function(){return 300},getCell:function(){var e=null;return e}},a=$("<input>").attr({type:"button",value:"Refresh"}).css({"float":"right"}).click(function(){l()});this.onInit=function(){var t=$("<div>");u.HideCheckAll=!0,s=t.gridview({delegate:u,checkType:1}),s.rowCheckEvent.push(function(){var t=this.index,n=o[t];if(this.isChecked){if(n.Support!=1){if(e.compatibilityCheckSwitch!=1||n.Type!="LightAddOn"&&n.Type!="LightAddOnMV"){var s=new c3extensionNotSupportWarning(e,n.Extension_ExtensionValidities,this.target,r.SelectedAddOns,{ID:n.Extension_ID,Name:n.Extension_Name,Type:n.Extension_Type,Version:n.Extension_Version,Vendor:n.Extension_Vendor});s.show();return}var i=MessageBox.prompt({msg:localizedString("TNT_DUP_EXT_WARNING"),width:350,height:150,title:localizedString("AVAILABLE_STATUS_WARNING")});$(this.target).attr({checked:!1});return}var u=!1;for(var a=0;a<r.SelectedAddOns.length;a++)if(r.SelectedAddOns[a].ID==n.Extension_ID){u=!0;break}u||r.SelectedAddOns.push({ID:n.Extension_ID,Name:n.Extension_Name,Type:n.Extension_Type,Version:n.Extension_Version,Vendor:n.Extension_Vendor})}else for(var a=0;a<r.SelectedAddOns.length;a++)r.SelectedAddOns[a].ID==n.Extension_ID&&r.SelectedAddOns.remove(a--)}),s.show(),e._container.append(t),e._container.append($("<div>").attr("width","100%").append(a)),l()};var l=function(){o=[],r.SelectedAddOns=[],c3.service.getExtensionCompatibilityCheckSwitch({success:function(t){t&&t.d.IsExtensionCompatibilityCheckOn?e.compatibilityCheckSwitch=!0:e.compatibilityCheckSwitch=!1,c3.service.getExtensionDeployments().expand("Extension/ExtensionValidities").filter("Extension/IsBuiltIn eq false and CommonDatabase/ID eq "+i.CommonDatabase.ID+" and (Extension/Type eq 'AddOn' or Extension/Type eq 'LightAddOn' or Extension/Type eq 'LightAddOnMV') ").query(function(e){e.data&&e.data.length>0&&(o=c3.service.convertData(e.data));var t=[];r.SelectedAddOns=[];for(var n=0;n<o.length;n++){o[n].Type=o[n].Extension_Type,o[n].Extension_Type=convertToDisplayExtensionType(o[n].Extension_Type);if(o[n].Extension_ExtensionValidities&&o[n].Extension_ExtensionValidities.length>0)for(var i=0;i<o[n].Extension_ExtensionValidities.length;i++){var a=o[n].Extension_ExtensionValidities[i];if(a.FromVersion<=r.ServiceUnitEntity.Version&&a.ToVersion>=r.ServiceUnitEntity.Version){r.SelectedAddOns.push({ID:o[n].Extension_ID,Name:o[n].Extension_Name,Type:o[n].Extension_Type,Version:o[n].Extension_Version,Vendor:o[n].Extension_Vendor}),t.push(n),o[n].Support=!0;break}}else r.SelectedAddOns.push({ID:o[n].Extension_ID,Name:o[n].Extension_Name,Type:o[n].Extension_Type,Version:o[n].Extension_Version,Vendor:o[n].Extension_Vendor}),t.push(n),o[n].Support=!0}u.getDefaultSelectedIndex=function(){return t==[]?-1:t},s.reload()})}})};e.reload=function(){l()}},e.review=function(){function c(){s=[];if(r.ServiceUnitEntity.PresentationServers&&r.ServiceUnitEntity.PresentationServers.length>0)for(var e=0;e<r.ServiceUnitEntity.PresentationServers.length;e++)for(var t=0;t<r.steps[2].gridData.length;t++)if(r.ServiceUnitEntity.PresentationServers[e].ID==r.steps[2].gridData[t].ID){s.push(r.steps[2].gridData[t]);break}s.length>0?self.table.css("display","block"):self.table.css("display","none"),a.reload(),r.SelectedAddOns.length>0?(o=r.SelectedAddOns,self.extTable.css("display","block")):self.extTable.css("display","none"),u.reload()}function h(e,t){var r=$("<div>").addClass("row"),i=$("<div>").append(e);return r.append(i),n.push(i),r}this.base=c3.module,this.base(),this._container=$("<div>");var e=[localizedString("WIZARD_HU_HUSETTINGS"),localizedString("WIZARD_HU_SWRESOURCE"),localizedString("WIZARD_HU_PSERVER"),localizedString("SUCREATION_REF_WIZARD_STEP5_ADDOD_TLT")],t=[[localizedString("WIZARD_HU_HUNAME"),localizedString("MISC_TYPE"),localizedString("MISC_VERSION"),localizedString("MISC_DESCRIPTION")],[localizedString("WIZARD_HU_LIVSVR"),localizedString("WIZARD_HU_MSSQL"),localizedString("WIZARD_HU_B1I"),localizedString("WIZARD_HU_MAILERSVC"),localizedString("RES_SHARED_FOLDER_OPTION"),localizedString("RES_TENANTS_STORAGE"),localizedString("RES_SHARED_IMPL_REPOSITORY"),localizedString("SU_LABEL_CPYTEMPREP")],[""],[""]],n=[],r=arguments[0]||{},i=arguments[1]||{},s=[],o=[],u=null,a=null,f={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"name",description:localizedString("RESPOOL_PSSERVER_COLUMN_HOSTNAME"),type:"text",width:"30%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"58%"}]},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 150},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],e=new statusControl(t)}return e}},l={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"30%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"20%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"25%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"25%"}]},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 150}};this.onInit=function(){var n=$("<div>").addClass("review"),r=$("<div>");a=r.gridview({delegate:f}),a.show(),self.table=r;var i=$("<div>");u=i.gridview({delegate:l}),u.show(),self.extTable=i;for(var s=0;s<e.length;s++){var o=$("<div>").append(e[s]).addClass("blockHeader"),c=$("<div>").append(o).addClass("block");for(var p=0;p<t[s].length;p++){var d=$("<div>");2==s&&0==p&&c.append(r),3==s&&0==p&&c.append(i),t[s][p]&&c.append(h(t[s][p]+": "))}n.append(c)}this._container.append(n)},this.onViewAppear=function(){n[0].text(n[0].html().split(":")[0]+": "+r.ServiceUnitEntity.Name),n[1].text(n[1].html().split(":")[0]+": "+r.ServiceUnitEntity.Purpose),n[2].text(n[2].html().split(":")[0]+": "+r.ServiceUnitEntity.Version),n[3].text(n[3].html().split(":")[0]+": "+r.ServiceUnitEntity.Description),n[4].text(n[4].html().split(":")[0]+": "+r.ServiceUnitEntity.LicenseServer.Name),n[5].text(n[5].html().split(":")[0]+": "+r.ServiceUnitEntity.DBServerInstance.Name),n[6].text(n[6].html().split(":")[0]+": "+r.ServiceUnitEntity.B1iServer.Name),n[7].text(n[7].html().split(":")[0]+": "+r.ServiceUnitEntity.Mailer.Name),n[8].text(n[8].html().split(":")[0]+": "+r.ServiceUnitEntity.SharedFolder.Name),n[9].text(n[9].html().split(":")[0]+": "+r.ServiceUnitEntity.TenantsStorage.Name),n[10].text(n[10].html().split(":")[0]+": "+r.ServiceUnitEntity.PackageRepositoty.Name),n[11].text(n[11].html().split(":")[0]+": "+r.ServiceUnitEntity.CompanyTemplateRepositoty.Name),c(),r&&r.readyForNext&&r.readyForNext()}},e.processCreation=function(){function l(){e.ld1=new loadingWindow,e.ld1.show(),u=[],i.SoftwareRepository&&i.SoftwareRepository.SQLenabled==1?r.ServiceUnitEntity.ServerType=ServerType.MSSQL_SERVER:i.SoftwareRepository&&i.SoftwareRepository.HANAenabled==1?r.ServiceUnitEntity.ServerType=ServerType.HANA_SERVER:r.ServiceUnitEntity.ServerType="",suManager.createServiceUnitViaReference(r.ServiceUnitEntity,i,r.SelectedAddOns,{success:function(e){u.push({Name:r.ServiceUnitEntity.Name,TaskID:e.d.CreateServiceUnitAsync}),c(0)},error:function(t){u.push({Name:r.ServiceUnitEntity.Name,TaskID:-1}),o.reload(),e.ld1.close()}})}function c(t){var n=[];s[t]={},s[t].getRow=function(e){return n[e]},s[t].getRowCount=function(){return n.length},s[t].getCell=function(){if(this.colName=="Result"){var e=this.data.TaskID,t=$("<div>"),n=this,r=this.row,i=[];e==0?function(e){e.c3progress(function(){this.setFailed()},{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0})}(t):i.push(function(t){return t.c3progress(function(e){return function(){return f(this,e,n)}}(e),{max:100,dur:c3config.Clocker-2,width:60,swf:!0,async:1,hwf:!0})}(t));for(var s=0,o=i.length;s<o;s++)0==s&&i[s].start(),s<o-1&&i[s].finishEvent.push(function(e){return function(t){e.start()}}(i[s+1]));return t}return null},c3.service.getSubTask(u[0].TaskID).query(function(t){n=[];if(t.data&&t.data.length>0)for(var r=0;r<t.data.length;r++)n.push({Name:t.data[r].Description,TaskID:t.data[r].ID});e.ld1.close(),o.reload()})}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t="Upgrade",n=[{name:"Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"60%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"40%"}],r=arguments[0]||{},i=arguments[1]||null,s=[],o=null,u=[],a={needExport:function(){return!1},disableSort:function(){return!0},getHeaderSpec:function(){return n},getRowCount:function(){return u.length},getRow:function(e){return u[e]},getGridHeight:function(){return 342},getSubDelegate:function(e){return s[e]},getCell:function(){if(this.colName=="Result"){var e=this.data.TaskID,t=this.data.ID,n=$("<div>"),i=this,s=this.row,o=[];e<=0?function(e){e.c3progress(function(){this.setFailed()},{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0})}(n):o.push(function(t){return t.c3progress(function(e){return function(){return f(this,e,i)}}(e),{max:100,dur:c3config.Clocker-2,width:60,swf:!0,async:1,hwf:!0})}(n));for(var u=0,a=o.length;u<a;u++)0==u&&o[u].start(),u<a-1?o[u].finishEvent.push(function(e){return function(t){e.start()}}(o[u+1])):o[u].finishEvent.push(function(e){return function(e){r&&r.readyForNext&&r.readyForNext()}}(o[u]));return n}return null}},f=function(e,t,n){c3.service.getTaskProgress(t).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(t).expand("TaskParameters").query(function(t){e.setFailed(t.data.ResultDescription),Utility.logTaskError(t.data)}):"SUCCESSFUL"==i[0].toUpperCase()?(e.setValue(100),n.data.errorLabel!=null&&n.data.errorLabel.text(0)):e.setValue(parseInt(i[1]))})};this.onInit=function(){var t=$("<div>");o=t.gridview({delegate:a}),o.rowSelectedEvent.push(function(){var e=this.index,t=u[e]}),o.show(),e._container.append(t),r.disableCancel(),r.disableNext(),r.disableBack(),l()}},e}();c3extensionNotSupportWarning.step1=function(){function o(){t=i,e.reload()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=null,t=[],n={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"FromVersion",description:localizedString("MISC_FROM"),type:"text",width:"50%"},{name:"ToVersion",description:localizedString("MISC_TO"),type:"text",width:"50%"}]},getRowCount:function(){return t.length},getRow:function(e){return t[e]},getGridHeight:function(){return 270}},r=arguments[0]||{},i=arguments[1]||[],s=this;this.onInit=function(){var t=$("<div>").attr("class","warningDiv").html(localizedString("EXTENSION_STEP_COFIRM_VALIDITY_MSG")),r=$("<div>").css({"float":"left"});e=r.gridview({delegate:n}),s._container.append(t).append(r),e.show()},this.onViewAppear=function(){o()}},c3changeSystemUser.step1=function(){function i(){n.data=[],operatorManager.getOperators(function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++){var i=e[t].domainUserName;i&&i.length>0&&i.length<8?i=i.substring(0,8):i=null,n.data.push({ID:e[t].id,SystemUsername:e[t].domainUserName,Status:e[t].status,B1Username:i,IsOperator:!0,IsPowerUser:!0,PowerUser:!1,SuperUser:!1})}n.select.find("option").remove();for(var t=0;t<n.data.length;t++)n.data[t].SystemUsername==r.Name?(n.select.append($("<option>").attr("selected",!0).val(n.data[t].ID).append(n.data[t].SystemUsername)),s()):n.select.append($("<option>").val(n.data[t].ID).append(n.data[t].SystemUsername)),n.select.change(function(){o($(this).val())})})}function s(){for(var e=0;e<n.data.length;e++)n.data[e].SystemUsername==r.Name&&(n.data[e].IsOperator?n.isSuperUser.removeAttr("disabled"):n.isSuperUser.attr({disabled:!0}));r.IsPowerUser?n.isPowerUser.attr("checked",!0):n.isPowerUser.attr("checked",!1),r.IsSuperUser?(n.isSuperUser.attr("checked",!0),n.isPowerUser.attr({checked:!0,disabled:!0})):(n.isSuperUser.attr("checked",!1),n.isPowerUser.removeAttr("disabled"))}function o(e){for(var t=0;t<n.data.length;t++)if(n.data[t].ID==e){if(n.data[t].SystemUsername==r.Name){s();return}n.data[t].IsOperator?n.isSuperUser.attr("checked",!1).removeAttr("disabled"):n.isSuperUser.attr({disabled:!0,checked:!1}),n.isPowerUser.attr("checked",!1).removeAttr("disabled");break}}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=arguments[1]||[],n=this;n.data=[];var r=arguments[2]||{};this.onInit=function(){var e=$("<div>").css({padding:"5px 0 20px 0","float":"left"}).html(localizedString("CGSYSUSER_WIN_TIPMSG")),t=$("<div>").attr({"class":"chrome2"}).css({width:"100%",height:"35px"}),r=$("<select>").css({width:"150px","float":"left"});n.select=r,t.append($("<span>").css({"float":"left","padding-right":"5px"}).text(localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER")+" :")).append(r);var i=$("<div>").attr({"class":"chrome2"}).css({width:"100%",height:"35px"}),s=$("<input>").attr({type:"checkbox"}).css("float","left"),o=$("<input>").attr({type:"checkbox"}).css("float","left");n.isPowerUser=s,n.isSuperUser=o,i.append(o).append($("<span>").css({"float":"left","padding-right":"70px"}).text(localizedString("B1_SUPERUSER"))).append(s).append($("<span>").css({"float":"left","padding-right":"5px",width:"68px","text-align":"right"}).text(localizedString("B1_POWERUSER"))),n.isSuperUser.click(function(){$(this).attr("checked")==1?n.isPowerUser.attr({checked:!0,disabled:!0}):n.isPowerUser.removeAttr("disabled")});var u=$("<div>").css({width:"100%","padding-top":"5px",color:"red"});n.errorMsg=u,n._container.append(e).append(t).append(i).append(u)},this.onViewAppear=function(){i()}},function(){"use strict";var e=function(){function p(){var e=$("<div>").addClass("licenseRow");e.append($("<div>").append(localizedString("RES_VIEWLIC_LICFILE")).addClass("rowName"));var t=$("<input>").attr({type:"file",name:"LicenseContent",size:"30"});return e.append($("<div>").append(t).addClass("rowValue")),n.hide(),e.append(n),e}this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=$("<div>"),n=$("<img>").attr({src:c3Icon.Failed}),r=arguments[0]||{},i=null,s=[],o=[],u=-1,a={getHeaderSpec:function(){return[{name:"InstallationNumber",description:localizedString("COLUMN_INSTALL_NO")+" / "+localizedString("WIZARD_TENANT_LIVMDL"),type:"text",width:"50%"},{name:"LicenseServer_Name",description:localizedString("CUSTOMERCREATION_LABEL_SERVERNAME")+" / "+localizedString("WIZARD_TENANT_AVINUM"),type:"text",width:"50%"}]},getRowCount:function(){return s.length},getRow:function(e){return s[e]},getGridHeight:function(){return 260},getSubDelegate:function(e){return f[e]},getDefaultSelectedIndex:function(){return u},shouldExpandOnRowSelect:function(){return!1}},f=[];this.import=function(){var t={success:function(e){r.controller.reload(),r.close(),n.attr({src:c3Icon.Success,title:""})},error:function(e){var t=localizedString("CUSTOMERCREATION_LABEL_UPLOADING");e&&(t=retriveErrorMessage(e.responseText)),n.attr({src:c3Icon.Failed,title:t})}},i=function(i){if(!i){e.iptStatus.attr("src",c3Icon.Failed).css("display","inline"),alert(localizedString("IMPORTLICFILE_IMPORTERROR_INVALIDLICFILE"));return}c3.service.parseLicenseFile(i,{error:function(){n.attr("src",c3Icon.Failed).css("display","inline")},success:function(s){if(!(s.d&&s.d.results&&s.d.results.length>0)){n.attr("src",c3Icon.Failed).css("display","inline"),alert(localizedString("IMPORTLICFILE_IMPORTERROR_INVALIDLICFILE"));return}var u=!1;for(var a=0;a<o.length;a++)if(s.d.results[0].InstallationNumber==o[a].InstallationNumber){u=!0;var f=s.d.results[s.d.results.length-1];s.d.results.remove(s.d.results.length-1),c3.service.getLicenseFiles().filter("InstallationNumber eq '"+o[a].InstallationNumber+"'").query(function(e){if(e.data&&e.data.length>0){var t=e.data[0];c3.service.getLicenseModulesByLicenseFileId(t.ID).query(function(e){if(e.data&&e.data.length>0){var t=new c3importLicenseFileConfimation(r,e.data,s.d.results,i);t.finishEvent.push(function(){n.attr("src",c3Icon.Success).css("display","inline")}),t.onClose.push(function(){n.css("display","none")}),t.show()}})}});return}u||importLicenseFile(e.getContainer().find("input[type=file]")[0],t)}})},s=e.getContainer().find("input[type=file]"),u=!1;for(var a=0;a<s.length;a++)s[a].files&&s[a].files.length&&s[a].files[0].size>0&&getLicenseFileContent(s[a],i);u&&(n.attr({src:c3Icon.Loading}),n.show())};var l=function(){c3.service.getLicenseFiles(undefined).expand("LicenseServer").query(function(e){s=[],f=[];var t=c3.service.convertData(e.data);o=t;var n=0;for(var r=0,u=o.length;r<u;r++)s.push(o[r]),c(n),n++;i.reload()})};this.loadLicenseFile=l;var c=function(e){var t=[];f.push({}),f[e].getHeaderSpec=function(){return[{name:"Description",description:localizedString("COLUMN_INSTALL_NO"),type:"text",width:"50%"},{name:"Available",description:localizedString("COLUMN_SYS_NO"),type:"text",width:"50%"}]},f[e].getRow=function(e){return function(t){return e[t]}}(t),f[e].getRowCount=function(e){return function(){return e.length}}(t),f[e].loadSubData=function(e,n){c3.service.getLicenseModulesByLicenseFileId(e.ID).query(function(e){if(null!=e.data&&0<e.data.length)for(var r=0;r<e.data.length;r++)t.push(e.data[r]);n()})}};this.onInit=function(){t.append(p());var n=$("<div>").css({"margin-top":"15px"});i=n.gridview({delegate:a}),i.rowSelectedEvent.push(function(){this.data&&this.data.ID&&(r.CustomerEntity.InstallationNumber=this.data.InstallationNumber,u=this.index),nextBtnCheck()});var s=$("<div>").append(t).append("<br>").append(n);e._container.append(s),i.show()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.LicenseFiles,function(t){e.loadLicenseFile()})},this.onViewAppear=function(){l()};var h={checkValidity:function(){var t=e._container.parent(".main"),n=t.find("#withoutLicenseTip");return n&&n.hide(),!0}};this.validator=h};window.c3importLicFileForReseller=function(t){var n=!1,r=[],i=new e(this),s={getActionButtonText:function(){return localizedString("DATAFORM_IMPORT")},validator:i.validator};this.controller=t,this.base=c3.dialog,this.base(s),this.suIds=r,this.view=i;var o=this,u=arguments[0]||undefined;this.onInit=function(){this.view.onInit(),this.content=this.view.getContainer()},this.onViewAppear=function(){this.view.onViewAppear()},this.getId=function(){return"assignlictoreseller"},this.getTitle=function(){return localizedString("RESPOOL_LICSERVER_BTN_IMPORTFILE")},this.finish=function(){this.view.import()},this.onClose.push(function(){u&&n&&u.reload()})}}(),c3extensionWarning4HighVersion.step1=function(){function o(){t=i,e.reload()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=null,t=[],n={needExport:function(){return!1},getHeaderSpec:function(){return[{name:"Extension_Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"30%"},{name:"Extension_Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"20%"},{name:"Extension_Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"25%"},{name:"Extension_Type",description:localizedString("MISC_TYPE"),type:"text",width:"25%"}]},getRowCount:function(){return t.length},getRow:function(e){return t[e]},getGridHeight:function(){return 300}},r=arguments[0]||{},i=arguments[1]||[],s=this;this.onInit=function(){var t=$("<div>").css({padding:"5px 0 15px 0","float":"left"}).html(localizedString("SUCREATION_REF_WIZARD_STEP3_SELECTPS_TIPMSG")),r=$("<div>").css({"float":"left"});e=r.gridview({delegate:n}),s._container.append(t).append(r),e.show()},this.onViewAppear=function(){o()}},c3registerStorage4Reseller.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t="",n=arguments[0]||{},r=arguments[1]||{};this.onInit=function(){var t=$("<div>"),n=$("<div>").attr("class","row"),o=$("<input>").attr({id:"registerImpl4Reseller",type:"radio",name:"registerRadio"});e.implRadio=o,e.implRadio.click(function(){i()}),n.append(o),n.append($("<label>").css({width:"180px",display:"inline-block"}).append(localizedString("RES_SHARED_IMPL_REPOSITORY_LF")));var u=$("<select>").css("width","200px");e.implSelect=u,n.append(u);var a=$("<div>").attr("class","row"),f=$("<input>").attr({id:"registerCompany4Reseller",type:"radio",name:"registerRadio"});e.companyRadio=f,e.companyRadio.click(function(){s()}),a.append(f),a.append($("<label>").css({width:"180px",display:"inline-block"}).append(localizedString("RES_COMPANY_TEMPLATE_REPOSITORY")));var l=$("<select>").css("width","200px");e.companySelect=l,a.append(l);var c=$("<div>").attr("class","row").css({color:"Red","padding-top":"10px"});e.msgPanel=c;if(r!=null&&r.length>0)for(var h=0;h<r.length;h++)r[h].Type==localizedString("RES_SHARED_IMPL_REPOSITORY_LF")?e.implRadio.attr("disabled",!0):r[h].Type==localizedString("RES_COMPANY_TEMPLATE_REPOSITORY")&&e.companyRadio.attr("disabled",!0);t.append(n),t.append("<br/>"),t.append(a),t.append(c),e._container.append(t)},this.onViewAppear=function(){};var i=function(){var t=new loadingWindow;t.show(),c3.service.getImplementationRepositories().filter("Status eq 'Available' and Reseller eq null").query(function(n){c3.service.getHostingUnits().filter("ImplementationRepository/ID ne null").expand("ImplementationRepository").query(function(i){e.implSelect.find("option").remove(),e.implSelect.append($("<option>"));if(r!=null&&r.length>0)for(var s=0;s<r.length;s++){r[s].Type==localizedString("RES_SHARED_IMPL_REPOSITORY_LF")&&e.implSelect.append($("<option>").text(r.Path).attr({value:r.ID,selected:!0}));break}var o=null;for(var s=0;s<n.data.length;s++)if(i.data==null||i.data.length==0)o=$("<option>").text(n.data[s].URI).attr({value:n.data[s].ID}),e.implSelect.append(o);else{var u=!1;for(var a=0;a<i.data.length;a++)if(i.data[a].ImplementationRepository.ID>0&&n.data[s].ID==i.data[a].ImplementationRepository.ID){u=!0;break}u||(o=$("<option>").text(n.data[s].URI).attr({value:n.data[s].ID}),e.implSelect.append(o))}t.close()})})},s=function(){var t=new loadingWindow;t.show(),c3.service.getCompanyTemplateRepositories().filter("Status eq 'Available' and Reseller eq null").query(function(n){c3.service.getHostingUnits().filter("CompanyTemplateRepository/ID ne null").expand("CompanyTemplateRepository").query(function(i){e.companySelect.find("option").remove(),e.companySelect.append($("<option>"));if(r!=null&&r.length>0)for(var s=0;s<r.length;s++){r[s].Type==localizedString("RES_COMPANY_TEMPLATE_REPOSITORY")&&e.companySelect.append($("<option>").text(r.Path).attr({value:r.ID,selected:!0}));break}var o=null;for(var s=0;s<n.data.length;s++)if(i.data==null||i.data.length==0)o=$("<option>").text(n.data[s].URI).attr({value:n.data[s].ID}),e.companySelect.append(o);else{var u=!1;for(var a=0;a<i.data.length;a++)if(i.data[a].CompanyTemplateRepository.ID>0&&n.data[s].ID==i.data[a].CompanyTemplateRepository.ID){u=!0;break}u||(o=$("<option>").text(n.data[s].URI).attr({value:n.data[s].ID}),e.companySelect.append(o))}t.close()})})}},c3assignTaskAuthorization.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>");var e=this,t=localizedString(""),n=[{name:"TaskType",description:localizedString("RESELLER_CREATION_STEP3_COLUMN_OPT"),type:"text",width:"40%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"60%"}],r=arguments[0]||{},i=arguments[1]||{},s=null,o=[],u={needExport:function(){return!1},getHeaderSpec:function(){return n},getRowCount:function(){return o.length},getRow:function(e){return o[e]},getGridHeight:function(){return 230},getTip:function(){return Utility.CreateTipBoard(localizedString("TASKAUTH_ASSIGN_WIN_GRID_EPT"),null,null)},getCell:function(){return this.colName=="TaskType"?$("<span>").html(localizedString(this.data.TaskType.toUpperCase())):null}};this.onInit=function(){var t=$("<div>").css({padding:"5px 0 15px 0","float":"left"}).html(localizedString("TASKAUTH_ASSIGN_WIN_DESC"));e._container.append(t);var n=$("<div>").css({"float":"left"});s=n.gridview({delegate:u,checkType:1}),s.rowCheckEvent.push(function(){var e=this.index,t=o[e];r.TaskAuths==null&&(r.TaskAuths=[]);if(this.isChecked)r.TaskAuths.push(t);else{var n=-1;for(var i=0;i<r.TaskAuths.length;i++)if(t.ID==r.TaskAuths[i].ID){n=i;break}n>=0&&r.TaskAuths.remove(n)}}),s.show(),e._container.append(n)},this.onViewAppear=function(){a()};var a=function(){o=[],c3.service.getTaskTypes().query(function(e){c3.service.getTaskAuthorizations().filter("Group/ID eq "+i.Group.ID).expand("TaskType").query({success:function(t){var n=[];for(var r=0;r<e.data.length;r++)if(t.data!=null&&t.data.length>0){var i=!1;for(var u=0;u<t.data.length;u++)if(e.data[r].ID==t.data[u].TaskType.ID){i=!0;break}i||n.push({ID:e.data[r].ID,Description:e.data[r].Description,TaskType:e.data[r].TaskType})}else n.push({ID:e.data[r].ID,Description:e.data[r].Description,TaskType:e.data[r].TaskType});o=n,s.reload()},error:function(){s.reload()}})})};this.reload=function(){a()}},c3taskReview.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=this;e.gridView=null,e.gridData=[],e.gridDelegate={needExport:function(){return!1},getRowCount:function(){return e.gridData.length},getRow:function(t){return e.gridData[t]},getGridHeight:function(){return 150}};var t=arguments[0]||{},n=arguments[1]||null,r=arguments[2]||null,i=arguments[3]||null;this.onInit=function(){if(i.Task_Status=="Failed"){var t=$("<span>").css({width:"100%","font-weight":"bold",color:"Red",padding:"5px 0 5px 0",height:"30px"}).append(localizedString("LAB_TASKSTATUS")+": "+i.Task_Status),s=$("<span>").css({width:"100%","font-weight":"bold",color:"Red",padding:"5px 0 5px 0",height:"30px"}).append(localizedString("LAB_REASON")+": ");e._container.append(t).append("<br/>"),e._container.append(s),c3.service.getTasks(i.Task_ID).expand("TaskParameters").query(function(e){s.append("("+e.data.ErrorCode+") "+e.data.ResultDescription),s.attr("title",e.data.ResultDescription)})}if(r=="CreateTenant"){if(n!=null){var o=$("<span>").attr("class","reivew_panel_tlt").css("padding-top","5px").append(localizedString("CUSTOMER")),u=$("<div>").attr("class","review_panel"),a=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),f=$("<span>").attr({"class":"ele_value",title:n.customer.name}).append(n.customer.name),l=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_TYPE")}).append(localizedString("MISC_TYPE")),c=$("<span>").attr({"class":"ele_value",title:n.customer.type}).append(n.customer.type),h=$("<span>").attr({"class":"ele_tlt",title:localizedString("RES_LIC_INSTALLATION_NUM")}).append(localizedString("RES_LIC_INSTALLATION_NUM")),p=$("<span>").attr({"class":"ele_value",title:n.customer.installationNumber}).append(n.customer.installationNumber),d=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_STATUS")}).append(localizedString("MISC_STATUS")),v=$("<span>").attr({"class":"ele_value",title:n.customer.status}).append(n.customer.status);u.append($("<div>").attr({"class":"ele"}).append(a).append(f)),u.append($("<div>").attr({"class":"ele"}).append(l).append(c)),u.append($("<div>").attr({"class":"ele"}).append(h).append(p)),u.append($("<div>").attr({"class":"ele"}).append(d).append(v));var m=$("<span>").attr("class","reivew_panel_tlt").append(localizedString("HOSTUNIT")),g=$("<div>").attr("class","review_panel"),y=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),b=$("<span>").attr({"class":"ele_value",title:n.serviceunit.name}).append(n.serviceunit.name),w=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),E=$("<span>").attr({"class":"ele_value",title:n.serviceunit.purpose}).append(n.serviceunit.purpose),S=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_VERSION")}).append(localizedString("COLUMN_VERSION")),x=$("<span>").attr({"class":"ele_value",title:n.serviceunit.version}).append(n.serviceunit.version),T=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_STATUS")}).append(localizedString("MISC_STATUS")),N=$("<span>").attr({"class":"ele_value",title:n.serviceunit.status}).append(n.serviceunit.status);g.append($("<div>").attr("class","ele").append(y).append(b)),g.append($("<div>").attr("class","ele").append(w).append(E)),g.append($("<div>").attr("class","ele").append(S).append(x)),g.append($("<div>").attr("class","ele").append(T).append(N));var C=$("<span>").attr("class","reivew_panel_tlt").append(localizedString("TENANT")),k=$("<div>").attr("class","review_panel"),L=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),A=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.name}).append(n.tenantInfo.name),O=$("<span>").attr({"class":"ele_tlt",title:localizedString("TNT_COLUMN_DBNAME")}).append(localizedString("TNT_COLUMN_DBNAME")),M=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.dbname}).append(n.tenantInfo.dbname),_=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),D=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.purpose}).append(n.tenantInfo.purpose),P=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_CONTACTPERSON")}).append(localizedString("COLUMN_CONTACTPERSON")),H=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.contactPerson}).append(n.tenantInfo.contactPerson),B=$("<span>").attr({"class":"ele_tlt",title:localizedString("CUSTOMER_COLUMN_PHONE")}).append(localizedString("CUSTOMER_COLUMN_PHONE")),j=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.phone}).append(n.tenantInfo.phone),F=$("<span>").attr({"class":"ele_tlt",title:localizedString("CUSTOMER_COLUMN_EMAIL")}).append(localizedString("CUSTOMER_COLUMN_EMAIL")),I=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.email}).append(n.tenantInfo.email),q=$("<span>").attr({"class":"ele_tlt",title:localizedString("CUSTOMER_COLUMN_LOCATION")}).append(localizedString("CUSTOMER_COLUMN_LOCATION")),R=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.localSettings}).append(n.tenantInfo.localSettings),U=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_COA")}).append(localizedString("MISC_COA")),z=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.coa}).append(n.tenantInfo.coa),W=$("<span>").attr({"class":"ele_tlt",title:localizedString("TNTCREATION_COLUMN_BASELAN")}).append(localizedString("TNTCREATION_COLUMN_BASELAN")),X=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.baseLan}).append(n.tenantInfo.baseLan),V=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_DESC")}).append(localizedString("COLUMN_DESC")),J=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.description}).append(n.tenantInfo.description),K=$("<span>").attr({"class":"ele_tlt",title:localizedString("WIZARD_CPYDB_PCODE")}).append(localizedString("WIZARD_CPYDB_PCODE")),Q=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.pCode}).append(n.tenantInfo.pCode),G=$("<span>").attr({"class":"ele_tlt",title:localizedString("WIZARD_CPYDB_PNAME")}).append(localizedString("WIZARD_CPYDB_PNAME")),Y=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.pName}).append(n.tenantInfo.pName),Z=$("<span>").attr({"class":"ele_tlt",title:localizedString("WIZARD_CPYDB_PSUBTYPE")}).append(localizedString("WIZARD_CPYDB_PSUBTYPE")),et=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.pSubType}).append(n.tenantInfo.pSubType),tt=$("<span>").attr({"class":"ele_tlt",title:localizedString("WIZARD_CPYDB_PSUBNAME")}).append(localizedString("WIZARD_CPYDB_PSUBNAME")),nt=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.pNum}).append(n.tenantInfo.pNum),rt=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_FROM")}).append(localizedString("MISC_FROM")),it=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.pStartDate}).append(n.tenantInfo.pStartDate),st=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_TO")}).append(localizedString("MISC_TO")),ot=$("<span>").attr({"class":"ele_value",title:n.tenantInfo.pEndDate}).append(n.tenantInfo.pEndDate);n.tenantInfo.name!=null&&n.tenantInfo.name.length>0&&k.append($("<div>").attr("class","ele").append(L).append(A)),n.tenantInfo.dbname!=null&&n.tenantInfo.dbname.length>0&&k.append($("<div>").attr("class","ele").append(O).append(M)),n.tenantInfo.name!=null&&n.tenantInfo.name.length>0&&k.append($("<div>").attr("class","ele").append(L).append(A)),n.tenantInfo.purpose!=null&&n.tenantInfo.purpose.length>0&&k.append($("<div>").attr("class","ele").append(_).append(D)),n.tenantInfo.contactPerson!=null&&n.tenantInfo.contactPerson.length>0&&k.append($("<div>").attr("class","ele").append(P).append(H)),n.tenantInfo.phone!=null&&n.tenantInfo.phone.length>0&&k.append($("<div>").attr("class","ele").append(B).append(j)),n.tenantInfo.email!=null&&n.tenantInfo.email.length>0&&k.append($("<div>").attr("class","ele").append(F).append(I)),n.tenantInfo.localSettings!=null&&n.tenantInfo.localSettings.length>0&&k.append($("<div>").attr("class","ele").append(q).append(R)),n.tenantInfo.coa!=null&&n.tenantInfo.coa.length>0&&k.append($("<div>").attr("class","ele").append(U).append(z)),n.tenantInfo.baseLan!=null&&n.tenantInfo.baseLan.length>0&&k.append($("<div>").attr("class","ele").append(W).append(X)),n.tenantInfo.description!=null&&n.tenantInfo.description.length>0&&k.append($("<div>").attr("class","ele").append(V).append(J)),n.tenantInfo.pCode!=null&&n.tenantInfo.pCode.length>0&&k.append($("<div>").attr("class","ele").append(K).append(Q)),n.tenantInfo.pName!=null&&n.tenantInfo.pName.length>0&&k.append($("<div>").attr("class","ele").append(G).append(Y)),n.tenantInfo.pSubType!=null&&n.tenantInfo.pSubType.length>0&&k.append($("<div>").attr("class","ele").append(Z).append(et)),n.tenantInfo.pNum!=null&&n.tenantInfo.pNum.length>0&&k.append($("<div>").attr("class","ele").append(tt).append(nt)),n.tenantInfo.pStartDate!=null&&n.tenantInfo.pStartDate.length>0&&k.append($("<div>").attr("class","ele").append(rt).append(it)),n.tenantInfo.pEndDate!=null&&n.tenantInfo.pEndDate.length>0&&k.append($("<div>").attr("class","ele").append(st).append(ot));if(n.users!=null&&n.users.length>0){var ut=$("<span>").attr("class","reivew_panel_tlt").append(localizedString("TENANT_LICENSE_ASSIGN_TITLE")),at=$("<div>").css({"float":"left",width:"665px"});e.gridDelegate.getHeaderSpec=function(){return[{name:"SystemUser",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"20%"},{name:"UserCode",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"20%"},{name:"LicenseModulesString",description:localizedString("WIZARD_TENANT_LIVMDL"),type:"text",width:"60%"}]},e.gridView=at.gridview({delegate:e.gridDelegate}),e.gridView.show(),e.gridData=n.users,e.gridView.reload()}var ft=$("<div>").css({height:"400","overflow-y":"auto"});ft.append(o).append(u).append(m).append(g).append(C).append(k).append(ut).append(at),e._container.append(ft)}}else if(r=="CreateCustomer"){var ft=$("<div>").css({height:"400","overflow-y":"auto"}),o=$("<span>").attr("class","reivew_panel_tlt").css("padding-top","5px").append(localizedString("CUSTOMER")),u=$("<div>").attr("class","review_panel"),a=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),f=$("<span>").attr({"class":"ele_value",title:n.name}).append(n.name),l=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_TYPE")}).append(localizedString("MISC_TYPE")),c=$("<span>").attr({"class":"ele_value",title:n.type}).append(n.type),h=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_CONTACTPERSON")}).append(localizedString("COLUMN_CONTACTPERSON")),p=$("<span>").attr({"class":"ele_value",title:n.contactPerson}).append(n.contactPerson),d=$("<span>").attr({"class":"ele_tlt",title:localizedString("CUSTOMER_COLUMN_PHONE")}).append(localizedString("CUSTOMER_COLUMN_PHONE")),v=$("<span>").attr({"class":"ele_value",title:n.phone}).append(n.phone),lt=$("<span>").attr({"class":"ele_tlt",title:localizedString("CUSTOMER_COLUMN_EMAIL")}).append(localizedString("CUSTOMER_COLUMN_EMAIL")),ct=$("<span>").attr({"class":"ele_value",title:n.email}).append(n.email),ht=$("<span>").attr({"class":"ele_tlt",title:localizedString("CUSTOMER_COLUMN_LOCATION")}).append(localizedString("CUSTOMER_COLUMN_LOCATION")),pt=$("<span>").attr({"class":"ele_value",title:n.location}).append(n.location),dt=$("<span>").attr({"class":"ele_tlt",title:localizedString("CUSTOMER_COLUMN_COUNTRY")}).append(localizedString("CUSTOMER_COLUMN_COUNTRY")),vt=$("<span>").attr({"class":"ele_value",title:n.country}).append(n.country),mt=$("<span>").attr({"class":"ele_tlt",title:localizedString("TRIAL_COLUMN_INDUSTRY")}).append(localizedString("TRIAL_COLUMN_INDUSTRY")),gt=$("<span>").attr({"class":"ele_value",title:n.industry}).append(n.industry),yt=$("<span>").attr({"class":"ele_tlt",title:localizedString("CUSTOMERCREATION_LABEL_EMPLOYEECOUNT")}).append(localizedString("CUSTOMERCREATION_LABEL_EMPLOYEECOUNT")),bt=$("<span>").attr({"class":"ele_value",title:n.employeeCount}).append(n.employeeCount),wt=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_DESC")}).append(localizedString("COLUMN_DESC")),Et=$("<span>").attr({"class":"ele_value",title:n.description}).append(n.description),St=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_INSTALL_NO")}).append(localizedString("COLUMN_INSTALL_NO")),xt=$("<span>").attr({"class":"ele_value",title:n.installationNumber}).append(n.installationNumber);n.name!=null&&n.name.length>0&&u.append($("<div>").attr("class","ele").append(a).append(f)),n.type!=null&&n.type.length>0&&u.append($("<div>").attr("class","ele").append(l).append(c)),n.contactPerson!=null&&n.contactPerson.length>0&&u.append($("<div>").attr("class","ele").append(h).append(p)),n.phone!=null&&n.phone.length>0&&u.append($("<div>").attr("class","ele").append(d).append(v)),n.email!=null&&n.email.length>0&&u.append($("<div>").attr("class","ele").append(lt).append(ct)),n.location!=null&&n.location.length>0&&u.append($("<div>").attr("class","ele").append(ht).append(pt)),n.country!=null&&n.country.length>0&&u.append($("<div>").attr("class","ele").append(dt).append(vt)),n.industry!=null&&n.industry.length>0&&u.append($("<div>").attr("class","ele").append(mt).append(gt)),n.employeeCount!=null&&n.employeeCount>0&&u.append($("<div>").attr("class","ele").append(yt).append(bt)),n.description!=null&&n.description.length>0&&u.append($("<div>").attr("class","ele").append(wt).append(Et)),n.installationNumber!=null&&n.installationNumber.length>0&&u.append($("<div>").attr("class","ele").append(St).append(xt)),ft.append(o).append(u);if(n.users!=null&&n.users.length>0){var Tt=null,Nt=[],Ct={needExport:function(){return!1},getRowCount:function(){return Nt.length},getRow:function(e){return Nt[e]},getGridHeight:function(){return 150},getHeaderSpec:function(){return[{name:"systemUsername",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"40%"},{name:"status",description:localizedString("MISC_STATUS"),type:"text",width:"60%"}]}},ut=$("<span>").attr("class","reivew_panel_tlt").append(localizedString("ADDCUST_POP_NORMALUSER_TLT")),at=$("<div>").css({"float":"left",width:"661px"});Tt=at.gridview({delegate:Ct}),Tt.show(),Nt=n.users,Tt.reload(),ft.append(ut).append(at)}if(n.tenants!=null&&n.tenants.length>0){var kt=$("<span>").attr("class","reivew_panel_tlt").append(localizedString("TENANTS"));ft.append(kt);for(var Lt=0;Lt<n.tenants.length;Lt++){Lt!=0&&ft.append($("<div>").attr("class","seperate_div"));var At=$("<section>").attr("class","taskReview_section"),m=$("<span>").attr("class","taskReview_section_reivew_panel_tlt").append(localizedString("HOSTUNIT")),g=$("<div>").attr("class","review_panel"),y=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),b=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].serviceUnit.name}).append(n.tenants[Lt].serviceUnit.name),w=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),E=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].serviceUnit.purpose}).append(n.tenants[Lt].serviceUnit.purpose),S=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_STATUS")}).append(localizedString("MISC_STATUS")),x=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].serviceUnit.status}).append(n.tenants[Lt].serviceUnit.status);g.append($("<div>").attr("class","ele").append(y).append(b)),g.append($("<div>").attr("class","ele").append(w).append(E)),g.append($("<div>").attr("class","ele").append(S).append(x)),At.append(m).append(g);var Ot=$("<span>").attr("class","taskReview_section_reivew_panel_tlt").append(localizedString("TENANT")),Mt=$("<div>").attr("class","review_panel"),_t=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),Dt=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.companyName}).append(n.tenants[Lt].companyDatabase.companyName),Pt=$("<span>").attr({"class":"ele_tlt",title:localizedString("TNT_COLUMN_DBNAME")}).append(localizedString("TNT_COLUMN_DBNAME")),Ht=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.name}).append(n.tenants[Lt].companyDatabase.name),Bt=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),jt=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].purpose}).append(n.tenants[Lt].purpose),Ft=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_CONTACTPERSON")}).append(localizedString("COLUMN_CONTACTPERSON")),It=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].contactPerson}).append(n.tenants[Lt].contactPerson),qt=$("<span>").attr({"class":"ele_tlt",title:localizedString("CUSTOMER_COLUMN_PHONE")}).append(localizedString("CUSTOMER_COLUMN_PHONE")),Rt=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].phone}).append(n.tenants[Lt].phone),Ut=$("<span>").attr({"class":"ele_tlt",title:localizedString("CUSTOMER_COLUMN_EMAIL")}).append(localizedString("CUSTOMER_COLUMN_EMAIL")),zt=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].email}).append(n.tenants[Lt].email),Wt=$("<span>").attr({"class":"ele_tlt",title:localizedString("TNT_COLUMN_TRIALPRIOD")}).append(localizedString("TNT_COLUMN_TRIALPRIOD")),Xt=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.trialPeriod}).append(n.tenants[Lt].companyDatabase.trialPeriod),Vt=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_LOCATION")}).append(localizedString("MISC_LOCATION")),$t=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.localization}).append(n.tenants[Lt].companyDatabase.localization),Jt=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_COA")}).append(localizedString("MISC_COA")),Kt=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.chartOfAccounts}).append(n.tenants[Lt].companyDatabase.chartOfAccounts),Qt=$("<span>").attr({"class":"ele_tlt",title:localizedString("TNTCREATION_COLUMN_BASELAN")}).append(localizedString("TNTCREATION_COLUMN_BASELAN")),Gt=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.defaultLang}).append(n.tenants[Lt].companyDatabase.defaultLang),Yt=$("<span>").attr({"class":"ele_tlt",title:localizedString("WIZARD_CPYDB_PCODE")}).append(localizedString("WIZARD_CPYDB_PCODE")),Zt=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.periodCode}).append(n.tenants[Lt].companyDatabase.periodCode),en=$("<span>").attr({"class":"ele_tlt",title:localizedString("WIZARD_CPYDB_PNAME")}).append(localizedString("WIZARD_CPYDB_PNAME")),tn=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.periodName}).append(n.tenants[Lt].companyDatabase.periodName),nn=$("<span>").attr({"class":"ele_tlt",title:localizedString("WIZARD_CPYDB_PSUBTYPE")}).append(localizedString("WIZARD_CPYDB_PSUBTYPE")),rn=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.periodSubType}).append(n.tenants[Lt].companyDatabase.periodSubType),sn=$("<span>").attr({"class":"ele_tlt",title:localizedString("WIZARD_CPYDB_PSUBNAME")}).append(localizedString("WIZARD_CPYDB_PSUBNAME")),on=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.periodNumber}).append(n.tenants[Lt].companyDatabase.periodNumber),un=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_FROM")}).append(localizedString("MISC_FROM")),an=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.periodStartDate}).append(n.tenants[Lt].companyDatabase.periodStartDate),fn=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_TO")}).append(localizedString("MISC_TO")),ln=$("<span>").attr({"class":"ele_value",title:n.tenants[Lt].companyDatabase.periodEndDate}).append(n.tenants[Lt].companyDatabase.periodEndDate);n.tenants[Lt].companyDatabase.companyName!=null&&Mt.append($("<div>").attr("class","ele").append(_t).append(Dt)),n.tenants[Lt].companyDatabase.name!=null&&Mt.append($("<div>").attr("class","ele").append(Pt).append(Ht)),n.tenants[Lt].purpose!=null&&Mt.append($("<div>").attr("class","ele").append(Bt).append(jt)),n.tenants[Lt].contactPerson!=null&&n.tenants[Lt].contactPerson.length>0&&Mt.append($("<div>").attr("class","ele").append(Ft).append(It)),n.tenants[Lt].phone!=null&&n.tenants[Lt].phone.length>0&&Mt.append($("<div>").attr("class","ele").append(qt).append(Rt)),n.tenants[Lt].email!=null&&n.tenants[Lt].email.length>0&&Mt.append($("<div>").attr("class","ele").append(Ut).append(zt)),n.tenants[Lt].companyDatabase.trialPeriod!=null&&Mt.append($("<div>").attr("class","ele").append(Wt).append(Xt)),n.tenants[Lt].companyDatabase.localization!=null&&n.tenants[Lt].companyDatabase.localization.length>0&&Mt.append($("<div>").attr("class","ele").append(Vt).append($t)),n.tenants[Lt].companyDatabase.chartOfAccounts!=null&&Mt.append($("<div>").attr("class","ele").append(Jt).append(Kt)),n.tenants[Lt].companyDatabase.defaultLang!=null&&n.tenants[Lt].companyDatabase.defaultLang.length>0&&Mt.append($("<div>").attr("class","ele").append(Qt).append(Gt)),n.tenants[Lt].companyDatabase.periodCode!=null&&n.tenants[Lt].companyDatabase.periodCode.length>0&&Mt.append($("<div>").attr("class","ele").append(Yt).append(Zt)),n.tenants[Lt].companyDatabase.periodName!=null&&n.tenants[Lt].companyDatabase.periodName.length>0&&Mt.append($("<div>").attr("class","ele").append(en).append(tn)),n.tenants[Lt].companyDatabase.periodSubType!=null&&n.tenants[Lt].companyDatabase.periodSubType.length>0&&Mt.append($("<div>").attr("class","ele").append(nn).append(rn)),n.tenants[Lt].companyDatabase.periodNumber!=null&&Mt.append($("<div>").attr("class","ele").append(sn).append(on)),n.tenants[Lt].companyDatabase.periodStartDate!=null&&Mt.append($("<div>").attr("class","ele").append(un).append(an)),n.tenants[Lt].companyDatabase.periodEndDate!=null&&Mt.append($("<div>").attr("class","ele").append(fn).append(ln)),At.append(Ot).append(Mt);if(n.tenants[Lt].users!=null&&n.tenants[Lt].users.length>0){var cn=null,hn=[],pn={needExport:function(){return!1},getRowCount:function(){return hn.length},getRow:function(e){return hn[e]},getGridHeight:function(){return 150},getHeaderSpec:function(){return[{name:"systemUsername",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"20%"},{name:"userType",description:localizedString("COLUMN_USERTYPE"),type:"text",width:"20%"},{name:"sboUsername",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"20%"},{name:"licenseModulesString",description:localizedString("WIZARD_TENANT_LIVMDL"),type:"text",width:"40%"}]}},dn=$("<span>").attr("class","taskReview_section_reivew_panel_tlt").append(localizedString("RESPOOL_OPERATOR_TLT")),vn=$("<div>").css({"float":"left",width:"628px"});cn=vn.gridview({delegate:pn}),cn.show(),hn=n.tenants[Lt].users,cn.reload(),At.append(dn).append(vn)}ft.append(At)}}e._container.append(ft)}else if(r=="TenantUpgrade"){var ft=$("<div>").css({height:"400","overflow-y":"auto"}),C=$("<span>").attr("class","reivew_panel_tlt").css("padding-top","5px").append(localizedString("TENANT")),k=$("<div>").attr("class","review_panel"),a=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),f=$("<span>").attr({"class":"ele_value",title:n.tenant.name}).append(n.tenant.name),l=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_STATUS")}).append(localizedString("MISC_STATUS")),c=$("<span>").attr({"class":"ele_value",title:n.tenant.status}).append(n.tenant.status),h=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),p=$("<span>").attr({"class":"ele_value",title:n.tenant.purpose}).append(n.tenant.purpose),d=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_CUSTNAME")}).append(localizedString("MISC_CUSTNAME")),v=$("<span>").attr({"class":"ele_value",title:n.tenant.customerName}).append(n.tenant.customerName),lt=$("<span>").attr({"class":"ele_tlt",title:localizedString("TNT_COLUMN_DBNAME")}).append(localizedString("TNT_COLUMN_DBNAME")),ct=$("<span>").attr({"class":"ele_value",title:n.tenant.dbname}).append(n.tenant.dbname),ht=$("<span>").attr({"class":"ele_tlt",title:localizedString("TNTUPGRADE_CKDBNAME_GRID_COLUMN_NEWDBNAME")}).append(localizedString("TNTUPGRADE_CKDBNAME_GRID_COLUMN_NEWDBNAME")),pt=$("<span>").attr({"class":"ele_value",title:n.tenant.newDBName}).append(n.tenant.newDBName);k.append($("<div>").attr({"class":"ele"}).append(a).append(f)),k.append($("<div>").attr({"class":"ele"}).append(l).append(c)),k.append($("<div>").attr({"class":"ele"}).append(h).append(p)),k.append($("<div>").attr({"class":"ele"}).append(d).append(v)),k.append($("<div>").attr({"class":"ele"}).append(lt).append(ct)),n.tenant.newDBName!=null&&n.tenant.newDBName.length>0&&k.append($("<div>").attr({"class":"ele"}).append(ht).append(pt)),ft.append(C).append(k);var mn=$("<span>").attr("class","reivew_panel_tlt").css("padding-top","5px").append(localizedString("SOURCESU")),gn=$("<div>").attr("class","review_panel"),yn=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),bn=$("<span>").attr({"class":"ele_value",title:n.sourceServiceUnit.name}).append(n.sourceServiceUnit.name),wn=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_STATUS")}).append(localizedString("MISC_STATUS")),En=$("<span>").attr({"class":"ele_value",title:n.sourceServiceUnit.status}).append(n.sourceServiceUnit.status),Sn=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),xn=$("<span>").attr({"class":"ele_value",title:n.sourceServiceUnit.purpose}).append(n.sourceServiceUnit.purpose),Tn=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_VERSION")}).append(localizedString("COLUMN_VERSION")),Nn=$("<span>").attr({"class":"ele_value",title:n.sourceServiceUnit.version}).append(n.sourceServiceUnit.version);gn.append($("<div>").attr({"class":"ele"}).append(yn).append(bn)),gn.append($("<div>").attr({"class":"ele"}).append(wn).append(En)),gn.append($("<div>").attr({"class":"ele"}).append(Sn).append(xn)),gn.append($("<div>").attr({"class":"ele"}).append(Tn).append(Nn)),ft.append(mn).append(gn);var Cn=$("<span>").attr("class","reivew_panel_tlt").css("padding-top","5px").append(localizedString("TARGETSU")),kn=$("<div>").attr("class","review_panel"),Ln=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),An=$("<span>").attr({"class":"ele_value",title:n.targetServiceUnit.name}).append(n.targetServiceUnit.name),On=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_STATUS")}).append(localizedString("MISC_STATUS")),Mn=$("<span>").attr({"class":"ele_value",title:n.targetServiceUnit.status}).append(n.targetServiceUnit.status),_n=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),Dn=$("<span>").attr({"class":"ele_value",title:n.targetServiceUnit.purpose}).append(n.targetServiceUnit.purpose),Pn=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_VERSION")}).append(localizedString("COLUMN_VERSION")),Hn=$("<span>").attr({"class":"ele_value",title:n.targetServiceUnit.version}).append(n.targetServiceUnit.version);kn.append($("<div>").attr({"class":"ele"}).append(Ln).append(An)),kn.append($("<div>").attr({"class":"ele"}).append(On).append(Mn)),kn.append($("<div>").attr({"class":"ele"}).append(_n).append(Dn)),kn.append($("<div>").attr({"class":"ele"}).append(Pn).append(Hn)),ft.append(Cn).append(kn);if(n.stagingServiceUnit!=null&&n.stagingServiceUnit.name!=null){var Bn=$("<span>").attr("class","reivew_panel_tlt").css("padding-top","5px").append(localizedString("PRE_UPGRADE_STGSU_TLT")),jn=$("<div>").attr("class","review_panel"),Fn=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),In=$("<span>").attr({"class":"ele_value",title:n.stagingServiceUnit.name}).append(n.stagingServiceUnit.name),qn=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_STATUS")}).append(localizedString("MISC_STATUS")),Rn=$("<span>").attr({"class":"ele_value",title:n.stagingServiceUnit.status}).append(n.stagingServiceUnit.status),Un=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),zn=$("<span>").attr({"class":"ele_value",title:n.stagingServiceUnit.purpose}).append(n.stagingServiceUnit.purpose),Wn=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_VERSION")}).append(localizedString("COLUMN_VERSION")),Xn=$("<span>").attr({"class":"ele_value",title:n.stagingServiceUnit.version}).append(n.stagingServiceUnit.version);jn.append($("<div>").attr({"class":"ele"}).append(Fn).append(In)),jn.append($("<div>").attr({"class":"ele"}).append(qn).append(Rn)),jn.append($("<div>").attr({"class":"ele"}).append(Un).append(zn)),jn.append($("<div>").attr({"class":"ele"}).append(Wn).append(Xn)),ft.append(Bn).append(jn)}e._container.append(ft)}else if(r=="DuplicateTenant"){var ft=$("<div>").css({height:"400","overflow-y":"auto"}),Cn=$("<span>").attr("class","reivew_panel_tlt").css("padding-top","5px").append(localizedString("TARGETSU")),kn=$("<div>").attr("class","review_panel"),Ln=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),An=$("<span>").attr({"class":"ele_value",title:n.targetServiceUnit.name}).append(n.targetServiceUnit.name),On=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_STATUS")}).append(localizedString("MISC_STATUS")),Mn=$("<span>").attr({"class":"ele_value",title:n.targetServiceUnit.status}).append(n.targetServiceUnit.status),_n=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),Dn=$("<span>").attr({"class":"ele_value",title:n.targetServiceUnit.purpose}).append(n.targetServiceUnit.purpose),Pn=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_VERSION")}).append(localizedString("COLUMN_VERSION")),Hn=$("<span>").attr({"class":"ele_value",title:n.targetServiceUnit.version}).append(n.targetServiceUnit.version);kn.append($("<div>").attr({"class":"ele"}).append(Ln).append(An)),kn.append($("<div>").attr({"class":"ele"}).append(On).append(Mn)),kn.append($("<div>").attr({"class":"ele"}).append(_n).append(Dn)),kn.append($("<div>").attr({"class":"ele"}).append(Pn).append(Hn)),ft.append(Cn).append(kn);if(n.stagingServiceUnit!=null&&n.stagingServiceUnit.name!=null){var Bn=$("<span>").attr("class","reivew_panel_tlt").css("padding-top","5px").append(localizedString("PRE_UPGRADE_STGSU_TLT")),jn=$("<div>").attr("class","review_panel"),Fn=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),In=$("<span>").attr({"class":"ele_value",title:n.stagingServiceUnit.name}).append(n.stagingServiceUnit.name),qn=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_STATUS")}).append(localizedString("MISC_STATUS")),Rn=$("<span>").attr({"class":"ele_value",title:n.stagingServiceUnit.status}).append(n.stagingServiceUnit.status),Un=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),zn=$("<span>").attr({"class":"ele_value",title:n.stagingServiceUnit.purpose}).append(n.stagingServiceUnit.purpose),Wn=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_VERSION")}).append(localizedString("COLUMN_VERSION")),Xn=$("<span>").attr({"class":"ele_value",title:n.stagingServiceUnit.version}).append(n.stagingServiceUnit.version);jn.append($("<div>").attr({"class":"ele"}).append(Fn).append(In)),jn.append($("<div>").attr({"class":"ele"}).append(qn).append(Rn)),jn.append($("<div>").attr({"class":"ele"}).append(Un).append(zn)),jn.append($("<div>").attr({"class":"ele"}).append(Wn).append(Xn)),ft.append(Bn).append(jn)}var C=$("<span>").attr("class","reivew_panel_tlt").css("padding-top","5px").append(localizedString("TENANT")),k=$("<div>").attr("class","review_panel"),a=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_MSSQL_NAME")}).append(localizedString("COLUMN_MSSQL_NAME")),f=$("<span>").attr({"class":"ele_value",title:n.tenant.name}).append(n.tenant.name),h=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_PURPOSE")}).append(localizedString("COLUMN_PURPOSE")),p=$("<span>").attr({"class":"ele_value",title:n.tenant.purpose}).append(n.tenant.purpose),d=$("<span>").attr({"class":"ele_tlt",title:localizedString("MISC_CUSTNAME")}).append(localizedString("MISC_CUSTNAME")),v=$("<span>").attr({"class":"ele_value",title:n.tenant.customerName}).append(n.tenant.customerName),lt=$("<span>").attr({"class":"ele_tlt",title:localizedString("TNT_COLUMN_DBNAME")}).append(localizedString("TNT_COLUMN_DBNAME")),ct=$("<span>").attr({"class":"ele_value",title:n.tenant.dbname}).append(n.tenant.dbname),ht=$("<span>").attr({"class":"ele_tlt",title:localizedString("COLUMN_DESC")}).append(localizedString("COLUMN_DESC")),pt=$("<span>").attr({"class":"ele_value",title:n.tenant.description}).append(n.tenant.description);k.append($("<div>").attr({"class":"ele"}).append(a).append(f)),k.append($("<div>").attr({"class":"ele"}).append(l).append(c)),k.append($("<div>").attr({"class":"ele"}).append(h).append(p)),k.append($("<div>").attr({"class":"ele"}).append(d).append(v)),k.append($("<div>").attr({"class":"ele"}).append(lt).append(ct)),n.tenant.description!=null&&n.tenant.description.length>0&&k.append($("<div>").attr({"class":"ele"}).append(ht).append(pt)),ft.append(C).append(k);if(n.users!=null&&n.users.length>0){var ut=$("<span>").attr("class","reivew_panel_tlt").append(localizedString("TENANT_LICENSE_ASSIGN_TITLE")),at=$("<div>").css({"float":"left",width:"665px"});e.gridDelegate.getHeaderSpec=function(){return[{name:"SystemUser",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"20%"},{name:"UserCode",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"20%"},{name:"LicenseModulesString",description:localizedString("WIZARD_TENANT_LIVMDL"),type:"text",width:"60%"}]},e.gridView=at.gridview({delegate:e.gridDelegate}),e.gridView.show(),e.gridData=n.users,e.gridView.reload(),ft.append(ut).append(at)}if(n.extension!=null&&n.extension.length>0){var Vn=null,$n=[],Jn={needExport:function(){return!1},getRowCount:function(){return $n.length},getRow:function(e){return $n[e]},getGridHeight:function(){return 150},getHeaderSpec:function(){return[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"30%"},{name:"Version",description:localizedString("DUPTNT_WIZARD_STEP4_COLUMN_SOURCEVERSION"),type:"text",width:"30%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"20%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"20%"}]}},ut=$("<span>").attr("class","reivew_panel_tlt").append(localizedString("ADDON_EXTENSIONS")),at=$("<div>").css({"float":"left",width:"661px"});Vn=at.gridview({delegate:Jn}),Vn.show(),$n=n.extension,Vn.reload(),ft.append(ut).append(at)}e._container.append(ft)}},this.onViewAppear=function(){}},c3assignEmailTemplate.step1=function(){function u(){var e=new loadingWindow;e.show();var t=c3.service.getMailTemplates();t.query(function(t){a(t.data),e.close()})}function a(t){$.each(t,function(t,n){var r=!1;$.each(e.assignedTemplates,function(e,t){if(n.ID==t.MailTemplate_ID)return r=!0,!1}),r||i.push(n)}),r.reload()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=this,n=[{name:"Name",description:"Template Name",type:"text",width:"30%"},{name:"Localization",description:"Localization",type:"text",width:"20%"},{name:"Folder",description:"Path",type:"text",width:"50%"}],r=null,i=[],s={getHeaderSpec:function(){return n},getRowCount:function(){return i.length},getRow:function(e){return i[e]},getGridHeight:function(){return 360},getCell:function(){}},o=$("<section>");r=o.gridview({delegate:s,checkType:1}),r.show(),r.rowCheckEvent.push(function(){var t=this.index,n=i[t];this.isChecked?e.templatesToAssign.push(n):$.each(e.templatesToAssign,function(t,r){r.ID==n.ID&&e.templatesToAssign.remove(t)})}),t._container.append(o),this.onInit=function(){},this.onViewAppear=function(){u()},this.finish=function(){if(t.finishEvent&&t.finishEvent.length>0)for(var e=0;e<t.finishEvent.length;e++)t.finishEvent[e]();t.close()}},c3addMailAddress.step1=function(){this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t=["Mial Address"],n=[new textbox({isRequired:!0})],r={checkValidity:function(){var t=!0;if(!n[0].val()||n[0].val()=="")return n[0].showErrorMessage(localizedString("VALIDITY_VALUEMISSSING")),!1;var r=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;return t=r.test(n[0].val()),t||n[0].showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH")),t&&(e.MailAddressEntity.Address=n[0].val()),t}};this.validator=r,this.reset=function(){n[0].val("")},this.onInit=function(){for(var e=0;e<t.length;e++)this._container.append(Utility.CreateRow(t[e],n[e]))},this.onViewAppear=function(){}},c3exportAgentLogs.step1=function(){function s(e){function r(e){n.showErrorMessage(e)}function i(){return t}var t=$("<div>").addClass("chrome4"),n=new textbox({isRequired:!0});n.css({width:"160","float":"left","margin-right":"2px"}),n.attr({id:e,placeholder:localization.AUDIT_LOG_PLACEHOLDER,readonly:!0}),n.placeAt(t),this.showErrorMessage=r,this.getRow=i,n.bind("blur",function(e){$(this).val()===""}),n.datepicker({aotuSize:!0,showTime:!1,showOn:"button",onSelect:function(t){e=="start"?$("#end").datepicker("option","minDate",t):e=="end"&&$("#start").datepicker("option","maxDate",t)}}),n.placeAt(t)}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite"),this.startBox=new s("start"),this.endBox=new s("end");var e=arguments[0]||{},t=[localizedString("WIZARD_EXPORT_FROM_DATE")+":",localizedString("WIZARD_EXPORT_TO_DATE")+":"],n=[this.startBox,this.endBox],r={checkValidity:function(){var e=!0,t=/^\d{1,2}\D\d{1,2}\D\d{4}$/,e=t.test($("#end").val()),r=!0;return e||(n[1].showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH")),r=!1),i==0&&(e=t.test($("#start").val()),e||(n[0].showErrorMessage(localizedString("VALIDITY_PATTERNMISMATCH")),r=!1)),r}};this.validator=r;var i=arguments[1];this.reset=function(){n[0].val("")},this.onInit=function(){for(var e=0;e<t.length;e++){if(e==0&&i==1)continue;this._container.append(Utility.CreateRow(t[e],n[e].getRow()))}},this.onViewAppear=function(){}};var c3init=function(){this.init=function(){var e=new loadingWindow;e.show();var t=0,n=function(n,r){e.close();if(notSAML()&&t==0){console.info("First initial page!"),t++;var i=new c3page}},r=function(t,n){var r=function(t,n){$("#nooperator").hide(),e.close();var r=new c3login;r.onCancel.push(function(){window.close()}),r.onSuccess.push(function(){if(notSAML())var e=new c3page}),r.show()},i=function(t,n){e.close(),$("#nooperator").show(),$("#nooperatorlogout").click(function(){window.location.href="/sld/saml2/idp/slo"})},s={};s.success=i,s.error=r,c3.service.getCurrentUser().query(s)},i={};i.success=n,i.error=r,c3.service.getCurrentOperator().query(i)}},c3log={createAdminData:function(e){var t=e.id+"_adminData",n=$("<section>").attr({id:e.id}).addClass("c3log"),r=localizedString("LOG_LABEL_CREATEDBY"),i=localizedString("LOG_LABEL_CREATEDTIME"),s=localizedString("LOG_LABEL_LASTCGBY"),o=localizedString("LOG_LABEL_LASTCGTIME"),u=$("<div>").addClass("chrome4").addClass("top").append($("<label>").addClass("name").append(r+": "));return e.createdByCtrl=$("<label>").addClass("value").attr({id:t+"_createdBy"}).append("<br/>"),u.append(e.createdByCtrl),u.append($("<label>").addClass("name").append(i+": ")),e.createdTimeCtrl=$("<label>").addClass("value").attr({id:t+"_createdTime"}),u.append(e.createdTimeCtrl),n.append(u),u=$("<div>").addClass("chrome4"),u.append($("<label>").addClass("name").append(s+": ")),e.lastChangedByCtrl=$("<label>").addClass("value").attr({id:t+"_lastChangedBy"}).append("<br/>"),u.append(e.lastChangedByCtrl),u.append($("<label>").addClass("name").append(o+": ")),e.lastChangedTimeCtrl=$("<label>").addClass("value").attr({id:t+"_lastChangedTime"}),u.append(e.lastChangedTimeCtrl),n.append(u),n}};c3overview.welcome=function(e,t){this.base=c3.module,this.base();var n=$("<section>").attr({id:"ovr_welcome"}).css({width:e,height:t+"px"}),r=this;this._container=n,this.onInit=function(){var e=$("<section>").attr({id:"b1od_des"}).css({width:"40%",height:t+"px","float":"left",position:"relative"}),r=$("<section>").attr({id:"b1od_about"}).css({width:"18%",height:t+"px","float":"left",position:"relative"}),i=$("<section>").attr({id:"b1od_img"}).css({width:"40%",height:t+"px","float":"right",position:"relative"});n.append(e).append(r).append(i);var s=$("<div>").attr({id:"home_welcome_des"});s.append($("<h1>").append(localizedString("HOME_WELCOME_TITLE")).css({"min-width":"350px","padding-top":"40px"})),s.append($("<label>").append(localizedString("HOME_WELCOME_CONTEXT")).css({"min-width":"350px"})),s.append("<br/><br/>"),s.append($("<a>").attr({href:"#"}).text(localizedString("HOME_ABOUT_TITLE")).click(function(){$("#about_li").click()}));var o=$("<div>").attr({id:"home_nav_about"});r.append(o),e.append(s),i.append($("<div>").attr({id:"home_welcome_img"}))}},c3overview.serviceUnit_ovr=function(e,t){function a(){l(),f()}function f(){c3.service.getCachedMonitorStatusBySuID(null,{success:function(e){if(e.d.results){u.avai=0,u.notAvai=0,u.infNotAvai=0,u.warning=0,u.unknown=0,u.notReach=0;for(var t=0;t<e.d.results.length;t++)e.d.results[t].StatusCode===monitorUtil.available?u.avai++:e.d.results[t].StatusCode===monitorUtil.serviceError?u.notAvai++:e.d.results[t].StatusCode===monitorUtil.infraNotReach?u.infNotAvai++:e.d.results[t].StatusCode===monitorUtil.serviceNotReach?u.notReach++:e.d.results[t].StatusCode===monitorUtil.warning?u.warning++:e.d.results[t].StatusCode===monitorUtil.unknown&&u.unknown++;u.SUnit_avai_Count.text(u.avai),u.SUnit_not_avai_Count.text(u.notAvai),u.SUnit_inf_not_avai_Count.text(u.infNotAvai),u.SUnit_not_reach_Count.text(u.notReach),u.SUnit_warning_Count.text(u.warning),u.SUnit_unknown_Count.text(u.unknown)}},error:function(e){u.SUnit_avai_Count.text(0),u.SUnit_not_avai_Count.text(0),u.SUnit_inf_not_avai_Count.text(0),u.SUnit_not_reach_Count.text(0),u.SUnit_warning_Count.text(0),u.SUnit_unknown_Count.text(u.SUnit_Total_Count.text())}})}function l(){c3.service.getHostingUnits().count().query(function(e){u.SUnit_Total_Count.text(e.data)}),c3.service.getHostingUnits().filter("Status eq 'Online'").count().query(function(e){u.SUnit_Online_Count.text(e.data)}),c3.service.getHostingUnits().filter("Status eq 'Offline'").count().query(function(e){u.SUnit_Offline_Count.text(e.data)}),c3.service.getHostingUnits().filter("Purpose eq 'Productive'").count().query(function(e){u.SUnit_Productive_Count.text(e.data)}),c3.service.getHostingUnits().filter("Purpose eq 'Testing'").count().query(function(e){u.SUnit_Testing_Count.text(e.data)}),c3.service.getHostingUnits().filter("Purpose eq 'Demo'").count().query(function(e){u.SUnit_Demo_Count.text(e.data)}),c3.service.getHostingUnits().filter("Purpose eq 'Trial'").count().query(function(e){u.SUnit_Trial_Count.text(e.data)}),c3.service.getHostingUnits().filter("Purpose eq 'Staging'").count().query(function(e){u.SUnit_Staging_Count.text(e.data)})}function c(){var e=$("<section>"),t=$("<section>").addClass("bodyContainer");return t.append(h()),t.append(p()),t.append(d()),e.append(t),e}function h(){var e=$("<div>").addClass("landscapeGrid"),t=$("<table>"),n=$("<tr>").addClass("first_row"),r=$("<a>").text("0").attr({href:"#"});u.SUnit_Total_Count=r;var i=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.SUnit_Online_Count=i;var s=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.SUnit_Offline_Count=s;var o=$("<div>").addClass("lbl_online_icon"),a=$("<div>").addClass("lbl_offline_icon");n.append($("<td>").addClass("first_row_first_col").bind("click",function(){v()}).append(r)),n.append($("<td>").append(i)),n.append($("<td>").append(s));var f=$("<tr>").addClass("last_row"),l=$("<label>").append("SERVICE UNITS"),c=$("<label>").append("Online"),h=$("<label>").append("Offline");return f.append($("<td>").addClass("last_row_first_col").bind("click",function(){v()}).append(l)),f.append($("<td>").append(o).append(c)),f.append($("<td>").append(a).append(h)),t.append(n),t.append(f),e.append(t),e}function p(){var e=$("<div>").addClass("landscapeGrid"),t=$("<table>"),n=$("<tr>").addClass("first_row"),r=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.SUnit_Productive_Count=r;var i=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.SUnit_Testing_Count=i;var s=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.SUnit_Demo_Count=s;var o=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.SUnit_Trial_Count=o;var a=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.SUnit_Staging_Count=a;var f=$("<div>").addClass("lbl_productive_icon"),l=$("<div>").addClass("lbl_testing_icon"),c=$("<div>").addClass("lbl_demo_icon"),h=$("<div>").addClass("lbl_trial_icon"),p=$("<div>").addClass("lbl_staging_icon");n.append($("<td>").append(r)),n.append($("<td>").append(i)),n.append($("<td>").append(s)),n.append($("<td>").append(o)),n.append($("<td>").append(a));var d=$("<tr>").addClass("last_row"),v=$("<label>").append("Productive"),m=$("<label>").append("Testing"),g=$("<label>").append("Demo"),y=$("<label>").append("Trial"),b=$("<label>").append("Staging");return d.append($("<td>").append(f).append(v)),d.append($("<td>").append(l).append(m)),d.append($("<td>").append(c).append(g)),d.append($("<td>").append(h).append(y)),d.append($("<td>").append(p).append(b)),t.append(n),t.append(d),e.append(t),e}function d(){var e=$("<div>").addClass("landscapeGrid"),t=$("<table>"),n=$("<tr>").addClass("first_row");u.SUnit_avai_Count=$("<a>").text("0").addClass("lbl_count").attr({href:"#"}),u.SUnit_not_avai_Count=$("<a>").text("0").addClass("lbl_count").attr({href:"#"}),u.SUnit_inf_not_avai_Count=$("<a>").text("0").addClass("lbl_count").attr({href:"#"}),u.SUnit_not_reach_Count=$("<a>").text("0").addClass("lbl_count").attr({href:"#"}),u.SUnit_warning_Count=$("<a>").text("0").addClass("lbl_count").attr({href:"#"}),u.SUnit_unknown_Count=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});var r=$("<div>").addClass("lbl_error_icon"),i=$("<div>").addClass("lbl_avai_icon"),s=$("<div>").addClass("lbl_inf_not_ava_icon"),o=$("<div>").addClass("lbl_warning_icon"),a=$("<div>").addClass("lbl_unknown_icon"),f=$("<div>").addClass("lbl_not_reach_icon");n.append($("<td>").append(u.SUnit_avai_Count)),n.append($("<td>").append(u.SUnit_warning_Count)),n.append($("<td>").append(u.SUnit_not_avai_Count)),n.append($("<td>").append(u.SUnit_not_reach_Count)),n.append($("<td>").append(u.SUnit_inf_not_avai_Count)),n.append($("<td>").append(u.SUnit_unknown_Count));var l=$("<tr>").addClass("last_row"),c=$("<label>").append(localizedString("MONITOR_STATUS_NOT_AVAILABLE_TITLE")),h=$("<label>").append(localizedString("MONITOR_STATUS_AVAILABLE_TITLE")),p=$("<label>").append(localizedString("MONITOR_STATUS_INF_NOT_REACH_TITLE")),d=$("<label>").append(localizedString("MONITOR_STATUS_NOT_REACH_TITLE")),v=$("<label>").append(localizedString("MONITOR_STATUS_WARNING_TITLE")),m=$("<label>").append(localizedString("MONITOR_STATUS_UNKNOWN_TITLE"));return l.append($("<td>").append(i).append(h)),l.append($("<td>").append(o).append(v)),l.append($("<td>").append(r).append(c)),l.append($("<td>").append(f).append(d)),l.append($("<td>").append(s).append(p)),l.append($("<td>").append(a).append(m)),t.append(n),t.append(l),e.append(t),e}function v(e){$("#respool0").click()}this.base=c3.module,this.base();var n="ovr_service_unit",r=localizedString("OVERVIEW_SERVICEUNIT"),i=$("<a>").attr({href:"#",id:"btnRefresh_"+n,title:"Refresh"}).addClass("refresh"),s=$("<hgroup>").append($("<h1>").append(r).append($("<div>").css({"float":"right"}).append(i))),o=$("<section>").attr({id:n}).css({width:e,height:t+"px"}),u=this;u.avai=0,u.notAvai=0,u.infNotAvai=0,u.warning=0,u.unknown=0,u.notReach=0,i.click(function(){a()}),this._title=r,this._container=o,o.append(s),this.onInit=function(){o.append(c()),a()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){l()})}},c3overview.tenant_ovr=function(e,t){function a(){f()}function f(){c3.service.getTenants().count().query(function(e){u.Tenant_Total_Count.text(e.data)}),c3.service.getTenants().filter("Status eq 'Online'").count().query(function(e){u.Tenant_Online_Count.text(e.data)}),c3.service.getTenants().filter("Status eq 'Offline'").count().query(function(e){u.Tenant_Offline_Count.text(e.data)}),c3.service.getTenants().filter("Status eq 'Maintenance'").count().query(function(e){u.Tenant_Maintenance_Count.text(e.data)}),c3.service.getTenants().filter("Purpose eq 'Productive'").count().query(function(e){u.Tenant_Productive_Count.text(e.data)}),c3.service.getTenants().filter("Purpose eq 'Testing'").count().query(function(e){u.Tenant_Testing_Count.text(e.data)}),c3.service.getTenants().filter("Purpose eq 'Demo'").count().query(function(e){u.Tenant_Demo_Count.text(e.data)}),c3.service.getTenants().filter("Purpose eq 'Trial'").count().query(function(e){u.Tenant_Trial_Count.text(e.data)})}function l(){var e=$("<section>"),t=$("<section>").addClass("bodyContainer");return t.append(c()),t.append(h()),e.append(t),e}function c(){var e=$("<div>").addClass("landscapeGrid"),t=$("<table>"),n=$("<tr>").addClass("first_row"),r=$("<a>").text("0").attr({href:"#"});u.Tenant_Total_Count=r;var i=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Tenant_Online_Count=i;var s=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Tenant_Offline_Count=s;var o=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Tenant_Maintenance_Count=o;var a=$("<div>").addClass("lbl_online_icon"),f=$("<div>").addClass("lbl_offline_icon"),l=$("<div>").addClass("lbl_maintenance_icon");n.append($("<td>").addClass("first_row_first_col").bind("click",function(){p()}).append(r)),n.append($("<td>").append(i)),n.append($("<td>").append(s)),n.append($("<td>").append(o));var c=$("<tr>").addClass("last_row"),h=$("<label>").append("TENANTS"),d=$("<label>").append("Online"),v=$("<label>").append("Offline"),m=$("<label>").append("Maintenance");return c.append($("<td>").addClass("last_row_first_col").bind("click",function(){p()}).append(h)),c.append($("<td>").append(a).append(d)),c.append($("<td>").append(f).append(v)),c.append($("<td>").append(l).append(m)),t.append(n),t.append(c),e.append(t),e}function h(){var e=$("<div>").addClass("landscapeGrid"),t=$("<table>"),n=$("<tr>").addClass("first_row"),r=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Tenant_Productive_Count=r;var i=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Tenant_Testing_Count=i;var s=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Tenant_Demo_Count=s;var o=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Tenant_Trial_Count=o;var a=$("<div>").addClass("lbl_productive_icon"),f=$("<div>").addClass("lbl_testing_icon"),l=$("<div>").addClass("lbl_demo_icon"),c=$("<div>").addClass("lbl_trial_icon");n.append($("<td>").append(r)),n.append($("<td>").append(i)),n.append($("<td>").append(s)),n.append($("<td>").append(o));var h=$("<tr>").addClass("last_row"),p=$("<label>").append("Productive"),d=$("<label>").append("Testing"),v=$("<label>").append("Demo"),m=$("<label>").append("Trial");return h.append($("<td>").append(a).append(p)),h.append($("<td>").append(f).append(d)),h.append($("<td>").append(l).append(v)),h.append($("<td>").append(c).append(m)),t.append(n),t.append(h),e.append(t),e}function p(e){$("#appmgr1").click()}this.base=c3.module,this.base();var n="ovr_tenant",r=localizedString("OVERVIEW_TENANT"),i=$("<a>").attr({href:"#",id:"btnRefresh_"+n,title:"Refresh"}).addClass("refresh"),s=$("<hgroup>").append($("<h1>").append(r).append($("<div>").css({"float":"right"}).append(i))),o=$("<section>").attr({id:n}).css({width:e,height:t+"px"}),u=this;i.click(function(){a()}),this._title=r,this._container=o,o.append(s),this.onInit=function(){o.append(l()),a()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Tenants,function(e){f()})}},c3overview.customer_ovr=function(e,t){function a(){f()}function f(){c3.service.getCustomers().count().query(function(e){u.Customer_Total_Count.text(e.data)}),c3.service.getCustomers().filter("Status eq 'Online'").count().query(function(e){u.Customer_Online_Count.text(e.data)}),c3.service.getCustomers().filter("Status eq 'Offline'").count().query(function(e){u.Customer_Offline_Count.text(e.data)}),c3.service.getCustomers().filter("Type eq 'Customer'").count().query(function(e){u.Customer_Customer_Count.text(e.data)}),c3.service.getCustomers().filter("Type eq 'TrialCustomer'").count().query(function(e){u.Customer_TrialCustomer_Count.text(e.data)})}function l(){var e=$("<section>"),t=$("<section>").addClass("bodyContainer");return t.append(c()),t.append(h()),e.append(t),e}function c(){var e=$("<div>").addClass("landscapeGrid"),t=$("<table>"),n=$("<tr>").addClass("first_row"),r=$("<a>").text("0").attr({href:"#"});u.Customer_Total_Count=r;var i=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Customer_Online_Count=i;var s=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Customer_Offline_Count=s;var o=$("<div>").addClass("lbl_online_icon"),a=$("<div>").addClass("lbl_offline_icon");n.append($("<td>").addClass("first_row_first_col").bind("click",function(){p()}).append(r)),n.append($("<td>").append(i)),n.append($("<td>").append(s));var f=$("<tr>").addClass("last_row"),l=$("<label>").append("CUSTOMERS"),c=$("<label>").append("Online"),h=$("<label>").append("Offline");return f.append($("<td>").addClass("last_row_first_col").bind("click",function(){p()}).append(l)),f.append($("<td>").append(o).append(c)),f.append($("<td>").append(a).append(h)),t.append(n),t.append(f),e.append(t),e}function h(){var e=$("<div>").addClass("landscapeGrid"),t=$("<table>"),n=$("<tr>").addClass("first_row"),r=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Customer_Customer_Count=r;var i=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.Customer_TrialCustomer_Count=i;var s=$("<div>").addClass("lbl_customer_icon"),o=$("<div>").addClass("lbl_trialCustomer_icon");n.append($("<td>").append(r)),n.append($("<td>").append(i));var a=$("<tr>").addClass("last_row"),f=$("<label>").append(localizedString("CUSTOMERS")),l=$("<label>").append(localizedString("TRIALCUSTOMERS"));return a.append($("<td>").append(s).append(f)),a.append($("<td>").append(o).append(l)),t.append(n),t.append(a),e.append(t),e}function p(e){$("#appmgr0").click()}this.base=c3.module,this.base();var n="ovr_customer",r=localizedString("OVERVIEW_CUSTOMER"),i=$("<a>").attr({href:"#",id:"btnRefresh_"+n,title:"Refresh"}).addClass("refresh"),s=$("<hgroup>").append($("<h1>").append(r).append($("<div>").css({"float":"right"}).append(i))),o=$("<section>").attr({id:n}).css({width:e,height:t+"px"}),u=this;i.click(function(){a()}),this._title=r,this._container=o,o.append(s),this.onInit=function(){o.append(l()),a()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Customers,function(e){f()})}},c3overview.trialRequest_ovr=function(e,t){function a(){f()}function f(){c3.service.getTrialRequests().count().query(function(e){u.TrialRequest_Total_Count.text(e.data)}),c3.service.getTrialRequests().filter("RequestStatus eq 'New'").count().query(function(e){u.TrialRequest_New_Count.text(e.data)}),c3.service.getTrialRequests().filter("RequestStatus eq 'Ready'").count().query(function(e){u.TrialRequest_Ready_Count.text(e.data)}),c3.service.getTrialRequests().filter("RequestStatus eq 'Released'").count().query(function(e){u.TrialRequest_Release_Count.text(e.data)}),c3.service.getTrialRequests().filter("RequestStatus eq 'Failed'").count().query(function(e){u.TrialRequest_Failed_Count.text(e.data)}),c3.service.getTrialRequests().filter("RequestStatus eq 'Rejected'").count().query(function(e){u.TrialRequest_Rejected_Count.text(e.data)})}function l(){var e=$("<section>"),t=$("<section>").addClass("bodyContainer");return t.append(c()),e.append(t),e}function c(){var e=$("<div>").addClass("landscapeGrid"),t=$("<table>"),n=$("<tr>").addClass("first_row"),r=$("<a>").text("0").attr({href:"#"});u.TrialRequest_Total_Count=r;var i=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.TrialRequest_New_Count=i;var s=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.TrialRequest_Ready_Count=s;var o=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.TrialRequest_Release_Count=o;var a=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.TrialRequest_Failed_Count=a;var f=$("<a>").text("0").addClass("lbl_count").attr({href:"#"});u.TrialRequest_Rejected_Count=f;var l=$("<div>").addClass("lbl_new_icon"),c=$("<div>").addClass("lbl_ready_icon"),p=$("<div>").addClass("lbl_released_icon"),d=$("<div>").addClass("lbl_failed_icon"),v=$("<div>").addClass("lbl_rejected_icon");n.append($("<td>").addClass("first_row_first_col").bind("click",function(){h()}).append(r)),n.append($("<td>").append(i)),n.append($("<td>").append(s)),n.append($("<td>").append(o)),n.append($("<td>").append(a)),n.append($("<td>").append(f));var m=$("<tr>").addClass("last_row"),g=$("<span>").append("TRIAL REQUESTS"),y=$("<span>").append("New"),b=$("<span>").append("Ready"),w=$("<span>").append("Released"),E=$("<span>").append("Failed"),S=$("<span>").append("Rejected");return m.append($("<td>").addClass("last_row_first_col").bind("click",function(){h()}).append(g)),m.append($("<td>").append(l).append(y)),m.append($("<td>").append(c).append(b)),m.append($("<td>").append(p).append(w)),m.append($("<td>").append(d).append(E)),m.append($("<td>").append(v).append(S)),t.append(n),t.append(m),e.append(t),e}function h(e){$("#appmgr2").click()}this.base=c3.module,this.base();var n="ovr_trial_request",r=localizedString("OVERVIEW_TRIAL_REQUEST"),i=$("<a>").attr({href:"#",id:"btnRefresh_"+n,title:"Refresh"}).addClass("refresh"),s=$("<hgroup>").append($("<h1>").append(r).append($("<div>").css({"float":"right"}).append(i))),o=$("<section>").attr({id:n}).css({width:e,height:t+"px"}),u=this;i.click(function(){a()}),this._title=r,this._container=o,o.append(s),this.onInit=function(){o.append(l()),a()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.TrialRequests,function(e){f()})}},c3overview.hostunit=function(e,t){function f(){c3.service.getHostingUnits().count().query(c),c3.service.getHostingUnits().expand("LicenseServer,LicenseServer/Machine,PresentationServers,CommonDatabase/DatabaseInstance,CommonDatabase,IntegrationComponent,Mailer,Mailer/Machine,SharedFolder").query(h)}function l(){c3.service}function c(e){a.huCountLabel.empty(),a.huCountLabel.append(e.data)}function h(e){var t=c3.service.convertData(e.data);a.data=t,a.grid.reload()}function p(){var e=$("<section>"),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"5%"},{name:"Name",description:localizedString("OVERVIEW_COLUMN_HUNAME"),type:"text",width:"13%"},{name:"CommonDatabase_DatabaseInstance_Status",description:localizedString("RES_MS_SQL"),type:"text",width:"12%"},{name:"LicenseServer_Status",description:localizedString("RES_LIC_SERVER"),type:"text",width:"12%"},{name:"PresentationServers",description:localizedString("RES_PRESENTATION_SERVERS"),type:"text",width:"12%"},{name:"CommonDatabase_Status",description:localizedString("RES_SBO_COMMON"),type:"text",width:"12%"},{name:"IntegrationComponent_Status",description:localizedString("OVERVIEW_COLUMN_B1I"),type:"text",width:"12%"},{name:"Mailer_Status",description:localizedString("RES_MAILER_SERVICE"),type:"text",width:"11%"},{name:"SharedFolder_Status",description:localizedString("RES_SH_FOLDER"),type:"text",width:"11%"}];a.data=[];var r={getHeaderSpec:function(){return n},getRowCount:function(){return a.data.length},getRow:function(e){return a.data[e]},getGridHeight:function(){return t-70},getCell:function(){var e=null;if(this.colName=="PresentationServers"){var t=[];return $.each(this.data.PresentationServers,function(e,n){var r={};r.text=n.Status,r.tip=n.Name,r.textalign="center",t.push(r)}),e=new statusControl(t),e}if(this.colName!="Name"){var n={};n.tip=d(this.colName,this.data),n.text=this.data[this.colName],n.textalign="center",e=new statusControl(n)}return e}};a.gridDelegate=r;var i=$(e).gridview({delegate:r});return i.rowSelectedEvent.push(function(){}),a.grid=i,e}function d(e,t){var n="";switch(e){case"CommonDatabase_DatabaseInstance_Status":n=t.CommonDatabase_DatabaseInstance_Name;break;case"LicenseServer_Status":t.LicenseServer_Machine!=undefined&&(n=t.LicenseServer_Machine.Hostname);break;case"CommonDatabase_Status":n=t.CommonDatabase_DatabaseInstance_Name;break;case"IntegrationComponent_Status":n=t.IntegrationComponent_URL;break;case"Mailer_Status":t.Mailer_Machine!=undefined&&(n=t.Mailer_Machine.Hostname);break;case"BackupRepository_Status":n=t.BackupRepository_URI}return n}function v(){var e=$("<hgroup>").addClass("huFooter"),t={};return t.text=localizedString("STATUS_ONLINE"),t.showText=!0,e.append((new statusControl(t)).addClass("footer")),t.text="Offline",e.append((new statusControl(t)).addClass("footer")),t.text=localizedString("STATUS_MAINTENANCE"),e.append((new statusControl(t)).addClass("footer")),e}this.base=c3.module,this.base();var n="ovr_hostunit",r=localizedString("OVERVIEW_HOSTUNIT"),i=$("<a>").attr({href:"#",id:"btnRefresh_"+n,title:"Refresh"}).addClass("refresh"),s=$("<hgroup>"),o=$("<section>").attr({id:n}).css({width:e,height:t+"px"}),u=$("<div>").addClass("glib"),a=this;a.huCountLabel=$("<label>"),s.append($("<h1>").append(r).append(" (").append(a.huCountLabel).append(")").append($("<div>").css({"float":"right"}).append(i))),i.click(function(){f()}),this._title=r,this._container=o,o.append(s),this.onInit=function(){o.append(u),u.css({height:o.height()-s.height()+"px"}),u.append(v()),u.append(p()).css({"float":"none"}),a.grid&&a.grid.show(),f()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){f()})}},c3overview.sysLandScape=function(e,t){function f(){c3.service.getHostingUnits().count().query(l),c3.service.getCustomers().count().query(c),c3.service.getTenants().count().query(h),c3.service.getSWRepositories().query(p)}function l(e){a.huCountLabel.empty(),a.huCountLabel.append(e.data)}function c(e){a.customerCountLabel.empty(),a.customerCountLabel.append(e.data)}function h(e){a.tenantCountLabel.empty(),a.tenantCountLabel.append(e.data)}function p(e){a.repositoryGroup.find(".divValue").remove(),$.each(e.data,function(e,t){var n=$("<div>").addClass("chrome1").addClass("divValue");n.append($("<label>").addClass("rowLabel").append(t.Version+":")),c3.service.getTenants().filter(String.format("ServiceUnit/Version eq '{0}'",t.Version)).count().query(function(e){e.data==0||e.data==1?n.append($("<label>").append(e.data).append(" "+localizedString("TENANT"))):n.append($("<label>").append(e.data).append(" "+localizedString("TENANTS"))),a.repositoryGroup.append(n)})})}function d(){var e=$("<section>").addClass("bodyContainer"),t=$("<div>").addClass("group"),n=$("<div>").addClass("chrome1");return n.append($("<label>").addClass("rowLabel").append(localizedString("HOSTUNITS")+":")),a.huCountLabel=$("<label>"),n.append(a.huCountLabel),t.append(n),n=$("<div>").addClass("chrome1"),n.append($("<label>").addClass("rowLabel").append(localizedString("CUSTOMERS")+":")),a.customerCountLabel=$("<label>"),n.append(a.customerCountLabel),t.append(n),e.append(t),n=$("<div>").addClass("chrome1"),n.append($("<label>").addClass("rowLabel").append(localizedString("TENANTS")+":")),a.tenantCountLabel=$("<label>"),n.append(a.tenantCountLabel),t.append(n),e.append(t),t=$("<div>").addClass("group"),n=$("<div>").addClass("chrome1"),a.repositoryGroup=t,n.append($("<label>").addClass("rowLabel").append(localizedString("OVERVIEW_REPOSITORY_USAGE")+":")),t.append(n),e.append(t),e}this.base=c3.module,this.base();var n="ovr_sys_landscape",r=localizedString("OVERVIEW_SYS_LANDSCAPE"),i=$("<a>").attr({href:"#",id:"btnRefresh_"+n,title:"Refresh"}).addClass("refresh"),s=$("<hgroup>").append($("<h1>").append(r).append($("<div>").css({"float":"right"}).append(i))),o=$("<section>").attr({id:n}).css({width:e,height:t+"px","float":"left"}),u=$("<div>").addClass("glib"),a=this;i.click(function(){f()}),this._title=r,this._container=o,o.append(s),this.onInit=function(){o.append(u),u.css({height:o.height()-s.height()+"px"}),u.append(d()),f()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){c3.service.getHostingUnits().count().query(l)}),cometdManager.subscribe(sldEntitySet.Customers,function(e){c3.service.getCustomers().count().query(c)}),cometdManager.subscribe(sldEntitySet.Tenants,function(e){c3.service.getTenants().count().query(h),c3.service.getSWRepositories().query(p)}),cometdManager.subscribe(sldEntitySet.SoftwareRepositories,function(e){c3.service.getSWRepositories().query(p)})}},c3overview.tenant=function(e,t){function f(){c3.service.getTenants().query(c),c3.service.getTenants().count().query(l)}function l(e){a.tenantCountLabel.empty(),a.tenantCountLabel.append(e.data)}function c(e){var t=0,n=0,r=0,i=e.data.length;$.each(e.data,function(e,i){switch(i.Status){case"Online":t++;break;case"Offline":n++;break;case"Maintenance":r++}});var s={};s.onlineCount=t,s.offlineCount=n,s.maintenanceCount=r,h(s)}function h(e){u.empty();var t={rows:[{name:localizedString("STATUS_ONLINE"),data:[e.onlineCount]},{name:localizedString("STATUS_OFFLINE"),data:[e.offlineCount]},{name:localizedString("STATUS_MAINTENANCE"),data:[e.maintenanceCount]}],cols:["Amount"]},n=new gdata(t);$.fn.gchart.defaults.colors=["#94CB3C","#EB290E","#F8B80E"],u.gpie(n,{params:{init:1},legend:"Right"},[])}this.base=c3.module,this.base();var n="ovr_tenant",r=localizedString("OVERVIEW_TENANT"),i=$("<a>").attr({href:"#",id:"btnRefresh_"+n,title:"Refresh"}).addClass("refresh"),s=$("<hgroup>"),o=$("<section>").attr({id:n}).css({width:e,height:t+"px","float":"left"}),u=$("<div>").addClass("glib"),a=this;a.tenantCountLabel=$("<label>"),s.append($("<h1>").append(r).append(" (").append(a.tenantCountLabel).append(")").append($("<div>").css({"float":"right"}).append(i))),i.click(function(){f()}),this._title=r,this._container=o,o.append(s),this.onInit=function(){o.append(u),u.css({height:o.height()-s.height()+"px"}),f()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Tenants,function(e){f()})},this.onViewAppear=function(){}},function(){"use strict";function e(e,t){function f(){monitorUtil.retrieveSLDMonitorStatus({success:function(e){if(e.d.SLDStatusCheck){var t=$(a);t.empty();var n=monitorUtil.getMonitorIcon(e.d.SLDStatusCheck.Code),r=$("<tr>"),i=$("<td>").append(n);r.append(i);var s=$("<td>").append(monitorUtil.replaceStatus(e.d.SLDStatusCheck.Status));r.append(s);var o=$("<td>").append(e.d.SLDStatusCheck.Message);r.append(o),t.append(r),t.show()}},error:function(e){e.d.results}})}this.base=c3.module,this.base(),this._title=localizedString("MONITOR_STATUS_SLD_OVERVIEW"),this._container=$("<section>").attr({id:r}).css({width:e,height:t+"px","float":"left"});var n=this,r="ovr_SLDStatus",i=$("<a>").attr({href:"#",id:"btnRefresh_"+r,title:"Refresh"}).addClass("refresh"),s=$("<hgroup>"),o=$("<div>").addClass("glib"),u=$("<div>").addClass("monitor").attr({width:e}),a=$("<table>");this.onInit=function(){this.createBody("",f),this._container.append(o),o.css({height:this._container.height()-s.height()+"px"}),f()},this.createBody=function(t,n){s.append($("<h1>").append($("<label>")).append(this._title).append($("<div>").css({"float":"right"}).append(i))),i.click(n),this._container.append(s),u.append(a),this._container.append(u),a.attr({width:e}).hide()}}c3overview.SLDStatus=e}(),c3appmgroverview.welcome=function(e,t){this.base=c3.module,this.base();var n="appmgr_ovr_welcome",r=$("<section>").append(localizedString("APPMGR_OVERVIEW_WELCOME")).addClass("overviewTab_title"),i=$("<section>").attr({id:n}).css({width:e,height:t+"px"}).addClass("img_container_appmgr"),s=this;this._title=r,this._container=i,this.onInit=function(){return i.append(r),i}},c3appmgroverview.topology=function(e,t){function s(){c3.service.getHostingUnits().count().query(o),c3.service.getSWRepositories().count().query(u),c3.service.getDBServerInstances().count().query(f),c3.service.getPresentationServers().count().query(l),c3.service.getLicenseServers().count().query(c),c3.service.getCommonDBs().count().query(h),c3.service.getB1iServers().count().query(p),c3.service.getB1SharedFolders().count().query(d),c3.service.getSharedFolders().count().query(v),c3.service.getTenantsStorages().count().query(m),c3.service.getImplementationRepositories().count().query(y),c3.service.getCompanyTemplateRepositories().count().query(w)}function o(e){i.huCountLabel.empty(),parseInt(e.data)<=0?i.huCountLabel.append(e.data).attr({"class":"alert_text"}):i.huCountLabel.append(e.data).attr({"class":"icon_title"})}function u(e){i.SWrepositoryCountLabel.empty(),parseInt(e.data)<=0?i.SWrepositoryCountLabel.append(e.data).attr({"class":"alert_text"}):i.SWrepositoryCountLabel.append(e.data).attr({"class":"icon_title"})}function a(e){i.mailerCountLabel.empty(),parseInt(e.data)<=0?i.mailerCountLabel.append(e.data).attr({"class":"alert_text"}):i.mailerCountLabel.append(e.data).attr({"class":"icon_title"})}function f(e){i.DBinstanceCountLabel.empty(),parseInt(e.data)<=0?i.DBinstanceCountLabel.append(e.data).attr({"class":"alert_text"}):i.DBinstanceCountLabel.append(e.data).attr({"class":"icon_title"})}function l(e){i.presentationserverCountLabel.empty(),parseInt(e.data)<=0?i.presentationserverCountLabel.append(e.data).attr({"class":"alert_text"}):i.presentationserverCountLabel.append(e.data).attr({"class":"icon_title"})}function c(e){i.licenseserverCountLabel.empty(),parseInt(e.data)<=0?i.licenseserverCountLabel.append(e.data).attr({"class":"alert_text"}):i.licenseserverCountLabel.append(e.data).attr({"class":"icon_title"})}function h(e){i.commonDBCountLabel.empty(),parseInt(e.data)<=0?i.commonDBCountLabel.append(e.data).attr({"class":"alert_text"}):i.commonDBCountLabel.append(e.data).attr({"class":"icon_title"})}function p(e){i.B1iCountLabel.empty(),parseInt(e.data)<=0?i.B1iCountLabel.append(e.data).attr({"class":"alert_text"}):i.B1iCountLabel.append(e.data).attr({"class":"icon_title"})}function d(e){i.B1sharedfolderCountLabel.empty(),parseInt(e.data)<=0?i.B1sharedfolderCountLabel.append(e.data).attr({"class":"alert_text"}):i.B1sharedfolderCountLabel.append(e.data).attr({"class":"icon_title"})}function v(e){i.SharedfolderCountLabel.empty(),parseInt(e.data)<=0?i.SharedfolderCountLabel.append(e.data).attr({"class":"alert_text"}):i.SharedfolderCountLabel.append(e.data).attr({"class":"icon_title"})}function m(e){i.TenantsStorageCountLabel.empty(),parseInt(e.data)<=0?i.TenantsStorageCountLabel.append(e.data).attr({"class":"alert_text"}):i.TenantsStorageCountLabel.append(e.data).attr({"class":"icon_title"})}function g(e){i.DBbackuprepositoryCountLabel.empty(),parseInt(e.data)<=0?i.DBbackuprepositoryCountLabel.append(e.data).attr({"class":"alert_text"}):i.DBbackuprepositoryCountLabel.append(e.data).attr({"class":"icon_title"})}function y(e){i.ImplRepositoryCountLabel.empty(),parseInt(e.data)<=0?i.ImplRepositoryCountLabel.append(e.data).attr({"class":"alert_text"}):i.ImplRepositoryCountLabel.append(e.data).attr({"class":"icon_title"})}function b(e){i.SharedFolderSampleCountLabel.empty(),parseInt(e.data)<=0?i.SharedFolderSampleCountLabel.append(e.data).attr({"class":"alert_text"}):i.SharedFolderSampleCountLabel.append(e.data).attr({"class":"icon_title"})}function w(e){i.CompanyTemplateRepositoryCountLabel.empty(),parseInt(e.data)<=0?i.CompanyTemplateRepositoryCountLabel.append(e.data).attr({"class":"alert_text"}):i.CompanyTemplateRepositoryCountLabel.append(e.data).attr({"class":"icon_title"})}function E(){var e=$("<div>"),t=$("<section>").append(localizedString("HOSTUNIT")).addClass("overviewTab_subtitle"),r=localizedString("MISC_NEW"),s=$("<section>").addClass("icon_HU").css({"float":"left",width:"80px"}),o=$("<section>").append(localizedString("HOSTUNIT_INTRODUCE")).addClass("overviewContent").css({"float":"left",width:"75%"}),u=$("<div>").addClass("boxBtnContainer");return u.append($("<input>").attr({value:r,type:"button",id:n+"btnRegister"}).click(function(){S(i)})),e.append(t).append(s).append(o).append(u),e}function S(e){var t=new c3huwizard(e);t.show()}function x(){var e=$("<section>");btnRefresh=$("<a>").attr({href:"#",id:"btnRefresh_"+n+"_serviceUnit",title:"Refresh"}).addClass("refresh"),title=$("<section>").append(localizedString("HU_INF")).addClass("infrastructure_title").append($("<div>").css({"float":"right"}).append(btnRefresh)),btnRefresh.click(function(){s()});var t=$("<section>").append(localizedString("HU_INF_DESCRIPTION")).addClass("overviewContent"),r=$("<section>").append(localizedString("SHARED_COMPONENTS")).addClass("overviewContent"),i=localizedString("OPTIONAL"),o=$("<fieldset>").addClass("subgroup"),u=$("<legend>").append(i),a=$("<section>").addClass("diagram"),f=$("<section>").addClass("diagram"),l=$("<div>").addClass("element_container"),c=$("<div>").addClass("element_container"),h=$("<div>").addClass("element_container"),p=$("<div>").addClass("element_container"),d=$("<div>").addClass("element_container"),v=$("<div>").addClass("element_container"),m=$("<div>").addClass("element_container");element_container_ImplRepository=$("<div>").addClass("element_container"),element_container_CompanyTemplateRepository=$("<div>").addClass("element_container"),element_container_SharedFolder=$("<div>").addClass("element_container"),element_container_TenantsStorage=$("<div>").addClass("element_container");var g=$("<div>").addClass("element_box1"),y=$("<div>").addClass("element_box1"),b=$("<div>").addClass("element_box1"),w=$("<div>").addClass("element_box1"),E=$("<div>").addClass("element_box1"),S=$("<div>").addClass("element_box1"),x=$("<div>").addClass("element_box1"),T=$("<div>").addClass("element_box1"),N=$("<div>").addClass("element_box1").css({width:"95px"});return element_box_CompanyTemplateRepository=$("<div>").addClass("element_box1"),element_box_SharedFolder=$("<div>").addClass("element_box1"),element_box_TenantsStorage=$("<div>").addClass("element_box1"),g.append(k()),y.append(L()),b.append(A()),w.append(O()),E.append(M()),S.append(_()),x.append(D()),T.append(j()),N.append(F()),element_box_CompanyTemplateRepository.append(I()),element_box_SharedFolder.append(P()),element_box_TenantsStorage.append(H()),element_container_ImplRepository.append(N),element_container_CompanyTemplateRepository.append(element_box_CompanyTemplateRepository),v.append(S),element_container_SharedFolder.append(element_box_SharedFolder),element_container_TenantsStorage.append(element_box_TenantsStorage),o.append(u).append(v).append(element_container_ImplRepository).append(element_container_CompanyTemplateRepository),l.append(g),p.append(b),c.append(y),h.append(w),d.append(E),m.append(T),a.append(l).append(p).append(c).append(h).append(d).append(element_container_SharedFolder).append(element_container_TenantsStorage),f.append(r),e.append(title).append(a).append(o).append(f),e}function T(){var e=$("<div>"),t=$("<section>").append(localizedString("TENANT")).addClass("overviewTab_subtitle"),r=localizedString("MISC_NEW"),s=$("<section>").addClass("icon_Tenant").css({"float":"left",width:"80px"}),o=$("<section>").append(localizedString("TENANT_INTRODUCE")).addClass("overviewContent").css({"float":"left",width:"75%"}),u=$("<div>").addClass("boxBtnContainer");return u.append($("<input>").attr({value:r,type:"button",id:n+"btnRegister"}).click(function(){N(i)})),e.append(t).append(s).append(o).append(u),e}function N(e){var t=new c3newTenant(e,!0,null,!0);t.show()}function C(){var e=$("<section>");btnRefresh=$("<a>").attr({href:"#",id:"btnRefresh_"+n+"_tenant",title:"Refresh"}).addClass("refresh"),title=$("<section>").append(localizedString("TENANT_INF")).addClass("infrastructure_title").append($("<div>").css({"float":"right"}).append(btnRefresh)),btnRefresh.click(function(){s()}),description=$("<section>").append(localizedString("TENANT_INF_DESCRIPTION")).addClass("overviewContent");var t=$("<div>").addClass("element_container"),r=$("<div>").addClass("element_container"),i=$("<div>").addClass("element_box1"),o=$("<div>").addClass("element_box1");return o.append(B()),i.append(q()),r.append(o),t.append(i),e.append(title).append(t),e}function k(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_SWRepository(e)}),t=$("<section>").addClass("icon_SWRepository"),n=$("<section>").append("*").append(localizedString("SOFTWAREREPO")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.SWrepositoryCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function L(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_DBInstance(e)}),t=$("<section>").addClass("icon_DBInstance"),n=$("<section>").append(localizedString("RES_MS_SQL")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.DBinstanceCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function A(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_LicenseServer(e)}),t=$("<section>").addClass("icon_LicenseServer"),n=$("<section>").append("*").append(localizedString("RES_LIC_SERVER")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.licenseserverCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function O(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_SBOCOMMON(e)}),t=$("<section>").addClass("icon_SBOCOMMON"),n=$("<section>").append(localizedString("RES_SBO_COMMON")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.commonDBCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function M(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_PresentationServer(e)}),t=$("<section>").addClass("icon_PresentationServer"),n=$("<section>").append(localizedString("RES_PRESENTATION_SERVER")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.presentationserverCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function _(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_B1i(e)}),t=$("<section>").addClass("icon_B1i"),n=$("<section>").append(localizedString("RES_B1I_SERVER")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.B1iCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function D(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_Mailer(e)}),t=$("<section>").addClass("icon_Mailer"),n=$("<section>").append(localizedString("RES_MAILER_SERVICE")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.mailerCountLabel).append(")");return e.append(t).append(n).append(r),e}function P(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_SharedFolder(e)}),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append("*"+localizedString("RES_SH_FOLDER")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.SharedfolderCountLabel).append(")");return e.append(t).append(n).append(r),e}function H(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_TenantsStorage(e)}),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append("*"+localizedString("RES_TENANTS_STORAGE")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.TenantsStorageCountLabel).append(")");return e.append(t).append(n).append(r),e}function B(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_SharedFolderB1(e)}),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append(localizedString("RES_B1_FOLDER")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.B1sharedfolderCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function j(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_SharedFolderBackup(e)}),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append("*"+localizedString("RES_SHARED_TYPE_DBBACK")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.DBbackuprepositoryCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function F(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_ImplRepository(e)}),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append("*"+localizedString("RES_SHARED_IMPL_REPOSITORY")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.ImplRepositoryCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function I(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_CompanyTemplateRepository(e)}),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append("*"+localizedString("RES_COMPANY_TEMPLATE_REPOSITORY")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.CompanyTemplateRepositoryCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}function q(){var e=$("<div>").css({"float":"none",cursor:"pointer"}).bind("click",function(e){MessageBox_HU(e)}),t=$("<section>").addClass("icon_HU"),n=$("<section>").append(localizedString("HOSTUNIT")).attr({"class":"icon_title"}),r=$("<section>").attr({"class":"icon_title"}).append("(").append(i.huCountLabel).append(")");return e.append($("<div>").css({"float":"none"}).append(t).append(n).append(r)),e}this.base=c3.module,this.base();var n="appmgr_ovr_topology",r=$("<section>").attr({id:n}).css({width:e,height:t+"px"}).addClass("overview_group"),i=this;this.reload=s,this._container=r,i.huCountLabel=$("<label>"),i.SWrepositoryCountLabel=$("<label>"),i.mailerCountLabel=$("<label>"),i.DBinstanceCountLabel=$("<label>"),i.presentationserverCountLabel=$("<label>"),i.licenseserverCountLabel=$("<label>"),i.commonDBCountLabel=$("<label>"),i.B1iCountLabel=$("<label>"),i.B1sharedfolderCountLabel=$("<label>"),i.SharedfolderCountLabel=$("<label>"),i.TenantsStorageCountLabel=$("<label>"),i.DBbackuprepositoryCountLabel=$("<label>"),i.ImplRepositoryCountLabel=$("<label>"),i.CompanyTemplateRepositoryCountLabel=$("<label>"),this.onInit=function(){var e=r.parent(),t=$("<section>").addClass("infobtn_container"),n=$("<section>").addClass("infobtn_container"),i=$("<div>").addClass("element_container2"),o=$("<div>").addClass("element_container2"),u=$("<span>").addClass("seperater").css("height","410px"),a=$("<span>").addClass("seperater").css("height","220px"),f=$("<div>").addClass("element_container_diagram"),l=$("<div>").addClass("element_container_diagram");return i.append(E()),o.append(T()),f.append(x()),l.append(C()),t.append(i).append(u).append(f),n.append(o).append(a).append(l),r.append(t).append(n),s(),c3ModuleManager.Listeners.push(new c3Listener("ReferechOverview",s)),r},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.SoftwareRepositories,function(e){c3.service.getSWRepositories().count().query(u)}),cometdManager.subscribe(sldEntitySet.LicenseServers,function(e){c3.service.getLicenseServers().count().query(c)}),cometdManager.subscribe(sldEntitySet.DatabaseInstances,function(e){c3.service.getDBServerInstances().count().query(f)}),cometdManager.subscribe(sldEntitySet.CommonDatabases,function(e){c3.service.getCommonDBs().count().query(h)}),cometdManager.subscribe(sldEntitySet.PresentationServers,function(e){c3.service.getPresentationServers().count().query(l)}),cometdManager.subscribe(sldEntitySet.SharedFolders,function(e){c3.service.getSharedFolders().count().query(v)}),cometdManager.subscribe(sldEntitySet.TenantsStorages,function(e){c3.service.getTenantsStorages().count().query(m)}),cometdManager.subscribe(sldEntitySet.IntegrationComponents,function(e){c3.service.getB1iServers().count().query(p)}),cometdManager.subscribe(sldEntitySet.ImplementationRepositories,function(e){c3.service.getImplementationRepositories().count().query(y)}),cometdManager.subscribe(sldEntitySet.CompanyTemplateRepositories,function(e){c3.service.getCompanyTemplateRepositories().count().query(w)}),cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){c3.service.getHostingUnits().count().query(o)})}},c3about.welcome=function(e,t){this.base=c3.module,this.base();var n="about_welcome",r=$("<section>").append(localizedString("ABOUT_WELCOME")).addClass("overviewTab_title"),i=$("<section>").attr({id:n}).css({width:e,height:t+"px"}).addClass("img_container_appmgr"),s=this;this._title=r,this._container=i,this.onInit=function(){return i.append(r),i}},c3about.topology=function(e,t){function s(){var e=$("<div>"),t=$("<section>").append(localizedString("HOSTUNIT")).addClass("overviewTab_subtitle"),n=localizedString("MISC_NEW"),r=$("<section>").addClass("icon_HU").css({"float":"left",width:"80px"}),i=$("<section>").append(localizedString("HOSTUNIT_INTRODUCE")).addClass("overviewContent").css({"float":"left",width:"75%"});return e.append(t).append(r).append(i),e}function o(e){var t=new c3huwizard(e);t.show()}function u(){var e=$("<section>"),t=$("<section>").append(localizedString("HU_INF")).addClass("infrastructure_title"),n=$("<section>").append(localizedString("HU_INF_DESCRIPTION")).addClass("overviewContent"),r=$("<div>").append(localizedString("SHARED_COMPONENTS")).addClass("overviewContent"),i=localizedString("OPTIONAL"),s=$("<fieldset>").addClass("subgroup"),o=$("<legend>").append(i),u=$("<section>").addClass("diagram"),a=$("<div>").addClass("element_container"),f=$("<div>").addClass("element_container"),l=$("<div>").addClass("element_container"),w=$("<div>").addClass("element_container"),T=$("<div>").addClass("element_container"),N=$("<div>").addClass("element_container"),C=$("<div>").addClass("element_container"),k=$("<div>").addClass("element_container");element_container_ImplRepository=$("<div>").addClass("element_container"),element_container_CompanyTemplateRepository=$("<div>").addClass("element_container"),element_container_SharedFolder=$("<div>").addClass("element_container"),element_container_TenantsStorage=$("<div>").addClass("element_container");var L=$("<div>").addClass("element_box1"),A=$("<div>").addClass("element_box1"),O=$("<div>").addClass("element_box1"),M=$("<div>").addClass("element_box1"),_=$("<div>").addClass("element_box1"),D=$("<div>").addClass("element_box1"),P=$("<div>").addClass("element_box1"),H=$("<div>").addClass("element_box1"),B=$("<div>").addClass("element_box1").css({width:"95px"});return element_box_CompanyTemplateRepository=$("<div>").addClass("element_box1"),element_box_SharedFolder=$("<div>").addClass("element_box1"),element_box_TenantsStorage=$("<div>").addClass("element_box1"),L.append(c()),A.append(h()),O.append(p()),M.append(d()),_.append(v()),D.append(m()),P.append(g()),H.append(E()),B.append(S()),element_box_CompanyTemplateRepository.append(x()),element_box_SharedFolder.append(y()),element_box_TenantsStorage.append(b()),element_container_ImplRepository.append(B),element_container_CompanyTemplateRepository.append(element_box_CompanyTemplateRepository),N.append(D),element_container_SharedFolder.append(element_box_SharedFolder),element_container_TenantsStorage.append(element_box_TenantsStorage),C.append(P),s.append(o).append(N).append(C).append(element_container_ImplRepository).append(element_container_CompanyTemplateRepository),a.append(L),w.append(O),f.append(A),l.append(M),T.append(_),k.append(H),u.append(a).append(w).append(f).append(l).append(T).append(element_container_SharedFolder).append(element_container_TenantsStorage),e.append(t).append(u).append(s).append(r),e}function a(){var e=$("<div>"),t=$("<section>").append(localizedString("TENANT")).addClass("overviewTab_subtitle"),n=localizedString("MISC_NEW"),r=$("<section>").addClass("icon_Tenant").css({"float":"left",width:"80px"}),i=$("<section>").append(localizedString("TENANT_INTRODUCE")).addClass("overviewContent").css({"float":"left",width:"75%"});return e.append(t).append(r).append(i),e}function f(e){var t=new c3newTenant(e,!0,null,!0);t.show()}function l(){var e=$("<section>");title=$("<section>").append(localizedString("TENANT_INF")).addClass("infrastructure_title"),description=$("<section>").append(localizedString("TENANT_INF_DESCRIPTION")).addClass("overviewContent");var t=$("<div>").addClass("element_container"),n=$("<div>").addClass("element_container"),r=$("<div>").addClass("element_box1"),i=$("<div>").addClass("element_box1");return i.append(w()),r.append(T()),n.append(i),t.append(r),e.append(title).append(t),e}function c(){var e=$("<div>").attr("title",localizedString("SOFTWAREREPO")+" "+localizedString("SOFTWAREREPO_INTRODUCE")),t=$("<section>").addClass("icon_SWRepository"),n=$("<section>").append("*").append(localizedString("SOFTWAREREPO_LF")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}function h(){var e=$("<div>").attr("title",localizedString("RES_MS_SQL")+" "+localizedString("DBINSTANCE_INTRODUCE")),t=$("<section>").addClass("icon_DBInstance"),n=$("<section>").append(localizedString("RES_MS_SQL_LF")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}function p(){var e=$("<div>").attr("title",localizedString("RES_LIC_SERVER")+" "+localizedString("LIC_SERVER_INTRODUCE")),t=$("<section>").addClass("icon_LicenseServer"),n=$("<section>").append("*").append(localizedString("RES_LIC_SERVER_LF")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}function d(){var e=$("<div>").attr("title",localizedString("RES_SBO_COMMON")+" "+localizedString("SBO_COMMON_INTRODUCE")),t=$("<section>").addClass("icon_SBOCOMMON"),n=$("<section>").append(localizedString("RES_SBO_COMMON_LF")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}function v(){var e=$("<div>").attr("title",localizedString("RES_PRESENTATION_SERVER")+" "+localizedString("PRESENTATION_SERVER_INTRODUCE")),t=$("<section>").addClass("icon_PresentationServer"),n=$("<section>").append(localizedString("RES_PRESENTATION_SERVER_LF")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}function m(){var e=$("<div>").attr("title",localizedString("RES_B1I_SERVER")+" "+localizedString("B1I_SERVER_INTRODUCE")),t=$("<section>").addClass("icon_B1i"),n=$("<section>").append(localizedString("RES_B1I_SERVER_LF")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}function g(){var e=$("<div>").attr("title",localizedString("RES_MAILER_SERVICE")+" "+localizedString("MAILER_SERVICE_INTRODUCE")),t=$("<section>").addClass("icon_Mailer"),n=$("<section>").append(localizedString("RES_MAILER_SERVICE")).attr({"class":"icon_title"});return e.append(t).append(n),e}function y(){var e=$("<div>").attr("title",localizedString("RES_SH_FOLDER")+" "+localizedString("RES_FOLDER_INTRODUCE")),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append("*"+localizedString("RES_SH_FOLDER_LF")).attr({"class":"icon_title"});return e.append(t).append(n),e}function b(){var e=$("<div>").attr("title",localizedString("RES_TENANTS_STORAGE")+" "+localizedString("RES_TENANTS_STORAGE_INTRODUCE")),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append("*"+localizedString("RES_TENANTS_STORAGE_LF")).attr({"class":"icon_title"});return e.append(t).append(n),e}function w(){var e=$("<div>").attr("title",localizedString("RES_B1_FOLDER")+" "+localizedString("RES_B1_FOLDER_INTRODUCE")),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append(localizedString("RES_B1_FOLDER")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}function E(){var e=$("<div>").attr("title",localizedString("RES_SHARED_TYPE_DBBACK")+" "+localizedString("RES_SHARED_TYPE_DBBACK_INTRODUCE")),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append("*"+localizedString("RES_SHARED_TYPE_DBBACK_LF")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}function S(){var e=$("<div>").attr("title",localizedString("RES_SHARED_IMPL_REPOSITORY")+" "+localizedString("RES_IMPL_REPOSITORY")),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append("*"+localizedString("RES_SHARED_IMPL_REPOSITORY_LF")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}function x(){var e=$("<div>").attr("title",localizedString("RES_COMPANY_TEMPLATE_REPOSITORY")+" "+localizedString("RES_CPY_TEMP_REPOSITORY")),t=$("<section>").addClass("icon_SharedFolder"),n=$("<section>").append("*"+localizedString("RES_COMPANY_TEMPLATE_REPOSITORY_LF")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}function T(){var e=$("<div>"),t=$("<section>").addClass("icon_HU"),n=$("<section>").append(localizedString("HOSTUNIT")).attr({"class":"icon_title"});return e.append($("<div>").css({"float":"none"}).append(t).append(n)),e}this.base=c3.module,this.base();var n="about_topology",r=$("<section>").attr({id:n}).css({width:e,height:t+"px"}).addClass("overview_group"),i=this;this._container=r,i.huCountLabel=$("<label>"),i.SWrepositoryCountLabel=$("<label>"),i.mailerCountLabel=$("<label>"),i.DBinstanceCountLabel=$("<label>"),i.presentationserverCountLabel=$("<label>"),i.licenseserverCountLabel=$("<label>"),i.commonDBCountLabel=$("<label>"),i.B1iCountLabel=$("<label>"),i.B1sharedfolderCountLabel=$("<label>"),i.SharedfolderCountLabel=$("<label>"),i.TenantsStorageCountLabel=$("<label>"),i.DBbackuprepositoryCountLabel=$("<label>"),i.ImplRepositoryCountLabel=$("<label>"),i.CompanyTemplateRepositoryCountLabel=$("<label>"),this.onInit=function(){var e=r.parent(),t=$("<section>").addClass("infobtn_container"),n=$("<section>").addClass("infobtn_container"),i=$("<div>").addClass("element_container2"),o=$("<div>").addClass("element_container2"),f=$("<span>").addClass("seperater").css("height","410px"),c=$("<span>").addClass("seperater").css("height","220px"),h=$("<div>").addClass("element_container_diagram"),p=$("<div>").addClass("element_container_diagram");return i.append(s()),o.append(a()),h.append(u()),p.append(l()),t.append(i).append(f).append(h),n.append(o).append(c).append(p),r.append(t).append(n),r}},c3infmgroverview.welcome=function(e,t){this.base=c3.module,this.base();var n="infmgr_ovr_welcome",r=$("<section>").append(localizedString("INFMGR_OVERVIEW_WELCOME")).addClass("overviewTab_title"),i=$("<section>").attr({id:n}).css({width:e,height:t+"px"}).addClass("img_container_infmgr"),s=this;this._title=r,this._container=i,this.onInit=function(){return i.append(r),i}},c3infmgroverview.SW=function(e,t){function o(e){var t=$("<section>").addClass("row_description"),n=$("<section>").append(localizedString("US_NAME")).addClass("row_description_title"),r=$("<section>").append(localizedString("US_POP_DESC")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),t.append(n).append(r).append(row_btnContainer),t}function u(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("EXTENSION")).addClass("row_description_title"),i=$("<section>").append(localizedString("EXTENSION_INTRODUCE")).addClass("row_description_introduce"),s=localizedString("MISC_SYNC"),o=$("<div>").addClass("row_btnContainer");return o.append($("<input>").attr({value:s,type:"button",id:n+"btnSynchronize"}).click(function(){a(e)})),t.append(r).append(i).append(o),t}function a(e){c3.biz.repositoryManager.getExtensionRepository(function(t){var n=MessageBox.confirm(String.format(localizedString("RES_MISC_SYNC_CONFIRM"),localizedString("EXTENSION_LOWER")));n.yesEvent.push(function(){if(!t){var n=new c3setExtensionPath(e,t,!0);n.show(),s.extPathWin=n}else c3.service.synchronizeExtensionRepository(e,function(e,t){if(t=="success"){taskId=e.d.SynchronizeExtensionRepository;var n={};n.taskID=taskId;var r=new c3extensionSyncReportList(n);r.show()}if(t=="error"){var i=retriveErrorCode(e.responseText),s=retriveErrorCode(e.responseText);(i=="9107"||i=="9106")&&c3.service.getCurrentTaskId(function(e){var t={},n={};n.taskID=e.d.CurrentExtensionSynchronizationTaskId,t.hideNo=!0,t.hideFinish=!1,t.oktext=localizedString("MISC_OK");var r=MessageBox.confirm({msg:localizedString("RES_MISC_SYNC_PROCESSING"),width:320,height:130});r.yesEvent.push(function(){var e=new c3extensionSyncReportList(n);e.show()})})}})}),t})}function f(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("SOFTWAREREPO")).addClass("row_description_title"),i=$("<section>").append(localizedString("SOFTWAREREPO_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){l(e)})),t.append(r).append(i).append(row_btnContainer),t}function l(e){var t=new c3newSWRepository(e);t.show()}function c(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("RES_LIC_SERVER")).addClass("row_description_title"),i=$("<section>").append(localizedString("LIC_SERVER_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){h(e)})),t.append(r).append(i).append(row_btnContainer),t}function h(e){var t=new c3registerLicenseServer(e);t.show()}function p(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("RES_IMPL_RSTY")).addClass("row_description_title"),i=$("<section>").append(localizedString("RES_IMPL_REPOSITORY")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){b(e)})),t.append(r).append(i).append(row_btnContainer),t}function d(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("RES_CPY_TEMP_RSTY")).addClass("row_description_title"),i=$("<section>").append(localizedString("RES_CPY_TEMP_REPOSITORY")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){w(e)})),t.append(r).append(i).append(row_btnContainer),t}function v(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("RES_SH_FOLDER")).addClass("row_description_title"),i=$("<section>").append(localizedString("RES_FOLDER_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){g(e)})),t.append(r).append(i).append(row_btnContainer),t}function m(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("RES_TENANTS_STORAGE")).addClass("row_description_title"),i=$("<section>").append(localizedString("RES_TENANTS_STORAGE_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){y(e)})),t.append(r).append(i).append(row_btnContainer),t}function g(e){var t="SharedFolder",n=new c3registerB1Share(t,e);n.show()}function y(e){var t="TenantsStorage",n=new c3registerB1Share(t,e);n.show()}function b(e){var t="ImplementationRepository",n=new c3registerB1Share(t,e);n.show()}function w(e){var t="CompanyTemplateRepository",n=new c3registerB1Share(t,e);n.show()}this.base=c3.module,this.base();var n="infmgr_ovr_SW",r=$("<section>").append(localizedString("OVERVIEW_SW")).addClass("overviewTab_subtitle"),i=$("<section>").attr({id:n}).css({width:e,height:t+"px"}).addClass("infobtn_container"),s=this;this._title=r,this._container=i,i.append(r),this.onInit=function(){var e=i.parent(),t=$("<div>").addClass("row_group"),n=$("<div>").addClass("row_container"),r=$("<div>").addClass("row_container"),s=$("<div>").addClass("row_container"),a=$("<div>").addClass("row_container"),l=$("<div>").addClass("row_container"),h=$("<div>").addClass("row_container"),g=$("<div>").addClass("row_container"),y=$("<div>").addClass("row_container"),b=$("<div>").addClass("icon_SWRepository").css({width:"80px"}).css({"float":"left"}),w=$("<div>").addClass("icon_LicenseServer").css({width:"80px"}).css({"float":"left"}),E=$("<div>").addClass("icon_SharedFolder").css({width:"80px"}).css({"float":"left"}),S=$("<div>").addClass("icon_SharedFolder").css({width:"80px"}).css({"float":"left"}),x=$("<div>").addClass("icon_SharedFolder").css({width:"80px"}).css({"float":"left"}),T=$("<div>").addClass("icon_SharedFolder").css({width:"80px"}).css({"float":"left"}),N=$("<div>").addClass("icon_SharedFolder").css({width:"80px"}).css({"float":"left"}),C=$("<div>").addClass("icon_SharedFolder").css({width:"80px"}).css({"float":"left"});return n.append(b),n.append(f()),r.append(w),r.append(c()),s.append(E),s.append(p()),a.append(S),a.append(d()),l.append(x),l.append(v()),h.append(T),h.append(m()),g.append(N),g.append(u),y.append(C).append(o),t.append(n).append(r).append(s).append(a).append(l).append(h).append(g).append(y),i.append(t),i}},c3infmgroverview.b1central=function(e,t){function o(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("RES_PRESENTATION_SERVER")).addClass("row_description_title"),i=$("<section>").append(localizedString("PRESENTATION_SERVER_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<section>").addClass("row_btnContainer"),e.reload=function(){},row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){u(e)})),t.append(r).append(i).append(row_btnContainer),t}function u(e){var t=new c3registerPresServer(e);t.show()}function a(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("RES_MS_SQL")).addClass("row_description_title"),i=$("<section>").append(localizedString("DBINSTANCE_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<section>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){f(e)})),t.append(r).append(i).append(row_btnContainer),t}function f(e){var t=new c3registerMSSql(e);t.show()}function l(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("RES_SBO_COMMON")).addClass("row_description_title"),i=$("<section>").append(localizedString("SBO_COMMON_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),createTxt=localizedString("MISC_CREATE"),row_btnContainer=$("<div>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){h(e)})),row_btnContainer.append($("<input>").attr({value:createTxt,type:"button",id:n+"btnCreate"}).click(function(){c(e)})),t.append(r).append(i).append(row_btnContainer),t}function c(e){var t=new c3newSBOCommon(e);t.show()}function h(e){var t=new c3registerSBOCommon(e);t.show()}function p(e){var t=$("<section>").addClass("row_description"),r=$("<section>").append(localizedString("RES_B1I_SERVER")).addClass("row_description_title"),i=$("<section>").append(localizedString("B1I_SERVER_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){d(e)})),t.append(r).append(i).append(row_btnContainer),t}function d(e){var t=new c3registerB1i(e);t.show()}function v(e){var t=$("<section>").addClass("row_description"),n=$("<section>").append(localizedString("RES_MAILER_SERVICE")).addClass("row_description_title"),r=$("<section>").append(localizedString("MAILER_SERVICE_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),t.append(n).append(r),t}function m(e){var t=new c3registerMailer(e);t.show()}function g(e){var t="BackupRepository",r=$("<section>").addClass("row_description"),i=$("<section>").append(localizedString("RES_SHARED_TYPE_DBBACK")).addClass("row_description_title"),s=$("<section>").append(localizedString("RES_SHARED_TYPE_DBBACK_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){b(t,e)})),r.append(i).append(s).append(row_btnContainer),r}function y(e){var t="SBOSharedFolder",r=$("<section>").addClass("row_description"),i=$("<section>").append(localizedString("RES_B1_FOLDER")).addClass("row_description_title"),s=$("<section>").append(localizedString("RES_B1_FOLDER_INTRODUCE")).addClass("row_description_introduce");return regTxt=localizedString("MISC_REGISTER"),row_btnContainer=$("<div>").addClass("row_btnContainer"),row_btnContainer.append($("<input>").attr({value:regTxt,type:"button",id:n+"btnRegister"}).click(function(){b(t,e)})),r.append(i).append(s).append(row_btnContainer),r}function b(e,t){var n=new c3registerB1Share(e,t);n.show()}this.base=c3.module,this.base();var n="infmgr_ovr_b1central",r=$("<section>").append(localizedString("OVERVIEW_B1CENTRAL")).addClass("overviewTab_subtitle"),i=$("<section>").attr({id:n}).css({width:e,height:t+"px"}).addClass("infobtn_container"),s=this;this._title=r,this._container=i,i.append(r),this.onInit=function(){var e=i.parent(),t=$("<div>").addClass("row_group"),n=$("<div>").addClass("row_container"),r=$("<div>").addClass("row_container"),u=$("<div>").addClass("row_container"),f=$("<div>").addClass("row_container"),c=$("<div>").addClass("row_container"),h=$("<div>").addClass("row_container"),d=$("<div>").addClass("row_container"),m=$("<div>").addClass("icon_PresentationServer").css({width:"80px"}).css({"float":"left"}),b=$("<div>").addClass("icon_DBInstance").css({width:"80px"}).css({"float":"left"}),w=$("<div>").addClass("icon_SBOCOMMON").css({width:"80px"}).css({"float":"left"}),E=$("<div>").addClass("icon_B1i").css({width:"80px"}).css({"float":"left"}),S=$("<div>").addClass("icon_Mailer").css({width:"80px"}).css({"float":"left"}),x=$("<div>").addClass("icon_SharedFolder").css({width:"80px"}).css({"float":"left"}),T=$("<div>").addClass("icon_SharedFolder").css({width:"80px"}).css({"float":"left"});return n.append(m),n.append(o(s)),r.append(b),r.append(a()),u.append(w),u.append(l()),f.append(E),f.append(p()),c.append(S),c.append(v()),h.append(x),h.append(g()),d.append(T),d.append(y()),t.append(n).append(r).append(u).append(c).append(f),i.append(t),i}};var respool=respool||{},respoolCommon={createHUPanel:function(e){var t=$("<section>").attr({id:e.id+"_usedByHUs"}),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"5%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"15%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"15%"},{name:"CustomerNumber",description:localizedString("COLUMN_CUSTOMER_NO"),type:"text",width:"15%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"40%"}];e.huData=[];var r={getHeaderSpec:function(){return n},getRowCount:function(){return e.huData.length},getRow:function(t){return e.huData[t]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}},i=$(t).gridview({delegate:r});return i.show(),e.usedByHUsDataGrid=i,t.append(i),t},createTenantPanel:function(e){var t=$("<section>").attr({id:e.id+"_usedByTenants"}),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"5%"},{name:"CompanyDatabase_CompanyName",description:localizedString("TENANT"),type:"text",width:"15%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"15%"},{name:"Customer_Name",description:localizedString("CUSTOMER"),type:"text",width:"15%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"15%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"35%"}];e.tenantData=[];var r={getHeaderSpec:function(){return n},getRowCount:function(){return e.tenantData.length},getRow:function(t){return e.tenantData[t]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(){var e=null;if(this.colName=="Status"||this.colName=="Mode"){var t=$("<div>"),n=$("<label>").addClass("ShowIcon").addClass(this.data[this.colName]);this.colName=="Mode"?n.append(this.data[this.colName]):t.css({"text-align":"center"}),t.append(n),e=t}return e}},i=$(t).gridview({delegate:r});return i.show(),e.usedByTenantsDataGrid=i,t.append(i),t}},respool=respool||{};respool.mssqls=function(){function l(){o.refreshPaging=!0;var e=c3.service.getDBServerInstances().expand("Machine");e.count().query(o.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(o.pageSize).skip(i*o.pageSize)),e.query(function(e){var t=c3.service.convertData(e.data);c3.service.getCachedDBInstanceMonitorStatus(null,{success:function(e){if(e.d.results)for(var n=0;n<e.d.results.length;n++)for(var r=0;r<t.length;r++)e.d.results[n].ID==t[r].ID&&(t[r].MonitorStatus=e.d.results[n].Status,t[r].monitorStatusCode=e.d.results[n].StatusCode,t[r].cachedMessageList=monitorUtil.buildMessageList(e.d.results[n].Messages.results));d(t)},error:function(e){d(t)}})})}function c(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),i=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),s=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),a=localizedString("RES_MS_SQL");o.btnDelete=i,m(),i.click(function(){if(u!=null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),a));e.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload())},c3.service.deleteDBServerInstance(u,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),a))}),s.click(function(){o.reload()}),t.append($("<input>").attr({value:n,type:"button",id:e+"btnRegister"}).click(function(){h(o)}));var f=new searchbox({inputCallback:function(e){return o.dataGrid.searchText(e)}});return t.append($("<span>").addClass("split")),t.append(i),t.append($("<div>").css({"float":"right"}).append(f.css({"float":"left"})).append(s)),t}function h(e){var t=new c3registerMSSql(e);t.show()}function p(){var t=$("<section>").attr({id:e+"_masterDataGrid"}),n=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"20%"},{name:"ServerType",description:localizedString("COLUMN_DB_TYPE"),type:"text",width:"14%"},{name:"Machine_Hostname",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"15%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"36%"}];o.data=[];var r={pagingMode:!0,pageSize:o.pageSize,autoResize:function(){return 550},getHeaderSpec:function(){return n},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return a},getCell:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],this.colName=="LifeCycleStatus"?t.showText=!0:t.textalign="center",e=new statusControl(t)}else{if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),monitorUtil.retrieveDBInstanceStatus(n,r,r.Name),n.c3tip({messageList:r.cachedMessageList}),n}if(this.colName=="ServerType")return localizedString(this.data.ServerType)}return e},getTotalCount:function(){return o.totalCount},loadPage:function(e,t){c3.service.getDBServerInstances().expand("Machine").orderby("ID desc").skip(e).top(t).query({success:function(e){o.data.clear();for(var t=0;t<e.data.length;t++)o.data.push(e.data[t]);o.data=c3.service.convertData(o.data),g(a),o.dataGrid.refreshContent()},error:function(e){o.loadingWindow.close()}})}};o.gridDelegate=r;var i=$(t).gridview({delegate:r});return i.rowSelectedEvent.push(function(){a!=this.index&&g(this.index),v()}),o.dataGrid=i,t}function d(e){o.data=e,o.data.length==0?(o.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RES_MS_SQL"),function(){h(o)})},m()):a==-1?m():v(),o.dataGrid.reload(),o.data.length>0&&a!=-1?g(a):f[0].bindData({})}function v(){o.btnDelete.attr({disabled:0})}function m(){o.btnDelete.attr({disabled:1})}function g(e){a=e,u=o.data[e],f[0].onViewWillAppear(),f[0].bindData(o.data[e])}this.base=c3.module,this.base();var e="respool_mssqls",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.mssqls_detail(this)];o.id=e,o.pageSize=10,o.totalCount=0,o.refreshPaging=!1,this._container=t,this.getTitle=function(){return localizedString("RES_MS_SQLS")},this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(o.getTitle())),t.append(c()),t.append(p());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),o.reload()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.DatabaseInstances,function(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){o.reload();break}}else o.reload()})},this.getSelectedItem=function(){return u},this.onViewAppear=function(){o.dataGrid.show()},this.reload=l,o.countHandler={success:function(e){o.totalCount=parseInt(e.data,10)},error:function(e){}}},respool.mssqls_detail=function(){function c(){var e=l.getSelectedItem();if(e&&e.CommonDatabases!=undefined){var t=c3.service.getDetail(e.CommonDatabases);Utility.SplitPage||(t=t.top(f).skip(a*f)),t.query(p)}}function h(){var e=l.getSelectedItem();if(e&&e.ID!=undefined){var t=c3.service.getHostingUnits().expand("Tenants").filter("CommonDatabase/DatabaseInstance/ID eq "+e.ID);Utility.SplitPage||(t=t.top(u).skip(o*u)),t.query(d)}}function p(e){i.commonDBData=e.data,i.commonDBDataGrid.reload()}function d(e){for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;i.huData=e.data,i.usedByHUsDataGrid.reload(),i.subTitle.html(localizedString("RES_HU_NUM")+": "+i.huData.length)}function v(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function m(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+": ");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(g()),t.append(y()),t.append(respoolCommon.createHUPanel(i)),t.append(c3log.createAdminData(i)),t}function g(){var t=e+"_config",n=$("<section>").attr({id:t}),r=[];i.statusData=[],i.authenticatin=[],i.lifeCycleStatusData=[],i.dbTypeData=[];var s=[{id:"testConnection",text:localizedString("MISC_TEST_CONNECTION"),type:"button",render:function(){var e=$("<div>").css({display:"inline"});i.configPanel=e;var t=$("<input>").attr({type:"button",value:localizedString("MISC_TEST_CONNECTION")});return t.click(function(){t.attr({disabled:1}),1<e.children().length?$(e.children()[1]).attr({src:c3Icon.Loading}):e.append($("<img>").attr({src:c3Icon.Loading}));var n={};n.error=function(n){1<e.children().length?$(e.children()[1]).attr({src:c3Icon.Failed,title:retriveErrorMessage(n.data.response)}):e.append($("<img>").attr({src:c3Icon.Failed,title:retriveErrorMessage(n.data.response)})),t.attr({disabled:0})},n.success=function(n){n.d.TestDBServerConnection?1<e.children().length?$(e.children()[1]).attr({src:c3Icon.Success}):e.append($("<img>").attr({src:c3Icon.Success})):1<e.children().length?$(e.children()[1]).attr({src:c3Icon.Failed}):e.append($("<img>").attr({src:c3Icon.Failed})),t.attr({disabled:0})},c3.service.testConnectDBServer(i.dataform.getDataSource().Name,null,null,null,null,n)}),e.append(t),i.btnTestConnection=t,e},handler:function(){}}],o=[{id:"name",text:localizedString("COLUMN_MSSQL_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"dbType",text:localizedString("COLUMN_DB_TYPE"),binding:"ServerType",type:"label",readonly:!0,"class":"chrome2",editable:!1,editSetting:{controlType:"select",data:i.dbTypeData}},{id:"hostName",text:localizedString("COLUMN_HOSTNAME"),binding:"Machine_Hostname",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0},{id:"authentication",text:localizedString("COLUMN_AUTH"),binding:"Authentication_Type",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.authenticatin}},{id:"userName",text:localizedString("COLUMN_USERNAME"),binding:"Username",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"password",text:localizedString("COLUMN_PASSWORD"),binding:"Password",type:"password",readonly:!0,"class":"chrome2",editable:!0}];r.push(o),o=[{id:"installationPath",text:localizedString("RESPOOL_DBINSTANCE_COLUMN_INSTALLPATH"),binding:"InstallationPath",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"backupFolder",text:localizedString("RESPOOL_DBINSTANCE_COLUMN_BKFOLDER"),binding:"BackupFilePath",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"logFolder",text:localizedString("RESPOOL_DBINSTANCE_COLUMN_LOGFOLDER"),binding:"LogFilePath",type:"text",readonly:!0,"class":"chrome2",editable:!0}];var u={getToolbarItems:function(){return s},getColumns:function(){return r},getViewContent:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}else this.colName=="ServerType"&&(e=$("<label>").append(localizedString(this.data.ServerType)));return e}},a=$(n).dataform({delegate:u});return i.dataform=a,n}function y(){var t=$("<section>").attr({id:e+"_commonDB"}),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"10%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"76%"}];i.commonDBData=[];var r={getHeaderSpec:function(){return n},getRowCount:function(){return i.commonDBData.length},getRow:function(e){return i.commonDBData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t=$("<div>"),n=$("<label>").addClass("ShowIcon").addClass(this.data[this.colName]);this.colName=="LifeCycleStatus"?n.append(this.data[this.colName]):t.css({"text-align":"center"}),t.append(n),e=t}return e}},s=$(t).gridview({delegate:r});return s.show(),s.rowSelectedEvent.push(function(){onRowSelected(this.index)}),i.commonDBDataGrid=s,t}this.base=c3.module,this.base();var e="respool_mssqls_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RES_MS_SQL"),localizedString("RES_DETAILS")),r=[localizedString("MISC_CONFIGURATION"),localizedString("RES_SBO_COMMON"),localizedString("RES_USED_BY_HU")],i=this,s=localizedString("RES_MS_SQL"),o=0,u=5,a=0,f=5,l=arguments[0]||{};i.configPanel=null,this._container=t,this.onInit=function(){i.detailTitle=$("<h1>").append(n),t.append(i.detailTitle),t.append(v()),t.append(m());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==2?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.CommonDatabases,function(e){c()}),cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){h()})},this.refreshTitle=function(e){i.detailTitle.text(n+": "+e)},this.bindData=function(e){i.title.text(s+": "+parse(e.Name)),i.dataform.submit=function(e,t){var n={};n.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),l.reload()),t(!0)},e.Authentication_Type==localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")&&(e.IsTrustedConnection=!0),e.Authentication_Type==localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")&&(e.IsTrustedConnection=!1),e.Authentication_Type=undefined,c3.service.updateDBServerInstance(e,n)},i.dataform.afterEdit.push(function(){body.find("#authentication").val()==localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")&&(body.find("#userName").attr({readonly:!0}),body.find("#password").attr({readonly:!0})),body.find("#authentication").bind("change",function(){body.find("#authentication").val()==localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")?(body.find("#userName").val(""),body.find("#password").val(""),body.find("#userName").attr({readonly:!0}),body.find("#password").attr({readonly:!0})):(body.find("#userName").val(""),body.find("#password").val(""),body.find("#userName").attr({readonly:!1}),body.find("#password").attr({readonly:!1}))})}),e.Authentication_Type=e.IsTrustedConnection?localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN"):localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN"),i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getDBStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),i.authenticatin.clear(),e.ServerType!=undefined&&e.ServerType.indexOf("HANA")==-1&&i.authenticatin.push({text:localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN"),value:localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")}),i.authenticatin.push({text:localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN"),value:localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")}),i.lifeCycleStatusData.clear(),c3.service.getDBLifeCycleStatus(function(e){for(var t=0;t<e.data.length;t++)i.lifeCycleStatusData.push({text:e.data[t],value:e.data[t]})}),i.dbTypeData.clear(),c3.service.getDBTypes(function(e){for(var t=0;t<e.data.length;t++)i.dbTypeData.push({text:e.data[t],value:e.data[t]})}),c(),h(),e.ID!=undefined?i.btnTestConnection.attr({disabled:0}):i.btnTestConnection.attr({disabled:1})}};var respool=respool||{};respool.licenseServers=function(){function l(){o.refreshPaging=!0;var e=c3.service.getLicenseServers().expand("Machine"),t;e.count().query(o.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(o.pageSize).skip(i*o.pageSize)),e.query(c)}function c(e){c3.service.retrieveWorkstations().query(function(t){if(t.data&&t.data.length>0)for(var n=0;n<t.data.length>0;n++)for(var r=0;r<e.data.length;r++)if(t.data[n].Hostname==e.data[r].Machine.Hostname){e.data[r].SLDAgentStatus=t.data[n].Status;continue}e.data.length>0&&h(e)})}function h(e){c3.service.getLicenseServerCachedStatus(null,{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(n[i].ID==t.d.results[r].ID){n[i].AvailableStatus={result:t.d.results[r].Status},n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].cachedMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);if(t.d.results[r].Status==localizedString("MONITOR_STATUS_AVAILABLE"))break}m(n)},error:function(t){var n=c3.service.convertData(e.data);m(n)}})}function p(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),i=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),s=$("<div>").css({display:"inline"}),a=$("<input>").attr({value:"Sync",type:"button",id:e+"btnSync"});a.click(function(){a.attr({disabled:1}),1<s.children().length?$(s.children()[1]).attr({src:c3Icon.Loading}).css({display:"inline"}):s.append($("<img>").attr({src:c3Icon.Loading}));var e={};e.error=function(e){1<s.children().length?(o.resultIcon=s.children()[1],$(s.children()[1]).attr({src:c3Icon.Failed,title:retriveErrorMessage("license server "+e.statusText)}).css({display:"inline"})):(o.resultIcon=$("<img>"),s.append(o.resultIcon.attr({src:c3Icon.Failed,title:retriveErrorMessage("license server "+e.statusText)}))),a.attr({disabled:0})},e.success=function(e){e.d.SyncLicenseFiles?(1<s.children().length?(o.resultIcon=s.children()[1],$(s.children()[1]).attr({src:c3Icon.Success}).css({display:"inline"})):(o.resultIcon=$("<img>"),s.append(o.resultIcon.attr({src:c3Icon.Success}))),f[0].reload()):1<s.children().length?$(s.children()[1]).attr({src:c3Icon.Failed}).css({display:"inline"}):s.append($("<img>").attr({src:c3Icon.Failed})),a.attr({disabled:0})},c3.service.syncLicenseFiles(u.ID,e)}),s.append(a);var l=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),c=localizedString("RES_LIC_SERVER");o.btnDelete=i,o.btnSync=a,y(),i.click(function(){if(u!=null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),c));e.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload())};var t={ID:u.ID};c3.service.deleteLicenseServer(t,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),c))}),l.click(function(){o.reload()}),t.append($("<input>").attr({value:n,type:"button",id:e+"btnRegister"}).click(function(){d(o)}));var h=new searchbox({inputCallback:function(e){return o.dataGrid.searchText(e)}});return t.append($("<span>").addClass("split")),t.append(i),t.append(s),t.append($("<div>").css({"float":"right"}).append(h.css({"float":"left"})).append(l)),t}function d(e){var t=new c3registerLicenseServer(e);t.show()}function v(){var n=$("<section>").attr({id:e+"_masterDataGrid"}),r=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"20%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"16%"},{name:"Machine_Hostname",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"15%"},{name:"Port",description:localizedString("COLUMN_PORT_NO"),type:"text",width:"8%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"31%"},{name:"SLDAgentStatus",description:localizedString("RES_SLD_AGENT_STATUS"),type:"text",width:"19%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"15%"}];o.data=[];var i={pagingMode:!0,pageSize:o.pageSize,autoResize:function(){return 550},getHeaderSpec:function(){return r},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return a},getCell:function(){var e=null,n={},r,i=this.data.Machine_Hostname;if(this.colName=="Status"||this.colName=="LifeCycleStatus")this.data&&(n.text=this.data[this.colName],this.colName=="LifeCycleStatus"?n.showText=!0:n.textalign="center",e=new statusControl(n));else if(this.colName==="SLDAgentStatus")n.text=this.data[this.colName],n.textalign="center",e=new statusControl(n);else{if(this.colName=="Result"){var u=this.data,a=this.index,f=this.data.ID,l=$("<div>");return c3.service.getTasks().filter("TaskType eq 'DeployLicenseServerRoot' and (Status eq 'Processing' or Status eq 'Pending') and ResourceID eq "+f).expand("TaskParameters").query(function(e){if(e.data&&e.data.length>0){var n=e.data[0].ID,r=[];r.push(function(e){var r=e.c3progressWithStatus(function(e){return function(){return s(r,e,t)}}(n),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0});return r}(l));for(var i=0,u=r.length;i<u;i++)0==i&&r[i].start(),i<u-1?r[i].finishEvent.push(function(e){return function(t){e.start()}}(r[i+1])):r[i].finishEvent.push(function(e){return function(e){o.reload()}}(r[i]))}}),l}if(this.colName==="MonitorStatus"){n.textalign="center";var c=$("<label>"),h=this.data;monitorUtil.statusPreparation(n,h.AvailableStatus.result,h),c=new statusControl(n),monitorUtil.retrieveLicenseMonitorStatus(c,h,h.ID),c.c3tip({messageList:h.cachedMessageList})}}return c},getTotalCount:function(){return o.totalCount},loadPage:function(e,t){c3.service.getLicenseServers().expand("Machine").orderby("ID desc").skip(e).top(t).query({success:function(e){o.data.clear();for(var t=0;t<e.data.length;t++)o.data.push(e.data[t]);o.data=c3.service.convertData(o.data),b(a),o.dataGrid.refreshContent()},error:function(e){o.loadingWindow.close()}})}},s=function(e,t,n){c3.service.getTaskProgress(t).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase().toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(t).expand("TaskParameters").query(function(t){e.setFailed(t.data.ResultDescription),Utility.logTaskError(t.data)}):"SUCCESSFUL"==i[0].toUpperCase()?(e.setValue(100),n.data.errorLabel!=null&&n.data.errorLabel.text(0)):(i[0]!="Pending"&&i[0]!="Done"?i[0]=localizedString("MISC_TASK_PROCESSING"):i[0]=="Pending"&&(i[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),e.setValue(parseInt(i[1]),i[0]))})};o.gridDelegate=i;var u=$(n).gridview({delegate:i});return u.rowSelectedEvent.push(function(){a!=this.index&&b(this.index),g()}),o.dataGrid=u,n}function m(e){o.data=e,o.data.length==0?(o.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RES_LIC_SERVER"),function(){d(o)})},y()):a==-1?y():g(),o.dataGrid.reload(),o.data.length>0&&a!=-1?b(a):f[0].bindData({})}function g(){o.btnDelete.attr({disabled:0}),o.btnSync.attr({disabled:0})}function y(){o.btnDelete.attr({disabled:1}),o.btnSync.attr({disabled:1})}function b(e){a=e,u=o.data[e],f[0].onViewWillAppear(),f[0].bindData(o.data[e]),o.resultIcon&&$(o.resultIcon).css("display","none")}this.base=c3.module,this.base();var e="respool_licenseServers",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.licenseServers_detail(this)];o.pageSize=10,o.totalCount=0,o.refreshPaging=!1,this._container=t,this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(o.getTitle())),t.append(p()),t.append(v());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-LicenseServer",l)),l()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.LicenseServers,function(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){o.reload();break}}else o.reload()})},this.getSelectedItem=function(){return u},this.onViewAppear=function(){o.dataGrid.show()},this.reload=l,o.countHandler={success:function(e){o.totalCount=parseInt(e.data,10)},error:function(e){}},this.getTitle=function(){return localizedString("RES_LIC_SERVERS")}},respool.licenseServers_detail=function(){function h(){var e=c.getSelectedItem();e&&i.bindData(e)}function p(){var e=c.getSelectedItem();if(e&&e.LicenseFiles!=undefined){var t=c3.service.getDetail(e.LicenseFiles).expand("LicenseServer");Utility.SplitPage||(t=t.top(l).skip(f*l)),t.query(v)}else v({data:null})}function d(){var e=c.getSelectedItem();if(e&&e.ID!=undefined){var t=c3.service.getHostingUnits().expand("Tenants").filter("LicenseServer/ID eq "+e.ID);Utility.SplitPage||(t=t.top(a).skip(u*a)),t.query(m)}}function v(e){var t=c3.service.convertData(e.data),n=0,r,s=0,u,a=[];if(e.data&&e.data.length==0){i.licenseFilesData=[],i.licenseFilesDataGrid.reload();return}for(r=t.length;n<r;n++){u=t[n];var f={licenseFile:t[n],success:function(e){s++;if(e.d.results!==undefined&&e.d.results.length>0){this.licenseFile.Reseller="";for(var n=0;n<e.d.results.length;n++)n!=0?this.licenseFile.Reseller+="; "+e.d.results[n].Name:this.licenseFile.Reseller+=e.d.results[n].Name}a.push(this.licenseFile),t.length===s&&(i.licenseFilesData=a,i.licenseFilesDataGrid.reload(),t&&t.length>0?o=t[0]:o=null)},error:function(e){s++,console.log(e)}};c3.service.getAssigningResellers("License",u.ID,f)}}function m(e){for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;i.huData=e.data,i.usedByHUsDataGrid.reload(),i.subTitle.html(localizedString("RES_HU_NUM")+": "+i.huData.length)}function g(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function y(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+": ");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(b()),t.append(w()),t.append(respoolCommon.createHUPanel(i)),t.append(c3log.createAdminData(i)),t}function b(){var t=e+"_config",n=$("<section>").attr({id:t}),r={id:"btnDeploy",text:localizedString("RES_UPGRADE"),type:"button",render:function(){var e=$("<div>").css({display:"inline"}),t=$("<input>").attr({type:"button",value:this.text});return t.click(function(){var e=$("<div>"),t=localizedString("DPYLS_WARNING_MSG");e.html(t+"<br/>");var n=MessageBox.show({msg:e,width:400,height:185,icon:MessageBoxIcon.WARNING,buttons:MessageBoxButton.YESNO});n.yesEvent.push(function(){var e=new C3SoftwareRepositoryList(c);e.finishEvent.push(function(){i.reload()}),e.show()})}),e.append(t),i.btnDeploy=t,e}},s=[{id:"testConnection",text:localizedString("MISC_TEST_CONNECTION"),type:"button",render:function(){var e=$("<div>").css({display:"inline"}),t=$("<input>").attr({type:"button",value:localizedString("MISC_TEST_CONNECTION")});return t.click(function(){t.attr({disabled:1}),1<e.children().length?$(e.children()[1]).attr({src:c3Icon.Loading}).css("display","inline"):e.append($("<img>").attr({src:c3Icon.Loading}).css("display","inline"));var n={};n.error=function(n){1<e.children().length?$(e.children()[1]).attr({src:c3Icon.Failed,title:retriveErrorMessage("license server "+n.statusText)}).css("display","inline"):e.append($("<img>").attr({src:c3Icon.Failed,title:retriveErrorMessage("license server "+n.statusText)}).css("display","inline")),t.attr({disabled:0})},n.success=function(n){n.d.TestConnection?1<e.children().length?$(e.children()[1]).attr({src:c3Icon.Success}).css("display","inline"):e.append($("<img>").attr({src:c3Icon.Success}).css("display","inline")):1<e.children().length?$(e.children()[1]).attr({src:c3Icon.Failed}).css("display","inline"):e.append($("<img>").attr({src:c3Icon.Failed}).css("display","inline")),t.attr({disabled:0})},c3.service.testConnectLicenseServerByID(i.dataform.getDataSource().ID,n)}),e.append(t),i.btnTestConnection=t,e},handler:function(){}}];s.push(r);var o=[];i.statusData=[],i.lifeCycleStatusData=[];var u=[{id:"name",text:localizedString("COLUMN_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"hostName",text:localizedString("COLUMN_HOSTNAME"),binding:"Machine_Hostname",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"portNumber",text:localizedString("COLUMN_PORT_NO"),binding:"Port",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"version",text:localizedString("COLUMN_VERSION"),binding:"Version",type:"label",readonly:!0,"class":"chrome2",editable:!0},{id:"hardwarekey",text:localizedString("COLUMN_HW_KEY"),binding:"HardwareKey",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}];o.push(u);var a={getToolbarItems:function(){return s},getColumns:function(){return o},getViewContent:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus")if(this.data){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}return e}},f=$(n).dataform({delegate:a});return i.dataform=f,n}function w(){var t=e+"_licenseFiles",n=$("<section>").attr({id:t}),r=localizedString("DATAFORM_IMPORT"),s=localizedString("RESPOOL_LICSERVER_BTN_UPDATE"),o=localizedString("RESPOOL_LICSERVER_BTN_REPLACE"),u=localizedString("MISC_REMOVE"),a=t+"toolbar",f=$("<section>"),l=[{name:"InstallationNumber",description:localizedString("COLUMN_INSTALL_NO"),type:"text",width:"25%"},{name:"LicenseServer_Name",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"20%"},{name:"SystemNumber",description:localizedString("COLUMN_SYS_NO"),type:"text",width:"20%"},{name:"Localization",description:localizedString("MISC_LOCATION"),type:"text",width:"20%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"15%"},{name:"Reseller",description:localizedString("RESPOOL_RESELLER_TLT"),type:"text",width:"10%"}];i.licenseFilesData=[];var c={getHeaderSpec:function(){return l},getRowCount:function(){return i.licenseFilesData?i.licenseFilesData.length:0},getRow:function(e){return i.licenseFilesData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getDefaultSelectedIndex:function(){return 0}},h=f.gridview({delegate:c});return h.show(),h.rowSelectedEvent.push(function(){E(this.index)}),i.licenseFilesDataGrid=h,n.append(f),n}function E(e){o=i.licenseFilesData[e]}this.base=c3.module,this.base();var e="respool_licenseServers_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RES_LIC_SERVER"),localizedString("RES_DETAILS")),r=[localizedString("MISC_CONFIGURATION"),localizedString("RES_LIC_LICENSE_FILES"),localizedString("RES_USED_BY_HU")],i=this,s=localizedString("RES_LIC_SERVER"),o=null,u=0,a=5,f=0,l=5,c=arguments[0]||{};i.id=e,this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(g()),t.append(y());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==2?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.LicenseFiles,function(e){p()}),cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){d()})},this.reload=h,this.bindData=function(e){var n=t.find(".tools img");n.size()>0&&$(n[0]).css("display","none"),e&&i.title.text(s+": "+parse(e.Name)),i.dataform.submit=function(e,t){var n={};n.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),c.reload()),t(!0)},c3.service.updateLicenseServer(e,n)},e==null||e.Status!="Online"||e.SLDAgentStatus==null||e.SLDAgentStatus!="Available"?i.btnDeploy.attr("disabled",!0):i.btnDeploy.removeAttr("disabled"),i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getLicenseServerStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),i.lifeCycleStatusData.clear(),c3.service.getLicenseServerLifeCycleStatus(function(e){for(var t=0;t<e.data.length;t++)i.lifeCycleStatusData.push({text:e.data[t],value:e.data[t]})}),p(),d(),e&&e.ID!=undefined?i.btnTestConnection.attr({disabled:0}):i.btnTestConnection.attr({disabled:1})}};var respool=respool||{};respool.presentationServers=function(){function l(){o.refreshPaging=!0;var e=c3.service.getPresentationServers().expand("Machine,ServiceUnit,SBOClient"),t;e.count().query(o.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(o.pageSize).skip(i*o.pageSize)),e.query(c)}function c(e){c3.service.retrieveWorkstations().query(function(t){if(t.data&&t.data.length>0)for(var n=0;n<t.data.length>0;n++)for(var r=0;r<e.data.length;r++)if(t.data[n].Hostname==e.data[r].Machine.Hostname){e.data[r].SLDAgentStatus=t.data[n].Status;continue}h(e)})}function h(e){c3.service.getCachedPresentationServerMonitorStatus("",{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(n[i].ID==t.d.results[r].ID){n[i].MonitorStatus=t.d.results[r].Status,n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].cachedMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);break}m(n)},error:function(t){var n=c3.service.convertData(e.data);m(n)}})}function p(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),i=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),s=$("<input>").attr({value:localizedString("BTN_SYCNALLSBOCLIENT_TEXT"),type:"button",id:e+"btnSyncVersion"}),a=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),f=localizedString("RESPOOL_PSSERVER_PS_LOWCASE");o.btnDelete=i,y(),s.click(function(){o.loadingWin.show(),c3.service.refreshSBOClients(function(e){o.loadingWin.close(),o.reload();if(e.d&&e.d.results&&e.d.results.length>0){var t=new c3syncException(o,e.d.results);t.show()}})}),i.click(function(){u!=null?c3.service.getPresentationServers(u.Id).expand("ServiceUnit").query(function(e){var t=null;e.data.HostingUnit?t=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM_USED"),f)):t=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),f)),t.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload())},c3.service.deletePresentationServer(u,e)})}):alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),f))}),a.click(function(){o.reload()}),t.append($("<input>").attr({value:n,type:"button",id:e+"btnRegister"}).click(function(){d(o)}));var l=new searchbox({inputCallback:function(e){return o.dataGrid.searchText(e)}});return t.append(s),t.append($("<span>").addClass("split")),t.append(i),t.append($("<div>").css({"float":"right"}).append(l.css({"float":"left"})).append(a)),t}function d(e){var t=new c3registerPresServer(e);t.show()}function v(){var n=$("<section>").attr({id:e+"_masterDataGrid"}),r=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"14%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"ServerType",description:localizedString("MISC_TYPE"),type:"text",width:"10%"},{name:"Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"10%"},{name:"Machine_Hostname",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"15%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"14%"},{name:"SLDAgentStatus",description:localizedString("RES_SLD_AGENT_STATUS"),type:"text",width:"8%"},{name:"SBOClient_Version",description:localizedString("RESPOOL_PS_COLUMN_SLDCLIENTVR"),type:"text",width:"9%"},{name:"SBOClient_Type",description:localizedString("RESPOOL_PS_COLUMN_SLDCLIENTDBTYPE"),type:"text",width:"7%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"11%"}];o.data=[];var i={pagingMode:!0,pageSize:o.pageSize,autoResize:function(){return 550},getHeaderSpec:function(){return r},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return a},getCell:function(){var e=null,n,r={},i=this.data.Machine_Hostname;if(this.colName=="Status"||this.colName=="LifeCycleStatus")r.text=this.data[this.colName],this.colName=="LifeCycleStatus"?r.showText=!0:r.textalign="center",e=new statusControl(r);else if(this.colName==="SLDAgentStatus")r.text=this.data[this.colName],r.textalign="center",e=new statusControl(r);else{if(this.colName=="Result"){var u=this.data,a=this.index,f=this.data.Machine_ID,l=$("<div>");return c3.service.getTasks().filter("TaskType eq 'DeploySBOClient' and (Status eq 'Processing' or Status eq 'Pending') and ResourceID eq "+f).expand("TaskParameters").query(function(e){if(e.data&&e.data.length>0){var n=e.data[0].ID,r=[];r.push(function(e){var r=e.c3progressWithStatus(function(e){return function(){return s(r,e,t)}}(n),{max:100,dur:c3config.Clocker-2,async:1,width:60,width:60,swf:!0,hwf:!0});return r}(l));for(var i=0,u=r.length;i<u;i++)0==i&&r[i].start(),i<u-1?r[i].finishEvent.push(function(e){return function(t){e.start()}}(r[i+1])):r[i].finishEvent.push(function(e){return function(e){o.reload()}}(r[i]))}}),l}if(this.colName=="MonitorStatus"){var r={};r.textalign="center";var c=$("<label>"),h=this.data;return monitorUtil.statusPreparation(r,h.MonitorStatus,h),c=new statusControl(r),monitorUtil.retrievePresentationServerMonitorStatus(c,h),c.c3tip({messageList:h.cachedMessageList}),c}if(this.colName=="SBOClient_Type"){var c=$("<label>");return c.append("N/A"),this.data.SBOClient_ServerType!=undefined&&(this.data.SBOClient_ServerType===ServerType.MSSQL_SERVER&&c.html("").append(localizedString("MSSQL")),this.data.SBOClient_ServerType===ServerType.HANA_SERVER&&c.html("").append(localizedString("HANA"))),c}}return e},getTotalCount:function(){return o.totalCount},loadPage:function(e,t){c3.service.getPresentationServers().expand("Machine,ServiceUnit,SBOClient").orderby("ID desc").skip(e).top(t).query({success:function(e){o.data.clear();for(var t=0;t<e.data.length;t++)o.data.push(e.data[t]);o.data=c3.service.convertData(o.data),b(a),o.dataGrid.refreshContent()},error:function(e){o.loadingWindow.close()}})}},s=function(e,t,n){c3.service.getTaskProgress(t).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase().toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(t).expand("TaskParameters").query(function(t){e.setFailed(t.data.ResultDescription),Utility.logTaskError(t.data)}):"SUCCESSFUL"==i[0].toUpperCase()?(e.setValue(100,localizedString("MISC_DONE")),n.data.errorLabel!=null&&n.data.errorLabel.text(0)):(i[0]!="Pending"&&i[0]!="Done"?i[0]=localizedString("MISC_TASK_PROCESSING"):i[0]=="Pending"&&(i[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),e.setValue(parseInt(i[1]),i[0]))})};o.gridDelegate=i;var u=$(n).gridview({delegate:i});return u.rowSelectedEvent.push(function(){a!=this.index&&b(this.index),g()}),o.dataGrid=u,n}function m(e){o.data=e,o.data.length==0?(o.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RES_PRESENTATION_SERVER"),function(){d(o)})},y()):a==-1?y():g(),o.dataGrid.reload(),o.data.length>0&&a!=-1?b(a):f[0].bindData({})}function g(){o.btnDelete.attr({disabled:0})}function y(){o.btnDelete.attr({disabled:1})}function b(e){a=e,u=o.data[e],f[0].onViewWillAppear(),f[0].bindData(o.data[e])}this.base=c3.module,this.base();var e="respool_presentationServers",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.presentationServers_detail(this)];o.id=e,o.pageSize=10,o.totalCount=0,o.refreshPaging=!1,this._container=t,this.getTitle=function(){return localizedString("RES_PRESENTATION_SERVERS")},this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(o.getTitle())),t.append(p()),t.append(v());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-PresentationServer",l));var n=new loadingWindow;o.loadingWin=n,l()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.PresentationServers,function(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){o.reload();break}}else o.reload()})},this.getSelectedItem=function(){return u},this.onViewAppear=function(){o.dataGrid.show()},this.reload=l,o.countHandler={success:function(e){o.totalCount=parseInt(e.data,10)},error:function(e){}}},respool.presentationServers_detail=function(){function f(){var e=a.getSelectedItem();e&&e.ServiceUnit_ID&&e.ServiceUnit_ID>0?e.ServiceUnit_ID>0&&c3.service.getHostingUnits(e.ServiceUnit_ID).expand("Tenants").query(function(e){l(e)}):(i.huData=[],i.usedByHUsDataGrid.reload(),i.subTitle.html(localizedString("RES_HU_NUM")+": "+0))}function l(e){e.data=[e.data];for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;i.huData=e.data,i.usedByHUsDataGrid.reload(),i.subTitle.html(localizedString("RES_HU_NUM")+": "+i.huData.length)}function c(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function h(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+":");var n=$("<hgroup>").append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(p()),t.append(respoolCommon.createHUPanel(i)),t}function p(){var t=e+"_config",n=$("<section>").attr({id:t}),r=[{id:"testConnection",text:localizedString("MISC_TEST_CONNECTION"),type:"button",handler:function(){alert("Not Implement")}}],s=[];i.statusData=[],i.typeData=[],i.lifeCycleStatusData=[];var o=[{id:"name",text:localizedString("COLUMN_MSSQL_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"type",text:localizedString("MISC_TYPE"),binding:"ServerType",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.typeData}},{id:"ServiceUnit_Name",text:localizedString("COLUMN_HOSTNAME"),binding:"Machine_Hostname",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0},{id:"SBOClientVersion",text:localizedString("RESPOOL_PS_COLUMN_SLDCLIENTVR"),binding:"SBOClient_Version",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"SBOClientType",text:localizedString("RESPOOL_PS_COLUMN_SLDCLIENTDBTYPE"),binding:"SBOClient_ServerType",type:"label",readonly:!0,"class":"chrome2",editable:!1}];s.push(o);var u={getColumns:function(){return s},getViewContent:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}if(this.colName=="SBOClient_ServerType"){var t={},n=$("<label>");this.data[this.colName]===ServerType.MSSQL_SERVER?n.append(localizedString("MSSQL")):this.data[this.colName]===ServerType.HANA_SERVER&&n.append(localizedString("HANA")),e=n}return e}},a=$(n).dataform({delegate:u});i.dataform=a;var f=i.dataform.getToolbar(),l=f.edit.parent(".tools");return n}function d(e,t){function n(){if(isNaN(parseInt(t)))return;if(t<=0)return;c3.service.getTaskProgress(e).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase().toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(e).expand("TaskParameters").query(function(e){Utility.logTaskError(e.data)}):(t--,setTimeout(n,5e3))})}n()}this.base=c3.module,this.base();var e="respool_presentationServers_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RES_PRESENTATION_SERVER"),localizedString("RES_DETAILS")),r=[localizedString("MISC_CONFIGURATION"),localizedString("RES_USED_BY_HU")],i=this,s=localizedString("RES_PRESENTATION_SERVER"),o=0,u=5,a=arguments[0]||{};this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(c()),t.append(h());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==1?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){f()})},this.bindData=function(e){e&&i.title.text(s+": "+parse(e.Machine_Hostname)),i.dataform.submit=function(e,t){var n={};n.success=function(e){a.reload(),t(!0)},c3.service.updatePresentationServer(e,n)},i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),c3.service.getPresentationServerStatus(function(e){i.statusData.clear();for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),c3.service.getPresentationServerType(function(e){i.typeData.clear();for(var t=0;t<e.data.length;t++)i.typeData.push({text:e.data[t],value:e.data[t]})}),i.lifeCycleStatusData.clear(),c3.service.getPresentationServerLifeCycleStatus(function(e){for(var t=0;t<e.data.length;t++)i.lifeCycleStatusData.push({text:e.data[t],value:e.data[t]})}),f()}};var respool=respool||{};respool.commonDBs=function(){function reload(){self.refreshPaging=!0;var e=c3.service.getCommonDBs().expand("DatabaseInstance, DatabaseInstance/Machine");e.count().query(self.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(self.pageSize).skip(page*self.pageSize)),e.query(addProvisioningRecords)}function addProvisioningRecords(e){c3.service.getTasks().filter("TaskType eq 'CreateCommonAndRegister' and (Status eq 'Processing' or Status eq 'Pending')").expand("TaskParameters").query(function(t){if(t.data&&t.data.length>0)for(var n=0;n<t.data.length;n++){var r=t.data[n].TaskParameters.results;if(r&&r.length>0){var i={TaskID:t.data[n].ID,ErrorCode:t.data[n].ErrorCode};for(var s=0;s<r.length;s++)i[r[s].Name]=r[s].Value;i.MonitorStatus=localizedString("MONITOR_STATUS_UNKNOWN"),i.monitorStatusCode=5;var o=[];o.push({statusClass:"Moni_unknown",message:localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE")}),i.cachedMessageList=o,e.data.push(i)}}retrieveMonitorStatus(e)})}function createToolbar(){var e=$("<section>").attr({id:id+"_toolbar"}).addClass("tools"),t=$("<input>").attr({value:createTxt,type:"button",id:id+"btnCreate"}),n=$("<input>").attr({value:regTxt,type:"button",id:id+"btnRegister"}),r=$("<input>").attr({value:unregTxt,type:"button",id:id+"btnUnRegister"}),i=$("<a>").attr({href:"#",id:"btnRefresh"+id,title:"Refresh"}).addClass("refresh"),s=localizedString("RES_SBO_COMMON");t.click(function(){createCommonDB(self)}),n.click(function(){registerCommonDB(self)}),self.btnDelete=r,self.btnCreate=t,self.btnRegister=n,disableControl(),r.click(function(){if(selectedItem!=null)if(self.selectPvn&&self.selectPvn.val()=="failed"){var e=selectedItem.TaskID;c3.service.getTasks(e).expand("TaskParameters").query(function(t){var n=$("<div>");n.html(localizedString("POP_MSG_WARNING")+"<br/>");var r=MessageBox.confirm({msg:n});r.yesEvent.push(function(){var t={ID:e,Archived:!0};c3.service.archiveTask(t,function(){onSelectPvn()})})})}else{var t=$("<div>").append(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),s)),n=$("<input>").attr({type:"checkbox"}),r=$("<span>").append(localizedString("RESPOOL_CMDB_DLT_RELATEDDB"));r.bind("click",function(){n.attr("checked")==1?n.attr({checked:!1}):n.attr({checked:!0}),bindDeleteDBConfirmation(n)}),n.click(function(){bindDeleteDBConfirmation(this)}),t.append($("<br>")).append($("<br>")).append(n).append(r);var i=MessageBox.confirm({msg:t});i.yesEvent.push(function(){self.loadingWin.show();var e={};e.success=function(e){self.loadingWin.close(),cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),self.reload()),c3ModuleManager.notifyMessage(new c3Message("CommonDatabaseRemoved"))},e.error=function(){self.loadingWin.close()};var t=n.attr("checked"),r={DeleteDB:t};e.params=r,c3.service.deleteCommonDB(selectedItem,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),s))}),i.click(function(){onSelectPvn()});var o=$("<div>").attr({id:"div_selectPvn"}).css({"float":"right"}),u=$("<select>").attr({id:"selectPvn"}),a=$("<option>").attr({title:localizedString("RESPOOL_CMDB_SELECT_ALL")}).val("all").append(localizedString("RESPOOL_CMDB_SELECT_ALL"));u.append(a),a=$("<option>").attr({title:localizedString("RESPOOL_CMDB_SELECT_FAILED")}).val("failed").append(localizedString("RESPOOL_CMDB_SELECT_FAILED")),u.append(a),u.bind("change",onSelectPvn),self.selectPvn=u,e.append(n),e.append(t),e.append($("<span>").addClass("split")),e.append(r);var f=new searchbox({inputCallback:function(e){return self.dataGrid.searchText(e)}}),l=(new Split({permissions:[permissionItems.operator]})).dom,c=$("<span>").html(localizedString("CUSTOMER_SELECT_LABEL")+":&nbsp;").css({"float":"left"});return o.append(c).append(u.css({"float":"left"})).append(l.css({"float":"left"})).append(f.css({"float":"left"})).append(i.css({"float":"left"})),e.append(o),e}function bindDeleteDBConfirmation(e){if($(e).attr("checked")==1){var t=$("<div>");t.html(localizedString("TNT_DELETE_DELETEDB_CONFIRM")+"<br/>");var n=MessageBox.confirm({msg:t});n.noEvent.push(function(){$(e).attr("checked",!1)})}}function onSelectPvn(){var e=self.selectPvn.val();if(e=="failed"){self.btnDelete.val("Delete");var t={data:[]};c3.service.getTasks().filter("TaskType eq 'CreateCommonAndRegister' and Status eq 'Failed' and Archived eq false ").expand("TaskParameters").query(function(e){if(e.data&&e.data.length>0)for(var n=0;n<e.data.length;n++){var r=e.data[n].TaskParameters.results;if(r&&r.length>0){var i={TaskID:e.data[n].ID,ErrorCode:e.data[n].ErrorCode};for(var s=0;s<r.length;s++)i[r[s].Name]=r[s].Value;i.Status="Offline",t.data.push(i)}}retrieveMonitorStatus(t)})}else self.btnDelete.val("Unregister"),c3.service.getCommonDBs().expand("DatabaseInstance, DatabaseInstance/Machine").orderby("ID desc").top(self.pageSize).skip(page*self.pageSize).query(addProvisioningRecords)}function createCommonDB(e){var t=new c3newSBOCommon(e);t.show(),t.finishEvent.push(function(){onSelectPvn()})}function registerCommonDB(e){var t=new c3registerSBOCommon(e);t.show()}function createTable(){var e=$("<section>").attr({id:id+"_masterDataGrid"}),t=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"14%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"10%"},{name:"DBType",description:localizedString("MISC_DBTYPE"),type:"text",width:"7%"},{name:"DatabaseInstance_Name",description:localizedString("COLUMN_RELATED_DB"),type:"text",width:"20%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"28%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"12%"}];self.data=[];var n={pagingMode:!0,pageSize:self.pageSize,autoResize:function(){return 550},getHeaderSpec:function(){return t},getRowCount:function(){return self.data.length},getRow:function(e){return self.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return selectedIndex},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}else{if(this.colName=="Result"){var n=this.data,r=$("<div>"),i=this;if(n.TaskID&&n.TaskID>0){if(self.selectPvn&&self.selectPvn.val()=="failed"){var s=$("<a>").attr({href:"#"}).text("Details");return s.click(function(){c3.service.getTasks(n.TaskID).expand("TaskParameters").query(function(e){var t=$("<fieldset>");t.append($("<legend>").css({"padding-left":"10px","line-height":"25px"}).append("<strong>"+localizedString("RESPOOL_CMDB_POPWIN_TLT")+":</strong>&nbsp;&nbsp;&nbsp;&nbsp;").append(e.data.ErrorCode)),t.append($("<span>").css({"padding-left":"10px","line-height":"25px"}).append('<span title="'+e.data.ResultDescription+'">'+e.data.ResultDescription+"</span>"));var n=0,r=200;e.data.ResultDescription.length&&(n=e.data.ResultDescription.length,r=(n/40+1)*30+110);var i=MessageBox.prompt({msg:t,width:350,height:r,title:localizedString("AVAILABLE_STATUS_WARNING")})})}),s}var o=[];o.push(function(e){var t=e.c3progressWithStatus(function(e){return function(){return getProgress(t,e,i)}}(n.TaskID),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0,showError:!0});return t}(r));for(var u=0,a=o.length;u<a;u++)0==u&&o[u].start(),u<a-1&&o[u].finishEvent.push(function(e){return function(t){e.start()}}(o[u+1]))}return r}if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var f=$("<label>"),l=this.data;return monitorUtil.statusPreparation(t,l.MonitorStatus,l),f=new statusControl(t),l.ID&&monitorUtil.retrieveCommonDBMonitorStatus(f,l),f.c3tip({messageList:l.cachedMessageList}),f}if(this.colName=="DBType"){var f=$("<label>");if(this.data.DatabaseInstance&&this.data.DatabaseInstance.ServerType)return isHANA(this.data.DatabaseInstance.ServerType)===!1?f.append(localizedString("MSSQL")):f.append(localizedString("HANA")),f}}return e},getTotalCount:function(){return self.totalCount},loadPage:function(e,t){c3.service.getCommonDBs().expand("DatabaseInstance, DatabaseInstance/Machine").orderby("ID desc").skip(e).top(t).query({success:function(e){self.data.clear();for(var t=0;t<e.data.length;t++)self.data.push(e.data[t]);onRowSelected(selectedIndex),self.dataGrid.refreshContent()},error:function(e){self.loadingWindow.close()}})}};self.gridDelegate=n;var r=$(e).gridview({delegate:n});return r.rowSelectedEvent.push(function(){selectedIndex!=this.index&&onRowSelected(this.index)}),self.dataGrid=r,e}function retrieveMonitorStatus(e){c3.service.getCachedCommonDBMonitorStatus(null,{success:function(t){if(t.d.results)for(var n=0;n<t.d.results.length;n++)for(var r=0;r<e.data.length;r++)if(t.d.results[n].ID==e.data[r].ID){e.data[r].MonitorStatus=t.d.results[n].Status,e.data[r].monitorStatusCode=t.d.results[n].StatusCode,e.data[r].cachedMessageList=monitorUtil.buildMessageList(t.d.results[n].Messages.results);break}bindTable(e)},error:function(t){bindTable(e)}})}function bindTable(e){for(var t=0;t<e.data.length;t++)e.data[t].DatabaseInstance!=null&&e.data[t].DatabaseInstance.Machine!=null&&(e.data[t].DatabaseInstance_Name=e.data[t].DatabaseInstance.Name);self.data=e.data,self.data.length==0?(self.gridDelegate.getTip=function(){return self.selectPvn&&self.selectPvn.val()=="failed"?Utility.CreateTipBoard(localizedString("RESPOOL_CMDB_FAILED_EMP_TIPMSG"),null,!0):Utility.CreateTipBoard(localizedString("RESPOOL_CMDB_EMPTY_TIPMSG"),function(){createCommonDB(self)})},disableControl()):selectedIndex==-1?disableControl():enableControl(),self.dataGrid.reload(),self.data.length>0&&selectedIndex!=-1?onRowSelected(selectedIndex):nestedUnits[0].bindData({})}function enableControl(){self.btnDelete.attr({disabled:0}).val(localizedString("MISC_UNREGISTER")),self.btnCreate.attr({disabled:0}),self.btnRegister.attr({disabled:0})}function disableControl(){self.btnDelete.attr({disabled:1}),self.selectPvn&&self.selectPvn.val()=="failed"?(self.btnCreate.attr({disabled:1}),self.btnRegister.attr({disabled:1})):(self.btnCreate.attr({disabled:0}),self.btnRegister.attr({disabled:0}))}function onRowSelected(e){selectedIndex=e,selectedItem=self.data[e],self.data[e].TaskID&&self.data[e].TaskID>0?(nestedUnits[0].onViewWillAppear(),nestedUnits[0].bindData({}),disableControl(),self.selectPvn&&self.selectPvn.val()=="failed"?(self.btnDelete.attr({disabled:0}).val(localizedString("BUTTON_HU_DELETE")),self.btnCreate.attr({disabled:1}),self.btnRegister.attr({disabled:1})):(self.btnCreate.attr({disabled:0}),self.btnRegister.attr({disabled:0}),self.btnDelete.attr({disabled:1}).val(localizedString("MISC_UNREGISTER")))):(nestedUnits[0].bindData(self.data[e]),enableControl())}this.base=c3.module,this.base();var id="respool_commonDBs",container=$("<section>").attr({id:id}),createTxt=localizedString("MISC_CREATE"),regTxt=localizedString("MISC_REGISTER"),unregTxt=localizedString("MISC_UNREGISTER"),page=0,pageSize=5,self=this,selectedItem=null,selectedIndex=0,nestedUnits=[new respool.commonDBs_detail(this)];self.id=id,self.pageSize=10,self.totalCount=0,self.refreshPaging=!1,this._container=container,this.getTitle=function(){return localizedString("RES_SBO_COMMONS")},this.onInit=function(){container.append($("<div>").attr("class","title_panel").append(self.getTitle())),container.append(createToolbar()),container.append(createTable());for(var e=0;e<nestedUnits.length;e++)container.append(nestedUnits[e].getContainer());nestedUnits[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-SBOCommon",reload)),reload();var t=new loadingWindow;self.loadingWin=t},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.CommonDatabases,function(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){self.reload();break}}else self.reload()})},this.getSelectedItem=function(){return selectedItem},this.onViewAppear=function(){self.dataGrid.show()},this.reload=reload,self.countHandler={success:function(e){self.totalCount=parseInt(e.data,10)},error:function(e){}};var getProgress=function(progressBar,tid,rowContainer){c3.service.getTaskProgress(tid).query(function(result){var status=result.data.GetTaskProperties.split(",");"FAILED"==status[0].toUpperCase().toUpperCase()||"CANCELLED"==status[0].toUpperCase()||"ROLLBACK"==status[0].toUpperCase()?c3.service.getTaskResult(tid).query(function(e){e!=null&&e.data!=null&&e.data.GetResult==""?c3.service.getTasks(tid).expand("TaskParameters").query(function(e){progressBar.setFailed(e.data.ResultDescription)}):e.data.GetResult.length>0&&c3.service.getTasks(tid).query(function(e){progressBar.setWarning(e.data.ResultDescription)})}):"SUCCESSFUL"==status[0].toUpperCase()?(onSelectPvn(),c3.service.getTaskResult(tid).query(function(result1){if(result1!=null&&result1.data!=null&&result1.data.GetResult!=null){var errorArray=eval(result1.data.GetResult),msg="";if(errorArray&&errorArray.length>0)for(var k=0;k<errorArray.length;k++)errorArray[k].Type=="Warning"&&(msg+=errorArray[k].Description+"\r\n");msg!=""&&msg.length>0?progressBar.setWarning(msg):progressBar.setValue(100,localizedString("MISC_DONE"))}}),rowContainer.data.errorLabel!=null&&rowContainer.data.errorLabel.text(0)):(status[0]!="Pending"&&status[0]!="Done"?status[0]=localizedString("MISC_TASK_PROCESSING"):status[0]=="Pending"&&(status[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),progressBar.setValue(parseInt(status[1]),status[0]))})}},respool.commonDBs_detail=function(){function f(){var e=a.getSelectedItem();if(e&&e.ID!=undefined){var t=c3.service.getHostingUnits().expand("Tenants").filter("CommonDatabase/ID eq "+e.ID);Utility.SplitPage||(t=t.top(u).skip(o*u)),t.query(l)}}function l(e){for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;i.huData=e.data,i.usedByHUsDataGrid.reload(),i.subTitle.html(localizedString("RES_HU_NUM")+": "+i.huData.length)}function c(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function h(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+":");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(p()),t.append(respoolCommon.createHUPanel(i)),t}function p(){var t=e+"_config",n=$("<section>").attr({id:t}),r=[];i.statusData=[],i.lifeCycleStatusData=[];var s=[{id:"name",text:localizedString("HU_GD_NAME"),binding:localizedString("COLUMN_NAME"),type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"DatabaseInstance_Name",text:localizedString("COLUMN_RELATED_DB"),binding:"DatabaseInstance_Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"version",text:localizedString("COLUMN_VERSION"),binding:localizedString("COLUMN_VERSION"),type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"creationDate",text:localizedString("COLUMN_CREATE_DATE"),binding:"CreationDate",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("MISC_DESCRIPTION"),binding:localizedString("COLUMN_DESC"),type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}];r.push(s);var o={getColumns:function(){return r},getViewContent:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}if(this.colName=="CreationDate"&&this.data[this.colName]){var n=convertToDate(this.data[this.colName]).timeString();e=$("<label>").append(n).attr({title:n})}return e}},u=$(n).dataform({delegate:o});return i.dataform=u,n}this.base=c3.module,this.base();var e="respool_commonDBs_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RES_SBO_COMMON"),localizedString("RES_DETAILS")),r=[localizedString("MISC_CONFIGURATION"),localizedString("RES_USED_BY_HU")],i=this,s=localizedString("HU_GD_NAME"),o=0,u=5,a=arguments[0]||{};this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(c()),t.append(h());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==1?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){f()})},this.bindData=function(e){i.title.text(s+": "+parse(e.Name)),i.dataform.submit=function(e,t){var n={};n.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),a.reload()),t(!0)},c3.service.updateCommonDB(e,n)},i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getCommonDBStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),i.lifeCycleStatusData.clear(),c3.service.getCommonDBLifeCycleStatus(function(e){for(var t=0;t<e.data.length;t++)i.lifeCycleStatusData.push({text:e.data[t],value:e.data[t]})}),e.ID!=undefined?f():l({data:[]})}};var respool=respool||{};respool.b1iServers=function(){function l(){o.refreshPaging=!0;var e=c3.service.getB1iServers().expand("Machine");e.count().query(o.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(o.pageSize).skip(i*o.pageSize)),e.query(c)}function c(e){c3.service.getCachedB1IMonitorStatus("",{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(t.d.results[r].ID==n[i].ID){n[i].MonitorStatus=t.d.results[r].Status,n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].cachedMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);break}v(n)},error:function(t){var n=c3.service.convertData(e.data);v(n)}})}function h(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),i=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),s=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),a=localizedString("RES_B1I_SERVER");o.btnDelete=i,g(),i.click(function(){if(u!=null){var e=MessageBox.confirm({msg:String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),a)});e.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload())},c3.service.deleteB1iServer(u,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),a))}),s.click(function(){o.reload()}),t.append($("<input>").attr({value:n,type:"button",id:e+"btnRegister"}).attr({disabled:1}).click(function(){p(o)}));var f=new searchbox({inputCallback:function(e){return o.dataGrid.searchText(e)}});return t.append($("<span>").addClass("split")),t.append(i),t.append($("<div>").css({"float":"right"}).append(f.css({"float":"left"})).append(s)),t}function p(e){var t=new c3registerB1i(e);t.show()}function d(){var t=$("<section>").attr({id:e+"_masterDataGrid"}),n=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"14%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"URL",description:localizedString("COLUMN_SERVER_PATH"),type:"text",width:"25%"},{name:"AccessURL",description:localizedString("WIZARD_B1I_ACCESSURL"),type:"text",width:"15%"},{name:"Machine_Hostname",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"20%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"16%"}];o.data=[];var r={pagingMode:!0,pageSize:o.pageSize,autoResize:function(){return 550},getHeaderSpec:function(){return n},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return a},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}else if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),monitorUtil.retrieveB1IMonitorStatus(n,r),n.c3tip({messageList:r.cachedMessageList}),n}return e},getTotalCount:function(){return o.totalCount},loadPage:function(e,t){c3.service.getB1iServers().expand("Machine").orderby("ID desc").skip(e).top(t).query({success:function(e){o.data.clear();for(var t=0;t<e.data.length;t++)o.data.push(e.data[t]);o.data=c3.service.convertData(o.data),y(a),o.dataGrid.refreshContent()},error:function(e){o.loadingWindow.close()}})}};o.gridDelegate=r;var i=$(t).gridview({delegate:r});return i.rowSelectedEvent.push(function(){a!=this.index&&y(this.index),m()}),o.dataGrid=i,t}function v(e){o.data=e,o.data.length==0?(o.gridDelegate.getTip=function(){},g()):a==-1?g():m(),o.dataGrid.reload(),o.data.length>0&&a!=-1?y(a):f[0].bindData({})}function m(){o.btnDelete.attr({disabled:0})}function g(){o.btnDelete.attr({disabled:1})}function y(e){a=e,u=o.data[e],f[0].onViewWillAppear(),f[0].bindData(o.data[e])}this.base=c3.module,this.base();var e="respool_b1iServers",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.b1iServers_detail(this)];o.id=e,o.pageSize=10,o.totalCount=0,o.refreshPaging=!1,this._container=t,this.getTitle=function(){return localizedString("RES_B1I_SERVERS")},this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(o.getTitle())),t.append(h()),t.append(d());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-B1i",l)),l()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.IntegrationComponents,function(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){o.reload();break}}else o.reload()})},this.getSelectedItem=function(){return u},this.onViewAppear=function(){o.dataGrid.show()},this.reload=l,o.countHandler={success:function(e){o.totalCount=parseInt(e.data,10)},error:function(e){}}},respool.b1iServers_detail=function(){function c(e,t){var n="";if(e&&e.AccessURL&&e.AccessURL!==""){var r="^((https|http)?://).+",i=new RegExp(r),s=i.test(e.AccessURL.toLowerCase());s||(n+=localizedString("B1I_INVALID_URL"))}return n}function h(){var e=l.getSelectedItem();if(e&&e.ID!==undefined){var t=c3.service.getHostingUnits().expand("Tenants").filter("IntegrationComponent/ID eq "+e.ID);Utility.SplitPage||(t=t.top(u).skip(o*u)),t.query(p)}}function p(e){for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;i.huData=e.data,i.usedByHUsDataGrid.reload(),i.subTitle.html(localizedString("RES_HU_NUM")+": "+i.huData.length)}function d(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function v(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+":");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(m()),t.append(respoolCommon.createHUPanel(i)),t.append(c3log.createAdminData(i)),t}function m(){var t=e+"_config",n=$("<section>").attr({id:t}),r=[];i.statusData=[],i.lifeCycleStatusData=[];var s=[{id:"name",text:localizedString("COLUMN_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"path",text:localizedString("COLUMN_SERVER_PATH"),binding:"URL",type:"text",readonly:!0,"class":"chrome2",editable:!1},{id:"Machine_Hostname",text:localizedString("COLUMN_HOSTNAME"),binding:"Machine_Hostname",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"AccessURL",text:localizedString("WIZARD_B1I_ACCESSURL"),binding:"AccessURL",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}];r.push(s);var o={getColumns:function(){return r},getViewContent:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}return e}},u=$(n).dataform({delegate:o});return i.dataform=u,n}this.base=c3.module,this.base();var e="respool_b1iServers_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RES_B1I_SERVER"),localizedString("RES_DETAILS")),r=[localizedString("MISC_CONFIGURATION"),localizedString("RES_USED_BY_HU")],i=this,s=localizedString("RESPOOL_B1I_TLTPREFIX"),o=0,u=5,a=0,f=5,l=arguments[0]||{};this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(d()),t.append(v());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==1?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){h()})},this.bindData=function(e){i.title.text(s+": "+parse(e.URL)),i.dataform.submit=function(e,t){var n={},r=c(e,this.getDataSource());if(r&&r!==""){MessageBox.show({msg:String.format(r,localizedString("OVERVIEW_COLUMN_B1I")),icon:MessageBoxIcon.ERROR,buttons:MessageBoxButton.OK});return}n.success=function(e){l.reload(),t(!0)},c3.service.updateB1iServer(e,n)},i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getB1iServerStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),i.lifeCycleStatusData.clear(),c3.service.getB1iServerLifeCycleStatus(function(e){for(var t=0;t<e.data.length;t++)i.lifeCycleStatusData.push({text:e.data[t],value:e.data[t]})}),h()}};var respool=respool||{};respool.b1AH=function(){function l(){var e=c3.service.getB1aServers().expand("Machine");Utility.SplitPage||(e=e.top(s).skip(i*s)),e.query(c)}function c(e){c3.service.getCachedB1AMonitorStatus("",{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(t.d.results[r].ID==n[i].ID){n[i].MonitorStatus=t.d.results[r].Status,n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].cachedMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);break}v(n)},error:function(t){var n=c3.service.convertData(e.data);v(n)}})}function h(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),i=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),s=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),f=localizedString("RES_B1AH_SERVER");o.btnDelete=i,g(),i.click(function(){if(u!=null){var e=MessageBox.confirm({msg:String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),f)});e.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload()),g(),a=-1},c3.service.deleteB1aServer(u,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),f))}),s.click(function(){o.reload()}),t.append($("<input>").attr({value:n,type:"button",id:e+"btnRegister"}).attr({disabled:1}).click(function(){p(o)}));var l=new searchbox({inputCallback:function(e){return o.dataGrid.searchText(e)}});return t.append($("<span>").addClass("split")),t.append(i),t.append($("<div>").css({"float":"right"}).append(l.css({"float":"left"})).append(s)),t}function p(e){var t=new c3B1AHRegister(e);t.show()}function d(){var t=$("<section>").attr({id:e+"_masterDataGrid"}),n=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"14%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"URL",description:localizedString("COLUMN_B1A_PATH"),type:"text",width:"25%"},{name:"AccessURL",description:localizedString("WIZARD_B1A_ACCESSURL"),type:"text",width:"15%"},{name:"Machine_Hostname",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"20%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"16%"}];o.data=[];var r={autoResize:function(){return 550},getHeaderSpec:function(){return n},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return a},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}else{if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),monitorUtil.retrieveB1AMonitorStatus(n,r),n.c3tip({messageList:r.cachedMessageList}),n}if(this.colName=="AccessURL"){var i=o.data[this.row];if(this.data.AccessURL!=null&&this.data.AccessURL.length>0){var s=$("<a>").attr({href:"#"});return s.bind("click",function(){window.open(i.AccessURL)}),s.append(this.data.AccessURL),s}return null}if(this.colName=="URL"){var i=o.data[this.row];if(this.data.URL!=null&&this.data.URL.length>0){var s=$("<a>").attr({href:"#"});return s.bind("click",function(){window.open(i.URL)}),s.append(this.data.URL),s}return null}}return e}};o.gridDelegate=r;var i=$(t).gridview({delegate:r});return i.rowSelectedEvent.push(function(){a!=this.index&&y(this.index),m()}),o.dataGrid=i,t}function v(e){o.data=e,o.data.length==0?(o.gridDelegate.getTip=function(){},g()):a==-1?g():m(),o.dataGrid.reload(),o.data.length>0&&a!=-1?y(a):f[0].bindData({})}function m(){o.btnDelete.attr({disabled:0})}function g(){o.btnDelete.attr({disabled:1})}function y(e){a=e,u=o.data[e],f[0].onViewWillAppear(),f[0].bindData(o.data[e])}this.base=c3.module,this.base();var e="respool_b1AH",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.b1AH_detail(this)];o.id=e,this._container=t,this.getTitle=function(){return localizedString("RES_B1AH_SERVERS")},this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(o.getTitle())),t.append(h()),t.append(d());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("B1AH",l)),l()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.AnalyticService,function(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){o.reload();break}}else o.reload()})},this.getSelectedItem=function(){return u},this.onViewAppear=function(){o.dataGrid.show()},this.reload=l},respool.b1AH_detail=function(){function c(e,t){var n="";if(e&&e.AccessURL&&e.AccessURL!==""){var r="^((https|http)?://).+",i=new RegExp(r),s=i.test(e.AccessURL.toLowerCase());s||(n+=localizedString("B1A_INVALID_URL"))}return n}function h(){var e=l.getSelectedItem();if(e&&e.ID!==undefined){var t=c3.service.getHostingUnits().expand("Tenants").filter("AnalyticsService/ID eq "+e.ID);Utility.SplitPage||(t=t.top(u).skip(o*u)),t.query(p)}}function p(e){for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;i.huData=e.data,i.usedByHUsDataGrid.reload(),i.subTitle.html(localizedString("RES_HU_NUM")+": "+i.huData.length)}function d(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function v(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+":");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(m()),t.append(respoolCommon.createHUPanel(i)),t.append(c3log.createAdminData(i)),t}function m(){var t=e+"_config",n=$("<section>").attr({id:t}),r=[];i.statusData=[],i.lifeCycleStatusData=[];var s=[{id:"name",text:localizedString("COLUMN_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"path",text:localizedString("COLUMN_B1A_PATH"),binding:"URL",type:"text",readonly:!0,"class":"chrome2",editable:!1},{id:"Machine_Hostname",text:localizedString("COLUMN_HOSTNAME"),binding:"Machine_Hostname",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"AccessURL",text:localizedString("WIZARD_B1A_ACCESSURL"),binding:"AccessURL",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}];r.push(s);var o={getColumns:function(){return r},getViewContent:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}return e}},u=$(n).dataform({delegate:o});return i.dataform=u,n}this.base=c3.module,this.base();var e="respool_b1aServers_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RES_B1AH_SERVER"),localizedString("RES_DETAILS")),r=[localizedString("MISC_CONFIGURATION"),localizedString("RES_USED_BY_HU")],i=this,s=localizedString("RESPOOL_B1A_TLTPREFIX"),o=0,u=5,a=0,f=5,l=arguments[0]||{};this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(d()),t.append(v());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==1?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){h()})},this.bindData=function(e){i.title.text(s+": "+parse(e.URL)),i.dataform.submit=function(e,t){var n={},r=c(e,this.getDataSource());if(r&&r!==""){MessageBox.show({msg:String.format(r,localizedString("RES_B1AH_SERVERS")),icon:MessageBoxIcon.ERROR,buttons:MessageBoxButton.OK});return}n.success=function(e){l.reload(),t(!0)},c3.service.updateB1aServer(e,n)},i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getB1aServerStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),i.lifeCycleStatusData.clear(),c3.service.getB1aServerLifeCycleStatus(function(e){for(var t=0;t<e.data.length;t++)i.lifeCycleStatusData.push({text:e.data[t],value:e.data[t]})}),h()}};var respool=respool||{};respool.xappservice=function(){function l(){var e=c3.service.getXAppServices().expand("Machine");Utility.SplitPage||(e=e.top(s).skip(i*s)),e.query(c)}function c(e){c3.service.getCachedXAppMonitorStatus("",{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(t.d.results[r].ID==n[i].ID){n[i].MonitorStatus=t.d.results[r].Status,n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].cachedMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);break}v(n)},error:function(t){var n=c3.service.convertData(e.data);v(n)}})}function h(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),i=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),s=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),f=localizedString("RES_XAPP_SERVICE");o.btnDelete=i,g(),i.click(function(){if(u!=null){var e=MessageBox.confirm({msg:String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),f)});e.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload()),g(),a=-1},c3.service.deleteXAppService(u,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),f))}),s.click(function(){o.reload()}),t.append($("<input>").attr({value:n,type:"button",id:e+"btnRegister"}).attr({disabled:1}).click(function(){p(o)}));var l=new searchbox({inputCallback:function(e){return o.dataGrid.searchText(e)}});return t.append($("<span>").addClass("split")),t.append(i),t.append($("<div>").css({"float":"right"}).append(l.css({"float":"left"})).append(s)),t}function p(e){var t=new c3XAppRegister(e);t.show()}function d(){var t=$("<section>").attr({id:e+"_masterDataGrid"}),n=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"14%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"URL",description:localizedString("COLUMN_XAPP_URL"),type:"text",width:"25%"},{name:"Machine_Hostname",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"20%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"16%"}];o.data=[];var r={autoResize:function(){return 550},getHeaderSpec:function(){return n},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return a},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}else{if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),monitorUtil.retrieveXAppMonitorStatus(n,r),n.c3tip({messageList:r.cachedMessageList}),n}if(this.colName=="URL"){var i=o.data[this.row];if(this.data.Link!=null&&this.data.Link.length>0){var s=$("<a>").attr({href:"#"});return s.bind("click",function(){window.open(i.Link)}),s.append(this.data.Link),s}return null}}return e}};o.gridDelegate=r;var i=$(t).gridview({delegate:r});return i.rowSelectedEvent.push(function(){a!=this.index&&y(this.index),m()}),o.dataGrid=i,t}function v(e){o.data=e,o.data.length==0?(o.gridDelegate.getTip=function(){},g()):a==-1?g():m(),o.dataGrid.reload(),o.data.length>0&&a!=-1?y(a):f[0].bindData({})}function m(){o.btnDelete.attr({disabled:0})}function g(){o.btnDelete.attr({disabled:1})}function y(e){a=e,u=o.data[e],f[0].onViewWillAppear(),f[0].bindData(o.data[e])}this.base=c3.module,this.base();var e="respool_xappservice",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.xappservice_detail(this)];o.id=e,this._container=t,this.getTitle=function(){return localizedString("RES_XAPP_SERVICES")},this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(o.getTitle())),t.append(h()),t.append(d());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("XAPP",l)),l()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.XAppService,function(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){o.reload();break}}else o.reload()})},this.getSelectedItem=function(){return u},this.onViewAppear=function(){o.dataGrid.show()},this.reload=l},respool.xappservice_detail=function(){function c(e,t){var n="";if(e&&e.Link&&e.Link!==""){var r="^((https|http)?://).+",i=new RegExp(r),s=i.test(e.Link.toLowerCase());s||(n+=localizedString("XAPP_INVALID_URL"))}return n}function h(){var e=l.getSelectedItem();if(e&&e.ID!==undefined){var t=c3.service.getHostingUnits().expand("Tenants").filter("XAppService/ID eq "+e.ID);Utility.SplitPage||(t=t.top(u).skip(o*u)),t.query(p)}}function p(e){for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;i.huData=e.data,i.usedByHUsDataGrid.reload(),i.subTitle.html(localizedString("RES_HU_NUM")+": "+i.huData.length)}function d(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function v(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+":");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(m()),t.append(respoolCommon.createHUPanel(i)),t.append(c3log.createAdminData(i)),t}function m(){var t=e+"_config",n=$("<section>").attr({id:t}),r=[];i.statusData=[],i.lifeCycleStatusData=[];var s=[{id:"name",text:localizedString("COLUMN_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"path",text:localizedString("COLUMN_XAPP_URL"),binding:"Link",type:"text",readonly:!0,"class":"chrome2",editable:!1},{id:"Machine_Hostname",text:localizedString("COLUMN_HOSTNAME"),binding:"Machine_Hostname",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}];r.push(s);var o={getColumns:function(){return r},getViewContent:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}return e}},u=$(n).dataform({delegate:o});return i.dataform=u,n}this.base=c3.module,this.base();var e="respool_xappservice_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RES_XAPP_SERVICE"),localizedString("RES_DETAILS")),r=[localizedString("MISC_CONFIGURATION"),localizedString("RES_USED_BY_HU")],i=this,s=localizedString("RESPOOL_XAPP_TLTPREFIX"),o=0,u=5,a=0,f=5,l=arguments[0]||{};this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(d()),t.append(v());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==1?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){h()})},this.bindData=function(e){i.title.text(s+": "+parse(e.Link)),i.dataform.submit=function(e,t){var n={},r=c(e,this.getDataSource());if(r&&r!==""){MessageBox.show({msg:String.format(r,localizedString("RES_XAPP_SERVICES")),icon:MessageBoxIcon.ERROR,buttons:MessageBoxButton.OK});return}n.success=function(e){l.reload(),t(!0)},c3.service.updateXAppService(e,n)},i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getXAppServiceStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),i.lifeCycleStatusData.clear(),c3.service.getXAppServiceLifeCycleStatus(function(e){for(var t=0;t<e.data.length;t++)i.lifeCycleStatusData.push({text:e.data[t],value:e.data[t]})}),h()}};var respool=respool||{};respool.sharedFolders=function(){function p(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){s.reload();break}}else s.reload()}function d(){if(a==="usersStorage")return;var e=g(a);Utility.SplitPage||(e=e.top(i).skip(r*i)),e.query(w)}function v(){var r=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),i=$("<section>").addClass("bar_container"),f=$("<select>").attr({id:e+"selectFolderType"}),l=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),c=$("<input>").attr({value:n,type:"button",id:e+"btnUnRegister"}),h=localizedString("RES_SHARED_FOLDER_OPTION");s.btnDelete=c,T(),c.click(function(){if(o!=null){switch(a){case"SharedFolder":h=localizedString("RES_SHARED_FOLDER_OPTION");break;case"TenantsStorage":h=localizedString("RES_TENANTS_STORAGE");break;case"ImplementationRepository":h=localizedString("RES_SHARED_IMPL_REPOSITORY");break;case"CompanyTemplateRepository":h=localizedString("RES_COMPANY_TEMPLATE_REPOSITORY");break;case"SoftwareRepository":h=localizedString("SOFTWAREREPO")}var e=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),h));e.yesEvent.push(function(){var e={};e.success=function(e){switch(a){case"SoftwareRepository":c3ModuleManager.notifyMessage(new c3Message("SoftwareRepositoryRemoved"))}cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),s.reload()),T(),u=-1,s.reload()};switch(a){case"SharedFolder":c3.service.deleteSharedFolder(o,e);break;case"TenantsStorage":c3.service.deleteTenantsStorage(o,e);break;case"ImplementationRepository":c3.service.deleteImplementationRepository(o,e);break;case"CompanyTemplateRepository":c3.service.deleteCompanyTemplateRepository(o,e);break;case"SoftwareRepository":c3.service.deleteSWRepository(o,e)}})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),h))}),l.click(function(){s.reload()}),r.append($("<input>").attr({value:t,type:"button",id:e+"btnRegister"}).click(function(){y(s)}));var p=new searchbox({inputCallback:function(e){return s.dataGrid.searchText(e)}});return r.append($("<span>").addClass("split")),r.append(c),r.append($("<div>").css({"float":"right","margin-left":"10px"}).append(p.css({"float":"left"})).append(l)),i.append(r),i}function m(e){s.loadingWindow.show(),a=e;if(a==="usersStorage"){s.usersStorage===null&&(s.usersStorage=new respool.userstorage),$(".storage_content_panel").hide(),s.usersStorage.onViewWillAppear(),s.usersStorage.show();var t=s.usersStorage.getContainer();t.addClass("storage_content_panel"),s._container.append(t),s.loadingWindow.close()}else $(".storage_content_panel").show(),s.usersStorage!==null&&s.usersStorage.hide(),g(a).query(w)}function g(e){var t=null;S(e),s.currentFolderType=e;switch(e){case"SharedFolder":c[0].folderType1(),t=c3.service.getSharedFolders(),s.CurrentFolderType="SharedFolder";break;case"TenantsStorage":c[0].folderType2(),t=c3.service.getTenantsStorages(),s.CurrentFolderType="TenantsStorage";break;case"ImplementationRepository":c[0].folderType3(),t=c3.service.getImplementationRepositories().expand("Reseller"),s.CurrentFolderType="ImplementationRepository";break;case"CompanyTemplateRepository":c[0].folderType4(),t=c3.service.getCompanyTemplateRepositories().expand("Reseller"),s.CurrentFolderType="CompanyTemplateRepository";break;case"SoftwareRepository":c[0].folderType5(),t=c3.service.getSWRepositories(),s.CurrentFolderType="SoftwareRepository"}return t}function y(e){if(a==="SoftwareRepository"){var t=new c3newSWRepository(e);t.show()}else{var n=new c3registerB1Share(a,e);n.show()}}function b(){var t=$("<section>").attr({id:e+"_masterDataGrid_SharedFolder"}),n=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"URI",description:localizedString("COLUMN_PATH"),type:"text",width:"35%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"45%"}];s.data=[];var r={autoResize:function(){return 550},getHeaderSpec:function(){return n},getRowCount:function(){return s.data.length},getRow:function(e){return s.data[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return u},getCell:function(){var e=null;if(this.col==0){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),monitorUtil.retrieveSharedFolderMonitorStatus(n,r,s.CurrentFolderType),n.c3tip({messageList:r.cachedMessageList}),n}return e}};s.gridDelegate=r;var i=$(t).gridview({delegate:r});return i.show(),i.rowSelectedEvent.push(function(){u!=this.index&&N(this.index),x()}),s.dataGrid=i,t}function w(e){if(s.CurrentFolderType=="SoftwareRepository"){respool.ishanaEnable=!1;for(var t=0;t<e.data.length;t++)e.data[t].HANAenabled==1&&(respool.ishanaEnable=!0);respool.initSoftwareRepository()}c3.service.getCachedSharedFolderMonitorStatus("",s.CurrentFolderType,{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(n[i].ID==t.d.results[r].ID){n[i].MonitorStatus=t.d.results[r].Status,n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].cachedMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);break}E(n)},error:function(t){var n=c3.service.convertData(e.data);E(n)}})}function E(e){s.data=e,s.data.length==0?(s.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RES_SHARED_FOLDER"),function(){y(s)})},T()):u==-1?T():x(),s.dataGrid.reload(),s.data.length>0&&u!=-1?N(u):c[0].bindData({}),s.loadingWindow.close()}function S(e){u=0;if(s.currentFolderType!==e)if(e==="SoftwareRepository"){var t=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"14%"},{name:"DBType",description:localizedString("MISC_DBTYPE"),type:"text",width:"7%"},{name:"RootURI",description:localizedString("RESPOOL_SHAREDFOLDER_COLUMN_SPKGPATH"),type:"text",width:"36%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"28%"}];s.data=[];var n={getHeaderSpec:function(){return t},getRowCount:function(){return s.data.length},getRow:function(e){return s.data[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return u},getCell:function(){var e=null;if(this.col==0){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),n.c3tip({messageList:r.cachedMessageList}),monitorUtil.retrieveSharedFolderMonitorStatus(n,r,s.CurrentFolderType),n}if(this.colName=="DBType"){var n=$("<label>").css({"float":"left"});return this.data.SQLenabled==1&&n.append(localizedString("MSSQL")),this.data.HANAenabled==1&&n.append(localizedString("HANA")),n}return e}};s.gridDelegate=n,s.dataGrid.reset({delegate:n}),s.dataGrid.show()}else if(s.currentFolderType==="SoftwareRepository"){var t=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"URI",description:localizedString("COLUMN_PATH"),type:"text",width:"40%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"40%"}];s.data=[];var n={getHeaderSpec:function(){return t},getRowCount:function(){return s.data.length},getRow:function(e){return s.data[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return u},getCell:function(){var e=null;if(this.col==0){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),monitorUtil.retrieveSharedFolderMonitorStatus(n,r,s.CurrentFolderType),n.c3tip({messageList:r.cachedMessageList}),n}return e}};s.gridDelegate=n,s.dataGrid.reset({delegate:n}),s.dataGrid.show()}}function x(){s.btnDelete.attr({disabled:0})}function T(){s.btnDelete.attr({disabled:1})}function N(e){u=e,o=s.data[e],c[0].onViewWillAppear(),c[0].bindData(s.data[e])}this.base=c3.module,this.base();var e="respool_sharedFolders",t=localizedString("MISC_REGISTER"),n=localizedString("MISC_UNREGISTER"),r=0,i=5,s=this,o=null,u=0,a="SharedFolder",f=["SharedFolder","TenantsStorage","usersStorage","ImplementationRepository","CompanyTemplateRepository","SoftwareRepository"],l=[localizedString("RES_SH_FOLDERS"),localizedString("RES_TENANTS_STORAGES"),localizedString("USER_STORAGES"),localizedString("RES_SHARED_IMPL_REPOSITORIES"),localizedString("RES_COMPANY_TEMPLATE_REPOSITORIES"),localizedString("SOFTWARE_REPOSITORIES")],c=[new respool.sharedFolders_detail(this)];s.id=e,s.usersStorage=null,s.loadingWindow=new loadingWindow,respool.ishanaEnable=!1,this.getSelectedFolderType=function(){return a},this.getTitle=function(){return localizedString("RES_STORAGES")};var h=$("<section>").attr({id:e});this._container=h,this.onInit=function(){var e=$("<div>").addClass("storage_items_panel");s.itemPanel=e;var t=$("<ul>").attr({id:"storage_items_list"}).addClass("detail_tab_header");s.ul=t,e.append(t);for(var n=0;n<l.length;n++){var r=$("<li>").attr({id:"storage_items_list"+n}),i=$("<a>").text(l[n]).attr("title",l[n]);r.append(i),n==0&&$(i).addClass("selected");var o=f[n];i.click(function(){s.ul.find("a").each(function(e,t){$(this).removeClass("selected")}),$(this).addClass("selected");var e=$(this).text();for(var t=0;t<l.length;t++)if(l[t]==e){m(f[t]);break}}),t.append(r)}var u=$("<div>").addClass("storage_content_panel");u.append(v()),u.append(b());for(var n=0;n<c.length;n++)u.append(c[n].getContainer());c[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("RefreshStorageGrid",d)),h.append(e),h.append(u),d()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.SharedFolders,function(e){p(e)}),cometdManager.subscribe(sldEntitySet.TenantsStorages,function(e){p(e)}),cometdManager.subscribe(sldEntitySet.ImplementationRepositories,function(e){p(e)}),cometdManager.subscribe(sldEntitySet.CompanyTemplateRepositories,function(e){p(e)}),cometdManager.subscribe(sldEntitySet.SoftwareRepositories,function(e){p(e)})},this.getSelectedItem=function(){return o},this.onViewAppear=function(){},this.reload=d},respool.sharedFolders_detail=function(){function c(){var t=a._container.find("#respool_sharedFolders_detail_config_SharedFolder");t&&t.length>0?t.replaceWith(S()):(t=a._container.find("#respool_sharedFolders_detail_config_Storage"),t.replaceWith(S()),t.length==0&&(t=a._container.find("#respool_sharedFolders_detail_config_SoftwareRepository"),t.replaceWith(S())));var n=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});n.onSelectEvent.push(function(e,t){e==0?a.hgroup.css({display:"none"}):a.hgroup.css({display:""})}),n.select(0)}function h(){var t=a._container.find("#respool_sharedFolders_detail_config_SoftwareRepository");t&&t.length>0?t.replaceWith(w()):(t=a._container.find("#respool_sharedFolders_detail_config_Storage"),t.replaceWith(w()),t.length==0&&(t=a._container.find("#respool_sharedFolders_detail_config_SharedFolder"),t.replaceWith(w())));var n=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});n.onSelectEvent.push(function(e,t){e==0?a.hgroup.css({display:"none"}):a.hgroup.css({display:""})}),n.select(0)}function p(){var t=a._container.find("#respool_sharedFolders_detail_config_Storage");t&&t.length>0&&t.replaceWith(createStorageConfigPanel0());var n=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});n.onSelectEvent.push(function(e,t){e==0?a.hgroup.css({display:"none"}):a.hgroup.css({display:""})}),n.select(0)}function d(){var t=a._container.find("#respool_sharedFolders_detail_config_SharedFolder");t&&t.length>0?t.replaceWith(E()):(t=a._container.find("#respool_sharedFolders_detail_config_SoftwareRepository"),t.replaceWith(E()),t.length==0&&(t=a._container.find("#respool_sharedFolders_detail_config_Storage"),t.replaceWith(E())));var n=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});n.onSelectEvent.push(function(e,t){e==0?a.hgroup.css({display:"none"}):a.hgroup.css({display:""})}),n.select(0)}function v(e,t,n){switch(e){case"SharedFolder":c3.service.updateSharedFolder(t,n);break;case"TenantsStorage":c3.service.updateTenantsStorage(t,n);break;case"ImplementationRepository":c3.service.updateImplementationRepository(t,n);break;case"CompanyTemplateRepository":c3.service.updateCompanyTemplateRepository(t,n);break;case"SoftwareRepository":c3.service.updateSWRepository(t,n)}}function m(){var t=l.getSelectedFolderType(),n=l.getSelectedItem();a.statusData.clear();var r=function(e){for(var t=0;t<e.data.length;t++)a.statusData.push({text:e.data[t],value:e.data[t]})};switch(t){case"SharedFolder":c3.service.getSharedFolderStatus(r),a.tenantPanel.css({display:"none"}),a.huPanel.css({display:"block"});if(n&&n.ID!=undefined){var i=c3.service.getHostingUnits().expand("Tenants,Tenants/Customer,Tenants/CompanyDatabase,CommonDatabase").filter("SharedFolder/ID eq "+n.ID);i.query(g)}$("#"+e+"1").find("a").empty(),$("#"+e+"1").find("a").append(localizedString("RES_USED_BY_HU"));break;case"TenantsStorage":a.tenantPanel.css({display:"none"}),a.huPanel.css({display:"block"}),c3.service.getTenantsStorageStatus(r);if(n&&n.ID!=undefined){var i=c3.service.getHostingUnits().expand("Tenants").filter("TenantsStorage/ID eq "+n.ID);i.query(g)}$("#"+e+"1").find("a").empty(),$("#"+e+"1").find("a").append(localizedString("RES_USED_BY_HU"));break;case"ImplementationRepository":a.tenantPanel.css({display:"none"}),a.huPanel.css({display:"block"}),c3.service.getImplementationRepositoryStatus(r);if(n&&n.ID!=undefined){var i=c3.service.getHostingUnits().expand("Tenants").filter("ImplementationRepository/ID eq "+n.ID);i.query(g)}$("#"+e+"1").find("a").empty(),$("#"+e+"1").find("a").append(localizedString("RES_USED_BY_HU"));break;case"CompanyTemplateRepository":a.tenantPanel.css({display:"none"}),a.huPanel.css({display:"block"}),c3.service.getCompanyTemplateRepositoryStatus(r);if(n&&n.ID!=undefined){var i=c3.service.getHostingUnits().expand("Tenants").filter("CompanyTemplateRepository/ID eq "+n.ID);i.query(g)}$("#"+e+"1").find("a").empty(),$("#"+e+"1").find("a").append(localizedString("RES_USED_BY_HU"));break;case"SoftwareRepository":a.tenantPanel.css({display:"none"}),a.huPanel.css({display:"block"});if(n&&n.ID!=undefined){var i=c3.service.getHostingUnits().expand("Tenants").filter("SoftwareRepository/ID eq "+n.ID);i.query(g)}$("#"+e+"1").find("a").empty(),$("#"+e+"1").find("a").append(localizedString("RES_USED_BY_HU"))}}function g(e){for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;a.huData=e.data,a.usedByHUsDataGrid.reload(),a.subTitle.html(localizedString("RES_HU_NUM")+": "+a.huData.length)}function y(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<u.length;n++){var r=$("<a>").attr({href:"#"}).append(u[n]);t.append($("<li>").attr({id:e+n.toString()}).append(r))}return t}function b(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");a.title=$("<h3>").attr({id:e+"_title"}),a.subTitle=$("<h4>").attr({id:e+"_sub_title"}),a.title.html(f+": ");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(a.title).append(a.subTitle);return t.append(n),a.hgroup=n,t.append(w()),a.huPanel=respoolCommon.createHUPanel(a),a.tenantPanel=respoolCommon.createTenantPanel(a),t.append($("<section>").append(a.huPanel).append(a.tenantPanel)),t}function w(){var t=e+"_config_SharedFolder",n=$("<section>").attr({id:t}),r=[];a.statusData=[];var i=[{id:"uri",text:localizedString("COLUMN_PATH"),binding:"URI",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}],s=l.getSelectedFolderType();if(s=="TenantsStorage")var i=[{id:"uri",text:localizedString("COLUMN_PATH"),binding:"URI",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"mountPoint",text:localizedString("COLUMN_MOUNTPOINT"),binding:"MountPoint",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}];r.push(i);var o={getColumns:function(){return r},getViewContent:function(){if(this.colName=="Status"){var e=null,t={};return t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t),e}}},u=$(n).dataform({delegate:o});return a.dataform=u,n}function E(){var t=e+"_config_Storage",n=$("<section>").attr({id:t}),r=l.getSelectedFolderType(),i=[];a.statusData=[];var s=[{id:"uri",text:localizedString("COLUMN_PATH"),binding:"URI",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0},{id:"Reseller_Name",text:localizedString("RESPOOL_RESELLER_TLT"),binding:"Reseller_Name",type:"label",readonly:!0,"class":"chrome2",editable:!1}];if(r=="CompanyTemplateRepository")var s=[{id:"uri",text:localizedString("COLUMN_PATH"),binding:"URI",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"mountPoint",text:localizedString("COLUMN_MOUNTPOINT"),binding:"MountPoint",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0},{id:"Reseller_Name",text:localizedString("RESPOOL_RESELLER_TLT"),binding:"Reseller_Name",type:"label",readonly:!0,"class":"chrome2",editable:!1}];i.push(s);var o={getColumns:function(){return i},getViewContent:function(){if(this.colName=="Status"){var e=null,t={};return t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t),e}}},u=$(n).dataform({delegate:o});return a.dataform=u,n}function S(){var t=e+"_config_SoftwareRepository",n=$("<section>").attr({id:t}),r=[],i=[{id:"rootUri",text:localizedString("RESPOOL_SHAREDFOLDER_COLUMN_SPKGPATH"),binding:"RootURI",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0},{id:"version",text:localizedString("COLUMN_VERSION"),binding:"Version",type:"label",readonly:!0,"class":"chrome2",editable:!1}];r.push(i);var s={getColumns:function(){return respool.ishanaEnable?(r[0][3]={id:"hidden2",text:"",binding:"",type:"",readonly:!0,"class":"chrome2",editable:!1},r[0][4]={id:"DBType",text:localizedString("MISC_DBTYPE"),binding:"SQLenabled",type:"label",readonly:!0,"class":"chrome2",editable:!0}):(r[0][3]={id:"hidden3",text:"",binding:"",type:"",readonly:!0,"class":"chrome2",editable:!1},r[0][4]={id:"sqlEnabled",text:localizedString("MISC_DBTYPE"),binding:"SQLenabled",type:"label",readonly:!0,"class":"chrome2",editable:!0},r[0][5]={id:"hidden4",text:"",binding:"",type:"",readonly:!0,"class":"chrome2",editable:!1},r[0][6]={id:"hidden5",text:"",binding:"",type:"",readonly:!0,"class":"chrome2",editable:!1}),r},getViewContent:function(){if(this.colName=="Status"){var e=null,t={};return t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t),e}if(this.colName=="SQLenabled"){var n=$("<div>"),r=$("<label>").css({width:"10%"}).append(localizedString("MSSQL")),i=$("<input>").attr({name:"DBSelectionRadioBtn",type:"radio",disabled:!0,value:localizedString("MSSQL"),checked:this.data.SQLenabled}),s=$("<label>").append(localizedString("HANA")),o=$("<input>").attr({name:"DBSelectionRadioBtn",type:"radio",disabled:!0,value:localizedString("HANA"),checked:this.data.HANAenabled});return n.append(i).append(r).append(o).append(s),n}}},o=$(n).dataform({delegate:s});return a.dataform=o,n}this.base=c3.module,this.base();var e="respool_sharedFolders_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RES_SHARED_FOLDER_OPTION"),localizedString("RES_DETAILS")),r=String.format("{0} {1}",localizedString("RES_TENANTS_STORAGE"),localizedString("RES_DETAILS")),i=String.format("{0} {1}",localizedString("RES_SHARED_IMPL_REPOSITORY"),localizedString("RES_DETAILS")),s=String.format("{0} {1}",localizedString("RES_COMPANY_TEMPLATE_REPOSITORY"),localizedString("RES_DETAILS")),o=String.format("{0} {1}",localizedString("SOFTWAREREPO"),localizedString("RES_DETAILS")),u=[localizedString("MISC_CONFIGURATION"),localizedString("RES_USED_BY_HU")],a=this,f=localizedString("RES_SHARED_FOLDER"),l=arguments[0]||{};this._container=t,a.cont=t,a.tit=n,a.title1=r,a.title2=i,a.title3=s,a.title4=o,this.folderType1=function(){a.detailTitle.html(a.tit),h()},this.folderType2=function(){a.detailTitle.html(a.title1),h()},this.folderType3=function(){a.detailTitle.html(a.title2),d()},this.folderType4=function(){a.detailTitle.html(a.title3),d()},this.folderType5=function(){a.detailTitle.html(a.title4),c()},respool.initSoftwareRepository=c,this.onInit=function(){a.detailTitle=$("<h1>").append(n),t.append(a.detailTitle),t.append(y()),t.append(b());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?a.hgroup.css({display:"none"}):a.hgroup.css({display:""})}),r.select(0);var i=new loadingWindow;a.loadingWin=i},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){m()})},this.bindData=function(e){var t=l.getSelectedFolderType();t==="SoftwareRepository"?a.title.text(f+": "+parse(e.UpgradeWizardURI)):a.title.text(f+": "+parse(e.URI)),a.dataform.submit=function(e,n){var r={};r.success=function(e){l.reload(),n(!0),a.loadingWin.close()},r.error=function(){a.loadingWin.close()};if(e.URI||e.RootURI){var i=$("<div>");i.html(localizedString("STORAGE_UPDATE_PATH_CONFIRM")+"<br/>");var s=MessageBox.show({msg:i,width:350,height:150,icon:MessageBoxIcon.WARNING,buttons:MessageBoxButton.YESNO});s.yesEvent.push(function(){a.loadingWin.show(),v(t,e,r)})}else v(t,e,r)},a.dataform.setDataSource(e),a.dataform.dataBind(),a.dataform.changeMode(0),m()}};var respool=respool||{};respool.mailerServices=function(){function l(){o.refreshPaging=!0;var e=c3.service.getMailerServices().expand("Machine");e.count().query(o.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(o.pageSize).skip(i*o.pageSize)),e.query(d)}function c(){var t=$("<section>").addClass("tools"),n=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),i=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),s=localizedString("RES_MAILER_SERVICE");o.btnDelete=n,g(),n.click(function(){if(u!=null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),s));e.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload())},c3.service.deleteMailerService(u,e)})}else alert(localizedString("RESPOOL_IMPL_REPY_TIPMSG_PREFIX")+s+" .")}),i.click(function(){o.reload()});var a=new searchbox({inputCallback:function(e){return o.dataGrid.searchText(e)}});return t.append(n),t.append($("<div>").css({"float":"right"}).append(a.css({"float":"left"})).append(i)),t}function h(e){var t=new c3registerMailer(e);t.show()}function p(){var e=$("<section>"),t=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"15%"},{name:"Machine_Hostname",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"19%"},{name:"AccessURL",description:localizedString("COLUMN_ACCESSURL"),type:"text",width:"20%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"31%"}];o.data=[];var n={pagingMode:!0,pageSize:o.pageSize,autoResize:function(){return 540},getHeaderSpec:function(){return t},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return a},getCell:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],this.colName=="LifeCycleStatus"?t.showText=!0:t.textalign="center",e=new statusControl(t)}else{if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),n.c3tip({messageList:this.data.monitorMessageList}),n}if(this.colName=="AccessURL"){if(this.data.AccessURL!=null&&this.data.AccessURL.length>0){var i=$("<a>").attr({target:"blank",href:this.data.AccessURL}).append(this.data.AccessURL);return i}return null}}return e},getTotalCount:function(){return o.totalCount},loadPage:function(e,t){c3.service.getMailerServices().expand("Machine").orderby("ID desc").skip(e).top(t).query({success:function(e){o.data.clear();for(var t=0;t<e.data.length;t++)o.data.push(e.data[t]);o.data=c3.service.convertData(o.data),y(a),o.dataGrid.refreshContent()},error:function(e){o.loadingWindow.close()}})}};o.gridDelegate=n;var r=$(e).gridview({delegate:n});return r.rowSelectedEvent.push(function(){a!=this.index&&y(this.index),m()}),o.dataGrid=r,e}function d(e){c3.service.getMailerMonitorStatus("",{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(n[i].ID==t.d.results[r].ID){n[i].MonitorStatus=t.d.results[r].Status,n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].monitorMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);break}v(n)},error:function(t){var n=c3.service.convertData(e.data);for(var r=0;r<n.length;r++){n[r].MonitorStatus=localizedString("MONITOR_STATUS_UNKNOWN"),n[r].monitorStatusCode=5;var i=[];i.push({statusClass:"Moni_unknown",message:localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE")}),n[r].monitorMessageList=i}v(n)}})}function v(e){o.data=e,o.data.length==0?(o.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RES_MAILER_SERVICE2"),null,!0)},g()):a==-1?g():m(),o.dataGrid.reload(),o.data.length>0&&a!=-1?y(a):f[0].bindData({})}function m(){o.btnDelete.attr({disabled:0})}function g(){o.btnDelete.attr({disabled:1})}function y(e){a=e,u=o.data[e],f[0].onViewWillAppear(),f[0].bindData(o.data[e])}this.base=c3.module,this.base();var e="respool_mailerServices",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.mailerServices_detail(this)];o.id=e,o.pageSize=10,o.totalCount=0,o.refreshPaging=!1,this._container=t,this.getTitle=function(){return localizedString("RES_MAILER_SERVICES")},this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(o.getTitle())),t.append(c()),t.append(p());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-Mailer",l)),l()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Mailers,function(e){o.reload()})},this.getSelectedItem=function(){return u},this.onViewAppear=function(){o.dataGrid.show()},this.reload=l,o.countHandler={success:function(e){o.totalCount=parseInt(e.data,10)},error:function(e){}}},respool.mailerServices_detail=function(){function f(){var e=a.getSelectedItem();if(e&&e.ID!=undefined){var t=c3.service.getHostingUnits().expand("Tenants").filter("Mailer/ID eq "+e.ID);Utility.SplitPage||(t=t.top(u).skip(o*u)),t.query(l)}}function l(e){for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;i.huData=e.data,i.usedByHUsDataGrid.reload(),i.subTitle.html(localizedString("RES_HU_NUM")+": "+i.huData.length)}function c(){var e=$("<ul>").addClass("detail_tab_header");for(var t=0;t<r.length;t++){var n=$("<a>").attr({href:"#"}).append(r[t]);e.append($("<li>").append(n))}return e}function h(){var e=$("<section>").addClass("tab_body");i.title=$("<h3>"),i.subTitle=$("<h4>"),i.title.html(s+":");var t=$("<hgroup>").append(i.title).append(i.subTitle);return e.append(t),i.hgroup=t,e.append(p()),e.append(respoolCommon.createHUPanel(i)),e}function p(){var t=$("<section>").attr({id:e+"_config"}),n=[{id:"testConnection",text:localizedString("MISC_TEST_CONNECTION"),type:"button"}],r=[];i.statusData=[],i.lifeCycleStatusData=[];var s=[{id:"name",text:localizedString("COLUMN_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"hostname",text:localizedString("COLUMN_HOSTNAME"),binding:"Machine_Hostname",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"accessURL",text:localizedString("COLUMN_ACCESSURL"),binding:"AccessURL",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",controlClass:"value",rows:3,divcss:{clear:"left"},editable:!0}];r.push(s);var o={getColumns:function(){return r},getViewContent:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}else if(this.colName=="AccessURL"){if(this.data.AccessURL!=null&&this.data.AccessURL.length>0){var n=$("<a>").attr({target:"blank",href:this.data.AccessURL}).append(this.data.AccessURL);return n}return null}return e}},u=$(t).dataform({delegate:o});return i.dataform=u,t}this.base=c3.module,this.base();var e="respool_mailerServices_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localization.RES_MAILER_SERVICE,localization.RES_DETAILS),r=[localizedString("MISC_CONFIGURATION"),localizedString("RES_USED_BY_HU")],i=this,s=localizedString("RESPOOL_MAILER_TLT_PREFIX"),o=0,u=5,a=arguments[0]||{};this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(c()),t.append(h());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==2?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){f()})},this.bindData=function(e){i.title.text(s+": "+parse(e.Machine_Hostname)),i.dataform.submit=function(e,t){var n={};n.success=function(e){a.reload(),t(!0)},c3.service.updateMailerService(e,n)},i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getMailerServiceStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),i.lifeCycleStatusData.clear(),c3.service.getMailerServiceLifeCycleStatus(function(e){for(var t=0;t<e.data.length;t++)i.lifeCycleStatusData.push({text:e.data[t],value:e.data[t]})}),f()}};var respool=respool||{};respool.workStations=function(){function l(){var e=c3.service.getLogicalMachines();Utility.SplitPage||(e=e.top(s).skip(i*s)),e.query(p)}function c(){var t=$("<section>").addClass("tools"),i=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),s=localizedString("RESPOOL_WORKSTATION_EMPTY_TIPMSG_PART");return i.click(function(){if(u!=null){var e=MessageBox.confirm(localizedString("RESPOOL_WORKSTATION_EMPTY_TIPMSG_PREFIX")+s+" ?");e.yesEvent.push(function(){var e={};e.success=function(e){o.reload()},c3.service.deleteLogicalMachine(u,e)})}else alert(localizedString("RESPOOL_IMPL_REPY_TIPMSG_PREFIX")+s+" .")}),t.append($("<input>").attr({value:n,type:"button",id:e+"btnRegister"}).click(function(){createMailerService(o)})),t.append($("<span>").addClass("split")),t.append(i),t}function h(){var e=$("<section>"),t=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"LifeCycleStatus",description:localizedString("RESPOOL_WORKSTATION_COLUMN_LSTATUS"),type:"text",width:"15%"},{name:"Hostname",description:localizedString("RESPOOL_SLDAGENT_COLUMN_HOSTNAME"),type:"text",width:"10%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"20%"},{name:"IsSlave",description:localizedString("RESPOOL_WORKSTATION_COLUMN_ISSLAVE"),type:"text",width:"10%"},{name:"IsSlaveAvailable",description:localizedString("RESPOOL_WORKSTATION_COLUMN_ISSLAVEAVA"),type:"text",width:"10%"},{name:"",description:"",type:"text",width:"35%"}];o.data=[];var n={getHeaderSpec:function(){return t},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return a},getTip:function(){var e=$("<span>").append(localizedString("RESPOOL_WORKSTATION_TIP_PREFIX")),t=$("<a href='#'>").append("create");return t.click(function(){createMailerService(o)}),e.append(t),e.append(localizedString("RESPOOL_WORKSTATION_TIP_SUFFIX")),e}},r=$(e).gridview({delegate:n});return r.show(),r.rowSelectedEvent.push(function(){a!=this.index&&d(this.index)}),o.dataGrid=r,e}function p(e){o.data=e.data,o.dataGrid.reload(),o.data.length>0?d(a):f[0].bindData([])}function d(e){f[0].onViewWillAppear(),f[0].bindData(o.data[e]),a=e,u=o.data[e]}this.base=c3.module,this.base();var e="respool_workStations",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.workStations_detail(this)];o.id=e,this._container=t,this.onInit=function(){t.append(c()),t.append(h());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),l()},this.reload=l},respool.workStations_detail=function(){function f(){var e=$("<ul>").addClass("detail_tab_header");for(var t=0;t<r.length;t++){var n=$("<a>").attr({href:"#"}).append(r[t]);e.append($("<li>").append(n))}return e}function l(){var e=$("<section>").addClass("tab_body");i.title=$("<h3>"),i.subTitle=$("<h4>"),i.title.html(s+":");var t=$("<hgroup>").append(i.title).append(i.subTitle);return e.append(t),i.hgroup=t,e.append(c()),e.append(c3log.createAdminData(i)),e}function c(){var t=$("<section>").attr({id:e+"_config"}),n=[{id:"testConnection",text:localizedString("MISC_TEST_CONNECTION"),type:"button"}],r=[];i.statusData=[],i.lifeCycleStatusData=[];var s=[{id:"hostname",text:localizedString("RESPOOL_SLDAGENT_COLUMN_HOSTNAME"),binding:"Hostname",type:"text",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"isSlave",text:localizedString("RESPOOL_WORKSTATION_COLUMN_ISSLAVE"),binding:"IsSlave",type:"checkbox",readonly:!0,"class":"chrome2",editable:!0},{id:"lifeCycleStatus",text:localizedString("RESPOOL_WORKSTATION_COLUMN_LSTATUS"),binding:"LifeCycleStatus",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.lifeCycleStatusData}},{id:"isSlaveAvailable",text:localizedString("RESPOOL_WORKSTATION_COLUMN_ISSLAVEAVA"),binding:"IsSlaveAvailable",type:"checkbox",readonly:!0,"class":"chrome2",editable:!0},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0}];r.push(s);var o={getToolbarItems:function(){return n},getColumns:function(){return r}},u=$(t).dataform({delegate:o});return i.dataform=u,t}this.base=c3.module,this.base();var e="respool_workStations_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=localizedString("RESPOOL_WORKSTATION_SELECT_DETAILS"),r=[localizedString("MISC_CONFIGURATION"),localizedString("MISC_ADMINISTRATION")],i=this,s=localizedString("RESPOOL_WORKSTATION_UPPERCASE"),o=0,u=5,a=arguments[0]||{};this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(f()),t.append(l());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):i.hgroup.css({display:""})}),r.select(0)},this.bindData=function(e){i.title.text(s+": "+parse(e.Hostname)),i.dataform.submit=function(e,t){var n={};n.success=function(e){a.reload(),t(!0)},c3.service.updateLogicalMachine(e,n)},i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getLogicalMachineStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),i.lifeCycleStatusData.clear(),c3.service.getLogicalMachineLifeCycleStatus(function(e){for(var t=0;t<e.data.length;t++)i.lifeCycleStatusData.push({text:e.data[t],value:e.data[t]})})}};var respool=respool||{};respool.implRepositoty=function(){function l(){var e=c3.service.getImplementationRepositories();Utility.SplitPage||(e=e.top(s).skip(i*s)),e.query(d)}function c(){var t=$("<section>").addClass("tools"),i=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),s=$("<a>").attr({href:"#",id:"btnRefresh_"+e}).addClass("refresh"),f=localizedString("RESPOOL_IMPL_REPY_PKGREPY");return o.btnDelete=i,m(),i.click(function(){if(u!=null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),f));e.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload()),m(),a=-1},c3.service.deleteImplementationRepository(u,e)})}else alert(localizedString("RESPOOL_IMPL_REPY_TIPMSG_PREFIX")+f+" .")}),s.click(function(){o.reload()}),t.append($("<input>").attr({value:n,type:"button",id:e+"btnRegister"}).click(function(){h(o)})),t.append($("<span>").addClass("split")),t.append(i),t.append($("<div>").css({"float":"right"}).append(s)),t}function h(e){var t=new c3registerImplRepository(e);t.show()}function p(){var t=$("<section>").attr({id:e+"_masterDataGrid"}),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"URI",description:localizedString("COLUMN_PATH"),type:"text",width:"40%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"54%"}];o.data=[];var r={getHeaderSpec:function(){return n},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return a},getCell:function(){var e=null;if(this.col==0){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}};o.gridDelegate=r;var i=$(t).gridview({delegate:r});return i.rowSelectedEvent.push(function(){a!=this.index&&g(this.index),v()}),o.dataGrid=i,t}function d(e){var t=c3.service.convertData(e.data);o.data=t,o.data.length==0?(o.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RESPOOL_IMPL_REPY_PKGREPY"),function(){h(o)})},m()):a==-1?m():v(),o.dataGrid.reload(),o.data.length>0&&a!=-1?g(a):f[0].bindData({})}function v(){o.btnDelete.attr({disabled:0})}function m(){o.btnDelete.attr({disabled:1})}function g(e){f[0].onViewWillAppear(),f[0].bindData(o.data[e]),a=e,u=o.data[e]}this.base=c3.module,this.base();var e="respool_implementationRepository",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.implRepositoty_detail(this)];o.id=e,this._container=t,this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(o.getTitle())),t.append(c()),t.append(p());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-PackageRepository",l)),l()},this.onViewAppear=function(){o.dataGrid.show()},this.reload=l},respool.implRepositoty_detail=function(){function u(e){for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;i.huData=e.data,i.usedByHUsDataGrid.reload(),i.subTitle.html(localizedString("RES_HU_NUM")+": "+i.huData.length)}function a(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function f(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+": ");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(l()),i.huPanel=respoolCommon.createHUPanel(i),t.append($("<section>").append(i.huPanel)),t}function l(){var t=e+"_config",n=$("<section>").attr({id:t}),r=[];i.statusData=[];var s=[{id:"uri",text:localizedString("COLUMN_PATH"),binding:"URI",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}];r.push(s);var o={getColumns:function(){return r},getViewContent:function(){if(this.colName=="Status"){var e=null,t={};return t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t),e}}},u=$(n).dataform({delegate:o});return i.dataform=u,n}this.base=c3.module,this.base();var e="respool_implRepository_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RESPOOL_IMPL_REPY_PKGREPY"),localizedString("RES_DETAILS")),r=[localizedString("MISC_CONFIGURATION"),localizedString("RES_USED_BY_HU")],i=this,s=localizedString("RESPOOL_IMPL_REPY_PKGREPY"),o=arguments[0]||{};this._container=t,this.onInit=function(){i.detailTitle=$("<h1>").append(n),t.append(i.detailTitle),t.append(a()),t.append(f());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):i.hgroup.css({display:""})}),r.select(0)},this.bindData=function(e){i.title.text(s+": "+parse(e.URI)),i.dataform.submit=function(e,t){var n={};n.success=function(e){o.reload(),t(!0)},c3.service.updateImplementationRepository(e,n)},i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getImplementationRepositoryStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})});if(e.ID!=undefined){var t=c3.service.getHostingUnits().expand("Tenants").filter("ImplementationRepository/ID eq "+e.ID);Utility.SplitPage||(t=t.top(huPageSize).skip(huPage*huPageSize)),t.query(u),t.query(function(t){t.data.length>0&&(e.HostingUnit_Name=t.data[0].Name,i.dataform.setDataSource(e),i.dataform.dataBind())})}}};var respool=respool||{};respool.mailServer=function(){function l(){var e=c3.service.getMailServer().expand("SmtpHost");Utility.SplitPage||(e=e.top(s).skip(i*s)),e.query(c)}function c(e){h(e)}function h(e){c3.service.getCachedMailServerMonitorStatus("",{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(n[i].ID==t.d.results[r].ID){n[i].MonitorStatus=t.d.results[r].Status,n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].cachedMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);break}m(n)},error:function(t){var n=c3.service.convertData(e.data);m(n)}})}function p(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),i=$("<input>").attr({value:n,type:"button",id:e+"btnRegister"}),s=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),f=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),c=localizedString("RES_MAIL_SERVER");o.btnRegister=i,o.btnDelete=s,y(),w(),s.click(function(){if(u!=null){var e=null;e=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),c)),e.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload()),w(),a=-1};var t={};t.success=function(){l()},c3.service.deleteMailServer(u,t)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),c))}),f.click(function(){o.reload()}),i.click(function(){d(o)});var h=new searchbox({inputCallback:function(e){return o.dataGrid.searchText(e)}});return t.append(i),t.append($("<span>").addClass("split")),t.append(s),t.append($("<div>").css({"float":"right"}).append(h.css({"float":"left"})).append(f)),t}function d(e){var t=new c3registerMailServer(e);t.show()}function v(){var t=$("<section>").attr({id:e+"_masterDataGrid"}),n=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"10%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"SmtpHost",description:localizedString("MAIL_SERVER_REG_STEP_SMTP")+" "+localizedString("MAIL_SERVER_SMTP_HOST"),type:"text"},{name:"SmtpPort",description:localizedString("MAIL_SERVER_REG_STEP_SMTP")+" "+localizedString("MAIL_SERVER_SMTP_PORT"),type:"text",dataType:"number"},{name:"SmtpSecurity",description:localizedString("MAIL_SERVER_REG_STEP_SMTP")+" "+localizedString("MAIL_SERVER_SMTP_SECURITY"),type:"text"},{name:"SmtpSslPort",description:localizedString("MAIL_SERVER_REG_STEP_SMTP")+" "+localizedString("MAIL_SERVER_SMTP_SSL_PORT"),type:"text",dataType:"number"}];o.data=[];var r={autoResize:function(){return 850},getHeaderSpec:function(){return n},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight/3},getDefaultSelectedIndex:function(){return a},getCell:function(){var e=null,t={};if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),n.c3tip({messageList:r.cachedMessageList}),n}return this.colName=="SmtpHost"&&this.data.SmtpHost_Hostname&&(e=this.data.SmtpHost_Hostname),e}};o.gridDelegate=r;var i=$(t).gridview({delegate:r});return i.rowSelectedEvent.push(function(){a!=this.index&&E(this.index),b()}),o.dataGrid=i,t}function m(e){o.data=e,o.data.length==0?(o.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RES_MAIL_SERVER"),function(){d(o)})},w(),g()):(a==-1?w():b(),y()),o.dataGrid.reload(),o.data.length>0&&a!=-1?E(a):f[0].bindData({})}function g(){o.btnRegister.attr({disabled:0})}function y(){o.btnRegister.attr({disabled:1})}function b(){o.btnDelete.attr({disabled:0})}function w(){o.btnDelete.attr({disabled:1})}function E(e){a=e,u=o.data[e],f[0].onViewWillAppear(),f[0].bindData(o.data[e])}this.base=c3.module,this.base();var e="respool_mailServer",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.mailServer_detail(this)];o.id=e,this._container=t,this.getTitle=function(){return localizedString("RES_MAIL_SERVER")},this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(o.getTitle())),t.append(p()),t.append(v());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-MailServer",l));var n=new loadingWindow;o.loadingWin=n,l()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.MailServers,function(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){o.reload();break}}else o.reload()})},this.getSelectedItem=function(){return u},this.onViewAppear=function(){o.dataGrid.show()},this.reload=l,this.getMenuIcon=function(){return"mailer_icon"}},respool.mailServer_detail=function(){function f(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function l(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+":");var n=$("<hgroup>").append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(c()),t}function c(){var t=e+"_config",n=$("<section>").attr({id:t}),r=[];i.statusData=[],i.securityValidValues=[{text:"PLAIN",value:"PLAIN"},{text:"SSL",value:"SSL"},{text:"STARTTLS",value:"STARTTLS"}];var s=[{id:"Status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"a",text:localizedString("MAIL_SERVER_REG_STEP_SMTP_TITLE"),binding:"",type:"label",readonly:!0,"class":"chrome2 newSection",editable:!1},{id:"SmtpHost",text:localizedString("MAIL_SERVER_SMTP_HOST"),binding:"SmtpHost_Hostname",type:"text",readonly:!0,"class":"chrome2",editable:!1},{id:"SmtpPort",text:localizedString("MAIL_SERVER_SMTP_PORT"),binding:"SmtpPort",type:"text",readonly:!0,"class":"chrome2",editable:!0,editPattern:"(6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3})",editPlaceholder:"1-65535, "+localizedString("MISC_DEFAULT")+": 25"},{id:"SmtpSecurity",text:localizedString("MAIL_SERVER_SMTP_SECURITY"),binding:"SmtpSecurity",type:"text",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.securityValidValues}},{id:"SmtpSslPort",text:localizedString("MAIL_SERVER_SMTP_SSL_PORT"),binding:"SmtpSslPort",type:"text",readonly:!0,"class":"chrome2",editable:!0,editPattern:"(6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3})",editPlaceholder:"1-65535, "+localizedString("MISC_DEFAULT")+": 465"},{id:"SmtpUsername",text:localizedString("MAIL_SERVER_SMTP_USERNAME"),binding:"SmtpUsername",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"SmtpPassword",text:localizedString("MAIL_SERVER_SMTP_PASSWORD"),binding:"SmtpPassword",type:"password",readonly:!0,"class":"chrome2",editable:!0},{id:"a",text:localizedString("MAIL_SERVER_REG_STEP_OTHER"),binding:"",type:"label",readonly:!0,"class":"chrome2 newSection",editable:!1},{id:"EmailDelimiter",text:localizedString("MAIL_SERVER_EMAIL_DELIMITER"),binding:"EmailDelimiter",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"DefaultFromEmailAddress",text:localizedString("MAIL_SERVER_DEFAULT_FROM_EMAIL"),binding:"DefaultFromEmailAddress",type:"text",readonly:!0,"class":"chrome2",editable:!0,editPattern:"^\\w+[\\w\\._-]*\\w+\\@(((25[0-5]|2[0-4]\\d|1\\d\\d|\\d{1,2})\\.){3}(25[0-5]|2[0-4]\\d|1\\d\\d|\\d{1,2})|([a-zA-Z]([\\da-zA-Z\\.\\-]?){0,61}[\\da-zA-Z]))$"},{id:"DefaultFromEmailName",text:localizedString("MAIL_SERVER_DEFAULT_FROM_NAME"),binding:"DefaultFromEmailName",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"DefaultCharset",text:localizedString("MAIL_SERVER_DEFAULT_CHARSET"),binding:"DefaultCharset",type:"text",readonly:!0,"class":"chrome2",editable:!0}];r.push(s);var o={getColumns:function(){return r},getViewContent:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}return e}},u=$(n).dataform({delegate:o});i.dataform=u;var a=i.dataform.getToolbar(),f=a.edit.parent(".tools");return n}function h(e,t){function n(){if(isNaN(parseInt(t)))return;if(t<=0)return;c3.service.getTaskProgress(e).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase().toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(e).expand("TaskParameters").query(function(e){Utility.logTaskError(e.data)}):(t--,setTimeout(n,5e3))})}n()}this.base=c3.module,this.base();var e="respool_mailServer_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RES_MAIL_SERVER"),localizedString("RES_DETAILS")),r=[localizedString("MISC_CONFIGURATION")],i=this,s=localizedString("RESPOOL_MAIL_SERVER_TLT"),o=0,u=5,a=arguments[0]||{};this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(f()),t.append(l());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==1?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.onInitNotification=function(){},this.bindData=function(e){e&&i.title.text(s),i.dataform.submit=function(e,t){var n={};n.success=function(e){a.reload(),t(!0)};var r=["SmtpPort","SmtpSslPort"];for(var i=0;i<r.length;i++)e[r[i]]!=undefined&&e[r[i]]==""&&(e[r[i]]=null);c3.service.updateMailServer(e,n)},i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getMailServerStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),c3.service.getMailServerSecurityValidValues(function(e){i.securityValidValues.clear();for(var t=0;t<e.data.length;t++)i.securityValidValues.push({text:e.data[t],value:e.data[t]})})}};var respool=respool||{};respool.extension=function(){function l(){var e=$("<section>"),t=[{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"15%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"10%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"7%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"7%"},{name:"Path",description:localizedString("MISC_PATH"),type:"text",width:"61%"}];i.data=[];var n={pagingMode:!0,pageSize:i.pageSize,autoResize:function(){return 540},getHeaderSpec:function(){return t},getRowCount:function(){return i.data.length},getRow:function(e){return i.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return a},getTotalCount:function(){return i.totalCount},loadPage:function(e,t){c3.service.getExtensions().filter("Type ne '"+sldEntity.ExtensionType.B1script+"'").orderby("Vendor, Name, Version desc").skip(e).top(t).query({success:function(e){i.data.clear(),i.data=v(e.data),i.data=c3.service.convertData(i.data),g(a),i.dataGrid.refreshContent()},error:function(e){i.loadingWindow.close()}})}};i.gridDelegate=n;var r=$(e).gridview({delegate:n});return r.show(),r.rowSelectedEvent.push(function(){a!=this.index&&g(this.index)}),i.dataGrid=r,b(),e}function c(){var t=$("<section>").attr({id:n+"_toolbar"}).addClass("tools"),r=$("<label>").attr({id:"lbRepoPath"}).text(localizedString("RESPOOL_EXTSION_REPPATH")),s=$("<input>").attr({type:"button",id:"btnImport",value:localizedString("MISC_SYNC")}),o=$("<input>").attr({type:"button",id:"btnRemove",value:localizedString("MISC_REMOVE")}),a=$("<a>").attr({href:"#",id:"btnSwitch_"+e,title:localizedString("MISC_COMPABILITY_CHECK_OFF")}).addClass("switch_off").css({"float":"left"}),f=$("<a>").attr({href:"#",id:"btnReport_"+e,title:localizedString("EXTENSION_HISTORY_REPORT")}).addClass("report").css({"float":"left"}),l=$("<a>").attr({href:"#",id:"btnConfig_"+e,title:localizedString("WIZARD_ADDON_SET_REPO_PATH")}).addClass("path").css({"float":"left"}),c=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:localizedString("MISC_REFRESH")}).addClass("refresh").css({"float":"left"});l.click(function(){var e=new c3setExtensionPath(i,i.repoData,!1);e.show(),i.extPathWin=e}),s.click(function(){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_SYNC_CONFIRM"),localizedString("EXTENSION_LOWER")));e.yesEvent.push(function(){if(!i.repoData){var e=new c3setExtensionPath(i,i.repoData,!0);e.show(),i.extPathWin=e}else c3.service.synchronizeExtensionRepository(i.extensionSyncReportEntity,function(e,t){if(t=="success"){taskId=e.d.SynchronizeExtensionRepository,i.taskID=taskId;var n=new c3extensionSyncReportList(i);n.show()}if(t=="error"){var r=retriveErrorCode(e.responseText),s=retriveErrorCode(e.responseText);(r=="9107"||r=="9106")&&c3.service.getCurrentTaskId(function(e){var t={};i.taskID=e.d.CurrentExtensionSynchronizationTaskId,t.hideNo=!0,t.hideFinish=!1,t.oktext=localizedString("MISC_OK");var n=MessageBox.confirm({msg:localizedString("RES_MISC_SYNC_PROCESSING"),width:320,height:130});n.yesEvent.push(function(){var e=new c3extensionSyncReportList(i);e.show()})})}})})}),o.click(function(){if(u!=null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_REMOVE_CONFIRM"),localizedString("EXTENSION")));e.yesEvent.push(function(){var e={};e.success=function(e){i.reload()},c3.service.deleteExtension(u,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),msgVar))}),f.click(function(){var e=new c3extensionSyncReportHistory;e.show()}),c.click(function(){i.reload()}),t.append(s),t.append($("<span>").addClass("split")),t.append(o);var h=new searchbox({inputCallback:function(e){return i.dataGrid.searchText(e)}}),p=(new Split({permissions:[permissionItems.operator]})).dom;return t.append($("<div>").css({"float":"right"}).append(f).append(l).append(p.css({"float":"left"})).append(h.css({"float":"left"})).append(c)),i.btnRemove=o,t}function h(){c3.biz.repositoryManager.getExtensionRepository(d)}function p(){i.refreshPaging=!0;var e=c3.service.getExtensions().filter("Type ne '"+sldEntity.ExtensionType.B1script+"'").orderby("Vendor, Name, Version desc");e.count().query(i.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(i.pageSize).skip(s*i.pageSize)),e.query(m),h()}function d(e){e&&(i.repoData=e)}function v(e){var t=[];for(var n=0;n<e.length;n++)t.push({ID:e[n].ID,Name:e[n].Name,Vendor:e[n].Vendor,Version:e[n].Version,Path:e[n].Path,Type:convertToDisplayExtensionType(e[n].Type),Builtin:e[n].IsBuiltIn});return t}function m(e){var t=c3.service.convertData(e.data);i.data=v(t),i.data.length==0?(i.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("EXTENSION_LOWER"),null,!0)},b()):a==-1?b():y(),i.dataGrid.reload(),i.data.length>0&&a!=-1?g(a):f[0].bindData({})}function g(e){f[0].onViewWillAppear(),f[0].bindData(i.data[e]),a=e,u=i.data[e],u.Builtin==1?b():y()}function y(){i.btnRemove.attr({disabled:0})}function b(){i.btnRemove.attr({disabled:1})}this.base=c3.module,this.base();var e="repository",t="b1_repo",n="extension_repo",r=$("<section>").attr({id:n}),i=this;i.pageSize=10,i.totalCount=0,i.refreshPaging=!1,this._container=r;var s=0,o=5,u=null,a=0,f=[new respool.extension.addonDetail(this)];this.getTitle=function(){return localizedString("ADDON_EXTENSIONS")},this.onInit=function(){r.append($("<div>").attr("class","title_panel").append(i.getTitle())),r.append(c()),r.append(l());for(var e=0;e<f.length;e++)r.append(f[e].getContainer());f[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-SWRepository",p)),c3ModuleManager.Listeners.push(new c3Listener("SoftwareRepositoryRemoved",p)),c3ModuleManager.Listeners.push(new c3Listener("SynchronizeExtension",p)),c3ModuleManager.Listeners.push(new c3Listener("CommonDatabaseRemoved",p)),c3ModuleManager.Listeners.push(new c3Listener("Referesh_Extension",p)),p()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Extensions,function(e){i.reload()})},this.onViewAppear=function(){i.dataGrid.show()},this.reload=p,this.refreshRepoData=h,i.countHandler={success:function(e){i.totalCount=parseInt(e.data,10)},error:function(e){}}},respool.extension.addonDetail=function(){function f(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function l(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");return t.append(p()),t.append(c()),t.append(h()),t.append(d()),t.append(m()),t}function c(){var t=$("<section>").attr({id:e+"_suPanelContainer"});i.suSubTitle=$("<h3>").attr({id:e+"_title"}),i.suSubTitle.html(s+": ");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.suSubTitle);return t.append(n),i.hgroup=n,t.append(respoolCommon.createHUPanel(i)),t}function h(){var t=$("<section>").attr({id:e+"_tenantPanelContainer"});i.tenantSubTitle=$("<h3>").attr({id:e+"_title"}),i.tenantSubTitle.html(o+": ");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.tenantSubTitle);return t.append(n),i.hgroup=n,t.append(respoolCommon.createTenantPanel(i)),t}function p(){var t=e+"_configuration",n=$("<section>").attr({id:t}),r=[];i.statusData=[],i.modeData=[];var s=[{id:"Name",text:localizedString("COLUMN_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"Type",text:localizedString("MISC_TYPE"),binding:"Type",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"Version",text:localizedString("COLUMN_VERSION"),binding:"Version",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"Provider",text:localizedString("COLUMN_PROVIDER"),binding:"Vendor",type:"label",readonly:!0,"class":"chrome2",editable:!1}];r.push(s);var o={getColumns:function(){return r},getAllowEdit:function(){return!1}},u=$(n).dataform({delegate:o});return i.dataform=u,n}function d(){var t=e+"_validition",n=$("<section>").attr({id:t}),r=$("<h3>").attr({id:e+"_title"}),s=localizedString("EXTENSION_VALIDATION_DESC");r.html(s);var o=$("<hgroup>").attr({id:e+"_title_group"}).append(r);n.append(o),i.hgroup=o;var u=$("<section>"),a=[{name:"From",description:localizedString("MISC_FROM"),type:"text",width:"30%"},{name:"To",description:localizedString("MISC_TO"),type:"text",width:"70%"}];i.validationData=[];var f={getHeaderSpec:function(){return a},getRowCount:function(){return i.validationData.length},getRow:function(e){return i.validationData[e]},getGridHeight:function(){return Utility.DetailTableHeight}},l=$(u).gridview({delegate:f});return l.show(),i.validationGrid=l,n.append(u),n}function v(){var t=e+"_PlainContent",n=$("<section>").attr({id:t}),r=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"30%"},{name:"Value",description:localizedString("MISC_VALUE"),type:"text",width:"70%"}];i.plainContentData=[];var s={getHeaderSpec:function(){return r},getRowCount:function(){return i.plainContentData.length},getRow:function(e){return i.plainContentData[e]},getGridHeight:function(){return Utility.DetailTableHeight}},o=$(n).gridview({delegate:s});return o.show(),n}function m(){var t=e+"_Property",n=$("<section>").attr({id:t}),r=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"20%"},{name:"Value",description:localizedString("MISC_VALUE"),type:"text",width:"20%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"60%"}];i.properData=[];var s={getHeaderSpec:function(){return r},getRowCount:function(){return i.properData.length},getRow:function(e){return i.properData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(){if(this.colName=="Value"){var e=this,t={},n=e.data,r=$("<div>").addClass("statusControl"),i=$("<div>").addClass("td_extproperty").text(n.Value).attr({title:n.Value});t.ID=n.ID;if(n.Config){var s=new textbox({maxlength:500}),o=s.attr({value:n.Value,width:"20px"}).bind("change",function(){t.PropertyValue=s.val().trim()}),u=$("<select>").bind("change",function(e){var n=u.find("option:selected").val();t.PropertyValue=n}),f=function(e){var t={success:function(e){a.reload()},error:function(e){console.log(e)}};c3.service.updateExtensionProperties(e,t)},l=$("<label>").attr({title:localizedString("MISC_SAVE")}).addClass("ShowIcon Save").click(function(){if($.trim(t.PropertyValue)==""){s.showErrorMessage(localizedString("EXTENSION_PROPERTY_VALUE_EMPTY_WARNING_MSG"));return}f(t)}),c=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel").click(function(){d.hide(),p.show()}),h=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){s.val(n.Value),u.val(n.Value),d.show(),p.hide(),o.focus()}),p=$("<div>").css({"float":"left"}).append(i).append(h),d=$("<div>").css({"float":"left"}).attr({title:n.Value}),v={};n.ValidValues&&$.trim(n.ValidValues)!=""&&(v=JSON.parse(n.ValidValues)),jQuery.isEmptyObject(v)?d.append(o):($.each(v,function(e){optionType=$("<option>").attr({value:v[e],title:e}).append(e),v[e]==n.Value&&(i.text(e).attr({title:e}),optionType.attr({selected:!0}),u.attr({title:e})),u.append(optionType)}),d.append(u)),d.append(l).append(c),d.hide(),r.append(p).append(d)}else r.append(i);return r}}},o=$(n).gridview({delegate:s});return o.show(),i.properGrid=o,n}function g(e){var t=e.data,n=[];for(var r=0;r<t.length;r++)n.push({ID:t[r].ID,Name:t[r].PropertyName,Value:t[r].PropertyValue,Config:t[r].Configurable,Description:t[r].Description,ValidValues:t[r].ValidValuesInfo});i.properData=n,i.properGrid.reload()}function y(e){var t=e.data;validitiaonlist=[];for(var n=0;n<t.length;n++)validitiaonlist.push({ID:t[n].ID,From:t[n].FromVersion,To:t[n].ToVersion});i.validationData=validitiaonlist,i.validationGrid.reload()}function b(e){if(e.data){var t=[];for(var n=0;n<e.data.length;n++)e.data[n].CustomerNumber=e.data[n].Tenants.results.length,t.push(e.data[n])}i.huData=t,i.usedByHUsDataGrid.reload(),u==1&&i.suSubTitle.html(s+": "+i.huData.length)}function w(e){var t=c3.service.convertData(e.data);i.tenantData=t,i.usedByTenantsDataGrid.reload(),u==2&&i.tenantSubTitle.html(o+": "+i.tenantData.length)}function E(e,t){u=e,e==1?i.suSubTitle.html(s+": "+i.huData.length):e==2&&i.tenantSubTitle.html(o+": "+i.tenantData.length)}this.base=c3.module,this.base();var e="repository_extensionDetail",t=$("<section>").attr({id:e}).addClass("tab"),n=n=localizedString("EXT_DETAIL_TITLE"),r=[localizedString("MISC_CONFIGURATION"),localizedString("ADDON_ASSIGNED_TO_SUS"),localizedString("ADDON_USED_BY_TENANTS"),localizedString("ADDON_VALIDATION_COMPATIBILITY"),localizedString("DETAIL_PROPERTY")],i=this,s=localizedString("RES_HU_NUM"),o=localizedString("HU_TENANT_NUM"),u=0,a=arguments[0]||{};this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(f()),t.append(l());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});r.onSelectEvent.push(E),r.select(0)},this.bindData=function(t){i.dataform.submit=function(e,t){},i.dataform.setDataSource(t),i.dataform.dataBind(),i.dataform.changeMode(0);if(t.ID!=undefined){var n=c3.service.getExtensionDeployments().expand("Extension,CommonDatabase").filter(String.format("Extension/ID eq {0}",t.ID)+" and (Extension/Type ne '"+sldEntity.ExtensionType.B1script+"')").query(function(e){if(e.data.length>0){var t="CommonDatabase/ID eq {0}",n="";for(var r=0;r<e.data.length;r++)n+=String.format(t,e.data[r].CommonDatabase.ID),r!=e.data.length-1&&(n+=" or ");c3.service.getHostingUnits().expand("CommonDatabase,Tenants").filter(n).query(b)}else b({data:[]})});n=c3.service.getExtensionAssignments().expand("ExtensionDeployment, ExtensionDeployment/Extension, CompanyDatabase").filter(String.format("ExtensionDeployment/Extension/ID eq {0}",t.ID)+" and (ExtensionDeployment/Extension/Type ne '"+sldEntity.ExtensionType.B1script+"')").query(function(e){if(e.data.length>0){var t="CompanyDatabase/ID eq {0}",n="";for(var r=0;r<e.data.length;r++)n+=String.format(t,e.data[r].CompanyDatabase.ID),r!=e.data.length-1&&(n+=" or ");c3.service.getTenants().expand("CompanyDatabase, ServiceUnit, Customer").filter(n).query(w)}else w({data:[]})}),n=c3.service.getExtensionValidities().expand("Extension").filter(String.format("Extension/ID eq {0}",t.ID)).query(function(e){e.data.length>0?y(e):y({data:[]})}),n=c3.service.getExtensionProperties().expand("Extension").filter("Extension/ID eq "+t.ID+" and Layer eq 'Repository'").query(function(e){e.data.length>0?g(e):g({data:[]})})}else i.huData=[],i.usedByHUsDataGrid.reload(),i.tenantData=[],i.usedByTenantsDataGrid.reload(),i.validationData=[],i.validationGrid.reload(),i.properData=[],i.properGrid.reload()}},function(){"use strict";var e={master:{toolbars:[{left:[{type:"button",value:localizedString("MISC_REGISTER"),bindings:{disabled:"cannotRegister"},commands:{click:"registerCommand"},permissionItems:[]},{type:"split"},{type:"button",value:localizedString("MISC_UNREGISTER"),bindings:{disabled:"cannotUnregister"},commands:{click:"deleteCommand"},permissionItems:[]}],right:[{type:"refresh",commands:{click:"onLoaded"}}]}],content:{type:"gridview",header:[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"UNC",description:localizedString("COLUMN_PATH"),type:"text",width:"25%"},{name:"URI",description:localizedString("COLUMN_URI"),type:"text",width:"30%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"30%"}],bindings:{datasource:"masterDataSource"},commands:{onRowSelected:"masterRowSelected"},empty:{text:localizedString("RES_SHARED_FOLDER"),command:"registerCommand"},getCell:"masterGetCell"}},details:{title:"User Storage Details",tabs:[{title:"Configuration",toolbars:[],content:{type:"dataform",fields:[{id:"unc",text:localizedString("COLUMN_PATH"),binding:"UNC",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"uri",text:localizedString("COLUMN_URI"),binding:"URI",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}],bindings:{datasource:"selectedDataItem"},commands:{submit:"submitDetail"},getViewContent:"dataformGetViewContent"}}]}};window.respool=respool||{},respool.userstorage=function(){var t=MDModule.buildConstruct("usersstorage",e,function(){var e=this,t=localizedString("US_NAME");this.defineProperty("cannotRegister",!0),this.defineProperty("cannotUnregister",!0),this.defineCommand("registerCommand",function(){var t=new C3RegisterUserStorage("",e);t.show()}),this.defineCommand("onLoaded",function(){var t=c3.service.getUserStorages();t.query(function(t){e.selectedDataItem={},e.masterDataSource=t.data,e.masterDataSource.length===1?(e.cannotRegister=!0,e.cannotUnregister=!1):e.masterDataSource.length===0&&(e.cannotRegister=!1,e.cannotUnregister=!0),c3.service.getCachedSharedFolderMonitorStatus("","usersStorage",{success:function(t){if(t.d.results)for(var n=0;n<t.d.results.length;n++)for(var r=0;r<e.masterDataSource.length;r++)if(e.masterDataSource[r].ID==t.d.results[n].ID){e.masterDataSource[r].MonitorStatus=t.d.results[n].Status,e.masterDataSource[r].monitorStatusCode=t.d.results[n].StatusCode,e.masterDataSource[r].cachedMessageList=monitorUtil.buildMessageList(t.d.results[n].Messages.results);break}},error:function(t){monitorUtility.handleCommunicationError(e.masterDataSource)}})})}),this.defineCommand("deleteCommand",function(){if(e.selectedDataItem){var n=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),t));n.yesEvent.push(function(){var t={};t.success=function(t){e.onLoaded()},c3.service.deleteUserStorage(e.selectedDataItem,t)})}else window.alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),t))}),this.defineCommand("submitDetail",function(t){var n=new loadingWindow;e.loadingWin=n;var r={},i,s=t.data,o=t.callback;r.success=function(t){e.onLoaded(),o(!0),e.loadingWin.close()},r.error=function(){e.loadingWin.close()},s.UNC?(i=MessageBox.show({msg:localizedString("STORAGE_UPDATE_PATH_CONFIRM"),width:350,height:150,icon:MessageBoxIcon.WARNING,buttons:MessageBoxButton.YESNO}),i.yesEvent.push(function(){e.loadingWin.show(),c3.service.updateUserStorage(s,r)})):c3.service.updateUserStorage(s,r)}),this.defineCommand("masterGetCell",function(){var e=null,t={};this.col===0&&(t={},t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t));if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),monitorUtil.retrieveSharedFolderMonitorStatus(n,r,"usersStorage"),n.c3tip({messageList:r.cachedMessageList}),n}return e}),this.defineCommand("dataformGetViewContent",function(){if(this.colName==="Status"){var e=null,t={};return t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t),e}}),this.defineCommand("onInitNotification",function(){window.cometdManager.subscribe(sldEntitySet.UsersStorages,function(t){e.onLoaded()})})});return new t}}();var c3logicalmachines=function(){function enableControl(){self.btnExport.attr({disabled:0}),self.btnArchive.attr({disabled:0})}function disableControl(){self.btnExport.attr({disabled:1}),self.btnArchive.attr({disabled:1})}function createLogFile(e,t,n){var r=new c3exportAgentLogs(e,t,n);r.show()}function getMonitorStatus(e){c3.service.getSLDAgentMonitorStatus("",{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(n[i].AgentID==t.d.results[r].ID){n[i].MonitorStatus=t.d.results[r].Status,n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].monitorMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);break}bindTable(n)},error:function(t){var n=c3.service.convertData(e.data);bindTable(n)}})}function getLogicalMachineStatus(rst){var data=c3.service.convertData(rst.data);for(var j=0;j<data.length;j++)c3.service.getSLDAgentMachineStatus(data[j].ID,{success:function(result){var temp=result.d.GetSldAgentStatus,machineStatus=eval("("+temp+")");if(machineStatus.MachinesStatus.length)for(var i=0;i<data.length;i++)if(data[i].ID==machineStatus.MachinesStatus[0].MachineId){data[i].MonitorStatus=machineStatus.MachinesStatus[0].MachineStatus,data[i].SLDAgentStatus=machineStatus.MachinesStatus[0].SLDAgentStatus,data[i].SLDAgentStatus=="Available"&&(data[i].CPUUtili=parseFloat(machineStatus.MachinesStatus[0].CPUInfo.TotalUserTime).toFixed(2)+"%",data[i].MEMUtili=(parseFloat(machineStatus.MachinesStatus[0].MEMInfo.UsedMemoryInKB)/parseInt(machineStatus.MachinesStatus[0].MEMInfo.TotalMemoryInKB)*100).toFixed(2)+"%",data[i].OSVersion=machineStatus.MachinesStatus[0].OSInfo.OSName+"   "+machineStatus.MachinesStatus[0].OSInfo.OSVersion);break}bindTable(data)},error:function(e){var t=c3.service.convertData(rst.data);bindTable(t)}})}this.base=c3.module,this.base();var id="c3logicalmachines",container=$("<section>").attr({id:id}),title=localizedString("RESPOOL_LOGICALMACHINE_TLT"),exportTxt=localizedString("MISC_EXPORT"),archiveTxt=localizedString("MISC_ARCHIVE"),page=0,pageSize=5,self=this,selectedItem=null,selectedIndex=0,nestedUnits=[new c3logicalmachine_detail(this)];self.id=id,self.pageSize=1e3,self.totalCount=0,self.refreshPaging=!1,this._container=container,this._title=title,this.getTitle=function(){return localizedString("RESPOOL_LOGICALMACHINE_TLTS")};var createToolbar=function(){var e=$("<section>").attr({id:id+"_toolbar"}).addClass("tools"),t=$("<input>").attr({value:exportTxt,type:"button",id:id+"btnExport"}),n=$("<input>").attr({value:archiveTxt,type:"button",id:id+"btnArchive"}),r=$("<a>").attr({href:"#",id:"btnRefresh_"+id,title:"Refresh"}).addClass("refresh");r.click(function(){self.reload(),disableControl()}),t.click(function(){selectedItem!=null?(createLogFile(self,0,selectedItem),console.log(selectedItem)):console.log("No selectedItem!!!!")}),n.click(function(){selectedItem!=null?(createLogFile(self,1,selectedItem),console.log(selectedItem)):console.log("No selectedItem!!!!")}),self.btnExport=t,self.btnArchive=n;var i=new searchbox({inputCallback:function(e){return self.dataGrid.searchText(e)}});return disableControl(),e.append(t),e.append(n),e.append($("<div>").css({"float":"right"}).append(i.css({"float":"left"})).append(r)),e},onRowSelected=function(e){nestedUnits[0].onViewWillAppear(),nestedUnits[0].bindData(self.data[e]),selectedIndex=e,selectedItem=self.data[e],enableControl()},createTable=function(){var e=$("<section>").attr({id:id+"_masterDataGrid"}),t=null,n=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"SLDAgentStatus",description:localizedString("RES_SLD_AGENT_STATUS"),type:"text",width:"15%"},{name:"Hostname",description:localizedString("RESPOOL_LOGICALMACHINE_COLUMN_HOSTNAME"),type:"text",width:"20%"},{name:"CPUUtili",description:localizedString("RESPOOL_LOGICALMACHINE_COLUMN_CPUUTILI"),type:"text",width:"15%"},{name:"MEMUtili",description:localizedString("RESPOOL_LOGICALMACHINE_COLUMN_MEMUTILI"),type:"text",width:"15%"},{name:"OSVersion",description:localizedString("RESPOOL_LOGICALMACHINE_COLUMN_OSVERSION"),type:"text",width:"20%"}];self.data=[];var r={pagingMode:!0,pageSize:self.pageSize,autoResize:function(){return 540},getHeaderSpec:function(){return n},getRowCount:function(){return self.data.length},getRow:function(e){return self.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return selectedIndex},getCell:function(){var e=null;if(this.colName=="RunTask")this.data[this.colName]==1?e=$("<input>").attr({type:"checkbox",checked:!0,disabled:!0}):e=$("<input>").attr({type:"checkbox",checked:!1,disabled:!0});else if(this.colName=="MonitorStatus"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}else if(this.colName==="SLDAgentStatus"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e},getTotalCount:function(){return self.totalCount},loadPage:function(e,t){c3.service.retrieveWorkstations().orderby("ID desc").skip(e).top(t).query({success:function(e){self.data.clear();for(var t=0;t<e.data.length;t++)self.data.push(e.data[t]);self.data=c3.service.convertData(self.data),onRowSelected(selectedIndex),self.dataGrid.refreshContent()},error:function(e){self.loadingWindow.close()}})}};return self.gridDelegate=r,t=$(e).gridview({delegate:r}),t.rowSelectedEvent.push(function(){selectedIndex!=this.index&&onRowSelected(this.index)}),self.dataGrid=t,e},bindTable=function(e){self.data=e,self.data.length==0&&(self.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RESPOOL_SLDAGENT_TLT"),null,!0)}),self.dataGrid.reload(),self.data.length>0&&selectedIndex!=-1?onRowSelected(selectedIndex):nestedUnits[0].bindData({})};self.countHandler={success:function(e){self.totalCount=parseInt(e.data.length,10)},error:function(e){}};var reload=function(){self.refreshPaging=!0;var e=c3.service.getLogicalMachines();e.count().query(self.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(self.pageSize).skip(page*self.pageSize)),e.query(getLogicalMachineStatus)};this.reload=reload,this.onInit=function(){container.append($("<div>").attr("class","title_panel").append(self.getTitle())),container.append(createToolbar()),container.append(createTable());for(var e=0;e<nestedUnits.length;e++)container.append(nestedUnits[e].getContainer());nestedUnits[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-SLDAgent",reload)),reload()},this.onViewAppear=function(){self.dataGrid.show()},this.filterResults=function(e){var t=c3.service.retrieveWorkstations();Utility.SplitPage||(t=t.top(pageSize).skip(page*pageSize)),t.query(function(t){var n=c3.service.convertData(t.data),r=n[selectedIndex];if(r&&r.Commands&&r.Commands.length>0){if(e=="inprocess")for(var i=0;i<r.Commands.length;i++)r.Commands[i].Status!="Processing"&&r.Commands.remove(i--);else if(e=="history")for(var i=0;i<r.Commands.length;i++)r.Commands[i].Status=="Processing"&&r.Commands.remove(i--);nestedUnits[0].onViewWillAppear(),nestedUnits[0].bindData(r)}else nestedUnits[0].onViewWillAppear(),nestedUnits[0].bindData({Commonds:[]})})}},c3logicalmachine_detail=function(){this.base=c3.module,this.base();var e="c3logicalmachine_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RESPOOL_SLDAGENT_TLT"),localizedString("RES_DETAILS")),r=[localizedString("RESPOOL_SLDAGENT_TASKS")],i=this,s=localizedString("RESPOOL_SLDAGENT_TLT"),o=arguments[0]||{},u=[];this._container=t;var a=function(){var e="sldagent_toolbar",t=$("<section>").attr({id:e}).addClass("tools"),n=$("<select>").css({"float":"right",width:"150px"});return n.append($("<option>").attr({title:localizedString("RESPOOL_SLDAGENT_SELECT_ALL")}).val("all").append(localizedString("RESPOOL_SLDAGENT_SELECT_ALL"))),n.append($("<option>").attr({title:localizedString("RESPOOL_SLDAGENT_SELECT_PROCESSING")}).val("inprocess").append(localizedString("RESPOOL_SLDAGENT_SELECT_PROCESSING"))),n.append($("<option>").attr({title:localizedString("RESPOOL_SLDAGENT_SELECT_HISTORY")}).val("history").append(localizedString("RESPOOL_SLDAGENT_SELECT_HISTORY"))),i.select=n,n.change(function(){o.filterResults(i.select.val())}),t.append(n),t},f=function(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t},l=function(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+":");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(c()),t};this.onInit=function(){},this.bindData=function(e){i.data=e.Commands};var c=function(){var t=e+"_tasks",n=$("<section>").attr({id:t}),r=$("<section>").attr({id:t+"_grid"}),s=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"9%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"15%"},{name:"Percentage",description:localizedString("RESPOOL_SLDAGENT_COLUMN_PERCENTAGE"),type:"text",width:"15%"},{name:"Command",description:localizedString("RESPOOL_SLDAGENT_COLUMN_COMMAND"),type:"text",width:"35%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"25%"}],o={getHeaderSpec:function(){return s},getRowCount:function(){return i.data.length},getRow:function(e){return i.data[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return 0},getTip:function(){return Utility.CreateTipBoard("task",null,!0)},getCell:function(){if(this.colName=="Percentage"){var e=this.data[this.colName],t=$("<div>"),n=this.data.Status,r=t.c3progressWithStatus(function(e,t){return function(){t=="Failed"?r.setFailed(""):t=="Successful"?r.setValue(100,"100%"):r.setValue(e,e+"%")}}(e,n),{max:100,dur:c3config.Clocker-2,async:1,width:100,hwf:!0,showError:!0});return r.start(),t}return null}},f=$(r).gridview({delegate:o});return f.show(),f.rowSelectedEvent.push(function(){}),i.TaskDataGrid=f,i.data=u,n.append(a()),n.append(r),n}},respool=respool||{};respool.browserAccessServers=function(){function l(){o.refreshPaging=!0;var e=c3.service.getBrowserAccessServers().expand("Machine,ServiceUnit,SBOClient"),t;e.count().query(o.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(o.pageSize).skip(i*o.pageSize)),e.query(c)}function c(e){c3.service.retrieveWorkstations().query(function(t){if(t.data&&t.data.length>0)for(var n=0;n<t.data.length>0;n++)for(var r=0;r<e.data.length;r++)if(t.data[n].Hostname==e.data[r].Machine.Hostname){e.data[r].SLDAgentStatus=t.data[n].Status;continue}h(e)})}function h(e){c3.service.getCachedBrowserAccessServerMonitorStatus("",{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(n[i].ID==t.d.results[r].ID){n[i].MonitorStatus=t.d.results[r].Status,n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].cachedMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);break}m(n)},error:function(t){var n=c3.service.convertData(e.data);m(n)}})}function p(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),i=$("<input>").attr({value:r,type:"button",id:e+"btnUnRegister"}),s=$("<input>").attr({value:localizedString("BTN_SYCNALLBROWSERSERVERS_TEXT"),type:"button",id:e+"btnSyncVersion"}),a=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),f=localizedString("RESPOOL_B1BROWSERACCESSSERVER_LOWCASE");o.btnDelete=i,y(),s.click(function(){o.loadingWin.show(),c3.service.refreshBAServers(function(e){o.loadingWin.close(),o.reload();if(e.d&&e.d.results&&e.d.results.length>0){var t=new c3syncException(o,e.d.results);t.show()}})}),i.click(function(){u!=null?c3.service.getBrowserAccessServers(u.Id).expand("ServiceUnit").query(function(e){var t=null;e.data.HostingUnit?t=MessageBox.confirm(String.format(localizedString("RES_BA_UNREGIST_CONFIRM_USED"),f)):t=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),f)),t.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload())},c3.service.deleteBrowserAccessServer(u,e)})}):alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),f))}),a.click(function(){o.reload()}),t.append($("<input>").attr({value:n,type:"button",id:e+"btnRegister"}).click(function(){d(o)}));var l=new searchbox({inputCallback:function(e){return o.dataGrid.searchText(e)}});return t.append(s),t.append($("<span>").addClass("split")),t.append(i),t.append($("<div>").css({"float":"right"}).append(l.css({"float":"left"})).append(a)),t}function d(e){var t=new c3registerBAServer(e);t.show()}function v(){var n=$("<section>").attr({id:e+"_masterDataGrid"}),r=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"14%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"10%"},{name:"Machine_Hostname",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"10%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"14%"},{name:"SLDAgentStatus",description:localizedString("RES_SLD_AGENT_STATUS"),type:"text",width:"8%"},{name:"SBOClient_Version",description:localizedString("RESPOOL_BAS_COLUMN_BASVR"),type:"text",width:"14%"},{name:"SBOClient_ServerType",description:localizedString("RESPOOL_BAS_COLUMN_SLDCLIENTDBTYPE"),type:"text",width:"14%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"15%"}];o.data=[];var i={pagingMode:!0,pageSize:o.pageSize,autoResize:function(){return 550},getHeaderSpec:function(){return r},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return a},getCell:function(){var e=null,n,r={},i=this.data.Machine_Hostname;if(this.colName=="Status"||this.colName=="LifeCycleStatus")r.text=this.data[this.colName],this.colName=="LifeCycleStatus"?r.showText=!0:r.textalign="center",e=new statusControl(r);else if(this.colName==="SLDAgentStatus")r.text=this.data[this.colName],r.textalign="center",e=new statusControl(r);else{if(this.colName=="Result"){var u=this.data,a=this.index,f=this.data.Machine_ID,l=$("<div>");return c3.service.getTasks().filter("TaskType eq 'DeployBASClient' and (Status eq 'Processing' or Status eq 'Pending') and ResourceID eq "+f).expand("TaskParameters").query(function(e){if(e.data&&e.data.length>0){var n=e.data[0].ID,r=[];r.push(function(e){var r=e.c3progressWithStatus(function(e){return function(){return s(r,e,t)}}(n),{max:100,dur:c3config.Clocker-2,async:1,width:60,width:60,swf:!0,hwf:!0});return r}(l));for(var i=0,u=r.length;i<u;i++)0==i&&r[i].start(),i<u-1?r[i].finishEvent.push(function(e){return function(t){e.start()}}(r[i+1])):r[i].finishEvent.push(function(e){return function(e){o.reload()}}(r[i]))}}),l}if(this.colName=="MonitorStatus"){var r={};r.textalign="center";var c=$("<label>"),h=this.data;return monitorUtil.statusPreparation(r,h.MonitorStatus,h),c=new statusControl(r),monitorUtil.retrieveBrowserAccessServerMonitorStatus(c,h),c.c3tip({messageList:h.cachedMessageList}),c}}return e},getTotalCount:function(){return o.totalCount},loadPage:function(e,t){c3.service.getBrowserAccessServers().expand("Machine,ServiceUnit,SBOClient").orderby("ID desc").skip(e).top(t).query({success:function(e){o.data.clear();for(var t=0;t<e.data.length;t++)o.data.push(e.data[t]);o.data=c3.service.convertData(o.data),b(a),o.dataGrid.refreshContent()},error:function(e){o.loadingWindow.close()}})}},s=function(e,t,n){c3.service.getTaskProgress(t).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase().toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(t).expand("TaskParameters").query(function(t){e.setFailed(t.data.ResultDescription),Utility.logTaskError(t.data)}):"SUCCESSFUL"==i[0].toUpperCase()?(e.setValue(100,localizedString("MISC_DONE")),n.data.errorLabel!=null&&n.data.errorLabel.text(0)):(i[0]!="Pending"&&i[0]!="Done"?i[0]=localizedString("MISC_TASK_PROCESSING"):i[0]=="Pending"&&(i[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),e.setValue(parseInt(i[1]),i[0]))})};o.gridDelegate=i;var u=$(n).gridview({delegate:i});return u.rowSelectedEvent.push(function(){a!=this.index&&b(this.index),g()}),o.dataGrid=u,n}function m(e){o.data=e,o.data.length>0&&(a==-1?y():g()),o.dataGrid.reload(),o.data.length>0&&a!=-1?b(a):f[0].bindData({})}function g(){o.btnDelete.attr({disabled:0})}function y(){o.btnDelete.attr({disabled:1})}function b(e){a=e,u=o.data[e],f[0].onViewWillAppear(),f[0].bindData(o.data[e])}this.base=c3.module,this.base();var e="browserAccessServers",t=$("<section>").attr({id:e}),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=0,s=5,o=this,u=null,a=0,f=[new respool.browserAccessServers_detail(this)];o.id=e,o.pageSize=10,o.totalCount=0,o.refreshPaging=!1,this._container=t,this.getTitle=function(){return localizedString("RESPOOL_B1BROWSERACCESSSERVER_TLTS")},this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(o.getTitle())),t.append(p()),t.append(v());for(var e=0;e<f.length;e++)t.append(f[e].getContainer());f[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-PresentationServer",l));var n=new loadingWindow;o.loadingWin=n,l()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.B1WebServers,function(e){if(e.data.operation==="UpdateResource"){if(e.data.data)for(var t=0;t<e.data.data.length;t++)if(e.data.data[t].propertyNewValue!=e.data.data[t].propertyOldValue){o.reload();break}}else o.reload()})},this.getSelectedItem=function(){return u},this.onViewAppear=function(){o.dataGrid.show()},this.reload=l,o.countHandler={success:function(e){o.totalCount=parseInt(e.data,10)},error:function(e){}}},respool.browserAccessServers_detail=function(){function loadServiceUnit(){var e=parent.getSelectedItem();e&&e.ServiceUnit_ID&&e.ServiceUnit_ID>0?e.ServiceUnit_ID>0&&c3.service.getHostingUnits(e.ServiceUnit_ID).expand("Tenants").query(function(e){bindHUGrid(e)}):(self.huData=[],self.usedByHUsDataGrid.reload(),self.subTitle.html(localizedString("RES_HU_NUM")+": "+0))}function bindHUGrid(e){e.data=[e.data];for(var t=0;t<e.data.length;t++)e.data[t].CustomerNumber=e.data[t].Tenants.results.length;self.huData=e.data,self.usedByHUsDataGrid.reload(),self.subTitle.html(localizedString("RES_HU_NUM")+": "+self.huData.length)}function createTabHead(){var e=$("<ul>").attr({id:id+"_tab_header"}).addClass("detail_tab_header");for(var t=0;t<tabHeadTxt.length;t++){var n=$("<a>").attr({href:"#"}).append(tabHeadTxt[t]);e.append($("<li>").attr({id:id+t.toString()}).append(n))}return e}function createTabBody(){var e=$("<section>").attr({id:id+"_tab_body"}).addClass("tab_body");self.title=$("<h3>").attr({id:id+"_title"}),self.subTitle=$("<h4>").attr({id:id+"_sub_title"}),self.title.html(title_prefix+":");var t=$("<hgroup>").append(self.title).append(self.subTitle);return e.append(t),self.hgroup=t,e.append(createConfigPanel()),e.append(respoolCommon.createHUPanel(self)),e}function createConfigPanel(){var subId=id+"_config",panel=$("<section>").attr({id:subId}),toolbarItemList=[{id:"testConnection",text:localizedString("MISC_TEST_CONNECTION"),type:"button",handler:function(){alert("Not Implement")}}],columnList=[];self.statusData=[],self.typeData=[],self.lifeCycleStatusData=[];var group=[{id:"name",text:localizedString("COLUMN_MSSQL_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:self.statusData}},{id:"ServiceUnit_Name",text:localizedString("COLUMN_HOSTNAME"),binding:"Machine_Hostname",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"SBOClientVersion",text:localizedString("RESPOOL_PS_COLUMN_SLDCLIENTVR"),binding:"Version",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0},{id:"AccessURL",text:localizedString("COLUMN_ACCESSURL"),binding:"AccessURL",type:"text",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0},{id:"maxProcessSize",text:localizedString("COLUMN_MAXPROCESSSIZE"),binding:"MetaDataMax",type:"text",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0},{id:"processPoolSize",text:localizedString("COLUMN_PROCESSPOOLSIZE"),binding:"MetaDataPool",type:"text",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}];columnList.push(group);var dataFormDelegate={getColumns:function(){return columnList},getViewContent:function(){var retVal=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var options={};options.text=this.data[this.colName],options.showText=!0,retVal=new statusControl(options)}else{if(this.colName=="MetaDataMax"){if(this.data["MetaData"]!=null){var metaDataTxt=base64Decode(this.data.MetaData),dataObj=eval("("+metaDataTxt+")"),maxProcessSize=dataObj.servers[0].properties[4].value;return $("<input>").attr({type:"text",readOnly:!0,value:maxProcessSize})}return null}if(this.colName=="MetaDataPool"){if(this.data["MetaData"]!=null){var metaDataTxt=base64Decode(this.data.MetaData),dataObj=eval("("+metaDataTxt+")"),maxIdleSize=dataObj.servers[0].properties[3].value;return $("<input>").attr({type:"text",readOnly:!0,value:maxIdleSize})}return null}}return retVal}},dataform=$(panel).dataform({delegate:dataFormDelegate});self.dataform=dataform;var toolbar=self.dataform.getToolbar(),toolbarContianer=toolbar.edit.parent(".tools");return panel}function listenTask(e,t){function n(){if(isNaN(parseInt(t)))return;if(t<=0)return;c3.service.getTaskProgress(e).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase().toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(e).expand("TaskParameters").query(function(e){Utility.logTaskError(e.data)}):(t--,setTimeout(n,5e3))})}n()}this.base=c3.module,this.base();var id="respool_browserAccessServers_detail",container=$("<section>").attr({id:id}).addClass("tab"),title=String.format("{0} {1}",localizedString("RESPOOL_B1BROWSERACCESSSERVER_TLT"),localizedString("RES_DETAILS")),tabHeadTxt=[localizedString("MISC_CONFIGURATION"),localizedString("RES_USED_BY_HU")],self=this,title_prefix=localizedString("RESPOOL_B1BROWSERACCESSSERVER_TLT"),huPage=0,huPageSize=5,parent=arguments[0]||{};this._container=container,this.onInit=function(){container.append($("<h1>").append(title)),container.append(createTabHead()),container.append(createTabBody());var e=$("#"+id+">.detail_tab_header a").c3tab("#"+id+">.tab_body>section",{});e.onSelectEvent.push(function(e,t){e==0?self.hgroup.css({display:"none"}):(self.hgroup.css({display:""}),e==1?self.subTitle.css({display:""}):self.subTitle.css({display:"none"}))}),e.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ServiceUnits,function(e){loadServiceUnit()})},this.bindData=function(data){data&&self.title.text(title_prefix+": "+parse(data.Machine_Hostname)),self.dataform.submit=function(dataSource,callback){var options={};options.success=function(e){parent.reload(),callback(!0)};var metaDataTxt=null;if(data["MetaData"]!=null){metaDataTxt=base64Decode(data.MetaData);var dataObj=eval("("+metaDataTxt+")");dataObj.servers[0].properties[4].value=document.getElementById("maxProcessSize").value,dataObj.servers[0].properties[3].value=document.getElementById("processPoolSize").value;var datatxt=JSON.stringify(dataObj),metaData=base64Encode(datatxt);dataSource.MetaData=metaData}var errorFields="",FieldPattern=/^\+?[1-9][0-9]*$/;FieldPattern.test($(maxProcessSize).val())?!FieldPattern.test($(processPoolSize).val())||Number($(processPoolSize).val())>Number($(maxProcessSize).val())?errorFields=localizedString("COLUMN_PROCESSPOOLSIZE"):errorFields="":errorFields=localizedString("COLUMN_MAXPROCESSSIZE");if(errorFields!==""){var messOpt={title:"MSGBOX_ERROR",icon:MessageBoxIcon.ERROR,msg:String.format(localizedString("RESPOOL_VALIDITY_PATTERNMISMATCH"),errorFields)},result=MessageBox.prompt(messOpt);result.closeEvent.push(function(){var e={};e.success=function(e){self.reload()}});return}log.warning("APPLICATION",localizedString("BROWSERACCESS_WARNING_EDIT"),null),c3.service.updateBrowserAccessServer(dataSource,options)},self.dataform.setDataSource(data),self.dataform.dataBind(),self.dataform.changeMode(0),c3.service.getBrowserAccessServerStatus(function(e){self.statusData.clear();for(var t=0;t<e.data.length;t++)self.statusData.push({text:e.data[t],value:e.data[t]})}),self.lifeCycleStatusData.clear(),c3.service.getBrowserAccessServerLifeCycleStatus(function(e){for(var t=0;t<e.data.length;t++)self.lifeCycleStatusData.push({text:e.data[t],value:e.data[t]})}),loadServiceUnit()}},function(){c3host.detail=function(){function createTabHead(){var e=$("<ul>").addClass("detail_tab_header");for(var t=0;t<tabHeadTxt.length;t++){var n=$("<a>").attr({href:"#"}).append(tabHeadTxt[t]);e.append($("<li>").append(n))}return e}function createTabBody(){var e=$("<section>").addClass("detail_tab_body");self.title=$("<h3>"),self.subTitle=$("<h4>");var t=$("<hgroup>").append(self.title).append(self.subTitle);return e.append(createConfigPanel()),e.append(createComponentPanel()),e.append(createStoragePanel()),e.append(createTenantPanel()),e.append(createMonitorPanel()),e.append(createExtensionPanel()),e.append(createUpgradeSimulationPanel()),e}function createMonitorPanel(){var e=$("<section>").attr({id:"monitor"}),t=$("<section>").attr({id:"monitorContent"}),n=$("<div>").addClass("tools"),r=$("<div>").addClass("lbl_error_icon"),i=$("<div>").addClass("lbl_inf_not_ava_icon"),s=$("<div>").addClass("lbl_warning_icon"),o=$("<div>").addClass("lbl_unknown_icon"),u=$("<div>").addClass("lbl_not_reach_icon");self.not_ava_title=$("<label>").append(constructStatusText(localizedString("MONITOR_STATUS_NOT_AVAILABLE_TITLE"),0)),self.inf_not_ava_title=$("<label>").append(constructStatusText(localizedString("MONITOR_STATUS_INF_NOT_REACH_TITLE"),0)),self.not_reach_title=$("<label>").append(constructStatusText(localizedString("MONITOR_STATUS_NOT_REACH_TITLE"),0)),self.warning_title=$("<label>").append(constructStatusText(localizedString("MONITOR_STATUS_WARNING_TITLE"),0)),self.unknown_title=$("<label>").append(constructStatusText(localizedString("MONITOR_STATUS_UNKNOWN_TITLE"),0));var a=$("<div>").append(r).append(self.not_ava_title).addClass("monitorStatusIconBlock"),f=$("<div>").append(i).append(self.inf_not_ava_title).addClass("monitorStatusIconBlock"),l=$("<div>").append(s).append(self.warning_title).addClass("monitorStatusIconBlock"),c=$("<div>").append(u).append(self.not_reach_title).addClass("monitorStatusIconBlock"),h=$("<div>").append(o).append(self.unknown_title).addClass("monitorStatusIconBlock");n.append(l),n.append(a),n.append(c),n.append(f),n.append(h),t.append(n);var p=$("<section>"),d=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Component",description:localizedString("COLUMN_COMPONET_TYPE"),type:"text",width:"30%"},{name:"message",description:localizedString("COLUMN_MONITOR_MESSAGE"),type:"text",width:"55%"}];self.monitorDetailData=[];var v={getHeaderSpec:function(){return d},getRowCount:function(){return self.monitorDetailData.length},getRow:function(e){return self.monitorDetailData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(){if(this.colName==="MonitorStatus"){var e={};e.textalign="center";var t=$("<div>").addClass("statusControl").css({"text-align":"center"}),n=this.data,r=[],i=monitorUtil.getStatusClass(n.monitorStatusCode),s;n.monitorStatusCode===monitorUtil.unknown&&n.message.length==0?s=localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE"):s=n.message,r.push({statusClass:i,message:s}),monitorUtil.statusPreparation(e,n.monitorStatus,n);var o=(new statusControl(e)).children("label");return t.append(o),t.c3tip({messageList:r}),t}return this.colName==="Component"?this.data.Component:this.data.message},getTip:function(){return Utility.CreateTipBoard(localizedString("MONITOR_NO_MESSAGE"),null,!0)}},m=$(p).gridview({delegate:v});return t.append(p),m.show(),self.monitorGrid=m,e.append(t),e}function constructStatusText(e,t){return e+"("+t+")"}function createConfigPanel(){var e=$("<section>").attr({id:"huConfig"}),t=[];self.statusData=[],self.purposesData=[];var n=[{id:"id",text:localizedString("SU_EXT_COLUMN_ID"),binding:"ID",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"name",text:localizedString("HU_GD_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!0},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:self.statusData}},{id:"version",text:localizedString("COLUMN_VERSION"),binding:"Version",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"purpose",text:localizedString("COLUMN_PURPOSE"),binding:"Purpose",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:self.purposesData}},{id:"creationDate",text:localizedString("COLUMN_CREATE_DATE"),binding:"CreationDate",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:2,controlClass:"value",editable:!0},{id:"domainGroup",text:localizedString("COLUMN_DOMAIN_GROUP"),binding:"Group_DomainGroup",type:"label",readonly:!0,"class":"chrome2",editable:!1}];t.push(n),c3.service.getGlobalSettings("Global.DomainGroups.Management").query(function(e){e.data&&e.data.length>0&&(e.data[0].Value!="Off"?self.btnGenerateDomainGroups.attr("disabled",!1):self.btnGenerateDomainGroups.attr("disabled",!0))}),self.toolbarItemList.push({id:"btnGenerateDomainGroups",text:localizedString("SU_GENERATE_DOMAIN_GROUPS"),type:"button",render:function(){var e=$("<div>").css({display:"inline"}),t=$("<input>").attr({type:"button",value:localizedString("SU_GENERATE_DOMAIN_GROUPS"),disabled:!0});return self.btnGenerateDomainGroups=t,t.click(function(){var e=new loadingWindow;e.show(),c3.service.generateDomainGroups(self.host.ID,function(){e.close()})}),e.append(t),self.btnGenerateDomainGroups=t,e}});var r={getToolbarItems:function(){return self.toolbarItemList},getColumns:function(){return t},getAllowEdit:function(){return permissionItems.operator===c3.userRole.roleId},getViewContent:function(){var e=null;if(this.colName=="Status"||this.colName=="Mode"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}if(this.colName=="CreationDate"&&this.data[this.colName]){var n=convertToDate(this.data[this.colName]).timeString();e=$("<label>").append(n).attr({title:n})}return e}},i=$(e).dataform({delegate:r});return self.dataform=i,e}function createComponentPanel(){var e=$("<section>").attr({id:"huComponet"}),t=new createCoreComponents;return e.append(t),e}function createStoragePanel(){var e=$("<section>").attr({id:"huStorage"}),t=new createStorage;return e.append(t),e}function createUpgradeSimulationPanel(){var e=$("<section>").attr({id:"huUpgradeSimulation"}),t=new createUpgradeSimulations;return e.append(t),e}function createUpgradeSimulations(){var e=function(e){var t="";switch(e){case"":t=localizedString("UPGRADE_SIMULATION_RESULT_NOT_EXECUTED");break;case"Pending":t=localizedString("UPGRADE_SIMULATION_RESULT_PENDING");break;case"Processing":t=localizedString("UPGRADE_SIMULATION_RESULT_PROCESSING");break;case"Successful":t=localizedString("UPGRADE_SIMULATION_RESULT_SUCCESSFUL");break;case"Cancelled":t=localizedString("UPGRADE_SIMULATION_RESULT_CANCELLED");break;case"Failed":t=localizedString("UPGRADE_SIMULATION_RESULT_FAILED");break;case"Paused":t=localizedString("UPGRADE_SIMULATION_RESULT_PAUSED");break;case"Committing":t=localizedString("UPGRADE_SIMULATION_RESULT_COMMITTING");break;case"Rejected":t=localizedString("UPGRADE_SIMULATION_RESULT_REJECTED");break;case"Rollback":t=localizedString("UPGRADE_SIMULATION_RESULT_ROLLBACK");break;case"WaitingForApproval":t=localizedString("UPGRADE_SIMULATION_RESULT_WAITING_FOR_APPROVAL");break;case"WaitingForWorkstation":t=localizedString("UPGRADE_SIMULATION_RESULT_WAITING_FOR_WORKSTATION");break;default:t=localizedString("UPGRADE_SIMULATION_RESULT_UNKNOWN")}return t},t=id+"_upgSimul",n=$("<section>").attr({id:t}),r=$("<div>").addClass("tools"),i=$("<a>").attr({href:"#",id:"btnRefresh_"+t,title:localizedString("MISC_REFRESH")}).addClass("refresh");i.click(function(){self.reloadUpgradeSimulations()}),r.append($("<div>").css({"float":"right"}).append(i)),n.append(r);var s=[{name:"CompanyName",description:localizedString("COLUMN_UPG_SIMUL_TENANT_NAME"),type:"text",width:"10%"},{name:"CompanyDBName",description:localizedString("COLUMN_UPG_SIMUL_TENANT_DB_NAME"),type:"text",width:"10%"},{name:"SourceVersion",description:localizedString("COLUMN_UPG_SIMUL_SOURCE_VERSION"),type:"text",width:"8%"},{name:"TargetVersion",description:localizedString("COLUMN_UPG_SIMUL_TARGET_VERSION"),type:"text",width:"8%"},{name:"StartTime",description:localizedString("COLUMN_UPG_SIMUL_START_DATE_TIME"),type:"text",width:"10%"},{name:"EndTime",description:localizedString("COLUMN_UPG_SIMUL_END_DATE_TIME"),type:"text",width:"10%"},{name:"Duration",description:localizedString("COLUMN_UPG_SIMUL_DURATION"),type:"text",width:"6%"},{name:"Status",description:localizedString("COLUMN_UPG_SIMUL_RESULT"),type:"text",width:"8%"},{name:"FailedTaskDescription",description:localizedString("COLUMN_UPG_SIMUL_DESCRIPTION"),type:"text",width:"18%"},{name:"LogFolder",description:localizedString("COLUMN_UPG_SIMUL_LOGS"),type:"text"}];self.dataUpgSimul=[];var o={getHeaderSpec:function(){return s},getRowCount:function(){return self.dataUpgSimul.length},getRow:function(e){return self.dataUpgSimul[e]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(t){var n=this.data;if(this.colName=="StartTime")return n.StartTime?convertToDate(n.StartTime).timeString():"";if(this.colName=="EndTime")return n.EndTime?convertToDate(n.EndTime).timeString():"";if(this.colName=="Duration")return n.Duration&&n.Duration!="0"?formatMillisecondsAsDuration(n.Duration):"";if(this.colName=="Status")return n.Status?e(n.Status):e("");if(this.colName=="FailedTaskDescription")return n.FailedTaskDescription?localizedString("UPGRADE_SIMULATION_DESCRIPTION_FAILED_TASK")+n.FailedTaskDescription:"";if(this.colName=="LogFolder"){if(n.FailedTaskDescription){this.cell.css({"text-align":"center"});var r=$("<a>").attr({href:"file:///"+n.LogFolder});r.click(function(){var e=$("<section>"),t=$("<div>");t.html(localizedString("UPGRADE_SIMULATION_MSG_WINDOW_LOGS")+"<br/><br/>"+n.LogFolder),e.append(t);var r=MessageBox.show({msg:e,width:560,icon:MessageBoxIcon.INFORMATION,buttons:MessageBoxButton.CLOSE})});var i=$("<img>").attr({src:c3Icon.Log});return r.append(i),r}return""}}},u=$("<section>"),a=$(u).gridview({delegate:o});return a.show(),self.gridUpgSimul=a,n.append(u),n}function createExtensionPanel(){if(!c3.hasPermission([permissionItems.operator]))return $(undefined);var e=$("<section>").attr({id:"huExtensions"}),t=new createExtensions;return e.append(t),e}function createExtensions(){var e=id+"_ext",t=$("<section>").attr({id:e}),n=$("<div>").addClass("tools"),r=(new Button({value:localizedString("MISC_DEPLOY"),permissions:[permissionItems.operator]})).dom,i=(new Button({value:localizedString("MISC_UNDEPLOY"),permissions:[permissionItems.operator]})).dom,s=(new Split({permissions:[permissionItems.operator]})).dom,o=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:localizedString("MISC_REFRESH")}).addClass("refresh");i.attr({disabled:1}),o.click(function(){self.reload()}),r.click(function(){var e=new c3extensionInstall(self,self.extData);e.show()}),i.click(function(){if(selectedExtension!=null){var e=340,t=150,n=MessageBox.confirm({msg:String.format(localizedString("RES_MISC_EXTENSION_DELETE_CONFIRM"),localizedString("EXTENSION")),width:e,height:t});n.yesEvent.push(function(){var e={};e.success=function(e){self.reload(),selectedIndex=-1,i.attr({disabled:1})},c3.service.deleteExtensionDeployments(selectedExtension,e)})}}),r.attr({disabled:1}),i.attr({disable:1}),self.btnAddAddon=r,self.btnRemoveAddon=i,n.append(r),n.append(s),n.append(i),n.append($("<div>").css({"float":"right"}).append(o)),t.append(n);var u=$("<section>"),a=[{name:"Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"13%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"8%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"8%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"8%"},{name:"Tenant",description:localizedString("COLUMN_USED_BY_TENANT"),type:"text",width:"10%"},{name:"StatusInPresent",description:localizedString("HUEXTENSION_STATUSINPRESENT"),type:"text",width:"13%"},{name:"Deployment",description:localizedString("HUEXTENSION_VIEWDEPLOY"),type:"text",width:"15%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"25%"}];self.extData=[];var f={getHeaderSpec:function(){return a},getRowCount:function(){return self.extData.length},getRow:function(e){return self.extData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(e){if(this.colName=="Deployment"){var t=this.data;if(t.Properties!=null&&t.Properties.length>0){var n=$("<div>"),r=lkb=$("<a>").text(localizedString("LINK_DETAILS")).attr({href:"#",title:localizedString("LINK_DETAILS")});return r.click(function(){var e=new c3editextensionDepProperty(t);e.show()}),n.append(r),n}}if(this.colName=="StatusInPresent"){var i=this.data;i.Status=="Failed"&&(i.Status="InstallationFailed");var n=$("<div>"),s=$("<label>").html(convertToDisplayStatus(i.Status)+"&nbsp;&nbsp;");return lkb=$("<a>").text(localizedString("LINK_DETAILS")).attr({href:"#",title:localizedString("LINK_DETAILS")}),lkb.click(function(){i.commonDatabaseId=self.host.CommonDatabase.ID;var e=new c3extensionInstallationStatus(i,self);e.show()}),n.append(s).append(lkb),n}if(this.colName=="Result"){var n=$("<div>"),o=this.data,u=[];o.TaskID&&o.TaskID>0&&u.push(function(e){var t=e.c3progressWithStatus(function(e){return function(){return getExtProgress(t,e,container)}}(o.TaskID),{max:100,dur:c3config.Clocker-2,async:1,width:100,hwf:!0,showError:!0});return t}(n));for(var a=0,f=u.length;a<f;a++)0==a&&u[a].start(),a<f-1&&u[a].finishEvent.push(function(e){return function(t){e.start()}}(u[a+1]));return n}}},l=$(u).gridview({delegate:f});return l.show(),l.rowSelectedEvent.push(function(){selectedExtension=this.data;if(self.selectedItem&&self.selectedItem.Purpose=="Staging"){i.attr({disabled:1});return}selectedExtension.ID?selectedExtension.Name!="XLReporter"&&selectedExtension.Name!="SBOScript"||selectedExtension.Vendor!="SAP"?i.attr({disabled:0}):i.attr({disabled:1}):i.attr({disabled:1})}),self.extGrid=l,t.append(u),t}function unRegPresentation(){var e={};e.success=function(e){self.reload(),self.btnUnregSW.attr({disabled:1})};var t={ID:selectedComponent.ID,ServiceUnit:null};c3.service.updatePresentationServer(t,e)}function unRegBAServer(){var e={};e.success=function(e){self.reload(),self.btnUnregSW.attr({disabled:1})};var t={ID:selectedComponent.ID,ServiceUnit:null};c3.service.updateBrowserAccessServer(t,e)}function createCoreComponents(){var e=$("<section>").attr({id:"core"}),t=$("<div>").addClass("tools"),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=(new Button({value:n,permissions:[permissionItems.operator]})).dom,s=(new Button({value:r,permissions:[permissionItems.operator]})).dom,o=(new Split({permissions:[permissionItems.operator]})).dom,u=$("<a>").attr({href:"#",id:"btnRefresh_"+id,title:localizedString("MISC_REFRESH")}).addClass("refresh").css("float","right");u.click(function(){self.reloadComponent()}),t.append(i),t.append(o),t.append(s),t.append(u),e.append(t),i.click(function(){var e=new registerSWComponent(self);e.show()}),i.attr({disabled:1}),s.attr({disabled:1}),self.btnRegSW=i,self.btnUnregSW=s,s.click(function(){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),localizedString("HU_SOFTWARE_COMPONENT")));e.yesEvent.push(function(){var e={};e.success=function(e){self.reload(),s.attr({disabled:1})};var t={};switch(selectedComponent.Type){case"PresentationServer":self.l1=new loadingWindow,self.l1.show(),c3.service.retrieveSBOClients(selectedComponent.MachineID,function(e){var t=null;e.d&&e.d.results&&e.d.results.length>0&&(t=e.d.results[0].ID);if(t==null){self.unRegPresentation(),self.l1.close();return}c3.service.retrieveSBOClientSessions(t,function(e){if(e.d&&e.d.results&&e.d.results.length>0){var t=new c3unregisterPSWarning(self,e.d.results,unRegPresentation,!1);t.show()}else self.unRegPresentation();self.l1.close()})});break;case"B1WebServer":self.l1=new loadingWindow,self.l1.show(),c3.service.retrieveSBOClients(selectedComponent.MachineID,function(e){var t=null;e.d&&e.d.results&&e.d.results.length>0&&(t=e.d.results[0].ID);if(t==null){self.unRegBAServer(),self.l1.close();return}c3.service.retrieveSBOClientSessions(t,function(e){if(e.d&&e.d.results&&e.d.results.length>0){var t=new c3unregisterPSWarning(self,e.d.results,unRegBAServer,!0);t.show()}else self.unRegBAServer();self.l1.close()})});break;case"IntegrationComponent":t={ID:self.host.ID,IntegrationComponent:null},c3.service.updateHostingUnit(t,e);break;case"AnalyticsService":t={ID:self.host.ID,AnalyticsService:null},c3.service.updateHostingUnit(t,e);break;case"XAppService":t={ID:self.host.ID,XAppService:null},c3.service.updateHostingUnit(t,e);break;case"Mailer":t={ID:self.host.ID,Mailer:null},c3.service.updateHostingUnit(t,e)}})});var a=$("<section>"),f=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Name",description:localizedString("COLUMN_COMPONET_NAME"),type:"text",width:"30%"},{name:"Type",description:localizedString("COLUMN_COMPONET_TYPE"),type:"text",width:"30%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"25%"}];self.swData=[];var l={getHeaderSpec:function(){return f},getRowCount:function(){return self.swData.length},getRow:function(e){return self.swData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],this.colName=="LifeCycleStatus"?t.showText=!0:t.textalign="center",e=new statusControl(t)}else{if(this.colName=="Type")return this.data.componentType;if(this.colName=="Result"&&this.data["Type"]=="PresentationServer"){var n=this.data,r=this.index,i=this.data.MachineID,s=$("<div>");return c3.service.getTasks().filter("TaskType eq 'DeploySBOClientRoot' and (Status eq 'Processing' or Status eq 'Pending') and ResourceID eq "+i).expand("TaskParameters").query(function(e){if(e.data&&e.data.length>0){var t=e.data[0].ID,n=[];n.push(function(e){var n=e.c3progressWithStatus(function(e){return function(){return getDeployProgress(n,e,container)}}(t),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0});return n}(s));for(var r=0,i=n.length;r<i;r++)0==r&&n[r].start(),r<i-1&&n[r].finishEvent.push(function(e){return function(t){e.start()}}(n[r+1]))}}),s}if(this.colName=="Result"&&this.data["Type"]=="B1WebServer"){var n=this.data,r=this.index,i=this.data.MachineID,s=$("<div>");return c3.service.getTasks().filter("TaskType eq 'DeployBASClient' and (Status eq 'Processing' or Status eq 'Pending') and ResourceID eq "+i).expand("TaskParameters").query(function(e){if(e.data&&e.data.length>0){var t=e.data[0].ID,n=[];n.push(function(e){var n=e.c3progressWithStatus(function(e){return function(){return getDeployProgress(n,e,container)}}(t),{max:100,dur:c3config.Clocker-2,async:1,width:60,hwf:!0});return n}(s));for(var r=0,i=n.length;r<i;r++)0==r&&n[r].start(),r<i-1&&n[r].finishEvent.push(function(e){return function(t){e.start()}}(n[r+1]))}}),s}if(this.colName=="MonitorStatus"){var n=this.data,o=$("<label>"),t={};t.textalign="center",n.Type===sldEntityType.LicenseServer?(monitorUtil.statusPreparation(t,n.monitorStatus,n),o=new statusControl(t),o.c3tip({messageList:n.cachedMessageList})):n.Type===sldEntityType.DatabaseInstance?(monitorUtil.statusPreparation(t,n.monitorStatus,n),o=new statusControl(t),o.c3tip({messageList:n.cachedMessageList})):n.Type===sldEntityType.PresentationServer?(monitorUtil.statusPreparation(t,n.monitorStatus,n),o=new statusControl(t),o.c3tip({messageList:n.cachedMessageList})):n.Type===sldEntityType.IntegrationComponent?(monitorUtil.statusPreparation(t,n.monitorStatus,n),o=new statusControl(t),o.c3tip({messageList:n.cachedMessageList})):n.Type===sldEntityType.Mailer?(monitorUtil.statusPreparation(t,n.monitorStatus,n),o=new statusControl(t),o.c3tip({messageList:n.cachedMessageList})):n.Type===sldEntityType.AnalyticService?(monitorUtil.statusPreparation(t,n.monitorStatus,n),o=new statusControl(t),o.c3tip({messageList:n.cachedMessageList})):n.Type===sldEntityType.XAppService?(monitorUtil.statusPreparation(t,n.monitorStatus,n),o=new statusControl(t),o.c3tip({messageList:n.cachedMessageList})):n.Type===sldEntityType.B1WebServer&&(monitorUtil.statusPreparation(t,n.monitorStatus,n),o=new statusControl(t),o.c3tip({messageList:n.cachedMessageList}));var u={};return u.id=n.ID,u.type=n.Type,u.name=n.Name,u.cell=o,self.swCells.push(u),o}}return e}},c=$(a).gridview({delegate:l});return c.show(),c.rowSelectedEvent.push(function(){self.ldWin1=new loadingWindow,self.ldWin1.show(),this.data["Type"]=="PresentationServer"||this.data["Type"]=="IntegrationComponent"||this.data["Type"]=="Mailer"||this.data["Type"]=="AnalyticsService"||this.data["Type"]=="XAppService"||this.data["Type"]=="B1WebServer"?s.attr({disabled:0}):s.attr({disabled:1}),selectedComponent=this.data;if(this.data["Type"]!=localizedString("RES_PRESENTATION_SERVER"))self.ldWin1&&self.ldWin1.close();else{if(this.data["Status"]!="Online"){self.ldWin1&&self.ldWin1.close();return}var e=parent.getSelectedItem().Version,t=this.data.MachineID,n=this.data;if(this.data["SLDAgentStatus"]!="Available"){self.ldWin1&&self.ldWin1.close();return}self.ldWin1&&self.ldWin1.close()}}),self.swGrid=c,e.append(a),e}function createStorage(){var e=$("<section>").attr({id:"storage"}),t=$("<div>").addClass("tools"),n=localizedString("MISC_REGISTER"),r=localizedString("MISC_UNREGISTER"),i=(new Button({value:n,permissions:[permissionItems.operator]})).dom,s=(new Button({value:r,permissions:[permissionItems.operator]})).dom,o=(new Split({permissions:[permissionItems.operator]})).dom,u=$("<a>").attr({href:"#",id:"btnRefresh_"+id,title:localizedString("MISC_REFRESH")}).addClass("refresh").css("float","right");u.click(function(){self.reloadStorages()}),t.append(i),t.append(o),t.append(s),t.append(u),e.append(t),i.click(function(){var e=new registerStorage(self);e.show()}),i.attr({disabled:1}),s.attr({disabled:1}),self.btnRegStorage=i,self.btnUnregStorage=s,s.click(function(){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),localizedString("RES_SHARED_FOLDER")));e.yesEvent.push(function(){var e={};e.success=function(e){self.reload(),s.attr({disabled:1})};var t={};switch(selectedStorage.Type){case localizedString("RES_IMPL_RSTY"):t={ID:self.host.ID,ImplementationRepository:null},c3.service.updateHostingUnit(t,e);break;case localizedString("RES_COMP_TEMP_RSTY"):t={ID:self.host.ID,CompanyTemplateRepository:null},c3.service.updateHostingUnit(t,e)}})});var a=$("<section>"),f=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"Path",description:localizedString("COLUMN_STORAGE_PATH"),type:"text",width:"50%"},{name:"Type",description:localizedString("COLUMN_STORAGE_TYPE"),type:"text",width:"30%"}];self.storageData=[];var l={getHeaderSpec:function(){return f},getRowCount:function(){return self.storageData.length},getRow:function(e){return self.storageData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],this.colName=="LifeCycleStatus"?t.showText=!0:t.textalign="center",e=new statusControl(t)}else if(this.colName=="MonitorStatus"){var n=this.data,r=$("<label>"),t={};t.textalign="center",monitorUtil.statusPreparation(t,n.monitorStatus,n),r=new statusControl(t),r.c3tip({messageList:n.cachedMessageList});var i={};return i.id=n.ID,i.type=n.Type,i.cell=r,self.storageCells.push(i),r}return e}},c=$(a).gridview({delegate:l});return c.show(),c.rowSelectedEvent.push(function(){this.data["Type"]==localizedString("RES_IMPL_RSTY")||this.data["Type"]==localizedString("RES_COMP_TEMP_RSTY")?s.attr({disabled:0}):s.attr({disabled:1}),selectedStorage=this.data}),self.storageGrid=c,e.append(a),e}function batchDeploySBOClient(){var e=parent.getSelectedItem();if(!e.PresentationServers||!e.PresentationServers.results||e.PresentationServers.results.length==0)return;var t=e.PresentationServers.results;for(var n=0;n<t.length;n++)retrieveSBOClient(t[n],t.length,t,e.Version)}function retrieveSBOClient(e,t,n,r){c3.service.retrieveSBOClients(e.Machine.ID,function(i){i.d&&i.d.results&&i.d.results.length>0?(e.SBOClientVersion=i.d.results[0].Version,e.SBOClientID=i.d.results[0].ID):(e.SBOClientVersion=null,e.SBOClientID=null),self.queryCount++;if(self.queryCount>=t){var s=[];for(var o=0;o<n.length;o++)(n[o].SBOClientVersion==null||n[o].SBOClientVersion!=r)&&s.push(n[o]);if(s.length>0){var u=new c3retrieveAllSBOClientSession(self,n,parent.getSelectedItem());u.show(),self.loadingWin1.close()}}})}function createTenantPanel(){var e=$("<section>").attr({id:"huTenant"}),t=[],n=$("<div>").addClass("tools"),r=localizedString("SU_BTN_NEWTNT"),i=localizedString("MISC_EDIT"),s=localizedString("BUTTON_HU_UPGRADE"),o=localizedString("BUTTON_HU_DELETE"),u=$("<input>").attr({type:"button",value:r}),a=$("<input>").attr({type:"button",value:i}),f=$("<input>").attr({type:"button",value:o});n.append(u),n.append($("<span>").addClass("split")),n.append(a),n.append(f);var l=$("<section>"),c=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"5%"},{name:"CompanyDatabase_CompanyName",description:localizedString("TENANT"),type:"text",width:"15%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"15%"},{name:"Customer_Name",description:localizedString("CUSTOMER"),type:"text",width:"20%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"15%"},{name:"Description",description:localizedString("MISC_DESCRIPTION"),type:"text",width:"30%"}];self.tenantData=[];var h={getHeaderSpec:function(){return c},getRowCount:function(){return self.tenantData?self.tenantData.length:0},getRow:function(e){return self.tenantData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"){var t={};t.text=this.data[this.colName],this.colName=="LifeCycleStatus"?t.showText=!0:t.textalign="center",e=new statusControl(t)}return e}},p=$(l).gridview({delegate:h});return p.show(),p.rowSelectedEvent.push(function(){t=[],t.push(this.data)}),self.tenantGrid=p,e.append(l),e}function createAddOnMgmt(){var e=$("<section>").attr({id:"huAddOn"}),t=$("<input>").attr({type:"button",value:"Register Add-On"}),n=$("<div>").addClass("tools");n.append(t),e.append(n);var r=$("<section>"),i=[{name:"ID",description:localizedString("SU_EXT_COLUMN_ID"),type:"text",width:"4%"},{name:"Name",description:localizedString("SU_EXT_COLUMN_ADDONNAME"),type:"text",width:"30%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"30%"},{name:"Namespace",description:localizedString("SU_EXT_COLUMN_NAMESPACE"),type:"text",width:"30%"},{name:"DefaultGroup",description:localizedString("SU_EXT_COLUMN_DETGROUP"),type:"text",width:"12%"},{name:"ForceInstall",description:localizedString("SU_EXT_COLUMN_4KSINSTALL"),type:"text",width:"12%"}];self.addOns=[{ID:1,Name:"Outlook_Integration",Version:"882.063.00.02",Namespace:"SAP",DefaultGroup:"Automatic",ForceInstall:"Y"},{ID:2,Name:"XLReporter",Version:"882.063.00.02",Namespace:"SAP",DefaultGroup:"Automatic",ForceInstall:"Y"},{ID:3,Name:"CopyExpress",Version:"882.063.00.02",Namespace:"BK",DefaultGroup:"Disabled",ForceInstall:"Y"}];var s={getHeaderSpec:function(){return i},getRowCount:function(){return self.addOns.length},getRow:function(e){return self.addOns[e]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(){var e=null;return e=this.data[this.colName],e}},o=$(r).gridview({delegate:s});return o.show(),self.addOnGrid=o,e.append(r),e}function createAdminData(){var e=c3log.createAdminData(self);return e}function checkValidityBeforeSubmit(e,t){var n="";return e&&e.Purpose&&t.Purpose!=e.Purpose&&(t.Purpose=="Trial"&&e.Purpose!="Trial"&&(n+=String.format(localizedString("SERVICEUNIT_INVALID_PURPOSE_TRIAL_TO_NONTRIAL"),e.Purpose)),t.Purpose!="Trial"&&t.Purpose!="Staging"&&e.Purpose=="Trial"&&(n+=String.format(localizedString("SERVICEUNIT_INVALID_PURPOSE_NONTRIAL_TO_TRIAL"),t.Purpose)),t.Purpose=="Staging"&&e.Purpose!="Staging"&&(n+=String.format(localizedString("SERVICEUNIT_INVALID_PURPOSE_STAGING_TO_NONSTAGING"),e.Purpose)),t.Purpose!="Staging"&&t.Purpose!="Trial"&&e.Purpose=="Staging"&&(n+=String.format(localizedString("SERVICEUNIT_INVALID_PURPOSE_NONSTAGING_TO_STAGING"),t.Purpose))),n}function bindData(e,t){self.title.text(title_prefix+": "+parse(e.Name)),self.dataform.submit=function(e){var t=checkValidityBeforeSubmit(e,this.getDataSource());if(t&&t!==""){alert(t);return}if(e.Purpose&&e.Purpose!=this.getDataSource().Purpose){var n=MessageBox.confirm({msg:localizedString("COMFIRMATION_UPDATE_SERVICEUNIT_PURPOSE")});n.yesEvent.push(function(){var t={};t.success=function(e){cometdManager.getConnectedStatus()||parent.reload()},c3.service.updateHostingUnit(e,t)})}else{var r={};r.success=function(e){cometdManager.getConnectedStatus()||parent.reload()},c3.service.updateHostingUnit(e,r)}return!0},self.dataform.setDataSource(c3.service.convertData([e])[0]),self.dataform.dataBind(),self.dataform.changeMode(0),self.statusData.clear(),c3.service.getHUStatusValues(function(e){for(var t=0;t<e.data.length;t++)self.statusData.push({text:e.data[t],value:e.data[t]})}),self.purposesData.clear(),c3.service.getHUPurposeValues(function(e){for(var t=0;t<e.data.length;t++)self.purposesData.push({text:e.data[t],value:e.data[t]})});var n={};e.Tenants&&(n.data=c3.service.convertData(e.Tenants.results)),bindTenantTbl(n),self.host=e,self.reload(),initeMonitorStatus(t),parent.getSelectedItem()&&parent.getSelectedItem().CommonDatabase?(self.btnRegSW.attr({disabled:0}),self.btnRegStorage.attr({disabled:0}),parent.getSelectedItem().Purpose.toLowerCase()!="staging"&&$(self.btnAddAddon).attr({disabled:0})):(self.btnRegSW.attr({disabled:1}),self.btnRegStorage.attr({disabled:1}),$(self.btnAddAddon).attr({disabled:1}))}function initeMonitorStatus(e){initeMonitorMessage(e),self.moni=e}function initeMonitorMessage(e){self.monitorDetailData=[];if(e!==undefined&&e.StatusCode>0){var t=0,n=0,r=0,i=0,s=0,o=e.Messages.results;for(var u=0;u<o.length;u++){if(o[u].Level===monitorUtil.available)continue;o[u].Level===monitorUtil.serviceError?t++:o[u].Level===monitorUtil.infraNotReach?n++:o[u].Level===monitorUtil.serviceNotReach?r++:o[u].Level===monitorUtil.warning?i++:o[u].Level===monitorUtil.unknown&&s++;var e={};e.monitorStatus=o[u].Status,e.ID=o[u].ComponentID,e.messageCode=o[u].Code,e.monitorStatusCode=o[u].Level,e.message=o[u].Content,o[u].ComponentType===sldEntityType.LicenseServer?e.componentType=localizedString("RES_LIC_SERVER"):o[u].ComponentType===sldEntityType.DatabaseInstance?e.componentType=localizedString("RES_MS_SQL"):o[u].ComponentType===sldEntityType.CommonDatabase?e.componentType=localizedString("RES_SBO_COMMON_LF"):o[u].ComponentType===sldEntityType.PresentationServer?e.componentType=localizedString("RES_PRESENTATION_SERVER_LF"):o[u].ComponentType===sldEntityType.B1WebServer?e.componentType=localizedString("RES_BROWSERACCESS_SERVER"):o[u].ComponentType===sldEntityType.IntegrationComponent?e.componentType=localizedString("RES_B1I_SERVER_LF"):o[u].ComponentType===sldEntityType.Mailer?e.componentType=localizedString("RES_MAILER_SERVICE"):o[u].ComponentType==="SLD Agent"?e.componentType=localizedString("RESPOOL_SLDAGENT_TLT"):o[u].ComponentType===sldEntityType.SharedFolder?e.componentType=localizedString("RES_SH_FOLDER_LF"):o[u].ComponentType===sldEntityType.TenantsStorage?e.componentType=localizedString("RES_TENANTS_STORAGE_LF"):o[u].ComponentType===sldEntityType.ImplementationRepository?e.componentType=localizedString("RES_SHARED_IMPL_REPOSITORY_LF"):o[u].ComponentType===sldEntityType.CompanyTemplateRepository?e.componentType=localizedString("RES_COMPANY_TEMPLATE_REPOSITORY_LF"):o[u].ComponentType===sldEntityType.UsersStorage?e.componentType=localizedString("USER_STORAGES"):o[u].ComponentType===sldEntityType.SoftwareRepository?e.componentType=localizedString("SOFTWAREREPO_LF"):o[u].ComponentType===sldEntityType.AnalyticsService?e.componentType=localizedString("RESPOOL_B1A_TLTPREFIX"):o[u].ComponentType===sldEntityType.ServiceUnit?e.componentType=localizedString("HOSTUNIT"):o[u].ComponentType===sldEntityType.AnalyticService?e.componentType=localizedString("RES_B1AH_SERVER"):o[u].ComponentType===sldEntityType.XAppService&&(e.componentType=localizedString("RESPOOL_XAPP_TLTPREFIX")),o[u].ComponentName!==undefined?(e.componentName=o[u].ComponentName,e.Component=e.componentType+"("+e.componentName+")"):e.Component=e.componentType,self.monitorDetailData.push(e)}self.not_ava_title.text(constructStatusText(localizedString("MONITOR_STATUS_NOT_AVAILABLE_TITLE"),t)),self.warning_title.text(constructStatusText(localizedString("MONITOR_STATUS_WARNING_TITLE"),i)),self.inf_not_ava_title.text(constructStatusText(localizedString("MONITOR_STATUS_INF_NOT_REACH_TITLE"),n)),self.not_reach_title.text(constructStatusText(localizedString("MONITOR_STATUS_NOT_REACH_TITLE"),r)),self.unknown_title.text(constructStatusText(localizedString("MONITOR_STATUS_UNKNOWN_TITLE"),s)),self.monitorDetailData.sort(function(e,t){return t.monitorStatusCode-e.monitorStatusCode})}else self.not_ava_title.text(constructStatusText(localizedString("MONITOR_STATUS_NOT_AVAILABLE_TITLE"),0)),self.warning_title.text(constructStatusText(localizedString("MONITOR_STATUS_WARNING_TITLE"),0)),self.inf_not_ava_title.text(constructStatusText(localizedString("MONITOR_STATUS_INF_NOT_REACH_TITLE"),0)),self.not_reach_title.text(constructStatusText(localizedString("MONITOR_STATUS_NOT_REACH_TITLE"),0)),self.unknown_title.text(constructStatusText(localizedString("MONITOR_STATUS_UNKNOWN_TITLE"),0));self.monitorGrid.reload()}function refreshMonitorStatusInternal(e){return function(){updating(e)}}function updating(e){initeMonitorStatus(e);var t=e.Messages.results;for(var n=0;n<self.swData.length;n++){updateSWMoniCacheData(self.swData[n],t);for(var r=0;r<self.swCells.length;r++)if(self.swCells[r].type==self.swData[n].Type&&self.swCells[r].name==self.swData[n].Name){var i={};i.textalign="center",monitorUtil.statusPreparation(i,self.swData[n].monitorStatus,self.swData[n]);var s=$(self.swCells[r].cell);s.children("label").remove(),s.unbind("mouseover");var o=(new statusControl(i)).children("label");s.append(o),s.c3tip({messageList:self.swData[n].cachedMessageList})}}for(var u=0;u<self.storageData.length;u++){var a=[];for(var f=0;f<t.length;f++)if(self.storageData[u].FolderType===t[f].ComponentType){var l={};l.Status=t[f].Status,l.Level=t[f].Level,l.Content=t[f].Content,a.push(l)}if(a.length>0)a.sort(function(e,t){return t.Level-e.Level}),self.storageData[u].monitorStatus=a[0].Status,self.storageData[u].monitorStatusCode=a[0].Level,self.storageData[u].cachedMessageList=monitorUtil.buildMessageList(a);else{self.storageData[u].monitorStatus=localizedString("MONITOR_STATUS_UNKNOWN"),self.storageData[u].monitorStatusCode=5;var c=[];c.push({statusClass:"Moni_unknown",message:localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE")}),self.storageData[u].cachedMessageList=c}for(var h=0;h<self.storageCells.length;h++)if(self.storageData[u].Type===self.storageCells[h].type&&self.storageData[u].ID===self.storageCells[h].id){var i={};i.textalign="center",monitorUtil.statusPreparation(i,self.storageData[u].monitorStatus,self.storageData[u]);var p=$(self.storageCells[h].cell);p.children("label").remove(),p.unbind("mouseover");var o=(new statusControl(i)).children("label");p.append(o),p.c3tip({messageList:self.storageData[u].cachedMessageList})}}}function updateSWMoniCacheData(e,t){var n=[];for(var r=0;r<t.length;r++)if(e.Type===t[r].ComponentType&&e["ID"]==t[r].ComponentID){var i={};i.Status=t[r].Status,i.Level=t[r].Level,i.Content=t[r].Content,n.push(i)}if(n.length>0)n.sort(function(e,t){return t.Level-e.Level}),e.monitorStatus=n[0].Status,e.monitorStatusCode=n[0].Level,e.cachedMessageList=monitorUtil.buildMessageList(n);else{e.monitorStatus=localizedString("MONITOR_STATUS_UNKNOWN"),e.monitorStatusCode=monitorUtil.unknown;var s=[];s.push({statusClass:"Moni_unknown",message:localizedString("MONITOR_STATUS_UNKNOWN_MESSAGE")}),e.cachedMessageList=s}}function bindSWTbl(e){if(e.data&&e.data.length>0){var t=self.moni.Messages.results;for(var n=0;n<e.data.length;n++)e.data[n].Type==="RES_LIC_SERVER"?(e.data[n].Type=sldEntityType.LicenseServer,e.data[n].componentType=localizedString("RES_LIC_SERVER")):e.data[n].Type==="RES_B1I_SERVER"?(e.data[n].Type=sldEntityType.IntegrationComponent,e.data[n].componentType=localizedString("RES_B1I_SERVER")):e.data[n].Type==="RES_B1AH_SERVER"?(e.data[n].Type=sldEntityType.AnalyticService,e.data[n].componentType=localizedString("RES_B1AH_SERVER")):e.data[n].Type==="RES_XAPP_SERVICE"?(e.data[n].Type=sldEntityType.XAppService,e.data[n].componentType=localizedString("RES_XAPP_SERVICE")):e.data[n].Type==="RES_MAILER_SERVICE"?(e.data[n].Type=sldEntityType.Mailer,e.data[n].componentType=localizedString("RES_MAILER_SERVICE")):e.data[n].Type==="RES_PRESENTATION_SERVER"?(e.data[n].Type=sldEntityType.PresentationServer,e.data[n].componentType=localizedString("RES_PRESENTATION_SERVER")):e.data[n].Type==="RES_MS_SQL"?(e.data[n].Type=sldEntityType.DatabaseInstance,e.data[n].componentType=localizedString("RES_MS_SQL")):e.data[n].Type==="RES_BROWSERACCESS_SERVER"&&(e.data[n].Type=sldEntityType.B1WebServer,e.data[n].componentType=localizedString("RES_BROWSERACCESS_SERVER")),updateSWMoniCacheData(e.data[n],t)}self.swData=e.data,self.swCells=[],self.swGrid.reload()}function bindStorageTbl(e){if(e.data&&e.data.length>0){var t=self.moni.Messages.results;for(var n=0;n<e.data.length;n++){e.data[n].Type=localizedString(e.data[n].Type);switch(e.data[n].Type){case localizedString("RES_SHARED_FOLDER_OPTION"):e.data[n].FolderType=sldEntityType.SharedFolder;break;case localizedString("RES_TENANTS_STORAGE"):e.data[n].FolderType=sldEntityType.TenantsStorage;break;case localizedString("RES_SHARED_IMPL_REPOSITORY"):e.data[n].FolderType=sldEntityType.ImplementationRepository;break;case localizedString("RES_COMPANY_TEMPLATE_REPOSITORY"):e.data[n].FolderType=sldEntityType.CompanyTemplateRepository;break;case localizedString("SOFTWAREREPO"):e.data[n].FolderType=sldEntityType.SoftwareRepository}var r=[];for(var i=0;i<t.length;i++)if(e.data[n].FolderType===t[i].ComponentType){var s={};s.Status=t[i].Status,s.Level=t[i].Level,s.Content=t[i].Content,r.push(s)}r.length>0&&(r.sort(function(e,t){return t.Level-e.Level}),e.data[n].monitorStatus=r[0].Status,e.data[n].monitorStatusCode=r[0].Level,e.data[n].cachedMessageList=monitorUtil.buildMessageList(r))}}self.storageData=e.data,self.storageGrid.reload()}function bindExtTbl(e){c3.service.getTasks().filter("TaskType eq 'ExtensionDeployment Registration' and (Status eq 'Processing' or Status eq 'Pending')").expand("TaskParameters").query(function(t){var n=[];if(t.data&&t.data.length>0)for(var r=0;r<t.data.length;r++){var i=t.data[r].TaskParameters.results;if(i&&i.length>0){var s={TaskID:t.data[r].ID,ErrorCode:t.data[r].ErrorCode};for(var o=0;o<i.length;o++)s[i[o].Name]=i[o].Value;n.push(s)}}for(var r=0;r<n.length;r++)self.host.CommonDatabase.ID==n[r].CommonDatabase&&e.data.push({ExtensionID:parseInt(n[r].Extension,10),Name:n[r].ExtensionName,Vendor:n[r].ExtensionVendor,Type:convertToDisplayExtensionType(n[r].ExtensionType),Version:n[r].ExtensionVersion,Tenant:0,TaskID:n[r].TaskID});self.host.Purpose=="Staging"?self.extData=[]:self.extData=e.data,self.btnRemoveAddon||self.btnRemoveAddon.attr({disabled:1}),self.extGrid.reload()})}function bindTenantTbl(e){self.tenantData=e.data,self.tenantGrid.reload()}function bindUpgradeSimulationTbl(e){self.dataUpgSimul=e,self.gridUpgSimul.reload()}c3.module.apply(this);var id="hu_detail",container=$("<section>").attr({id:id}).addClass("tab"),title=localizedString("SU_DETAILS_TLT"),tabHeadTxt=[localizedString("MISC_CONFIGURATION"),localizedString("HU_SW_COMPONENTS"),localizedString("RES_SHARED_FOLDER"),localizedString("TENANTS"),localizedString("SU_DETAIL_MONITOR")],self=this,title_prefix=localizedString("HOSTUNIT"),swPage=0,swPageSize=5,tePage=0,tePageSize=5,selectedComponent=null,selectedStorage=null,selectedExtension=null,parent=arguments[0]||{};c3.hasPermission([permissionItems.operator])&&tabHeadTxt.push(localizedString("HU_EXTENSIONS")),tabHeadTxt.push(localizedString("SU_DETAIL_UPGRADE_SIMULATION")),self.id=id,self.queryCount=0,self.compatibilityCheckSwitch=!1,self.swCells=[],self.storageCells=[],self.toolbarItemList=[],this._container=container,this.onInit=function(){self.detailTitle=$("<h1>").append(title),container.append(self.detailTitle),container.append(createTabHead()),container.append(createTabBody());var e=$("#"+id+">.detail_tab_header a").c3tab("#"+id+">.detail_tab_body>section",{});self.navTab=e,e.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Tenants,function(e){parent.reload()}),cometdManager.subscribe(sldEntitySet.ExtensionDeployments,function(e){self.reload()}),cometdManager.subscribe(sldEntitySet.ExtensionInstallations,function(e){self.reload()}),cometdManager.subscribe(sldEntitySet.Tasks,function(e){self.reload()})},this.onViewAppear=function(){},this.refreshTitle=function(e){self.detailTitle.text(title)};var getExtProgress=function(progressBar,tid,rowContainer){c3.service.getTaskProgress(tid).query(function(result){var status=result.data.GetTaskProperties.split(",");"FAILED"==status[0].toUpperCase()?c3.service.getTaskResult(tid).query(function(e){e!=null&&e.data!=null&&e.data.GetResult==""?c3.service.getTasks(tid).expand("TaskParameters").query(function(e){progressBar.setFailed(e.data.ResultDescription)}):e.data.GetResult.length>0&&c3.service.getTasks(tid).query(function(e){progressBar.setWarning(e.data.ResultDescription)})}):"SUCCESSFUL"==status[0].toUpperCase()?(c3.service.getTaskResult(tid).query(function(result1){if(result1!=null&&result1.data!=null&&result1.data.GetResult!=null){var errorArray=eval(result1.data.GetResult);progressBar.setValue(100,localizedString("MISC_DONE"))}}),rowContainer.data.errorLabel!=null&&rowContainer.data.errorLabel.text(0)):(status[0]!="Pending"&&status[0]!="Done"?status[0]=localizedString("MISC_TASK_PROCESSING"):status[0]=="Pending"&&(status[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),progressBar.setValue(parseInt(status[1]),status[0]))})};self.unRegPresentation=unRegPresentation,self.unRegBAServer=unRegBAServer;var getDeployProgress=function(e,t,n){c3.service.getTaskProgress(t).query(function(r){var i=r.data.GetTaskProperties.split(",");"FAILED"==i[0].toUpperCase().toUpperCase()||"CANCELLED"==i[0].toUpperCase()||"ROLLBACK"==i[0].toUpperCase()?c3.service.getTasks(t).expand("TaskParameters").query(function(t){e.setFailed(t.data.ResultDescription),Utility.logTaskError(t.data)}):"SUCCESSFUL"==i[0].toUpperCase()?(suManager.getSoftwareComponentsBySU(self.host.ID,bindSWTbl),e.setValue(100,localizedString("MISC_DONE")),n.data.errorLabel!=null&&n.data.errorLabel.text(0)):(i[0]!="Pending"&&i[0]!="Done"?i[0]=localizedString("MISC_TASK_PROCESSING"):i[0]=="Pending"&&(i[0]=localizedString("SBOCOMMON_PROGRESS_WAIRING")),e.setValue(parseInt(i[1]),i[0]))})};this.reload=function(){if(self.host!==undefined&&self.host.ID!==undefined){suManager.getSoftwareComponentsBySU(self.host.ID,bindSWTbl),suManager.getStoragesBySU(self.host.ID,bindStorageTbl);if(c3.hasPermission([permissionItems.operator]))var e=suManager.getExtensionsByCommonDB(self.host.CommonDatabase.ID,bindExtTbl,self.host.Version);self.reloadUpgradeSimulations()}},this.bindData=bindData,this.refreshMonitorStatus=function(e){setTimeout(refreshMonitorStatusInternal(e),1e3)},this.unbindSoftwareTbl=function(){selectedComponent=null,self.btnUnregSW.attr({disabled:!0});var e={};e.data=[],self.swData=e,self.swCells=[],self.swGrid.reload()},this.unbindStorageTbl=function(){selectedStorage=null,self.btnUnregStorage.attr({disabled:!0});var e={};e.data=[],self.storageData=e,self.storageCells=[],self.storageGrid.reload()},this.unbindExtension=function(){if(!c3.hasPermission([permissionItems.operator]))return;var e={};e.data=[],self.btnAddAddon.attr({disabled:1}),self.btnRemoveAddon.attr({disabled:1}),self.extData=e,self.extGrid.reload()},this.reloadComponent=function(){suManager.getSoftwareComponentsBySU(self.host.ID,bindSWTbl)},this.reloadStorages=function(){suManager.getStoragesBySU(self.host.ID,bindStorageTbl)},this.reloadUpgradeSimulations=function(){var e=c3.service.convertData(self.host.Tenants.results);suManager.getUpgradeSimulations(self.host.ID,bindUpgradeSimulationTbl)}}}(),c3tenant.detail=function(){function createTabHead(){var e=$("<ul>").attr({id:id+"_tab_header"}).addClass("detail_tab_header");for(var t=0;t<tabHeadTxt.length;t++){var n=$("<a>").attr({href:"#"}).append(tabHeadTxt[t]);e.append($("<li>").attr({id:id+t.toString()}).append(n))}return e}function createTabBody(){var e=$("<section>").attr({id:id+"_tab_body"}).addClass("detail_tab_body");return e.append(createTenantProfile()),e.append(createLicenseManagement()),e.append(createUserManagement()),e.append(createExtensions()),e}function createTenantProfile(){var e=id+"_profile",t=$("<section>").attr({id:e}),n=[];self.statusData=[],self.sharefolderlist=[],self.authenticatin=[],self.purposeData=[];var r=[{id:"id",text:localizedString("SU_EXT_COLUMN_ID"),binding:"ID",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"companyName",text:localizedString("MISC_CPYNAME"),binding:"CompanyDatabase_CompanyName",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:self.statusData}},{id:"authenticationType",text:localizedString("COLUMN_AUTH"),binding:"Authentication_Type",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:self.authenticatin}},{id:"purpose",text:localizedString("COLUMN_PURPOSE"),binding:"Purpose",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:self.purposeData}},{id:"contactPerson",text:localizedString("COLUMN_CONTACTPERSON"),binding:"ContactPerson",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"email",text:localizedString("CUSTOMER_COLUMN_EMAIL"),binding:"Email",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"phone",text:localizedString("CUSTOMER_COLUMN_PHONE"),binding:"Phone",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"serviceUnit",text:localizedString("HOSTUNIT"),binding:"ServiceUnit_Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"b1SharedFolder",text:localizedString("RES_B1_FOLDER"),binding:"SBOSharedFolder_URI",bindingValue:"SBOSharedFolder_ID",type:"label",readonly:!0,"class":"chrome3",editable:!1},{id:"trialPeriod",text:localizedString("TNT_COLUMN_TRIALPRIOD"),binding:"TrialPeriod",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"remainingDays",text:localizedString("TNT_LABEL_REMAININGDAYS"),binding:"RemainingDays",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"extendTrial",text:localizedString("TNT_COLUMN_EXTENDTRIALBY"),binding:"ExtendTrial",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"LastPreUpgradeTesting",text:localizedString("TNT_COLUMN_LASTPREUPG_RESULT"),binding:"",type:"label",readonly:!0,"class":"chrome3",editable:!1},{id:"creationDate",text:localizedString("COLUMN_CREATE_DATE"),binding:"CreationDate",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("MISC_DESCRIPTION"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",controlClass:"value",rows:2,editable:!0},{id:"domainGroup",text:localizedString("COLUMN_DOMAIN_GROUP"),binding:"Group_DomainGroup",type:"label",readonly:!0,"class":"chrome2",editable:!1}];n.push(r);var i={getColumns:function(){return n},getViewContent:function(){var e=null;if(this.colName=="Status"||this.colName=="LifeCycleStatus"||this.colName=="Customer_Status"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}else if(this.colName=="CreationDate"){if(this.data[this.colName]){var n=convertToDate(this.data[this.colName]).timeString();e=$("<label>").append(n).attr({title:n})}}else{if(this.colName=="RemainingDays")return this.data["RemainingDays"]!=null&&this.data["RemainingDays"].toString()=="-1"?$("<label>").html(localizedString("MONITOR_STATUS_UNKNOWN")):null;if(this.colName=="TrialPeriod")return this.data["TrialPeriod"]!=null&&this.data["TrialPeriod"].toString()=="-1"?$("<label>").html(localizedString("MONITOR_STATUS_UNKNOWN")):null}return e}},s=$(t).dataform({delegate:i});self.dataform=s;var o=self.dataform.getToolbar(),u=o.edit.parent(".tools"),a=$("<input>").attr({value:localizedString("TNT_BTN_OPEN_SERVICE_CONNECTION"),type:"button",id:"opensvcconn"});u&&u.append($("<span>").addClass("split")).append(a),self.btnOpenSvcConnection=a,self.btnOpenSvcConnection.attr({disabled:1});var f=$("<input>").attr({value:localizedString("GenerateDynamicKey"),type:"button",id:"generatedynamickey"});return u&&c3.hasPermission([permissionItems.operator])&&u.append($("<span>")).append(f),self.btnGenerateDKey=f,self.btnGenerateDKey.attr({disabled:1}),f.click(function(){self.btnGenerateDKey.attr({disabled:1});var e={success:function(e){var t=$("<div>").append((new String(localizedString("GenerateSuccess"))).replace("{0}",self.tenant.CompanyDatabase_CompanyName)).append("<br></br>").append(localizedString("GenerateSuccessDetail")),n=MessageBox.show({msg:t,title:localizedString("Information"),width:450,height:200,buttons:MessageBoxButton.OK});self.btnGenerateDKey.attr({disabled:0})},error:function(){alert(localizedString("GenerateFail")),self.btnGenerateDKey.attr({disabled:0})}};c3.service.GenerateTenantDynamicKey(self.tenant.ID,e)}),self.serviceUser="",a.click(function(){c3.service.getCurrentOperator().query(function(e){e.data[0]&&c3.service.getOSUserBindings(undefined).filter("User/ID eq "+e.data[0].ID).query(function(e){self.serviceUser=e.data[0].SystemUser;var t=[],n={id:e.data[0].ID,systemUsername:e.data[0].SystemUser,isSuperSBOUser:Boolean(!0),isPowerSBOUser:Boolean(!0)};t.push(n);var r=0,i=parent.getSelectedItem().ServiceUnit_ID,s={success:function(e,t){var n={error:{message:{value:"Open Service Connection failed: No presentation server found"}}};if(c3.service.getPresentationServers.length>0)var s=c3.service.getPresentationServers().expand("Machine, ServiceUnit").filter("ServiceUnit/ID eq "+i).query(function(e){r=e.data.length;if(r>0)if(e.data[0]){var t=e.data[0].Machine.Hostname,i=odataclient.getServiceUrl(c3config.SLDPath)+"/PresentationServers/GetPresentationServerConnectionFile?Hostname='"+t+"'&Username='"+self.serviceUser+"'";window.open(i)}else console.error("Open Service Connection failed: No presentation server found"),Utility.logError(JSON.stringify(n));else console.error("Open Service Connection failed: No presentation server found"),Utility.logError(JSON.stringify(n))})},error:function(e,t){console.error("Open Service Connection failed"),console.trace();var n={error:{message:{value:"Open Service Connection failed"}}};Utility.logError(JSON.stringify(n))}};c3.service.createTenantServiceUser(self.tenant.ID,t,!1,s)})})}),s.afterEdit.push(function(e){var t=parent.getSelectedItem();if(t&&t.Purpose=="Trial"){var n=s.getControl("extendTrial");n.css({width:"60px"}).attr({pattern:"[0-9]*"});var r=n.parent(),i=r.find("#suffixation");i[0]||r.append($("<label>").attr({id:"suffixation"}).append("&nbsp;"+localizedString("MISC_DAY"))),r.show()}var o=t.ServiceUnit_Version,u=o.split("."),a=parseInt(u.join("")),f=t.ServiceUnit_CommonDatabase_DatabaseInstance.ServerType=="HANADB"?!0:!1;a<="88207300"&&$("#authenticationType").attr({disabled:1}),f&&$("#authenticationType").attr({disabled:1})}),s.afterCancel.push(function(e){var t=s.getControl("extendTrial").parent();t.hide(),getLastPreupgradeResult()}),t}function createCompanyAction(e,t){c3.service.getDetail(e.getSelectedItem().SUnit_CommDB).expand("DatabaseInstance/Machine").query(function(n){var r=new c3newCompanyDB(n.data.DBInst,e.getSelectedItem(),!0,t);r.show()})}function enableControls(){var e=parent.getSelectedItem();e&&e.CompanyDatabase_Version.startsWith("882")?self.btnGenerateDKey.attr({disabled:1}):e&&e.CompanyDatabase_Version.startsWith("900")&&self.btnGenerateDKey.attr({disabled:0}),self.btnImportLicense.attr({disabled:0}),self.btnAddUser.attr({disabled:0}),self.btnLoadUsers.attr({disabled:0}),self.btnOpenSvcConnection.attr({disabled:0});var t=e&&e.Status=="Maintenance"?!0:!1;t?(self.btnAddExtension.attr({disabled:1}),self.btnRemoveExtension.attr({disabled:1}),self.btnAddUser.attr({disabled:1}),self.btnConfig.hide()):self.btnAddExtension.attr({disabled:0})}function disableControls(){self.btnImportLicense.attr({disabled:1}),self.btnOpenSvcConnection.attr({disabled:1}),self.btnGenerateDKey.attr({disabled:1}),self.btnAddUser.attr({disabled:1}),self.btnLoadUsers.attr({disabled:1}),$(self.btnAddExtension).attr({disabled:1}),self.btnRemoveExtension.attr({disabled:1})}function createLicenseManagement(){var e=id+"_licenseManagement",t=$("<section>").attr({id:e}),n=localizedString("TNT_BTN_IMPORTLIC"),r=localizedString("MISC_EDIT"),i=localizedString("BUTTON_HU_DELETE"),s=e+"_toolbar",o=$("<div>").addClass("tools").attr({id:s}),u=$("<input>").attr({value:n,type:"button",id:s+"_btnImportLicense"}).click(function(){if(parent.getSelectedItem()){var e=new c3importLicenseFile(self,self.tenant.ServiceUnit_LicenseServer_ID);e.finishEvent.push(function(){self.reloadLicenseManagement()}),e.show()}}),a=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:localizedString("MISC_REFRESH")}).addClass("refresh");a.click(function(){self.reloadLicenseManagement()}),self.btnImportLicense=u,self.btnImportLicense.attr({disabled:1}),self.licenseServerTitle=$("<h3>").attr({id:e+"_licenseServerTitle"}),self.hwKeyTitle=$("<h4>").attr({id:e+"_hwKeyTitle"}),self.systemNoTitle=$("<h4>").attr({id:e+"_systemNoTitle"}),self.installationNoTitle=$("<h4>").attr({id:e+"_installationNoTitle"});var f=$("<hgroup>").append(self.licenseServerTitle).attr({id:e+"_title_group"});f.append(self.hwKeyTitle),f.append(self.systemNoTitle),f.append(self.installationNoTitle),f.append($("<div>").css({"float":"right","margin-left":"10px"}).append(a)),t.append(f);var l=$("<section>").attr({id:e+"_grid"}),c=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"10%"},{name:"Description",description:localizedString("RESPOOL_LICSERVER_COLUMN_LICTYPE"),type:"text",width:"15%"},{name:"StartDate",description:localizedString("COLUMN_CREATE_DATE"),type:"text",width:"10%"},{name:"ExpirationDate",description:localizedString("RESPOOL_LICSERVER_COLUMN_EXPIREDDATE"),type:"text",width:"10%"},{name:"Used",description:localizedString("COLUMN_USED"),type:"text",width:"10%",dataType:"number"},{name:"Available",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"45%",dataType:"number"}];self.licensesData=[];var h={getHeaderSpec:function(){return c},getRowCount:function(){return self.licensesData.length},getRow:function(e){return self.licensesData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getCell:function(){if(this.colName=="StartDate"||this.colName=="ExpirationDate"){var e=this.data[this.colName];return convertToDate(e).dateString()}return this.colName.trim()=="Available".trim()&&(this.data[this.colName]=this.data[this.colName]+"/"+this.data.Total),null}},p=$(l).gridview({delegate:h});return p.show(),self.licensesDataGrid=p,t.append(l),t}function createTenantUser(){var e=arguments[0],t=self.tenant.ID,n=[];for(var r=0;r<self.tenant.Users.length;r++){if(self.tenant.Users[r].B1UserName=="_psu_1"||self.tenant.Users[r].B1UserName=="_psu_2")continue;n.push({SystemUsername:self.tenant.Users[r].Name,PowerUser:self.tenant.Users[r].IsPowerUser,ID:self.tenant.Users[r].Id,B1Username:self.tenant.Users[r].B1UserName,Status:self.tenant.Users[r].Status,SuperUser:self.tenant.Users[r].IsSuperUser,SystemUsername:self.tenant.Users[r].Name})}var i={CustomerID:self.tenant.Customer_ID,CustomerGroupID:self.tenant.Customer_Group_ID,TenantID:self.tenant.ID,TenantGroupID:self.tenant.Group_ID,InstallationNumber:self.tenant.Customer_InstallationNumber,TenantUsers:n},s=new c3addCustomerUsers(self,i,!0);s.finishEvent.push(function(){var e=s.User,n={success:function(e,t){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),self.reloadUser())},error:function(e,t){self.reloadUser()}};tenantManager.createTenantUser(t,s.selectedItems,n)}),s.show()}function importTenantUsers(){var e=self.tenant.ID,t=[];for(var n=0;n<self.tenant.Users.length;n++)t.push({SystemUsername:self.tenant.Users[n].Name,PowerUser:self.tenant.Users[n].IsPowerUser,ID:self.tenant.Users[n].Id,B1Username:self.tenant.Users[n].B1UserName,Status:self.tenant.Users[n].Status,SuperUser:self.tenant.Users[n].IsSuperUser});var r={CustomerID:self.tenant.Customer_ID,CustomerGroupID:self.tenant.Customer_Group_ID,TenantID:self.tenant.ID,TenantGroupID:self.tenant.Group_ID,InstallationNumber:self.tenant.Customer_InstallationNumber,TenantUsers:t},i=new c3loadTenantUsers(self,r);i.finishEvent.push(function(){var t={success:function(e,t){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),self.reloadUser())},error:function(e,t){self.reloadUser()}};tenantManager.createTenantUser(e,i.selectedItems,t)}),i.show()}function assignTenantUserLicense(e){var t=new c3assignLicense(e,selectedUserIndex);t.show()}function createUserManagement(){var e=id+"_userManagement",t=$("<section>").attr({id:e}),n=localizedString("MISC_ADD"),r=localizedString("TNT_BTN_LOAD_USERS"),i=localizedString("MISC_EDIT"),s=localizedString("TNT_BTN_ASSIGNLIC"),o=localizedString("MISC_REMOVE"),u=e+"_toolbar",a=$("<div>").addClass("tools").attr({id:u}),f=$("<input>").attr({value:n,type:"button",id:u+"_btnAddUser",disabled:1}),l=$("<input>").attr({value:r,type:"button",id:u+"_btnLoadUsers",disabled:1}),c=$("<input>").attr({value:i,type:"button",id:u+"_btnEdit"}),h=$("<input>").attr({value:s,type:"button",id:u+"_btnAssisgnLicense",disabled:1}),p=$("<input>").attr({value:o,type:"button",id:u+"_btnDelete",disabled:1}),d=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:localizedString("MISC_REFRESH")}).addClass("refresh");d.click(function(){self.reloadUser()});var v=$("<input>").attr({value:localizedString("DUPTNT_WIZARD_CHANGESYSUSER_BTN_TEXT"),type:"button",disabled:!0});v.click(function(){var e=new c3changeSystemUser(self,parent.getSelectedItem(),selectedUser,null,self.usersData,self.reloadUser);e.show(),e.finishEvent.push(function(){self.btnChangeUser.attr("disabled",1)})}),self.btnChangeUser=v,self.btnAddUser=f,self.btnLoadUsers=l,self.btnDelete=p,self.btnAssign=h;var m=localizedString("USER");f.click(function(){parent.getSelectedItem()&&createTenantUser(self)}),l.click(function(){parent.getSelectedItem()&&importTenantUsers()}),c.click(function(){}),h.click(function(){parent.getSelectedItem()&&assignTenantUserLicense(self)}),p.click(function(){if(selectedUser!=null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_REMOVE_CONFIRM"),m));e.yesEvent.push(function(){parent.loadingWin.show();var e={};e.success=function(e){parent.loadingWin.close(),cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),self.reloadUser(),self.reloadLicenseManagement()),selectedUserIndex=-1},e.error=function(e){parent.loadingWin.close()};var t=parent.getSelectedItem().ID;c3.service.deleteTenantUser(selectedUser.Id,t).query(e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),m))}),a.append(f),a.append(l),a.append($("<span>").addClass("split")),a.append(h),a.append(p);var g=new searchbox({inputCallback:function(e){return self.usersDataGrid.searchText(e)}});a.append($("<div>").css({"float":"right","margin-left":"10px"}).append(g.css({"float":"left"})).append(d)),t.append(a);var y=$("<section>").attr({id:e+"_grid"}),b=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"10%"},{name:"B1UserName",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"15%"},{name:"B1UserType",description:localizedString("COLUMN_USERTYPE"),type:"text",width:"10%"},{name:"LicenseAssigns",description:localizedString("CUSTOMER_LABEL_ASSIGNEDLIC"),type:"text",width:"61%"}];self.usersData=[];var w={getHeaderSpec:function(){return b},getRowCount:function(){return self.usersData.length},getRow:function(e){return self.usersData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getTip:function(){if(parent.getSelectedItem()&&self.enableGetTip4User)return Utility.CreateTipBoard(localizedString("USER"),function(){parent.getSelectedItem()&&createTenantUser(self)})},getDefaultSelectedIndex:function(){return 0},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}},E=$(y).gridview({delegate:w});return E.rowSelectedEvent.push(function(){onUsersRowSelected(this.index)}),E.show(),self.usersDataGrid=E,t.append(y),t}function createExtensions(){var e=id+"_createExts",t=$("<section>").attr({id:e}),n=localizedString("TENANT_EXTENSION_ASSIGN"),r=localizedString("Enable"),i=localizedString("TENANT_EXTENSION_UNASSIGN"),s=localizedString("ADDON_USER_PREFERENCE"),o=e+"_toolbar",u=$("<div>").addClass("tools").attr({id:o}),a=$("<select>").attr({id:"ddlExtList"}),f=$("<input>").attr({value:n,type:"button",id:o+"_btnAddAddOn"}),l=$("<input>").attr({value:r,type:"button",id:o+"_btnEnable"}),c=$("<input>").attr({value:i,type:"button",id:o+"_btnDisable"}),h=$("<input>").attr({value:s,type:"button",id:o+"_btnUserPref"}),p=$("<a>").attr({href:"#",id:"btnUser_"+e,title:localizedString("USER_PREFERENCE_TIP")}).addClass("user"),d=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:localizedString("MISC_REFRESH")}).addClass("refresh");self.btnAddExtension=f,self.btnRemoveExtension=c,self.btnConfig=p;var v=function(){c.attr({disabled:1});var e=parent.getSelectedItem(),t=e&&e.Status=="Maintenance"?!0:!1;t&&f.attr({disabled:1}),h.attr({disabled:1}),p.hide()},m=function(){var e=parent.getSelectedItem(),t=e&&e.Status=="Maintenance"?!0:!1;t||(c.attr({disabled:0}),f.attr({disabled:0}),h.attr({disabled:0}),p.show())};f.attr({disabled:1}),v();var g=$("<option>").text(localizedString("ADDONS")).attr({value:0});a.append(g),a.bind("change",function(e){}),d.click(function(){self.reloadExtensions()}),f.click(function(){c3.service.getTenants(self.tenant.ID).expand("CompanyDatabase").query(function(e){self.companyDatabase=e.data.CompanyDatabase;var t=new c3assignExtension(self,self.extData);t.show()})}),l.click(function(){}),c.click(function(){if(selectedExtension!=null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_EXTENSION_UNASSIGN_CONFIRM"),localizedString("EXTENSION")));e.yesEvent.push(function(){var e={};e.success=function(e){self.reloadExtensions()},c3.service.deleteExtensionAssignments(selectedExtension,e)})}}),p.click(function(){if(selectedExtension!=null){var e=new c3userPreference(self,selectedExtension);e.show()}}),u.append(f),u.append($("<span>").addClass("split")),u.append(c),u.append($("<div>").css({"float":"right"}).append(p).append(d)),t.append(u);var y=$("<section>").attr({id:e+"_grid"}),b=[{name:"Name",description:localizedString("MISC_NAME"),type:"text",width:"14%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"8%"},{name:"Vendor",description:localizedString("COLUMN_PROVIDER"),type:"text",width:"8%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"10%"},{name:"StartupMode",description:localizedString("MISC_STARTUPMODE"),type:"text",width:"10%"},{name:"Assignment",description:localizedString("TENANT_EXTENSION_VIEWASSIGN"),type:"text",width:"15%"},{name:"Enabled",description:localizedString("MISC_ENABLED"),type:"text",width:"10%"},{name:"SharedFolder",description:localizedString("EXTENSION_SHAREDFOLDER"),type:"text",width:"25%"}];self.extData=[];var w=null,E={getHeaderSpec:function(){return b},getRowCount:function(){return self.extData.length},getRow:function(e){return self.extData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getTip:function(){},getCell:function(e){var t={};t.ID=this.data.ID;if(this.colName=="Assignment"){if(this.data.Type!=localizedString("EXTENSION_TYPE_ADDON")){var n=this.data,r=$("<div>"),i=lkb=$("<a>").text(localizedString("LINK_DETAILS")).attr({href:"#",title:localizedString("LINK_DETAILS")});return i.click(function(){var e=new c3editExtensionAssProperty(n);e.show()}),r.append(i),r}return $("<div>")}if(this.colName=="Enabled"){var s=$("<div>").attr({title:localizedString(this.data.Enabled)}).addClass("statusControl"),o=["MISC_ENABLED","MISC_DISABLED"],u=$("<select>").bind("change",function(e){var n=u.find("option:selected").val(),r={};r.success=function(e){self.reloadExtensions(),v()},r.error=function(e){console.log(e)},t.Enabled=n==localizedString("MISC_ENABLED")?!0:!1,c3.service.updateExtensionAssignments(t,r)});for(var a=0;a<o.length;a++)optionType=$("<option>").attr({value:localizedString(o[a]),title:localizedString(o[a])}).append(localizedString(o[a])),localizedString(o[a])==this.data.Enabled&&optionType.attr({selected:!0}),u.append(optionType);var f=$("<label>").attr({title:localizedString(this.data.Enabled)}).append(localizedString(this.data.Enabled)),l=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel"),c=$("<div>").css({"float":"left","padding-top":"3px"}).append(l);l.click(function(){p.hide(),f.show(),c.hide(),h.show()});var h=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){c.show(),p.show(),f.hide(),h.hide()}),p=$("<div>").css({"float":"left"}).attr({title:localizedString(this.data.Enabled)}).append(u);return p.hide(),c.hide(),s.append(f).append(p).append(h).append(c),s}if(this.colName=="StartupMode"){var s=$("<div>").attr({title:localizedString(Utility.startupModeTextKey(this.data.StartupMode))}).addClass("statusControl"),o=["Automatic","Manual","Mandatory","Disabled"],u=$("<select>").bind("change",function(e){var n=u.find("option:selected").val(),r={};r.success=function(e){self.reloadExtensions(),v()},r.error=function(e){console.log(e)},t.StartupMode=n,c3.service.updateExtensionAssignments(t,r)});for(var a=0;a<o.length;a++)optionType=$("<option>").attr({value:o[a],title:localizedString(Utility.startupModeTextKey(o[a]))}).append(localizedString(Utility.startupModeTextKey(o[a]))),o[a]==this.data.StartupMode&&optionType.attr({selected:!0}),u.append(optionType);var f=$("<label>").attr({title:localizedString(Utility.startupModeTextKey(this.data.StartupMode))}).append(localizedString(Utility.startupModeTextKey(this.data.StartupMode))),l=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel"),c=$("<div>").css({"float":"left","padding-top":"3px"}).append(l);l.click(function(){p.hide(),f.show(),c.hide(),h.show()});var h=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){c.show(),p.show(),f.hide(),h.hide()}),p=$("<div>").css({"float":"left"}).attr({title:localizedString(this.data.StartupMode)}).append(u);return p.hide(),c.hide(),s.append(f).append(p).append(h).append(c),s}}},S=function(e){selectedExtensionIndex=e,selectedExtension=self.extData[e],self.selectedExtension=self.extData[e]};return w=$(y).gridview({delegate:E}),w.rowSelectedEvent.push(function(){S(this.index),m()}),w.show(),self.extDataGrid=w,self.extGridDelegate=E,t.append(y),t}function checkValidityBeforeSubmit(e,t){var n="";if(e){e.Purpose&&t.Purpose!=e.Purpose&&(t.Purpose=="Trial"&&e.Purpose!="Trial"&&(n+=String.format(localizedString("TENANT_INVALID_PURPOSE_TRIAL_TO_NONTRIAL"),e.Purpose)),t.Purpose!="Trial"&&e.Purpose=="Trial"&&(n+=String.format(localizedString("TENANT_INVALID_PURPOSE_NONTRIAL_TO_TRIAL"),t.Purpose)));if(e.Email&&e.Email!==""){var r=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,i=r.test(e.Email);i||(n+=localizedString("TNT_CREATION_EMAIL_VALID"))}if(e.Phone&&e.Phone!==""){var s=/^(\+\d{2,3} )*[\d]+(-[\d]+)*$/;isPhone=s.test(e.Phone),isPhone||(n+=localizedString("TNT_CREATION_PHONE_VALID"))}if(e.ExtendTrial){var r=/^[0-9]*$/,o=r.test(e.ExtendTrial);if(!o)n+=localizedString("TNT_CREATION_EXTDAY_VALID");else{var u=parseInt(e.ExtendTrial);if(u>2147483647)n+=localizedString("TNT_CREATION_EXTDAY_MAXVAL");else{var a=parseInt(e.ExtendTrial)+parseInt(t.TrialPeriod);a>93&&(n+=localizedString("TNT_CREATION_EXTDAY_93DAYS"))}}}}return n}function updateTenant(e,t,n){var r={};r.success=function(e){cometdManager.getConnectedStatus()||console.warn("Notification connection failed!")},r.error=function(e){console.log(e)},typeof e.Authentication_Type!="undefined"&&e.Authentication_Type!=t.Authentication_Type?c3.service.getActiveConnections(t.CompanyDatabase_ID,function(e){if(e.d&&e.d.results&&e.d.results.length>0){var i=e.d.results.length;if(i>0)if(t.Authentication_Type==localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")){var s=new c3activeCompanyDBConnections(self,e.d.results);s.show(),s.finishEvent.push(function(){var e=MessageBox.confirm({msg:String.format(localizedString("CHANGE_AuthenticationType_WARN"),localizedString("TENANT"))});e.yesEvent.push(function(){tenantManager.updateTenantByBatch(n,t.CompanyDatabase_ID,r)})})}else{var s=new c3activeCompanyDBConnections(self,e.d.results);s.show(),s.finishEvent.push(function(){tenantManager.updateTenantByBatch(n,t.CompanyDatabase_ID,r)})}}else if(t.Authentication_Type==localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")){var e=MessageBox.confirm({msg:String.format(localizedString("CHANGE_AuthenticationType_WARN"),localizedString("TENANT"))});e.yesEvent.push(function(){tenantManager.updateTenantByBatch(n,t.CompanyDatabase_ID,r)})}else tenantManager.updateTenantByBatch(n,t.CompanyDatabase_ID,r)}):tenantManager.updateTenantByBatch(n,t.CompanyDatabase_ID,r)}function getLastPreupgradeResult(){parent.getSelectedItem()&&parent.getSelectedItem().TaskID===undefined&&parent.getSelectedItem().CompanyDatabase_ID!=null&&tenantManager.getLastPreUpgradeTestingResult(parent.getSelectedItem().CompanyDatabase_ID,null,!1,function(result){var rstLabel=self.dataform.getForm().find("#LastPreUpgradeTesting");if(rstLabel.size()>0&&result.d&&result.d.GetLastPreUpgradeResult&&result.d.GetLastPreUpgradeResult.length>0){var resultData=eval("({"+result.d.GetLastPreUpgradeResult+"})"),text=localizedString("MISC_SUCCESS"),icon=$("<img>").attr({src:"css/icons/success.png"});if(resultData&&resultData.Result)for(var idx=0;idx<resultData.Result.length;idx++){if(resultData.Result[idx].Type=="Error"){text=localizedString("MISC_ERROR"),icon.attr("src","css/icons/failed.png");break}resultData.Result[idx].Type=="Warning"&&(text=localizedString("MISC_WARNING"),icon.attr("src","css/icons/warning.png"))}var link=$("<a>").text(text).attr({href:"#"});link.click(function(){var e=new c3tenantPreUpgrade_errorMessage(this,resultData.Result,parent.getSelectedItem().ID);e.show()});var validDays=0;if(resultData.LastPreUpgradeTime!=null&&resultData.LastPreUpgradeTime.length>0){var date=new Date(resultData.LastPreUpgradeTime.split(" ")[0]),currentDate=new Date,timeSpan=parseInt((currentDate.getTime()-date.getTime())/864e5);validDays=3-timeSpan,validDays<0&&(validDays=0)}var span=$("<span>").attr({title:resultData.LastPreUpgradeTime}).text(resultData.LastPreUpgradeTime.split(" ")[0]);rstLabel.html("");var span1=$("<span>").attr({title:String.format(localizedString("VALID_DAYS"),validDays)}).text("("+String.format(localizedString("VALID_DAYS"),validDays)+")");rstLabel.append(icon).append("&nbsp;").append(link).append("&nbsp;&nbsp;").append(span).append("&nbsp;&nbsp;").append(span1)}})}function onLicensesRowSelected(e){self.tenant&&self.tenant.LicenseFile_ID?c3.service.getLicenseFiles(self.tenant.LicenseFile_ID).expand("LicenseServer").query(function(e){self.licenseServerTitle.text(localizedString("WIZARD_HU_LIVSVR")+": "+e.data.LicenseServer.Name),self.hwKeyTitle.text(localizedString("COLUMN_HW_KEY")+": "+parse(e.data.LicenseServer.HardwareKey)),self.systemNoTitle.text(localizedString("TNT_LICMGT_COLUMN_SYSTEMNO")+": "+parse(e.data.SystemNumber)),self.installationNoTitle.text(localizedString("TNT_LICMGT_COLUMN_INSTALLNO")+": "+parse(e.data.InstallationNumber))}):(self.licenseServerTitle.empty(),self.hwKeyTitle.empty(),self.systemNoTitle.empty(),self.installationNoTitle.empty())}function onUsersRowSelected(e){self.btnDelete.attr({disabled:0}),self.tenant.Purpose!=="Trial"&&self.btnAssign.attr({disabled:0}),selectedUserIndex=e,selectedUser=self.usersData[e],self.btnChangeUser.removeAttr("disabled")}this.base=c3.module,this.base();var id="tenant_detail",container=$("<section>").attr({id:id}).addClass("tab"),title="Tenant Details",tabHeadTxt=[localizedString("MISC_CONFIGURATION"),localizedString("TNT_LICMGT_TAB_TLT"),localizedString("USERMGR"),localizedString("EXTENSIONS")],self=this,title_prefix=localizedString("CUSTOMER"),page=0,pageSize=5,selectedCompanyDB=null,selectedCompanyIndex=0,selectedUser=null,selectedUserIndex=0;parent=arguments[0]||{};var selectedExtension=null,selectedExtensionIndex=0;this._container=container,this.onInit=function(){self.detailTitle=$("<h1>").append(title),container.append(self.detailTitle),container.append(createTabHead()),container.append(createTabBody()),self.enableGetTip4User=!1;var e=$("#"+id+">.detail_tab_header a").c3tab("#"+id+">.detail_tab_body>section",{});e.onSelectEvent.push(function(e,t){e==tabHeadTxt.indexOf(localizedString("TNT_LICMGT_TAB_TLT"))&&self.reloadLicenseManagement()}),self.navTab=e,e.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.SBOUserBindings,function(e){self.reloadUser()}),cometdManager.subscribe(sldEntitySet.Users,function(e){self.reloadUser()})},this.refreshTitle=function(e){self.detailTitle.text(title)},this.bindData=function(t){self.dataform.submit=function(e){var t={};for(var n in e)n=="SBOSharedFolder_URI"?t.SBOSharedFolder={newID:parseInt(e[n]),oldID:i.SBOSharedFolder_ID,ID:parseInt(e[n])}:t[n]=e[n];var r=checkValidityBeforeSubmit(e,this.getDataSource());if(r&&r!==""){alert(r);return}var i=this.getDataSource();if(e.Purpose&&e.Purpose!=i.Purpose){var s=MessageBox.confirm({msg:localizedString("COMFIRMATION_UPDATE_TENANT_PURPOSE")});s.yesEvent.push(function(){updateTenant(e,i,t)})}else updateTenant(e,i,t);return!0};var n=self.dataform.getControl("extendTrial").parent();n.hide();var r=parent.getSelectedItem();if(r)if(r.Purpose!=="Trial"){var i=self.dataform.getControl("trialPeriod").parent();i.hide()}else{self.dataform.getControl("trialPeriod").css({width:"60px"});var i=self.dataform.getControl("trialPeriod").parent(),s=i.find("#suffixation");s[0]||i.append($("<label>").attr({id:"suffixation"}).append("&nbsp;"+localizedString("MISC_DAY"))),i.show(),self.rmDays=self.dataform.getControl("remainingDays"),$(self.rmDays).css({width:"60px"}),i=self.dataform.getControl("remainingDays").parent(),s=i.find("#suffixation"),s[0]||i.append($("<label>").attr({id:"suffixation"}).append("&nbsp;"+localizedString("MISC_DAY"))),i.show()}if(t!=null){var o={success:function(e){t.TrialPeriod=e.data.GetTrialPeriod,self.dataform.setDataSource(t),self.dataform.dataBind(),self.dataform.changeMode(0),getLastPreupgradeResult()},error:function(){}};t&&t.Purpose==="Trial"&&t.CompanyDatabase_ID!=null?c3.service.getTrialPeriod(t.CompanyDatabase_ID).query(o):(self.dataform.setDataSource(t),self.dataform.dataBind(),self.dataform.changeMode(0),getLastPreupgradeResult())}else self.dataform.setDataSource({}),self.dataform.dataBind();c3.service.getTenantStatus(function(e){self.statusData.clear();for(var t=0;t<e.data.length;t++)self.statusData.push({text:e.data[t],value:e.data[t]})}),c3.service.getTenantPurpose(function(e){self.purposeData.clear();for(var t=0;t<e.data.length;t++)self.purposeData.push({text:e.data[t],value:e.data[t]})}),self.tenant=t,parent.getSelectedItem()&&parent.getSelectedItem().ServiceUnit_ID?(enableControls(),parent.getSelectedItem().UPTaskID>0?self.dataform.disableEdit():self.dataform.enableEdit()):(disableControls(),parent.getSelectedItem()!=null&&parent.getSelectedItem().TaskStatus=="WaitingForApproval"&&self.dataform.disableEdit()),self.authenticatin.clear(),self.authenticatin.push({text:localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN"),value:localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")}),self.authenticatin.push({text:localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN"),value:localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")}),this.reloadUser(),this.reloadExtensions()},this.getLicenseModules=function(){return self.licenseModules},this.getUsers=function(){return self.usersData},this.getTenant=function(){return self.tenant},this.reloadLicenseManagement=function(){self.loadingWin==null&&(self.loadingWin=new loadingWindow),self.loadingWin.show(),self.tenant&&self.tenant.Purpose==="Trial"&&self.btnImportLicense.attr({disabled:!0});if(self.tenant!=null&&self.tenant.LicenseFile_InstallationNumber!=null){var e={success:this.bindLicensesData,error:function(){self.loadingWin!=null&&self.loadingWin.close()}};c3.service.getLicenseModulesPerCustomer(self.tenant.LicenseFile_ID,self.tenant.Customer_ID).query(e)}else{var t={};t.data=[],this.bindLicensesData(t)}},this.bindLicensesData=function(e){var t=e.data,n=[];for(var r=0;r<t.length;r++)t[r].Used=t[r].Total-t[r].Available,t[r].IsExpired?t[r].Status="Expired":t[r].Status="Available",n.push(t[r]);self.licenseModules=t,self.licensesData=n,self.licensesDataGrid.reload(),onLicensesRowSelected(0),self.loadingWin!=null&&self.loadingWin.close()},this.reloadUser=function(){self.tenant&&self.tenant.Purpose==="Trial"&&self.btnAssign.attr({disabled:!0}),self.tenant!=null&&(self.tenant.TaskID===undefined||self.tenant.TaskID<=0)&&tenantManager.loadTenantUsers(self.tenant,self.bindUsersData)},this.bindUsersData=function(){self.tenant&&self.tenant.Users?self.usersData=self.tenant.Users:self.usersData=[],self.enableGetTip4User=!0,self.usersDataGrid.reload(),self.enableGetTip4User=!1,self.usersData.length>0?onUsersRowSelected(0):(self.btnDelete.attr({disabled:1}),self.btnAssign.attr({disabled:1}),self.btnChangeUser.attr({disabled:1})),self.loadingWin!=null&&self.loadingWin.close()},this.unbindUserData=function(){self.usersData=[],self.usersDataGrid.reload(),self.btnDelete.attr({disabled:1}),self.btnAssign.attr({disabled:1}),self.btnChangeUser.attr({disabled:1})},this.reloadExtensions=function(){if(self.tenant!=null&&self.tenant.ID!=null&&self.tenant.CompanyDatabase_ID)tenantManager.getExtensionByCompanyDB(self.tenant.CompanyDatabase_ID,this.bindExtensionsData);else{var e={};e.data=[],this.bindExtensionsData(e)}c3ModuleManager.notifyMessage(new c3Message("RefreshExtensionUsedByTenants"))},this.bindExtensionsData=function(e){self.extData=e.data,self.extDataGrid.reload(),self.btnRemoveExtension.attr({disabled:1}),self.btnConfig.hide(),self.loadingWin!=null&&self.loadingWin.close()}},c3customer.detail=function(){function p(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function d(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");return t.append(v()),t.append(b()),t.append(T()),t.append(N()),t}function v(){var t=e+"_profile",n=$("<section>").attr({id:t}),r=[];i.statusData=[],i.typeData=[];var s=[{id:"id",text:localizedString("SU_EXT_COLUMN_ID"),binding:"ID",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"name",text:localizedString("COLUMN_MSSQL_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"type",text:localizedString("MISC_TYPE"),binding:"Type",type:"label",readonly:!0,"class":"chrome2",editable:!1,editSetting:{controlType:"select",data:i.typeData}},{id:"country",text:localizedString("CUSTOMER_COLUMN_COUNTRY"),binding:"Country",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"contactPerson",text:localizedString("COLUMN_CONTACTPERSON"),binding:"ContactPerson",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"phone",text:localizedString("CUSTOMER_COLUMN_PHONE"),binding:"Phone",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"email",text:localizedString("CUSTOMER_COLUMN_EMAIL"),binding:"Email",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"location",text:localizedString("CUSTOMER_COLUMN_LOCATION"),binding:"Location",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"creationDate",text:localizedString("COLUMN_CREATE_DATE"),binding:"CreationDate",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("MISC_DESCRIPTION"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",controlClass:"value",rows:2,editable:!0},{id:"id",text:localizedString("CUSTOMERCREATION_LABEL_EMPLOYEECOUNT"),binding:"EmployeeCount",type:"label",readonly:!0,"class":"chrome2",editable:!1}];r.push(s);var o={getColumns:function(){return r},getViewContent:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}else if(this.colName=="Type")this.data[this.colName]=="TrialCustomer"&&(e=$("<label>").append(localizedString("CUSTOMER_CELL_TRIALCUSTOMER")).attr({title:"Trial Customer"}));else if(this.colName=="CreationDate"){if(this.data[this.colName]){var n=convertToDate(this.data[this.colName]).timeString();e=$("<label>").append(n).attr({title:n})}}else if(this.colName=="EmployeeCount"&&this.data[this.colName]!=null&&this.data[this.colName].toString()=="0")return $("<label>").html("");return e}},u=$(n).dataform({delegate:o});i.dataform=u;var a=i.dataform.getToolbar(),f=a.edit.parent(".tools"),l=$("<input>").attr({value:localizedString("CGLIC_BTN_CG"),type:"button",id:"cglic"});return f&&f.append($("<span>").addClass("split")).append(l),i.btnChangeLicfile=l,l.click(function(){var e=new c3changeLicenseFile(i,h.getSelectedItem(),h,0);e.show()}),n}function m(e){var t=h.getSelectedItem(),n=new c3newTenant(e,!1,t,!0);n.show()}function g(){i.btnChangeLicfile.removeAttr("disabled"),i.btnAddUser.removeAttr("disabled"),i.btnNewTenant.removeAttr("disabled")}function y(){i.btnNewTenant.attr({disabled:1}),i.btnAddUser.attr({disabled:1}),i.btnDeleteTenant.attr({disabled:1}),i.btnDeleteUser.attr({disabled:1}),i.btnChangeLicfile.attr({disabled:1}),i.btnActive.attr({disabled:1})}function b(){var t=e+"_tenant",n=$("<section>").attr({id:t}),r="New",s="Delete",o=t+"_toolbar",u=$("<div>").addClass("tools").attr({id:o}),l=$("<input>").attr({value:r,type:"button",id:o+"btnNewTenant"}).click(function(){h.getSelectedItem()&&m(i),i.loadingWin.close()}),c=$("<input>").attr({value:s,type:"button",id:o+"btnDelete"}).click(function(){if(h.getSelectedItem())if(a!=null){var e=localizedString("TENANT"),t=$("<div>").append(String.format(localizedString("RES_MISC_DELETE_CONFIRM"),e)),n=$("<input>").attr({type:"checkbox"}),r=$("<span>").append(localizedString("RESPOOL_CMDB_DLT_RELATEDDB"));r.bind("click",function(){n.attr("checked")==1?n.attr({checked:!1}):n.attr({checked:!0}),w(n)}),n.click(function(){w(this)}),t.append($("<br>")).append($("<br>")).append(n).append(r);var s=MessageBox.confirm({msg:t});s.yesEvent.push(function(){var e={};e.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),i.reloadTenant()),f=-1};if(a){var t={ID:a.ID},r=n.attr("checked"),s={DeleteDB:r};e.params=s,c3.service.deleteTenant(t,e)}})}else alert(localizedString("RESPOOL_IMPL_REPY_TIPMSG_PREFIX")+e+" .")});i.btnNewTenant=l,i.btnNewTenant.attr({disabled:1}),i.btnDeleteTenant=c,i.btnDeleteTenant.attr({disabled:1});var p=$("<a>").attr({href:"#",id:"btnRefresh_"+t,title:"Refresh"}).addClass("refresh");p.click(function(){i.reloadTenant()}),u.append(i.btnNewTenant).append($("<span>").addClass("split")).append(i.btnDeleteTenant),u.append($("<div>").css({"float":"right","margin-left":"10px"}).append(p)),n.append(u),i.tenantToolbar=u;var d=$("<section>").attr({id:t+"_grid"}),v=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"CompanyDatabase_CompanyName",description:localizedString("TENANT"),type:"text",width:"15%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"15%"},{name:"ServiceUnit_Name",description:localizedString("HOSTUNIT"),type:"text",width:"15%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"15%"},{name:"Description",description:localizedString("MISC_DESCRIPTION"),type:"text",width:"36%"}];i.TenantData=[];var g={getHeaderSpec:function(){return v},getRowCount:function(){return i.TenantData.length},getRow:function(e){return i.TenantData[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return f},getTip:function(){return Utility.CreateTipBoard(localizedString("TENANT"),function(){h.getSelectedItem()&&m(i)})},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}},y=$(d).gridview({delegate:g});return y.show(),y.rowSelectedEvent.push(function(){M(this.index)}),i.TenantDataGrid=y,n.append(d),n}function w(e){if($(e).attr("checked")==1){var t=$("<div>");t.html(localizedString("TNT_DELETE_DELETEDB_CONFIRM")+"<br/>");var n=MessageBox.confirm({msg:t,width:400,height:150});n.noEvent.push(function(){$(e).attr("checked",!1)})}}function E(t){var n=e+"_tenant"+"_toolbar";i.tenantToolbar.find("#"+n+"_div_selectHU").remove();var r=$("<div>").attr({id:n+"_div_selectHU"}),s=$("<label>").append("View: "),o=$("<select>").attr({id:n+"_selectHU"}),u=$("<option>").attr({id:n+"_optSelectHU_All",value:"All",title:localizedString("CUSTOMER_TENANTMGT_SELECT_ALL")}).append(localizedString("CUSTOMER_TENANTMGT_SELECT_ALL"));o.append(u);for(var a=0;a<t.data.length;a++){var f=t.data[a].Name;f!=null&&f.length>50&&(f=f.substring(0,50)+"..."),u=$("<option>").attr({id:n+"_optSelectHU_"+t.data[a].ID,value:t.data[a].ID,title:t.data[a].Name}).append(f),o.append(u)}o.bind("change",function(){S($(this).val())}),r.append(s),r.append(o),r.css({"float":"right"}),i.tenantToolbar.append(r)}function S(e){i.customer.ID&&i.customer.ID>0&&(e=="All"?c3.service.getTenants().filter("Customer/ID eq "+i.customer.ID).expand("ServiceUnit,CompanyDatabase").query(i.bindTenantData):c3.service.getTenants().filter("Customer/ID eq "+i.customer.ID+" and ServiceUnit/ID eq "+e).expand("ServiceUnit,CompanyDatabase").query(i.bindTenantData))}function x(){var e=new c3addSystemUser(i,0,null,!1,"customer");e.finishEvent.push(function(){var t=e.User,n={success:function(e,t){var n=i.selectTenantView.val();A(n)},error:function(e,t){var n=i.selectTenantView.val();A(n)}};customerManager.createCustomerUser(i.customer.ID,t,n)}),e.show()}function T(){var t=e+"_userManagement",n=$("<section>").attr({id:t}),r=localizedString("MISC_ADD"),s=localizedString("MISC_REMOVE"),o=t+"_toolbar",u=$("<div>").addClass("tools").attr({id:o}),a=$("<input>").attr({value:r,type:"button",id:o+"_btnAddUser",disabled:1}),f=$("<input>").attr({value:localizedString("STATUS_ACTIVE"),type:"button",id:o+"_btnActiveUser",disabled:1}),p=$("<input>").attr({value:s,type:"button",id:o+"_btnDelete",disabled:1}),d=$("<a>").attr({href:"#",id:"btnRefresh_"+t,title:"Refresh"}).addClass("refresh");d.click(function(){var e=i.selectTenantView.val();A(e)}),f.click(function(){var e=$("<div>"),t=$(this).val();e.html(String.format(localizedString("USERMGT_CONFIRM_CHANGESTATUS"),t)+"<br/>");var n=MessageBox.confirm({msg:e,width:400,height:150});n.yesEvent.push(function(){var e={success:function(e,t){var n=i.selectTenantView.val();A(n)},error:function(e,t){var n=i.selectTenantView.val();A(n)}},n={};n.ID=l.Id,n.Status=t,c3.service.updateUser(n,e)})}),i.btnAddUser=a,i.btnDeleteUser=p,i.btnActive=f;var v=localizedString("USER");a.click(function(){h.getSelectedItem()&&x(i)}),p.click(function(){if(l!=null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_REMOVE_CONFIRM"),v));e.yesEvent.push(function(){var e={};e.success=function(e){var t=i.selectTenantView.val();A(t),c=-1},e.error=function(e){},c3.service.deleteCustomerUser(l.Id,i.customer.ID).query(e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),v))}),u.append(a),u.append($("<span>").addClass("split")),u.append(f),u.append(p);var m=new searchbox({inputCallback:function(e){return i.usersDataGrid.searchText(e)}}),g=(new Split({permissions:[permissionItems.operator]})).dom;u.append($("<div>").css({"float":"right","margin-left":"10px"}).append(g.css({"float":"left"})).append(m.css({"float":"left"})).append(d)),n.append(u),i.userToolbar=u;var y=$("<section>").attr({id:t+"_grid"});return i.UserTableContainer=y,k(),n.append(y),n}function N(){var t=e+"_LicenseQuota",n=$("<section>").attr({id:t}),r=$("<section>").attr({id:t+"_grid"}),s=[{name:"Description",description:localizedString("RESPOOL_LICSERVER_COLUMN_LICTYPE"),type:"text",width:"20%"},{name:"StartDate",description:localizedString("COLUMN_CREATE_DATE"),type:"text",width:"20%"},{name:"ExpirationDate",description:localizedString("RESPOOL_LICSERVER_COLUMN_EXPIREDDATE"),type:"text",width:"20%"},{name:"Available",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"20%"},{name:"QuotaSetting",description:localizedString("COLUMN_QUOTASETTING"),type:"text",width:"25%"}];i.LicenseQuotaData=[];var o={getHeaderSpec:function(){return s},getRowCount:function(){return i.LicenseQuotaData.length},getRow:function(e){return i.LicenseQuotaData[e]},getGridHeight:function(){return 165},getCell:function(){if(this.colName=="StartDate"||this.colName=="ExpirationDate"){var e=this.data[this.colName];return convertToDate(e).dateString()}if(this.colName=="QuotaSetting"&&c3.hasPermission([permissionItems.operator])){var t=this,n={},r=t.data,s=$("<div>").addClass("statusControl");n.ID=r.ID;var o=$("<div>").addClass("td_editproperty").text(r.QuotaSetting).attr({title:r.QuotaSetting}),u=new textbox;r.QuotaSetting==localizedString("UNLIMTIED")&&(r.QuotaSetting="");var a=u.attr({value:r.QuotaSetting,width:"20px"}),f=$("<select>").bind("change",function(e){}),l={};l.success=function(e){i.reloadLicenseModule()},l.error=function(){i.loadingWin.close()};var c=$("<label>").attr({title:localizedString("MISC_SAVE")}).addClass("ShowIcon Save").click(function(){if(isNaN(u.val().trim())==1){u.showErrorMessage(localizedString("QUOTANUMBER_PROPERTY_VALUE_EMPTY_WARNING_MSG"));return}n.QuotaSetting=u.val().trim(),i.loadingWin.show(),c3.service.updateQuota(i.customer.ID,r.Type,n.QuotaSetting,l)}),h=$("<label>").attr({title:localizedString("MISC_CANCEL")}).addClass("ShowIcon Cancel").click(function(){m.hide(),v.show()}),p=$("<label>").addClass("ShowIcon Pen").attr({title:localizedString("MISC_EDIT")}).click(function(){u.attr({value:r.QuotaSetting}),m.show(),v.hide(),a.focus()}),d=$("<label>").attr({title:localizedString("MISC_RESET_TODEFAULT")}).addClass("ShowIcon ResetToDefault").click(function(){c3.service.ResetQuota(i.customer.ID,r.Type,l),i.loadingWin.show()}),v=$("<div>").css({"float":"left"}).append(o).append(p),m=$("<div>").css({"float":"left"}).attr({title:r.QuotaSetting});return m.append(d).append(a),m.append(c).append(h),m.hide(),s.append(v).append(m),s}return this.colName.trim()=="Available".trim()?this.data[this.colName]+"/"+this.data.Total:null}},u=$(r).gridview({delegate:o,undraggable:!0});return u.show(),i.LicenseQuotaDataGrid=u,n.append(r),n}function C(){var e=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"10%"},{name:"B1UserName",description:localizedString("COLUMN_B1USERNAME"),type:"text",width:"10%"},{name:"B1UserType",description:localizedString("COLUMN_USERTYPE"),type:"text",width:"10%"},{name:"LicenseAssigns",description:localizedString("CUSTOMER_LABEL_ASSIGNEDLIC"),type:"text",width:"66%"}];i.usersData=[];var t={getHeaderSpec:function(){return e},getRowCount:function(){return i.usersData.length},getRow:function(e){return i.usersData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getTip:function(){return Utility.CreateTipBoard(localizedString("RESPOOL_LICSERVER_USERMGT_EMPTY_TIPMSG"),null,!0)},getDefaultSelectedIndex:function(){return 0},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}};if(!i.usersDataGrid){var n=$(i.UserTableContainer).gridview({delegate:t});n.rowSelectedEvent.clear(),i.usersDataGrid=n}else i.usersDataGrid.rowSelectedEvent.clear(),i.usersDataGrid.reset({delegate:t});i.usersDataGrid.show()}function k(){var e=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"96%"}];i.usersData=[];var t={getHeaderSpec:function(){return e},getRowCount:function(){return i.usersData.length},getRow:function(e){return i.usersData[e]},getGridHeight:function(){return Utility.DetailTableHeight},getTip:function(){return Utility.CreateTipBoard(localizedString("USER"),function(){h.getSelectedItem()&&x(i)})},getDefaultSelectedIndex:function(){return 0},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}};if(!i.usersDataGrid){var n=$(i.UserTableContainer).gridview({delegate:t});n.rowSelectedEvent.push(function(){D(this.index)}),i.usersDataGrid=n}else i.usersDataGrid.rowSelectedEvent.clear(),i.usersDataGrid.rowSelectedEvent.push(function(){D(this.index)}),i.usersDataGrid.reset({delegate:t});i.usersDataGrid.show()}function L(t){var n=e+"_userManagement"+"_toolbar";i.userToolbar.find("#"+n+"_div_selectTenant").remove();var r=$("<div>").attr({id:n+"_div_selectTenant"}),s=$("<label>").append("View: "),o=$("<select>").attr({id:n+"_selectTenant"});i.selectTenantView=o;var u=$("<option>").attr({id:n+"_optSelectTenant_All",value:"All",title:localizedString("CUSTOMER_USERMGT_SELECT_ALL")}).append(localizedString("CUSTOMER_USERMGT_SELECT_ALL"));o.append(u);for(var a=0;a<t.data.length;a++){var f=t.data[a].CompanyDatabase.CompanyName;f!=null&&f.length>50&&(f=f.substring(0,50)+"..."),u=$("<option>").attr({id:n+"_optSelectTenant_"+t.data[a].ID,value:t.data[a].ID,title:t.data[a].Name}).append(f),o.append(u)}o.bind("change",function(){A($(this).val())}),r.append(s),r.append(o),r.css({"float":"right"}),i.userToolbar.append(r)}function A(e){e=="All"?(k(),i.customer&&i.customer.Group_ID&&c3.service.getUsersByGroup(i.customer.Group_ID).expand("User").query(i.bindCustomerUserData)):(C(),i.btnDeleteUser.attr({disabled:!0}),i.btnAddUser.attr({disabled:!0}),i.btnActive.attr({disabled:1}),i.tenant={},i.tenant.ID=e,i.loadingWin.show(),tenantManager.loadTenantUsers(i.tenant,i.bindTenantUsersData))}function O(e,t){var n="";if(e){if(e.Email&&e.Email!==""){var r=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,i=r.test(e.Email);i||(n+=localizedString("TNT_CREATION_EMAIL_VALID"))}if(e.Phone&&e.Phone!==""){var s=/^(\+\d{2,3} )*[\d]+(-[\d]+)*$/;isPhone=s.test(e.Phone),isPhone||(n+=localizedString("TNT_CREATION_PHONE_VALID"))}}return n}function M(e){a=i.TenantData[e],f=e,i.btnDeleteTenant.attr({disabled:0})}function _(){if(h.getSelectedItem()&&h.getSelectedItem().ID)c3.service.getTenants().filter("Customer/ID eq "+h.getSelectedItem().ID).expand("CompanyDatabase").query(L);else{var e={data:[]};L(e)}}function D(e){i.btnDeleteUser.attr({disabled:0}),i.btnActive.attr({disabled:0}),c=e,l=i.usersData[e],l.Status=="Active"?i.btnActive.val(localizedString("STATUS_INACTIVE")):i.btnActive.val(localizedString("STATUS_ACTIVE"))}this.base=c3.module,this.base();var e="customer_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=localizedString("CUSTOMER_DETAILS_TLT"),r=[localizedString("MISC_CONFIGURATION"),localizedString("CUSTOMER_DETAILS_TAB2_TITLE"),localizedString("CUSTOMER_DETAILS_TAB3_TITLE"),localizedString("CUSTOMER_DETAILS_TAB4_TITLE")],i=this,s=localizedString("CUSTOMER"),o=0,u=5,a=null,f=0,l=null,c=0,h=arguments[0]||{};this._container=t,this.onInit=function(){i.detailTitle=$("<h1>").append(n),t.append(i.detailTitle),t.append(p()),t.append(d());var s=new loadingWindow;i.loadingWin=s;var o=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});o.onSelectEvent.push(function(e,t){e==r.indexOf(localizedString("CUSTOMER_DETAILS_TAB4_TITLE"))&&(i.customer!=null&&i.customer.InstallationNumber!="-1"&&typeof i.customer.InstallationNumber!="undefined"?i.reloadLicenseModule():(i.LicenseQuotaData={},i.LicenseQuotaDataGrid.reload()))}),i.navTab=o,o.select(0)},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.Tenants,function(e){i.reloadTenant(),i.loadTenantView()}),cometdManager.subscribe(sldEntitySet.Users,function(e){i.reloadUser();var t=i.selectTenantView.val();i.loadUsersByTenant(t)})},this.refreshTitle=function(e){i.detailTitle.text(n)},this.loadUsersByTenant=A,this.bindData=function(t){i.btnDeleteTenant.attr({disabled:1}),i.dataform.submit=function(e){var t=O(e,this.getDataSource());if(t&&t!==""){alert(t);return}var n={};return n.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),h.reload())},c3.service.updateCustomer(e,n),!0},t==null?(i.dataform.setDataSource({}),i.dataform.dataBind()):(i.dataform.setDataSource(t),i.dataform.dataBind(),i.dataform.changeMode(0)),i.statusData.clear(),c3.service.getCustomerStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})}),i.typeData.clear(),c3.service.getCustomerType(function(e){for(var t=0;t<e.data.length;t++)e.data[t]==="TrialCustomer"?i.typeData.push({text:localizedString("CUSTOMER_CELL_TRIALCUSTOMER"),value:e.data[t]}):i.typeData.push({text:e.data[t],value:e.data[t]})}),i.customer=t,h.getSelectedItem()&&h.getSelectedItem().Group_ID?g():y(),i.customer?i.customer&&i.customer.Type=="TrialCustomer"?i.btnChangeLicfile.attr({disabled:!0}):i.btnChangeLicfile.attr({disabled:!1}):i.btnChangeLicfile.attr({disabled:1}),h.getSelectedItem()!=null&&h.getSelectedItem().TaskStatus=="WaitingForApproval"&&(i.dataform.disableEdit(),i.btnChangeLicfile.attr({disabled:!0})),this.reloadTenant(),this.reloadUser()},this.reloadTenant=function(){if(i.customer&&i.customer.ID)c3.service.getTenants().filter("Customer/ID eq "+i.customer.ID).expand("ServiceUnit,CompanyDatabase").query(i.bindTenantData);else{var e={};e.data=[],this.bindTenantData(e)}c3.service.getHostingUnits().query(E)},this.getUsers=function(){return i.usersData},this.bindTenantData=function(e){e.data&&(i.TenantData=c3.service.convertData(e.data),i.TenantDataGrid.reload(),i.TenantData.length>0&&M(f),i.customer&&i.customer.Type==="TrialCustomer"?i.TenantData.length>=1?i.btnNewTenant.attr({disabled:!0}):i.btnNewTenant.removeAttr("disabled"):i.btnNewTenant.removeAttr("disabled")),h.getSelectedItem()!=null&&h.getSelectedItem().TaskStatus=="WaitingForApproval"&&i.btnNewTenant.attr({disabled:!0}),i.loadingWin.close()},this.reloadLicenseModule=function(){i.loadingWin.show(),c3.service.getLicenseFiles().filter("InstallationNumber eq '"+i.customer.InstallationNumber+"'").query(i.bindLicenseModuleData)},this.bindLicenseModuleData=function(e){var t={success:function(e){i.customer.ID!==undefined&&c3.service.getLicenseQuotas().filter("Customer/ID eq "+i.customer.ID).query(function(t){for(var n=0;n<e.data.length;n++){e.data[n].QuotaSetting=localizedString("UNLIMTIED");for(var r=0;r<t.data.length;r++)e.data[n].Type==t.data[r].ModuleName&&(e.data[n].QuotaSetting=t.data[r].QuotaNumber)}var s=c3.service.convertData(e.data);i.LicenseQuotaData=s,i.LicenseQuotaDataGrid.reload(),i.loadingWin.close()})},error:function(){i.loadingWin.close()}};e.data.length>0&&i.customer.ID!==undefined?c3.service.getLicenseModulesPerCustomer(e.data[0].ID,i.customer.ID).query(t):(i.LicenseQuotaData={},i.LicenseQuotaDataGrid.reload(),i.loadingWin.close())},this.reloadUser=function(){i.loadingWin.show();if(i.customer&&i.customer.Group_ID)c3.service.getUsersByGroup(i.customer.Group_ID).expand("User").query(this.bindCustomerUserData);else{var e={};e.data=[],this.bindCustomerUserData(e)}_()},this.loadTenantView=_,this.bindCustomerUserData=function(e){if(e.data){var t=[];for(var n=0;n<e.data.length;n++){var r={Id:e.data[n].ID,Status:e.data[n].Status,Name:e.data[n].SystemUsername};t.push(r)}i.usersData=t}else i.usersData=[];i.usersDataGrid.reload(),i.usersData.length>0?(i.btnDeleteUser.attr({disabled:!1}),i.btnAddUser.attr({disabled:!1}),D(0)):(i.btnAddUser.attr({disabled:!1}),i.btnDeleteUser.attr({disabled:1}),i.btnActive.attr({disabled:1})),h.getSelectedItem()!=null&&h.getSelectedItem().TaskStatus=="WaitingForApproval"&&i.btnAddUser.attr({disabled:!0}),i.loadingWin.close()},this.bindTenantUsersData=function(){i.loadingWin.close(),i.tenant&&i.tenant.Users?i.usersData=i.tenant.Users:i.usersData=[],i.usersDataGrid.reload()},this.reinitializeUserGrid=function(){k()}},function(){"use strict";var e={master:{toolbars:[{left:[{type:"button",value:localizedString("MISC_NEW"),commands:{click:"createResellerCommand"},permissionItems:[]},{type:"split"},{type:"button",value:localizedString("BUTTON_HU_DELETE"),bindings:{disabled:"cannotDeleteReseller"},commands:{click:"deleteResellerCommand"},permissionItems:[]}],right:[{type:"refresh",commands:{click:"onLoaded"}}]}],content:{type:"gridview",header:[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"Country",description:localizedString("CUSTOMER_COLUMN_COUNTRY"),type:"text",width:"10%"},{name:"Location",description:localizedString("CUSTOMER_COLUMN_LOCATION"),type:"text",width:"10%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"10%"},{name:"Phone",description:localizedString("CUSTOMER_COLUMN_PHONE"),type:"text",width:"10%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"46%"}],bindings:{datasource:"masterDataSource"},commands:{onRowSelected:"masterRowSelected"},empty:{text:localizedString("MISC_NEW"),command:"createResellerCommand"},getCell:"masterGetCell",getTotalCount:"mastergetTotalCount",gridKey:"ID"}},details:{title:localizedString("RESPOOL_RESELLER_DETAIL_TLT"),tabs:[{title:"Configuration",toolbars:[],content:{type:"dataform",fields:[{id:"id",text:localizedString("SU_EXT_COLUMN_ID"),binding:"ID",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"name",text:localizedString("COLUMN_MSSQL_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:[{text:"Online",value:"Online"},{text:"Offline",value:"Offline"}]}},{id:"country",text:localizedString("CUSTOMER_COLUMN_COUNTRY"),binding:"Country",type:"text",readonly:!0,"class":"chrome2",editable:!0},{id:"contactPerson",text:localizedString("COLUMN_CONTACTPERSON"),binding:"ContactPerson",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"phone",text:localizedString("CUSTOMER_COLUMN_PHONE"),binding:"Phone",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"email",text:localizedString("CUSTOMER_COLUMN_EMAIL"),binding:"Email",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"location",text:localizedString("CUSTOMER_COLUMN_LOCATION"),binding:"Location",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"creationDate",text:localizedString("COLUMN_CREATE_DATE"),binding:"CreationDate",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("MISC_DESCRIPTION"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",controlClass:"value",rows:2,editable:!0},{id:"id",text:localizedString("CUSTOMERCREATION_LABEL_EMPLOYEECOUNT"),binding:"EmployeeCount",type:"label",readonly:!0,"class":"chrome2",editable:!1}],bindings:{datasource:"selectedDataItem"},commands:{submit:"submitDetail"},getViewContent:"dataformGetViewContent"}},{title:localizedString("HOSTUNITS"),toolbars:[{left:[{type:"button",value:localizedString("RESELLER_ASSIGN"),bindings:{disabled:"cannotAssign"},commands:{click:"assignServiceUnits"}},{type:"button",value:localizedString("RESELLER_UNASSIGN"),bindings:{disabled:"cannotUnassignSU"},commands:{click:"unassignServiceUnits"}}],right:[]}],content:{type:"gridview",header:[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"15%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"10%"},{name:"Version",description:localizedString("MISC_VERSION"),type:"text",width:"10%"},{name:"TenantCount",description:localizedString("HU_GD_TENANTCOUNT"),type:"text",width:"15%"},{name:"Description",description:localizedString("MISC_DESCRIPTION"),type:"text",width:"46%"}],bindings:{datasource:"SUs",selectedDataItem:"SelectedSU"},commands:{},getCell:"suGridGetCell"}},{title:localizedString("CUSTOMERS"),toolbars:[{left:[{type:"button",value:localizedString("RESELLER_ASSIGN"),bindings:{disabled:"cannotAssign"},commands:{click:"assignCustomer"}},{type:"button",value:localizedString("RESELLER_UNASSIGN"),bindings:{disabled:"cannotUnassignCustomer"},commands:{click:"unAssignCustomer"}}],right:[]}],content:{type:"gridview",header:[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"8%"},{name:"Country",description:localizedString("CUSTOMER_COLUMN_COUNTRY"),type:"text",width:"10%"},{name:"Location",description:localizedString("CUSTOMER_COLUMN_LOCATION"),type:"text",width:"10%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"10%"},{name:"Phone",description:localizedString("CUSTOMER_COLUMN_PHONE"),type:"text",width:"10%"},{name:"InstallationNumber",description:localizedString("RES_LIC_INSTALLATION_NUM"),type:"text",width:"12%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"26%"}],bindings:{datasource:"Customers",selectedDataItem:"SelectedCustomer"},commands:{},getCell:"customerGridGetCell"}},{title:localizedString("RES_LIC_LICENSE_FILES"),toolbars:[{left:[{type:"button",value:localizedString("RESELLER_ASSIGN"),bindings:{disabled:"cannotAssign"},commands:{click:"assignLicFile"}},{type:"button",value:localizedString("RESELLER_UNASSIGN"),bindings:{disabled:"cannotUnassignLicFile"},commands:{click:"unAssignLicFile"}}],right:[]}],content:{type:"gridview",header:[{name:"InstallationNumber",description:localizedString("COLUMN_INSTALL_NO"),type:"text",width:"25%"},{name:"LicenseServer_Name",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"20%"},{name:"SystemNumber",description:localizedString("COLUMN_SYS_NO"),type:"text",width:"20%"},{name:"Localization",description:localizedString("MISC_LOCATION"),type:"text",width:"20%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"15%"},{name:"Reseller",description:localizedString("RESPOOL_RESELLER_TLT"),type:"text",width:"10%"}],bindings:{datasource:"Licenses",selectedDataItem:"SelectedLicFile"},commands:{},getCell:""}},{title:localizedString("RES_SHARED_FOLDER"),toolbars:[{left:[{type:"button",value:localizedString("TENANT_EXTENSION_ASSIGN"),bindings:{},commands:{click:"registerStorage"}},{type:"button",value:localizedString("TENANT_EXTENSION_UNASSIGN"),bindings:{disabled:"cannotUnregister"},commands:{click:"unregisterStorage"}}],right:[]}],content:{type:"gridview",header:[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"5%"},{name:"Path",description:localizedString("COLUMN_STORAGE_PATH"),type:"text",width:"60%"},{name:"Type",description:localizedString("COLUMN_STORAGE_TYPE"),type:"text",width:"35%"}],bindings:{datasource:"Storage",selectedDataItem:"SelectedStorage"},commands:{},getCell:"userGridGetCell"}},{title:localizedString("RESELLER_AUTHS"),toolbars:[{left:[{type:"button",value:localizedString("TENANT_EXTENSION_ASSIGN"),bindings:{disabled:"canNotAssignAuthsToReseller"},commands:{click:"assignAuthsToReseller"}},{type:"split"},{type:"button",value:localizedString("TENANT_EXTENSION_UNASSIGN"),bindings:{disabled:"canNotUnassignAuthsToReseller"},commands:{click:"unassignAuthsToReseller"}}],right:[]}],content:{type:"gridview",header:[{name:"TaskType",description:localizedString("RESELLER_CREATION_STEP3_COLUMN_OPT"),type:"text",width:"40%"},{name:"OperationType",description:localizedString("RESELLER_AUTH_COLUMN_STATUS"),type:"text",width:"20%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"40%"}],bindings:{datasource:"Auths",selectedDataItem:"SelectedAuthorization"},commands:{},getCell:"taskAuthGridGetCell"}},{title:localizedString("RESPOOL_RESELLER_OPERATOR_MNG"),toolbars:[{left:[{type:"button",value:localizedString("MISC_ADD"),bindings:{disabled:"cannotAssign"},commands:{click:"addUserToReseller"}},{type:"split"},{type:"button",bindings:{disabled:"cannotUnassignUser",value:"ActiveUserStatus"},commands:{click:"changeUserStatus"}},{type:"button",value:localizedString("MISC_REMOVE"),bindings:{disabled:"cannotUnassignUser"},commands:{click:"removeUser"}}],right:[]}],content:{type:"gridview",header:[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("RESPOOL_LICSERVER_USERMGT_SYSUSER"),type:"text",width:"96%"}],bindings:{datasource:"Users",selectedDataItem:"SelectedUser"},commands:{},getCell:"userGridGetCell"}}]}};window.respool=window.respool||{},window.respool.c3reseller=function(){function a(e){var t="";if(e){if(e.Email&&e.Email!==""){var n=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,r=n.test(e.Email);r||(t+=localizedString("TNT_CREATION_EMAIL_VALID"))}if(e.Phone&&e.Phone!==""){var i=/^(\+\d{2,3} )*[\d]+(-[\d]+)*$/,s=i.test(e.Phone);s||(t+=localizedString("TNT_CREATION_PHONE_VALID"))}}return t}var e=this,t={success:function(t){e.SUs=t.d.results,e.SUs.length===0&&(e.SelectedSU=undefined),e.stoploading()},error:function(){e.stoploading()}},n={success:function(t){e.Customers=t.d.results,e.Customers.length===0&&(e.SelectedCustomer=undefined),e.stoploading()},error:function(){e.stoploading()}},r={success:function(t){var n,r,i;e.Licenses=t.d.results,e.Licenses.length===0&&(e.SelectedLicFile=undefined),e.stoploading();for(n=0,r=t.d.results.length;n<r;n++){var s=function u(t){t.data.length===1&&(u.list[u.index].LicenseServer_Name=t.data[0].LicenseServer.Name,e.publish("Licenses",[u.list]))};s.list=e.Licenses,s.index=n,c3.service.getLicenseFiles().filter("ID eq "+t.d.results[n].ID).expand("LicenseServer").query(s);var o=function(t,n){return{success:function(r){if(r.d.results!==undefined&&r.d.results.length>0){var i="";for(var s=0;s<r.d.results.length;s++)i+=r.d.results[s].Name,s!=r.d.results.length-1&&(i+="; ");t[n].Reseller=i,e.publish("Licenses",[t])}},error:function(e){console.log(e)}}}(e.Licenses,n);c3.service.getAssigningResellers("License",t.d.results[n].ID,o)}}},i=function(t){e.stoploading();if(t.data){var n=[],r,i;for(r=0;r<t.data.length;r++)i={Id:t.data[r].ID,Status:t.data[r].Status,Name:t.data[r].SystemUsername},n.push(i);e.Users=n}},s=function(t,n){e.stoploading();var r=[];for(var i=0;i<n.data.length;i++)r.push({ID:n.data[i].ID,Description:n.data[i].Description,OperationType:"Unauthorized",TaskType:n.data[i].TaskType});if(t.data!=null&&t.data.length>0)for(var s=0;s<r.length;s++)for(var i=0;i<t.data.length;i++)if(r[s].ID==t.data[i].TaskType.ID){r[s].TaskAuthID=t.data[i].ID,r[s].OperationType=t.data[i].PermissionType;break}e.Auths=r},o=function(t){e.Storage=t,e.Storage.length===0&&(e.SelectedStorage=undefined),e.stoploading()},u=localizedString("RES_SHARED_FOLDER_OPTION");this.setTitle(localizedString("RESPOOL_RESELLER_TLTS")),this.defineProperty("cannotDeleteReseller",!0),this.defineProperty("SUs",[]),this.defineProperty("Customers",[]),this.defineProperty("Users",[]),this.defineProperty("Licenses",[]),this.defineProperty("Storage",[]),this.defineProperty("Auths",[]),this.defineProperty("SelectedSU"),this.defineProperty("SelectedCustomer"),this.defineProperty("SelectedLicFile"),this.defineProperty("SelectedUser"),this.defineProperty("SelectedStorage"),this.defineProperty("SelectedAuthorization"),this.defineProperty("cannotAssign",!0),this.defineProperty("cannotUnassignSU",!0),this.defineProperty("cannotUnassignCustomer",!0),this.defineProperty("cannotUnassignLicFile",!0),this.defineProperty("cannotUnregister",!0),this.defineProperty("cannotUnassignUser",!0),this.defineProperty("canNotUnassignAuthsToReseller",!0),this.defineProperty("canNotAssignAuthsToReseller",!1),this.defineProperty("ActiveUserStatus",localizedString("STATUS_ACTIVE")),this.defineProperty("pageSize",10),this.defineProperty("totalCount",0),this.defineProperty("refreshPaging",!1),this.defineProperty("page",0),this.defineProperty("assignAuthsToReseller",function(){var t=new c3assignTaskAuthorization(e,e.selectedDataItem);t.show()}),this.defineProperty("unassignAuthsToReseller",function(){var t=MessageBox.confirm({msg:localizedString("RESELLER_AUTH_UNASSIGN_TASKAUTH"),width:400,height:150});t.yesEvent.push(function(){var t={ID:e.SelectedAuthorization.TaskAuthID};c3.service.unassignTaskAuthorization(t,{success:function(t){e.refreshTaskAuthorization()},error:function(e){}})})}),this.defineProperty("registerStorage",function(){var t=new c3registerStorage4Reseller(e,e.Storage,e.selectedDataItem);t.show()}),this.defineProperty("unregisterStorage",function(){if(e.SelectedStorage==null)return;var t=$("<div>"),n=e.ActiveUserStatus;t.html(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),e.SelectedStorage.Type)+"<br/>");var r=MessageBox.confirm({msg:t,width:400,height:130});r.yesEvent.push(function(){var t={success:function(){e.refreshStorage()},error:function(){}},n=null;e.SelectedStorage.Type==localizedString("RES_COMPANY_TEMPLATE_REPOSITORY")?n="CompanyTemplateRepository":e.SelectedStorage.Type==localizedString("RES_SHARED_IMPL_REPOSITORY_LF")&&(n="ImplementationRepository"),c3.service.unAssignResources(e.selectedDataItem.ID,n,[e.SelectedStorage.ID],t)})}),this.defineCommand("userGridGetCell",function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}),this.defineCommand("taskAuthGridGetCell",function(){var e=null;return this.colName=="TaskType"?e=$("<span>").html(localizedString(this.data.TaskType.toUpperCase())):this.colName=="OperationType"&&(e=$("<input>").attr({type:"checkbox",disabled:1}),this.data.OperationType=="Authorized"?e.attr("checked",!0):e.attr("checked",!1)),e}),this.defineCommand("suGridGetCell",function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}else if(this.colName=="TenantCount"){var n=$("<span>");return c3.service.getHostingUnits(this.data.ID).expand("Tenants").query(function(e){var t="0";e.data!=null&&e.data.Tenants!=null&&e.data.Tenants.results!=null&&e.data.Tenants.results.length>0&&(t=e.data.Tenants.results.length+""),n.html(t)}),n}return e}),this.defineCommand("customerGridGetCell",function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}),this.defineCommand("changeUserStatus",function(){if(e.SelectedUser){var t=$("<div>"),n=e.ActiveUserStatus;t.html(String.format(localizedString("USERMGT_CONFIRM_CHANGESTATUS"),n)+"<br/>");var r=MessageBox.confirm({msg:t,width:400,height:150});r.yesEvent.push(function(){var t={},n={success:function(t){e.refreshUser()},error:function(){}};t.ID=e.SelectedUser.Id,e.SelectedUser.Status==="Active"?t.Status="Inactive":t.Status="Active",c3.service.updateUser(t,n)})}}),this.defineCommand("createResellerCommand",function(){var t=new c3newReseller(e);t.show()}),this.defineCommand("onLoaded",function(){e.refreshPaging=!0,e.showloading();var t=c3.service.getResellers().expand("Group");t.count().query({success:function(t){e.totalCount=parseInt(t.data,10)},error:function(e){}}),Utility.SplitPage&&(t=t.orderby("ID desc").top(e.pageSize).skip(e.page*e.pageSize)),t.query(function(t){e.selectedDataItem={},e.masterDataSource=t.data,e.stoploading();if(t.data===undefined||t.data.length==0)e.Users=[],e.Licenses=[],e.Customers=[],e.SUs=[],e.Storage=[],e.Auths=[]})}),this.defineCommand("deleteResellerCommand",function(){if(e.Customers&&e.Customers.length>0){window.alert(localizedString("RESELLER_DEL_ERROR"));return}var t=MessageBox.confirm(String.format(localizedString("RESELLER_DEL_CONFIRM"),""));t.yesEvent.push(function(){var t={success:function(t){e.onLoaded()},error:function(e){log.error(e)}},n=c3.service.removeReseller(e.selectedDataItem.ID,t)})}),this.defineCommand("submitDetail",function(t){var n={},r,i=t.data,s=t.callback,o=a(i);if(o&&o!==""){alert(o);return}n.success=function(t){e.onLoaded(),s(!0)},c3.service.updateReseller(i,n)}),this.defineCommand("masterGetCell",function(){var e=null,t={};return this.col===0&&(t={},t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)),e}),this.defineCommand("mastergetTotalCount",function(){return e.totalCount}),this.defineCommand("dataformGetViewContent",function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}else if(this.colName=="CreationDate"){if(this.data[this.colName]){var n=convertToDate(this.data[this.colName]).timeString();e=$("<label>").append(n).attr({title:n})}}else if(this.colName=="EmployeeCount"&&this.data[this.colName]!=null&&this.data[this.colName].toString()=="0")return $("<label>").html("");return e}),this.defineCommand("onInitNotification",function(){window.cometdManager.subscribe(sldEntitySet.UsersStorages,function(t){e.onLoaded()})}),this.defineCommand("assignServiceUnits",function(){var t=new c3assignServiceUnits(e);t.show()}),this.defineCommand("unassignServiceUnits",function(){var n=MessageBox.confirm(String.format(localizedString("RESELLER_UNASSIGN_CONFIRM"),localizedString("HOSTUNITS")));n.yesEvent.push(function(){var n={};n.success=function(n){c3.service.getServiceUnitsOfReseller(e.selectedDataItem.ID,t)},c3.service.unAssignResources(e.selectedDataItem.ID,"ServiceUnit",[e.SelectedSU.ID],n)})}),this.defineCommand("assignCustomer",function(){var t=new c3assignCustomer(e);t.show()}),this.defineCommand("assignLicFile",function(){var t=new c3assignLicFileToReseller(e);t.show()}),this.defineCommand("unAssignLicFile",function(){var t=MessageBox.confirm(String.format(localizedString("RESELLER_UNASSIGN_CONFIRM"),localizedString("RES_LIC_LICENSE_FILES")));t.yesEvent.push(function(){var t={};t.success=function(t){c3.service.getLicensesOfReseller(e.selectedDataItem.ID,r)},c3.service.unAssignResources(e.selectedDataItem.ID,"License",[e.SelectedLicFile.ID],t)})}),this.defineCommand("unAssignCustomer",function(){var t=MessageBox.confirm({msg:String.format(localizedString("RESELLER_UNASSIGN_CONFIRM"),localizedString("Customer"))+localizedString("RESELLER_UNASSIGN_CUS_LIC_CONFIRM")});t.yesEvent.push(function(){var t={};t.success=function(t){c3.service.getCustomersOfReseller(e.selectedDataItem.ID,n)},c3.service.unAssignResources(e.selectedDataItem.ID,"Customer",[e.SelectedCustomer.ID],t)})}),this.defineCommand("refreshStorage",function(){var t=e.selectedDataItem;e.SelectedStorage=null;var n=[];t&&t.ID>0&&(e.showloading(),c3.service.getCompanyTemplateRepositories().filter("Reseller/ID eq "+t.ID).query(function(e){if(e.data!=null&&e.data.length>0)for(var r=0;r<e.data.length;r++)n.push({ID:e.data[r].ID,Status:e.data[r].Status,Path:e.data[r].URI,Type:localizedString("RES_COMPANY_TEMPLATE_REPOSITORY")});c3.service.getImplementationRepositories().filter("Reseller/ID eq "+t.ID).query(function(e){if(e.data!=null&&e.data.length>0)for(var t=0;t<e.data.length;t++)n.push({ID:e.data[t].ID,Status:e.data[t].Status,Path:e.data[t].URI,Type:localizedString("RES_SHARED_IMPL_REPOSITORY_LF")});o(n)})}))}),this.defineCommand("removeUser",function(){if(!e.SelectedUser)return;var t=MessageBox.confirm(String.format(localizedString("RESELLER_UNASSIGN_CONFIRM"),localizedString("RESELLER_OPERATOR")));t.yesEvent.push(function(){var t={success:function(){f()},error:function(e,t){}};c3.service.removeResellerUser(e.selectedDataItem.ID,e.SelectedUser,t)})});var f=function(t,n){e.selectedDataItem.Group.ID&&c3.service.getUsersByGroup(e.selectedDataItem.Group.ID).expand("User").query(function(t){if(t.data){var n=[];for(var r=0;r<t.data.length;r++){var i={Id:t.data[r].ID,Status:t.data[r].Status,Name:t.data[r].SystemUsername};n.push(i)}e.Users=n,e.Users.length===0&&(e.SelectedUser=undefined)}})};this.defineCommand("addUserToReseller",function(){var t=new c3addSystemUser(self,0,null,!1,"reseller");t.finishEvent.push(function(){var n={success:f,error:function(e,t){}},r={SystemUsername:t.User.Name,Status:t.User.Status,Deleted:t.User.Deleted,Domain:t.User.Domain};c3.service.addResellerUser(e.selectedDataItem.ID,r,n||{})}),t.show()}),this.defineCommand("refreshSU",function(){var n=e.selectedDataItem;e.SelectedSU=null,n&&(e.showloading(),c3.service.getServiceUnitsOfReseller(n.ID,t))}),this.defineCommand("refreshLicFile",function(){var t=e.selectedDataItem;e.SelectedLicFile=null,t&&(e.showloading(),c3.service.getLicensesOfReseller(t.ID,r))}),this.defineCommand("refreshCustomer",function(){var t=e.selectedDataItem;e.SelectedCustomer=null,t&&(e.showloading(),c3.service.getCustomersOfReseller(t.ID,n))}),this.defineCommand("refreshUser",function(){var t=e.selectedDataItem;e.SelectedUser=null,t&&t.Group.ID&&(e.showloading(),c3.service.getUsersByGroup(t.Group.ID).expand("User").query(i))}),this.defineCommand("refreshTaskAuthorization",function(){var t=e.selectedDataItem;e.SelectedAuthorization=null,t&&t.Group.ID&&(e.showloading(),c3.service.getTaskTypes().query(function(e){c3.service.getTaskAuthorizations().filter("Group/ID eq "+t.Group.ID).expand("TaskType").query({success:function(t){s(t,e)},error:function(){}})}))}),this.observe("masterDataSource").onChanged(function(t){t.length>=1?e.cannotDeleteReseller=!1:e.cannotDeleteReseller=!0}),this.observe("SelectedSU").onChanged(function(t){t?e.cannotUnassignSU=!1:e.cannotUnassignSU=!0}),this.observe("SelectedCustomer").onChanged(function(t){t?e.cannotUnassignCustomer=!1:e.cannotUnassignCustomer=!0}),this.observe("SelectedLicFile").onChanged(function(t){t?e.cannotUnassignLicFile=!1:e.cannotUnassignLicFile=!0}),this.observe("SelectedUser").onChanged(function(t){if(t){e.cannotUnassignUser=!1;var n=t;n.Status==="Active"?e.ActiveUserStatus=localizedString("STATUS_INACTIVE"):e.ActiveUserStatus=localizedString("STATUS_ACTIVE")}else e.cannotUnassignUser=!0}),this.observe("SelectedStorage").onChanged(function(t){t?e.cannotUnregister=!1:e.cannotUnregister=!0}),this.observe("SelectedAuthorization").onChanged(function(t){t&&t.OperationType.toUpperCase()=="AUTHORIZED"?e.canNotUnassignAuthsToReseller=!1:e.canNotUnassignAuthsToReseller=!0}),this.observe("selectedDataItem").onChanged(function(t){if(t===undefined||t===null||t.ID===undefined){e.cannotAssign=!0;return}e.cannotAssign=!1,e.refreshSU(),e.refreshLicFile(),e.refreshCustomer(),e.refreshUser(),e.refreshTaskAuthorization(),e.refreshStorage()})},respool.c3reseller.prototype=new MDModule("reseller",e)}(),function(){"use strict";var e={master:{toolbars:[{left:[{type:"button",value:localizedString("RESPOOL_LICSERVER_BTN_IMPORTFILE"),commands:{click:"importLic"},permissionItems:[]},{type:"button",value:localizedString("RESPOOL_LICSERVER_BTN_V_LIC"),commands:{click:"btnViewLicenseFile"},permissionItems:[]}],right:[{type:"refresh",commands:{click:"getLicFile"}},{type:"selector",bindings:{datasource:"AllLicServer"},commands:{onRowSelected:"selectorChanged"},displayItem:"name"},{type:"lable",text:localizedString("CUSTOMER_SELECT_LABEL")+":"}]}],content:{type:"gridview",header:[{name:"InstallationNumber",description:localizedString("COLUMN_INSTALL_NO"),type:"text",width:"20%"},{name:"LicenseServer_Name",description:localizedString("COLUMN_HOSTNAME"),type:"text",width:"20%"},{name:"SystemNumber",description:localizedString("COLUMN_SYS_NO"),type:"text",width:"20%"},{name:"Localization",description:localizedString("MISC_LOCATION"),type:"text",width:"10%"},{name:"Version",description:localizedString("COLUMN_VERSION"),type:"text",width:"10%"},{name:"Reseller",description:localizedString("RESPOOL_RESELLER_TLT"),type:"text",width:"10%"},{name:"IsShared",description:localizedString("IsShared"),type:"text",width:"10%"}],bindings:{datasource:"masterDataSource"},commands:{onRowSelected:"masterRowSelected"},empty:{text:localizedString("RES_VIEWLIC_LICFILE"),command:"importLic"}}},details:{title:localizedString("LICENSE_FILE_DETAILS"),tabs:[{title:"Configuration",toolbars:[],content:{type:"dataform",fields:[{id:"InstallationNumber",text:localizedString("COLUMN_INSTALL_NO"),binding:"InstallationNumber",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"LicenseServer_Name",text:localizedString("COLUMN_HOSTNAME"),binding:"LicenseServer_Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"SystemNumber",text:localizedString("COLUMN_SYS_NO"),binding:"SystemNumber",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"Localization",text:localizedString("MISC_LOCATION"),binding:"Localization",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"Version",text:localizedString("COLUMN_VERSION"),binding:"Version",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"IsShared",text:localizedString("IsShared"),binding:"IsShared",type:"label",readonly:!0,"class":"chrome2",editable:!1}],bindings:{datasource:"selectedDataItem"},commands:{submit:""},hideToolbar:!0}},{title:localizedString("WIZARD_TENANT_LIVMDL"),toolbars:[],content:{type:"gridview",header:[{name:"Description",description:localizedString("RESPOOL_LICSERVER_COLUMN_LICTYPE"),type:"text",width:"40%"},{name:"StartDate",description:localizedString("COLUMN_CREATE_DATE"),type:"text",width:"15%"},{name:"ExpirationDate",description:localizedString("RESPOOL_LICSERVER_COLUMN_EXPIREDDATE"),type:"text",width:"15%"},{name:"Available",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"15%"},{name:"TotalQuota",description:localizedString("TOTAL_QUOTA"),type:"text",width:"15%"}],bindings:{datasource:"LicModules"},commands:{},getCell:"licModulegetCell"}},{title:localizedString("USED_BY_TENANTS"),toolbars:[],content:{type:"gridview",header:[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"CompanyDatabase_CompanyName",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"Purpose",description:localizedString("COLUMN_PURPOSE"),type:"text",width:"10%"},{name:"Customer_Name",description:localizedString("CUSTOMER"),type:"text",width:"15%"},{name:"ServiceUnit_Name",description:localizedString("HOSTUNIT"),type:"text",width:"15%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"15%"},{name:"Phone",description:localizedString("CUSTOMER_COLUMN_PHONE"),type:"text",width:"10%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"21%"}],bindings:{datasource:"Tenants"}}},{title:localizedString("USED_BY_CUSTOMERS"),toolbars:[],content:{type:"gridview",header:[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("COLUMN_NAME"),type:"text",width:"10%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"8%"},{name:"Country",description:localizedString("CUSTOMER_COLUMN_COUNTRY"),type:"text",width:"15%"},{name:"Location",description:localizedString("CUSTOMER_COLUMN_LOCATION"),type:"text",width:"15%"},{name:"ContactPerson",description:localizedString("COLUMN_CONTACTPERSON"),type:"text",width:"15%"},{name:"InstallationNumber",description:localizedString("RES_LIC_INSTALLATION_NUM"),type:"text",width:"12%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"13%"},{name:"Reseller_Name",description:localizedString("RESPOOL_RESELLER_TLT"),type:"text",width:"10%"}],bindings:{datasource:"Customers"}}}]}};c3.LicFileManagerViewTemplate=e}(),function(){"use strict";var e=new MDModule("resellerlicfile",c3.LicFileManagerViewTemplate);e.setTitle(localizedString("RES_LIC_LICENSE_FILES")),e.defineProperty("LicModules"),e.defineProperty("Tenants"),e.defineProperty("AllLicServer"),e.defineProperty("SelectedLicServer"),e.defineProperty("Customers"),e.defineCommand("onLoaded",function(){e.getLicServer()}),e.observe("SelectedLicServer").onChanged(function(t){e.getLicFile()}),e.defineCommand("selectorChanged",function(t){var n=function(e){return e.name===t},r=e.AllLicServer.filter(n);r.length>0&&(e.SelectedLicServer=r[0])}),e.defineCommand("getLicFile",function(){e.showloading();var t=c3.service.getLicenseFiles(),n={success:function(t){e.stoploading();var n=[],r=0,i=0,s,o=0;e.masterDataSource=[];for(i=t.data.length;r<i;r++){s=t.data[r],s.LicenseServer_Name=s.LicenseServer.Name;var u={};(function(){var i=t.data[r],s=function(r){o++;if(r.d.results!==undefined&&r.d.results.length>0){var s="";for(var u=0;u<r.d.results.length;u++)s+=r.d.results[u].Name,u!=r.d.results.length-1&&(s+="; ");r.d.results[0].IsShared==1?i.IsShared=localizedString("Shared"):i.IsShared=localizedString("Exclusive"),i.Reseller=s}else i.IsShared=localizedString("Exclusive");n.push(i),t.data.length===o&&(e.masterDataSource=n.sort(function(e,t){return e.InstallationNumber<t.InstallationNumber}))},a=function(e){o++};u.success=s,u.error=a})(),c3.service.checkLicenseFileIsShared(s.ID,"License",u)}}};e.SelectedLicServer.id>0&&(t=t.filter("LicenseServer/ID eq "+e.SelectedLicServer.id)),t.expand("LicenseServer").query(n)}),e.defineCommand("getLicServer",function(){var t=c3.service.getLicenseServers(),n=[],r,i,s=0,o={success:function(t){n.push({id:-1,name:localizedString("LICENSE_SERVER_ALL")});for(r=0,i=t.data.length;r<i;r++)n.push({id:t.data[r].ID,name:t.data[r].Name});e.AllLicServer=n,e.SelectedLicServer=e.AllLicServer[0]}};t.query(o)}),e.defineCommand("licModulegetCell",function(){if(this.colName==="StartDate"||this.colName==="ExpirationDate"){var e=this.data[this.colName];return window.convertToDate(e).dateString()}return this.colName.trim()=="Available".trim()?this.data[this.colName]+"/"+this.data.Total:null}),e.defineCommand("importLic",function(){var t=new window.c3importLicFileForReseller(e);t.show()}),e.defineCommand("btnViewLicenseFile",function(){if(e.selectedDataItem!=null){var t=new licenseModules(e.selectedDataItem,this);t.show(),t.bindData(e.selectedDataItem)}else alert(localizedString("LICSVR_CREATE_NEEDSELECT"))}),e.observe("selectedDataItem").onChanged(function(t){if(t===null||t===undefined)return;e.showloading();var n={success:function(t){t.data&&0<t.data.length&&(e.LicModules=t.data),e.stoploading()},error:function(){e.stoploading()}};c3.service.getLicenseModulesByLicenseFileId(t.ID).query(n);var r={success:function(t){t.data&&0<t.data.length?e.Tenants=c3.service.convertData(t.data):e.Tenants=[]},error:function(){e.stoploading()}},i={success:function(t){t.data&&0<t.data.length?e.Customers=c3.service.convertData(t.data):e.Customers=[]},error:function(){e.stoploading()}};c3.service.getTenants().filter("LicenseFile/ID eq "+t.ID).expand("ServiceUnit,Customer,CompanyDatabase").query(r),c3.service.getCustomers().filter("InstallationNumber eq '"+t.InstallationNumber+"'").expand("Reseller,Group").query(i)}),e.observe("masterDataSource").onChanged(function(t){e.selectedDataItem=undefined,e.LicModules=[]}),c3.LicFileManager=function(){var e=c3.hasPermission([permissionItems.operator]);if(!e){var t=[{name:"Description",description:localizedString("RESPOOL_LICSERVER_COLUMN_LICTYPE"),type:"text",width:"40%"},{name:"StartDate",description:localizedString("COLUMN_CREATE_DATE"),type:"text",width:"20%"},{name:"ExpirationDate",description:localizedString("RESPOOL_LICSERVER_COLUMN_EXPIREDDATE"),type:"text",width:"20%"},{name:"Available",description:localizedString("COLUMN_AVAILABLE"),type:"text",width:"20%"}];c3.LicFileManagerViewTemplate.details.tabs[1].content.header=t,this.render(c3.LicFileManagerViewTemplate,!0)}},c3.LicFileManager.prototype=e}(),c3trialrequest.detail=function(){function f(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function l(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");return t.append(c()),t}function c(){var t=e+"_profile",n=$("<section>").attr({id:t}),r=[];i.statusData=[];var s=[{id:"requestStatus",text:localizedString("MISC_STATUS"),binding:"RequestStatus",type:"label",readonly:!0,"class":"chrome2",editable:!1,editSetting:{controlType:"select",data:i.statusData}},{id:"name",text:localizedString("CUSTOMER"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"country",text:localizedString("CUSTOMER_COLUMN_COUNTRY"),binding:"Country",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"state",text:localizedString("TRIAL_COLUMN_STATE"),binding:"State",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"location",text:localizedString("TRIAL_COLUMN_LOCATION"),binding:"Location",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"postalCode",text:localizedString("TRIAL_COLUMN_POSTALCODE"),binding:"PostalCode",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"contactPerson",text:localizedString("COLUMN_CONTACTPERSON"),binding:"ContactPerson",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"email",text:localizedString("CUSTOMER_COLUMN_EMAIL"),binding:"Email",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"phone",text:localizedString("CUSTOMER_COLUMN_PHONE"),binding:"Phone",type:"text",readonly:!0,"class":"chrome2",controlClass:"value",editable:!0},{id:"processor",text:localizedString("TRIAL_LABEL_PROCESSOR"),binding:"ProcessorName",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"reason",text:localizedString("TRIAL_COLUMN_REASON"),binding:"Reason",type:"textarea",readonly:!0,"class":"chrome2",controlClass:"value",rows:2,editable:!0},{id:"comments",text:localizedString("TRIAL_COLUMN_COMMENTS"),binding:"Comments",type:"textarea",readonly:!0,"class":"chrome2",controlClass:"value",rows:2,editable:!0}];r.push(s);var o={getColumns:function(){return r},getViewContent:function(){var e=null;return this.colName=="RequestStatus"&&(this.data[this.colName]==="Ready"&&(e=$("<div>").append(localizedString("TRIAL_SELECT_TRIALREADY")).attr({title:localizedString("TRIAL_SELECT_TRIALREADY")})),this.data[this.colName]==="Released"&&(e=$("<div>").append(localizedString("TRIAL_SELECT_RESTOCUSTOMER")).attr({title:localizedString("TRIAL_SELECT_RESTOCUSTOMER")})),this.data[this.colName]==="InProcess"&&(e=$("<div>").append(localizedString("TRIAL_SELECT_INPROCESS")).attr({title:localizedString("TRIAL_SELECT_INPROCESS")}))),e}},u=$(n).dataform({delegate:o});i.dataform=u;if(i.dataform){i.dfToolbar=i.dataform.getToolbar();var f=i.dfToolbar.edit.parent(".tools"),l=$("<input>").attr({value:localizedString("TRIAL_BTN_RELEASE"),type:"button",id:"release"});f&&(f.append(l),i.dfToolbar.release=l),l.click(function(){if(i.trialRequest){var e={success:function(e){if(e.data&&e.data.RequestStatus!=="Ready"){var t=MessageBox.confirm(localizedString("REQUEST_REFRESH_TIP"));t.yesEvent.push(function(){a.onSelectStatusChanged(a.selectStatus.val())})}else{var t=MessageBox.confirm(localizedString("REQUEST_RELEASE_CONFIRM"));t.yesEvent.push(function(){var e={ID:i.trialRequest.ID,RequestStatus:"Released"};c3.service.updateTrialRequest(e,function(){a.onSelectStatusChanged(a.selectStatus.val())})})}},error:function(e){}};c3.service.getTrialRequests(i.trialRequest.ID).query(e)}}),i.dataform.beforeEdit.push(function(){if(i.trialRequest){var e={success:function(e){if(e.data&&e.data.RequestStatus!=="New"){var t=MessageBox.show({msg:localizedString("REQUEST_AUTOREFRESH_TIP"),icon:MessageBoxIcon.QUESTION,buttons:MessageBoxButton.OK});t.okEvent.push(function(){a.onSelectStatusChanged(a.selectStatus.val())})}},error:function(e){}};c3.service.getTrialRequests(i.trialRequest.ID).query(e)}})}return n}function h(e,t){var n="";if(e){if(e.Email&&e.Email!==""){var r=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,i=r.test(e.Email);i||(n+=localizedString("TNT_CREATION_EMAIL_VALID"))}if(e.Phone&&e.Phone!==""){var s=/^(\+\d{2,3} )*[\d]+(-[\d]+)*$/;isPhone=s.test(e.Phone),isPhone||(n+=localizedString("TNT_CREATION_PHONE_VALID"))}}return n}this.base=c3.module,this.base();var e="trialrequest_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=localizedString("TRIAL_DETAILS_TLT"),r=[localizedString("MISC_CONFIGURATION")],i=this,s=localizedString("CUSTOMER"),o=0,u=5,a=arguments[0]||{};this._container=t,this.onInit=function(){i.detailTitle=$("<h1>").append(n),t.append(i.detailTitle),t.append(f()),t.append(l());var r=new loadingWindow;i.loadingWin=r;var s=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});s.onSelectEvent.push(function(e,t){}),s.select(0)},this.refreshTitle=function(e){i.detailTitle.text(n)},this.bindData=function(t){i.dataform.submit=function(e){var t=h(e,this.getDataSource());if(t&&t!==""){alert(t);return}var n={};return n.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),a.reload())},n.error=function(e){console.log(e)},c3.service.updateTrialRequest(e,n),!0},i.statusData.clear(),c3.service.getTrialRequestStatus(function(e){for(var t=0;t<e.data.length;t++){var n="";e.data[t]==="Ready"?n=localizedString("TRIAL_SELECT_TRIALREADY"):e.data[t]==="Released"?n=localizedString("TRIAL_SELECT_RESTOCUSTOMER"):e.data[t]==="InProcess"?n=localizedString("TRIAL_SELECT_INPROCESS"):n=e.data[t],i.statusData.push({text:n,value:e.data[t]})}}),t&&t.Processor_ID?c3.service.getOSUserBindings().filter("User/ID eq "+t.Processor_ID).query(function(e){e&&e.data&&e.data.length>0&&(t.ProcessorName=e.data[0].SystemUser),i.dataform.setDataSource(t),i.dataform.dataBind(),i.dataform.changeMode(0),i.trialRequest=t,t.RequestStatus==="New"?(i.dfToolbar.edit.attr({disabled:!1}),i.dfToolbar.release.attr({disabled:!0})):(i.dfToolbar.edit.attr({disabled:!0}),t.RequestStatus==="Ready"?i.dfToolbar.release.attr({disabled:!1}):i.dfToolbar.release.attr({disabled:!0}))}):t&&(i.dataform.setDataSource(t),i.dataform.dataBind(),i.dataform.changeMode(0),i.trialRequest=t,t.RequestStatus==="New"?(i.dfToolbar.edit.attr({disabled:!1}),i.dfToolbar.release.attr({disabled:!0})):(i.dfToolbar.edit.attr({disabled:!0}),t.RequestStatus==="Ready"?i.dfToolbar.release.attr({disabled:!1}):i.dfToolbar.release.attr({disabled:!0})))}},c3auditLog.details=function(){"use strict";function i(){return $("<h1>").append(n)}function s(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");return t.append(u()),t}function o(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header"),n=$("<a>").attr({href:"#"}).append(localizedString("AUDIT_LOG_DETAILS"));return t.append($("<li>").attr({id:e+1}).append(n)),t}function u(){var e=$("<section>"),t=[{name:"Property",description:localization.AUDIT_LOG_GRID_COLUMN_PROPERTY,type:"text",width:"30%"},{name:"OldValue",description:localization.AUDIT_LOG_GRID_COLUMN_OLD_VALUE,type:"text",width:"35%"},{name:"NewValue",description:localization.AUDIT_LOG_GRID_COLUMN_NEW_VALUE,type:"text",width:"35%"}];r.data=[],r.colList=t;var n={getHeaderSpec:function(){return t},getRowCount:function(){return r.data.length},getRow:function(e){return r.data[e]},getGridHeight:function(){return Utility.MasterTableHeight}};r.gridDelegate=n;var i=$(e).gridview({delegate:n});return r.dataGrid=i,e}this.base=c3.module,this.base();var e="auditlog_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=localizedString("AUDIT_LOG_DETAILS"),r=this;r._container=t,r.loadingWindow=new loadingWindow,r._title=n,this.onInit=function(){t.append(i()),t.append(o()),t.append(s()),r.dataGrid&&r.dataGrid.show();var n=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});r.navTab=n,n.select(0)}},c3auditLog.timeBox=function(e,t){"use strict";this.referenceID=t,this.timeBoxContainer=$("<div>").addClass("timeBoxContainer"),this.timeBoxCon=$("<div>").css({"float":"left"}),this.timeHour=$("<input>").attr({type:"text",maxlength:2,id:t+"_hour",disabled:!0}).addClass("timeHour"),this.timeMinute=$("<input>").attr({type:"text",maxlength:2,id:t+"_minute",disabled:!0}).addClass("timeMinute"),this.timeSecond=$("<input>").attr({type:"text",maxlength:2,id:t+"_second",disabled:!0}).addClass("timeMinute"),this.h=$("<input type='radio' value='h' id='h' checked='checked'>").attr({name:t+"_ext_switch"}).css({display:"none"}),this.m=$("<input type='radio' value='m' id='m'>").attr({name:t+"_ext_switch"}).css({display:"none"}),this.s=$("<input type='radio' value='s' id='s'>").attr({name:t+"_ext_switch"}).css({display:"none"}),this.timeMinColon=$("<label>").addClass("timeLabel").text(":"),this.timeSecColon=$("<label>").addClass("timeLabel").text(":"),this.timeBoxCon.append(this.timeHour).append(this.timeMinColon).append(this.timeMinute).append(this.timeSecColon).append(this.timeSecond),this.timeBoxContainer.append(this.h).append(this.m).append(this.s),this.timeUdContainer=$("<div>").addClass("timeUdContainer"),this.timeUp=$("<label>").addClass("iconUpTime").css({"float":"none"}).attr({id:t+"_timeup"}),this.timeDown=$("<label>").addClass("iconDownTime").css({"float":"none"}).attr({id:t+"_timedown"}),this.timeHour.keydown(function(e){return e.which>47&&e.which<58&&!e.shiftKey||e.which==46||e.which==8||e.which>36&&e.which<41||e.which>95&&e.which<106?!0:!1}).keyup(function(e){this.value>23&&(this.value=23),this.value=this.value.replace(/[^\d]/g,"")}).focus(jQuery.proxy(function(){this.h.attr({checked:"checked"})},this)).blur(function(){this.value==""&&(this.value="00"),this.value=parseInt(this.value,10).padLeft(2)}).removeClass("disabled"),this.timeMinute.keydown(function(e){return e.which>47&&e.which<58&&!e.shiftKey||e.which==46||e.which==8||e.which>36&&e.which<41||e.which>95&&e.which<106?!0:!1}).keyup(function(e){this.value>59&&(this.value=59),this.value=this.value.replace(/[^\d]/g,"")}).focus(jQuery.proxy(function(){this.m.attr({checked:"checked"})},this)).blur(function(){this.value==""&&(this.value="00"),this.value=parseInt(this.value,10).padLeft(2)}).removeClass("disabled"),this.timeSecond.keydown(function(e){return e.which>47&&e.which<58&&!e.shiftKey||e.which==46||e.which==8||e.which>36&&e.which<41||e.which>95&&e.which<106?!0:!1}).keyup(function(e){this.value>59&&(this.value=59),this.value=this.value.replace(/[^\d]/g,"")}).focus(jQuery.proxy(function(){this.s.attr({checked:"checked"})},this)).blur(function(){this.value==""&&(this.value="00"),this.value=parseInt(this.value,10).padLeft(2)}),this.timeHour.bind("contextmenu",function(){return!0}).bind("selectstart",function(){return!0}).bind("paste",function(){return!1}).css({imeMode:"disabled"}),this.timeMinute.bind("contextmenu",function(){return!0}).bind("selectstart",function(){return!0}).bind("paste",function(){return!1}).css({imeMode:"disabled"}),this.timeSecond.bind("contextmenu",function(){return!0}).bind("selectstart",function(){return!0}).bind("paste",function(){return!1}).css({imeMode:"disabled"}),this.timeUdContainer.append(this.timeUp).append(this.timeDown),this.timeBoxContainer.append(this.timeBoxCon),this.timeBoxContainer.append(this.timeUdContainer),e.append(this.timeBoxContainer)},c3auditLog.timeBox.prototype.enable=function(){this.timeHour.attr({disabled:!1}),this.timeMinute.attr({disabled:!1}),this.timeSecond.attr({disabled:!1}),this.timeHour.val()===""&&this.timeHour.val("00"),this.timeMinute.val()===""&&this.timeMinute.val("00"),this.timeSecond.val()===""&&this.timeSecond.val("00"),this.timeUp.mouseover(function(){$(this).removeClass("iconUpTime"),$(this).addClass("iconUpTimehover")}).mouseout(function(){$(this).removeClass("iconUpTimehover"),$(this).addClass("iconUpTime")}),this.timeDown.mouseover(function(){$(this).removeClass("iconDownTime"),$(this).addClass("iconDownTimehover")}).mouseout(function(){$(this).removeClass("iconDownTimehover"),$(this).addClass("iconDownTime")}),this.timeUp.bind("click",{obj:this},function(e){var t=$("input:radio[name='"+e.data.obj.referenceID+"_ext_switch']:checked").val();if(t=="h"){var n;$(this).attr("id")=="start_timeup"?n=$("#start_hour"):n=$("#end_hour"),n.val()==""&&n.val(0);var r=parseInt(n.val(),10);r<23&&r++,n.val(r.padLeft(2))}if(t=="m"){var n;$(this).attr("id")=="start_timeup"?n=$("#start_minute"):n=$("#end_minute"),n.val()==""&&n.val(0);var r=parseInt(n.val(),10);r<59&&r++,n.val(r.padLeft(2))}if(t=="s"){var n;$(this).attr("id")=="start_timeup"?n=$("#start_second"):n=$("#end_second"),n.val()==""&&n.val(0);var r=parseInt(n.val(),10);r<59&&r++,n.val(r.padLeft(2))}}),this.timeDown.bind("click",{obj:this},function(e){var t=$("input:radio[name='"+e.data.obj.referenceID+"_ext_switch']:checked").val(),n;if(t=="h"){$(this).attr("id")=="start_timedown"?n=$("#start_hour"):n=$("#end_hour"),n.val()==""&&n.val(0);var r=parseInt(n.val(),10);r!=0&&r--,n.val(r.padLeft(2))}if(t=="m"){$(this).attr("id")=="start_timedown"?n=$("#start_minute"):n=$("#end_minute"),n.val()==""&&n.val(0);var r=parseInt(n.val(),10);r!=0&&r--,n.val(r.padLeft(2))}if(t=="s"){$(this).attr("id")=="start_timedown"?n=$("#start_second"):n=$("#end_second"),n.val()==""&&n.val(0);var r=parseInt(n.val(),10);r!=0&&r--,n.val(r.padLeft(2))}})},c3auditLog.timeBox.prototype.disable=function(){this.timeHour.attr({disabled:!0}).val(""),this.timeMinute.attr({disabled:!0}).val(""),this.timeSecond.attr({disabled:!0}).val(""),this.timeUp.unbind("mouseover mouseout click"),this.timeDown.unbind("mouseover mouseout click")},c3apptoken=function(){function c(){var e=c3.service.getApplicationIdentifiers();Utility.SplitPage||(e=e.top(o).skip(s*o)),e.query(v)}function h(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),n=$("<input>").attr({value:i,type:"button",id:e+"btnUnRegister"}),s=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),o=localizedString("SLDCLIENT_TLT");u.btnDelete=n,g(),n.click(function(){if(a!=null){var e=MessageBox.confirm(String.format(localizedString("RES_MISC_UNREGIST_CONFIRM"),o));e.yesEvent.push(function(){var e={};e.success=function(e){u.reload(),g(),f=-1},c3.service.deleteApplicationIdentifier(a,e)})}else alert(String.format(localizedString("RES_MISC_NOSELECTED_TIP"),o))}),s.click(function(){u.reload()}),t.append($("<input>").attr({value:r,type:"button",id:e+"btnRegister"}).click(function(){p(u)}));var l=new searchbox({inputCallback:function(e){return u.dataGrid.searchText(e)}});return t.append($("<span>").addClass("split")),t.append(n),t.append($("<div>").css({"float":"right"}).append(l.css({"float":"left"})).append(s)),t}function p(e){var t=new c3registerAppToken(e);t.show()}function d(){var t=$("<section>").attr({id:e+"_masterDataGrid"}),n=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"4%"},{name:"Name",description:localizedString("COLUMN_MSSQL_NAME"),type:"text",width:"10%"},{name:"Identifier",description:localizedString("SLDCLIENT_COLUMN_IDENTIFIER"),type:"text",width:"43%"},{name:"Description",description:localizedString("COLUMN_DESC"),type:"text",width:"43%"}];u.data=[];var r={autoResize:function(){return 540},getHeaderSpec:function(){return n},getRowCount:function(){return u.data.length},getRow:function(e){return u.data[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return f},getCell:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.textalign="center",e=new statusControl(t)}return e}};u.gridDelegate=r;var i=$(t).gridview({delegate:r});return i.rowSelectedEvent.push(function(){f!=this.index&&y(this.index),m()}),u.dataGrid=i,t}function v(e){var t=c3.service.convertData(e.data);u.data=t,u.data.length==0?(u.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("SLDCLIENT_TLT"),function(){p(u)})},g()):f==-1?g():m(),u.dataGrid.reload(),u.data.length>0&&f!=-1?y(f):l[0].bindData({})}function m(){u.btnDelete.attr({disabled:0})}function g(){u.btnDelete.attr({disabled:1})}function y(e){l[0].onViewWillAppear(),l[0].bindData(u.data[e]),f=e,a=u.data[e]}this.base=c3.module,this.base();var e="applicationtoken",t=$("<section>").attr({id:e}),n=localizedString("SLDCLIENT_TLTS"),r=localizedString("MISC_REGISTER"),i=localizedString("MISC_UNREGISTER"),s=0,o=5,u=this,a=null,f=0,l=[new c3apptoken_detail(this)];u.id=e,this._container=t,this._title=n,this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(n)),t.append(h()),t.append(d());for(var e=0;e<l.length;e++)t.append(l[e].getContainer());l[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-AppToken",c)),c()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.ApplicationIdentifiers,function(e){u.reload()})},this.onViewAppear=function(){u.dataGrid.show()},this.getTitle=function(){return n},this.reload=c},c3apptoken_detail=function(){function u(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t}function a(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+":");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(f()),t}function f(){var t=e+"_config",n=$("<section>").attr({id:t}),r=[];i.statusData=[],i.lifeCycleStatusData=[];var s=[{id:"name",text:localizedString("COLUMN_NAME"),binding:"Name",type:"label",readonly:!0,"class":"chrome2",editable:!1},{id:"status",text:localizedString("MISC_STATUS"),binding:"Status",type:"label",readonly:!0,"class":"chrome2",editable:!0,editSetting:{controlType:"select",data:i.statusData}},{id:"identifier",text:localizedString("SLDCLIENT_COLUMN_IDENTIFIER"),binding:"Identifier",type:"text",readonly:!0,"class":"chrome2",editable:!1},{id:"description",text:localizedString("COLUMN_DESC"),binding:"Description",type:"textarea",readonly:!0,"class":"chrome2",rows:3,controlClass:"value",editable:!0}];r.push(s);var o={getColumns:function(){return r},getViewContent:function(){var e=null;if(this.colName=="Status"){var t={};t.text=this.data[this.colName],t.showText=!0,e=new statusControl(t)}return e}},u=$(n).dataform({delegate:o});return i.dataform=u,n}this.base=c3.module,this.base();var e="applicationtoken_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("SLDCLIENT_TLT"),localizedString("RES_DETAILS")),r=[localizedString("MISC_CONFIGURATION")],i=this,s=localizedString("SLDCLIENT_TLT"),o=arguments[0]||{};this._container=t,this.onInit=function(){t.append($("<h1>").append(n)),t.append(u()),t.append(a());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==1?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.bindData=function(e){i.title.text(s+": "+parse(e.URL)),i.dataform.submit=function(e,t){var n={};n.success=function(e){cometdManager.getConnectedStatus()||(console.warn("Notification connection failed!"),o.reload()),t(!0)},c3.service.updateApplicationIdentifier(e,n)},i.dataform.setDataSource(e),i.dataform.dataBind(),i.dataform.changeMode(0),i.statusData.clear(),c3.service.getApplicationIdentifierStatus(function(e){for(var t=0;t<e.data.length;t++)i.statusData.push({text:e.data[t],value:e.data[t]})})}};var c3sldagent=function(){function p(e){c3.service.getSLDAgentMonitorStatus("",{success:function(t){var n=c3.service.convertData(e.data);if(t.d.results)for(var r=0;r<t.d.results.length;r++)for(var i=0;i<n.length;i++)if(n[i].AgentID==t.d.results[r].ID){n[i].MonitorStatus=t.d.results[r].Status,n[i].monitorStatusCode=t.d.results[r].StatusCode,n[i].monitorMessageList=monitorUtil.buildMessageList(t.d.results[r].Messages.results);break}h(n)},error:function(t){var n=c3.service.convertData(e.data);h(n)}})}this.base=c3.module,this.base();var e="sldagent",t=$("<section>").attr({id:e}),n=localizedString("RESPOOL_SLDAGENT_TLT"),r=0,i=5,s=this,o=null,u=0,a=[new c3sldagent_detail(this)];s.id=e,s.pageSize=10,s.totalCount=0,s.refreshPaging=!1,this._container=t,this._title=n,this.getTitle=function(){return localizedString("RESPOOL_SLDAGENT_TLTS")};var f=function(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),n=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh");n.click(function(){s.reload()});var r=new searchbox({inputCallback:function(e){return s.dataGrid.searchText(e)}});return t.append($("<div>").css({"float":"right"}).append(r.css({"float":"left"})).append(n)),t},l=function(e){a[0].onViewWillAppear(),a[0].bindData(s.data[e]),u=e,o=s.data[e]},c=function(){var t=$("<section>").attr({id:e+"_masterDataGrid"}),n=null,r=[{name:"MonitorStatus",description:localizedString("COLUMN_AVAILABLE_STATUS"),type:"text",width:"15%",sortedBy:"monitorStatusCode",dataType:"number"},{name:"AgentID",description:localizedString("RESPOOL_SLDAGENT_COLUMN_AGENTNO"),type:"text",width:"10%"},{name:"Hostname",description:localizedString("RESPOOL_SLDAGENT_COLUMN_HOSTNAME"),type:"text",width:"42%"},{name:"RunTask",description:localizedString("RESPOOL_SLDAGENT_COLUMN_TASKEXECUTOR"),type:"text",width:"33%"}];s.data=[];var i={pagingMode:!0,pageSize:s.pageSize,autoResize:function(){return 540},getHeaderSpec:function(){return r},getRowCount:function(){return s.data.length},getRow:function(e){return s.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return u},getCell:function(){var e=null;if(this.colName=="RunTask")this.data[this.colName]==1?e=$("<input>").attr({type:"checkbox",checked:!0,disabled:!0}):e=$("<input>").attr({type:"checkbox",checked:!1,disabled:!0});else if(this.colName=="MonitorStatus"){var t={};t.textalign="center";var n=$("<label>"),r=this.data;return monitorUtil.statusPreparation(t,r.MonitorStatus,r),n=new statusControl(t),n.c3tip({messageList:this.data.monitorMessageList}),n}return e},getTotalCount:function(){return s.totalCount},loadPage:function(e,t){c3.service.retrieveWorkstations().orderby("ID desc").skip(e).top(t).query({success:function(e){s.data.clear();for(var t=0;t<e.data.length;t++)s.data.push(e.data[t]);s.data=c3.service.convertData(s.data),l(u),s.dataGrid.refreshContent()},error:function(e){s.loadingWindow.close()}})}};return s.gridDelegate=i,n=$(t).gridview({delegate:i}),n.rowSelectedEvent.push(function(){u!=this.index&&l(this.index)}),s.dataGrid=n,t},h=function(e){s.data=e,s.data.length==0&&(s.gridDelegate.getTip=function(){return Utility.CreateTipBoard(localizedString("RESPOOL_SLDAGENT_TLT"),null,!0)}),s.dataGrid.reload(),s.data.length>0&&u!=-1?l(u):a[0].bindData({})};s.countHandler={success:function(e){s.totalCount=parseInt(e.data.length,10)},error:function(e){}};var d=function(){s.refreshPaging=!0;var e=c3.service.retrieveWorkstations();e.count().query(s.countHandler),Utility.SplitPage&&(e=e.orderby("ID desc").top(s.pageSize).skip(r*s.pageSize)),e.query(p)};this.reload=d,this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(s.getTitle())),t.append(f()),t.append(c());for(var e=0;e<a.length;e++)t.append(a[e].getContainer());a[0].onViewWillAppear(),c3ModuleManager.Listeners.push(new c3Listener("New-SLDAgent",d)),d()},this.onViewAppear=function(){s.dataGrid.show()},this.filterResults=function(e){var t=c3.service.retrieveWorkstations();Utility.SplitPage||(t=t.top(i).skip(r*i)),t.query(function(t){var n=c3.service.convertData(t.data),r=n[u];if(r&&r.Commands&&r.Commands.length>0){if(e=="inprocess")for(var i=0;i<r.Commands.length;i++)r.Commands[i].Status!="Processing"&&r.Commands.remove(i--);else if(e=="history")for(var i=0;i<r.Commands.length;i++)r.Commands[i].Status=="Processing"&&r.Commands.remove(i--);a[0].onViewWillAppear(),a[0].bindData(r)}else a[0].onViewWillAppear(),a[0].bindData({Commonds:[]})})}},c3sldagent_detail=function(){this.base=c3.module,this.base();var e="sldagent_detail",t=$("<section>").attr({id:e}).addClass("tab"),n=String.format("{0} {1}",localizedString("RESPOOL_SLDAGENT_TLT"),localizedString("RES_DETAILS")),r=[localizedString("RESPOOL_SLDAGENT_TASKS")],i=this,s=localizedString("RESPOOL_SLDAGENT_TLT"),o=arguments[0]||{},u=[];this._container=t;var a=function(){var e="sldagent_toolbar",t=$("<section>").attr({id:e}).addClass("tools"),n=$("<select>").css({"float":"right",width:"150px"});return n.append($("<option>").attr({title:localizedString("RESPOOL_SLDAGENT_SELECT_ALL")}).val("all").append(localizedString("RESPOOL_SLDAGENT_SELECT_ALL"))),n.append($("<option>").attr({title:localizedString("RESPOOL_SLDAGENT_SELECT_PROCESSING")}).val("inprocess").append(localizedString("RESPOOL_SLDAGENT_SELECT_PROCESSING"))),n.append($("<option>").attr({title:localizedString("RESPOOL_SLDAGENT_SELECT_HISTORY")}).val("history").append(localizedString("RESPOOL_SLDAGENT_SELECT_HISTORY"))),i.select=n,n.change(function(){o.filterResults(i.select.val())}),t.append(n),t},f=function(){var t=$("<ul>").attr({id:e+"_tab_header"}).addClass("detail_tab_header");for(var n=0;n<r.length;n++){var i=$("<a>").attr({href:"#"}).append(r[n]);t.append($("<li>").attr({id:e+n.toString()}).append(i))}return t},l=function(){var t=$("<section>").attr({id:e+"_tab_body"}).addClass("detail_tab_body");i.title=$("<h3>").attr({id:e+"_title"}),i.subTitle=$("<h4>").attr({id:e+"_sub_title"}),i.title.html(s+":");var n=$("<hgroup>").attr({id:e+"_title_group"}).append(i.title).append(i.subTitle);return t.append(n),i.hgroup=n,t.append(c()),t};this.onInit=function(){t.append($("<h1>").append(n)),t.append(f()),t.append(l());var r=$("#"+e+">.detail_tab_header a").c3tab("#"+e+">.detail_tab_body>section",{});r.onSelectEvent.push(function(e,t){e==0?i.hgroup.css({display:"none"}):(i.hgroup.css({display:""}),e==1?i.subTitle.css({display:""}):i.subTitle.css({display:"none"}))}),r.select(0)},this.bindData=function(e){i.data=e.Commands,i.TaskDataGrid.reload()};var c=function(){var t=e+"_tasks",n=$("<section>").attr({id:t}),r=$("<section>").attr({id:t+"_grid"}),s=[{name:"Status",description:localizedString("MISC_STATUS"),type:"text",width:"9%"},{name:"Type",description:localizedString("MISC_TYPE"),type:"text",width:"15%"},{name:"Percentage",description:localizedString("RESPOOL_SLDAGENT_COLUMN_PERCENTAGE"),type:"text",width:"15%"},{name:"Command",description:localizedString("RESPOOL_SLDAGENT_COLUMN_COMMAND"),type:"text",width:"35%"},{name:"Result",description:localizedString("MISC_RESULT"),type:"text",width:"25%"}],o={getHeaderSpec:function(){return s},getRowCount:function(){return i.data.length},getRow:function(e){return i.data[e]},getGridHeight:function(){return Utility.MasterTableHeight},getDefaultSelectedIndex:function(){return 0},getTip:function(){return Utility.CreateTipBoard("task",null,!0)},getCell:function(){if(this.colName=="Percentage"){var e=this.data[this.colName],t=$("<div>"),n=this.data.Status,r=t.c3progressWithStatus(function(e,t){return function(){t=="Failed"?r.setFailed(""):t=="Successful"?r.setValue(100,"100%"):r.setValue(e,e+"%")}}(e,n),{max:100,dur:c3config.Clocker-2,async:1,width:100,hwf:!0,showError:!0});return r.start(),t}return null}},f=$(r).gridview({delegate:o});return f.show(),f.rowSelectedEvent.push(function(){}),i.TaskDataGrid=f,i.data=u,n.append(a()),n.append(r),n}},c3login=function(){function t(){var t=$("<section>").attr({id:"login"}),r=localizedString("LOGIN_LABEL_USERID"),i=localizedString("LOGIN_LABEL_PASSWORD"),o=localizedString("LOGIN_LABEL_DOMAIN"),u=localizedString("LOGIN_BTN_LOGON"),a=localizedString("MISC_CANCEL"),f=localizedString("LOGIN_COPYRIGHT"),l=localizedString("LOGIN_PAGE_TLT");t.append($("<div>").addClass("subTitle").append($("<label>").append(l)));var c=$("<div>").addClass("loginMain");e.usernameCtrl=$("<input>").attr({id:"login_inputUsername",value:""});var h=$("<div>").addClass("chrome1").append($("<label>").append(r+": "));return h.append(e.usernameCtrl),c.append(h),e.passwordCtrl=$("<input>").attr({id:"login_inputPassword",type:"password",value:""}),h=$("<div>").addClass("chrome1").append($("<label>").append(i+": ")),h.append(e.passwordCtrl),c.append(h),e.rememberUid=$("<input>").attr({id:"login_rmbUid",type:"checkbox",value:""}).css({border:"2px solid #CBCBCB",width:"20px"}),h=$("<div>").addClass("chrome1").append($("<label>").append(" ")),h.append(e.rememberUid),h.append($("<span>").css({"padding-left":"5px"}).append(localizedString("LOGIN_REMEMBERUSERID"))),c.append(h),e.domainCtrl=$("<input>").attr({id:"login_inputDomain",value:""}),h=$("<div>").addClass("chrome1").append($("<label>")),h.append(e.domainCtrl),h=$("<div>").addClass("toolsbar"),e.btnOK=$("<input>").attr({id:"login_btnOK",type:"button",value:u}),e.btnCancel=$("<input>").attr({id:"login_btnCancel",type:"button",value:a}),h.append(e.btnOK),c.append(h),h=$("<div>").addClass("bottom").append(f),c.append(h),h=$("<div>").addClass("errorRegion"),e.errorRegion=h,e.errorCtrl=$("<label>").attr({id:"login_labelError"}),h.append(e.errorCtrl),c.append(h),e.btnOK.click(n),e.btnCancel.click(s),e.usernameCtrl.keydown(function(t){t.keyCode==13&&e.btnOK.focus()}),e.passwordCtrl.keydown(function(t){t.keyCode==13&&e.btnOK.focus()}),t.append(c),t}function n(){e.errorCtrl.text(""),e.errorRegion.css({opacity:0}),c3.service.login(e.usernameCtrl[0].value.trim(),e.passwordCtrl[0].value,i),e.loadingWin.show()}function r(){if(c3login.prototype.locked)window.setTimeout(r,1e3);else for(var t=0;t<e.onSuccess.length;t++)e.onSuccess[t]()}function i(t,n){e.loadingWin.close();var r=null;if(t.response){var i=JSON.parse(t.response);i.error&&i.error.message&&i.error.message.value&&(r=i.error.message.value)}if(n=="error"){if(t.status>=500||t.status==404){var s=function(t,n){e.errorCtrl.text(r)},u=function(e,t){o(),$("#nooperator").show(),$("#nooperatorlogout").click(function(){window.location.href="/sld/saml2/idp/slo"})},a={};a.success=u,a.error=s,c3.service.getCurrentUser().query(a)}else t.status>=400&&e.errorCtrl.text(r);e.errorRegion.css({opacity:1})}else t.d&&t.d.LogonBySystemUser?(c3.service.GenerateSecurityToken().query(function(e){window.localStorage&&window.localStorage.setItem("securityToken",e.data.GenerateSecurityToken)}),c3.service.RetriveSLDFullyDomainName({success:function(e){if(e.d.GetFullyDomainName&&window.localStorage){window.localStorage.setItem("SLDFullyAddress",e.d.GetFullyDomainName);var t=e.d.GetFullyDomainName.substring(e.d.GetFullyDomainName.indexOf("//")+2),n=t.lastIndexOf(":");n==-1&&(n=t.indexOf("/sld"));var r=t.substring(0,n),i=r.substring(0,r.indexOf("."));window.localStorage.setItem("SLDMachineName",i),r=r.substring(r.indexOf(".")),window.localStorage.setItem("SLDFullyDomainName",r)}},error:function(e){}}),notSAML()&&c3.service.checkResellerStatus({success:function(t){if(t.d.CheckResellerStatus==1){var i={success:function(t){$(e.rememberUid).attr("checked")==1&&(delCookie("USERID"),setCookie("USERID",e.usernameCtrl[0].value.trim())),n="success",o(),cometdManager.init();for(var r=0;r<e.onSuccess.length;r++)e.onSuccess[r]()},error:function(t){n="error",e.errorCtrl.text(localizedString("LOGIN_NO_PERMISSTION")),e.errorRegion.css({opacity:1})}};c3.service.getCurrentOperator().query(i)}else r=localizedString("ERR_RESELLER_INACTIVE"),c3.service.logout().query(function(){document.location.reload(),cometdManager.disconnect(),sessionStorage&&(sessionStorage.selectedIndex=c3config.DefaultSelectedPageIndex)}),e.errorCtrl.text(r),e.errorRegion.css({opacity:1})},error:function(t){c3.service.logout().query(function(){}),n="error",e.errorCtrl.text(localizedString("LOGIN_NO_PERMISSTION")),e.errorRegion.css({opacity:1})}})):(n="error",e.errorCtrl.text(localizedString("LOGIN_LOGIN_FAIL")),e.errorRegion.css({opacity:1}));n=="error"&&(e.usernameCtrl.focus(),e.usernameCtrl.select());for(var f=0;f<e.onFinish.length;f++)e.onFinish[f](t,n)}function s(){e.popWindow.close();for(var t=0;t<e.onCancel.length;t++)e.onCancel[t]()}function o(){c3login.prototype.locked=!1,e.popWindow.close()}var e=this;e.popWindow=null,this.show=function(){if(c3login.prototype.locked){r();return}c3login.prototype.locked=!0,e.popWindow=this.container.c3popwin(410,380,localizedString("LOGIN_PAGE_MAINTLT"),{close:!1,offsetByExist:!1});var n=getCookie("USERID");n!=null&&n.length>0?(e.usernameCtrl.val(n),setTimeout(function(){e.passwordCtrl.focus()},10)):setTimeout(function(){e.usernameCtrl.focus()},10)},e.onFinish=[],e.onSuccess=[],e.onCancel=[],this.container=t();var u=new loadingWindow;e.loadingWin=u};c3login.prototype={locked:!1};var c3ModuleManager={notifyMessage:function(e){for(var t=0,n=this.Listeners.length;t<n;t++)e.Key===this.Listeners[t].Key&&this.Listeners[t].Handler()},Listeners:[]};c3varRequest=function(){function f(){o.refreshPaging=!0;var e=new loadingWindow;e.show();var t=o.select.val(),n="",r=null;t.length>0&&t!="All"?(n="Task/Status eq '"+t+"'",r=c3.service.getVARRequests().filter(n)):r=c3.service.getVARRequests(),r.count().query(o.countHandler),Utility.SplitPage&&(r=r.orderby("ID desc").top(o.pageSize).skip(page*o.pageSize)),r.expand("Applicant, Processor, Task/TaskParameters, ApplicantGroup").query(function(t){t.data==null||t.data.length==0?(o.data=[],o.dataGrid.reload(),e.close()):c3.service.getResellers().expand("Group").query(function(n){var r=c3.service.convertData(t.data);if(n.data!=null&&n.data.length>0)for(var i=0;i<r.length;i++)for(var s=0;s<n.data.length;s++)if(r[i].ApplicantGroup_ID==n.data[s].Group.ID){r[i].VARName=n.data[s].Name;break}c3.service.getOSUserBindings().expand("User").query(function(t){if(t.data!=null&&t.data.length>0){for(var n=0;n<r.length;n++)if(r[n].Processor_ID!=null)for(var i=0;i<t.data.length;i++)if(r[n].Processor_ID==t.data[i].User.ID){r[n].Processor=t.data[i].SystemUser;break}p(r),e.close()}else p(r),e.close()})})})}function l(){var e=$("<option>").attr({title:localizedString("ALL"),selected:!0}).append(localizedString("ALL")).val("All"),t=$("<option>").attr({title:localizedString("WAITINGFORAPPROVAL"),selected:!0}).append(localizedString("WAITINGFORAPPROVAL")).val("WaitingForApproval"),n=$("<option>").attr("title",localizedString("SUCCESSFUL")).append(localizedString("SUCCESSFUL")).val("Successful"),r=$("<optgroup>").attr({label:" ==================="}),i=$("<option>").attr("title",localizedString("CANCELLED")).append(localizedString("CANCELLED")).val("Cancelled"),s=$("<option>").attr("title",localizedString("REJECTED")).append(localizedString("REJECTED")).val("Rejected"),u=$("<option>").attr("title",localizedString("FAILED")).append(localizedString("FAILED")).val("Failed");o.select.append(e).append(t).append(n).append(r).append(i).append(s).append(u)}function c(){var t=$("<section>").attr({id:e+"_toolbar"}).addClass("tools"),n=$("<input>").attr({value:s,type:"button",id:e+"btnReview"}),r=$("<a>").attr({href:"#",id:"btnRefresh_"+e,title:"Refresh"}).addClass("refresh"),i=$("<select>").attr({id:"filterRequests"}).css({"float":"left"}).change(function(){o.reload()});o.select=i,l();var f=localizedString("SLDCLIENT_TLT");o.btnReview=n,v(),n.click(function(){var e=u;if(e!=null&&e.Task_TaskParameters!=null&&e.Task_TaskParameters.length>0){var t=null;for(var n=0;n<e.Task_TaskParameters.length;n++)if(e.Task_TaskParameters[n].Name=="ExtraData"){t=e.Task_TaskParameters[n].Value;break}if(t!=null&&t.length>0){var r=utf8Decode(t),i=JSON.parse(r);if(e!=null){var s=new c3taskReview(o,i,e.Task_TaskType,e);s.show(),u=null,a=0,v()}}}}),r.click(function(){o.reload()}),t.append(n);var c=new searchbox({inputCallback:function(e){return o.dataGrid.searchText(e)}}),h=(new Split).dom;return t.append($("<div>").css({"float":"right"}).append(i).append(h.css({"float":"left"})).append(c.css({"float":"left"})).append(r)),t}function h(){var t=$("<section>").attr({id:e+"_masterDataGrid"}),n=[{name:"Task_Status",description:localizedString("MISC_STATUS"),type:"text",width:"12%"},{name:"VARName",description:localizedString("VARREQUESTS_COLUMN_VAR"),type:"text",width:"14%"},{name:"Processor",description:localizedString("TRIAL_LABEL_PROCESSOR"),type:"text",width:"16%"},{name:"Task_TaskType",description:localizedString("VARREQUESTS_COLUMN_OPTTYPE"),type:"text",width:"16%"},{name:"Comments",description:localizedString("VARREQUESTS_COLUMN_COM"),type:"text",width:"18%"},{name:"CreateDate",description:localizedString("VARREQUESTS_COLUMN_DATE"),type:"text",width:"14%"},{name:"Review",description:localizedString("RES_DETAILS"),type:"text",width:"10%"}];o.data=[];var r={pagingMode:!0,pageSize:o.pageSize,autoResize:function(){return 540},getHeaderSpec:function(){return n},getRowCount:function(){return o.data.length},getRow:function(e){return o.data[e]},getGridHeight:function(){return Utility.MasterTableHeight*1.8},getDefaultSelectedIndex:function(){return a},getTip:function(){return Utility.CreateTipBoard(localizedString("RESELLER_4VAR_GRID_VARREQUEST_EPT"),!1,null)},getCell:function(){var e=null,t=this.data;if(this.colName=="Task_TaskType")e=$("<span>").html(localizedString(this.data.Task_TaskType.toUpperCase()));else if(this.colName=="Task_Status")e=$("<span>").html(localizedString(this.data.Task_Status.toUpperCase()));else if(this.colName=="CreateDate")this.data["CreatedDate"]!=null&&this.data.CreatedDate.length>0&&(e=$("<span>").html(convertToFamatDateTime(this.data.CreatedDate)));else if(this.colName=="Review"){var n=$("<a>").attr({href:"#"}).text(localizedString("RES_DETAILS"));return n.click(function(){return function(e){if(e!=null&&e.Task_TaskParameters!=null&&e.Task_TaskParameters.length>0){var t=null;for(var n=0;n<e.Task_TaskParameters.length;n++)if(e.Task_TaskParameters[n].Name=="ExtraData"){t=e.Task_TaskParameters[n].Value;break}if(t!=null&&t.length>0){var r=utf8Decode(t),i=JSON.parse(r);if(e!=null){var s=new c3taskReview(o,i,e.Task_TaskType,e);s.show()}}}}(t)}),n}return e},getTotalCount:function(){return o.totalCount},loadPage:function(e,t){c3.service.getVARRequests().orderby("ID desc").skip(e).top(t).query({success:function(e){o.data.clear();for(var t=0;t<e.data.length;t++)o.data.push(e.data[t]);o.data=c3.service.convertData(o.data),m(a),o.dataGrid.refreshContent()},error:function(e){o.loadingWindow.close()}})}};o.gridDelegate=r;var i=$(t).gridview({delegate:r});return i.rowSelectedEvent.push(function(){a!=this.index&&m(this.index),d()}),o.dataGrid=i,t}function p(e){o.data=e,o.dataGrid.reload(),o.data.length>0&&a!=-1?m(a):m(0),o.data.length==0?v():a==-1?v():d()}function d(){u!=null&&u.Task_Status!="WaitingForApproval"?o.btnReview.attr({disabled:1}):o.btnReview.removeAttr("disabled")}function v(){o.btnReview.attr({disabled:1})}function m(e){a=e,u=o.data[e]}this.base=c3.module,this.base();var e="varrequest",t=$("<section>").attr({id:e}),n=localizedString("VARREQUESTS"),r=localizedString("TRIAL_BTN_APPROVE"),i=localizedString("TRIAL_BTN_REJECT"),s=localizedString("TRIAL_BTN_REVIEW"),o=this,u=null,a=0;page=0,o.id=e,o.pageSize=10,o.totalCount=0,o.refreshPaging=!1,this._container=t,this._title=n,this.onInit=function(){t.append($("<div>").attr("class","title_panel").append(n)),t.append(c()),t.append(h()),f()},this.onInitNotification=function(){cometdManager.subscribe(sldEntitySet.TaskOperationRequests,function(e){o.reload()})},this.onViewAppear=function(){o.dataGrid.show()},this.getTitle=function(){return n},o.countHandler={success:function(e){o.totalCount=parseInt(e.data,10)},error:function(e){}},this.reload=f};var suManager={createServiceUnit:function(e){var t=arguments[1],n={name:e.Name,version:e.Version,serverType:e.ServerType,description:e.Description,status:e.Status,mode:e.Mode||"",purpose:e.Purpose,commonDatabase:{id:e.CommDB.ID,name:e.CommDB.Name,databaseInstance:{id:e.DBServerInstance.ID}},licenseServer:{id:e.LicenseServer.ID},sharedFolder:{id:e.SharedFolder.ID},applicationServers:function(){var t=[];if(e.PresentationServers&&e.PresentationServers.length>0)for(var n=0,r=e.PresentationServers.length;n<r;n++)t.push({id:e.PresentationServers[n].ID});return t}(),browserAccessServers:function(){var t=[];if(e.BrowserAccessServers&&e.BrowserAccessServers.length>0)for(var n=0,r=e.BrowserAccessServers.length;n<r;n++)t.push({id:e.BrowserAccessServers[n].ID});return t}(),softwareRepository:{id:e.InstallationPackageRepository.ID},tenantsStorage:{id:e.TenantsStorage.ID},mailer:e.Mailer!=null&&e.Mailer.ID>0?{id:e.Mailer.ID}:null,integrationComponent:e.B1iServer!=null&&e.B1iServer.ID>0?{id:e.B1iServer.ID}:null,AnalyticsService:e.AnalyticsService!=null&&e.AnalyticsService.ID>0?{id:e.AnalyticsService.ID}:null,XAppService:e.XAppService!=null&&e.XAppService.ID>0?{id:e.XAppService.ID}:null,implementationRepository:e.PackageRepositoty!=null&&e.PackageRepositoty.ID>0?{id:e.PackageRepositoty.ID}:null,companyTemplateRepository:e.CompanyTemplateRepositoty!=null&&e.CompanyTemplateRepositoty.ID>0?{id:e.CompanyTemplateRepositoty.ID}:null,clientAgentServiceAccount:e.ClientAgentServiceAccount&&{userName:e.ClientAgentServiceAccount.UserName,password:e.ClientAgentServiceAccount.Password}};c3.service.createHostingUnit(n,t)},getSoftwareComponentsBySU:function(e){var t=arguments[1],n={};n.data={};var r=[],i=-1,s={success:function(e){if(null!=e.data&&e.data.length>0){e.data=e.data[0];var s=!1;null!=e.data.IntegrationComponent&&(r[++i]={ID:e.data.IntegrationComponent.ID,Name:e.data.IntegrationComponent.Name,Status:e.data.IntegrationComponent.Status,Type:"RES_B1I_SERVER",LifeCycleStatus:e.data.IntegrationComponent.LifeCycleStatus}),null!=e.data.AnalyticsService&&(r[++i]={ID:e.data.AnalyticsService.ID,Name:e.data.AnalyticsService.Name,Status:e.data.AnalyticsService.Status,Type:"RES_B1AH_SERVER",LifeCycleStatus:e.data.AnalyticsService.LifeCycleStatus}),null!=e.data.XAppService&&(r[++i]={ID:e.data.XAppService.ID,Name:e.data.XAppService.Name,Status:e.data.XAppService.Status,Type:"RES_XAPP_SERVICE",LifeCycleStatus:e.data.XAppService.LifeCycleStatus}),null!=e.data.LicenseServer&&(r[++i]={ID:e.data.LicenseServer.ID,Name:e.data.LicenseServer.Name,Status:e.data.LicenseServer.Status,Type:"RES_LIC_SERVER",LifeCycleStatus:e.data.LicenseServer.LifeCycleStatus}),null!=e.data.Mailer&&(r[++i]={ID:e.data.Mailer.ID,Name:e.data.Mailer.Name,Status:e.data.Mailer.Status,Type:"RES_MAILER_SERVICE",LifeCycleStatus:e.data.Mailer.LifeCycleStatus});if(null!=e.data.PresentationServers&&0<e.data.PresentationServers.results.length){s=!0;for(var o=0;o<e.data.PresentationServers.results.length;o++)r[++i]={ID:e.data.PresentationServers.results[o].ID,Name:e.data.PresentationServers.results[o].Name,Status:e.data.PresentationServers.results[o].Status,Type:"RES_PRESENTATION_SERVER",LifeCycleStatus:e.data.PresentationServers.results[o].LifeCycleStatus,Version:e.data.PresentationServers.results[o].Version,MachineID:e.data.PresentationServers.results[o].Machine.ID,MachineName:e.data.PresentationServers.results[o].Machine.Hostname}}if(null!=e.data.B1WebServers&&0<e.data.B1WebServers.results.length){s=!0;for(var o=0;o<e.data.B1WebServers.results.length;o++)r[++i]={ID:e.data.B1WebServers.results[o].ID,Name:e.data.B1WebServers.results[o].Name,Status:e.data.B1WebServers.results[o].Status,Type:"RES_BROWSERACCESS_SERVER",LifeCycleStatus:e.data.B1WebServers.results[o].LifeCycleStatus,Version:e.data.B1WebServers.results[o].Version,MachineID:e.data.B1WebServers.results[o].Machine.ID,MachineName:e.data.B1WebServers.results[o].Machine.Hostname}}null!=e.data.CommonDatabase&&e.data.CommonDatabase.DatabaseInstance&&(r[++i]={ID:e.data.CommonDatabase.DatabaseInstance.ID,Name:e.data.CommonDatabase.DatabaseInstance.Name,Status:e.data.CommonDatabase.DatabaseInstance.Status,Type:"RES_MS_SQL",LifeCycleStatus:e.data.CommonDatabase.DatabaseInstance.LifeCycleStatus})}n.data=r,s?c3.service.retrieveWorkstations().query(function(e){if(e.data&&e.data.length>0)for(var r=0;r<n.data.length;r++){if(n.data[r].Type!="RES_PRESENTATION_SERVER"&&n.data[r].Type!="RES_BROWSERACCESS_SERVER")continue;for(var i=0;i<e.data.length;i++)n.data[r].MachineName==e.data[i].Hostname&&(n.data[r].SLDAgentStatus=e.data[i].Status)}t(n)}):t(n)},error:function(e){t(n)}};c3.service.getHostingUnits().filter("ID eq "+e).expand("IntegrationComponent,LicenseServer,Mailer,AnalyticsService,XAppService,PresentationServers/Machine,CommonDatabase/DatabaseInstance, B1WebServers/Machine").query(s)},getStoragesBySU:function(e){var t=arguments[1],n={};n.data={};var r=[],i=-1,s={success:function(e){null!=e.data&&e.data.length>0&&(e.data=e.data[0],null!=e.data.SharedFolder&&(r[++i]={ID:e.data.SharedFolder.ID,Path:e.data.SharedFolder.URI,Status:e.data.SharedFolder.Status,Type:"RES_SH_FOLDER"}),null!=e.data.TenantsStorage&&(r[++i]={ID:e.data.TenantsStorage.ID,Path:e.data.TenantsStorage.URI,Status:e.data.TenantsStorage.Status,Type:"RES_TENANTS_STORAGE"}),null!=e.data.ImplementationRepository&&(r[++i]={ID:e.data.ImplementationRepository.ID,Path:e.data.ImplementationRepository.URI,Status:e.data.ImplementationRepository.Status,Type:"RES_IMPL_RSTY"}),null!=e.data.CompanyTemplateRepository&&(r[++i]={ID:e.data.CompanyTemplateRepository.ID,Path:e.data.CompanyTemplateRepository.URI,Status:e.data.CompanyTemplateRepository.Status,Type:"RES_COMP_TEMP_RSTY"})),n.data=r,t(n)},error:function(e){t(n)}};c3.service.getHostingUnits().filter("ID eq "+e).expand("ImplementationRepository,CompanyTemplateRepository,SharedFolder,TenantsStorage").query(s)},getExtensionsByCommonDB:function(e){var t=arguments[1],n={},r=[];n.data={};var i={success:function(e){if(e.data&&null!=e.data)for(var i=0;i<e.data.length;i++)r.push({ID:e.data[i].ID,ExtensionID:e.data[i].Extension.ID,Name:e.data[i].Extension.Name,Version:e.data[i].Extension.Version,Vendor:e.data[i].Extension.Vendor,ExtensionStatus:e.data[i].Extension.Status,Status:e.data[i].Status,IsBuiltIn:e.data[i].Extension.IsBuiltIn,Type:convertToDisplayExtensionType(e.data[i].Extension.Type),IsTraditional:isTraditionalAddOn(e.data[i].Extension.Type),Tenant:e.data[i].Assignments.results.length,Properties:e.data[i].AuxiliaryProperties.results,__metadata:e.data[i].__metadata.uri});n.data=r,t(n)},error:function(e){t(n)}};c3.service.getExtensionDeployments().expand("Extension,Assignments/CompanyDatabase,AuxiliaryProperties").filter("CommonDatabase/ID eq "+e+" and (Extension/Type eq '"+sldEntity.ExtensionType.Addon+"' or Extension/Type eq '"+sldEntity.ExtensionType.Lightweight+"' or Extension/Type eq '"+sldEntity.ExtensionType.LightweightMV+"' or Extension/Type eq '"+sldEntity.ExtensionType.XApp+"' or Extension/Type eq '"+sldEntity.ExtensionType.LightweightXApp+"')").query(i)},getHigherVersionBySUnit:function(e,t){c3.service.getHigherVersionBySUnit(e,t)},PreUpgradeTesting:function(e,t,n){c3.service.PreUpgradeTesting(e,t,n)},createServiceUnitViaReference:function(e,t,n){var r=arguments[3],i={name:e.Name,version:e.Version,serverType:e.ServerType,description:e.Description,status:e.Status,mode:e.Mode||"",purpose:e.Purpose,commonDatabase:{id:e.SBOCommon.ID,name:e.SBOCommon.Name,databaseInstance:{id:e.DBServerInstance.ID}},licenseServer:{id:e.LicenseServer.ID},sharedFolder:{id:e.SharedFolder.ID},applicationServers:function(){var t=[];if(e.PresentationServers&&e.PresentationServers.length>0)for(var n=0,r=e.PresentationServers.length;n<r;n++)t.push({id:e.PresentationServers[n].ID});return t}(),browserAccessServers:function(){var t=[];if(e.BrowserAccessServers&&e.BrowserAccessServers.length>0)for(var n=0,r=e.BrowserAccessServers.length;n<r;n++)t.push({id:e.BrowserAccessServers[n].ID});return t}(),softwareRepository:{id:e.InstallationPackageRepository.ID},tenantsStorage:{id:e.TenantsStorage.ID},mailer:e.Mailer!=null&&e.Mailer.ID>0?{id:e.Mailer.ID}:null,integrationComponent:e.B1iServer!=null&&e.B1iServer.ID>0?{id:e.B1iServer.ID}:null,implementationRepository:e.PackageRepositoty!=null&&e.PackageRepositoty.ID>0?{id:e.PackageRepositoty.ID}:null,companyTemplateRepository:e.CompanyTemplateRepositoty!=null&&e.CompanyTemplateRepositoty.ID>0?{id:e.CompanyTemplateRepositoty.ID}:null,referenceServiceUnitID:t.ID,clientAgentServiceAccount:e.ClientAgentServiceAccount&&{userName:e.ClientAgentServiceAccount.UserName,password:e.ClientAgentServiceAccount.Password}};if(n&&n.length>0){i.Extensions=[];for(var s=0;s<n.length;s++)i.Extensions.push({ID:n[s].ID})}c3.service.createServiceUnitFromReference(i,r)},validateClientAgentServiceAccount:function(e,t){c3.service.validateClientAgentServiceAccount(e,t)},getUpgradeSimulations:function(e,t){options={success:function(e){var n=[];e!=null&&e.d!=null&&e.d.results!=null&&(n=e.d.results),t(n)},error:function(e){}},c3.service.getLastUpgradeSimulations(e,options)}},tenantManager={createTenant:function(e,t){var n=arguments[2]||{},r={customer:{name:e.Customer.Name,type:e.Customer.Type,installationNumber:e.Customer.InstallationNumber,status:e.Customer.Status},serviceunit:{status:e.ServiceUnit.Status,name:e.ServiceUnit.Name,purpose:e.ServiceUnit.Purpose,version:e.ServiceUnit.Version},tenantInfo:{name:e.CompanyDatabase.Name,dbname:e.CompanyDatabase.DBName,purpose:e.Purpose,contactPerson:e.ContactPerson,phone:e.Phone,email:e.Email,localSettings:e.CompanyDatabase.LocalizationTxt,coa:e.CompanyDatabase.COA,baseLan:e.CompanyDatabase.BaseLanguageTxt,description:e.Description,pCode:e.CompanyDatabase.PCode,pName:e.CompanyDatabase.PName,pSubType:e.CompanyDatabase.PSubType,pNum:e.CompanyDatabase.PNum,pStartDate:e.CompanyDatabase.PStart,pEndDate:e.CompanyDatabase.PEnd},users:function(){var n=[];for(var r=0;r<e.Users.length;r++){var i="";if(e.Users[r].LicenseModules!=null&&e.Users[r].LicenseModules.length>0)for(var s=0;s<e.Users[r].LicenseModules.length;s++){var o="";for(var u=0;u<t.length;u++)if(t[u].Type==e.Users[r].LicenseModules[s]){o=t[u].Description;break}s<e.Users[r].LicenseModules.length-1?i+=o+", ":i+=o}var a=localizedString("B1_NORMALUSER");e.Users[r].IsPowerUser==1&&(a=localizedString("B1_POWERUSER")),e.Users[r].IsSuperUser==1&&(a=localizedString("B1_SUPERUSER")),n.push({SystemUser:e.Users[r].SystemUser,UserCode:e.Users[r].SBOUser,UserType:a,LicenseModulesString:i})}return n}()},i={purpose:e.Purpose,contactPerson:e.ContactPerson,phone:e.Phone,email:e.Email,description:e.Description,customerID:e.Customer.ID,companyDatabase:{companyName:e.CompanyDatabase.Name,creationOption:e.CompanyDatabase.creationOption,trialPeriod:e.CompanyDatabase.TrialPeriod,name:e.CompanyDatabase.DBName,localization:e.CompanyDatabase.Localization,chartOfAccounts:e.CompanyDatabase.COA,periodSubType:e.CompanyDatabase.PSubType,periodStartDate:e.CompanyDatabase.PStart,periodEndDate:e.CompanyDatabase.PEnd,periodCode:e.CompanyDatabase.PCode,periodName:e.CompanyDatabase.PName,periodNumber:e.CompanyDatabase.PNum,defaultLang:e.CompanyDatabase.BaseLanguage,packageFilePath:e.CompanyDatabase.PackageFile,backupFilePath:e.CompanyDatabase.BackupFile,isTrustedConnection:e.CompanyDatabase.IsTrustedConnection},serviceUnit:{id:e.ServiceUnit.ID},licenseFile:function(){var t=null;return e.LicenseFile&&(t={id:e.LicenseFile.ID}),t}(),users:function(){var t=[];if(e.Users&&e.Users.length>0)for(var n=0;n<e.Users.length;n++)t.push({status:e.Users[n].Status,systemUsername:e.Users[n].SystemUser,sboUsername:e.Users[n].SBOUser,isSuperSBOUser:Boolean(e.Users[n].IsSuperUser),isPowerSBOUser:Boolean(e.Users[n].IsPowerUser),licenseModules:function(){var t=[];if(e.Users[n].LicenseModules)for(var r=0;r<e.Users[n].LicenseModules.length;r++)t.push({type:e.Users[n].LicenseModules[r]});else t=null;return t}()});return t}()};i.extraData=utf8Encode(JSON.stringify(r)),c3.service.createTenant(i,n)},registerTenant:function(e,t){var n=arguments[2]||{},r={customer:{name:e.Customer.Name,type:e.Customer.Type,installationNumber:e.Customer.InstallationNumber,status:e.Customer.Status},serviceunit:{status:e.ServiceUnit.Status,name:e.ServiceUnit.Name,purpose:e.ServiceUnit.Purpose,version:e.ServiceUnit.Version},tenantInfo:{name:e.CompanyDatabase.Name,dbname:e.CompanyDatabase.DBName,purpose:e.Purpose,contactPerson:e.ContactPerson,phone:e.Phone,email:e.Email,localSettings:e.CompanyDatabase.LocalizationTxt,coa:e.CompanyDatabase.COA,baseLan:e.CompanyDatabase.BaseLanguageTxt,description:e.Description,pCode:e.CompanyDatabase.PCode,pName:e.CompanyDatabase.PName,pSubType:e.CompanyDatabase.PSubType,pNum:e.CompanyDatabase.PNum,pStartDate:e.CompanyDatabase.PStart,pEndDate:e.CompanyDatabase.PEnd},users:function(){var n=[];for(var r=0;r<e.Users.length;r++){var i="";if(e.Users[r].LicenseModules!=null&&e.Users[r].LicenseModules.length>0)for(var s=0;s<e.Users[r].LicenseModules.length;s++){var o="";for(var u=0;u<t.length;u++)if(t[u].Type==e.Users[r].LicenseModules[s]){o=t[u].Description;break}s<e.Users[r].LicenseModules.length-1?i+=o+", ":i+=o}var a=localizedString("B1_NORMALUSER");e.Users[r].IsPowerUser==1&&(a=localizedString("B1_POWERUSER")),e.Users[r].IsSuperUser==1&&(a=localizedString("B1_SUPERUSER")),n.push({SystemUser:e.Users[r].SystemUser,UserCode:e.Users[r].SBOUser,UserType:a,LicenseModulesString:i})}return n}()},i={purpose:e.Purpose,contactPerson:e.ContactPerson,phone:e.Phone,email:e.Email,description:e.Description,customerID:e.Customer.ID,companyDatabase:{companyName:e.CompanyDatabase.Name,creationOption:e.CompanyDatabase.creationOption,trialPeriod:e.CompanyDatabase.TrialPeriod,name:e.CompanyDatabase.DBName,localization:e.CompanyDatabase.Localization,chartOfAccounts:e.CompanyDatabase.COA,periodSubType:e.CompanyDatabase.PSubType,periodStartDate:e.CompanyDatabase.PStart,periodEndDate:e.CompanyDatabase.PEnd,periodCode:e.CompanyDatabase.PCode,periodName:e.CompanyDatabase.PName,periodNumber:e.CompanyDatabase.PNum,defaultLang:e.CompanyDatabase.BaseLanguage,packageFilePath:e.CompanyDatabase.PackageFile,backupFilePath:e.CompanyDatabase.BackupFile,isTrustedConnection:e.CompanyDatabase.IsTrustedConnection},serviceUnit:{id:e.ServiceUnit.ID},licenseFile:function(){var t=null;return e.LicenseFile&&(t={id:e.LicenseFile.ID}),t}(),users:function(){var t=[];if(e.Users&&e.Users.length>0)for(var n=0;n<e.Users.length;n++)t.push({status:e.Users[n].Status,systemUsername:e.Users[n].SystemUser,sboUsername:e.Users[n].SBOUser,isSuperSBOUser:Boolean(e.Users[n].IsSuperUser),isPowerSBOUser:Boolean(e.Users[n].IsPowerUser),licenseModules:function(){var t=[];if(e.Users[n].LicenseModules)for(var r=0;r<e.Users[n].LicenseModules.length;r++)t.push({type:e.Users[n].LicenseModules[r]});else t=null;return t}()});return t}()};i.extraData=utf8Encode(JSON.stringify(r)),c3.service.registerTenant(i,n)},updateTenantByBatch:function(e,t,n){if(e.ExtendTrial){var r=e.ExtendTrial;delete e.ExtendTrial,c3.service.setTrialPeriod(t,parseInt(r),function(){})}if(e!=null){var i={};e.Authentication_Type==localizedString("RESPOOL_DBINSTANCE_COLUMN_WINDOWSAUTHENTICATIN")?i.IsTrustedConnection=!0:e.Authentication_Type==localizedString("RESPOOL_DBINSTANCE_COLUMN_SQLAUTHENTICATIN")&&(i.IsTrustedConnection=!1)}e.CompanyDatabase=i,e.Authentication_Type=undefined,c3.service.updateTenant(e,n)},createTenantUser:function(e,t,n){if(t&&t.length>0){var r=[];for(var i=0;i<t.length;i++){var s={systemUsername:t[i].SystemUsername,sboUsername:t[i].B1Username,isSuperSBOUser:Boolean(t[i].SuperUser),isPowerSBOUser:Boolean(t[i].PowerUser),roles:[{id:2}],status:t[i].Status};r.push(s)}c3.service.createTenantUser(e,r,n)}},loadTenantUsers:function(e){var t=arguments[1];if(e!==undefined&&e.ID!==undefined){e.Users=[];var n={};n.success=function(n){n.data&&n.data.length>0&&n.data[0].Group?c3.service.getTenantUsers(n.data[0].ID).query(function(n){var r=n.data;e.Users.LicenseModules=e.Users.LicenseModules==undefined?[]:e.Users.LicenseModules,e.Users.LicenseModules.clear(),e.Users=[];for(var i=0,s=r.length;i<s;i++){var o="Normal User";r[i].IsPowerSBOUser==1&&(o="Power User"),r[i].IsSuperSBOUser==1&&(o="Super User"),e.Users.push({Status:r[i].Status,Name:r[i].SystemUsername,B1UserName:r[i].SBOUsername?r[i].SBOUsername:"",B1UserType:o,IsSuperUser:r[i].IsSuperSBOUser,IsPowerUser:r[i].IsPowerSBOUser,Id:r[i].ID,RoleId:r[i].Roles.results&&r[i].Roles.results.length>0?r[i].Roles.results[0].ID:"",LicenseAssigns:function(){var e="";if(r[i].LicenseModules&&r[i].LicenseModules.results){for(var t=0;t<r[i].LicenseModules.results.length;t++)e+=r[i].LicenseModules.results[t].Description+";";e!=""&&(e=e.substring(0,e.length-1))}return e}(),LicenseModules:function(){var e=[];if(r[i].LicenseModules&&r[i].LicenseModules.results)for(var t=0;t<r[i].LicenseModules.results.length;t++)e.push(r[i].LicenseModules.results[t].Type);return e}()})}t()}):t()},n.error=function(e){t()},c3.service.getTenants().filter("ID eq "+e.ID).expand("Group").query(n)}else t()},getSolutionPackageFiles:function(e){var t=arguments[1],n={success:function(e){var n=e.data,r=[];for(var i=0;i<n.length;i++)r[i]={SolutionName:n[i].FileName,Path:n[i].Path};t&&t(r)},error:function(){var e=[];t&&t(e)}};c3.service.getSolutionPackageFiles(e).query(n)},getSolutionPackageInformation:function(e){var t=arguments[1],n=function(e){var n=e.data.GetResult,r=JSON.parse(n),i={Path:r.Path,BaseLanguage:r.baseLanguage,CreationDate:r.creationDate,IndustrySpecific:r.industrySpecific,FileName:r.fileName,FolderPath:r.folderPath,SolutionName:r.name,Industry:r.industry,Country:r.country,Version:r.version,B1Version:r.b1Version,LocalSettings:r.localSettings,Vendor:r.vendor,COA:r.coa};t&&t(i)};c3.service.getTaskResult(e).query(n)},getSolutionPackageContent:function(e,t){var n=arguments[2],r=function(e){var t=e.d.GetSolutionPackageContentAsync;n&&n(t)};c3.service.getSolutionPackageContent(e,t,r)},getUserPreferenceByAssignment:function(e){var t=arguments[1],n={},r=[];n.data={};var i={success:function(e){if(e.data&&null!=e.data)for(var i=0;i<e.data.length;i++)r.push({ID:e.data[i].ID,UserName:e.data[i].SBOUser==undefined?"No User":e.data[i].SBOUser.SBOUsername,StartupMode:e.data[i].StartupMode,ExtensionAssignment:e.data[i].ExtensionAssignment.__metadata.uri});n.data=r,t(n)},error:function(e){t(n)}};c3.service.getUserPreference().expand("ExtensionAssignment, SBOUser").filter("ExtensionAssignment/ID eq "+e).orderby("SBOUser/SBOUsername desc").query(i)},getExtensionByCompanyDB:function(e){var t=arguments[1],n={},r=[];n.data={};var i={success:function(e){if(e.data&&null!=e.data)for(var i=0;i<e.data.length;i++)r.push({ID:e.data[i].ID,ExtensionID:e.data[i].ExtensionDeployment.Extension.ID,Name:e.data[i].ExtensionDeployment.Extension.Name,Version:e.data[i].ExtensionDeployment.Extension.Version,Vendor:e.data[i].ExtensionDeployment.Extension.Vendor,Status:e.data[i].Status,StartupMode:e.data[i].StartupMode,SharedFolder:e.data[i].SharedFolder,Enabled:e.data[i].Enabled?localizedString("MISC_ENABLED"):localizedString("MISC_DISABLED"),Properties:e.data[i].AuxiliaryProperties.results,Type:convertToDisplayExtensionType(e.data[i].ExtensionDeployment.Extension.Type)});n.data=r,t(n)},error:function(e){t(n)}};c3.service.getExtensionAssignments().expand("ExtensionDeployment/Extension,ExtensionDeployment/Assignments,AuxiliaryProperties ").filter("(CompanyDatabase/ID eq "+e+" and (ExtensionDeployment/Extension/Type eq '"+sldEntity.ExtensionType.Addon+"' or ExtensionDeployment/Extension/Type eq '"+sldEntity.ExtensionType.Lightweight+"' or ExtensionDeployment/Extension/Type eq '"+sldEntity.ExtensionType.LightweightMV+"' or ExtensionDeployment/Extension/Type eq '"+sldEntity.ExtensionType.XApp+"' or ExtensionDeployment/Extension/Type eq '"+sldEntity.ExtensionType.LightweightXApp+"'))").query(i)},getCompanyTemplateRepositoriesByID:function(e){var t=arguments[1],n={success:function(e){var n=e.data,r=[];for(var i=0;i<n.length;i++)r[i]={BackupName:n[i].Name,Path:n[i].Path,Version:n[i].Version,Localization:n[i].Localization,isHANA:n[i].IsHANADB};t&&t(r)},error:function(){var e=[];t&&t(e)}};return c3.service.getCompanyTemplateRepositoriesByID(e).query(n)},getNumberOfServiceUnitBySoftwareRepositoryID:function(e,t){c3.service.getHostingUnits().filter("SoftwareRepository/ID eq "+e).count().query(t)},getLastPreUpgradeTestingResult:function(e,t,n,r){c3.service.getLastPreUpgradeTestingResult(e,t,n,r)},MoveTenantAsync:function(e,t,n){c3.service.MoveTenantAsync(e,t,n)},UpgradeTenantAsync:function(e,t){c3.service.UpgradeTenantAsync(e,t)},MoveAndUpgradeTenantAsync:function(e,t,n,r,i,s,o,u){c3.service.MoveAndUpgradeTenantAsync(e,t,n,r,i,s,o,u)},DuplicateTeant:function(e,t,n,r,i){c3.service.DuplicateTenantAsync(e,t,n,r,i)}},customerManager={createCustomer:function(e){var t=arguments[1]||{},n={name:e.Name,type:e.Type,trialRequestID:e.TrialRequestID,contactPerson:e.ContactPerson,phone:e.Phone,email:e.Email,location:e.Location,country:e.Country,industry:e.Industry,employeeCount:e.EmployeeCount||0,description:e.Description,installationNumber:e.InstallationNumber,users:function(){var t=[];for(var n=0;n<e.Users.length;n++)t.push({systemUsername:e.Users[n].SystemUser,status:e.Users[n].Status,domain:e.Users[n].Domain});return t}(),tenants:function(){var t=[];if(e.Tenants&&e.Tenants.length>0)for(var n=0;n<e.Tenants.length;n++)t.push({purpose:e.Tenants[n].Purpose,contactPerson:e.Tenants[n].ContactPerson,phone:e.Tenants[n].Phone,email:e.Tenants[n].Email,description:e.Tenants[n].Description,serviceUnit:{id:e.Tenants[n].ServiceUnit.ID,name:e.Tenants[n].ServiceUnit.Name,status:e.Tenants[n].ServiceUnit.Status,purpose:e.Tenants[n].ServiceUnit.Purpose},licenseFile:function(){var t=null;return e.Tenants[n].LicenseFile&&(t={id:e.Tenants[n].LicenseFile.ID}),t}(),companyDatabase:{companyName:e.Tenants[n].CompanyDatabase.Name,creationOption:e.Tenants[n].CompanyDatabase.creationOption,trialPeriod:e.Tenants[n].CompanyDatabase.TrialPeriod,name:e.Tenants[n].CompanyDatabase.DBName,localization:e.Tenants[n].CompanyDatabase.Localization,chartOfAccounts:e.Tenants[n].CompanyDatabase.COA,defaultLang:e.Tenants[n].CompanyDatabase.BaseLanguage,periodCode:e.Tenants[n].CompanyDatabase.PCode,periodName:e.Tenants[n].CompanyDatabase.PName,periodSubType:e.Tenants[n].CompanyDatabase.PSubType,periodNumber:e.Tenants[n].CompanyDatabase.PNum,periodStartDate:e.Tenants[n].CompanyDatabase.PStart,periodEndDate:e.Tenants[n].CompanyDatabase.PEnd,isTrustedConnection:e.Tenants[n].CompanyDatabase.IsTrustedConnection,packageFilePath:e.Tenants[n].CompanyDatabase.PackageFile,backupFilePath:e.Tenants[n].CompanyDatabase.BackupFile},users:function(){var t=[];if(e.Tenants[n].Users&&e.Tenants[n].Users.length>0)for(var r=0;r<e.Tenants[n].Users.length;r++)t.push({status:e.Tenants[n].Users[r].Status,systemUsername:e.Tenants[n].Users[r].SystemUser,sboUsername:e.Tenants[n].Users[r].SBOUser,isSuperSBOUser:Boolean(e.Tenants[n].Users[r].IsSuperUser),isPowerSBOUser:Boolean(e.Tenants[n].Users[r].IsPowerUser),licenseModules:function(){var t=[];if(e.Tenants[n].Users[r].LicenseModules)for(var s=0;s<e.Tenants[n].Users[r].LicenseModules.length;s++)t.push({type:e.Tenants[n].Users[r].LicenseModules[s]});else t=null;return t}(),userType:function(){var t=localizedString("B1_NORMALUSER");return Boolean(e.Tenants[n].Users[r].IsPowerUser)==1&&(t=localizedString("B1_POWERUSER")),Boolean(e.Tenants[n].Users[r].IsSuperUser)==1&&(t=localizedString("B1_SUPERUSER")),t}(),licenseModulesString:function(){if(e.Tenants[n].Users[r].LicenseModules){var t="";for(var s=0;s<e.Tenants[n].Users[r].LicenseModules.length;s++)s<e.Tenants[n].Users[r].LicenseModules.length-1?t+=e.Tenants[n].Users[r].LicenseModules[n]+", ":t+=e.Tenants[n].Users[r].LicenseModules[n];return t}return null}()});return t}()});return t}()};n.extraData=utf8Encode(JSON.stringify(n)),c3.service.createCustomer(n,t)},createCustomerUser:function(e,t,n){var r={systemUsername:t.Name,status:t.Status,domain:t.Domain};c3.service.createCustomerUser(e,r,n)},getOperatorDetailsByCustomer:function(e,t){var n={};n.success=function(e){var n=e.d.results,r=[];if(n&&n.length>0)for(var i=0;i<n.length;i++)r.push({id:n[i].ID,status:n[i].Status,domainUserName:n[i].SystemUsername,roleName:n[i].Roles.results[0].Name||""});t(r)},n.error=function(e){},c3.service.getOperatorDetailsByCustomer(e,n)}},c3=c3||{};c3.biz=c3.biz||{},function(e){e.repositoryManager=e.repositoryManager||{};var t=e.repositoryManager;t.getExtensionRepository=function(e){var t,n;$.isFunction(e)?t=e:(t=e.success,n=e.error),e={},e.success=function(e,n){var r=e.d,i=r&&r.ExtensionRepository;t(i,n)},e.error=function(e,t){n&&n(e,t)},c3.service.getExtensionRepository(e)}}(c3.biz);var operatorManager={getOperators:function(){var e=arguments[0],t={};t.success=function(t){var n=t.d.results,r=[];if(n&&n.length>0)for(var i=0;i<n.length;i++)r.push({id:n[i].ID,status:n[i].Status,domainUserName:n[i].SystemUsername,roleName:n[i].Roles.results[0].Name||""});e(r)},t.error=function(e){};var n={};c3.service.getOperators(n,t)}},licenseFileManager={};(function(){"use strict";window.permissionItems={operator:1},window.c3=window.c3||{},window.c3.hasPermission=function(e){if(window.c3.userRole&&window.c3.userRole.roleId)return e.length===0||e.indexOf(window.c3.userRole.roleId)>-1;throw"check permission failed"}})(),c3addHostMapping.step1=function(){function r(){return["HOST_MAPPING_SLD","RESPOOL_B1BROWSERACCESSSERVER_TLT","RES_B1AH_SERVER"]}function i(){if(e.HostMappingEntity.ID&&e.HostMappingEntity.ID>0){var t=e.HostMappingEntity.ComponentType;switch(t){case"SLD":return r()[0];case"B1WebServer":return r()[1];case"B1ahServer":return r()[2];default:return r()[0]}}}function s(){if(e.HostMappingEntity.ID&&e.HostMappingEntity.ID>0){var t=e.HostMappingEntity.ComponentID;return e.HostMappingEntity.ComponentID}}function o(){var e=t.ComponentId.Value.val();t.InternalURL.Value.val("");if(e&&e!=null){var n=t.ComponentId.Value.find("option:selected");if(n&&n.length&&n.length>0){var r=t.ComponentId.Value.find("option:selected")[0].attributes;t.InternalURL.Value.val(r.InternalURL.value)}}}function u(e,n){n?(t.ComponentId.Value.val(e),$("select").attr("disabled",!0)):$("select").attr("disabled",!1),o()}this.base=c3.module,this.base(),this._container=$("<div>").addClass("wizard_lite");var e=arguments[0]||{},t={ComponentType:{Name:localizedString("HOST_MAPPING_COMPONENT_TYPE"),Value:new dropdownlist({isRequired:!0})},ComponentId:{Name:localizedString("HOST_MAPPING_COMPONENT"),Value:new dropdownlist({isRequired:!0})},InternalURL:{Name:localizedString("HOST_MAPPING_INTERNAL_URL"),Value:new textbox({isRequired:!0,isReadonly:!0})},ExternalURLs:{Name:localizedString("HOST_MAPPING_EXTERNAL_URLS"),Value:new textbox({isRequired:!0,pattern:"^((https|http)?://).+"})}},n={checkValidity:function(){var n=$.trim(t.ComponentType.Value.val()),i=$.trim(t.ComponentId.Value.val());return e.HostMappingEntity.ExternalURLs=$.trim(t.ExternalURLs.Value.val()),e.HostMappingEntity.spID=t.ComponentId.Value.find("option:selected").attr("id"),n==r()[0]&&(e.HostMappingEntity.ServiceType="SLD"),n==r()[1]&&(e.HostMappingEntity.ServiceType="B1WebServer"),n==r()[2]&&(e.HostMappingEntity.ServiceType="B1ahServer"),t.ComponentId.Value.checkValidity()&&t.InternalURL.Value.checkValidity()&&t.ExternalURLs.Value.checkValidity()}};this.validator=n,this.reset=function(){e.HostMappingEntity.ID&&e.HostMappingEntity.ID>0?t.ExternalURLs.Value.val(e.HostMappingEntity.ExternalURLs):t.ExternalURLs.Value.val(""),l()};var a=function(){var e=r();i()&&(e=[i()]),$.each(e,function(e,n){var r=$("<option>").attr({value:n}).append(localizedString(n));t.ComponentType.Value.append(r)})},f=function(e,n,r){var i=" ["+n+"]",s={ID:e,Name:n,InternalURL:r,value:e};t.ComponentId.Value.append($("<option>").attr(s).append(i))},l=function(){var n=t.ComponentType.Value.val(),o=!1,a=n==i()?s():undefined;e.HostMappingEntity.ID&&e.HostMappingEntity.ID>0&&(o=!0),t.ComponentId.Value.find("option").remove(),n==r()[0]?c3.service.getComponent("SldDetails").query(function(e){(o||e.data.length===0)&&f(0,window.localStorage.getItem("SLDMachineName"),window.localStorage.getItem("SLDFullyAddress")),u(0,o)}):n==r()[1]?c3.service.getComponent("B1WebServers").expand("ServerDetail").query(function(e){for(var t=0;t<e.data.length;t++)o?f(e.data[t].ID,e.data[t].Name,e.data[t].AccessURL):(e.data[t].ServerDetail===undefined||e.data[t].ServerDetail===null)&&f(e.data[t].ID,e.data[t].Name,e.data[t].AccessURL);u(a,o)}):n==r()[2]&&c3.service.getComponent("AnalyticsServices").expand("ServerDetail").query(function(e){for(var t=0;t<e.data.length;t++)o?f(e.data[t].ID,e.data[t].Name,e.data[t].AccessURL):(e.data[t].ServerDetail===undefined||e.data[t].ServerDetail===null)&&f(e.data[t].ID,e.data[t].Name,e.data[t].AccessURL);u(a,o)})};this.onInit=function(){for(var e in t)this._container.append(Utility.CreateRow(t[e].Name,t[e].Value));a(),t.ComponentType.Value.bind("change",function(e){l(),o()}),t.ComponentId.Value.bind("change",function(e){o()}),this.reset()}}